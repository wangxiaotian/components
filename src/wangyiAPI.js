if (typeof I$==="undefined"){I$=(function() {
    var o = {},
        f = function() {return !1;},
        cache = {};
    var is = function(data,type){
        return o.toString.call(data)==='[object '+type+']';
    };
    return function(key,func) {
        var result = cache[key],
            isfunc = is(func,'Function');
        // func is data
        if (func!=null&&!isfunc){
            result = func;
        }
        // do function defined
        if (isfunc){
            var arr = [];
            for(var i=2,l=arguments.length;i<l;i++){
                arr.push(arguments.callee(arguments[i]));
            }
            var exports = {};
            arr.push.call(arr,exports,{},f,[]);
            var ret = func.apply(null,arr)||exports;
            if (!result||!is(ret,'Object')){
                // for non-object return
                result = ret;
            }else{
                // for namespace return
                // bad performance for-in in v8 for instance
                if (!!Object.keys){
                    for(var ls=Object.keys(ret),i=0,l=ls.length,x;i<l;i++){
                        x = ls[i];
                        result[x] = ret[x];
                    }
                }else{
                    for(var x in ret){
                        result[x] = ret[x];
                    }
                }
            }
        }
        // init data
        if (result==null){
            result = {};
        }
        cache[key] = result;
        // return
        return result;
    };
})();;}
I$('c9db10699c7015cee29fb005f8df82a9',function (_p,_o,_f,_r){
    var _extpro = Function.prototype;
    /**
     * AOP增强操作，增强操作接受一个输入参数包含以下信息
     *
     *  | 参数名称 | 参数类型  | 参数描述 |
     *  | :--     | :--      | :-- |
     *  | args    | Array    | 函数调用时实际输入参数，各增强操作中可以改变值后将影响至后续的操作 |
     *  | value   | Variable | 输出结果 |
     *  | stopped | Boolean  | 是否结束操作，终止后续操作 |
     *
     * @method external:Function#_$aop
     * @param  {Function} arg0 - 前置操作，接受一个输入参数，见描述信息
     * @param  {Function} arg1 - 后置操作，接受一个输入参数，见描述信息
     * @return {Function}        增强后操作函数
     */
    _extpro._$aop = function(_before,_after){
        var _after = _after||_f,
            _before = _before||_f,
            _handler = this;
        return function(){
            var _event = {args:_r.slice.call(arguments,0)};
            _before(_event);
            if (!_event.stopped){
                _event.value = _handler.apply(this,_event.args);
                _after(_event);
            }
            return _event.value;
        };
    };
    /**
     * 绑定接口及参数，使其的调用对象保持一致
     *
     *  ```javascript
     *  var scope = {a:0};
     * 
     *  var func = function(a,b){
     *      // 第一个参数 ：1
     *      console.log(a);
     *      // 第二个参数 ： 2
     *      consoel.log(b);
     *      // 当前this.a ： 0
     *      console.log(this.a);
     *  };
     * 
     *  func._$bind(scope,"1")(2);
     *  ```
     *
     * @method external:Function#_$bind
     * @see    external:Function#_$bind2
     * @param  {Object} arg0 - 需要保持一致的对象，null表示window对象，此参数外的其他参数作为绑定参数
     * @return {Function}      返回绑定后的函数
     */
    _extpro._$bind = function() {
        var _args = arguments,
            _object = arguments[0],
            _function = this;
        return function(){
            // not use slice for chrome 10 beta and Array.apply for android
            var _argc = _r.slice.call(_args,1);
            _r.push.apply(_argc,arguments);
            return _function.apply(_object||null,_argc);
        };
    };
    /**
     * 绑定接口及参数，使其的调用对象保持一致，
     * 该接口与_$bind接口的差别在于绑定时参数和调用时参数的顺序不一样，
     * _$bind优先传入绑定时参数，_$bind2优先传入调用时参数
     *
     *  ```javascript
     *  var scope = {a:0};
     * 
     *  var func = function(a,b){
     *      // 第一个参数 ：2
     *      console.log(a);
     *      // 第二个参数 ： 1
     *      consoel.log(b);
     *      // 当前this.a ： 0
     *      console.log(this.a);
     *  };
     * 
     *  func._$bind(scope,"1")(2);
     *  ```
     *
     * @method external:Function#_$bind2
     * @see    external:Function#_$bind
     * @param  {Object} arg0 - 需要保持一致的对象，null表示window对象，此参数外的其他参数作为绑定参数
     * @return {Function}      返回绑定后的事件函数
     */
    _extpro._$bind2 = function() {
        var _args = arguments,
            _object = _r.shift.call(_args),
            _function = this;
        return function(){
            _r.push.apply(arguments,_args);
            return _function.apply(_object||null,arguments);
        };
    };
    // for compatiable
    var _extpro = String.prototype;
    if (!_extpro.trim){
         _extpro.trim = (function(){
            var _reg = /(?:^\s+)|(?:\s+$)/g;
            return function(){
                return this.replace(_reg,'');
            };
         })();
    }
    if (!this.console){
        this.console = {
            log:_f,
            error:_f
        };
    }

    if (CMPT){
        NEJ = this.NEJ||{};
        // copy object properties
        // only for nej compatiable
        NEJ.copy = function(a,b){
            a = a||{};
            b = b||_o;
            for(var x in b){
                if (b.hasOwnProperty(x)){
                    a[x] = b[x];
                }
            }
            return a;
        };
        // NEJ namespace
        NEJ = NEJ.copy(
            NEJ,{
                O:_o,R:_r,F:_f,
                P:function(_namespace){
                    if (!_namespace||!_namespace.length){
                        return null;
                    }
                    var _package = window;
                    for(var a=_namespace.split('.'),
                            l=a.length,i=(a[0]=='window')?1:0;i<l;
                            _package=_package[a[i]]=_package[a[i]]||{},i++);
                    return  _package;
                }
            }
        );
        
        return NEJ;
    }

    return _p;
});
I$('e93716ebc041935c89481acb162c0ee5',function (_p,_o,_f,_r){
    /**
     * 遍历对象
     * @param  {Object}   对象
     * @param  {Function} 迭代回调
     * @param  {Object}   回调执行对象
     * @return {String}   循环中断时的key值
     */
    _p.__forIn = function(_obj,_callback,_this){
        if (!_obj||!_callback){
            return null;
        }
        var _keys = Object.keys(_obj);
        for(var i=0,l=_keys.length,_key,_ret;i<l;i++){
            _key = _keys[i];
            _ret = _callback.call(
                _this||null,
                _obj[_key],_key,_obj
            );
            if (!!_ret){
                return _key;
            }
        }
        return null;
    };
    /**
     * 遍历列表
     * @param  {Array}    列表
     * @param  {Function} 迭代回调
     * @param  {Object}   回调执行对象
     * @return {Void}
     */
    _p.__forEach = function(_list,_callback,_this){
        _list.forEach(_callback,_this);
    };
    /**
     * 集合转数组
     * @param  {Object} 集合
     * @return {Array}  数组
     */
    _p.__col2array = function(_list){
        return _r.slice.call(_list,0);
    };
    /**
     * YYYY-MM-DDTHH:mm:ss.sssZ格式时间串转时间戳
     * @param  {String} 时间串
     * @return {Number} 时间戳
     */
    _p.__str2time = function(_str){
        return Date.parse(_str);
    };
    
    return _p;
});
I$('345f1460138e362bb33cc48ffc7cd12b',function (NEJ,_p,_o,_f,_r){
    var _platform  = this.navigator.platform,
        _useragent = this.navigator.userAgent;
    /**
     * 平台判断信息
     * 
     * ```javascript
     * NEJ.define([
     *     'base/platform'
     * ],function(_m){
     *     var _is = _m._$IS;
     *     // 是否MAC系统
     *     console.log(_is.mac);
     *     // 是否IPhone
     *     console.log(_is.iphone);
     *     // ...
     * });
     * ```
     * 
     * @const    module:base/platform._$IS
     * @see      module:base/platform._$is
     * @type     {Object}
     * @property {Boolean} mac     - 是否Mac系统
     * @property {Boolean} win     - 是否windows系统
     * @property {Boolean} linux   - 是否linux系统
     * @property {Boolean} ipad    - 是否Ipad
     * @property {Boolean} iphone  - 是否IPhone
     * @property {Boolean} android - 是否Android系统
     * @property {Boolean} ios     - 是否IOS系统
     * @property {Boolean} tablet  - 是否平板
     * @property {Boolean} desktop - 是否桌面系统
     */
    var _is = {
        mac     : _platform,
        win     : _platform,
        linux   : _platform,
        ipad    : _useragent,
        ipod    : _useragent,
        iphone  : _platform,
        android : _useragent
    };
    _p._$IS = _is;
    for(var x in _is){
        _is[x] = new RegExp(x,'i').test(_is[x]);
    }
    _is.ios = _is.ipad||_is.iphone||_is.ipod;
    _is.tablet = _is.ipad;
    _is.desktop = _is.mac||_is.win||(_is.linux&&!_is.android);
    /**
     * 判断是否指定平台
     * 
     * ```javascript
     * NEJ.define([
     *     'base/platform'
     * ],function(_m){
     *     // 是否MAC系统
     *     console.log(_m._$is('mac'));
     *     // 是否iphone
     *     console.log(_m._$is('iphone'));
     *     // ...
     * });
     * ```
     * 
     * @method module:base/platform._$is
     * @see    module:base/platform._$IS
     * @param  {String} arg0 - 平台名称
     * @return {Boolean}       是否指定平台
     */
    _p._$is = function(_platform){
        return !!_is[_platform];
    };
    // parse kernel information
    /**
     * 引擎内核信息
     * 
     * ```javascript
     * NEJ.define([
     *     'base/platform'
     * ],function(_m){
     *     var _kernel = _m._$KERNEL;
     *     // 打印平台信息
     *     console.log(_kernel.engine);
     *     console.log(_kernel.release);
     *     console.log(_kernel.browser);
     *     console.log(_kernel.version);
     * });
     * ```
     * 
     * @const    module:base/platform._$KERNEL
     * @type     {Object}
     * @property {String} engine  - 布局引擎，trident/webkit/gecko/presto...
     * @property {Number} release - 布局引擎版本
     * @property {String} browser - 浏览器名称，ie/chrome/safari/opera/firefox/maxthon...
     * @property {Number} version - 浏览器版本
     * @property {Object} prefix  - 平台前缀，html5/css3 attribute/method/constructor
     */
    var _kernel = {
        engine:'unknow',
        release:'unknow',
        browser:'unknow',
        version:'unknow',
        prefix:{css:'',pro:'',clz:''}
    };
    _p._$KERNEL  = _kernel;
    if (/msie\s+(.*?);/i.test(_useragent)||
        /trident\/.+rv:([\d\.]+)/i.test(_useragent)){
        _kernel.engine  = 'trident';
        _kernel.browser = 'ie';
        _kernel.version = RegExp.$1;
        _kernel.prefix  = {css:'ms',pro:'ms',clz:'MS',evt:'MS'};
        // 4.0-ie8 5.0-ie9 6.0-ie10 7.0-ie11
        // adjust by document mode setting in develop toolbar
        var _test = {6:'2.0',7:'3.0',8:'4.0',9:'5.0',10:'6.0',11:'7.0'};
        _kernel.release = _test[document.documentMode]||
                          _test[parseInt(_kernel.version)];
    }else if(/webkit\/?([\d.]+?)(?=\s|$)/i.test(_useragent)){
        _kernel.engine  = 'webkit';
        _kernel.release = RegExp.$1||'';
        _kernel.prefix  = {css:'webkit',pro:'webkit',clz:'WebKit'};
    }else if(/rv\:(.*?)\)\s+gecko\//i.test(_useragent)){
        _kernel.engine  = 'gecko';
        _kernel.release = RegExp.$1||'';
        _kernel.browser = 'firefox';
        _kernel.prefix  = {css:'Moz',pro:'moz',clz:'Moz'};
        if (/firefox\/(.*?)(?=\s|$)/i.test(_useragent))
            _kernel.version = RegExp.$1||'';
    }else if(/presto\/(.*?)\s/i.test(_useragent)){
        _kernel.engine  = 'presto';
        _kernel.release = RegExp.$1||'';
        _kernel.browser = 'opera';
        _kernel.prefix  = {css:'O',pro:'o',clz:'O'};
        if (/version\/(.*?)(?=\s|$)/i.test(_useragent))
            _kernel.version = RegExp.$1||'';
    }
    if (_kernel.browser=='unknow'){
        var _test = ['chrome','maxthon','safari'];
        for(var i=0,l=_test.length,_name;i<l;i++){
            _name = _test[i]=='safari'?'version':_test[i];
            if (new RegExp(_name+'/(.*?)(?=\\s|$)','i').test(_useragent)){
                _kernel.browser = _test[i];
                _kernel.version = RegExp.$1.trim();
                break;
            }
        }
    }
    /**
     * 引擎特性支持信息
     * 
     * ```javascript
     * NEJ.define([
     *     'base/platform'
     * ],function(_m){
     *     var _support = _m._$SUPPORT;
     *     // 打印平台是否支持CSS3 3D特效
     *     console.log(_support.css3d);
     * });
     * ```
     * @const    module:base/platform._$SUPPORT
     * @see      module:base/platform._$support
     * @type     {Object}
     * @property {Boolean} css3d  - 是否支持CSS3 3D
     */
    _p._$SUPPORT = {};
    /**
     * 判断平台是否支持指定特性
     * 
     * ```javascript
     * NEJ.define([
     *     'base/platform'
     * ],function(_m){
     *     // 是否支持CSS3 3D特效
     *     console.log(_m._$support('css3d'));
     * });
     * ```
     * 
     * @method module:base/platform._$support
     * @see    module:base/platform._$SUPPORT
     * @param  {String} arg0 - 特性标识
     * @return {Boolean}       是否支持指定特性
     */
    _p._$support = function(_feature){
        return !!_p._$SUPPORT[_feature];
    };
    
    if (CMPT){
        NEJ.copy(NEJ.P('nej.p'),_p);
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9');
I$('dacfbf80adcc9bde61028b172ff33754',function(_h,_m,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='4.0'){I$(1,function (){
        /**
         * 遍历对象
         * @param  {Object}   对象
         * @param  {Function} 迭代回调
         * @param  {Object}   回调执行对象
         * @return {String}   循环中断时的key值
         */
        _h.__forIn = function(_obj,_callback,_this){
            if (!_obj||!_callback){
                return;
            }
            // iterate
            var _ret;
            for(var x in _obj){
                if (!_obj.hasOwnProperty(x)) continue;
                _ret = _callback.call(_this,_obj[x],x,_obj);
                if (!!_ret){
                    return x;
                }
            }
        };
        /**
         * 遍历列表
         * @param  {Array}    列表
         * @param  {Function} 迭代回调
         * @param  {Object}   回调执行对象
         * @return {Void}
         */
        _h.__forEach = function(_list,_callback,_this){
            for(var i=0,l=_list.length;i<l;i++){
                _callback.call(_this,_list[i],i,_list);
            }
        };
        /**
         * 集合转数组
         * @param  {Object} 集合
         * @return {Array}  数组
         */
        _h.__col2array = function(_list){
            var _result = [];
            if (!!_list&&!!_list.length){
                for(var i=0,l=_list.length;i<l;i++){
                    _result.push(_list[i]);
                }
            }
            return _result;
        };
        /**
         * YYYY-MM-DDTHH:mm:ss.sssZ格式时间串转时间戳
         * @param  {String} 时间串
         * @return {Number} 时间戳
         */
        _h.__str2time = (function(){
            var _reg = /-/g;
            return function(_str){
                // only support YYYY/MM/DDTHH:mm:ss
                return Date.parse(_str.replace(_reg,'/').split('.')[0]);
            };
        })();
    });}return _h;},'e93716ebc041935c89481acb162c0ee5','345f1460138e362bb33cc48ffc7cd12b');
I$('5e5afc6c5ab9a60e963a7e2e41706b91',function (NEJ,_u,_p,_o,_f,_r){
    /**
     * 定义类，通过此api定义的类具有以下特性：
     *
     * * {@link external:Function#_$extend|_$extend}作为类的静态扩展方法
     * * __init作为类的初始化函数
     * * __super作为子类调用父类的同名函数
     *
     * ```javascript
     * NEJ.define([
     *     'base/klass'
     * ],function(k,p){
     *     // 定义类A
     *     p.A = k._$klass();
     *     var pro = A.prototype;
     *     // 初始化
     *     pro.__init = function(){
     *          // do init
     *     };
     *     // 类接口
     *     pro.__doSomething = function(a){
     *         // TODO something
     *     };
     * 
     *     return p;
     * });
     * ```
     * 
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     '/path/to/class/a.js'
     * ],function(k,a,p){
     *     // 定义类B，并继承自A
     *     p.B = k._$klass();
     *     var pro = B._$extend(a.A);
     *     // 初始化
     *     pro.__init = function(){
     *         // 调用A的初始化逻辑
     *         this.__super();
     *         // TODO B的初始化逻辑
     *     };
     *     // 类接口
     *     pro.__doSomething = function(a){
     *         // 调用A的__doSomething接口
     *         this.__super(a);
     *         // TODO B的逻辑
     *     };
     * 
     *     return p;
     * });
     * ```
     * 
     * @method module:base/klass._$klass
     * @see    external:Function#_$extend
     * @return {Function} 返回定义的类
     */
    _p._$klass = (function(){
        var _isNotFunction = function(){
            return _o.toString.call(arguments[0])!=='[object Function]';
        };
        var _doFindIn = function(_method,_klass){
            while(!!_klass){
                var _pro = _klass.prototype,
                    _key = _u.__forIn(_pro,function(v){
                        return _method===v;
                    });
                if (_key!=null){
                    return {
                        name:_key,
                        klass:_klass
                    };
                }
                _klass = _klass._$super;
            }
        };
        return function(){
            // class constructor
            var _Klass = function(){
                return this.__init.apply(this,arguments);
            };
            _Klass.prototype.__init = _f;
            /**
             * 子类继承父类
             *
             * ```javascript
             * NEJ.define([
             *     'base/klass'
             * ],function(k,p){
             *     // 定义类A
             *     p.A = k._$klass();
             *     var pro = A.prototype;
             *     // 初始化
             *     pro.__init = function(){
             *          // do init
             *     };
             *     // 类接口
             *     pro.__doSomething = function(a){
             *         // TODO something
             *     };
             * 
             *     return p;
             * });
             * ```
             * 
             * ```javascript
             * NEJ.define([
             *     'base/klass',
             *     '/path/to/class/a.js'
             * ],function(k,a,p){
             *     // 定义类B，并继承自A
             *     p.B = k._$klass();
             *     var pro = B._$extend(a.A);
             *     // 初始化
             *     pro.__init = function(){
             *         // 调用A的初始化逻辑
             *         this.__super();
             *         // TODO B的初始化逻辑
             *     };
             *     // 类接口
             *     pro.__doSomething = function(a){
             *         // 调用A的__doSomething接口
             *         this.__super(a);
             *         // TODO B的逻辑
             *     };
             * 
             *     return p;
             * });
             * ```
             *
             * @method external:Function#_$extend
             * @see    module:base/klass._$klass
             * @param  {Function} arg0 - 父类
             * @param  {Boolean}  arg1 - 是否拷贝父类的静态方法，默认拷贝父类静态方法
             * @return {Object}          扩展类的prototype对象
             */
            _Klass._$extend = function(_super,_static){
                if (_isNotFunction(_super)){
                    return;
                }
                // for static method
                var _this = this;
                if (_static!==!1){
                    _u.__forIn(_super,function(v,k){
                        if (!_isNotFunction(v)){
                            _this[k] = v;
                        }
                    });
                }
                // do inherit
                this._$super = _super;
                var _parent = function(){};
                _parent.prototype = _super.prototype;
                this.prototype = new _parent();
                this.prototype.constructor = this;
                // for super method call
                var _stack = [],
                    _phash = {};
                var _doUpdateCache = function(_method,_klass){
                    var _result = _doFindIn(_method,_klass);
                    if (!_result) return;
                    // save state
                    if (_stack[_stack.length-1]!=_result.name){
                        _stack.push(_result.name);
                    }
                    _phash[_result.name] = _result.klass._$super;
                    return _result.name;
                };
                this.prototype.__super = function(){
                    var _name = _stack[_stack.length-1],
                        _method = arguments.callee.caller;
                    if (!_name){
                        _name = _doUpdateCache(_method,this.constructor);
                    }else{
                        var _parent = _phash[_name].prototype;
                        // switch caller name
                        if (!_parent.hasOwnProperty(_name)||
                            _method!=_parent[_name]){
                            _name = _doUpdateCache(_method,this.constructor);
                        }else{
                            // other method in current parent
                            _phash[_name] = _phash[_name]._$super;
                        }
                    }
                    // call parent method
                    var _ret = _phash[_name].prototype[_name].apply(this,arguments);
                    // exit super
                    if (_name==_stack[_stack.length-1]){
                        _stack.pop();
                        delete _phash[_name];
                    }
                    return _ret;
                };

                if (CMPT){
                    var _pro = this.prototype;
                    _pro.__supInit      = _pro.__super;
                    _pro.__supReset     = _pro.__super;
                    _pro.__supDestroy   = _pro.__super;
                    _pro.__supInitNode  = _pro.__super;
                    _pro.__supDoBuild   = _pro.__super;
                    _pro.__supOnShow    = _pro.__super;
                    _pro.__supOnHide    = _pro.__super;
                    _pro.__supOnRefresh = _pro.__super;
                    this._$supro = _super.prototype;
                }

                return this.prototype;
            };
            return _Klass;
        };
    })();

    if (CMPT){
        NEJ.C = _p._$klass;
        NEJ.copy(this.NEJ,NEJ);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','dacfbf80adcc9bde61028b172ff33754');
I$('3ff9c25bd81a3c2a260c28122918263a',function (NEJ,_h,_p,_o,_f,_r){
    /*
     * 查看数据是否指定类型
     * @param  {Variable} 数据
     * @param  {String}   类型
     * @return {Boolean}  是否指定类型
     */
    var _isTypeOf = function(_data,_type){
        try{
            _type = _type.toLowerCase();
            if (_data===null) return _type=='null';
            if (_data===undefined) return _type=='undefined';
            return _o.toString.call(_data).toLowerCase()=='[object '+_type+']';
        }catch(e){
            return !1;
        }
    };
    /**
     * 判断是否函数类型
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isFunction(123);
     *     // 返回true
     *     var is = _u._$isFunction(function(){});
     * });
     * ```
     *
     * @method module:base/util._$isFunction
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否函数类型
     */
    _p._$isFunction = function(_data){
        return _isTypeOf(_data,'function');
    };
    /**
     * 判断是否字符串
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isString(123);
     *     // 返回true
     *     var is = _u._$isString("123");
     * });
     * ```
     *
     * @method module:base/util._$isString
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否字符串
     */
    _p._$isString = function(_data){
        return _isTypeOf(_data,'string');
    };
    /**
     * 判断是否数字
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isNumber("123");
     *     // 返回true
     *     var is = _u._$isNumber(123);
     *     var is = _u._$isNumber(-123);
     *     var is = _u._$isNumber(Number.MAX_VALUE);
     * });
     * ```
     *
     * @method module:base/util._$isNumber
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否数值类型
     */
    _p._$isNumber = function(_data){
        return _isTypeOf(_data,'number');
    };
    /**
     * 判断是否布尔值
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isBoolean(0);
     *     // 返回true
     *     var is = _u._$isBoolean(false);
     * });
     * ```
     *
     * @method module:base/util._$isBoolean
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否布尔值
     */
    _p._$isBoolean = function(_data){
        return _isTypeOf(_data,'boolean');
    };
    /**
     * 判断是否日期
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isDate(0);
     *     // 返回true
     *     var is = _u._$isDate(new Date());
     * });
     * ```
     *
     * @method module:base/util._$isDate
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否日期
     */
    _p._$isDate = function(_data){
        return _isTypeOf(_data,'date');
    };
    /**
     * 判断是否数组
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isArray(0);
     *     // 返回true
     *     var is = _u._$isArray([1,2]);
     * });
     * ```
     *
     * @method module:base/util._$isArray
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否数组
     */
    _p._$isArray = function(_data){
        return _isTypeOf(_data,'array');
    };
    /**
     * 判断是否对象
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回false
     *     var is = _u._$isObject(function(){});
     *     // 返回true
     *     var is = _u._$isObject({});
     *     var is = _u._$isObject({a:"a"});
     * });
     * ```
     *
     * @method module:base/util._$isObject
     * @param  {Variable} arg0 - 待检测类型的数据
     * @return {Boolean}         是否对象
     */
    _p._$isObject = function(_data){
        return _isTypeOf(_data,'object');
    };
    /**
     * 计算字符串长度，中文算两个字符
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 字符串长度为5
     *     var len = _u._$length('你i他');
     * });
     * ```
     *
     * @method module:base/util._$length
     * @param  {String} arg0 - 待计算长度字符串
     * @return {Number}        字符串长度
     */
    _p._$length = (function(){
        var _reg = /[^\x00-\xff]/g;
        return function(_content){
            return (''+(_content||'')).replace(_reg,'**').length;
        };
    })();
    /**
     * 遍历对象
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *       var obj = {a:{id:1,name:'a'},b:{id:2,name:'b'},...};
     * 
     *       // 遍历对象    
     *       _u._$loop(obj,function(_item,_key){
     *           // TODO
     *       });
     * 
     *       // 从对象里查找id为2的元素，如果有返回KEY，没有返回null
     *       var key = _u._$loop(obj,function(_item){
     *           return _item.id==2;
     *       });
     * });
     * ```
     * 
     * @method module:base/util._$loop
     * @see    module:base/util._$forIn
     * @param  {Object}   arg0 - 对象
     * @param  {Function} arg1 - 回调，如果返回true，则中断遍历
     * @param  {Object}   arg2 - 回调函数调用时this对象
     * @return {String}          返回中断时的标识，没有中断则统一返回null
     */
    _p._$loop = function(_obj,_callback,_this){
        if (_p._$isObject(_obj)&&
            _p._$isFunction(_callback)){
            return _h.__forIn.apply(_h,arguments);
        }
        return null;
    };
    /**
     * 线性查找指定项
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     var list = ["你","我","他"];
     *     // 返回下标1
     *     var index = _u._$indexOf(list,"我");
     *     // 没有找到，返回-1
     *     var index = _u._$indexOf(list,"他们");
     *     // 如果第二个参数是过滤接口，根据接口的规则查找
     *     // 以下规则排除第一个下标
     *     var index = _u._$indexOf(list,function(_item,_index,_list){
     *           return _item==='他';
     *     });
     * });
     * ```
     *
     * @method module:base/util._$indexOf
     * @param  {Array}    arg0 - 待搜索列表
     * @param  {Variable} arg1 - 指定项，如果为function则表示过滤接口
     * @return {Number}          给定项所在的位置索引，以0开始，没有项返回-1
     */
    _p._$indexOf = function(_list,_item){
        var _filter = _p._$isFunction(_item) ? _item
                    : function(_value){return _value===_item;},
            _index  = _p._$forIn(_list,_filter);
        return _index!=null?_index:-1;
    };
    /**
     * 二分法查找指定项
     * 
     * 验证函数输入输出说明
     * 
     * |      | 类型          | 结果说明 |
     * | :--  | :--      | :-- |
     * | 输入  | Variable | 中间项元素 |
     * | 输出  | Number   | < 0  目标元素在低位区间 |
     * |      |          | = 0  匹配到目标元素 |
     * |      |          | > 0  目标元素在高位区间 |
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 二分查找id为2的项的索引值
     *     var list = [{id:1,name:'aaa'},{id:2,name:'bbbb'},...];
     *     var index = _u._$binSearch(list,function(_item){
     *         return _item.id-2;
     *     });
     * });
     * ```
     *
     * @method module:base/util._$binSearch
     * @param  {Array}    arg0 - 待查找列表
     * @param  {Function} arg1 - 验证函数
     * @return {Number}          找到匹配项索引，找不到返回-1
     */
    _p._$binSearch = (function(){
        var _docheck;
        // do binary search
        var _doSearch = function(_list,_low,_high){
            if (_low>_high) return -1;
            var _middle = Math.ceil((_low+_high)/2),
                _result = _docheck(_list[_middle],_middle,_list);
            if (_result==0)
                return _middle;
            if (_result<0)
                return _doSearch(_list,_low,_middle-1);
            return _doSearch(_list,_middle+1,_high);
        };
        return function(_list,_check){
            _docheck = _check||_f;
            return _doSearch(_list,0,_list.length-1);
        };
    })();
    /**
     * 逆序遍历列表，支持中断
     * 
     * 回调函数输入输出说明
     * 
     * |      | 类型          | 说明 |
     * | :--  | :--      | :-- |
     * | 输入  | Variable | 值 |
     * |      | Number   | 下标 |
     * |      | Array    | 列表对象 |
     * | 输出  | Boolean  | 是否匹配 |
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 删除id为3的项，并退出循环
     *     var list = [{id:1,name:'aaa'},{id:2,name:'bbbb'},...];
     *     _u._$reverseEach(list,function(_item,_index,_list){
     *         if (_item.id==3){
     *             _list.splice(_index,1);
     *             return !0;
     *         }
     *     });
     * });
     * ```
     *
     * @method module:base/util._$reverseEach
     * @see    module:base/util._$forEach
     * @param  {Array}    arg0 - 列表
     * @param  {Function} arg1 - 回调，如果返回true，则中断遍历
     * @param  {Object}   arg2 - 回调函数调用时this对象
     * @return {Number}          返回遍历中断时的索引值，没有中断则返回null
     */
    _p._$reverseEach = function(_list,_callback,_this){
        if (!!_list&&!!_list.length&&_p._$isFunction(_callback)){
            for(var i=_list.length-1;i>=0;i--){
                if (!!_callback.call(_this,_list[i],i,_list)){
                    return i;
                }
            }
        }
        return null;
    };
    /**
     * 正序遍历列表，不支持中断
     * 
     * 回调函数输入输出说明
     * 
     * |      | 类型          | 说明 |
     * | :--  | :--      | :-- |
     * | 输入  | Variable | 值 |
     * |      | Number   | 下标 |
     * |      | Array    | 列表对象 |
     * | 输出  | Boolean  | 是否匹配 |
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     var list = [1,2,3];
     *     _u._$forEach(list,function(_item,_index,_list){
     *         // TODO somthing
     *     });
     * });
     * ```
     *
     * @method module:base/util._$forEach
     * @see    module:base/util._$reverseEach
     * @param  {Array}    arg0 - 列表
     * @param  {Function} arg1 - 回调，如果返回true，则中断遍历
     * @param  {Object}   arg2 - 回调函数调用时this对象
     * @return {Void}
     */
    _p._$forEach = function(_list,_callback,_this){
        if (!!_list&&!!_list.length&&
            _p._$isFunction(_callback)){
            if (!_list.forEach){
                _p._$forIn.apply(_p,arguments);
            }else{
                _h.__forEach(_list,_callback,_this);
            }
        }
    };
    /**
     * 遍历列表或对象，如果带length属性，则作为数组遍历，如果要遍历带length属性的对象用_$loop接口，支持中断退出
     *
     * 回调函数输入输出说明
     * 
     * |      | 类型          | 说明 |
     * | :--  | :--      | :-- |
     * | 输入  | Variable | 值 |
     * |      | Number   | 下标 |
     * |      | Object_Array | 列表或者集合对象 |
     * | 输出  | Boolean  | 是否匹配 |
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *       // 从有序列表里查找id为2的元素，如果有则返回索引，没有返回null
     *       var list = [{id:1,name:'a'},{id:2,name:'b'},...];
     *       var index = _u._$forIn(list,function(_item){
     *           return _item.id==2;
     *       });
     *
     *       // 从对象里查找id为2的元素，如果有返回KEY，没有返回null
     *       var obj = {a:{id:1,name:'a'},b:{id:2,name:'b'},...};
     *       var key = _u._$forIn(obj,function(_item){
     *           return _item.id==2;
     *       });
     * });
     * ```
     *
     * @method module:base/util._$forIn
     * @param  {Object|Array} arg0 - 列表或者对象
     * @param  {Function}     arg1 - 回调，如果返回true，则中断遍历
     * @param  {Object}       arg2 - 回调函数调用时this对象
     * @return {String|Number}       返回中断时的索引或者标识，没有中断则统一返回null
     */
    _p._$forIn = function(_list,_callback,_this){
        if (!_list||!_p._$isFunction(_callback)){
            return null;
        }
        if (_p._$isNumber(_list.length)){
            // list see as array
            for(var i=0,l=_list.length;i<l;i++){
                if (!!_callback.call(_this,_list[i],i,_list)){
                    return i;
                }
            }
        }else if (_p._$isObject(_list)){
            // list is object
            return _p._$loop(_list,_callback,_this);
        }
        return null;
    };
    /**
     * 编码字符串，
     * 编码规则对象中r正则表达式参数提取字符串需要编码的内容，
     * 然后使用编码规则对象中的映射表进行替换
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 把字符串99999根据规则9替换成t，结果：ttttt
     *     var str = _u._$encode({r:/\d/g,'9':'t'},'99999');
     * });
     * ```
     *
     * @method module:base/util._$encode
     * @param  {Object} arg0 - 编码规则
     * @param  {String} arg1 - 待编码的字串
     * @return {String}        编码后的字串
     */
    _p._$encode = function(_map,_content){
        _content = ''+_content;
        if (!_map||!_content){
            return _content||'';
        }
        return _content.replace(_map.r,function($1){
            var _result = _map[!_map.i?$1.toLowerCase():$1];
            return _result!=null?_result:$1;
        });
    };
    /**
     * 编码html代码，'<' -> '&amp;lt;'
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 编码，结果：&amp;lt;a&amp;gt;util&amp;lt;/a&amp;gt;&amp;amp;
     *     var str = _u._$escape('<a>util</a>&');
     * });
     * ```
     *
     * @method module:base/util._$escape
     * @see    module:base/util._$unescape
     * @param  {String} arg0 - 待编码串
     * @return {String}        编码后的串
     */
    _p._$escape = (function(){
        var _reg = /<br\/?>$/,
            _map = {
                r:/\<|\>|\&|\r|\n|\s|\'|\"/g,
                '<':'&lt;','>':'&gt;','&':'&amp;',' ':'&nbsp;',
                '"':'&quot;',"'":'&#39;','\n':'<br/>','\r':''
            };
        return function(_content){
            _content = _p._$encode(_map,_content);
            return _content.replace(_reg,'<br/><br/>');
        };
    })();
    /**
     * 反编码html代码，'&amp;lt;' -> '<' 
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 反编码，结果：<&a>util</a>
     *     var str = _u._$unescape('&amp;lt;&amp;amp;a&amp;gt;util&amp;lt;/a&amp;gt;');
     * });
     * ```
     *
     * @method module:base/util._$unescape
     * @see    module:base/util._$escape
     * @param  {String} arg0 - 待反编码串
     * @return {String}        反编码后的串
     */
    _p._$unescape = (function(){
        var _map = {r:/\&(?:lt|gt|amp|nbsp|#39|quot)\;|\<br\/\>/gi,'&lt;':'<','&gt;':'>','&amp;':'&','&nbsp;':' ','&#39;':"'",'&quot;':'"','<br/>':'\n'};
        return function(_content){
            return _p._$encode(_map,_content);
        };
    })();
    /**
     * 格式化时间，yyyy|yy|MM|cM|eM|M|dd|d|HH|H|mm|ms|ss|m|s|w
     *
     * 各标识说明：
     * 
     * | 标识  | 说明 |
     * | :--  | :-- |
     * | yyyy | 四位年份，如2001 |
     * | yy   | 两位年费，如01 |
     * | MM   | 两位月份，如08 |
     * | M    | 一位月份，如8 |
     * | dd   | 两位日期，如09 |
     * | d    | 一位日期，如9 |
     * | HH   | 两位小时，如07 |
     * | H    | 一位小时，如7 |
     * | mm   | 两位分钟，如03 |
     * | m    | 一位分钟，如3 |
     * | ss   | 两位秒数，如09 |
     * | s    | 一位秒数，如9 |
     * | ms   | 毫秒数，如234 |
     * | w    | 中文星期几，如一 |
     * | ct   | 12小时制中文后缀，上午/下午 |
     * | et   | 12小时制英文后缀，A.M./P.M. |
     * | cM   | 中文月份，如三 |
     * | eM   | 英文月份，如Mar |
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 根据格式输出时间，比如:2012-01-11,连接符可自定义
     *     var str = _u._$format(new Date(),'yyyy-MM-dd');
     * });
     * ```
     *
     * @method module:base/util._$format
     * @param  {Number|String|Date} arg0 - 时间
     * @param  {String}             arg1 - 格式
     * @return {String}                    指定格式的时间串
     */
    _p._$format = (function(){
        var _map = {i:!0,r:/\byyyy|yy|MM|cM|eM|M|dd|d|HH|H|mm|ms|ss|m|s|w|ct|et\b/g},
            _12cc = ['上午','下午'],
            _12ec = ['A.M.','P.M.'],
            _week = ['日','一','二','三','四','五','六'],
            _cmon = ['一','二','三','四','五','六','七','八','九','十','十一','十二'],
            _emon = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sept','Oct','Nov','Dec'];
        var _fmtnmb = function(_number){
            _number = parseInt(_number)||0;
            return (_number<10?'0':'')+_number;
        };
        var _fmtclc = function(_hour){
            return _hour<12?0:1;
        };
        return function(_time,_format,_12time){
            if (!_time||!_format)
                return '';
            _time = _p._$var2date(_time);
            _map.yyyy = _time.getFullYear();
            _map.yy   = (''+_map.yyyy).substr(2);
            _map.M    = _time.getMonth()+1;
            _map.MM   = _fmtnmb(_map.M);
            _map.eM   = _emon[_map.M-1];
            _map.cM   = _cmon[_map.M-1];
            _map.d    = _time.getDate();
            _map.dd   = _fmtnmb(_map.d);
            _map.H    = _time.getHours();
            _map.HH   = _fmtnmb(_map.H);
            _map.m    = _time.getMinutes();
            _map.mm   = _fmtnmb(_map.m);
            _map.s    = _time.getSeconds();
            _map.ss   = _fmtnmb(_map.s);
            _map.ms   = _time.getMilliseconds();
            _map.w    = _week[_time.getDay()];
            var _cc   = _fmtclc(_map.H);
            _map.ct   = _12cc[_cc];
            _map.et   = _12ec[_cc];
            if (!!_12time){
                _map.H = _map.H%12;
            }
            return _p._$encode(_map,_format);
        };
    })();
    /**
     * 日期字符串转日期对象
     * 
     * 字符串日期格式同ECMA规范定义：YYYY-MM-DDTHH:mm:ss.sssZ
     * 
     * 各标识说明：
     * 
     * | 标识 | 说明 |
     * | :--  | :-- |
     * | YYYY | 四位年份，0000-9999，如2001 |
     * | -    | 年月日分隔符 |
     * | MM   | 两位月份，01-12，如03 |
     * | DD   | 两位日期，01-31，如07 |
     * | T    | 时间起始标识 |
     * | HH   | 两位小时，00-24，如05 |
     * | :    | 时分秒分隔符 |
     * | mm   | 两位分钟，00-59，如30 |
     * | ss   | 两位秒数，00-59，如08 |
     * | .    | 秒/毫秒分隔符 |
     * | sss  | 三位毫秒数，000-999，如004 |
     * | Z    | 时区偏移 |
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 输入YYYY-MM-DDTHH:mm:ss.sssZ格式字符串，生成日期对象
     *     var date = _u._$var2date('2013-07-29T13:12:45.300');
     *
     *     // 输入YYYY-MM-DDTHH:mm:ss格式字符串，生成日期对象
     *     var date = _u._$var2date('2013-07-29T13:12:45');
     *
     *     // 输入YYYY-MM-DD格式字符串，生成日期对象
     *     var date = _u._$var2date('2013-07-29');
     * });
     * ```
     *
     * @method module:base/util._$var2date
     * @param  {String} arg0 - 日期串
     * @return {Date}          日期对象
     */
    _p._$var2date = function(_time){
        var _date = _time;
        if (_p._$isString(_time)){
            _date = new Date(
                _h.__str2time(_time)
            );
        }
        if (!_p._$isDate(_date)){
            _date = new Date(_time);
        }
        return _date;
    };
    /**
     * 浮点数值保留指定位数小数点
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 保留2位小数，返回3.14
     *     var value = _u._$fixed(3.14159,2);
     * });
     * ```
     *
     * @method module:base/util._$fixed
     * @param  {Float}  arg0 - 浮点数
     * @param  {Number} arg1 - 小数位
     * @return {Number}        浮点数
     */
    _p._$fixed = function(_float,_fraction){
        return parseFloat(new Number(_float).toFixed(_fraction));
    };
    /**
     * 相对路径转绝对路径
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 相对路径../a/b.html转绝对路径http://a.b.com:8010/a/b.html
     *     var url = _u._$absolute(
     *         '../a/b.html',
     *         'http://a.b.com:8010/z/'
     *     );
     * });
     * ```
     * 
     * @method module:base/util._$absolute
     * @param  {String} arg0 - 相对路径
     * @param  {String} arg1 - 绝对路径ROOT，必须以http://开始，默认为location目录
     * @return {String}        绝对路径地址
     */
    _p._$absolute = (function(){
        var _reg0 = /([^\/:])\/.*$/,
            _reg1 = /\/[^\/]+$/,
            _reg2 = /[#\?]/,
            _base = location.href.split(/[?#]/)[0],
            _anchor = document.createElement('a');
        var _isAbsolute = function(_uri){
            return (_uri||'').indexOf('://')>0;
        };
        var _doFormat = function(_uri){
            return (_uri||'').split(_reg2)[0]
                             .replace(_reg1,'/');
        };
        var _doMergeURI = function(_uri,_root){
            // for /a/b/c
            if (_uri.indexOf('/')==0)
                return _root.replace(_reg0,'$1')+_uri;
            // for a/b or ./a/b or ../a/b
            return _doFormat(_root)+_uri;
        };
        _base = _doFormat(_base);
        return function(_uri,_root){
            _uri = (_uri||'').trim();
            if (!_isAbsolute(_root))
                _root = _base;
            if (!_uri) return _root;
            if (_isAbsolute(_uri))
                return _uri;
            _uri = _doMergeURI(_uri,_root);
            _anchor.href = _uri;
            _uri = _anchor.href;
            return _isAbsolute(_uri) ? _uri :
                   _anchor.getAttribute('href',4); // ie6/7
        };
    })();
    /**
     * 从URL地址中提取源信息
     * 
     * * http://a.b.com:8080/a/b/ -> http://a.b.com:8080
     * * /a/b -> 
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 提取url地址的源信息
     *     // 返回http://a.b.com:8080
     *     var origin = _u._$url2origin("http://a.b.com:8080/a/b/");
     * });
     * ```
     *
     * @method module:base/util._$url2origin
     * @param  {String} arg0 - URL地址
     * @return {String}        源信息
     */
    _p._$url2origin = (function(){
        var _reg = /^([\w]+?:\/\/.*?(?=\/|$))/i;
        return function(_url){
            if (_reg.test(_url||''))
                return RegExp.$1.toLowerCase();
            return '';
        };
    })();
    /**
     * key-value字符串转对象
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     var str = "abc=abc,123=123";
     *     // 返回对象{abc:"abc",123:"123"}
     *     var obj = _u._$string2object(_str,",");
     * });
     * ```
     *
     * @method module:base/util._$string2object
     * @see    module:base/util._$object2string
     * @param  {String}           arg0 - 待处理数据
     * @param  {String|RegExp}    arg1 - 分隔符
     * @param  {Boolean|Function} arg2 - 是否反编码
     * @return {Object}           转换后对象
     */
    _p._$string2object = function(_string,_split,_decode){
        var _obj = {};
        // decode function
        var _func = _decode;
        if (!_p._$isFunction(_func)){
            _func = function(v){
                return !_decode?v:decodeURIComponent(v);
            };
        }
        // parse string
        _p._$forEach(
            (_string||'').split(_split),
            function(_name){
                var _brr = _name.split('=');
                if (!_brr||!_brr.length) return;
                var _key = _brr.shift();
                if (!!_key){
                    _obj[_func(_key)] = _func(_brr.join('='));
                }
            }
        );
        return _obj;
    };
    /**
     * key-value对象转成key=value对后用分隔符join
     * 
     * 对象中不同类型的取值规则如下：
     * 
     * | 类型            |  取值规则 |
     * | :--       | :-- |
     * | Function  |  过滤掉，不输出 |
     * | Date      |  转成时间戳，getTime取值 |
     * | Array     |  值用逗号分隔，如[1,2,3] -> 1,2,3 |
     * | Object    |  使用JSON转成字符串 |
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回字符串 abc=abc,123=123
     *     var obj = {
     *         abc:"abc",
     *         123:"123"
     *     };
     *     var str = _u._$object2string(obj);
     *
     *     // 返回字符串
     *     // a=1871406603152186&b=1,2,3&d={"a":"a","b":"b"}&e=e&f=1&g=true
     *     var obj = {
     *         a:new Date,
     *         b:[1,2,3],
     *         c:function(){},
     *         d:{a:'a',b:'b'},
     *         e:'e',
     *         f:1,
     *         g:true
     *     };
     *     var str = _u._$object2string(obj,'&');
     * });
     * ```
     *
     * @method module:base/util._$object2string
     * @see    module:base/util._$string2object
     * @param  {Object}  arg0 - 对象
     * @param  {String}  arg1 - 分隔符，默认为逗号
     * @param  {Boolean|Function} arg2 - 是否编码
     * @return {String}         key-value串
     */
    _p._$object2string = function(_object,_split,_encode){
        if (!_object) return '';
        var _arr = [];
        // encode function
        var _func = _encode;
        if (!_p._$isFunction(_func)){
            _func = function(v){
                return !_encode?v:encodeURIComponent(v);
            };
        }
        // parse object
        _p._$loop(
            _object,function(_value,_key){
                if (_p._$isFunction(_value)){
                    return;
                }
                if (_p._$isDate(_value)){
                    _value = _value.getTime();
                }else if(_p._$isArray(_value)){
                    _value = _value.join(',');
                }else if(_p._$isObject(_value)){
                    _value = JSON.stringify(_value);
                }
                _arr.push(_func(_key)+'='+_func(_value));
            }
        );
        return _arr.join(_split||',');
    };
    /**
     * 查询串转对象
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回对象{abc:"abc",123:"123"}
     *     var obj = _u._$query2object("abc=abc&123=123");
     * });
     * ```
     *
     * @method module:base/util._$query2object
     * @see    module:base/util._$object2query
     * @see    module:base/util._$string2object
     * @param  {String} arg0 - 查询串
     * @return {Object}        转换出来的对象
     */
    _p._$query2object = function(_query){
        return _p._$string2object(_query,'&',!0);
    };
    /**
     * 对象转查询串
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回对象123=123&abc=abc
     *     var query = _u._$object2query({abc:"abc",123:"123"});
     * });
     * ```
     *
     * @method module:base/util._$object2query
     * @see    module:base/util._$query2object
     * @see    module:base/util._$object2string
     * @param  {Object} arg0 - 对象
     * @return {String}        查询串
     */
    _p._$object2query = function(_object){
        return _p._$object2string(_object,'&',!0);
    };
    /**
     * 集合转数组，集合具有length属性
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 返回数组['1','2','3']
     *     var map = {0:'0',1:'1',2:'2',length:3};
     *     var arr = _u._$object2array(map);
     *
     *     // 多用于对节点集合的转换
     *     var nodes = document.body.childNodes;
     *     var arr = _u._$object2array(nodes);
     * });
     * ```
     *
     * @method module:base/util._$object2array
     * @see    module:base/util._$array2object
     * @param  {Object} arg0 - 集合，必须有length属性
     * @return {Array}         数组
     */
    _p._$object2array = function(_object){
        return _h.__col2array(_object);
    };
    /**
     * 数组转对象，将列表中元素按照指定KEY组成对象<br/>
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 输出结果为 {2:{id:2,name:'b'},...}
     *     var arr = [{id:1,name:'a'},{id:2,name:'b'},...];
     *     var obj = _u._$array2object(
     *         arr,function(_item){
     *             // 过滤name为a的项
     *             if (_item.name=='a'){
     *                 return;
     *             }
     *             // 组对象的KEY用每项的id
     *             return _item.id;
     *         }
     *     );
     *
     *     // 默认使用每项的值组对象
     *     var brr = ['a','b','c',...];
     *     // 输出 {a:'a',b:'b',c:'c',...}
     *     var obj = _u._$array2object(brr);
     * });
     * ```
     *
     * @method module:base/util._$array2object
     * @see    module:base/util._$object2array
     * @param  {Array}    arg0 - 列表
     * @param  {Function} arg1 - 过滤函数，返回每一项的KEY，没有返回则过滤当前项
     * @return {Object}   对象
     */
    _p._$array2object = function(_list,_filter){
        var _result = {};
        _p._$forEach(
            _list,function(_item){
                var _key = _item;
                if (!!_filter){
                    _key = _filter(_item);
                }
                if (_key!=null){
                    _result[_key] = _item;
                }
            }
        );
        return _result;
    };
    /**
     * 格式化数字为指定位数，不足位数前面用0补足
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 2    -> 002
     *     // 22   -> 022
     *     // 222  -> 222
     *     // 2222 -> 2222
     *     var str = _u._$number2string(2,3);
     * });
     * ```
     *
     * @method module:base/util._$number2string
     * @param  {Number} arg0 - 数值
     * @param  {Number} arg1 - 位数，至少1位
     * @return {String}        格式化后字符串
     */
    _p._$number2string = function(_number,_limit){
        var _len1 = (''+_number).length,
            _len2 = Math.max(1,parseInt(_limit)||0),
            _delta = _len2-_len1;
        if (_delta>0){
            _number = new Array(_delta+1).join('0')+_number;
        }
        return ''+_number;
    };
    /**
     * 安全删除属性，
     * 部分浏览器（如低版本IE）禁止直接delete节点上的属性
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 节点上保存的数据
     *     _node.data = {a:'aaaaa',b:'bbbbb'};
     *     _node.test = 'aaaaa';
     *
     *     // 删除单个属性
     *     _u._$safeDelete(_node,'test');
     *     // 批量删除
     *     _u._$safeDelete(_node,['test','data']);
     * });
     * ```
     *
     * @method module:base/util._$safeDelete
     * @param  {Object}       arg0 - 对象
     * @param  {String|Array} arg1 - 属性
     * @return {Void}
     */
    _p._$safeDelete = function(_object,_name){
        if (!_p._$isArray(_name)){
            try{
                delete _object[_name];
            }catch(e){
                _object[_name] = undefined;
            }
        }else{
            _p._$forEach(
                _name,function(_item){
                    _p._$safeDelete(_object,_item);
                }
            );
        }
    };
    /**
     * 随机一个字符串
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 可能返回"13d1r1dt2"
     *     var seed = _u._$randString(9);
     * });
     * ```
     *
     * @method module:base/util._$randString
     * @param  {String} arg0 - 字符串长度
     * @return {String}        随机字符串
     */
    _p._$randString = (function(){
        var _chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz';
        return function(_length){
            _length = _length||10;
            var _result = [];
            for(var i=0,_rnum;i<_length;++i){
                _rnum = Math.floor(Math.random()*_chars.length);
                _result.push(_chars.charAt(_rnum));
            }
            return _result.join('');
        };
    })();
    /**
     * 随机生成一个给定范围的整数
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 可能返回3
     *     var seed = _u._$randNumber(0,9);
     * });
     * ```
     * 
     * @method module:base/util._$randNumber
     * @see    module:base/util._$randNumberString
     * @param  {Number} arg0 - 小区间，包含
     * @param  {Number} arg1 - 大区间，不包含
     * @return {Number}        随机整数
     */
    _p._$randNumber = function(_min,_max){
        return Math.floor(Math.random()*(_max-_min)+_min);
    };
    /**
     * 随机生成一个全部为数字的字符串
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 可能返回123456789
     *     var seed = _u._$randNumberString(9);
     * });
     * ```
     *
     * @deprecated
     * @method module:base/util._$randNumberString
     * @see    module:base/util._$randNumber
     * @see    module:base/util._$uniqueID
     * @param  {Number} arg0 - 随机字符串的长度[1,30]
     * @return {String}        随机生成的字符串
     */
    _p._$randNumberString = function(_length){
        _length = Math.max(0,Math.min(_length||8,30));
        var _min = Math.pow(10,_length-1),_max = _min*10;
        return _p._$randNumber(_min,_max).toString();
    };
    /**
     * 生成系统中的唯一标识，每次调用均生成一个新的标识
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_p){
     *    // 可能返回123456789
     *    var _id1 = _p._$uniqueID(),
     *        _id2 = _p._$uniqueID();
     *    // _id1 != _id2
     * });
     * ```
     *
     * @method module:base/util._$uniqueID
     * @return {String} 唯一标识
     */
    _p._$uniqueID = (function(){
        var _seed = +new Date;
        return function(){
            return ''+(_seed++);
        };
    })();
    /**
     * 读取上下文中指定名字空间的值
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     var obj = {
     *         a:{
     *             b:{
     *                 c:{
     *                     d:'ddddd'
     *                 }
     *             }
     *         }
     *     };
     *     // 输出 ddddd
     *     var value = _u._$query(obj,'a.b.c.d');
     *     // 输出 undefined
     *     var value = _u._$query(null,'a.b.c.d');
     * });
     * ```
     *
     * @method module:base/util._$query
     * @param  {Object} arg0 - 上下文
     * @param  {String} arg1 - 名字空间
     * @return {Varaible}      查询到的值
     */
    _p._$query = function(_context,_namespace){
        _context = _context||_o;
        var _arr = (_namespace||'').split('.');
        for(var i=0,l=_arr.length;i<l;i++){
            _context = _context[_arr[i]];
            if (!_context) break;
        }
        return _context;
    };
    /**
     * 合并数据，同名属性右侧覆盖左侧，
     * 最后一个如果是函数则用做数据过滤，
     * 第一个参数作为合并数据结果集对象，如果为空则新建对象
     * 
     * 过滤接口输入输出说明
     * 
     * |      | 类型          | 说明 |
     * | :--  | :--      | :-- |
     * | 输入  | Variable | 值 |
     * |      | String   | 键 |
     * | 输出  | Boolean  | 是否过滤 |
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 合并多个数据至obj0中
     *     var obj0 = {a:0,b:1},
     *         obj1 = {a:"a",b:"b",c:"c"},
     *         obj2 = {c:"c",d:"d",e:"f"},
     *         ... ;
     *     var obj = _u._$merge(obj0,obj1,obj2,...);
     *
     *     // 带过滤接口合并
     *     // 阻止a属性的覆盖
     *     var obj = _u._$merge(
     *         obj0,obj1,obj2,...,
     *         function(_value,_key){
     *             return _key=='a';
     *         }
     *     );
     * });
     * ```
     *
     * @method module:base/util._$merge
     * @see    module:base/util._$fetch
     * @param  {Object}   arg0 - 原始对象
     * @param  {Object}   arg1 - 待拷贝对象
     * @param  {Function} arg2 - 过滤接口
     * @return {Object}          拷贝后对象
     */
    _p._$merge = function(){
        var _last = arguments.length-1,
            _filter = arguments[_last];
        // check filter function for last args
        if (_p._$isFunction(_filter)){
            _last -= 1;
        }else{
            _filter = _f;
        }
        // args0 as result
        var _result = arguments[0]||{};
        // merge
        for(var i=1;i<=_last;i++){
            _p._$loop(arguments[i],function(v,k){
                if (!_filter(v,k)){
                    _result[k] = v;
                }
            });
        }
        return _result;
    };
    /**
     * 根据原始对象属性，从目标对象提取非空值
     *
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     var obj0 = {a:0,b:1},
     *         obj1 = {a:"a",b:"b",c:"c"};
     *     // 根据obj0的属性,从obj1拷贝非null属性到obj0中
     *     // 结果是obj0.a = "a",obj.b = "b",没有拷贝c属性;
     *     var obj = _u._$fetch(obj0,obj1);
     * });
     * ```
     *
     * @method module:base/util._$fetch
     * @see    module:base/util._$merge
     * @param  {Object} arg0 - 原始对象
     * @param  {Object} arg1 - 目标对象
     * @return {Object}        合并后的对象
     */
    _p._$fetch = function(_object,_config){
        if (!!_config){
            _p._$loop(_object,function(v,k,m){
                var _value = _config[k];
                if (_value!=null){
                    m[k] = _value;
                }
            });
        }
        return _object;
    };
    /**
     * 判断对象自生是否包含元素
     * 
     * ```javascript
     * NEJ.define([
     *     'base/util'
     * ],function(_u){
     *     // 判断空对象是否有属性
     *     // 输出 false
     *     var has = _u._$hasProperty({});
     *       
     *     // 判断非空对象是否有属性
     *     // 输出 true
     *     var has = _u._$hasProperty({a:'a',b:'b',c:'c'});
     *       
     *     // 判断空数组是否有属性
     *     // 输出 false
     *     var has = _u._$hasProperty([]);
     *       
     *     // 判断非空数组是否有属性
     *     // 输出 true
     *     var has = _u._$hasProperty([1,2,3]);
     * });
     * ```
     * 
     * @method module:base/util._$hasProperty
     * @param  {Object|Array} arg0 - 对象
     * @return {Boolean}             是否有元素
     */
    _p._$hasProperty = function(_obj){
        // for null
        if (!_obj){
            return !1;
        }
        // for object with length
        if (_obj.length!=null){
            return _obj.length>0;
        }
        // for object
        var _length = 0;
        _p._$loop(_obj,function(){
            _length++;
            return _length>0;
        });
        return _length>0;
    };
    
    if (CMPT){
        NEJ.Q  = _p._$query;
        NEJ.X  = _p._$merge;
        NEJ.EX = _p._$fetch;
        NEJ.copy(this.NEJ,NEJ);
        NEJ.copy(NEJ.P('nej.u'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','dacfbf80adcc9bde61028b172ff33754');
I$('e5566d530448c8e5562fe3839d18a3dd',function (NEJ,_u,_p,_o,_f,_r){
    var _cache = {};
    /*
     * URL地址转源信息
     * http://a.b.com:8080/a/bc/ -> http://a.b.com:8080
     * @param  {String} URL地址
     * @return {String} 源信息
     */
    _p.__url2host = (function(){
        var _reg = /^([\w]+?:\/\/.*?(?=\/|$))/i;
        return function(_url){
            _url = _url||'';
            if (_reg.test(_url))
                return RegExp.$1;
            return location.protocol+'//'+location.host;
        };
    })();
    /**
     * 设置NEJ配置信息
     * @param  {String}   配置标识
     * @param  {Variable} 配置信息
     * @return {Void}
     */
    _p.__set = function(_key,_value){
        _cache[_key] = _value;
    };
    /**
     * 获取NEJ配置信息
     * @param  {String}   配置标识
     * @return {Variable} 配置信息
     */
    _p.__get = function(_key){
        return _cache[_key];
    };

    // init
    /*
     * 初始化配置信息
     * @param  {Object} 配置信息
     * @return {Void}
     */
    var _doInit = (function(){
        var _conf = {
            'portrait':{name:'portrait',dft:'portrait/'},
            'ajax.swf':{name:'ajax',dft:'nej_proxy_flash.swf'},
            'chart.swf':{name:'chart',dft:'nej_flex_chart.swf'},
            'audio.swf':{name:'audio',dft:'nej_player_audio.swf'},
            'video.swf':{name:'video',dft:'nej_player_video.swf'},
            'clipboard.swf':{name:'clipboard',dft:'nej_clipboard.swf'},
            'upload.image.swf':{name:'uploadimage',dft:'nej_upload_image.swf'}
        };
        var _doInitProxy = function(_list){
            var _map = {};
            if (!_list||!_list.length){
                return _map;
            }
            for(var i=0,l=_list.length,_path;i<l;i++){
                _path = _list[i];
                if (_path.indexOf('://')>0)
                    _map[_p.__url2host(_path)] = _path;
            }
            return _map;
        };
        return function(_config){
            // check path config
            _p.__set('root',_config.root||'/res/');
            var _root = _p.__get('root');
            _u._$loop(_conf,function(v,k,m){
                _p.__set(k,_config[v.name]||(_root+v.dft));
            });
            // csrf config
            var _csrf = _config.p_csrf;
            if (_csrf===!0){
                _csrf = {
                    cookie:'AntiCSRF',
                    param:'AntiCSRF'
                };
            }
            _csrf = _csrf || _o;
            _p.__set('csrf',{
                param:_csrf.param||'',
                cookie:_csrf.cookie||''
            });
            // ajax by frame proxy
            _p.__set('frames',_doInitProxy(_config.p_frame));
            // ajax by flash proxy
            _p.__set('flashs',_doInitProxy(_config.p_flash));
        };
    })();
    _doInit(this.NEJ_CONF||_o);

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a');
I$('1ea245eaef820b41b4aaf74fa2d59837',function(_h,_m,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'){I$(23,function (){
        _h.__set(
            'storage.swf',
            (this.NEJ_CONF||_o).storage||
            (_h.__get('root')+'nej_storage.swf')
        );
    });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='3.0'){I$(24,function (){
        _h.__set(
            'blank.png',
            (this.NEJ_CONF||_o).blank||
            (_h.__get('root')+'nej_blank.gif')
        );
    });}return _h;},'e5566d530448c8e5562fe3839d18a3dd','345f1460138e362bb33cc48ffc7cd12b');
I$('75482afbe8186c6aea54c5752fc62e9f',function (NEJ,_h,_p,_o,_f,_r){
    /**
     * 取Frame跨域Ajax代理文件，通过NEJ_CONF的p_frame配置给定域名的代理文件地址
     *
     * @method module:base/config._$getFrameProxy
     * @see    module:base/config._$get
     * @param  {String} arg0 - 请求地址或者域名
     * @return {String}        代理文件地址
     */
    _p._$getFrameProxy = function(_url){
        var _host = _h.__url2host(_url);
        return _p._$get('frames')[_host]||
              (_host+'/res/nej_proxy_frame.html');
    };
    /**
     * 取Flash跨域Ajax配置文件，通过NEJ_CONF的p_flash配置给定域名的代理文件地址
     *
     * @method module:base/config._$getFlashProxy
     * @see    module:base/config._$get
     * @param  {String} arg0 - 请求地址或者域名
     * @return {String}        代理文件地址
     */
    _p._$getFlashProxy = function(_url){
        return _p._$get('flashs')[_h.__url2host(_url)];
    };
    /**
     * 获取NEJ配置信息，通过NEJ_CONF配置相关信息
     *
     * ```javascript
     *  window.NEJ_CONF = {
     *      // resource root
     *      // defalut value -> '/res/'
     *      root : '/nej/'
     *      // blank image for ie6-ie7
     *      // default value -> $root+'nej_blank.gif'
     *      blank : '/res/nej_blank.gif'
     *      // localstorage flash
     *      // default value -> $root+'nej_storage.swf'
     *      storage : '/res/nej_storage.swf'
     *      // audio player flash
     *      // default value -> $root+'nej_player_audio.swf'
     *      audio : '/res/nej_player_audio.swf'
     *      // video player flash
     *      // default value -> $root+'nej_player_video.swf'
     *      video : '/res/nej_player_video.swf'
     *      // clipboard flash
     *      // default value -> $root+'nej_clipboard.swf'
     *      clipboard : '/res/nej_clipboard.swf'
     *      // https request proxy
     *      // default value -> $root+'nej_proxy_flash.swf'
     *      ajax : '/res/nej_proxy_flash.swf'
     *      // portrait root
     *      // default value -> $root+'portrait/'
     *      portrait : '/res/portrait/'
     *      // cross domain xhr request for ie6-ie9
     *      // if path not start with http[s]://
     *      // will use /res/nej_proxy_frame.html as default
     *      p_frame:['http://c.d.com/html/nej_proxy_frame.html']
     *      // flash crossdomain.xml file path
     *      // default value -> http://a.b.com/crossdomain.xml
     *      p_flash:['http://a.b.com/proxy/crossdomain.xml']
     *      // CSRF cookie name and parameter name
     *      // set p_csrf:true to use URS config {cookie:'AntiCSRF',param:'AntiCSRF'}
     *      // default value -> {cookie:'',param:''}
     *      p_csrf:{cookie:'AntiCSRF',param:'AntiCSRF'}
     *  };
     * ```
     *
     * 配置标识支持
     *
     * | 标识                          | 说明 |
     * | :--              | :-- |
     * | portrait         | 表情根路径 |
     * | blank.png        | 空白图片文件地址 |
     * | ajax.swf         | Ajax代理Flash文件地址 |
     * | chart.swf        | 图标Flash文件地址 |
     * | audio.swf        | 实现Audio功能的Flash文件地址 |
     * | video.swf        | 实现Video功能的Flash文件地址 |
     * | clipboard.swf    | 实现剪切板功能的Flash文件地址 |
     * | upload.image.swf | 实现图片上传功能的Flash文件地址 |
     * | storage.swf      | 实现本地存储功能的Flash文件地址 |
     *
     * @method module:base/config._$get
     * @param  {String}   arg0 - 配置标识
     * @return {Variable}        配置信息
     */
    _p._$get = function(_key){
        return _h.__get(_key);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.c'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','1ea245eaef820b41b4aaf74fa2d59837');
I$('036fce036df53014afe007bfc84b3324',function (NEJ,_c,_p,_o,_f,_r){
    var _seed = +new Date;
    /**
     * 找不到指定内容的错误码
     *
     * @const {Number} module:base/constant._$CODE_NOTFUND
     */
    _p._$CODE_NOTFUND = 10000-_seed;
    /**
     * 需要指定的参数未指定的错误码
     *
     * @const {Number} module:base/constant._$CODE_NOTASGN
     */
    _p._$CODE_NOTASGN = 10001-_seed;
    /**
     * 不支持操作的错误码
     *
     * @const {Number} module:base/constant._$CODE_NOTSPOT
     */
    _p._$CODE_NOTSPOT = 10002-_seed;
    /**
     * 操作超时的错误码
     *
     * @const {Number} module:base/constant._$CODE_TIMEOUT
     */
    _p._$CODE_TIMEOUT = 10003-_seed;
    /**
     * 字符串作为脚本执行异常的错误码
     *
     * @const {Number} module:base/constant._$CODE_ERREVAL
     */
    _p._$CODE_ERREVAL = 10004-_seed;
    /**
     * 回调执行异常的错误码
     *
     * @const {Number} module:base/constant._$CODE_ERRCABK
     */
    _p._$CODE_ERRCABK = 10005-_seed;
    /**
     * 服务器返回异常的错误码
     *
     * @const {Number} module:base/constant._$CODE_ERRSERV
     */
    _p._$CODE_ERRSERV = 10006-_seed;
    /**
     * 异常终止的错误码
     *
     * @const {Number} module:base/constant._$CODE_ERRABRT
     */
    _p._$CODE_ERRABRT = 10007-_seed;
    /**
     * 请求头content-type统一名称
     *
     * @const {Number} module:base/constant._$HEAD_CT
     */
    _p._$HEAD_CT      = 'Content-Type';
    /**
     * 文本请求头content-type值
     *
     * @const {String} module:base/constant._$HEAD_CT_PLAN
     */
    _p._$HEAD_CT_PLAN = 'text/plain';
    /**
     * 文件请求头content-type值
     *
     * @const {String} module:base/constant._$HEAD_CT_FILE
     */
    _p._$HEAD_CT_FILE = 'multipart/form-data';
    /**
     * 表单请求头content-type值
     *
     * @const {String} module:base/constant._$HEAD_CT_FORM
     */
    _p._$HEAD_CT_FORM = 'application/x-www-form-urlencoded';
    /**
     * 空图片BASE64编码地址，低版本浏览器使用图片地址
     *
     * @const {String} module:base/constant._$BLANK_IMAGE
     */
    _p._$BLANK_IMAGE  = _c._$get('blank.png')||'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';

    if (CMPT){
        NEJ.copy(NEJ.P('nej.g'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','75482afbe8186c6aea54c5752fc62e9f');
I$('cefc834b106876d285d05b428248ca57',function (_u,_p){
    var _cache = {};
    /**
     * 添加可链式调用的接口
     *
     * 添加可链式接口
     * ```javascript
     * NEJ.define([
     *     'base/chain'
     * ],function(_l){
     *     var _map = {};
     *
     *      _map._$api1 = function(){
     *          // TODO
     *      }
     *      
     *      _map._$api2 = function(){
     *          // TODO
     *      }
     * 
     *     _l._$merge(_map);
     * });
     * ```
     *
     * 使用链式调用接口
     * ```javascript
     * NEJ.define([
     *     '/path/to/api.js',
     *     'util/chain/chainable'
     * ],function(_x,$){
     *     // 使用链式调用api
     *     $('body > p')._$api1()._$api2();
     * });
     * ```
     * 
     * @method module:base/chain._$merge
     * @param  {Object} arg0 - 接口集合
     * @return {Void}
     */
    _p._$merge = function(_map){
        _u._$merge(_cache,_map);
    };
    /**
     * 导出链式接口列表
     * 
     * @method module:base/chain._$dump
     * @return {Object} 链式接口列表
     */
    _p._$dump = function(){
        return _cache;
    };
    /**
     * 清除链式列表
     * 
     * @method module:base/chain._$clear
     * @return {Void}
     */
    _p._$clear = function(){
        _cache = {};
    };
    
    return _p;
},'3ff9c25bd81a3c2a260c28122918263a');
I$('a328ba58350a85c135d650ba43e7880d',function (_u,_m,_p,_o,_f,_r){
    /**
     * 验证事件信息
     * @param  {Node}     节点
     * @param  {String}   事件类型
     * @param  {Function} 处理函数
     * @return {Object}   验证后事件信息 type/handler
     */
    _p.__checkEvent = (function(){
            // need change event name
        var _tmap = {
                touchstart:'mousedown',
                touchmove:'mousemove',
                touchend:'mouseup'
            },
            // need prefix
            _pfix = _m._$KERNEL.prefix,
            _emap = {
                transitionend:'TransitionEnd',
                animationend:'AnimationEnd',
                animationstart:'AnimationStart',
                animationiteration:'AnimationIteration',
                visibilitychange:'visibilitychange',
                fullscreenchange:'fullscreenchange'
            };
        var _fmap = {
            enter:function(_element,_type,_handler){
                var _result = {
                    type:'keypress'
                };
                if (!!_handler){
                    _result.handler = function(_event){
                        if (_event.keyCode===13){
                            _handler.call(_element,_event);
                        }
                    };
                }
                return _result;
            }
        };
        var _doPrefix = function(_name){
            return (_pfix.evt||_pfix.pro)+_name;
        };
        return function(_element,_type,_handler){
            var _result = {
                type:_type,
                handler:_handler
            };
            if (!(('on'+_type) in _element)){
                // check name convert
                var _name = _tmap[_type];
                if (!!_name){
                    _result.type = _name;
                    return _result;
                }
                // check prefix complete
                var _name = _emap[_type];
                if (!!_name){
                    _result.type = _doPrefix(_name);
                    return _result;
                }
                // check event update
                var _func = _fmap[_type];
                if (!!_func){
                    return _func.apply(null,arguments);
                }
            }
            return _result;
        };
    })();
    /**
     * 添加事件
     * @param  {Node}     节点
     * @param  {String}   事件
     * @param  {Function} 处理函数
     * @param  {Boolean}  是否捕捉阶段
     * @return {Void}
     */
    _p.__addEvent = function(){
        var _args = arguments;
        if (DEBUG){
            if (!(('on'+_args[1]) in _args[0])){
                console.log('not support event['+_args[1]+'] for '+_args[0]);
            }
        }
        _args[0].addEventListener(
            _args[1],_args[2],_args[3]
        );
    };
    /**
     * 删除事件
     * @param  {Node}     节点
     * @param  {String}   事件
     * @param  {Function} 处理函数
     * @param  {Boolean}  是否捕捉阶段
     * @return {Void}
     */
    _p.__delEvent = function(){
        var _args = arguments;
        _args[0].removeEventListener(
            _args[1],_args[2],_args[3]
        );
    };
    /**
     * 触发对象的某个事件
     * @param  {String|Node} 节点ID或者对象
     * @param  {String}      鼠标事件类型
     * @return {Void}
     */
    _p.__dispatchEvent = function(_element,_type,_options){
        var _event = document.createEvent('Event');
        _event.initEvent(_type,!0,!0);
        _u._$merge(_event,_options);
        _element.dispatchEvent(_event);
    };
    
    return _p;
},'3ff9c25bd81a3c2a260c28122918263a','345f1460138e362bb33cc48ffc7cd12b');
I$('e97e4477bc9b221cd35fbd26921e3a1f',function(b1490930293613,_h,_u,_p,_o,_f,_r){if (b1490930293613._$KERNEL.engine==='trident'&&b1490930293613._$KERNEL.release>='6.0'){I$(9,function (){
        /**
         * 验证事件信息
         * @param  {Node}     节点
         * @param  {String}   事件类型
         * @param  {Function} 处理函数
         * @return {Object}   验证后事件信��? type/handler
         */
        _h.__checkEvent = (function(){
            var _emap = {
                touchcancel:'MSPointerCancel',
                touchstart:'MSPointerDown',
                touchmove:'MSPointerMove',
                touchend:'MSPointerUp',
                fullscreenchange:'MSFullscreenChange'
            };
            return _h.__checkEvent._$aop(function(_event){
                var _args = _event.args;
                // check event convert
                var _name = _emap[_args[1]];
                if (!!_name){
                    _event.stopped = !0;
                    _event.value = {
                        type:_name,
                        handler:_args[2]
                    };
                }
            });
        })();
    });}
if (b1490930293613._$KERNEL.engine==='trident'&&b1490930293613._$KERNEL.release=='5.0'){I$(10,function (){
        /**
         * 验证事件信息
         * @param  {Node}     节点
         * @param  {String}   事件类型
         * @param  {Function} 处理函数
         * @return {Object}   验证后事件信��? type/handler
         */
        _h.__checkEvent = (function(){
            var _vmap = {};
            var _fmap = {
                input:function(_element,_type,_handler){
                    // for check type only
                    if (!_handler){
                        return {type:_type};
                    }
                    // fix input backspace/delete/ctrl+x bug
                    return {
                        type:_type,
                        handler:function(_event){
                            var _id = _element.id;
                            _vmap[_id] = _element.value;
                            _handler.call(_element,_event);
                        },
                        link:[[
                            document,'selectionchange',
                            function(_event){
                                var _id = _element.id;
                                if (_element!=document.activeElement){
                                    delete _vmap[_id];
                                    return;
                                }
                                if (_vmap[_id]!==_element.value){
                                    _vmap[_id] = _element.value;
                                    _handler.call(_element,_event);
                                }
                            }
                        ]]
                    };
                }
            };
            return _h.__checkEvent._$aop(function(_event){
                var _args = _event.args;
                // check event update
                var _func = _fmap[_args[1]];
                if (!!_func){
                    _event.stopped = !0;
                    _event.value = _func.apply(null,_args);
                }
            });
        })();
    });}
if (b1490930293613._$KERNEL.engine==='trident'&&b1490930293613._$KERNEL.release>='5.0'){I$(11,function (){
        // must use attach/detach for event
        var _attached = {
            'propertychange':1
        };
        /**
         * 添加事件
         * @param  {Node}     节点
         * @param  {String}   事件
         * @param  {Function} 处理函数
         * @param  {Boolean}  是否捕捉阶段
         * @return {Void}
         */
        _h.__addEvent = 
        _h.__addEvent._$aop(function(_event){
            var _args = _event.args;
            if (_attached[_args[1]]!=null&&!!_args[0].attachEvent){
                _event.stopped = !0;
                _args[0].attachEvent('on'+_args[1],_args[2]);
            }
        });
        /**
         * 删除事件
         * @param  {Node}     节点
         * @param  {String}   事件
         * @param  {Function} 处理函数
         * @param  {Boolean}  是否捕捉阶段
         * @return {Void}
         */
        _h.__delEvent = 
        _h.__delEvent._$aop(function(_event){
            var _args = _event.args,
                _alias = _attached[_args[1]];
            if (_attached[_args[1]]!=null&&!!_args[0].detachEvent){
                _event.stopped = !0;
                _args[0].detachEvent('on'+_args[1],_args[2]);
            }
        });
    });}
if (b1490930293613._$KERNEL.engine==='trident'&&b1490930293613._$KERNEL.release<='4.0'){I$(12,function (){
        /**
         * 验证事件信息
         * @param  {Node}     节点
         * @param  {String}   事件类型
         * @param  {Function} 处理函数
         * @return {Object}   验证后事件信��? type/handler
         */
        _h.__checkEvent = (function(){
            var _lmap = {};
            var _fmap = {
                input:function(_element,_type,_handler){
                    var _result = {
                        type:'propertychange'
                    };
                    if (!!_handler){
                        var _id = _element.id;
                        var _hack = function(_event){
                            if (!!_element.value&&!_lmap['x-'+_id]){
                                _lmap['x-'+_id] = !0;
                                _handler.call(_element,_event);
                            }
                        };
                        _result.handler = function(_event){
                            // for input.value or textarea.value
                            if (('value' in _element)&&
                                _event.propertyName=='value'){
                                // lock cycle trigger
                                if (!!_lmap[_id]){
                                    return;
                                }
                                _lmap[_id] = !0;
                                _handler.call(_element,_event);
                                delete _lmap[_id];
                            }
                        };
                        _result.link = [
                            [_element,'keyup',_hack],
                            [_element,'mouseup',_hack],
                            [_element,'mousemove',_hack]
                        ];
                        _result.destroy = function(){
                            delete _lmap[_id];
                            delete _lmap['x-'+_id];
                        };
                    }
                    return _result;
                },
                load:function(_element,_type,_handler){
                    var _result = {
                        type:'readystatechange'
                    };
                    if (!!_handler){
                        _result.handler = function(_event){
                            if (_element.readyState=='loaded'||
                                _element.readyState=='complete'){
                                _handler.call(_element,_event);
                            }
                        };
                    }
                    return _result;
                }
            };
            return _h.__checkEvent._$aop(function(_event){
                var _args = _event.args;
                // check event update
                var _func = _fmap[_args[1]];
                if (!!_func){
                    _event.stopped = !0;
                    _event.value = _func.apply(null,_args);
                }
                // use element for this in handler
                if (!!_args[2]){
                    _args[2] = _args[2]._$bind(_args[0]);
                }
            });
        })();
        /**
         * 添加事件
         * @param  {Node}     节点
         * @param  {String}   事件
         * @param  {Function} 处理函数
         * @param  {Boolean}  是否捕捉阶段
         * @return {Void}
         */
        _h.__addEvent = function(){
            var _args = arguments;
            if (DEBUG){
                if (!(('on'+_args[1]) in _args[0])){
                    console.log('not support event['+_args[1]+'] for '+_args[0]);
                }
            }
            _args[0].attachEvent('on'+_args[1],_args[2]);
        };
        /**
         * 删除事件
         * @param  {Node}     节点
         * @param  {String}   事件
         * @param  {Function} 处理函数
         * @param  {Boolean}  是否捕捉阶段
         * @return {Void}
         */
        _h.__delEvent = function(){
            var _args = arguments;
            _args[0].detachEvent('on'+_args[1],_args[2]);
        };
        /**
         * 触发对象的某个事��?
         * @param  {String|Node} 节点ID或�?�对��?
         * @param  {String}      鼠标事件类型
         * @return {Void}
         */
        _h.__dispatchEvent = (function(){
            var _omap = {
                propertychange:{propertyName:'value'}
            };
            return function(_element,_type,_options){
                var _event = document.createEventObject();
                try{
                    _u._$merge(_event,_omap[_type],_options);
                    _element.fireEvent('on'+_type,_event);
                }catch(ex){
                    // ignore unrecognized event name
                    console.error(ex.message);
                    console.error(ex.stack);
                }
            };
        })();
    });}
if (b1490930293613._$KERNEL.engine==='gecko'){I$(13,function (){
        /**
         * 验证事件信息
         * @param  {Node}     节点
         * @param  {String}   事件类型
         * @param  {Function} 处理函数
         * @return {Object}   验证后事件信��? type/handler
         */
        _h.__checkEvent = (function(){
            var _nreg = /^(?:transitionend|animationend|animationstart|animationiteration)$/i;
            var _fmap = {
                mousewheel:function(_element,_type,_handler){
                    var _result = {
                        type:'MozMousePixelScroll'
                    };
                    if (!!_handler){
                        _result.handler = function(_event){
                            var _delta = _event.detail;
                            _event.wheelDelta = -_delta;
                            _event.wheelDeltaY = -_delta;
                            _event.wheelDeltaX = 0;
                            _handler.call(_element,_event);
                        };
                    }
                    return _result;
                }
            };
            return _h.__checkEvent._$aop(function(_event){
                var _args = _event.args;
                // check animation event
                if (_nreg.test(_args[1])){
                    _event.stopped = !0;
                    _event.value = {
                        type:_args[1],
                        handler:_args[2]
                    };
                }
                // check event update
                var _func = _fmap[_args[1]];
                if (!!_func){
                    _event.stopped = !0;
                    _event.value = _func.apply(null,_args);
                }
            });
        })();
    });}return _h;},'345f1460138e362bb33cc48ffc7cd12b','a328ba58350a85c135d650ba43e7880d','3ff9c25bd81a3c2a260c28122918263a');
I$('b9845e13e284410cb0bb909f737020e4',function (NEJ,_e,_u,_x,_h,_p,_o,_f,_r){
    // {id:{type:[{type:'click',func:function,sfun:function,capt:true},...]}}
    // id   - element id
    // type - event name, no on prefix
    // func - event after wrapper
    // capt - capture flag
    // sfun - event before wrapper
    // link - events link to this event [[element,type,handler,capture],...]
    var _xcache = {},
        _y = {}; // chainable methods
    /*
     * 取事件类型列表
     * @param  {String} 事件类型
     * @return {Array}  事件列表
     */
    var _getTypeList = (function(){
        var _reg = /[\s,;]+/;
        return function(_type){
            var _type = (_type||'').trim().toLowerCase();
            return !_type?null:_type.split(_reg);
        };
    })();
    /*
     * 取鼠标相对于BODY的偏移
     * @param  {Event}  事件对象
     * @param  {String} 类型，X/Y
     * @param  {String} 滚动偏移名称，Left/Top
     * @return {Void}
     */
    var _getClientOffset = function(_event,_type,_name){
        var _key1 = 'page'+_type;
        return _event[_key1]!=null?_event[_key1]:(
            _event['client'+_type]+
            _e._$getPageBox()['scroll'+_name]
        );
    };
    /*
     * 取鼠标相对于页面的偏移
     * @param  {Event}  事件对象
     * @param  {String} 类型，X/Y
     * @param  {String} 滚动偏移名称，Left/Top
     * @return {Void}
     */
    var _getPageOffset = function(_event,_type,_name){
        var _key3 = 'scroll'+_name;
            _node = _p._$getElement(_event),
            _xret = _getClientOffset(_event,_type,_name);
        while(!!_node&&
                _node!=document.body&&
                _node!=document.documentElement){
            _xret += _node[_key3]||0;
            _node = _node.parentNode;
        }
        return _xret;
    };
    /*
     * 格式化添加删除事件接口参数
     * @param  {String|Node} 节点ID或者对象
     * @param  {String}      事件类型，不带on前缀，不区分大小写，多个事件用空格分隔
     * @param  {Function}    事件处理函数
     * @param  {Boolean}     是否捕获阶段事件，IE低版本浏览器忽略此参数
     * return  {Object}      格式化后参数
     */
    var _doFormatArgs = function(_element,_type,_handler,_capture){
        var _result = {};
        // check element
        _element = _e._$get(_element);
        if (!_element){
            return null;
        }
        _e._$id(_element);
        _result.element = _element;
        // check event handler
        if (!_u._$isFunction(_handler)){
            return null;
        }
        _result.handler = _handler;
        // check type
        var _type = _getTypeList(_type);
        if (!_type){
            return null;
        }
        // save info
        _result.type = _type;
        _result.capture = !!_capture;
        return _result;
    };
    /**
     * 节点添加事件，
     * 支持添加自定义事件，
     * 对于自定义事件的实现逻辑由其他模块负责实现
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // 添加系统预定义事件
     *       _v._$addEvent(
     *           'abc','mouseover',function(_event){
     *               // TODO something
     *           },false
     *       );
     *
     *       // 添加自定义事件，回车事件
     *       _v._$addEvent(
     *           'abc','enter',function(_event){
     *               // TODO something
     *           },false
     *       );
     *
     *       // 添加多个事件，用空格分隔
     *       _v._$addEvent(
     *           'abc','mouseover click mousedown',
     *           function(_event){
     *               // TODO something
     *           },false
     *       );
     *   });
     * ```
     *
     * 带自定义事件的类构造或者对象
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'base/event',
     *     'util/event',
     *     'util/event/event'
     * ],function(_k,_v,_t0,_t1,_p){
     *     // 定义类
     *     _p._$$Klass = _k._$klass();
     *     var _pro = _p._$$Klass._$extend(_t0._$$EventTarget);
     *     
     *     // TODO
     *     
     *     // 添加自定义事件支持
     *     // 对节点的事件同样支持此自定义事件
     *     _t1._$$CustomEvent._$allocate({
     *         element:_p._$$Klass,
     *         event:['ok','fail']
     *     });
     * 
     *     // 使用事件接口添加/删除/调度事件
     *     var _handler = function(_event){
     *         // TODO
     *     };
     *     _v._$addEvent(_p._$$Klass,'ok',_handler);
     *     _v._$delEvent(_p._$$Klass,'ok',_handler);
     * });
     * ```
     * 
     * @method module:base/event._$addEvent
     * @see    module:base/event._$delEvent
     * @param  {String|Node|Object} arg0 - 节点或者类构造或者对象
     * @param  {String}      arg1 - 事件类型，不带on前缀，不区分大小写，多个事件用空格分隔
     * @param  {Function}    arg2 - 事件处理函数
     * @param  {Boolean}     arg3 - 是否捕获阶段事件，IE低版本浏览器忽略此参数
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$addEvent
     * @see module:base/event._$addEvent
     */
    _p._$addEvent = 
    _y._$addEvent = (function(){
        // cache event
        // type/handler/link
        var _doCacheEvent = function(_type,_source,_real){
            var _id = _e._$id(_source.element),
                _cch_id = _xcache[_id]||{},
                _cch_tp = _cch_id[_type]||[];
            _cch_tp.push({
                type:_real.type||_type,
                func:_real.handler||_source.handler,
                sfun:_source.handler,
                capt:_source.capture,
                link:_real.link,
                destroy:_real.destroy
            });
            _cch_id[_type] = _cch_tp;
            _xcache[_id] = _cch_id;
        };
        return function(){
            var _args = _doFormatArgs.apply(null,arguments);
            if (!_args) return;
            _u._$forEach(
                _args.type,function(_name){
                    var _argc = _h.__checkEvent(
                        _args.element,
                        _name,_args.handler
                    );
                    // add event
                    _h.__addEvent(
                        _args.element,_argc.type,
                        _argc.handler,_args.capture
                    );
                    // add event link
                    _u._$forIn(
                        _argc.link,function(_item){
                            _item[3] = !!_item[3];
                            _h.__addEvent.apply(_h,_item);
                            _item[0] = _e._$id(_item[0]);
                        }
                    );
                    // cache event
                    _doCacheEvent(_name,_args,_argc);
                }
            );
        };
    })();
    /**
     * 节点删除事件，输入参数必须保证与添加接口_$addEvent输入参数完全一致
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // 事件回调业务逻辑
     *       var _doCallback = function(_event){
     *           // TODO something
     *           alert('0');
     *       };
     *
     *       // 添加事件
     *       _v._$addEvent('abc','mouseover',_doCallback,false);
     *       // 删除事件，这里参数必须保持完全一致
     *       _v._$delEvent('abc','mouseover',_doCallback,false);
     *
     *       // 比如以下方式虽然回调的业务逻辑一致，但是无法删除之前添加的事件
     *       _v._$delEvent(
     *           'abc',"mouseover",function(_event){
     *               // TODO something
     *               alert('0');
     *           },false
     *       );
     *
     *       // 删除多个事件
     *       _v._$delEvent(
     *           'abc','mouseover click mouseup',
     *           _doCallback,false
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$delEvent
     * @see    module:base/event._$addEvent
     * @param  {String|Node} arg0 - 节点ID或者对象
     * @param  {String}      arg1 - 事件类型，不带on前缀，不区分大小写，多个事件用空格分隔
     * @param  {Function}    arg2 - 事件处理函数
     * @param  {Boolean}     arg3 - 是否捕获阶段事件
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$delEvent
     * @see module:base/event._$delEvent
     */
    _p._$delEvent = 
    _y._$delEvent = (function(){
        var _unCacheEvent = function(_type,_conf){
            var _id = _e._$id(_conf.element),
                _cch_id = _xcache[_id]||_o,
                _cch_tp = _cch_id[_type],
                _index = _u._$indexOf(
                    _cch_tp,function(_item){
                        // check handler and capture
                        return _item.sfun===_conf.handler&&
                               _item.capt===_conf.capture;
                    }
                );
            // check result
            var _result = null;
            if (_index>=0){
                var _item = _cch_tp.splice(_index,1)[0];
                _result = [[
                    _conf.element,_item.type,
                    _item.func,_conf.capture
                ]];
                if (!!_item.link){
                    // complete element by id
                    _u._$forEach(_item.link,function(v){
                        v[0] = _e._$get(v[0]);
                    });
                    _result.push.apply(_result,_item.link);
                }
                if (!!_item.destroy){
                    _item.destroy();
                }
                // clear cache
                if (!_cch_tp.length){
                    delete _cch_id[_type];
                }
                if (!_u._$hasProperty(_cch_id)){
                    delete _xcache[_id];
                }
            }
            return _result;
        };
        return function(){
            var _args = _doFormatArgs.apply(null,arguments);
            if (!_args) return;
            _u._$forEach(
                _args.type,function(_name){
                    _u._$forEach(
                        _unCacheEvent(_name,_args),
                        function(_item){
                            _h.__delEvent.apply(_h,_item);
                        }
                    );
                }
            );
        };
    })();
    /**
     * 清除节点事件
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // 添加事件
     *       _v._$addEvent(
     *           'abc','mouseover',function(_event){
     *               // TODO something
     *           }
     *       );
     *       _v._$addEvent(
     *           'abc','mouseover',function(_event){
     *               // TODO something
     *           },true
     *       );
     *       _v._$addEvent(
     *           'abc','custom',function(_event){
     *               // TODO something
     *           }
     *       );
     *
     *       // 清除节点所有事件，包括两个mouseover事件和一个custom事件
     *       _v._$clearEvent('abc');
     *
     *       // 清除节点指定类型事件，只清除两个mouseover事件
     *       _v._$clearEvent('abc','mouseover');
     *
     *       // 清除多个事件，用空格分隔
     *       _v._$clearEvent('abc','mouseover custom');
     *   });
     * ```
     *
     * @method module:base/event._$clearEvent
     * @see    module:base/event._$delEvent
     * @param  {String|Node} arg0 - 节点ID或者对象
     * @param  {String}      arg1 - 事件类型，不带on前缀，不区分大小写，多个事件用空格分隔
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$clearEvent
     * @see module:base/event._$clearEvent
     */
    _p._$clearEvent = 
    _y._$clearEvent = (function(){
        var _doClearEvent = function(_id,_name,_list){
            _u._$reverseEach(
                _list,function(_item){
                    _p._$delEvent(
                        _id,_name,_item.sfun,_item.capt
                    );
                }
            );
        };
        return function(_element,_type){
            var _id = _e._$id(_element);
            if (!_id) return;
            var _cch_id = _xcache[_id];
            if (!!_cch_id){
                _type = _getTypeList(_type);
                if (!!_type){
                    // clear event by type
                    _u._$forEach(
                        _type,function(_name){
                            _doClearEvent(_id,_name,_cch_id[_name]);
                        }
                    );
                }else{
                    // clear all event
                    _u._$loop(
                        _cch_id,function(_value,_name){
                            _p._$clearEvent(_element,_name);
                        }
                    );
                }
            }
        };
    })();
    /**
     * è§¦å‘å¯¹è±¡çš„æŸä¸ªäº‹ä»¶ï¼Œæ³¨ï¼šå¯¹äºŽIEæµè§ˆå™¨è¯¥æŽ¥å£èŠ‚ç‚¹äº‹ä»¶æœ‰ä»¥ä¸‹é™åˆ¶
     *
     * * æ•èŽ·é˜¶æ®µæ”¯æŒéœ€è¦æµè§ˆå™¨IE9+
     * * èŠ‚ç‚¹ä¸Šè‡ªå®šä¹‰äº‹ä»¶æ”¯æŒéœ€è¦æµè§ˆå™¨IE9+
     *
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // æ³¨å†Œé¼ æ ‡äº‹ä»¶
     *       _v._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„åž‚ç›´ä½ç½®
     *               var _y = _v._$pageY(_event);
     *           }
     *       );
     *       // è§¦å‘é¼ æ ‡äº‹ä»¶
     *       _v._$dispatchEvent('abc','click');
     *
     *       // æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶
     *       _v._$addEvent(
     *           'abc','ok',function(_event){
     *               // TODO something
     *           }
     *       );
     *       // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
     *       _v._$dispatchEvent('abc','ok');
     *   });
     * ```
     *
     * @method module:base/event._$dispatchEvent
     * @param  {String|Node} arg0 - èŠ‚ç‚¹IDæˆ–è€…å¯¹è±¡
     * @param  {String}      arg1 - é¼ æ ‡äº‹ä»¶ç±»åž‹ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œå¤šä¸ªäº‹ä»¶ç”¨ç©ºæ ¼åˆ†éš”
     * @param  {Object}      arg2 - ä¼ é€’çš„å‚æ•°ä¿¡æ¯
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$dispatchEvent
     * @see module:base/event._$dispatchEvent
     */
    _p._$dispatchEvent = 
    _y._$dispatchEvent = function(_element,_type,_options){
        var _element = _e._$get(_element);
        if (!!_element){
            _u._$forEach(
                _getTypeList(_type),function(_name){
                    var _result = _h.__checkEvent(
                        _element,_name
                    );
                    _h.__dispatchEvent(
                        _element,_result.type,_options
                    );
                }
            );
        }
    };
    /**
     * èŽ·å–è§¦å‘äº‹ä»¶çš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä¼ å…¥è¿‡æ»¤æŽ¥å£æ¥éåŽ†çˆ¶èŠ‚ç‚¹æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="a">
     *     <p>
     *       <span id="b">123</span>
     *       <span link="a">123</span>
     *       <span class="a link">123</span>
     *       <span data-link="a">123</span>
     *       <label>aaaaa</label>
     *     </p>
     *   </div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å–äº‹ä»¶è§¦å‘èŠ‚ç‚¹
     *       _v._$addEvent(
     *           'b','click',function(_event){
     *               // idä¸ºbçš„èŠ‚ç‚¹
     *               var _node = _v._$getElement(_event);
     *               // TODO something
     *           }
     *       );
     *
     *       // äº‹ä»¶è§¦å‘ï¼Œå–idæ˜¯açš„èŠ‚ç‚¹
     *       _v._$addEvent(
     *           'b','click',function(_event){
     *               // idä¸ºaçš„èŠ‚ç‚¹
     *               var _node = _v._$getElement(
     *                   _event,function(_element){
     *                       return _element.id=='a';
     *                   }
     *               );
     *               // TODO something
     *
     *               // classå«linkæˆ–è€…å±žæ€§å«linkæˆ–è€…data-linkçš„èŠ‚ç‚¹
     *               var _node = _v._$getElement(_event,'link');
     *
     *               // ä»…åŒ¹é…classå³ class="link xx xxx"
     *               var _node = _v._$getElement(_event,'c:link');
     *
     *               // ä»…åŒ¹é…datasetå³ data-link="aaaa"
     *               var _node = _v._$getElement(_event,'d:link');
     *
     *               // ä»…åŒ¹é…attributerå³ link="aaa"
     *               var _node = _v._$getElement(_event,'a:link');
     *
     *               // ä»…åŒ¹é…tagå³ <label>
     *               var _node = _v._$getElement(_event,'t:label');
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$getElement
     * @param  {Event}    arg0 - äº‹ä»¶å¯¹è±¡
     * @param  {Function} arg1 - è¿‡æ»¤æŽ¥å£
     * @return {Node}            ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹
     */
    _p._$getElement = function(_event){
        if (!_event) return null;
        var _element = _event.target||
                _event.srcElement,
            _filter = arguments[1];
        return _e._$getParent(_element,_filter);
    };
    /**
     * é˜»æ­¢äº‹ä»¶ï¼ŒåŒ…æ‹¬é»˜è®¤äº‹ä»¶å’Œä¼ é€’äº‹ä»¶
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="a">
     *     <a href="xxx.html" id="b">123</a>
     *   </div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // äº‹ä»¶å›žè°ƒä¸­é˜»æ­¢äº‹ä»¶å†’æ³¡
     *       _v._$addEvent(
     *           'b','click',function(_event){
     *               // é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­
     *               // é˜»æ­¢é“¾æŽ¥æ‰“å¼€çš„é»˜è®¤äº‹ä»¶
     *               _v._$stop(_event);
     *           }
     *       );
     *
     *       // aèŠ‚ç‚¹ä¸Šçš„ç‚¹å‡»äº‹ä»¶ä¸ä¼šè§¦å‘
     *       _v._$addEvent(
     *           'a','click',function(_event){
     *               alert(0);
     *               // TODO something
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$stop
     * @see    module:base/event._$stopBubble
     * @see    module:base/event._$stopDefault
     * @param  {Event} arg0 - è¦é˜»æ­¢çš„äº‹ä»¶å¯¹è±¡
     * @return {Void}
     */
    _p._$stop = function(_event){
        _p._$stopBubble(_event);
        _p._$stopDefault(_event);
    };
    /**
     * é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ä¼ é€’
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="a">
     *     <a href="xxx.html" id="b">123</a>
     *   </div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // äº‹ä»¶å›žè°ƒä¸­é˜»æ­¢äº‹ä»¶å†’æ³¡
     *       _v._$addEvent(
     *           'b','click',function(_event){
     *               // é˜»æ­¢äº‹ä»¶ç»§ç»­ä¼ æ’­
     *               // é“¾æŽ¥ä»ç„¶ä¼šè¢«æ‰“å¼€
     *               _v._$stopBubble(_event);
     *           }
     *       );
     *
     *       // aèŠ‚ç‚¹ä¸Šçš„ç‚¹å‡»äº‹ä»¶ä¸ä¼šè§¦å‘
     *       _v._$addEvent(
     *           'a','click',function(_event){
     *               alert(0);
     *               // TODO something
     *           }
     *       );
     *   });
     * ```
     *
     * @see    module:base/event._$stop}
     * @method module:base/event._$stopBubble
     * @param  {Event} arg0 - è¦é˜»æ­¢çš„äº‹ä»¶å¯¹è±¡
     * @return {Void}
     */
    _p._$stopBubble = function(_event){
        if (!!_event){
            !!_event.stopPropagation
            ? _event.stopPropagation()
            : _event.cancelBubble = !0;
        }
    };
    /**
     * é˜»æ­¢æ ‡ç­¾çš„é»˜è®¤äº‹ä»¶
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="a">
     *     <a href="xxx.html" id="b">123</a>
     *   </div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // äº‹ä»¶å›žè°ƒä¸­é˜»æ­¢é“¾æŽ¥é»˜è®¤äº‹ä»¶
     *       _v._$addEvent(
     *           'b','click',function(_event){
     *               // é˜»æ­¢é“¾æŽ¥æ‰“å¼€é¡µé¢çš„é»˜è®¤è¡Œä¸º
     *               _v._$stopDefault(_event);
     *           }
     *       );
     *
     *       // aèŠ‚ç‚¹ä¸Šçš„ç‚¹å‡»äº‹ä»¶ä»ç„¶ä¼šè§¦å‘
     *       _v._$addEvent(
     *           'a','click',function(_event){
     *               alert(0);
     *               // TODO something
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$stopDefault
     * @see    module:base/event._$stop
     * @param  {Event} arg0 - è¦é˜»æ­¢çš„äº‹ä»¶å¯¹è±¡
     * @return {Void}
     */
    _p._$stopDefault = function(_event) {
        if (!!_event){
            !!_event.preventDefault
            ? _event.preventDefault()
            : _event.returnValue = !1;
        }
    };
    /**
     * å–äº‹ä»¶ç›¸å¯¹äºŽé¡µé¢çš„ä½ç½®
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" style="width:100%;height:100%;">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å›žè°ƒä¸­å–é¼ æ ‡ä½ç½®
     *       _v._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„æ°´å¹³ã€åž‚ç›´ä½ç½®
     *               var _pos = _v._$page(_event);
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$page
     * @see    module:base/event._$pageX
     * @see    module:base/event._$pageY
     * @param  {Event}  arg0 - äº‹ä»¶å¯¹è±¡
     * @return {Object}        ä½ç½®ä¿¡æ¯ï¼Œ{x:10,y:10}
     */
    _p._$page = function(_event){
        return {
            x:_p._$pageX(_event),
            y:_p._$pageY(_event)
        };
    };
    /**
     * å–äº‹ä»¶ç›¸å¯¹äºŽé¡µé¢å·¦ä¾§çš„ä½ç½®ï¼Œç´¯åŠ æ‰€æœ‰å†…éƒ¨æ»šåŠ¨é«˜åº¦
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" style="width:100%;height:100%;">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å›žè°ƒä¸­å–é¼ æ ‡ä½ç½®
     *       _p._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„æ°´å¹³ä½ç½®
     *               var _x = _v._$pageX(_event);
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$pageX
     * @see    module:base/event._$clientX
     * @param  {Event}  arg0 - äº‹ä»¶å¯¹è±¡
     * @return {Number}        æ°´å¹³ä½ç½®
     */
    _p._$pageX = function(_event){
        return _getPageOffset(_event,'X','Left');
    };
    /**
     * å–äº‹ä»¶ç›¸å¯¹äºŽé¡µé¢é¡¶éƒ¨çš„ä½ç½®ï¼Œç´¯åŠ æ‰€æœ‰å†…éƒ¨æ»šåŠ¨é«˜åº¦
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" style="width:100%;height:100%;">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å›žè°ƒä¸­å–é¼ æ ‡ä½ç½®
     *       _v._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„åž‚ç›´ä½ç½®
     *               var _y = _v._$pageY(_event);
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$pageY
     * @see    module:base/event._$clientY
     * @param  {Event}  arg0 - äº‹ä»¶å¯¹è±¡
     * @return {Number}        åž‚ç›´ä½ç½®
     */
    _p._$pageY = function(_event){
        return _getPageOffset(_event,'Y','Top');
    };
    /**
     * å–äº‹ä»¶ç›¸å¯¹äºŽé¡µé¢å·¦ä¾§çš„ä½ç½®ï¼Œä»…ç´¯åŠ é¡µé¢æ»šåŠ¨é«˜åº¦
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" style="width:100%;height:100%;">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å›žè°ƒä¸­å–é¼ æ ‡ä½ç½®
     *       _p._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„æ°´å¹³ä½ç½®
     *               var _x = _v._$clientX(_event);
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$clientX
     * @see    module:base/event._$pageX
     * @param  {Event}  arg0 - äº‹ä»¶å¯¹è±¡
     * @return {Number}        æ°´å¹³ä½ç½®
     */
    _p._$clientX = function(_event){
        return _getClientOffset(_event,'X','Left');
    };
    /**
     * å–äº‹ä»¶ç›¸å¯¹äºŽé¡µé¢é¡¶éƒ¨çš„ä½ç½®ï¼Œä»…ç´¯åŠ é¡µé¢æ»šåŠ¨é«˜åº¦
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" style="width:100%;height:100%;">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/event'
     *   ],function(_v){
     *       // å›žè°ƒä¸­å–é¼ æ ‡ä½ç½®
     *       _v._$addEvent(
     *           'abc','click',function(_event){
     *               // èŽ·å–é¼ æ ‡äº‹ä»¶è§¦å‘çš„åž‚ç›´ä½ç½®
     *               var _y = _v._$pageY(_event);
     *           }
     *       );
     *   });
     * ```
     *
     * @method module:base/event._$clientY
     * @see    module:base/event._$pageY
     * @param  {Event}  arg0 - äº‹ä»¶å¯¹è±¡
     * @return {Number}        åž‚ç›´ä½ç½®
     */
    _p._$clientY = function(_event){
        return _getClientOffset(_event,'Y','Top');
    };
    
    // for chainable method
    _x._$merge(_y);
    
    if (CMPT){
        NEJ.copy(NEJ.P('nej.v'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','cefc834b106876d285d05b428248ca57','e97e4477bc9b221cd35fbd26921e3a1f');
I$('88601ab3a43974f10f7457b7e4b16c1a',function (_u,_m,_p,_o,_f,_r){
    /**
     * ä»ŽDocumentFragmentä¸­å–æŒ‡å®šIDçš„èŠ‚ç‚¹
     * @param  {Document} æ–‡æ¡£å¯¹è±¡
     * @param  {String}   èŠ‚ç‚¹æ ‡è¯†
     * @return {Node}     æŒ‡å®šæ ‡è¯†çš„èŠ‚ç‚¹
     */
    _p.__getElementById = function(_fragment,_id){
        if (!!_fragment.getElementById){
            return _fragment.getElementById(''+_id);
        }
        try{
            return _fragment.querySelector('#'+_id);
        }catch(e){
            return null;
        }
    };
    /**
     * å–èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨
     * @param  {Node}  èŠ‚ç‚¹IDæˆ–è€…å¯¹è±¡
     * @return {Array} å­èŠ‚ç‚¹åˆ—è¡¨
     */
    _p.__getChildren = function(_element){
        return _u._$object2array(_element.children);
    };
    /**
     * æ ¹æ®ç±»åå–èŠ‚ç‚¹åˆ—è¡¨
     * @param  {Node}   èŠ‚ç‚¹IDæˆ–è€…å¯¹è±¡
     * @param  {String} ç±»å
     * @return {Array}  èŠ‚ç‚¹åˆ—è¡¨
     */
    _p.__getElementsByClassName = function(_element,_class){
        return _u._$object2array(_element.getElementsByClassName(_class));
    };
    /**
     * å–ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹
     * @param  {Node}  èŠ‚ç‚¹å¯¹è±¡
     * @return {Node}  èŠ‚ç‚¹
     */
    _p.__nextSibling = function(_element){
        return _element.nextElementSibling;
    };
    /**
     * å–ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹
     * @param  {Node}  èŠ‚ç‚¹å¯¹è±¡
     * @return {Node}  èŠ‚ç‚¹
     */
    _p.__previousSibling = function(_element){
        return _element.previousElementSibling;
    };
    /**
     * è®¾ç½®ã€èŽ·å–æ•°æ®
     * @param {Node}     èŠ‚ç‚¹
     * @param {String}   æ ‡è¯†
     * @param {Variable} å€¼
     */
    _p.__dataset = function(_element,_name,_value){
        _element.dataset = _element.dataset||{};
        if (_value!==undefined){
            _element.dataset[_name] = _value;
        }
        return _element.dataset[_name];
    };
    /**
     * 取节点属性值
     * @param  {Node}   节点
     * @param  {String} 属性名
     * @return {String} 属性值
     */
    _p.__getAttribute = function(_element,_name){
        if (!_element.getAttribute){
            return;
        }
        return _element.getAttribute(_name);
    };
    /**
     * 将dom节点转为xml串
     * @param  {Node}   节点
     * @return {String} XML代码
     */
    _p.__serializeDOM2XML = function(_dom){
        return new XMLSerializer().serializeToString(_dom)||'';
    };
    /**
     * 将xml转为dom节点
     * @param  {String} XML代码
     * @return {Node}   节点
     */
    _p.__parseDOMFromXML = function(_xml){
        var _root = new DOMParser()
                       .parseFromString(_xml,'text/xml')
                       .documentElement;
        return _root.nodeName=='parsererror'?null:_root;
    };
    /**
     * 节点占全屏
     * @param  {Node}   节点
     * @param  {Object} 视窗模型
     * @return {Void}
     */
    _p.__fullScreen = function(){
        // use css fixed position
    };
    /**
     * 为节点增加用于盖select/flash等控件的层
     * @param  {Node} 节点
     * @return {Void}
     */
    _p.__mask = function(){
        // do nothing
    };
    /**
     * 去除用于盖select/flash等控件的层
     * @param  {Node} 节点
     * @return {Void}
     */
    _p.__unmask = function(){
        // do nothing
    };
    // variables
    var _ospt = _m._$SUPPORT,
        _opfx = _m._$KERNEL.prefix;
    /**
     * 指定名称是否在配置表中
     * @param  {String}  名称
     * @param  {Object}  配置表
     * @return {Boolean} 是否命中
     */
    _p.__isMatchedName = (function(){
        var _reg = /^([a-z]+?)[A-Z]/;
        return function(_name,_map){
            return !!(_map[_name]||(_reg.test(_name)&&_map[RegExp.$1]));
        };
    })();
    /**
     * 样式名称做前缀增强
     * @param  {String}  名称
     * @return {Boolean} 是否需要前缀增强
     */
    _p.__isNeedPrefixed = (function(){
        var _pmap = _u._$array2object([
            'animation','transform','transition',
            'appearance','userSelect','box','flex','column'
        ]);
        return function(_name){
            return _p.__isMatchedName(_name,_pmap);
        };
    })();
    /**
     * 格式化样式属性名称
     * border-width -> borderWidth
     * @param  {String} 样式样式名
     * @return {String} 格式化后样式名
     */
    _p.__fmtStyleName = (function(){
        var _reg = /-([a-z])/g;
        return function(_name){
            _name = _name||'';
            return _name.replace(_reg,function($1,$2){
                return $2.toUpperCase();
            });
        };
    })();
    /**
     * 针对样式名称做格式化及前缀增强
     * @param  {String} 样式名
     * @return {String} 增强后的样式名
     */
    _p.__getStyleName = (function(){
        var _reg = /^[a-z]/,
            _prefix = _opfx.css||'';
        return function(_name){
            _name = _p.__fmtStyleName(_name);
            if (!_p.__isNeedPrefixed(_name)){
                return _name;
            }
            // add prefix
            // userSelect -> webkitUserSelect
            return _prefix+_name.replace(_reg,function($1){
                return $1.toUpperCase();
            });
        };
    })();
    /**
     * 取样式值
     * @param  {String|Node} 节点
     * @param  {String}      样式名称
     * @return {Variable}    样式值
     */
    _p.__getStyleValue = function(_element,_name){
        var _current = window.getComputedStyle(_element,null);
        return _current[_p.__getStyleName(_name)]||'';
    };
    /**
     * 设置样式
     * @param  {String|Node} 节点
     * @param  {String}      样式名称
     * @param  {String}      样式值
     * @return {Void}
     */
    _p.__setStyleValue = function(_element,_name,_value){
        _element.style[_p.__getStyleName(_name)] = _value;
    };
    /**
     * 取样式变换矩阵对象
     * @param  {String}    变换信息
     * @return {CSSMatrix} 变换矩阵对象
     */
    _p.__getCSSMatrix = (function(){
        var _reg0 = /\((.*?)\)/,
            _reg1 = /\s*,\s*/,
            _klss = ['CSSMatrix',_opfx.clz+'CSSMatrix'],
            _list = ['m11','m12','m21','m22','m41','m42'];
        // matrix(1,2,3,4,5,6)
        // -> {m11:1,m12:2,m21:3,m22:4,m41:5,m42:6}
        var _doParse = function(_matrix){
            var _obj = {};
            if (_reg0.test(_matrix||'')){
                // 11,12,21,22,41,42
                _u._$forEach(
                    RegExp.$1.split(_reg1),
                    function(_value,_index){
                        _obj[_list[_index]] = _value;
                    }
                );
            }
            return _obj;
        };
        return function(_matrix){
            var _mtrx;
            _u._$forIn(_klss,function(_name){
                if (!!this[_name]){
                    _mtrx = new this[_name](_matrix||'');
                    return !0;
                }
            });
            return !_mtrx?_doParse(_matrix):_mtrx;
        };
    })();
    /**
     * 注入样式
     * @param  {Node}   样式节点
     * @param  {String} 样式内容
     * @return {Void}
     */
    _p.__injectCSSText = function(_style,_css){
        _style.textContent = _css;
    };
    /**
     * 对样式进行预处理
     * @param  {String} 待处理样式内容
     * @return {String} 处理后样式内容
     */
    _p.__processCSSText = (function(){
        var _reg0 = /\$<(.*?)>/gi,
            _reg1 = /\{(.*?)\}/g,
            _pfx = '-'+_opfx.css.toLowerCase()+'-',
            _2dmap = {
                scale:'scale({x|1},{y|1})',
                rotate:'rotate({a})',
                translate:'translate({x},{y})',
                matrix:'matrix({m11},{m12},{m21},{m22},{m41},{m42})'
            },
            _3dmap  = {
                scale:'scale3d({x|1},{y|1},{z|1})',
                rotate:'rotate3d({x},{y},{z},{a})',
                translate:'translate3d({x},{y},{z})',
                matrix:'matrix3d({m11},{m12},{m13},{m14},{m21},{m22},{m23},{m24},{m31},{m32},{m33|1},{m34},{m41},{m42},{m43},{m44|1})'
            };
        // merge template and data
        var _getTransformValue = function(_tpl,_map){
            _map = _map||_o;
            return _tpl.replace(_reg1,function($1,$2){
                var _arr = $2.split('|');
                return _map[_arr[0]]||_arr[1]||'0';
            });
        };
        // process transform value
        _p.__processTransformValue = function(_name,_data){
            var _tpl = (!_ospt.css3d?_2dmap:_3dmap)[_name.trim()];
            if (!!_tpl){
                return _getTransformValue(_tpl,_data);
            }
            return '';
        };
        return function(_css){
            if (!_css.replace){
                return _css;
            }
            return _css.replace(_reg0,function($1,$2){
                // prefix for css3
                if ($2==='vendor'){
                    return _pfx;
                }
                // parse 3D value
                var _arr = ($2||'').split('|');
                return _p.__processTransformValue(
                    _arr[0],_u._$query2object(_arr[1])
                )||$1;
            });
        };
    })();
    /**
     * 追加CSS规则
     * @param  {Node}    样式节点
     * @param  {String}  单条样式规则
     * @return {CSSRule} 样式规则对象
     */
    _p.__appendCSSText = function(_element,_css){
        var _sheet = _element.sheet,
            _length = _sheet.cssRules.length;
        _sheet.insertRule(_css,_length);
        return _sheet.cssRules[_length];
    };
    /**
     * 取待验证的样式列表
     * @param  {String} 样式，多个以空格分隔
     * @return {Array}  样式列表
     */
    _p.__getClassList = (function(){
        var _reg = /\s+/;
        return function(_class){
            _class = (_class||'').trim();
            return !!_class?_class.split(_reg):null;
        };
    })();
    /**
     * 操作样式
     * @param  {Node}   节点
     * @param  {String} 操作
     * @param  {String} 样式
     * @return {Void}
     */
    _p.__processClassName = function(_element,_type,_class){
        if (_type=='replace'){
            _p.__processClassName(
                _element,'remove',_class
            );
            _p.__processClassName(
                _element,'add',arguments[3]
            );
            return;
        }
        _u._$forEach(
            _p.__getClassList(_class),
            function(_clazz){
                _element.classList[_type](_clazz);
            }
        );
    };
    /**
     * 检测节点是否包含指定样式，多个样式用空格分隔，检测时包含其中之一即表示包含
     * @param  {Node}    节点ID或者对象
     * @param  {String}  样式串
     * @return {Boolean} 是否含指定样式
     */
    _p.__hasClassName = function(_element,_class){
        var _list = _element.classList;
        if (!_list||!_list.length){
            return !1;
        }
        return _u._$indexOf(
            _p.__getClassList(_class),
            function(_clazz){
                return _list.contains(_clazz);
            }
        )>=0;
    };
    // for init
    (function(){
        if (!_ospt.css3d){
            var _matrix = _p.__getCSSMatrix();
            _ospt.css3d = !!_matrix&&_matrix.m41!=null;
        }
    })();

    return _p;
},'3ff9c25bd81a3c2a260c28122918263a','345f1460138e362bb33cc48ffc7cd12b');
I$('d31c62fd4ff120ba19d9eefb884aee57',function(_h,_m,_u,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'){I$(2,function (){
        /**
         * 取节点的子节点列表
         * @param  {Node} _element 节点ID或者对象
         * @return {Array}         子节点列表
         */
        _h.__getChildren = _h.__getChildren._$aop(
            function(_event){
                var _element = _event.args[0];
                if (!!_element.children) return;
                // hack children
                _event.stopped = !0;
                var _result = [];
                _u._$forEach(
                    _element.childNodes,
                    function(_node){
                        if (_node.nodeType==1){
                            _result.push(_node);
                        }
                    }
                );
                _event.value = _result;
            }
        );
    });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='6.0'){I$(3,function (){
        /**
         * 设置、获取数据
         * @param {Node}     节点
         * @param {String}   标识
         * @param {Variable} 值
         */
        _h.__dataset = (function(){
            var _dataset = {},
                _tag = 'data-',
                _reg = /\-(.{1})/gi;
            // init element dataset
            var _init = function(_element){
                var _id = _element.id;
                if (!!_dataset[_id]) return;
                var _map = {};
                _u._$forEach(
                    _element.attributes,
                    function(_node){
                        var _key  = _node.nodeName;
                        if (_key.indexOf(_tag)!=0) return;
                        _key = _key.replace(_tag,'')
                                   .replace(_reg,function($1,$2){
                                        return $2.toUpperCase();
                                   });
                        _map[_key] = _node.nodeValue||'';
                    }
                );
                _dataset[_id] = _map;
            };
            return function(_element,_key,_value){
                _init(_element);
                var _set = _dataset[_element.id];
                if (_value!==undefined){
                    _set[_key] = _value;
                }
                return _set[_key];
            };
        })();
    });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='5.0'){I$(4,function (){
        // cache background image
        try{document.execCommand('BackgroundImageCache',!1,!0);}catch(e){}
        /**
         * 注入样式
         * @param  {Node}   样式节点
         * @param  {String} 样式内容
         * @return {Void}
         */
        _h.__injectCSSText = (function(){
            var _max = 30;
            return _h.__injectCSSText._$aop(function(_event){
                var _element = _event.args[0];
                if (!_element.styleSheet) return;
                _event.stopped = !0;
                var _css = _event.args[1];
                // ie9- has 31 style/link limitation
                var _list = document.styleSheets;
                if (_list.length>_max){
                    // bad performance
                    _element = _list[_max];
                    _css = _element.cssText + _css;
                }else{
                    _element = _element.styleSheet;
                }
                _element.cssText = _css;
            });
        })();
        /**
         * 取待验证的样式正则表达式
         * @param  {String} 样式，多个以空格分隔
         * @return {RegExp} 正则表达式
         */
        _h.__getClassRegExp = (function(){
            var _reg = /\s+/g;
            return function(_class){
                _class = (_class||'').trim().replace(_reg,'|');
                return !_class?null:new RegExp('(\\s|^)(?:'+_class+')(?=\\s|$)','g');
            };
        })();
        /**
         * 操作样式
         * @param  {Node}   节点
         * @param  {String} 操作
         * @param  {String} 样式
         * @return {Void}
         */
        _h.__processClassName = function(_element,_type,_class){
            _class = _class||'';
            var _name = _element.className||'',
                _xreg = _h.__getClassRegExp(
                    _class+' '+(arguments[3]||'')
                );
            // remove all calss
            var _result = _name;
            if (!!_xreg){
                _result = _result.replace(_xreg,'');
            }
            // parse added class
            switch(_type){
                case 'remove':
                    _class = '';
                break;
                case 'replace':
                    _class = arguments[3]||'';
                break;
            }
            // generate class result
            _result = (_result+' '+_class).trim();
            if (_name!=_result){
                _element.className = _result;
            }
        };
        /**
         * 检测节点是否包含指定样式，多个样式用空格分隔，检测时包含其中之一即表示包含
         * @param  {Node}    节点ID或者对象
         * @param  {String}  样式串
         * @return {Boolean} 是否含指定样式
         */
        _h.__hasClassName = function(_element,_class){
            var _xreg = _h.__getClassRegExp(_class);
            if (!!_xreg){
                return _xreg.test(_element.className||'');
            }
            return !1;
        };
    });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='4.0'){I$(5,function (){
        /**
         * 根据类名取节点列表
         * @param  {Node}   节点ID或者对象
         * @param  {String} 类名
         * @return {Array}  节点列表
         */
        _h.__getElementsByClassName = function(_element,_class){
            var _result = [],
                _regexp = new RegExp('(\\s|^)(?:'+_class.replace(/\s+/g,'|')+')(?=\\s|$)');
            _u._$forEach(
                _element.getElementsByTagName('*'),
                function(_node){
                    if (_regexp.test(_node.className)){
                        _result.push(_node);
                    }
                }
            );
            return _result;
        };
        /**
         * 取下一个兄弟节点
         * @param  {Node}  节点对象
         * @return {Node}  节点
         */
        _h.__nextSibling = function(_element){
            while(_element=_element.nextSibling){
                if (_element.nodeType==1){
                    return _element;
                }
            }
        };
        /**
         * 取上一个兄弟节点
         * @param  {Node}  节点对象
         * @return {Node}  节点
         */
        _h.__previousSibling = function(_element){
            while(_element=_element.previousSibling){
                if (_element.nodeType==1){
                    return _element;
                }
            }
        };
        /**
         * 将dom节点转为xml串
         * @param  {Node}   节点
         * @return {String} XML代码
         */
        _h.__serializeDOM2XML = function(_dom){
            return ('xml' in _dom)?_dom.xml:_dom.outerHTML;
        };
        /**
         * 将xml转为dom节点
         * @param  {String} XML代码
         * @return {Node}   节点
         */
        _h.__parseDOMFromXML = (function(){
            // http://blogs.msdn.com/b/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx
            var _msxml = [
                'Msxml2.DOMDocument.6.0',
                'Msxml2.DOMDocument.3.0'
            ];
            var _getParser = function(){
                try{
                    for(var i=0,l=_msxml.length;i<l;i++){
                        return new ActiveXObject(_msxml[i]);
                    }
                }catch(ex){
                    return null;
                }
            };
            return function(_xml){
                var _parser = _getParser();
                if (!!_parser&&
                      _parser.loadXML(_xml)&&
                     !_parser.parseError.errorCode){
                    return _parser.documentElement;
                }
                return null;
            };
        })();
        /**
         * 取样式值
         * @param  {String|Node} 节点
         * @param  {String}      样式名称
         * @return {Variable}    样式值
         */
        _h.__getStyleValue = (function(){
            var _reg0 = /opacity\s*=\s*([\d]+)/i;
            var _fmap = {
                // get opacity from filter:alpha(opacity=50)
                opacity:function(_style){
                    var _result = 0;
                    if (_reg0.test(_style.filter||'')){
                        _result = parseFloat(RegExp.$1)/100;
                    }
                    return _result;
                }
            };
            return function(_element,_name){
                var _current = _element.currentStyle,
                    _func = _fmap[_name];
                if (!!_func){
                    return _func(_current);
                }
                return _current[_h.__getStyleName(_name)]||'';
            };
        })();
        /**
         * 设置样式
         * @param  {String|Node} 节点
         * @param  {String}      样式名称
         * @param  {String}      样式值
         * @return {Void}
         */
        _h.__setStyleValue = (function(){
            var _fmap = {
                // opacity -> filter:alpha(opacity=50)
                opacity:function(_element,_value){
                    _element.style.filter = 'alpha(opacity='+_value*100+')';
                }
            };
            return function(_element,_name,_value){
                var _func = _fmap[_name];
                if (!!_func){
                    _func(_element,_value);
                }else{
                    _element.style[_h.__getStyleName(_name)] = _value;
                }
            };
        })();
        /**
         * 追加CSS规则
         * @param  {Node}    样式节点
         * @param  {String}  单条样式规则
         * @return {CSSRule} 样式规则对象
         */
        _h.__appendCSSText = function(_element,_css){
            var _sheet = _element.styleSheet,
                _length = _sheet.rules.length,
                _arr = _css.split(/[\{\}]/);
            _sheet.addRule(_arr[0],_arr[1],_length);
            return _sheet.rules[_length];
        };
     });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='3.0'){I$(6,function (){
        /**
         * 取节点属性值
         * @param  {Node}   节点
         * @param  {String} 属性名
         * @return {String} 属性值
         */
        _h.__getAttribute =
        _h.__getAttribute._$aop(null,function(_event){
            // fix ie7 maxlength default value 2147483647
            var _args = _event.args;
            if (_args[1]=='maxlength'&&
                _event.value==2147483647){
                _event.value = null;
            }
        });
    });}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='2.0'){I$(7,function (){
        /**
         * 节点占全屏
         * @param  {Node}   节点
         * @param  {Object} 视窗模型
         * @return {Void}
         */
        _h.__fullScreen = function(_element,_viewport){
            var _style = _element.style;
            _style.width = _viewport.scrollWidth+'px';
            _style.height = _viewport.scrollHeight+'px';
        };
        /**
         * 为节点增加用于盖select/flash等控件的层
         * @param  {Node} 节点
         * @return {Void}
         */
        _h.__mask = (function(){
            var _cache = {};
            // remove mask
            _h.__unmask = function(_element){
                var _id = _element.id,
                    _mask = _cache[_id];
                if (!!_mask){
                    delete _cache[_id];
                    _mask.parentNode.removeChild(_mask);
                }
            };
            // append mask
            return function(_element){
                var _id = _element.id,
                    _mask = _cache[_id];
                // create mask
                if (!_mask){
                    _mask = document.createElement('iframe');
                    _mask.style.position = 'absolute';
                    _cache[_id] = _mask;
                }
                // sync mask size
                var _style1 = _mask.style,
                    _style0 = _element.style;
                _style1.top = (parseInt(_style0.top)||0)+'px';
                _style1.left = (parseInt(_style0.left)||0)+'px';
                _style1.width = _element.offsetWidth+'px';
                _style1.height = _element.offsetHeight+'px';
                _element.insertAdjacentElement('beforeBegin',_mask);
                return _mask;
            };
        })();
    });}
if (_m._$KERNEL.engine==='gecko'){I$(8,function (){
        if (!_m._$SUPPORT.css3d){
            _m._$SUPPORT.css3d = 'MozPerspective' in document.body.style;
        }
        if (!('insertAdjacentElement' in document.body)){
            HTMLElement.prototype.insertAdjacentElement = function(_where,_element){
                if (!_where||!_element) return;
                switch(_where){
                    case 'beforeEnd'  :
                        this.appendChild(_element);
                    return;
                    case 'beforeBegin':
                        this.parentNode.insertBefore(_element,this);
                    return;
                    case 'afterBegin' :
                        !this.firstChild
                        ?this.appendChild(_element)
                        :this.insertBefore(_element,this.firstChild);
                    return;
                    case 'afterEnd'   :
                        !this.nextSibling
                        ?this.parentNode.appendChild(_element)
                        :this.parentNode.insertBefore(_element,this.nextSibling);
                    return;
                }
            };
        }
        if (!('innerText' in document.body)){
            HTMLElement.prototype['__defineGetter__']("innerText",function(){return this.textContent;});
            HTMLElement.prototype['__defineSetter__']("innerText",function(_content){this.textContent = _content;});
        }
    });}return _h;},'88601ab3a43974f10f7457b7e4b16c1a','345f1460138e362bb33cc48ffc7cd12b','3ff9c25bd81a3c2a260c28122918263a');
I$('555a9eecaf26c5c01fe9db8d965bc30f',function (NEJ,_g,_u,_v,_x,_h,_p,_o,_f,_r){
    // variables
    var _y = {},     // chainable methods
        _cspol,      // css text pool
        _empol = {}, // elements without id property, eg. document,window
        _dirty = {}, // temporary element with id
        _fragment = document.createDocumentFragment(); // node in memory
    // init
    if (!document.head){
         document.head = document.getElementsByTagName('head')[0]||document.body;
    }
    // only for test
    _p.dump = function(){
        return {
            pool:_empol,
            dirty:_dirty,
            fragment:_fragment
        };
    };
    /**
     * 为节点设置一个唯一的标识
     *
     * 结构举例
     * ```html
     *    <div id="abc">aaaaa</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 如果有id，返回原来的id,否则返回auto-id-12345678(8位随机字符串)
     *       var _id = _e._$id(_node||"abc");
     *   });
     * ```
     *
     * @method module:base/element._$id
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @return {String}             节点标识
     */
    /**
     * @method CHAINABLE._$id
     * @see module:base/element._$id
     */
    _p._$id =
    _y._$id = function(_element){
        _element = _p._$get(_element);
        if (!_element) return;
        var _id = !!_element.id ? _element.id
                : 'auto-id-'+_u._$uniqueID();
        if (!('id' in _element)){
            _empol[_id] = _element;
        }
        _element.id = _id;
        // check if element can be getted
        if (!_p._$get(_id)){
            _dirty[_id] = _element;
        }
        return _id;
    };
    /**
     * 根据标识取节点对象，包括在内存中的节点
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 先根据id从内存中取，再从页面取
     *       var _node = _e._$get("abc");
     *   });
     * ```
     *
     * @method module:base/element._$get
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @return {Node}               节点对象
     */
    _p._$get = function(_element){
        // for document/window
        // fix dirty window object in mac safari
        try{
            var _node = _empol[''+_element];
        }catch(ex){
            // ignore
        }
        if (!!_node){
            return _node;
        }
        // element is node
        if (!_u._$isString(_element)&&
            !_u._$isNumber(_element)){
            return _element;
        }
        // element is id
        // check node in page first
        var _node = document.getElementById(_element);
        if (!_node){
            _node = _h.__getElementById(_fragment,_element);
        }
        // remove dirty element
        if (!!_node){
            delete _dirty[_element];
        }
        return _node||_dirty[_element];
    };
    /**
     * 取节点的子节点列表
     *
     * 结构举例
     * ```html
     *   <div id="abc">
     *       <p>1</p>
     *       <p><span>2</span></p>
     *       <p>3</p>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 取直接的3个子节点(p标签)
     *       var _childs = _e._$getChildren('abc');
     *
     *       // 使用类名过滤，去带a或者b样式类的子节点
     *       var _childs = _e._$getChildren('abc','a b');
     *   });
     * ```
     *
     * @method module:base/element._$getChildren
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @param  {String}      arg1 - 样式标识
     * @return {Array}              子节点列表
     */
    /**
     * @method CHAINABLE._$getChildren
     * @see module:base/element._$getChildren
     */
    _p._$getChildren =
    _y._$getChildren = function(_element,_clazz){
        _element = _p._$get(_element);
        if (!_element) return null;
        var _list = _h.__getChildren(_element);
        if (!!_clazz){
            _u._$reverseEach(
                _list,function(_node,_index,_list){
                    if (!_p._$hasClassName(_node,_clazz)){
                        _list.splice(_index,1);
                    }
                }
            );
        }
        return _list;
    };
    /**
     * 根据过滤条件取第一个满足条件的父节点
     *
     * 结构举例
     * ```html
     *   <div data-a="aaa">
     *       <p>1</p>
     *       <div a="aaaaaa">
     *           <p class="a">
     *               <span id="abc">2</span>
     *           </p>
     *       </div>
     *       <p>3</p>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 返回包含样式a的节点 <p class="a">
     *       var node = _e._$getParent('abc','c:a');
     *
     *       // 返回包含属性a的节点 <div a="aaaaaa">
     *       var node = _e._$getParent('abc','a:a')
     *
     *       // 返回包含data属性a的节点 <div data-a="aaa">
     *       var node = _e._$getParent('abc','d:a');
     *
     *       // 返回标签为p的节点 <p class="a">
     *       var node = _e._$getParent('abc','t:p');
     *
     *       // 返回符合过滤条件的父节点
     *       var node = _e._$getParent('abc',function(_element){
     *           return _element.scrollHeight>_element.clientHeight;
     *       });
     *   });
     * ```
     *
     * @method module:base/element._$getChildren
     * @param  {String|Node}      arg0 - 节点标识或者对象
     * @param  {String|Function}  arg1 - 过滤规则
     * @return {Node}             父节点
     */
    _p._$getParent = (function(){
        var _exmap;
        var _doFilter = function(_name,_element){
            var _arr = _name.split(':');
            if (_arr.length>1){
                if (!_exmap){
                    _exmap = {
                        a:_p._$attr,
                        d:_p._$dataset,
                        c:_p._$hasClassName,
                        t:function(n,v){return (n.tagName||'').toLowerCase()===v;}
                    };
                }
                var _check = _exmap[_arr[0]];
                if (!!_check){
                    return !!_check(_element,_arr[1]);
                }
                _name = _arr[1];
            }
            return !!_p._$attr(_element,_name)||
                   !!_p._$dataset(_element,_name)||
                     _p._$hasClassName(_element,_name);
        };
        return function(_element,_filter){
            _element = _p._$get(_element);
            if (!_element){
                return;
            }
            if (!_filter){
                return _element;
            }
            if (_u._$isString(_filter)){
                _filter = _doFilter._$bind(null,_filter);
            }
            if (_u._$isFunction(_filter)){
                while(_element){
                    if (!!_filter(_element)){
                        return _element;
                    }
                    _element = _element.parentNode;
                }
                return null;
            }
            return _element;
        };
    })();
    /**
     * 根据类名取节点列表
     *
     * 结构举例
     * ```html
     *   <div id="abc">
     *     <p class="item">1</p>
     *     <div><p class="item">2</p></div>
     *     <p class="item">3</p>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 获取abc节点下样式带有"item"的节点列表,如果没有父节点，返回null
     *       var _list = _e._$getByClassName('abc','item');
     *   });
     * ```
     *
     * @method module:base/element._$getByClassName
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @param  {String}      arg1 - 类名
     * @return {Array}              节点列表
     */
    /**
     * @method CHAINABLE._$getByClassName
     * @see module:base/element._$getByClassName
     */
    _p._$getByClassName =
    _y._$getByClassName = function(_element,_class){
        _element = _p._$get(_element);
        return !_element ? null :
                _h.__getElementsByClassName(
                    _element,_class.trim()
                );
    };
    /**
     * 根据从兄弟节点中搜索符合条件的节点
     *
     * 结构举例
     * ```html
     *   <div>
     *     <p class="item" id="a1">1</p>
     *     <p class="item" id="a2">2</p>
     *     <p class="item" id="a3">3</p>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 取a2的后一个兄弟节点a3
     *       var _node = _e._$getSibling('a2');
     *
     *       // 取a2的前一个兄弟节点a1
     *       var _node = _e._$getSibling('a2',{backward:true});
     *
     *       // 过滤搜索，从a2向后搜索找id为a4的节点
     *       var _node = _e._$getSibling('a2',function(_element){
     *           return _element.id=='a4'
     *       });
     *
     *       // 过滤搜索，从a2向前搜索找id为a0的节点
     *       var _node = _e._$getSibling('a2',{
     *           backward:true,
     *           filter:function(_element){
     *               return _element.id=='a0'
     *           }
     *       });
     *   });
     * ```
     *
     * @method   module:base/element._$getSibling
     * @param    {String|Node}     arg0     - 节点标识或者对象
     * @param    {Function|Object} arg1     - 如果是函数则表示过滤器，否则为配置信息
     * @property {Boolean}         backward - 是否后向搜索，默认前向搜索
     * @property {Function}        filter   - 节点过滤器，返回true表示需要返回的节点，找到第一个即返回
     * @return   {Node}                       符合条件的节点
     */
    /**
     * @method CHAINABLE._$getSibling
     * @see module:base/element._$getSibling
     */
    _p._$getSibling =
    _y._$getSibling = (function(){
        var _doFilter = function(){
            return !0;
        };
        return function(_element,_filter){
            _element = _p._$get(_element);
            if (!_element){
                return null;
            }
            var _conf = {
                backward:!1,
                filter:_doFilter
            };
            if (_u._$isFunction(_filter)){
                _conf.filter = _filter;
            }else{
                _conf = _u._$fetch(_conf,_filter);
            }
            var _next = _conf.backward
                      ? _h.__previousSibling
                      : _h.__nextSibling;
            while(_element=_next(_element)){
                if (_conf.filter(_element)){
                    break;
                }
            }
            return _element;
        };
    })();
    /**
     * 取节点所在的滚动容器，
     * 从当前节点开始往上遍历，直到出现滚动条的节点
     *
     * 结构举例
     * ```html
     *   <div id="efg">
     *     <div id="abc">123</div>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 加入efg节点出现滚动条，则这里找到的是efg节点
     *       var _sbody = _e._$getScrollViewPort('abc');
     *
     *       // 不带任何参数取页面滚动条所在节点
     *       var _sbody = _e._$getScrollViewPort();
     *   });
     * ```
     *
     * @method module:base/element._$getScrollViewPort
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @return {Node}               视窗节点
     */
    _p._$getScrollViewPort = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            _element = _element.parentNode;
            while(!!_element){
                if (_element.scrollHeight>
                    _element.clientHeight){
                    break;
                }
                _element = _element.parentNode;
            }
            if (!!_element){
                return _element;
            }
        }
        var _tmp1 = document.body.scrollHeight,
            _tmp2 = document.documentElement.scrollHeight;
        return _tmp2>=_tmp1?document.documentElement:document.body;
    };
    /**
     * 盒模型结构
     *
     * @typedef  {Object} module:base/element~BoxModel
     * @property {Number} scrollTop    - 滚动垂直偏移
     * @property {Number} scrollLeft   - 滚动水平偏移
     * @property {Number} clientWidth  - 页面可视宽度
     * @property {Number} clientHeight - 页面可视高度
     * @property {Number} scrollWidth  - 页面滚动宽度
     * @property {Number} scrollHeight - 页面滚动高度
     */
    /**
     * 取页面盒信息，返回盒信息内容：
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 返回信息见说明
     *       var _box = _e._$getPageBox();
     *   });
     * ```
     *
     * @method module:base/element._$getPageBox
     * @param  {Document} arg0 - 文档对象
     * @return {module:base/element~BoxModel} 盒信息
     */
    _p._$getPageBox = (function(){
        // get min value but not zero
        var _getClientBox = function(_list){
            var _result = 0;
            _u._$forEach(
                _list,function(_size){
                    if (!_size) return;
                    if (!_result){
                        _result = _size;
                    }else{
                        _result = Math.min(_result,_size);
                    }
                }
            );
            return _result;
        };
        var _farr = [
            {
                main:'scroll',
                sub:['Top','Left'],
                func:function(_key,_body0,_body1){
                    return Math.max(
                        _body0['scroll'+_key],
                        _body1['scroll'+_key]
                    );
                }
            },
            {
                main:'client',
                sub:['Width','Height'],
                func:function(_key,_body0,_body1){
                    return _getClientBox([
                        _body0['client'+_key],
                        _body0['offset'+_key],
                        _body1['client'+_key],
                        _body1['offset'+_key]
                    ]);
                }
            },
            {
                main:'scroll',
                sub:['Width','Height'],
                func:function(_key,_body0,_body1,_result){
                    return Math.max(
                        _result['client'+_key],
                        _body0['scroll'+_key],
                        _body1['scroll'+_key]
                    );
                }
            }
        ];
        return function(_document){
            var _result = {},
                _doc   = _document||document,
                _body0 = _doc.body,
                _body1 = _doc.documentElement;
            _u._$forEach(
                _farr,function(_item){
                    var _main = _item.main;
                    _u._$forEach(
                        _item.sub,function(_key){
                            _result[_main+_key] = _item.func(
                                _key,_body0,_body1,_result
                            );
                        }
                    );
                }
            );
            return _result;
        };
    })();
    /**
     * 按比例将给定大小缩放至限制区域内
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 限制区域大小 100*10
     *       var _limit = {width:100,height:10};
     *
     *       // 给定200*10的大小，由于宽度超出，缩放后为{width:100,height:5}
     *       var _box = _e._$getMaxBox({width:200,height:10},_limit);
     *
     *       // 给定100*20的大小，由于高度超出，缩放后为{width:50,height:10}
     *       var _box = _e._$getMaxBox({width:100,height:20},_limit);
     *
     *       // 给定 50*5，没有超出限制，返回{width:50,height:5}
     *       var _box = _e._$getMaxBox({width:50,height:5},_limit);
     *   });
     * ```
     *
     * @method   module:base/element._$getMaxBox
     * @param    {module:base/element~SizeModel} arg0 - 原始大小
     * @param    {module:base/element~SizeModel} arg1 - 最大限制大小
     * @return   {module:base/element~SizeModel}        按比例计算出的最大值信息
     */
    _p._$getMaxBox = function(_org,_max){
        var _result = _u._$merge({},_org),
            _mrto = _max.width/_max.height,
            _orto = _org.width/_org.height;
        // height overflow
        if (_mrto>_orto&&
            _org.height>_max.height){
            _result.height = _max.height;
            _result.width = _result.height*_orto;
        }
        // width overflow
        if (_mrto<_orto&&
            _org.width>_max.width){
            _result.width = _max.width;
            _result.height = _result.width/_orto;
        }
        return _result;
    };
    /**
     * 滚动到指定节点
     *
     * 结构举例
     * ```html
     *   <div id="a" style="padding:5px 0 0 10px;"></div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 滚动到页面上a这节点的位置
     *       _e._$scrollTo('a');
     *   });
     * ```
     *
     * @method module:base/element._$scrollTo
     * @param  {Node|String} arg0 - 节点
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$scrollTo
     * @see module:base/element._$scrollTo
     */
    _p._$scrollTo =
    _y._$scrollTo = function(_element){
        var _offset = _p._$offset(_element);
        window.scrollTo(_offset.x,_offset.y);
    };
    /**
     * 大小信息对象
     * @typedef  {Object} module:base/element~SizeModel
     * @property {Number} width  - 宽度
     * @property {Number} height - 高度
     */
    /**
     * 位置信息对象
     * @typedef  {Object} module:base/element~PositionModel
     * @property {Number} top  - 垂直位置
     * @property {Number} left - 水平位置
     */
    /**
     * 计算在容器中对齐时的位置信息
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 容器大小
     *       var _box = {width:100,height:40};
     *
     *       // 默认居中对齐返回 {top:15,left:40}
     *       var _pos = _e._$align(_box,{width:20,height:10});
     *
     *       // 左下对齐返回 {top:30,left:0}
     *       var _pos = _e._$align(_box,{width:20,height:10},'left bottom');
     *   });
     * ```
     *
     * @method module:base/element._$align
     * @param  {module:base/element~SizeModel} arg0 - 容器大小
     * @param  {module:base/element~SizeModel} arg1 - 原始大小
     * @param  {String} arg2 - 对齐方式，水平+空格+垂直，如left top，默认为 center middle，
     *                         水平：left/center/right，
     *                         垂直：top/middle/bottom
     * @return {module:base/element~PositionModel} 位置信息
     */
    _p._$align = (function(){
        var _reg = /\s+/;
        var _fmap = {
            left:function(){
                return 0;
            },
            center:function(_box,_org){
                return (_box.width-_org.width)/2;
            },
            right:function(_box,_org){
                return _box.width-_org.width;
            },
            top:function(){
                return 0;
            },
            middle:function(_box,_org){
                return (_box.height-_org.height)/2;
            },
            bottom:function(_box,_org){
                return _box.height-_org.height;
            }
        };
        return function(_box,_org,_align){
            var _result = {},
                _arr  = (_align||'').split(_reg),
                _top  = _fmap[_arr[1]]||_fmap.middle,
                _left = _fmap[_arr[0]]||_fmap.center;
            _result.top = _top(_box,_org);
            _result.left = _left(_box,_org);
            return _result;
        };
    })();
    /**
     * 计算两个节点之间的偏移量
     *
     * 结构举例
     * ```html
     *   <div id="a" style="position:relative;padding:5px 0 0 10px;">
     *     <span id="b">123</span>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 计算节点b到节点a(外层需要定位属性)的距离，如果没有指定节点，默认计算的根节点
     *       // _result : {x:10,y:5}
     *       var _result = _e._$offset('b','a');
     *   });
     * ```
     *
     * @method module:base/element._$offset
     * @param  {String|Node} arg0 - 起始节点
     * @param  {String|Node} arg1 - 结束节点，没有该参数则计算到根节点
     * @return {Object}             偏移量，如{x:234,y:987}
     */
    /**
     * @method CHAINABLE._$offset
     * @see module:base/element._$offset
     */
    _p._$offset =
    _y._$offset = (function(){
        var _isRoot = function(_element){
            return _element==document.body||
                   _element==document.documentElement;
        };
        return function(_from,_to){
            _from = _p._$get(_from);
            if (!_from){
                return null;
            }
            _to = _p._$get(_to)||null;
            var _node = _from,
                _result = {x:0,y:0},
                _isroot,_delta,_border;
            while(!!_node&&_node!=_to){
                _isroot = _isRoot(_node)||_node==_from;
                _delta = _isroot?0:_node.scrollLeft;
                _border = parseInt(_p._$getStyle(_node,'borderLeftWidth'))||0;
                _result.x += _node.offsetLeft+_border-_delta;
                _delta = _isroot?0:_node.scrollTop;
                _border = parseInt(_p._$getStyle(_node,'borderTopWidth'))||0;
                _result.y += _node.offsetTop+_border-_delta;
                _node = _node.offsetParent;
            }
            return _result;
        };
    })();
    /**
     * 节点占全屏
     *
     * @method module:base/element._$fullScreen
     * @param  {Node} arg0 - 节点
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$fullScreen
     * @see module:base/element._$fullScreen
     */
    _p._$fullScreen =
    _y._$fullScreen = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            _h.__fullScreen(
                _element,
                _p._$getPageBox()
            );
        }
    };
    /**
     * 为节点增加用于盖select/flash等控件的层
     *
     * @method module:base/element._$mask
     * @see    module:base/element._$unmask
     * @param  {Node} arg0 - 节点
     * @return {Node}        盖层节点
     */
    /**
     * @method CHAINABLE._$mask
     * @see module:base/element._$mask
     */
    _p._$mask =
    _y._$mask = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            _p._$id(_element);
            return _h.__mask(_element);
        }
        return null;
    };
    /**
     * 为节点移除用于盖select/flash等控件的层
     *
     * @method module:base/element._$unmask
     * @see    module:base/element._$mask
     * @param  {Node} arg0 - 节点
     * @return {Node}        盖层节点
     */
    /**
     * @method CHAINABLE._$unmask
     * @see module:base/element._$unmask
     */
    _p._$unmask =
    _y._$unmask = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            _p._$id(_element);
            return _h.__unmask(_element);
        }
        return null;
    };
    /**
     * 创建节点，使用该接口创建的结构后续可通过_$get接口根据ID取到节点
     *
     * 结构举例
     * ```javascript
     *   <div id="abc">1</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 创建一个节点，挂到body上
     *       _e._$create("div","m-body",document.body);
     *
     *       // 创建一个节点挂到id是abc的节点上
     *       // 结果：<div id="abc">1<p class="m-list"></p></div>
     *       _e._$create("p","m-list","abc");
     * 
     *       // 创建一个节点放在内存中
     *       var _node = _e._$create('div');
     *       _node.innerHTML = '<p id="a">aaaaaa</p><p id="b">bbbbbb</p>';
     *       // 后续可以通过id取id为a的节点
     *       var _pa = _e._$get('a');
     *   });
     * ```
     *
     * @method module:base/element._$create
     * @param  {String}      arg0 - 标签
     * @param  {String}      arg1 - 样式
     * @param  {String|Node} arg2 - 父节点标识或者对象
     * @return {Node}               节点
     */
    _p._$create = (function(){
        var _map = {
            a:{href:'#',hideFocus:!0},
            style:{type:'text/css'},
            link:{type:'text/css',rel:'stylesheet'},
            iframe:{frameBorder:0},
            script:{defer:!0,type:'text/javascript'}
        };
        return function(_tag,_class,_parent){
            var _element = document.createElement(_tag),
                _config = _map[_tag.toLowerCase()];
            _u._$merge(_element,_config);
            if (!!_class) _element.className = _class;
            _parent = _p._$get(_parent);
            if (!!_parent){
                _parent.appendChild(_element);
            }else{
                // append to documentfragment for get by id
                if (!_config){
                    _fragment.appendChild(_element);
                }
            }
            return _element;
        };
    })();
    /**
     * 创建可交互框架
     *
     * 结构举例
     * ```html
     *   <div id="frameCnt"></div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *      var _xFrame = _e._$createXFrame({
     *          src:'http://www.baidu.com',
     *          name:'百度',
     *          parent:'frameCnt',
     *          visible:false,
     *          onload:function(){
     *              // 加载frame成功后，name设置成功，为百度
     *              // 加载frame成功后，显示效果正确，display:none
     *          }
     *      });
     *   });
     * ```
     *
     * @method   module:base/element._$createXFrame
     * @param    {Object}               arg0    - 可选配置参数
     * @property {String}               src     - 框架地址
     * @property {String}               name    - 框架名称
     * @property {String|Node|Function} parent  - 父节点或者框架加入父容器的执行函数
     * @property {Boolean}              visible - 是否可见
     * @property {Function}             onload  - 框架载入回调
     * @return {Node}                             框架节点
     */
    _p._$createXFrame = (function(){
        var _getFrameSrc = function(){
            if (location.hostname==document.domain){
                return 'about:blank';
            }
            return 'javascript:(function(){document.open();document.domain="'+document.domain+'";document.close();})();';
        };
        var _getFrameWithName = function(_name){
            _name = _name.trim();
            if (!_name){
                return _p._$create('iframe');
            }
            // pass name to frame
            var _iframe;
            try{
                _iframe = document.createElement(
                          '<iframe name="'+_name+'"></iframe>');
                _iframe.frameBorder = 0;
            }catch(e){
                _iframe = _p._$create('iframe');
                _iframe.name = _name;
            }
            return _iframe;
        };
        return function(_options){
            _options = _options||_o;
            var _iframe = _getFrameWithName(_options.name||'');
            if (!_options.visible){
                _iframe.style.display = 'none';
            }
            if (_u._$isFunction(_options.onload)){
                _v._$addEvent(_iframe,'load',function(_event){
                    if (!_iframe.src) return;
                    _v._$clearEvent(_iframe,'load');
                    _options.onload(_event);
                });
            }
            // will trigger onload
            var _parent = _options.parent;
            if (_u._$isFunction(_parent)){
                try{_parent(_iframe);}catch(e){}
            }else{
                (_p._$get(_parent)||document.body).appendChild(_iframe);
            }
            // ensure trigger onload async
            var _src = _options.src||_getFrameSrc();
            window.setTimeout(function(){
                _iframe.src = _src;
            },0);
            return _iframe;
        };
    })();
    /**
     * 删除节点
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 移除节点前先清理节点上的事件
     *       _e._$remove('abc',false);
     *       // 移除节点前不清理节点上的事件
     *       _e._$remove('abc',true);
     *   });
     * ```
     *
     * @method module:base/element._$remove
     * @see    module:base/element._$removeByEC
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @param  {Boolean}     arg1 - 是否禁止事件清理
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$remove
     * @see module:base/element._$remove
     */
    _p._$remove =
    _y._$remove = (function(){
        var _fmap = {
            img:function(_node){
                _node.src = _g._$BLANK_IMAGE;
            },
            iframe:function(_node){
                _node.src = 'about:blank';
            }
        };
        var _doClear = function(_node,_tag){
            if (!_tag){
                var _xtag = (_node.tagName||'').toLowerCase(),
                    _func = _fmap[_xtag];
                if (!!_func){
                    _func(_node);
                }
                return;
            }
            if (!!_node.getElementsByTagName){
                _u._$forEach(
                    _node.getElementsByTagName(_tag),
                    _doClear
                );
            }
        };
        return function(_element){
            _element = _p._$get(_element);
            if (!!_element){
                // clear events
                if (!arguments[1]){
                    _v._$clearEvent(_element);
                }
                // clear elements
                _doClear(_element);
                _doClear(_element,'img');
                _doClear(_element,'iframe');
                // remove node
                if (!!_element.parentNode){
                    _element.parentNode.removeChild(_element);
                }
            }
        };
    })();
    /**
     * 节点移至内存
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 先生成一个节点加到body下
     *       var _node = _e._$create('div','js-div',document.body);
     *       // 把节点移动到内存中
     *       _e._$removeByEC(_node);
     *       // 从body上没有取到节点,结果为[]
     *       _e._$getByClassName(document.body,'js-div');
     *   });
     * ```
     *
     * @method module:base/element._$removeByEC
     * @see    module:base/element._$remove
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$removeByEC
     * @see module:base/element._$removeByEC
     */
    _p._$removeByEC =
    _y._$removeByEC = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            try{
                _fragment.appendChild(_element);
            }catch(ex){
                // ignore
                console.error(ex);
            }
        }
    };
    /**
     * 清除所有子节点
     *
     * 结构举例
     * ```html
     *   <ul id="abc">
     *     <li>aaaaaaaaaaaaa</li>
     *     <li>bbbbbbbbbbbbb</li>
     *     <li>ccccccccccccc</li>
     *   </ul>
     *
     *   <table id="efg">
     *     <tr><td>1111</td><td>1111</td></tr>
     *     <tr><td>2222</td><td>2222</td></tr>
     *     <tr><td>3333</td><td>3333</td></tr>
     *   </table>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 清除ul下的子节点
     *       _e._$clearChildren('abc');
     *
     *       // 清除table下的子节点
     *       _e._$clearChildren('efg');
     *   });
     * ```
     *
     * @method module:base/element._$clearChildren
     * @see    module:base/element._$remove
     * @param  {String|Node} arg0 - 容器节点
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$clearChildren
     * @see module:base/element._$clearChildren
     */
    _p._$clearChildren =
    _y._$clearChildren = function(_element){
        _element = _p._$get(_element);
        if (!!_element){
            _u._$reverseEach(
                _element.childNodes,
                function(_node){
                    _p._$remove(_node);
                }
            );
        }
    };
    /**
     * 内联元素增加定位封装
     *
     * 结构举例
     * ```html
     *   <input type="text" id="abc"/>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 包装定位的span
     *       _e._$wrapInline('abc');
     *   });
     * ```
     *
     * 生成结构如下
     * ```html
     *   <span style="position:relative;zoom:1">
     *     <input type="text" id="abc"/>
     *     <!-- 此api返回以下这个节点 -->
     *     <span style="position:absolute;top:0;left:0;"></span>
     *   </span>
     * ```
     *
     * 应用举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 返回容器的样式名称
     *       // 通过这个样式名称可以取到一个绝对定位的样式名 class+'-show'
     *       var _node = _e._$wrapInline('abc',{
     *           tag:'label',
     *           clazz:'js-xxx'
     *       });
     *       // 可以在返回的节点里添加想要显示的结构
     *       _node.innerHTML = '<span>aaa</span><span>aaa</span>';
     *   });
     * ```
     *
     * @method   module:base/element._$wrapInline
     * @param    {String|Node}  arg0  - 内联节点
     * @param    {Object}       arg1  - 绝对定位节点配置信息
     * @property {String}       tag   - 标记名称，默认span
     * @property {String}       nid   - 节点识别样式名，这个会被添加到样式中作为标识
     * @property {String}       clazz - 样式名称
     * @return   {Node}                 绝对定位的节点
     */
    /**
     * @method CHAINABLE._$wrapInline
     * @see module:base/element._$wrapInline
     */
    _p._$wrapInline =
    _y._$wrapInline = (function(){
        var _clazz,
            _reg0 = /\s+/;
        var _doInitStyle = function(){
            if (!!_clazz) return;
            _clazz = _p._$pushCSSText('.#<uispace>{position:relative;zoom:1;}.#<uispace>-show{position:absolute;top:0;left:100%;cursor:text;white-space:nowrap;overflow:hidden;}');
            _p._$dumpCSSText();
        };
        return function(_element,_options){
            _element = _p._$get(_element);
            if (!_element){
                return null;
            }
            // init style
            _doInitStyle();
            _options = _options||_o;
            // check relative parent
            var _parent = _element.parentNode;
            if (!_p._$hasClassName(_parent,_clazz)){
                // build wrapper box
                _parent = _p._$create('span',_clazz);
                _element.insertAdjacentElement('beforeBegin',_parent);
                _parent.appendChild(_element);
            }
            // check absolute node
            var _nid = _options.nid||'',
                _node = _p._$getByClassName(
                    _parent,_nid||
                   (_clazz+'-show')
                )[0];
            if (!_node){
                var _klass = ((_options.clazz||'')+' '+_nid).trim();
                _klass = _clazz+'-show'+(!_klass?'':' ')+_klass;
                _node = _p._$create(_options.tag||'span',_klass);
                _parent.appendChild(_node);
            }
            // append class to parent node
            var _klass = _options.clazz;
            if (!!_klass){
                _klass = (_klass||'').trim().split(_reg0)[0]+'-parent';
                _p._$addClassName(_parent,_klass);
            }
            return _node;
        };
    })();
    /**
     * 设置或者获取指定标识的数据
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 设置值操作
     *       // <div id="abc" data-img="http://a.b.com/a.png">123</div>
     *       // 返回value值: http://a.b.com/a.png
     *       var _src = _e._$dataset('abc','img','http://a.b.com/a.png');
     *       // 取值操作
     *       var _src = _e._$dataset('abc','img');
     * 
     *       // 批量设置
     *       var _map = _e._$dataset('abc',{
     *           a:'aaaaa',
     *           b:'bbbbbbbb',
     *           c:'ccccccccc'
     *       });
     * 
     *       // 批量取值
     *       // 返回：{a:'aaaaa',b:'bbbbbbbb',c:'ccccccccc'}
     *       var _map = _e._$dataset('abc',['a','b','c']);
     *   });
     * ```
     *
     * @method module:base/element._$dataset
     * @see    module:base/element._$attr
     * @param  {String}              arg0 - 数据标识
     * @param  {String|Object|Array} arg1 - 属性名
     * @return {String|Object}              数据值
     */
    /**
     * @method CHAINABLE._$dataset
     * @see module:base/element._$dataset
     */
    _p._$dataset =
    _y._$dataset = function(_element,_key,_value){
        // check element
        var _id = _p._$id(_element);
        if (!_id){
            return null;
        }
        // check single key-value
        if (_u._$isString(_key)){
            return _h.__dataset(
                _p._$get(_element),
                _key,_value
            );
        }
        // check map set
        // ignore argument _value
        if (_u._$isObject(_key)){
            var _ret = {};
            _u._$forIn(_key,function(_v,_k){
                _ret[_k] = _p._$dataset(_id,_k,_v);
            });
            return _ret;
        }
        // check array get
        // ignore argument _value
        if (_u._$isArray(_key)){
            var _ret = {};
            _u._$forEach(_key,function(_k){
                _ret[_k] = _p._$dataset(_id,_k);
            });
            return _ret;
        }
        return null;
    };
    /**
     * 取某个节点的属性值
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 设置成 <div id="abc" data-img="http://a.b.com/a.png">123</div>
     *       // 返回value值: http://a.b.com/a.png
     *       var _src = _e._$attr('abc','data-img','http://a.b.com/a.png');
     *
     *       // 如果设置了img的值返回data-img，否则放回空字符串
     *       var _src = _e._$attr('abc','data-img');
     *   });
     * ```
     *
     * @method module:base/element._$attr
     * @see    module:base/element._$dataset
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @param  {String}      arg1 - 属性名称
     * @param  {String}      arg2 - 属性值，如果没有设置此参数则表示取值
     * @return {String}             属性值
     */
    /**
     * @method CHAINABLE._$attr
     * @see module:base/element._$attr
     */
    _p._$attr =
    _y._$attr = function(_element,_name,_value){
        _element = _p._$get(_element);
        if (!_element){
            return '';
        }
        if (_value!==undefined&&!!_element.setAttribute){
            _element.setAttribute(_name,_value);
        }
        return _h.__getAttribute(_element,_name);
    };
    /**
     * html代码转节点对象，
     * 如果转换出来的节点数量超过[包含]2个，
     * 则最外面增加一个容器节点，即返回的始终是一个节点
     *
     * 结构举例
     * ```html
     *   <div id="abc">
     *     <span>123</span>
     *   </div>
     * ```
     *
     * 代码举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       var _node = _e._$html2node('<div>1</div><div><span>2</span></div>');
     *   });
     * ```
     *
     * 返回结果
     * ```html
     *   <div> <!-- 返回此节点 -->
     *     <div>1</div>
     *     <div><span>2</span></div>
     *   </div>
     * ```
     *
     * @method module:base/element._$html2node
     * @param  {String} arg0 - 代码
     * @return {Node}          节点
     */
    _p._$html2node = (function(){
        var _reg = /<(.*?)(?=\s|>)/i, // first tag name
            _tmap = {li:'ul',tr:'tbody',td:'tr',th:'tr',option:'select'};
        return function(_html){
            var _tag;
            if (_reg.test(_html)){
                _tag = _tmap[(RegExp.$1||'').toLowerCase()]||'';
            }
            var _div = _p._$create(_tag||'div');
            _div.innerHTML = _html;
            var _list = _p._$getChildren(_div);
            return _list.length>1?_div:_list[0];
        };
    })();
    /**
     * 将dom节点转为xml串
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_p){
     *       // 生成<div id="abc">123</div>字符串
     *       var _xml = _p._$dom2xml('abc'));
     *   });
     * ```
     *
     * @see    module:base/element._$xml2dom
     * @method module:base/element._$dom2xml
     * @param  {String|Node} arg0 - 节点
     * @return {String}             XML代码
     */
    /**
     * @method CHAINABLE._$dom2xml
     * @see module:base/element._$dom2xml
     */
    _p._$dom2xml =
    _y._$dom2xml = function(_element){
        _element = _p._$get(_element);
        return !_element?'':_h.__serializeDOM2XML(_element);
    };
    /**
     * 将xml转为dom节点
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 生成<div id="abc">123</div>节点
     *       var _node = _e._$xml2dom('<div id="abc">123</div>');
     *   });
     * ```
     *
     * @method module:base/element._$xml2dom
     * @see    module:base/element._$dom2xml
     * @param  {String} arg0 - xml文本
     * @return {Node}          DOM节点
     */
    _p._$xml2dom = function(_xml){
        _xml = (_xml||'').trim();
        return !_xml?null:_h.__parseDOMFromXML(_xml);
    };
    /**
     * dom节点转对象，多用于XML DOM转数据对象
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     *
     *   <div id="efg">
     *     <p>aaaa</p>
     *     <span>bbbb</span>
     *   </div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_p){
     *       // 返回对象{div:'123'}
     *       var _obj = _p._$dom2object('abc');
     *
     *       // 返回对象{div:{p:'aaaa',span:'bbbb'}}
     *       var _obj = _p._$dom2object('efg');
     *   });
     * ```
     *
     * @method module:base/element._$dom2object
     * @see    module:base/element._$xml2object
     * @param  {String|Node} arg0 - 节点
     * @return {Object}             转换完成的对象
     */
    /**
     * @method CHAINABLE._$dom2object
     * @see module:base/element._$dom2object
     */
    _p._$dom2object =
    _y._$dom2object = function(_dom,_obj){
         _obj = _obj||{};
         _dom = _p._$get(_dom);
         if (!_dom) return _obj;
        var _name = _dom.tagName.toLowerCase(),
            _list = _p._$getChildren(_dom);
        if (!_list||!_list.length){
            _obj[_name] = _dom.textContent||_dom.text||'';
            return _obj;
        }
        var _tmp = {};
        _obj[_name] = _tmp;
        _u._$forEach(
            _list,function(_node){
                _p._$dom2object(_node,_tmp);
            }
        );
        return _obj;
    };
    /**
     * XML转对象
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 返回 {user:{id:'1',username:'aaa',password:'123456'}}
     *       var _obj = _e._$xml2object('\
     *           <?xml version="1.0" encoding="utf-8" ?>\
     *           <user>\
     *             <id>1</id>\
     *             <username>aaa</username>\
     *             <password>123456</password>\
     *           </user>\
     *       ');
     *   });
     * ```
     *
     * @method module:base/element._$xml2object
     * @see    module:base/element._$dom2object
     * @param  {String} arg0 - xml代码
     * @return {Object}        对象
     */
    _p._$xml2object = function(_xml){
        try{
            return _p._$dom2object(_p._$xml2dom(_xml));
        }catch(ex){
            return null;
        }
    };
    /**
     * 文本转指定类型的数据
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 转成dom节点
     *       var _dom = _e._$text2type('<div id="abc">123</div>',"xml");
     *       // 转成json字符串
     *       var _json = _e._$text2type('{"a":"aaaaaaaaaaaaa"}',"json");
     *       // 原样返回
     *       var _text = _e._$text2type('<div id="abc">123</div>');
     *   });
     * ```
     *
     * @method module:base/element._$text2type
     * @param  {String} arg0 - 文本内容
     * @param  {String} arg1 - 类型，如xml/json/text
     * @return {Variable}      指定类型的数据
     */
    _p._$text2type = (function(){
        var _fmap = {
            xml:function(_text){
                return _p._$xml2dom(_text);
            },
            json:function(_text){
                try{
                    return JSON.parse(_text);
                }catch(ex){
                    return null;
                }
            },
            dft:function(_text){
                return _text;
            }
        };
        return function(_text,_type){
            _type = (_type||'').toLowerCase();
            return (_fmap[_type]||_fmap.dft)(_text||'');
        };
    })();
    /**
     * 批量设置节点样式
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       _e._$style('abc',{color:'red',width:'100px'});
     *   });
     * ```
     *
     * 输出结果
     * ```html
     *   <div id="abc" style="color:red;width:100px;">123</div>
     * ```
     *
     * @method module:base/element._$style
     * @see    module:base/element._$setStyle
     * @param  {String|Node} arg0 - 节点
     * @param  {Object}      arg1 - 样式信息{color:'red',width:'100px'}
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$style
     * @see module:base/element._$style
     */
    _p._$style =
    _y._$style = function(_element,_map){
        _element = _p._$get(_element);
        if (!!_element){
            _u._$loop(_map,function(_value,_name){
                _p._$setStyle(_element,_name,_value);
            });
        }
    };
    /**
     * 设置单个样式
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       _e._$setStyle('abc','color','red');
     *   });
     * ```
     *
     * 输出结果
     * ```html
     *   <div id="abc" style="color:red;">123</div>
     * ```
     *
     * @method module:base/element._$setStyle
     * @see    module:base/element._$getStyle
     * @param  {String|Node} arg0 - 节点
     * @param  {String}      arg1 - 样式名称
     * @param  {String}      arg2 - 样式值
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$setStyle
     * @see module:base/element._$setStyle
     */
    _p._$setStyle =
    _y._$setStyle = function(_element,_name,_value){
        _element = _p._$get(_element);
        if (!!_element){
            _h.__setStyleValue(
                _element,_name,
                _h.__processCSSText(_value)
            );
        }
    };
    /**
     * 取样式值
     *
     * 结构举例
     * ```html
     *   <div id="abc" style="color:red;">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 返回节点的颜色值red（高版本浏览器返回rgb值），如果没有返回空字符串
     *       var _value = _e._$getStyle('abc','color');
     *   });
     * ```
     *
     * @method module:base/element._$getStyle
     * @see    module:base/element._$setStyle
     * @param  {String|Node} arg0 - 节点
     * @param  {String}      arg1 - 样式名称
     * @return {String}             样式值
     */
    /**
     * @method CHAINABLE._$getStyle
     * @see module:base/element._$getStyle
     */
    _p._$getStyle =
    _y._$getStyle = function(_element,_name){
        _element = _p._$get(_element);
        return !_element ? '' :
                _h.__getStyleValue(
                    _element,_name
                );
    };
    /**
     * 页面注入脚本
     *
     * 结构举例
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 注入脚本，全局执行环境
     *       _e._$addScript('\
     *           document.getElementById("abc").style.color = "green"\
     *       ');
     *   });
     * ```
     *
     * 输出结果
     * ```html
     *   <div id="abc" style="color:green;">123</div>
     * ```
     *
     * @method module:base/element._$addScript
     * @param  {String} arg0 - 脚本内容
     * @return {Void}
     */
    _p._$addScript = function(_script){
        try{
            _script = _script.trim();
            if (!!_script){
                return (new Function(_script))();
            }
        }catch(ex){
            // ignore
            console.error(ex.message);
            console.error(ex.stack);
        }
    };
    /**
     * 注入页面内联样式，
     * 样式支持前缀标记$&lt;vendor&gt; ，
     * 如下样式值支持3D/2D切换，优先选用3D，格式：$&lt;NAME|VALUE&gt;
     *
     * * NAME支持：scale/rotate/translate/matrix
     * * VALUE格式：x=1&y=2&z=3&a=30
     *
     *
     * 范例如$&lt;scale|a=30&gt;，各名称支持的参数列表
     *
     * | 名称              | 参数 |
     * | :--        | :-- |
     * | scale      | x,y,z |
     * | rotate     | x,y,z,a |
     * | translate  | x,y,z |
     * | matrix     | m11,m12,m13,m14,m21,m22,m23,m24,m31,m32,m33,m34,m41,m42,m43,m44 |
     *
     *
     * 结构举例
     * ```html
     *   <html>
     *    <head>
     *        <title>test</title>
     *    </head>
     *   </html>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 注入样式
     *       _e._$addStyle('body{font-size:20px}');
     *
     *       // 注入样式支持变量
     *       _e._$addStyle('\
     *           .a{$<vendor>transform-origin:0 0;}\
     *           .b{$<vendor>transform:$<translate|x=0&y=1&z=1>}\
     *       ');
     *   });
     * ```
     *
     * 输出结果
     * ```html
     *   <html>
     *    <head>
     *        <title>test</title>
     *        <style>body{font-size:20px;}</style>
     *        <style>
     *           .a{-webkit-transform-origin:0 0;}\
     *           .b{-webkit-transform:translate3d(0,1,1);}\
     *        </style>
     *    </head>
     *   </html>
     * ```
     *
     * @method module:base/element._$addStyle
     * @param  {String} arg0 - 样式内容
     * @return {Node}          样式节点
     */
    _p._$addStyle = (function(){
        var _reg = /[\s\r\n]+/gi;
        return function(_css){
            _css = (_css||'').replace(_reg,' ').trim();
            var _node = null;
            if (!!_css){
                _node = _p._$create('style');
                document.head.appendChild(_node);
                _h.__injectCSSText(
                    _node,_h.__processCSSText(_css)
                );
            }
            return _node;
        };
    })();
    /**
     * 缓存待激活样式
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 设置样式到缓存中，自动生成样式名，返回自动生成的类名#<class>
     *       var _class = _e._$pushCSSText('.#<uispace>{width:300px;}');
     *
     *       // æŠŠç¼“å­˜ä¸­çš„æ ·å¼å†…è”åˆ°é¡µé¢
     *       _e._$dumpCSSText();
     *   });
     * ```
     *
     * @method module:base/element._$pushCSSText
     * @see    module:base/element._$dumpCSSText
     * @param  {String} arg0 - æ ·å¼
     * @return {String}        æ ·å¼æ ‡è¯†
     */
    _p._$pushCSSText = (function(){
        var _reg = /#<(.*?)>/g,
            _seed = +new Date;
        return function(_css,_data){
            if (!_cspol){
                _cspol = [];
            }
            var _class = 'auto-'+_u._$uniqueID(),
                _dmap = _u._$merge({uispace:_class},_data);
            _cspol.push(
                _css.replace(_reg,function($1,$2){
                    return _dmap[$2]||$1;
                })
            );
            return _class;
        };
    })();
    /**
     * æ¿€æ´»ç¼“å­˜ä¸­çš„æ ·å¼
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" class="item">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // è®¾ç½®æ ·å¼.item{width:300px;}åˆ°ç¼“å­˜ä¸­
     *       _e._$pushCSSText('.item{width:300px;}');
     *
     *       // æŠŠç¼“å­˜ä¸­çš„æ ·å¼å†…è”åˆ°é¡µé¢
     *       _e._$dumpCSSText();
     *   });
     * ```
     *
     * @method module:base/element._$dumpCSSText
     * @see    module:base/element._$pushCSSText
     * @return {Void}
     */
    _p._$dumpCSSText = function(){
        if (!!_cspol){
            _p._$addStyle(_cspol.join(' '));
            _cspol = null;
        }
    };
    /**
     * è¿½åŠ CSSè§„åˆ™
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <style id="abc"></style>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // è®¾ç½®æ ·å¼.item{width:300px;}åˆ°ç¼“å­˜ä¸­
     *       _e._$appendCSSText('node-id','.item{width:300px;}');
     *   });
     * ```
     *
     * @method module:base/element._$appendCSSText
     * @see    module:base/element._$addStyle
     * @param  {Node}   arg0 - æ ·å¼èŠ‚ç‚¹
     * @param  {String} arg1 - å•æ¡æ ·å¼è§„åˆ™
     * @return {CSSRule}       æ ·å¼è§„åˆ™å¯¹è±¡
     */
    /**
     * @method CHAINABLE._$appendCSSText
     * @see module:base/element._$appendCSSText
     */
    _p._$appendCSSText =
    _y._$appendCSSText = function(_element,_css){
        _element = _p._$get(_element);
        return !_element ? null :
                _h.__appendCSSText(
                    _element,
                    _h.__processCSSText(_css)
                );
    };
    /**
     * æ–°å¢žæ ·å¼ç±»ï¼Œå¤šä¸ªæ ·å¼ç”¨ç©ºæ ¼åˆ†å¼€
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // æ·»åŠ æ ·å¼ fc01 fc03
     *       _e._$addClassName('abc','fc01 fc03');
     *   });
     * ```
     *
     * è¾“å‡ºç»“æžœ
     * ```html
     *   <div id="abc" class="fc01 fc03">123</div>
     * ```
     *
     * @method module:base/element._$addClassName
     * @see    module:base/element._$delClassName
     * @see    module:base/element._$replaceClassName
     * @param  {String|Node} arg0 - è¦æ“ä½œçš„èŠ‚ç‚¹æ ‡è¯†æˆ–è€…èŠ‚ç‚¹å¯¹è±¡
     * @param  {String}      arg1 - è¦æ–°å¢žçš„æ ·å¼ç±»åç§°
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$addClassName
     * @see module:base/element._$addClassName
     */
    _p._$addClassName =
    _y._$addClassName = function(_element,_class){
        if (!_class){
            return;
        }
        _element = _p._$get(_element);
        if (!!_element){
            _h.__processClassName(
                _element,'add',_class
            );
        }
    };
    /**
     * åˆ é™¤æ ·å¼ç±»ï¼Œå¤šä¸ªæ ·å¼ç”¨ç©ºæ ¼åˆ†å¼€
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" class="fc01 fc03">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // åˆ é™¤fc02 fc03æ ·å¼å
     *       _e._$delClassName('abc','fc02 fc03');
     *   });
     * ```
     *
     * è¾“å‡ºç»“æžœ
     * ```html
     *   <div id="abc" class="fc01">123</div>
     * ```
     *
     * @method module:base/element._$delClassName
     * @see    module:base/element._$addClassName
     * @see    module:base/element._$replaceClassName
     * @param  {String|Node} arg0 - è¦æ“ä½œçš„èŠ‚ç‚¹æ ‡è¯†æˆ–è€…èŠ‚ç‚¹å¯¹è±¡
     * @param  {String}      arg1 - è¦åˆ é™¤çš„æ ·å¼ç±»åç§°
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$delClassName
     * @see module:base/element._$delClassName
     */
    _p._$delClassName =
    _y._$delClassName = function(_element,_class){
        _element = _p._$get(_element);
        if (!!_element){
            _h.__processClassName(
                _element,'remove',_class
            );
        }
    };
    /**
     * æ›¿æ¢èŠ‚ç‚¹çš„æ ·å¼ç±»åç§°ï¼Œå¤šä¸ªæ ·å¼ç”¨ç©ºæ ¼åˆ†éš”ï¼Œ
     * æ“ä½œè¿‡ç¨‹ä¸ºå…ˆåˆ é™¤å¾…åˆ æ ·å¼ï¼Œå†æ·»åŠ å¾…æ·»æ ·å¼ï¼Œå› æ­¤ä¸éœ€è¦åˆ é™¤æ ·å¼å­˜åœ¨æ‰æ·»åŠ æ ·å¼
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" class="fc01 fc03">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // æ›¿æ¢fc02ä¸ºfc05
     *       // è¿™é‡Œä¸éœ€è¦fc02å­˜åœ¨
     *       _e._$replaceClassName('abc','fc02','fc05');
     *   });
     * ```
     *
     * è¾“å‡ºç»“æžœ
     * ```html
     *   <div id="abc" class="fc01 fc03 fc05">123</div>
     * ```
     *
     * @method module:base/element._$replaceClassName
     * @see    module:base/element._$addClassName
     * @see    module:base/element._$delClassName
     * @param  {String|Node} arg0 - è¦æ“ä½œçš„èŠ‚ç‚¹æ ‡è¯†æˆ–è€…èŠ‚ç‚¹å¯¹è±¡
     * @param  {String}      arg1 - è¦åˆ é™¤çš„æ ·å¼ç±»åç§°
     * @param  {String}      arg2 - è¦æ–°å¢žçš„æ ·å¼ç±»åç§°
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$replaceClassName
     * @see module:base/element._$replaceClassName
     */
    _p._$replaceClassName =
    _y._$replaceClassName = function(_element,_del,_add){
        _element = _p._$get(_element);
        if (!!_element){
            _h.__processClassName(
                _element,'replace',
                _del,_add
            );
        }
    };
    /**
     * æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦åŒ…å«æŒ‡å®šæ ·å¼ï¼Œå¤šä¸ªæ ·å¼ç”¨ç©ºæ ¼åˆ†éš”ï¼Œæ£€æµ‹æ—¶åŒ…å«å…¶ä¸­ä¹‹ä¸€å³è¡¨ç¤ºåŒ…å«
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     *   <div id="abc" class="fc01 fc03">123</div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // å¦‚æžœæœ‰fc01æ ·å¼è¿”å›žtrueï¼Œå¦åˆ™è¿”å›žfalse
     *       _e._$hasClassName('abc',"fc01");
     *   });
     * ```
     *
     * @method module:base/element._$hasClassName
     * @param  {String|Node} arg0 - èŠ‚ç‚¹æ ‡è¯†æˆ–è€…å¯¹è±¡
     * @param  {String}      arg1 - æ ·å¼ä¸²
     * @return {Boolean}            æ˜¯å¦å«æŒ‡å®šæ ·å¼
     */
    /**
     * @method CHAINABLE._$hasClassName
     * @see module:base/element._$hasClassName
     */
    _p._$hasClassName =
    _y._$hasClassName = function(_element,_class){
        _element = _p._$get(_element);
        if (!!_element){
            return _h.__hasClassName(_element,_class);
        }
        return !1;
    };
    /**
     * å–æ ·å¼å˜æ¢çŸ©é˜µå¯¹è±¡
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // ç”Ÿæˆä¸‹é¢çŸ©é˜µçš„å¯¹è±¡
     *       // |a:1,b:0,c:0,d:1,e:0:f:0|
     *       // |m11:1,m12:0,m13:0,m14:0|
     *       // |m21:0,m22:1,m23:0,m24:0|
     *       // |m31:0,m32:0,m33:1,m34:0|
     *       // |m41:0,m42:0,m43:0,m44:1|
     *       var _matrix = _e._$matrix("matrix(1,0,0,1,0,0)");
     *   });
     * ```
     *
     * @method module:base/element._$matrix
     * @param  {String} arg0 - 变化信息
     * @return {CSSMatrix}     变换矩阵对象
     */
    _p._$matrix = function(_matrix){
        _matrix = (_matrix||'').trim();
        return _h.__getCSSMatrix(_matrix);
    };
    /**
     * 设置3D变换，对于不支持3D的系统自动切换为2D变换
     *
     * 结构举例
     * ```html
     *   <div id="abc"></div>
     * ```
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/element'
     *   ],function(_e){
     *       // 进行css3d变换，对应css样式为-webkit-transform:rotate3d( 2, 1, 1, -75deg);
     *       _e._$css3d('abc','rotate',{x:2,y:1,z:1,a:'-75deg'});
     *   });
     * ```
     *
     * @method module:base/element._$css3d
     * @see    module:base/element._$addStyle
     * @param  {String|Node} arg0 - 节点标识或者对象
     * @param  {String}      arg1 - 变换类型，matrix/translate/scale/rotate
     * @param  {Object}      arg2 - 变换值，{x:1,y:2,z:3,a:'30deg'}
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$css3d
     * @see module:base/element._$css3d
     */
    _p._$css3d =
    _y._$css3d = function(_element,_name,_map){
        _element = _p._$get(_element);
        if (!!_element){
            var _value = _h.__processTransformValue(_name,_map);
            if (!!_value){
                _p._$setStyle(_element,'transform',_value);
            }
        }
    };
    // for chainable
    _x._$merge(_y);

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','036fce036df53014afe007bfc84b3324','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','cefc834b106876d285d05b428248ca57','d31c62fd4ff120ba19d9eefb884aee57');
/*
 * TrimPath Template. Release 1.1.2.
 * Copyright (C) 2004 - 2007 TrimPath.
 * 
 * TrimPath Template is licensed under the GNU General Public License
 * and the Apache License, Version 2.0, as follows:
 *
 * This program is free software; you can redistribute it and/or 
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed WITHOUT ANY WARRANTY; without even the 
 * implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
 * See the GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*
 * ------------------------------------------
 * JST模板引擎实现文件
 * 实现原理参考trimpath项目 (GPL & APL)
 * http://code.google.com/p/trimpath/
 * @version  1.0
 * @author   genify(caijf@corp.netease.com)
 * ------------------------------------------
 */
(function(){
    /**
     * TrimPath模版引擎名字空间
     * @namespace TrimPath
     */
    // init TrimPath
    if (typeof TrimPath==='undefined'){
        TrimPath = {};
        if (typeof exports!=='undefined')
            TrimPath = exports;
    }
    // variable declaration
    var _tcache = {}, // jst string cache
        _stack  = [], // loop statement stack
        _rspc   = /\s+/g,
        _seed   = +new Date,
        _trim,_config,_vars;
    /*
     * 解析表达式中变量信息，如
     * a.b(c,d) || d('aaaa',f,g) && !!test() || 'eeee'
     * @param  {String} 内容
     * @return {Void}
     */
    var _doParseVars = (function(){
        var _reg0 = /^\s*[\[\{'"].*?[\]\}'"]\s*$/,
            _reg1 = /[\&\|\<\>\+\-\*\/\%\,\(\)\[\]\?\:\!\=\;]/,
            // keyword extend later
            _reg2 = /^(?:defined|null|undefined|true|false|instanceof|new|this|typeof|\$v|[\d]+)$/i,
            // statement extend later
            // new XX
            _reg3 = /^new\s+/,
            _reg4 = /['"]/;
        var _doParseSimple = function(_value){
            if (_reg0.test(_value)) return;
            _value = _value.split('.')[0].trim();
            if (!_value||_reg4.test(_value)) return;
            _value = _value.replace(_reg3,'');
            //console.log('-->'+_value+'<--');
            try{
                if (_reg2.test(_value))
                    return;
                _vars[_value] = 1;
                //console.log('=====>'+_value+'<====');
            }catch(e){
                // ignore
            }
        };
        return function(_content){
            _content = _content||'';
            // for string/array
            if (!_content||_reg0.test(_content)) 
                return;
            var _arr = _content.split(_reg1);
            for(var i=0,l=_arr.length;i<l;i++)
                _doParseSimple(_arr[i]);
        };
    })();
    /*
     * 解析{for x in b}字符串的前缀
     * @param  {Array}  按空格拆分的值,['for','x','in','b']
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixFor = function(_part){
        if (_part[2]!='in')
            throw 'bad for loop statement: '+_part.join(' ');
        _stack.push(_part[1]);
        // b is array or has [1,2,4],{a:'aaa',b:'bbb'}
        _doParseVars(_part[3]);
        return 'var __HASH__'+_part[1]+' = '+_part[3]+','+
                    _part[1]+','+_part[1]+'_count=0;'+
               'if (!!__HASH__'+_part[1]+')'+
                   'for(var '+_part[1]+'_key in __HASH__'+_part[1]+'){'+
                        _part[1]+' = __HASH__'+_part[1]+'['+_part[1]+'_key];'+
                        'if (typeof('+_part[1]+')=="function") continue;'+
                        _part[1]+'_count++;';
    };
    /*
     * 解析{forelse}字符串的前缀
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixForElse = function(){
        var _part = _stack[_stack.length-1];
        return '}; if(!__HASH__'+_part+'||!'+_part+'_count){';
    };
    /*
     * 解析{/for}字符串的前缀
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixForEnd = function(){
        _stack.pop();
        return '};';
    };
    /*
     * 解析{list seq as x}或者{list 1..100 as x}字符串的前缀
     * @param  {Array}  按空格拆分的值,['list','seq','as','x']
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixList = function(_part){
        if (_part[2]!='as')
            throw 'bad for list loop statement: '+_part.join(' ');
        var _seq = _part[1].split('..');
        if (_seq.length>1){
            // {list 1..100 as x}
            _doParseVars(_seq[0]);
            _doParseVars(_seq[1]);
            return 'for(var '+_part[3]+','+_part[3]+'_index=0,'+
                        _part[3]+'_beg='+_seq[0]+','+_part[3]+'_end='+_seq[1]+','+
                        _part[3]+'_length=parseInt('+_part[3]+'_end-'+_part[3]+'_beg+1);'+
                        _part[3]+'_index<'+_part[3]+'_length;'+_part[3]+'_index++){'+
                        _part[3]+' = '+_part[3]+'_beg+'+_part[3]+'_index;';
        }else{
            // {list seq as x}
            // seq is array [1,2,4]
            _doParseVars(_part[1]);
            return 'for(var __LIST__'+_part[3]+' = '+_part[1]+','+
                        _part[3]+','+_part[3]+'_index=0,'+
                        _part[3]+'_length=__LIST__'+_part[3]+'.length;'+
                        _part[3]+'_index<'+_part[3]+'_length;'+_part[3]+'_index++){'+
                        _part[3]+' = __LIST__'+_part[3]+'['+_part[3]+'_index];';
        }
    };
    /*
     * 解析{macro macroName(arg1,arg2,...argN)}字符串的前缀
     * @param  {Array}  按空格拆分的值,['macro','macroName(arg1,arg2,...argN)']
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixMacro = function(_part){
        if (!_part||!_part.length) return;
        _part.shift(); // remove macro key word
        var _name = _part[0].split('(')[0];
        return 'var '+_name+' = function'+_part.join('').replace(_name,'')+'{var __OUT=[];';
    };
    /*
     * 解析{include "text-template-id"}字符串前缀
     * @param  {Array}  按空格拆分的值,['include','"text-template-id"']
     * @return {String} 解析后的前缀值
     */
    var _doParsePrefixInline = function(_part){
        if (!_part[1]) 
            throw 'bad include statement: '+_part.join(' ');
        return 'if (typeof inline == "function"){__OUT.push(inline(';
    };
    /**
     * 解析IF语句前缀，{if customer != null && customer.balance > 1000 || test(customer)}
     * @param  {String}  返回值
     * @param  {Array}   按空格拆分的值
     * @return {String}  解析后的前缀值
     */
    var _doParsePrefixCondition = function(_prefix,_part){
        _doParseVars(_part.slice(1).join(' '));
        return _prefix;
    };
    // parse prefix condition
    var _doParsePrefixConditionIF = function(_part){
        return _doParsePrefixCondition('if(',_part);
    };
    var _doParsePrefixConditionELSEIF = function(_part){
        return _doParsePrefixCondition('}else if(',_part);
    };
    var _doParsePrefixConditionVAR = function(_part){
        return _doParsePrefixCondition('var ',_part);
    };
    // jst configuration
    _config = {
        blk : /^\{(cdata|minify|eval)/i,
        tag : 'forelse|for|list|if|elseif|else|var|macro|break|notrim|trim|include',
        // {pmin : min param number,
        //  pdft : param default value,
        //  pfix : statement prefix,
        //  sfix : statement suffix}
        def : {
            'if'     : {pfix:_doParsePrefixConditionIF,sfix:'){',pmin:1},
            'else'   : {pfix:'}else{'},
            'elseif' : {pfix:_doParsePrefixConditionELSEIF,sfix:'){',pdft:'true'},
            '/if'    : {pfix:'}'},
            'for'    : {pfix:_doParsePrefixFor,pmin:3},
            'forelse': {pfix:_doParsePrefixForElse},
            '/for'   : {pfix:_doParsePrefixForEnd},
            'list'   : {pfix:_doParsePrefixList,pmin:3},
            '/list'  : {pfix:'};'},
            'break'  : {pfix:'break;'},
            'var'    : {pfix:_doParsePrefixConditionVAR,sfix:';'},
            'macro'  : {pfix:_doParsePrefixMacro},
            '/macro' : {pfix:'return __OUT.join("");};'},
            'trim'   : {pfix:function(){_trim = !0;}},
            '/trim'  : {pfix:function(){_trim = null;}},
            'inline' : {pfix:_doParsePrefixInline,pmin:1,sfix:'));}'}
        },
        ext : {
            'seed'   : function(_prefix){return (_prefix||'')+''+_seed;},
            'default': function(_value,_default){return _value||_default;}
        }
    };
    /*
     * 解析语句，如{if customer != null && customer.balance > 1000}
     * @param  {String} 待解析语句
     * @param  {Array}  内容输出
     * @return {Void}
     */
    var _doParseStatement = (function(){
        var _rbrc = /\\([\{\}])/g;
        return function(_content,_out){
            _content = _content.replace(_rbrc,'$1');
            //console.log('++++>'+_content);
            var _part = _content.slice(1, -1).split(_rspc),
                _conf = _config.def[_part[0]];
            if (!_conf){_doParseSectionText(_content,_out);return;}
            if (!!_conf.pmin&&_conf.pmin>=_part.length)
                throw 'Statement needs more parameters:'+_content;
            // parse prefix
            _out.push((!!_conf.pfix&&
                       typeof(_conf.pfix)!='string')
                       ?_conf.pfix(_part):(_conf.pfix||''));
            // parse params and suffix
            if (!!_conf.sfix){
                if (_part.length<=1) {
                    if (!!_conf.pdft) _out.push(_conf.pdft);
                }else{
                    for(var i=1,l=_part.length;i<l;i++){
                        if (i>1) _out.push(' ');
                        _out.push(_part[i]);
                    }
                }
                _out.push(_conf.sfix);
            }
        };
    })();
    /*
     * 解析表达式，如['firstName','default:"John Doe"','capitalize']
     * @param  {Array}  表达式内容
     * @param  {Number} 表达式索引
     * @param  {Array}  内容输出
     * @return {Void}
     */
    var _doParseExpression = function(_exps,_out){
        // foo|a:x|b:y1,y2|c:z1,z2 -> c(b(a(foo,x),y1,y2),z1,z2)
        if (!_exps||!_exps.length) return;
        if (_exps.length==1){
            var _var = _exps.pop();
            _doParseVars(_var);
            // fix error for ${}
            _out.push(_var==''?'""':_var);
            return;
        }
        var _exp = _exps.pop().split(':');
        _out.push('__MDF[\''+_exp.shift()+'\'](');
        _doParseExpression(_exps,_out);
        if (_exp.length>0){
            var _args = _exp.join(':');
            _doParseVars(_args);
            _out.push(','+_args);
        }
        _out.push(')');
    };
    /*
     * 解析内容，内容中可能包含换行
     * @param  {String} 待解析语句
     * @param  {Array}  内容输出
     * @return {Void}
     */
    var _doParseSectionText = function(_content,_out){
        if (!_content) return;
        var _lines = _content.split('\n');
        if (!_lines||!_lines.length) return;
        for(var i=0,l=_lines.length,_line;i<l;i++){
            _line = _lines[i];
            if (!!_trim){
                _line = _line.trim();
                if (!_line) continue;
            } 
            _doParseSectionTextLine(_line,_out);
            if (!!_trim&&i<l-1) _out.push('__OUT.push(\'\\n\');');
        }
    };
    /*
     * 解析内容，内容中可能包含${a}或者${%a%}取值语句
     * @param  {String} 待解析语句
     * @param  {Array}  内容输出
     * @return {Void}
     */
    var _doParseSectionTextLine = (function(){
        var _raor = /\|\|/g,
            _rvor = /#@@#/g;
        return function(_content,_out){
            // defined used variable
            var _prvmrkend = '}',_prvexpend = -1,
                _length = _content.length,
                _begin,_end,_begexp,_endexp,_exparr;
            while((_prvexpend+_prvmrkend.length)<_length){
                _begin = '${'; _end = '}';
                _begexp = _content.indexOf(_begin,_prvexpend+_prvmrkend.length);
                if (_begexp<0) break;
                // parse ${% customer.firstName %} syntax
                if (_content.charAt(_begexp+2)=='%'){
                    _begin = '${%'; _end = '%}';
                }
                _endexp = _content.indexOf(_end,_begexp+_begin.length);
                if (_endexp<0) break;
                _doParseText(_content.substring(_prvexpend+_prvmrkend.length,_begexp),_out);
                // parse expression: 'firstName|default:"John Doe"|capitalize'.split('|')
                _exparr = _content.substring(_begexp+_begin.length,_endexp).replace(_raor,'#@@#').split('|');
                for(var i=0,l=_exparr.length;i<l;_exparr[i]=_exparr[i].replace(_rvor,'||'),i++);
                _out.push('__OUT.push('); _doParseExpression(_exparr,_out); _out.push(');');
                _prvmrkend = _end; _prvexpend = _endexp;
            }
            _doParseText(_content.substring(_prvexpend+_prvmrkend.length),_out);
        };
    })();
    /*
     * 解析纯文本内容，不包含需要解析的内容
     * @param  {String} 待解析内容
     * @param  {Array}  内容输出
     * @return {Void}
     */
    var _doParseText = (function(){
        var _map = {r:/\n|\\|\'/g,'\n':'\\n','\\':'\\\\','\'':'\\\''};
        var _doEncode = function(_content){
            return (_content||'').replace(_map.r,function($1){
                return _map[$1]||$1;
            });
        };
        return function(_content,_out){
            if (!_content) return;
            _out.push('__OUT.push(\''+_doEncode(_content)+'\');');
        };
    })();
    /*
     * 解析模板为执行函数
     * @param  {String}   模板内容
     * @return {Function} 模板执行函数
     */
    var _doParseTemplate = (function(){
        var _rtab = /\t/g,
            _rnln = /\n/g,
            _rlne = /\r\n?/g;
        var _doSearchEnd = function(_content,_begin){
            var _index = _content.indexOf("}",_begin+1);
            // for {for x in \{a:'aaa',b:'bbbb'\}}
            while(_content.charAt(_index-1)=='\\'){
                _index = _content.indexOf("}",_index+1);
            }
            return _index;
        };
        var _doParseVarMap = function(){
            var _arr = [],
                _arg = arguments[0];
            for(var x in _arg){
                x = (x||'').trim();
                if (!x) continue;
                _arr.push(x+'=$v(\''+x+'\')');
            }
            return _arr.length>0?('var '+_arr.join(',')+';'):'';
        };
        return function(_content){
            _vars = {};
            _content = _content.replace(_rlne,'\n').replace(_rtab,'    ');
            var _ftxt = ['if(!__CTX) return \'\';',''];
            _ftxt.push('function $v(__NAME){var v = __CTX[__NAME];return v==null?window[__NAME]:v;};');
            _ftxt.push('var defined=function(__NAME){return __CTX[__NAME]!=null;},');
            _ftxt.push('__OUT=[];');
            // defiend used variables
            var _prvend = -1,_length = _content.length;
            var _stmtbeg,_stmtend,_statement,
                _blockrx,_blktmp,_blkend,_blkmrk,_blktxt;
            // search content
            while((_prvend+1)<_length){
                // search statement begin
                _stmtbeg = _prvend;
                _stmtbeg = _content.indexOf("{",_stmtbeg+1);
                while(_stmtbeg>=0){
                    _stmtend = _doSearchEnd(_content,_stmtbeg);
                    _statement = _content.substring(_stmtbeg,_stmtend);
                    _blockrx = _statement.match(_config.blk);
                    // minify/eval/cdata implementation
                    if (!!_blockrx){
                        _blktmp = _blockrx[1].length+1;
                        _blkend = _content.indexOf('}',_stmtbeg+_blktmp);
                        if (_blkend>=0){
                            // gen block end marker
                            _blkmrk = _blkend-_stmtbeg-_blktmp<=0
                                    ? ('{/'+_blockrx[1]+'}')
                                    : _statement.substr(_blktmp+1);
                            _blktmp = _content.indexOf(_blkmrk,_blkend+1);
                            // parse block content
                            if (_blktmp>=0){
                                _doParseSectionText(_content.substring(_prvend+1,_stmtbeg),_ftxt);
                                // get block text and parse
                                _blktxt = _content.substring(_blkend+1,_blktmp);
                                switch(_blockrx[1]){
                                    case 'cdata' : _doParseText(_blktxt,_ftxt); break;
                                    case 'minify': _doParseText(_blktxt.replace(_rnln,' ').replace(_rspc,' '),_ftxt); break;
                                    case 'eval'  : if (!!_blktxt) _ftxt.push('__OUT.push((function(){'+_blktxt+'})());'); break;
                                }
                                _stmtbeg = _prvend = _blktmp+_blkmrk.length-1;
                            }
                        }
                    }else if(_content.charAt(_stmtbeg-1)!='$'&&
                             _content.charAt(_stmtbeg-1)!='\\'&&
                             _statement.substr(_statement.charAt(1)=='/'?2:1)
                                                         .search(_config.tag)==0){
                        // break when result is a statement
                        break;
                    }
                    _stmtbeg = _content.indexOf("{",_stmtbeg+1);
                }
                if (_stmtbeg<0) break;
                _stmtend = _doSearchEnd(_content,_stmtbeg);
                if (_stmtend<0) break;
                // parse content
                _doParseSectionText(_content.substring(_prvend+1,_stmtbeg),_ftxt);
                _doParseStatement(_content.substring(_stmtbeg,_stmtend+1),_ftxt);
                _prvend = _stmtend;
            }
            _doParseSectionText(_content.substring(_prvend+1),_ftxt);
            _ftxt.push(';return __OUT.join("");'); 
            _ftxt[1] = _doParseVarMap(_vars);
            _vars = null;
            //console.log(_ftxt.join(''));
            return new Function('__CTX','__MDF',_ftxt.join(''));
        };
    })();
    // interface
    /**
     * 取模板随机数种子
     *
     * 代码举例
     * ```javascript
     * NEJ.define([
     *     'util/template/trimpath.nej'
     * ],function(){
     *     // 模版统一随机标识
     *     var _seed = TrimPath.seed();
     * });
     * ```
     * 
     * @method TrimPath.seed
     * @return {String} 随机数种子
     */
    TrimPath.seed = function(){
        return _seed;
    };
    /**
     * 根据模板的序列号合并模板数据
     * 
     * 代码举例
     * ```javascript
     * NEJ.define([
     *     'util/template/trimpath'
     * ],function(){
     *     // 模版合并数据
     *     var _html = TrimPath.merge(
     *         _jst_id,{
     *             a:'aaaaaa',
     *             b:'bbbbbbbbbb',
     *             c:'cccccccccccc'
     *         }
     *     );
     * });
     * ```
     *
     * @method TrimPath.merge
     * @param  {String} arg0 - 模板序列号
     * @param  {Object} arg1 - 模板数据
     * @param  {Object} arg2 - 扩展接口
     * @return {String}        合并数据后的内容
     */
    TrimPath.merge = (function(){
        var _fcache = {};
        // for test
        TrimPath.dump = function(){
            return {
                func:_fcache,
                text:_tcache
            };
        };
        return function(_sn,_data,_extend){
            try{
                _data = _data||{};
                if (!_fcache[_sn]&&!_tcache[_sn])
                    return '';
                if (!_fcache[_sn]){
                    _fcache[_sn] = _doParseTemplate(_tcache[_sn]);
                    delete _tcache[_sn];
                }
                if (!!_extend){
                    for(var x in _config.ext)
                        if (!_extend[x])
                            _extend[x] = _config.ext[x];
                }
                return _fcache[_sn](_data,_extend||_config.ext);
            }catch(ex){
                return ex.message||'';
            }
        };
    })();
    /**
     * 添加JST模板，JST模板可以是节点的值
     *
     * 代码举例
     * ```javascript
     * NEJ.define([
     *     'util/template/trimpath'
     * ],function(){
     *     // 解析缓存模版
     *     var _jst_id = TrimPath.merge(
     *         '<div>\
     *              <p>${a}</p>\
     *              <p>${b}</p>\
     *              <p>${c}</p>\
     *          </div>'
     *     );
     * });
     * ```
     *
     * @method TrimPath.parse
     * @param  {String}  arg0 - JST模板内容
     * @param  {Boolean} arg1 - 是否保留节点
     * @return {String}         JST模板在缓存中的标识
     */
    TrimPath.parse = (function(){
        var _xeed = +new Date;
        return function(_content,_sn){
            if (!_content) return '';
            _sn = _sn||('ck-'+(_xeed++));
            if (_tcache[_sn]!=null){
                console.warn('jst template overwrited with key '+_sn);
                console.debug('old template content: '+_tcache[_sn].replace(/\n/g,' '));
                console.debug('new template content: '+_content.replace(/\n/g,' '));
            }
            _tcache[_sn] = _content;
            return _sn;
        };
    })();
})();
I$('1b12378d868a5877d4dba65367942b75',function (NEJ,_u,_e,_x,_t,_p,_o,_f,_r){
    var _ext = {};
    /**
     * 取模板随机数种子
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/jst'
     * ],function(_p){
     *     // 返回一个标识符
     *     var _seed = _p._$seed();
     * });
     * ```
     *
     * @method module:util/template/jst._$seed
     * @return {String} 随机数种子
     */
    _p._$seed = TrimPath.seed;
    /**
     * 根据模板的序列号合并模板数据
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/jst'
     * ],function(_p){
     *     // 添加模版
     *     var _html_seed =  _p._$add('<div>${name}</div>');
     *     // 生成结构<div>jack</div>
     *     var _html = _p._$get(_html_seed,{name:'jack'});
     * });
     * ```
     *
     * @method module:util/template/jst._$get
     * @see    module:util/template/jst._$add
     * @param  {String} arg0 - 模板序列号
     * @param  {Object} arg1 - 模板数据
     * @param  {Object} arg2 - 扩展接口
     * @return {String}        合并数据后的内容
     */
    _p._$get = (function(){
        var _doInline = function(_id){
            return !_p._$getTextTemplate?'':
                    _p._$getTextTemplate(_id);
        };
        return function(_sn,_data,_extend){
            _data = _data||{};
            _data.inline = _doInline;
            _extend = _u._$merge({},_ext,_extend);
            _extend.rand = _u._$uniqueID;
            _extend.format = _u._$format;
            _extend.escape = _u._$escape;
            _extend.inline = _doInline;
            return TrimPath.merge(_sn,_data,_extend);
        };
    })();
    /**
     * 添加JST模板，JST模板可以是节点的值
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/jst'
     * ],function(_p){
     *     // 添加模版缓存
     *     var _html_seed =  _p._$add('<div>${name}</div>');
     * });
     * ```
     *
     * @method module:util/template/jst._$add
     * @see    module:util/template/jst._$get
     * @param  {String}  arg0 - JST模板内容或者节点ID
     * @param  {Boolean} arg1 - 是否保留节点
     * @return {String}         JST模板在缓存中的序列号
     */
    _p._$add = function(_content,_keep){
        if (!_content) return '';
        var _sn,_element = _e._$get(_content);
        if (!!_element){
            _sn = _element.id;
            _content = _element.value||_element.innerText;
            if (!_keep) _e._$remove(_element);
        }
        return TrimPath.parse(_content,_sn);
    };
    /**
     * 添加JST模板内容
     * 
     * @method module:util/template/jst._$addTemplate
     * @see    module:util/template/jst._$add
     * @param  {String}  arg0 - JST模板内容
     * @param  {String}  arg1 - 模板标识
     * @return {String}         JST模板在缓存中的序列号
     */
    _p._$addTemplate = function(_content,_sn){
        return TrimPath.parse(_content,_sn);
    };
    /**
     * 整合模板后输出至指定容器节点
     *
     * 结构举例
     * ```html
     * <div id="box">aaa</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/jst'
     * ],function(_p){
     *     // 添加模版缓存
     *     var _html_seed =  _p._$add('<div>${name}</div>');
     *     // 把结构塞到box中，生成<div id="box"><div>jack</div></div>
     *     _p._$render('box',_html_seed,{name:'jack'});
     * });
     * ```
     *
     * @method module:util/template/jst._$render
     * @param  {String|Node} arg0 - 容器节点
     * @param  {String}      arg1 - 模板序列号
     * @param  {Object}      arg2 - 模板数据
     * @param  {Object}      arg3 - 扩展接口
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$render
     * @see module:util/template/jst._$render
     */
    _p._$render = function(_parent,_sn,_data,_extend){
        _parent = _e._$get(_parent);
        if (!!_parent){
            _parent.innerHTML =
                _p._$get(_sn,_data,_extend);
        }
    };
    /**
     * 注册JST扩展方法
     *
     * 结构举例
     * ```html
     * <textarea name="jst" id="abc">
     *   <div>
     *     <p>${name|a|b}</p>
     *   </div>
     * </textarea>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/jst'
     * ],function(_p){
     *     // 注册扩展方法 a和b
     *     _p._$extend({
     *         a:function(){},
     *         b:function(){}
     *     });
     *     // 模板整合数据
     *     _p._$render(
     *         'box','abc',{name:'jack'}
     *     );
     * });
     * ```
     *
     * @method module:util/template/jst._$extend
     * @param  {Object} arg0 - 扩展方法
     * @return {Void}
     */
    _p._$extend = function(_map){
        _u._$merge(_ext,_map);
    };
    // for chainable method
    _x._$merge({_$render:_p._$render});

    if (CMPT){ 
        var _z = NEJ.P('nej.e');
        _z._$addHtmlTemplate     = _p._$add;
        _z._$getHtmlTemplate     = _p._$get;
        _z._$getHtmlTemplateSeed = _p._$seed;
        _z._$renderHtmlTemplate  = _p._$render;
        _z._$registJSTExt        = _p._$extend;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','cefc834b106876d285d05b428248ca57','41f91c7238c4e37a29decb52d979ad21');
I$('b3c0f3ceba0c279f7e6de06836b8d2f0',function (NEJ,_k,_v,_u,_p,_o,_f,_r){
    var _pro;
    /**
     * 控件基类，主要实现以下功能：
     * * 对事件驱动编程模型的支持
     * * 对控件通用行为及业务逻辑的抽象
     * 
     * ```javascript
     *   NEJ.define([
     *       'base/klass',
     *       'util/event'
     *   ],function(_k,_t,_p,_o,_f,_r){
     *       // 自定义一个控件及使用、回收的流程
     *       var _pro;
     *   
     *       // 第一步
     *       // 定义控件类，从父类继承
     *       _p._$$Widget = _k._$klass();
     *       _pro = _p._$$Widget._$extend(_t._$$EventTarget);
     *   
     *       // 第二步
     *       // 重写控件初始化业务逻辑
     *       _pro.__init = function(_options){
     *           // _options - 配置参数信息
     *           //            初始化时一般不对该参数做处理
     *           // 调用父类初始化业务逻辑
     *           this.__super(_options);
     *           // TODO something
     *       };
     *   
     *       // 第三步
     *       // 重写控件重置业务逻辑
     *       _pro.__reset = function(_options){
     *           // _options - 配置参数信息
     *           //            此处重置控件配置信息
     *           // 调用父类重置业务逻辑
     *           this.__super(_options);
     *           // TODO something
     *       };
     *   
     *       // 第四步
     *       // 重写控件回收业务逻辑
     *       _pro.__destroy = function __destroy(){
     *           // 调用父类回收业务逻辑
     *           this.__super();
     *           // TODO something
     *       };
     *   
     *       // 第五步
     *       // 使用控件
     *       var _widget = _p._$$Widget._$allocate({
     *           a:'aaaaaaaaaaa',
     *           b:'bbbbbbbbbbbbb',
     *           c:'ccccccccccccccc'
     *       });
     *   
     *       // 第六步
     *       // 回收控件
     *       _widget = _widget._$recycle();
     *       // 也可以使用以下方式回收，建议使用上面的回收方式
     *       _widget = _p._$$Widget._$recycle(_widget);
     *   });
     * ```
     * 
     * @class module:util/event._$$EventTarget
     * @param {Object} config - 配置参数，根据控件实际情况提供配置参数支持
     */
    /** 
     * 控件回收前触发事件，控件在具体实现时如需触发回收前的事件
     * 
     * ```javascript
     *   // 重写控件回收业务逻辑触发onbeforerecycle事件
     *   _pro.__destroy = function(){
     *       this._$dispatchEvent('onbeforerecycle');
     *       // 调用父类回收业务逻辑
     *       this.__super();
     *       // TODO something
     *   };
     * 
     *   // 监测onbeforerecycle事件
     *   var _widget = _p._$$Widget._$allocate({
     *       onbeforerecycle:function(_event){
     *           // TODO something
     *       }
     *   });
     * ```
     * 
     * @event module:util/event._$$EventTarget#onbeforerecycle
     * @param {Object} event - 事件触发信息
     */
    /**
     * 控件回收后触发事件，控件在具体实现时如需触发回收后的事件
     * 
     * ```javascript
     *   // 重写控件回收业务逻辑触发onbeforerecycle事件
     *   _pro.__destroy = function(){
     *       // 调用父类回收业务逻辑
     *       this.__super();
     *       // TODO something
     *       this._$dispatchEvent('onaftercycle');
     *   };
     *   
     *   // 监测onaftercycle事件
     *   var _widget = _p._$$Widget._$allocate({
     *       onaftercycle:function(_event){
     *           // TODO something
     *       }
     *   });
     * ```
     * 
     * @event module:util/event._$$EventTarget#onaftercycle
     * @param {Object} event - 事件触发信息
     */
    _p._$$EventTarget = _k._$klass();
    _pro = _p._$$EventTarget.prototype;
    /**
     * 控件分配，NEJ框架提供的所有控件统一使用分配和回收机制，
     * 分配空间时会优先考虑使用前面回收的同种控件，只有在没有可用控件的情况下才会实例化新的控件
     * 
     * ```javascript
     *   // 分配一个控件
     *   var _widget = _p._$$Widget._$allocate({
     *       conf0:'aaaaaaa',
     *       conf1:'bbbbbbbbbbbbb',
     *       onxxx:function(){
     *           // TODO something
     *       }
     *   });
     * ```
     * 
     * @method module:util/event._$$EventTarget._$allocate
     * @see    module:util/event._$$EventTarget._$getInstance
     * @see    module:util/event._$$EventTarget._$getInstanceWithReset
     * @param  {Object}  arg0 - 配置参数，根据控件实际情况提供配置参数支持
     * @return {module:util/event._$$EventTarget} 控件实例
     */
    _p._$$EventTarget._$allocate = function(_options){
        _options = _options||{};
        var _instance = !!this.__pool
                        &&this.__pool.shift();
        if (!_instance){
            _instance = new this(_options);
            this.__inst__ = (this.__inst__||0)+1;
        }
        // reset instance, flag first
        _instance.__reset(_options);
        return _instance;
    };
    /**
     * 控件回收，NEJ框架提供的所有控件统一使用分配和回收机制，
     * 如果提供的实例非当前类的实例则自动调整为输入实例的类来回收此实例
     * 
     * ```javascript
     *   // 回收前面分配的实例有两种方式
     *   // 如果不能确定实例的构造类，则可以直接使用实例的回收接口
     *   _widget._$recycle();
     *   // 如果可以确定实例的构造类，则可以使用构造类的静态回收接口
     *   _p._$$Widget._$recycle(_widget);
     *   // 如果回收多个实例则使用构造类的静态回收接口
     *   _p._$$Widget._$recycle([_widget0,_widget1]);
     * ```
     * 
     * @method module:util/event._$$EventTarget._$recycle
     * @param  {module:util/event._$$EventTarget|module:util/event._$$EventTarget[]} arg0 - 待回收实例或者实例列表
     * @return {Void}
     */
    _p._$$EventTarget._$recycle = (function(){
        var _doRecycle = function(_item,_index,_list){
            _item._$recycle();
            _list.splice(_index,1);
        };
        return function(_instance){
            if (!_instance) return null;
            if (!_u._$isArray(_instance)){
                // instance is not instanceof class
                if (!(_instance instanceof this)){
                    // use constructor recycle instance
                    var _class = _instance.constructor;
                    if (!!_class._$recycle){
                        _class._$recycle(_instance);
                    }
                    return null;
                }
                // delete singleton instance
                if (_instance==this.__instance){
                    delete this.__instance;
                }
                if (_instance==this.__inctanse){
                    delete this.__inctanse;
                }
                // do recycle
                _instance.__destroy();
                // recycle instance
                if (!this.__pool){
                    this.__pool = [];
                } 
                if (_u._$indexOf(this.__pool,_instance)<0){
                    this.__pool.push(_instance);
                }
                return null;
            }
            // recycle instance array
            _u._$reverseEach(_instance,_doRecycle,this);
        };
    })();
    /**
     * 取控件实例（单例），如果控件指明了为单例模式，
     * 则项目中使用该控件时统一使用此接口获取控件实例，使用方式同_$allocate
     * 
     * ```javascript
     *   // 取控件单例，确保在第一次取单例时输入所有配置参数
     *   var _widget = _p._$$Widget._$getInstance({
     *       conf0:'aaaaaaa',
     *       conf1:'bbbbbbbbbbbbb',
     *       onxxx:function(){
     *           // TODO something
     *       }
     *   });
     *   
     *   // 后续取单例忽略配置参数
     *   var _widget1 = _p._$$Widget._$getInstance({
     *       conf0:'bbbbb'  // <-- 如果单例已生成，则这里的配置信息不会生效
     *   });
     * 
     *   // 等价于如下调用
     *   var _widget2 = _p._$$Widget._$getInstance();
     * ```
     * 
     * @method module:util/event._$$EventTarget._$getInstance
     * @see    module:util/event._$$EventTarget._$getInstanceWithReset
     * @see    module:util/event._$$EventTarget._$allocate
     * @param  {Object}  arg0 - 配置参数，根据控件实际情况提供配置参数支持
     * @return {module:util/event._$$EventTarget} 控件实例
     */
    _p._$$EventTarget._$getInstance = function(_options){
        if (!this.__instance){
            this.__instance = this._$allocate(_options);
        }
        return this.__instance;
    };
    /**
     * 取控件实例（单例），如果控件指明了为单例模式，
     * 则项目中使用该控件时统一使用此接口获取控件实例，使用方式同_$getInstance，
     * 该接口同_$getInstance接口的主要区别在于输入的配置参数是否在每次调用接口时都重置
     * 
     * ```javascript
     *   // 取控件单例，确保在第一次取单例时输入所有配置参数
     *   var _widget = _p._$$Widget._$getInstanceWithReset({
     *       conf0:'aaaaaaa',
     *       conf1:'bbbbbbbbbbbbb',
     *       onxxx:function(){
     *           // TODO something
     *       }
     *   });
     *   
     *   // 后续取单例使用新的配置参数
     *   var _widget1 = _p._$$Widget._$getInstanceWithReset({
     *       conf0:'bbbbb'  // <-- 如果单例已生成，则重置这里的配置信息
     *   });
     * ```
     * 
     * @method module:util/event._$$EventTarget._$getInstanceWithReset
     * @see    module:util/event._$$EventTarget._$getInstance
     * @see    module:util/event._$$EventTarget._$allocate
     * @param  {Object}  arg0 - 配置参数，根据控件实际情况提供配置参数支持
     * @param  {Boolean} arg1 - 是否需要先清理已有实例
     * @return {module:util/event._$$EventTarget} 控件实例
     */
    _p._$$EventTarget._$getInstanceWithReset = function(_options,_clear){
        // clear instance
        if (!!_clear&&!!this.__inctanse){
            this.__inctanse._$recycle();
            delete this.__inctanse;
        }
        // allocate instance
        if (!this.__inctanse){
            this.__inctanse = this._$allocate(_options);
        }else{
            this.__inctanse.__reset(_options);
        }
        return this.__inctanse;
    };
    /**
     * 控件初始化，
     * 子类可重写此接口业务逻辑，
     * 子类可通过调用__super接口调用父类的初始化业务逻辑
     * 
     * ```javascript
     *   // 子类控件初始化业务逻辑
     *   _pro.__init = function(){
     *       // 调用父类控件初始化
     *       this.__super();
     *       // TODO something
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__events = {};
        this.__events_dom = {};
        this.id = _u._$uniqueID();
    };
    /**
     * 控件重置，此接口用来接收控件配置参数的处理，
     * 控件基类已处理以下业务逻辑：
     * 
     * * 缓存通过配置参数输入的回调事件
     * 
     * 子类重写此接口业务逻辑来处理具体控件对配置参数的处理，
     * 子类通过调用__super接口调用父类的重置业务逻辑
     * 
     * ```javascript
     *   // 子类控件重置业务逻辑
     *   _pro.__reset = function(_options){
     *       // 调用父类控件重置逻辑
     *       this.__super(_options);
     *       // TODO something
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__reset
     * @param  {Object} arg0 - 配置参数，根据控件实际情况提供配置参数支持
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this._$batEvent(_options);
    };
    /**
     * 控件销毁，当控件在回收时会调用此接口，基类已处理以下业务逻辑：
     * 
     * * 通过配置参数输入的事件回调的清理
     * * 通过__doInitDomEvent接口添加的DOM事件的清理
     * 
     * 一般情况下控件还需回收通过重置接口__reset产生的数据，
     * 子类可重写此接口业务逻辑来触发onbeforerecycle和onafterrecycle事件，
     * 子类可通过调用__super接口调用父类的销毁业务逻辑
     * 
     * ```javascript
     *   // 子类重写控件销毁逻辑
     *   _pro.__destroy = function(){
     *       // 触发回收之前事件
     *       this._$dispatchEvent('onbeforerecycle');
     *       // 调用父类清理逻辑，如果有触发回收之后事件则以下业务逻辑需在触发回收之后事件后面调用
     *       //this.__super();
     *       // 清理本控件的数据
     *       delete this.__conf0;
     *       this.__widget2 = this.__widget2._$recycle();
     *       // 触发回收之后事件，确保在onafterrecycle事件被清理前触发
     *       this._$dispatchEvent('onafterrecycle');
     *       this.__super();
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this._$clearEvent();
        this.__doClearDomEvent();
    };
    /**
     * 初始化事件，
     * 重置接口__reset中需要通过_$addEvent接口添加的事件，
     * 使用此接口添加可以在回收时自动被清理
     * 
     * ```javascript
     *   // 子类重置接口添加节点事件
     *   _pro.__reset = function(_options){
     *       this.__super(_options);
     *       // 添加DOM事件或者自定义事件
     *       this.__doInitDomEvent([
     *           [document,'click',this.__onDocClick._$bind(this)],
     *           [window,'ok',this.__onWindowOK._$bind(this)]
     *       ]);
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__doInitDomEvent
     * @see    module:util/event._$$EventTarget#__doClearDomEvent
     * @param  {Array} arg0 - 待添加的事件配置列表 
     * @return {Void}
     */
    _pro.__doInitDomEvent = (function(){
        var _doAttach = function(_args){
            if (!_args||_args.length<3) return;
            this.__events_dom['de-'+_u._$uniqueID()] = _args;
            _v._$addEvent.apply(_v,_args);
        };
        return function(_list){
            _u._$forEach(_list,_doAttach,this);
        };
    })();
    /**
     * 清除DOM事件，_$recycle接口会自动调用来清理这种DOM事件
     * 
     * ```javascript
     *   // 子类重置接口清理节点事件
     *   _pro.__destroy = function(_options){
     *       this.__doClearDomEvent();
     *       this.__super(_options);
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__doClearDomEvent
     * @see    module:util/event._$$EventTarget#__doInitDomEvent
     * @return {Void}
     */
    _pro.__doClearDomEvent = (function(){
        var _doRemoveEvent = function(_args,_key,_map){
            delete _map[_key];
            _v._$delEvent.apply(_v,_args);
        };
        return function(){
            _u._$loop(this.__events_dom,_doRemoveEvent);
        };
    })();
    /**
     * 清理所有组合的控件
     * 
     * ```javascript
     *   // 子类重置接口清理组件
     *   _pro.__destroy = function(_options){
     *       this.__doClearComponent(function(_inst){
     *           // 不回收_p._$$Widget2控件实例
     *           return _inst instanceof _p._$$Widget2;
     *       });
     *       this.__super(_options);
     *   };
     * ```
     * 
     * @protected
     * @method module:util/event._$$EventTarget#__doClearComponent
     * @param  {Function} arg0 - 过滤接口，返回true表示不清理该控件
     * @return {Void}
     */
    _pro.__doClearComponent = function(_filter){
        _filter = _filter||_f;
        _u._$loop(this,function(_inst,_key,_map){
            if (!!_inst&&!!_inst._$recycle&&!_filter(_inst)){
                delete _map[_key];
                _inst._$recycle();
            }
        });
    };
    /**
     * 回收控件，通过实例的构造类来回收当前实例
     * 
     * ```javascript
     *   // 通过实例的接口回收当前实例
     *   _widget._$recycle();
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$recycle
     * @see    module:util/event._$$EventTarget#_$allocate
     * @return {Void}
     */
    _pro._$recycle = function(){
        this.constructor._$recycle(this);
    };
    /**
     * 判断是否有注册事件回调
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate({
     *       onok:function(){
     *           // TODO
     *       }
     *   });
     *   // 判断控件实例是否注册有onok事件回调
     *   _widget._$hasEvent('onok');
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$hasEvent
     * @param  {String} arg0 - 事件类型
     * @return {Boolean}       是否注册了事件回调
     */
    _pro._$hasEvent = function(_type){
        var _type = (_type||'').toLowerCase(),
            _event = this.__events[_type];
        return !!_event&&_event!==_f;
    };
    /**
     * 删除单个事件回调
     * 
     * ```javascript
     *   var _handler = function(){
     *       // TODO
     *   };
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate({
     *       onok:_handler
     *   });
     *   // 删除onok事件回调
     *   _widget._$delEvent('onok',_handler);
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$delEvent
     * @param  {String}   arg0 - 事件类型
     * @param  {Function} arg1 - 事件处理函数
     * @return {Void}
     */
    _pro._$delEvent = function(_type,_event){
        var _type = (_type||'').toLowerCase(),
            _events = this.__events[_type];
        if (!_u._$isArray(_events)){
            if (_events==_event){
                delete this.__events[_type];
            }
            return;
        }
        // batch remove
        _u._$reverseEach(
            _events,function(_func,_index,_list){
                if (_func==_event){
                    _list.splice(_index,1);
                }
            }
        );
        if (!_events.length){
            delete this.__events[_type];
        }
    };
    /**
     * 重置事件，覆盖原有事件
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate();
     *   // 设置控件事件回调
     *   _widget._$setEvent('onok',function(){
     *       // TODO something
     *   });
     *   _widget._$setEvent('oncancel',function(){
     *       // TODO something
     *   });
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$setEvent
     * @param  {String}   arg0 - 事件类型，大小写不敏感
     * @param  {Function} arg1 - 事件处理函数
     * @return {Void}
     */
    _pro._$setEvent = function(_type,_event){
        if (!!_type&&_u._$isFunction(_event)){
            this.__events[_type.toLowerCase()] = _event;
        }
    };
    /**
     * 批量添加事件
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate();
     *   // 批量设置控件事件回调
     *   _widget._$batEvent({
     *       onok:function(){
     *           // TODO something
     *       },
     *       oncancel:function(){
     *           // TODO something
     *       }
     *   });
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$batEvent
     * @see    module:util/event._$$EventTarget#_$setEvent
     * @param  {Object} arg0 - 事件集合,{type:function}
     * @return {Void}
     */
    _pro._$batEvent = (function(){
        var _doSetEvent = function(_event,_type){
            this._$setEvent(_type,_event);
        };
        return function(_events){
            _u._$loop(_events,_doSetEvent,this);
        };
    })();
    /**
     * 清除事件，没有指定类型则清除所有事件
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate({
     *       onok:function(){
     *           // TODO something
     *       }
     *   });
     *   // 清除onok事件回调
     *   _widget._$clearEvent('onok');
     *   // 清除所有时间回调
     *   _widget._$clearEvent();
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$clearEvent
     * @param  {String} arg0 - 事件类型
     * @return {Void}
     */
    _pro._$clearEvent = (function(){
        var _doClearEvent = function(_event,_type){
            this._$clearEvent(_type);
        };
        return function(_type){
            var _type = (_type||'').toLowerCase();
            if (!!_type){
                delete this.__events[_type];
            }else{
                _u._$loop(this.__events,_doClearEvent,this);
            }
        };
    })();
    /**
     * 追加事件，通过此接口可以对同一个事件添加多个回调函数
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate({
     *       onok:function(){
     *           // TODO something
     *       }
     *   });
     *   // 追加事件回调
     *   _widget._$addEvent({
     *       onok:function(){
     *           // TODO something
     *       }
     *   });
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$addEvent
     * @param  {String}   arg0 - 事件类型
     * @param  {Function} arg1 - 事件处理函数
     * @return {Void}
     */
    _pro._$addEvent = function(_type,_event){
        // check type and event
        if (!_type||!_u._$isFunction(_event)){
            return;
        }
        // cache event
        _type = _type.toLowerCase();
        var _events = this.__events[_type];
        if (!_events){
            this.__events[_type] = _event;
            return;
        }
        if (!_u._$isArray(_events)){
            this.__events[_type] = [_events];
        }
        this.__events[_type].push(_event);
    };
    /**
     * 调用事件，一般在控件实现的具体业务逻辑中使用
     * 
     * ```javascript
     *   // 分配实例
     *   var _widget = _p._$$Widget._$allocate({
     *       onok:function(){
     *           // TODO something
     *       }
     *   });
     *   // 触发控件onok事件
     *   _widget._$dispatchEvent('onok');
     *   
     *   // 在控件实现的业务逻辑中使用
     *   _pro.__doSomething = function(){
     *       // TODO something
     *       // 触发onok事件
     *       this._$dispatchEvent('onok');
     *   };
     * ```
     * 
     * @method module:util/event._$$EventTarget#_$dispatchEvent
     * @param  {String}   arg0 - 事件类型，不区分大小写
     * @param  {Variable} arg1 - 事件可接受参数，具体看调用时的业务逻辑
     * @return {Void}
     */
    _pro._$dispatchEvent = function(_type){
        var _type = (_type||'').toLowerCase(),
            _event = this.__events[_type];
        if (!_event) return;
        var _args = _r.slice.call(arguments,1);
        // single event
        if (!_u._$isArray(_event)){
            _event.apply(this,_args);
            return;
        }
        // event list
        _u._$forEach(
            _event,function(_handler){
                if (DEBUG){
                    _handler.apply(this,_args);
                }else{
                    try{
                        _handler.apply(this,_args);
                    }catch(ex){
                        // ignore
                        console.error(ex.message);
                        console.error(ex.stack);
                    }
                }
            },this
        );
    };
    
    if (CMPT){
        _p._$$Event = _p._$$EventTarget;
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a');
I$('8717e18cf0d38e654531116f64f5593d',function (NEJ,_k,_e,_v,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 自定义事件封装对象，封装的事件支持通过事件相关接口进行添加、删除等操作
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/event'
     *     'util/event'
     * ],function(_v,_t){
     *     // 支持自定义事件
     *     _t._$$CustomEvent._$allocate({
     *         element:window,
     *         event:'ok'
     *     });
     * 
     *     // 添加自定义事件 
     *     _v._$addEvent(window,'ok',function(){alert(0);});
     *     _v._$addEvent(window,'ok',function(){alert(1);});
     *     
     *     // 删除自定义事件
     *     _v._$delEvent(window,'ok',function(){alert(0);});
     *     _v._$clearEvent(window,'ok');
     *     
     *     // 触发自定义事件
     *     window.onok({a:'aaaaa'});
     *     _v._$dispatchEvent(window,'ok',{a:'aaaaa'});
     * });
     * ```
     * 
     * @class    module:util/event/event._$$CustomEvent
     * @extends  module:util/event._$$EventTarget
     * 
     * @param    {Object}       config  - 可选配置参数
     * @property {String|Node}  element - 事件关联节点ID或者对象，默认为window对象
     * @property {String|Array} event   - 事件名称或者名称列表
     */
    /** 
     * 初始化时触发事件
     * 
     * @event module:util/event/event._$$CustomEvent#oninit
     * @param {Object} event - 事件信息
     */
    /** 
     * 事件调度前触发事件
     * 
     * @event    module:util/event/event._$$CustomEvent#ondispatch
     * @param    {Object} event - 事件信息
     * @property {String} type  - 事件类型
     */
    /**
     * 添加事件时触发事件
     * 
     * @event    module:util/event/event._$$CustomEvent#oneventadd
     * @param    {Object}   event    - 事件信息
     * @property {String}   type     - 事件类型
     * @property {Function} listener - 事件执行函数
     */
    _p._$$CustomEvent = _k._$klass();
    _pro = _p._$$CustomEvent._$extend(_t._$$EventTarget);
    /**
     * 控件初始化
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__init
     * @return {Void}
     */
    _pro.__init = function(){
        // onxxx - event entry handler
        //   xxx - event callback handler list
        this.__cache = {};
        this.__super();
    };
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__element = _e._$get(_options.element)||window;
        // init event
        this.__doEventInit(_options.event);
        this.__doEventAPIEnhance();
        this._$dispatchEvent('oninit');
    };
    /**
     * 销毁控件
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__destroy
     * @return {Void}
     */
    _pro.__destroy = (function(){
        var _doClear = function(_value,_key,_map){
            if (!_u._$isArray(_value)){
                _u._$safeDelete(this.__element,_key);
            }
            delete _map[_key];
        };
        return function(){
            this.__super();
            // clear cache
            _u._$loop(
                this.__cache,_doClear,this
            );
            delete this.__element;
        };
    })();
    /**
     * 判断是否需要代理事件
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__isDelegate
     * @param  {String|Node} arg0 - 节点
     * @param  {String}      arg1 - 事件
     * @return {Boolean}            是否需要代理事件
     */
    _pro.__isDelegate = function(_element,_type){
        _element = _e._$get(_element);
        return _element===this.__element&&
               (!_type||!!this.__cache['on'+_type]);
    };
    /**
     * 初始化事件
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__doEventInit
     * @param  {String} arg0 - 事件名称
     * @return {Void}
     */
    _pro.__doEventInit = function(_event){
        if (_u._$isString(_event)){
            var _name = 'on'+_event;
            if (!this.__cache[_name]){
                this.__cache[_name] = 
                    this.__doEventDispatch.
                        _$bind(this,_event);
            }
            this.__doEventBind(_event); 
            return;
        }
        if (_u._$isArray(_event)){
            _u._$forEach(
                _event,this.__doEventInit,this
            );
        }
    };
    /**
     * 绑定事件
     * 
     * @protected
     * @method module:util/event/event._$$CustomEvent#__doEventBind
     * @param  {String} arg0 - 事件名称
     * @return {Void}
     */
    _pro.__doEventBind = function(_type){
        var _event = 'on'+_type,
            _handler = this.__element[_event],
            _handler1 = this.__cache[_event];
        if (_handler!=_handler1){
            this.__doEventDelete(_type);
            if (!!_handler&&_handler!=_f){
                this.__doEventAdd(_type,_handler);
            }
            this.__element[_event] = _handler1;
        }
    };
    /**
     * 添加事件
     * 
     * protected
     * @method module:util/event/event._$$CustomEvent#__doEventAdd
     * @param  {String}   arg0 - 事件名称
     * @param  {Function} arg1 - 事件回调
     * @return {Void}
     */
    _pro.__doEventAdd = function(_type,_handler,_front){
        var _list = this.__cache[_type];
        if (!_list){
            _list = [];
            this.__cache[_type] = _list;
        }
        if (_u._$isFunction(_handler)){
            !_front ? _list.push(_handler)
                    : _list.unshift(_handler);
        } 
    };
    /**
     * 删除事件
     * 
     * protected
     * @method module:util/event/event._$$CustomEvent#__doEventDelete
     * @param  {String}   arg0 - 事件名称
     * @param  {Function} arg1 - 事件回调
     * @return {Void}
     */
    _pro.__doEventDelete = function(_type,_handler){
        var _list = this.__cache[_type];
        if (!_list||!_list.length) return;
        // clear all event handler
        if (!_handler){
            delete this.__cache[_type];
            return;
        }
        // delete one event handler
        _u._$reverseEach(
            _list,function(_value,_index,_xlist){
                if (_handler===_value){
                    _xlist.splice(_index,1);
                    return !0;
                }
            }
        );
    };
    /**
     * 事件调度
     * 
     * protected
     * @method module:util/event/event._$$CustomEvent#__doEventDispatch
     * @param  {String} arg0 - 事件名称
     * @param  {Object} arg1 - 事件对象
     * @return {Void}
     */
    _pro.__doEventDispatch = function(_type,_event){
        _event = _event||{noargs:!0};
        if (_event==_o){
            _event = {};
        }
        _event.type = _type;
        this._$dispatchEvent('ondispatch',_event);
        if (!!_event.stopped) return;
        _u._$forEach(
            this.__cache[_type],function(_handler){
                if (DEBUG){
                    _handler(_event);
                }else{
                    try{
                        _handler(_event);
                    }catch(ex){
                        // ignore
                        console.error(ex.message);
                        console.error(ex.stack);
                    }
                }
            }
        );
    };
    /**
     * 增强事件操作API
     * 
     * protected
     * @method module:util/event/event._$$CustomEvent#__doEventAPIEnhance
     * @return {Void}
     */
    _pro.__doEventAPIEnhance = (function(){
        var _doAddEvent = function(_event){
            var _args = _event.args,
                _type = _args[1].toLowerCase();
            if (this.__isDelegate(_args[0],_type)){
                _event.stopped = !0;
                this.__doEventBind(_type);
                this.__doEventAdd(_type,_args[2],_args[3]);
                this._$dispatchEvent('oneventadd',{
                    type:_type,
                    listener:_args[2]
                });
            }
        };
        var _doDelEvent = function(_event){
            var _args = _event.args,
                _type = _args[1].toLowerCase();
            if (this.__isDelegate(_args[0],_type)){
                _event.stopped = !0;
                this.__doEventDelete(_type,_args[2]);
            }
        };
        var _doClearEvent = function(_event){
            var _args = _event.args,
                _type = (_args[1]||'').toLowerCase();
            if (this.__isDelegate(_args[0])){
                if (!!_type){
                    this.__doEventDelete(_type);
                    return;
                }
                _u._$loop(
                    this.__cache,function(_value,_key){
                        if (_u._$isArray(_value)){
                            this.__doEventDelete(_key);
                        }
                    },this
                );
            }
        };
        var _doDispatchEvent = function(_event){
            var _args = _event.args,
                _type = _args[1].toLowerCase();
            if (this.__isDelegate(_args[0],_type)){
                _event.stopped = !0;
                _args[0]['on'+_type].apply(_args[0],_args.slice(2));
            }
        };
        return function(){
            // void multi-enhance
            if (!!this.__enhanced){
                return;
            }
            // enhance event api
            this.__enhanced = true;
            _v._$addEvent = _v._$addEvent._$aop(_doAddEvent._$bind(this));
            _v._$delEvent = _v._$delEvent._$aop(_doDelEvent._$bind(this));
            _v._$clearEvent = _v._$clearEvent._$aop(_doClearEvent._$bind(this));
            _v._$dispatchEvent = _v._$dispatchEvent._$aop(_doDispatchEvent._$bind(this));
            
            if (CMPT){
                NEJ.copy(NEJ.P('nej.v'),_v);
            }
        };
    })();
    
    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0');
I$('15b86578d249c817b9a2d8bd847934f1',function (NEJ,_k,_g,_v,_u,_t,_p,_o,_f,_r){
    var _pro,
        _timeout = 60000;
    /**
     * 资源加载器
     * 
     * @class    module:util/ajax/loader/loader._$$LoaderAbstract
     * @extends  module:util/event._$$EventTarget
     * 
     * @param    {Object} config  - 可选配置参数
     * @property {String} version - 版本信息
     * @property {Number} timeout - 超时时间，0表示禁止超时监测
     */
    /** 
     * 资源载入失败回调
     * 
     * @event    module:util/ajax/loader/loader._$$LoaderAbstract#onerror
     * @param    {Object} event   - 错误信息
     * @property {Number} code    - 错误码
     * @property {String} message - 错误信息
     */
    /** 
     * 资源载入成功回调
     * 
     * @event  module:util/ajax/loader/loader._$$LoaderAbstract#onload
     * @param  {Variable} event - 请求返回数据
     */
    /** 
     * 资源加载中回调
     * 
     * @event  module:util/ajax/loader/loader._$$LoaderAbstract#onloading
     */
    _p._$$LoaderAbstract = _k._$klass();
    _pro = _p._$$LoaderAbstract._$extend(_t._$$EventTarget);
    /**
     * 控件初始化
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        this.__qopt = {
            onerror:this.__onQueueError._$bind(this),
            onload:this.__onQueueLoaded._$bind(this)
        };
        if (!this.constructor.__cache){
            // url : {request:script,timer:2,bind:[instance1,instance2 ... ]}
            // key : {error:0,loaded:0,total:0,bind:[instance1,instance2 ... ]}
            this.constructor.__cache = {loaded:{}};
        }
    };
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__version = _options.version;
        this.__timeout = _options.timeout;
        this.__qopt.version = this.__version;
        this.__qopt.timeout = this.__timeout;
    };
    /**
     * 删除加载信息
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__delLoadData
     * @param  {String} arg0 - 标识
     * @return {Object}        加载信息
     */
    _pro.__delLoadData = function(_key){
        delete this.constructor.__cache[_key];
    };
    /**
     * 取加载信息
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__getLoadData
     * @param  {String} arg0 - 标识
     * @return {Object}        加载信息
     */
    _pro.__getLoadData = function(_key){
        return this.constructor.__cache[_key];
    };
    /**
     * 设置加载信息
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__setLoadData
     * @param  {String} arg0 - 标识
     * @param  {Object} arg1 - 加载信息
     * @return {Void}
     */
    _pro.__setLoadData = function(_key,_data){
        this.constructor.__cache[_key] = _data;
    };
    /**
     * 取资源载入控件，子类实现具体逻辑
     * 
     * @abstract
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__getRequest
     * @return {Script|Link} 控件
     */
    _pro.__getRequest = _f;
    /**
     * 清理控件
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__doClearRequest
     * @param  {Script|Link} arg0 - 控件
     * @return {Void}
     */
    _pro.__doClearRequest = function(_request){
        _v._$clearEvent(_request);
    };
    /**
     * 资源载入
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__doRequest
     * @param  {Script|Link} arg0 - 控件
     * @return {Void}
     */
    _pro.__doRequest = function(_request){
        _request.src = this.__url;
        document.head.appendChild(_request);
    };
    /**
     * 执行清理任务
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__doClear
     * @return {Void}
     */
    _pro.__doClear = function(){
        var _cache = this.__getLoadData(this.__url);
        if (!_cache) return;
        window.clearTimeout(_cache.timer);
        this.__doClearRequest(_cache.request);
        delete _cache.bind;
        delete _cache.timer;
        delete _cache.request;
        this.__delLoadData(this.__url);
        this.__getLoadData('loaded')[this.__url] = !0;
    };
    /**
     * 执行回调
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__doCallback
     * @param  {String} arg0 - 回调名称
     * @return {Void}
     */
    _pro.__doCallback = function(_name){
        var _cache = this.__getLoadData(this.__url);
        if (!_cache) return;
        var _list = _cache.bind;
        this.__doClear();
        if (!!_list&&_list.length>0){
            var _instance;
            while(_list.length){
                _instance = _list.shift();
                try{
                    _instance._$dispatchEvent(_name,arguments[1]);
                }catch(ex){
                    // ignore
                    if (DEBUG) throw ex;
                    console.error(ex.message);
                    console.error(ex.stack);
                }
                _instance._$recycle();
            }
        }
    };
    /**
     * 资源载入异常事件
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__onError
     * @param  {Object} arg0 - 错误信息
     * @return {Void}
     */
    _pro.__onError = function(_error){
        this.__doCallback('onerror',_error);
    };
    /**
     * 资源载入成功事件
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__onLoaded
     * @return {Void}
     */
    _pro.__onLoaded = function(){
        this.__doCallback('onload');
    };
    /**
     * 载入队列资源
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__doLoadQueue
     * @param  {String} arg0 - 资源地址
     * @return {Void}
     */
    _pro.__doLoadQueue = function(_url){
        this.constructor._$allocate(this.__qopt)._$load(_url);
    };
    /**
     * 检查队列状况
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__onQueueCheck
     * @return {Void}
     */
    _pro.__onQueueCheck = function(_error){
        var _cache = this.__getLoadData(this.__key);
        if (!_cache) return;
        if (!!_error) 
            _cache.error++;
        _cache.loaded ++;
        if (_cache.loaded<_cache.total) return;
        this.__delLoadData(this.__key);
        this._$dispatchEvent(_cache.error>0?'onerror':'onload');
    };
    /**
     * 队列载入资源异常事件
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__onQueueError
     * @param  {Object} arg0 - 错误信息
     * @return {Void}
     */
    _pro.__onQueueError = function(_error){
        this.__onQueueCheck(!0);
    };
    /**
     * 队列载入资源成功事件
     * 
     * @protected
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#__onQueueLoaded
     * @return {Void}
     */
    _pro.__onQueueLoaded = function(){
        this.__onQueueCheck();
    };
    /**
     * 载入资源
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/loader/html',
     *     'util/ajax/loader/style',
     *     'util/ajax/loader/script'
     * ],function(_t0,_t1,_t2){
     *     // 载入指定html,10秒超时
     *     var _loader = _t0._$$LoaderHtml._$allocate({
     *         timeout:10000,
     *         onload:function(){
     *             // 载入资源成功的回调
     *         }
     *     });
     *     // 绝对路径或者当前页面的相对路径
     *     _loader._$load('../../../html/util/formTest.html');
     * 
     *     // 载入指定script,20秒超时
     *     var _loader = _t2._$$LoaderScript._$allocate({
     *         timeout:20000,
     *         onload:function(){
     *             // 载入资源成功的回调
     *         }
     *     });
     *     // 绝对路径或者当前页面的相对路径
     *     _loader._$load('../../../javascript/log.js');
     * 
     *     // 载入指定style,30秒超时
     *     var _loader = _t1._$$LoaderStyle._$allocate({
     *         timeout:30000,
     *         onload:function(){
     *             // 载入资源成功的回调
     *         }
     *     });
     *     // 绝对路径或者当前页面的相对路径
     *     _loader._$load('../../../base/qunit.css');
     * });
     * ```
     * 
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#_$load
     * @param  {String} arg0 - 资源地址
     * @return {Void}
     */
    _pro._$load = function(_url){
        _url = _u._$absolute(_url);
        if (!_url){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_NOTASGN,
                message:'请指定要载入的资源地址！'
            });
            return;
        };
        this.__url = _url;
        if (!!this.__version){
            this.__url += (this.__url.indexOf('?')<0?'?':'&')+this.__version;
        }
        if (this.__getLoadData('loaded')[this.__url]){
            try{
                this._$dispatchEvent('onload');
            }catch(ex){
                // ignore
                if (DEBUG) throw ex;
                console.error(ex.message);
                console.error(ex.stack);
            }
            this._$recycle();
            return;
        }
        var _cache = this.__getLoadData(this.__url),_request;
        if (!!_cache){
            _cache.bind.unshift(this);
            _cache.timer = window.clearTimeout(_cache.timer);
        }else{
            _request = this.__getRequest();
            _cache = {request:_request,bind:[this]};
            this.__setLoadData(this.__url,_cache);
            _v._$addEvent(
                _request,'load',
                this.__onLoaded._$bind(this)
            );
            _v._$addEvent(
                _request,'error',
                this.__onError._$bind(this,{
                    code:_g._$CODE_ERRSERV,
                    message:'æ— æ³•åŠ è½½æŒ‡å®šèµ„æºæ–‡ä»¶['+this.__url+']ï¼'
                })
            );
        }
        if (this.__timeout!=0){
            _cache.timer = window.setTimeout(
                this.__onError._$bind(this,{
                    code:_g._$CODE_TIMEOUT,
                    message:'æŒ‡å®šèµ„æºæ–‡ä»¶['+this.__url+']è½½å…¥è¶…æ—¶ï¼'
                }),
                this.__timeout||_timeout
            );
        }
        if (!!_request){
            this.__doRequest(_request);
        }
        this._$dispatchEvent('onloading');
    };
    /**
     * é˜Ÿåˆ—è½½å…¥èµ„æº
     * 
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/ajax/loader/html.js'
     * ],function(_t){
     *     var _loader = _t._$$LoaderHtml._$allocate({
     *         onload:function(){
     *             // è½½å…¥é˜Ÿåˆ—èµ„æºæˆåŠŸçš„å›žè°ƒ
     *         }
     *     });
     *     // è·¯å¾„åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯å½“å‰é¡µé¢çš„ç›¸å¯¹è·¯å¾„
     *     var _list = [
     *         '../../../html/util/formTest.html',
     *         '../../../html/util/cacheTest.html'
     *     ];
     *     _loader._$queue(_list);
     * });
     * ```
     * 
     * @method module:util/ajax/loader/loader._$$LoaderAbstract#_$queue
     * @param  {Array} arg0 - èµ„æºåœ°å€é˜Ÿåˆ—
     * @return {Void}
     */
    _pro._$queue = function(_list){
        if (!_list||!_list.length){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_NOTASGN,
                message:'è¯·æŒ‡å®šè¦è½½å…¥çš„èµ„æºé˜Ÿåˆ—ï¼'
            });
            return;
        } 
        this.__key = _u._$uniqueID();
        var _cache = {error:0,loaded:0,total:_list.length};
        this.__setLoadData(this.__key,_cache);
        _u._$forEach(
            _list,function(v,i){
                if (!v){
                    _cache.total--;
                    return;
                }
                this.__doLoadQueue(v);
            },this
        );
        this._$dispatchEvent('onloading');
    };
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','036fce036df53014afe007bfc84b3324','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0');
I$('6752b4aca76c086313744714ebb26ddd',function (NEJ,_u,_p,_o,_f,_r){
    /**
     * è®¾ç½®æˆ–è€…èŽ·å–cookie
     *
     * * æ²¡æœ‰è¾“å…¥ç¬¬äºŒä¸ªå‚æ•°åˆ™è¡¨ç¤ºè¿”å›žå·²æœ‰cookie
     * * å¦‚æžœcookieå€¼ä¸ºç©ºå­—ç¬¦ä¸²åˆ™è¡¨ç¤ºåˆ é™¤cookie
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'util/cookie'
     *   ],function(_j){
     *       // è®¾ç½®cookieçš„name=abc
     *       var _cookie = _j._$cookie('name','abc');
     *       _j._$cookie('name',{value:'abc'});
     *
     *       // è®¾ç½®è·¯å¾„ï¼Œdomain(å¦‚æžœdomainä¸åŒåŸŸï¼Œcookieè®¾ç½®ä¸ä¼šæˆåŠŸ),è®¾ç½®è¿‡æœŸæ—¶é—´1å¤©;
     *       var _cookie = _j._$cookie('name',{
     *           value:'abc',
     *           path:'/a/',
     *           domain:'www.163.com',
     *           expires:1
     *       });
     *
     *       // åˆ é™¤cookie
     *       _j._$cookie('name','');
     *       _j._$cookie('name',{expires:-1});
     *   });
     * ```
     *
     * @method   module:util/cache/cookie._$cookie
     * @param    {String}        arg0    - cookieåç§°
     * @param    {String|Object} arg1    - cookieå€¼ï¼Œå¦‚æžœæœ‰å…¶ä»–é…ç½®ä¿¡æ¯è¾“å…¥å¯¹è±¡ï¼Œå·²å¤„ç†å±žæ€§åŒ…æ‹¬
     * @property {String}        value   - cookieå€¼
     * @property {String}        path    - è·¯å¾„
     * @property {String}        domain  - åŸŸåï¼Œå½“å‰åŸŸæˆ–è€…å½“å‰åŸŸçš„çˆ¶åŸŸ
     * @property {Number}        expires - è¿‡æœŸæ—¶é—´åç§»ï¼Œå•ä½å¤©ï¼Œè´Ÿå€¼è¡¨ç¤ºåˆ é™¤cookie
     * @return   {String}                  cookieå€¼
     */
    _p._$cookie = (function(){
        var _date = new Date(),
            _crut = +_date,   // current time milliseconds
            _days = 86400000; // milliseconds of one day
        var _getcookie = function(_name){
            var _cookie = document.cookie,
                _search = '\\b'+_name+'=',
                _index1 = _cookie.search(_search);
            if (_index1<0) return '';
            _index1 += _search.length-2;
            var _index2 = _cookie.indexOf(';',_index1);
            if (_index2<0) _index2 = _cookie.length;
            return _cookie.substring(_index1,_index2)||'';
        };
        return function(_name,_data){
            if (_data===undefined){
                return _getcookie(_name);
            }
            if (_u._$isString(_data)){
                if (!!_data){
                    document.cookie = _name+'='+_data+';';
                    return _data;
                }
                _data = {expires:-100};
            }
            _data = _data||_o;
            var _cookie = _name+'='+(_data.value||'')+';';
            delete _data.value;
            if (_data.expires!==undefined){
                _date.setTime(_crut+_data.expires*_days);
                _data.expires = _date.toGMTString();
            }
            _cookie += _u._$object2string(_data,';');
            //console.log(_cookie);
            document.cookie = _cookie;
        };
    })();

    if (CMPT){
        NEJ.copy(NEJ.P('nej.j'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a');
/*! JSON v3.2.5 | http://bestiejs.github.io/json3 | Copyright 2012-2013, Kit Cambridge | http://kit.mit-license.org */
;(function(){var o=!0,w=null;
(function(B){function v(a){if("bug-string-char-index"==a)return"a"!="a"[0];var f,c="json"==a;if(c||"json-stringify"==a||"json-parse"==a){if("json-stringify"==a||c){var d=k.stringify,b="function"==typeof d&&l;if(b){(f=function(){return 1}).toJSON=f;try{b="0"===d(0)&&"0"===d(new Number)&&'""'==d(new String)&&d(m)===r&&d(r)===r&&d()===r&&"1"===d(f)&&"[1]"==d([f])&&"[null]"==d([r])&&"null"==d(w)&&"[null,null,null]"==d([r,m,w])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==d({a:[f,o,!1,w,"\x00\u0008\n\u000c\r\t"]})&&
"1"===d(w,f)&&"[\n 1,\n 2\n]"==d([1,2],w,1)&&'"-271821-04-20T00:00:00.000Z"'==d(new Date(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==d(new Date(864E13))&&'"-000001-01-01T00:00:00.000Z"'==d(new Date(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==d(new Date(-1))}catch(n){b=!1}}if(!c)return b}if("json-parse"==a||c){a=k.parse;if("function"==typeof a)try{if(0===a("0")&&!a(!1)){f=a('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var e=5==f.a.length&&1===f.a[0];if(e){try{e=!a('"\t"')}catch(g){}if(e)try{e=
1!==a("01")}catch(i){}}}}catch(O){e=!1}if(!c)return e}return b&&e}}var m={}.toString,p,C,r,D=typeof define==="function"&&define.amd,k="object"==typeof exports&&exports;k||D?"object"==typeof JSON&&JSON?k?(k.stringify=JSON.stringify,k.parse=JSON.parse):k=JSON:D&&(k=B.JSON={}):k=B.JSON||(B.JSON={});var l=new Date(-3509827334573292);try{l=-109252==l.getUTCFullYear()&&0===l.getUTCMonth()&&1===l.getUTCDate()&&10==l.getUTCHours()&&37==l.getUTCMinutes()&&6==l.getUTCSeconds()&&708==l.getUTCMilliseconds()}catch(P){}if(!v("json")){var s=
v("bug-string-char-index");if(!l)var t=Math.floor,J=[0,31,59,90,120,151,181,212,243,273,304,334],z=function(a,f){return J[f]+365*(a-1970)+t((a-1969+(f=+(f>1)))/4)-t((a-1901+f)/100)+t((a-1601+f)/400)};if(!(p={}.hasOwnProperty))p=function(a){var f={},c;if((f.__proto__=w,f.__proto__={toString:1},f).toString!=m)p=function(a){var f=this.__proto__,a=a in(this.__proto__=w,this);this.__proto__=f;return a};else{c=f.constructor;p=function(a){var f=(this.constructor||c).prototype;return a in this&&!(a in f&&
this[a]===f[a])}}f=w;return p.call(this,a)};var K={"boolean":1,number:1,string:1,undefined:1};C=function(a,f){var c=0,b,h,n;(b=function(){this.valueOf=0}).prototype.valueOf=0;h=new b;for(n in h)p.call(h,n)&&c++;b=h=w;if(c)c=c==2?function(a,f){var c={},b=m.call(a)=="[object Function]",d;for(d in a)!(b&&d=="prototype")&&!p.call(c,d)&&(c[d]=1)&&p.call(a,d)&&f(d)}:function(a,f){var c=m.call(a)=="[object Function]",b,d;for(b in a)!(c&&b=="prototype")&&p.call(a,b)&&!(d=b==="constructor")&&f(b);(d||p.call(a,
b="constructor"))&&f(b)};else{h=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];c=function(a,f){var c=m.call(a)=="[object Function]",b,d;if(d=!c)if(d=typeof a.constructor!="function"){d=typeof a.hasOwnProperty;d=d=="object"?!!a.hasOwnProperty:!K[d]}d=d?a.hasOwnProperty:p;for(b in a)!(c&&b=="prototype")&&d.call(a,b)&&f(b);for(c=h.length;b=h[--c];d.call(a,b)&&f(b));}}c(a,f)};if(!v("json-stringify")){var L={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",
10:"\\n",13:"\\r",9:"\\t"},u=function(a,f){return("000000"+(f||0)).slice(-a)},G=function(a){var f='"',b=0,d=a.length,h=d>10&&s,n;for(h&&(n=a.split(""));b<d;b++){var e=a.charCodeAt(b);switch(e){case 8:case 9:case 10:case 12:case 13:case 34:case 92:f=f+L[e];break;default:if(e<32){f=f+("\\u00"+u(2,e.toString(16)));break}f=f+(h?n[b]:s?a.charAt(b):a[b])}}return f+'"'},E=function(a,b,c,d,h,n,e){var g=b[a],i,j,k,l,q,s,v,x,y;try{g=b[a]}catch(A){}if(typeof g=="object"&&g){i=m.call(g);if(i=="[object Date]"&&
!p.call(g,"toJSON"))if(g>-1/0&&g<1/0){if(z){k=t(g/864E5);for(i=t(k/365.2425)+1970-1;z(i+1,0)<=k;i++);for(j=t((k-z(i,0))/30.42);z(i,j+1)<=k;j++);k=1+k-z(i,j);l=(g%864E5+864E5)%864E5;q=t(l/36E5)%24;s=t(l/6E4)%60;v=t(l/1E3)%60;l=l%1E3}else{i=g.getUTCFullYear();j=g.getUTCMonth();k=g.getUTCDate();q=g.getUTCHours();s=g.getUTCMinutes();v=g.getUTCSeconds();l=g.getUTCMilliseconds()}g=(i<=0||i>=1E4?(i<0?"-":"+")+u(6,i<0?-i:i):u(4,i))+"-"+u(2,j+1)+"-"+u(2,k)+"T"+u(2,q)+":"+u(2,s)+":"+u(2,v)+"."+u(3,l)+"Z"}else g=
w;else if(typeof g.toJSON=="function"&&(i!="[object Number]"&&i!="[object String]"&&i!="[object Array]"||p.call(g,"toJSON")))g=g.toJSON(a)}c&&(g=c.call(b,a,g));if(g===w)return"null";i=m.call(g);if(i=="[object Boolean]")return""+g;if(i=="[object Number]")return g>-1/0&&g<1/0?""+g:"null";if(i=="[object String]")return G(""+g);if(typeof g=="object"){for(a=e.length;a--;)if(e[a]===g)throw TypeError();e.push(g);x=[];b=n;n=n+h;if(i=="[object Array]"){j=0;for(a=g.length;j<a;y||(y=o),j++){i=E(j,g,c,d,h,n,
e);x.push(i===r?"null":i)}a=y?h?"[\n"+n+x.join(",\n"+n)+"\n"+b+"]":"["+x.join(",")+"]":"[]"}else{C(d||g,function(a){var b=E(a,g,c,d,h,n,e);b!==r&&x.push(G(a)+":"+(h?" ":"")+b);y||(y=o)});a=y?h?"{\n"+n+x.join(",\n"+n)+"\n"+b+"}":"{"+x.join(",")+"}":"{}"}e.pop();return a}};k.stringify=function(a,b,c){var d,h,j;if(typeof b=="function"||typeof b=="object"&&b)if(m.call(b)=="[object Function]")h=b;else if(m.call(b)=="[object Array]"){j={};for(var e=0,g=b.length,i;e<g;i=b[e++],(m.call(i)=="[object String]"||
m.call(i)=="[object Number]")&&(j[i]=1));}if(c)if(m.call(c)=="[object Number]"){if((c=c-c%1)>0){d="";for(c>10&&(c=10);d.length<c;d=d+" ");}}else m.call(c)=="[object String]"&&(d=c.length<=10?c:c.slice(0,10));return E("",(i={},i[""]=a,i),h,j,d,"",[])}}if(!v("json-parse")){var M=String.fromCharCode,N={92:"\\",34:'"',47:"/",98:"\u0008",116:"\t",110:"\n",102:"\u000c",114:"\r"},b,A,j=function(){b=A=w;throw SyntaxError();},q=function(){for(var a=A,f=a.length,c,d,h,k,e;b<f;){e=a.charCodeAt(b);switch(e){case 9:case 10:case 13:case 32:b++;
break;case 123:case 125:case 91:case 93:case 58:case 44:c=s?a.charAt(b):a[b];b++;return c;case 34:c="@";for(b++;b<f;){e=a.charCodeAt(b);if(e<32)j();else if(e==92){e=a.charCodeAt(++b);switch(e){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:c=c+N[e];b++;break;case 117:d=++b;for(h=b+4;b<h;b++){e=a.charCodeAt(b);e>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70||j()}c=c+M("0x"+a.slice(d,b));break;default:j()}}else{if(e==34)break;e=a.charCodeAt(b);for(d=b;e>=32&&e!=92&&e!=34;)e=a.charCodeAt(++b);
c=c+a.slice(d,b)}}if(a.charCodeAt(b)==34){b++;return c}j();default:d=b;if(e==45){k=o;e=a.charCodeAt(++b)}if(e>=48&&e<=57){for(e==48&&(e=a.charCodeAt(b+1),e>=48&&e<=57)&&j();b<f&&(e=a.charCodeAt(b),e>=48&&e<=57);b++);if(a.charCodeAt(b)==46){for(h=++b;h<f&&(e=a.charCodeAt(h),e>=48&&e<=57);h++);h==b&&j();b=h}e=a.charCodeAt(b);if(e==101||e==69){e=a.charCodeAt(++b);(e==43||e==45)&&b++;for(h=b;h<f&&(e=a.charCodeAt(h),e>=48&&e<=57);h++);h==b&&j();b=h}return+a.slice(d,b)}k&&j();if(a.slice(b,b+4)=="true"){b=
b+4;return o}if(a.slice(b,b+5)=="false"){b=b+5;return false}if(a.slice(b,b+4)=="null"){b=b+4;return w}j()}}return"$"},F=function(a){var b,c;a=="$"&&j();if(typeof a=="string"){if((s?a.charAt(0):a[0])=="@")return a.slice(1);if(a=="["){for(b=[];;c||(c=o)){a=q();if(a=="]")break;if(c)if(a==","){a=q();a=="]"&&j()}else j();a==","&&j();b.push(F(a))}return b}if(a=="{"){for(b={};;c||(c=o)){a=q();if(a=="}")break;if(c)if(a==","){a=q();a=="}"&&j()}else j();(a==","||typeof a!="string"||(s?a.charAt(0):a[0])!="@"||
q()!=":")&&j();b[a.slice(1)]=F(q())}return b}j()}return a},I=function(a,b,c){c=H(a,b,c);c===r?delete a[b]:a[b]=c},H=function(a,b,c){var d=a[b],h;if(typeof d=="object"&&d)if(m.call(d)=="[object Array]")for(h=d.length;h--;)I(d,h,c);else C(d,function(a){I(d,a,c)});return c.call(a,b,d)};k.parse=function(a,f){var c,d;b=0;A=""+a;c=F(q());q()!="$"&&j();b=A=w;return f&&m.call(f)=="[object Function]"?H((d={},d[""]=c,d),"",f):c}}}D&&define(function(){return k})})(this);return JSON;
}());
I$('0a779a655a400670ce0da6a5caad6fb5',function(_m,_p,_o,_f,_r){
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release=='2.0'){I$(28,function (){
	    // eval for big string
	    JSON.parse = (function(){
	        // check save json string
	        // http://www.ietf.org/rfc/rfc4627.txt
	        var _isSafeJSON = function(_content){
	            return !(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(
	                        _content.replace(/"(\\.|[^"\\])*"/g,'')
	                    ));
	        };
	        return JSON.parse._$aop(function(_event){
	            var _str = _event.args[0]||'';
	            if (_str.length>=500000){  // &&_isSafeJSON(_str)
	                _event.stopped = !0;
	                _event.value = eval('('+_str+')');
	            }
	        });
	    })();
	});}return JSON;},'345f1460138e362bb33cc48ffc7cd12b');
I$('2893fe4191b99bbcb2db10b5332d9654',function (){return JSON;},'0a779a655a400670ce0da6a5caad6fb5');
I$('181227f3af1e0960a9790c6ccd64f2d4',function (_k,_u,_e,_c,_g,_t,_j,JSON,_p,_o,_f,_r){
    var _pro;
    /**
     * Ajaxä»£ç†å¯¹è±¡
     * 
     * @class   module:util/ajax/proxy/proxy._$$ProxyAbstract
     * @extends module:util/event._$$EventTarget
     * 
     * @param    {Object}  config  - æž„é€ é…ç½®å‚æ•°
     * @property {String}  url     - è¯·æ±‚åœ°å€
     * @property {Boolean} sync    - æ˜¯å¦åŒæ­¥è¯·æ±‚
     * @property {String}  type    - è¿”å›žæ•°æ®æ ¼å¼,text/json/xml
     * @property {String}  method  - è¯·æ±‚æ–¹å¼,GET/POST
     * @property {Number}  timeout - è¶…æ—¶æ—¶é—´,0è¡¨ç¤ºç¦æ­¢è¶…æ—¶ç›‘æµ‹
     * @property {Object}  headers - å¤´ä¿¡æ¯
     */
    /** 
     * è½½å…¥å›žè°ƒ
     * 
     * @event module:util/ajax/proxy/proxy._$$ProxyAbstract#onload
     * @param {Object} event - æœåŠ¡å™¨è¿”å›žæ•°æ®ä¿¡æ¯
     */
    /** 
     * å¼‚å¸¸å›žè°ƒ
     * 
     * @event    module:util/ajax/proxy/proxy._$$ProxyAbstract#onerror
     * @param    {Object}   event   - é”™è¯¯ä¿¡æ¯
     * @property {Number}   code    - é”™è¯¯ä»£ç 
     * @property {String}   message - é”™è¯¯æè¿°
     * @property {Variable} data    - å‡ºé”™æ—¶æºå¸¦æ•°æ®
     */
    /** 
     * [hr]
     * è¯·æ±‚ä¹‹å‰å¯¹æ•°æ®å¤„ç†å›žè°ƒ
     * @event    module:util/ajax/proxy/proxy._$$ProxyAbstract#onbeforerequest
     * @param    {Object} event   - è¯·æ±‚ä¿¡æ¯
     * @property {Object} request - è¯·æ±‚å‚æ•°ï¼Œæ•°æ®ä¿¡æ¯ url/sync/cookie/type/method/timeout
     * @property {Object} headers - è¯·æ±‚å¤´ä¿¡æ¯
     */
    _p._$$ProxyAbstract = _k._$klass();
    _pro = _p._$$ProxyAbstract._$extend(_t._$$EventTarget);
    /**
     * æŽ§ä»¶é‡ç½®
     * 
     * @protected
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#__reset
     * @param  {Object} arg0 - é…ç½®å‚æ•°
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        // reset request information
        this.__request = _u._$fetch({
            url:'',
            sync:!1,
            cookie:!1,
            type:'text',
            method:'GET',
            timeout:60000
        },_options);
        // for csrf attack
        var _csrf = _c._$get('csrf');
        if (!!_csrf.cookie&&!!_csrf.param){
            var _query = encodeURIComponent(_csrf.param)+'='+
                         encodeURIComponent(_j._$cookie(_csrf.cookie)||''),
                _split = this.__request.url.indexOf('?')<0?'?':'&';
            this.__request.url += _split+_query;
        }
        // reset headers
        this.__headers = _options.headers||{};
        var _content = this.__headers[_g._$HEAD_CT];
        if (_content==null){
            this.__headers[_g._$HEAD_CT] = _g._$HEAD_CT_FORM;
        }
    };
    /**
     * å›žæ”¶æŽ§ä»¶
     * 
     * @protected
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        delete this.__rkey;
        delete this.__request;
        delete this.__headers;
    };
    /**
     * è¯·æ±‚è½½å…¥å›žè°ƒ
     * 
     * @protected
     * @method   module:util/ajax/proxy/proxy._$$ProxyAbstract#__onLoadRequest
     * @param    {Object} arg0   - æ•°æ®ä¿¡æ¯
     * @property {Number} status - è¯·æ±‚çŠ¶æ€
     * @property {String} result - è¯·æ±‚ç»“æžœï¼Œçº¯æ–‡æœ¬å½¢å¼
     * @return   {Void}
     */
    _pro.__onLoadRequest = function(_event){
        var _status = _event.status;
        // timeout error
        if (_status==-1){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_TIMEOUT,
                message:'è¯·æ±‚['+this.__request.url+']è¶…æ—¶ï¼'
            });
            return;
        }
        // check status
        if ((''+_status).indexOf('2')!=0){
            this._$dispatchEvent('onerror',{
                data:_status,
                result:_event.result,
                code:_g._$CODE_ERRSERV,
                message:'æœåŠ¡å™¨è¿”å›žå¼‚å¸¸çŠ¶æ€['+_status+']!'
            });
            return;
        }
        // onload
        this._$dispatchEvent(
             'onload',_e._$text2type(
                 _event.result,
                 this.__request.type
             )
        );
    };
    /**
     * å¾€æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå­ç±»å®žçŽ°å…·ä½“ä¸šåŠ¡é€»è¾‘
     * 
     * @abstract
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#__doSendRequest
     * @param  {Object} arg0 - è¯·æ±‚ä¿¡æ¯
     * @return {Void}
     */
    _pro.__doSendRequest = _f;
    /**
     * å–å¤´ä¿¡æ¯ï¼Œå­ç±»å®žçŽ°å…·ä½“ä¸šåŠ¡é€»è¾‘
     * 
     * @abstract
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#__getResponseHeader
     * @param  {String} arg0 - è¦å–çš„å¤´ä¿¡æ¯åç§°
     * @return {String}        å¤´ä¿¡æ¯ç»“æžœæˆ–é›†åˆ
     */
    _pro.__getResponseHeader = _f;
    /**
     * è¯·æ±‚ç»ˆæ­¢äº‹ä»¶
     * @private
     */
    _pro.__onAbort = function(){
        this._$dispatchEvent('onerror',{
            code:_g._$CODE_ERRABRT,
            message:'å®¢æˆ·ç«¯ç»ˆæ­¢è¯·æ±‚'
        });
    };
    /**
     * å‘é€è¯·æ±‚
     * 
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#_$send
     * @param  {Variable} arg0 - è¦å‘é€çš„æ•°æ®
     * @return {Void}
     */
    _pro._$send = function(_data){
        var _url = this.__request.url;
        if (!_url){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_NOTASGN,
                message:'æ²¡æœ‰è¾“å…¥è¯·æ±‚åœ°å€ï¼'
            });
            return;
        }
        try{
            this.__request.data = _data==null?null:_data;
            var _event = {
                request:this.__request,
                headers:this.__headers
            };
            // adjust param before request
            try{
                this._$dispatchEvent('onbeforerequest',_event);
            }catch(ex){
                // ignore exception
                console.error(ex.message);
                console.error(ex.stack);
            }
            this.__doSendRequest(_event);
        }catch(e){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_ERRSERV,
                message:'è¯·æ±‚['+_url+']å¤±è´¥:'+e.message+'ï¼'
            });
        }
    };
    /**
     * ä¸­æ–­è¯·æ±‚ï¼Œå­ç±»å®žçŽ°å…·ä½“ä¸šåŠ¡é€»è¾‘
     *
     * @abstract
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#_$abort
     * @return {Void}
     */
    _pro._$abort = _f;
    /**
     * å–å¤´ä¿¡æ¯
     * 
     * @method module:util/ajax/proxy/proxy._$$ProxyAbstract#_$header
     * @param  {String|Array}  arg0 - è¦å–çš„å¤´ä¿¡æ¯åç§°
     * @return {String|Object}        å¤´ä¿¡æ¯ç»“æžœæˆ–é›†åˆ
     */
    _pro._$header = function(_key){
        if (!_u._$isArray(_key)){
            return this.__getResponseHeader(_key)||'';
        }
        var _result = {};
        _u._$forEach(
            _key,function(_value){
                _result[_value] = this._$header(_value);
            },this
        );
        return _result;
    };
    
    return _p;
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','75482afbe8186c6aea54c5752fc62e9f','036fce036df53014afe007bfc84b3324','b3c0f3ceba0c279f7e6de06836b8d2f0','6752b4aca76c086313744714ebb26ddd','2893fe4191b99bbcb2db10b5332d9654');
I$('e9cab3517785b234bee2037b5087de0e',function (_p,_o,_f,_r){
    /**
     * å–XHRå¯¹è±¡
     * @return {XMLHttpRequest} XHRå¯¹è±¡
     */
    _p.__getXMLHttpRequest = function(){
        return new XMLHttpRequest();
    };
    /**
     * åˆ¤æ–­æ˜¯å¦æœ‰Abortäº‹ä»¶
     * @return {Boolean}
     */
    _p.__hasAbortEvent = function(){
        return !0;
    };
    return _p;
});
I$('9c0d965cf27b624fe186c9592451cdfe',function(b1490930304665,_h,_u,_p,_o,_f,_r){if (b1490930304665._$KERNEL.engine==='trident'&&b1490930304665._$KERNEL.release<='5.0'){I$(26,function (){
        /**
         * åˆ¤æ–­æ˜¯å¦æœ‰Abortäº‹ä»¶
         * @return {Boolean}
         */
        _h.__hasAbortEvent = function(){
            return !1;
        };
    });}
if (b1490930304665._$KERNEL.engine==='trident'&&b1490930304665._$KERNEL.release<='2.0'){I$(27,function (){
        /**
         * å–XHRå¯¹è±¡
         * @return {XMLHttpRequest} XHRå¯¹è±¡
         */
        _h.__getXMLHttpRequest = (function(){
            // http://blogs.msdn.com/b/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx
            var _msxml = [
                'Msxml2.XMLHTTP.6.0',
                'Msxml2.XMLHTTP.3.0',
                'Msxml2.XMLHTTP.4.0',
                'Msxml2.XMLHTTP.5.0',
                'MSXML2.XMLHTTP',
                'Microsoft.XMLHTTP'
            ];
            return function(){
                var _xhr = null;
                _u._$forIn(
                    _msxml,function(_name){
                        try{
                            _xhr = new ActiveXObject(_name);
                            return !0;
                        }catch(e){
                            // ignore exception
                        }
                    }
                );
                return _xhr;
            };
        })();
    });}return _h;},'345f1460138e362bb33cc48ffc7cd12b','e9cab3517785b234bee2037b5087de0e','3ff9c25bd81a3c2a260c28122918263a');
I$('77322c4083e1992e07612592f5d11fdf',function (_t,_u,_k,_g,_h,_p,_o,_f,_r){
    var _pro;
    /**
     * Ajax代理对象
     * 
     * @class   module:util/ajax/proxy/xhr._$$ProxyXHR
     * @extends module:util/ajax/proxy/proxy._$$ProxyAbstract
     * 
     * @param   {Object} config - 构造配置参数
     */
    _p._$$ProxyXHR = _k._$klass();
    _pro = _p._$$ProxyXHR._$extend(_t._$$ProxyAbstract);
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/ajax/proxy/xhr._$$ProxyXHR#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        // clear timeout
        window.clearTimeout(this.__timer);
        delete this.__timer;
        // clear request
        try{
            this.__xhr.onreadystatechange = _f;
            this.__xhr.abort();
        }catch(e){
            // ignore
        }
        delete this.__xhr;
    };
    /**
     * 往服务器发送请求
     * 
     * @protected
     * @method module:util/ajax/proxy/xhr._$$ProxyXHR#__doSendRequest
     * @param  {Object} arg0 - 请求信息
     * @return {Void}
     */
    _pro.__doSendRequest = (function(){
        // set header
        var _doSetHeader = function(_value,_key){
            this.__xhr.setRequestHeader(_key,_value);
        };
        // split input.file for multiple files
        var _doSplitMultFiles = function(_form){
            var _result = [];
            _u._$reverseEach(
                _form.getElementsByTagName('input'),
                function(_input){
                    if (_input.type!='file'){
                        return;
                    }
                    // remove file without name
                    if (!_input.name){
                        _input.parentNode.removeChild(_input);
                        return;
                    }
                    // for multiple file per-input
                    if (_input.files.length>1){
                        _u._$forEach(_input.files,function(_file){
                            _result.push({name:_input.name,file:_file});
                        });
                        _input.parentNode.removeChild(_input);
                    }
                }
            );
            return _result.length>0?_result:null;
        };
        return function(_options){
            var _request = _options.request,
                _headers = _options.headers;
            this.__xhr = _h.__getXMLHttpRequest();
            // add event listener
            // upload progress
            if (_headers[_g._$HEAD_CT]===_g._$HEAD_CT_FILE){
                delete _headers[_g._$HEAD_CT];
                this.__xhr.upload.onprogress = 
                    this.__onStateChange._$bind(this,1);
                if (_request.data.tagName==='FORM'){
                    var _files = _doSplitMultFiles(_request.data);
                    _request.data = new FormData(_request.data);
                    _u._$forEach(_files,function(_ret){
                        var _file = _ret.file;
                        _request.data.append(
                            _ret.name||_file.name||
                            ('file-'+_u._$uniqueID()),_file
                        );
                    });
                }
            }
            // state change
            this.__xhr.onreadystatechange = 
                this.__onStateChange._$bind(this,2);
            this.__xhr.onabort =
                this.__onAbort._$bind(this);
            // timeout
            if (_request.timeout!==0){
                this.__timer = window.setTimeout(
                    this.__onStateChange._$bind(this,3),
                    _request.timeout
                );
            }
            // prepare and send request
            this.__xhr.open(
                _request.method,
                _request.url,
               !_request.sync
            );
            _u._$loop(_headers,_doSetHeader,this);
            // support credential
            if (!!this.__request.cookie&&
               ('withCredentials' in this.__xhr)){
                this.__xhr.withCredentials = !0;
            }
            // format data for sending Object
            if(_headers[_g._$HEAD_CT]===_g._$HEAD_CT_FORM&&
              (!window.FormData||!(_request.data instanceof window.FormData))){
                _request.data = _u._$object2string(_request.data,'&',!0);
            }
            this.__xhr.send(_request.data);
        };
    })();
    /**
     * 请求状态变化事件
     * 
     * @protected
     * @method module:util/ajax/proxy/xhr._$$ProxyXHR#__onStateChange
     * @param  {Number} arg0 - 状态变化类型
     * @return {Void}
     */
    _pro.__onStateChange = function(_type){
        switch(_type){
            // upload progress
            case 1 :
                this._$dispatchEvent('onuploading',arguments[1]);
            break;
            // state change
            case 2 :
                if (this.__xhr.readyState==4){
                    this.__onLoadRequest({
                        status:this.__xhr.status,
                        result:this.__xhr.responseText||''
                    });
                }
            break;
            // timeout
            case 3:
                this.__onLoadRequest({status:-1});
            break;
        }
    };
    /**
     * 取头信息
     * 
     * @protected
     * @method module:util/ajax/proxy/xhr._$$ProxyXHR#__getResponseHeader
     * @param  {String} arg0 - 要取的头信息名称
     * @return {String}        头信息结果或集合
     */
    _pro.__getResponseHeader = function(_key){
        return !this.__xhr?'':this.__xhr.getResponseHeader(_key);
    };
    /**
     * 中断请求
     * 
     * @method module:util/ajax/proxy/xhr._$$ProxyXHR#_$abort
     * @return {Void}
     */
    _pro._$abort = function(){
        if (!_h.__hasAbortEvent()){
            this.__onAbort();
        }else{
            this.__xhr.onreadystatechange = _f;
            this.__xhr.abort();
        }
    };
    
    return _p;
},'181227f3af1e0960a9790c6ccd64f2d4','3ff9c25bd81a3c2a260c28122918263a','5e5afc6c5ab9a60e963a7e2e41706b91','036fce036df53014afe007bfc84b3324','9c0d965cf27b624fe186c9592451cdfe');
I$('476aa5c6b6a2002cb12d11c487946eac',function (_m,_p,_o,_f,_r){
    var _this = this,
        _prefix = _m._$KERNEL.prefix.pro,
        _fps = _m._$is('desktop')?80:(_m._$is('ios')?50:30);
    /**
     * 请求动画
     * @param  {Function} 动画回调
     * @return {String}   动画标识
     */
    _p.__requestAnimationFrame = (function(){
        var _handler = _m._$is('android')?null:(
            _this.requestAnimationFrame||
            _this[_prefix+'RequestAnimationFrame']
        );
        return function(){
            if (!_handler){
                _handler = function(_callback){
                    return window.setTimeout(
                        function(){
                            try{_callback(+new Date);}catch(ex){}
                        },1000/_fps
                    );
                };
            }
            return _handler.apply(this,arguments);
        };
    })();
    /**
     * 取消动画
     * @param  {String} 动画标识
     * @return {Void}
     */
    _p.__cancelAnimationFrame = (function(){
        var _handler = _m._$is('android')?null:(
            _this.cancelAnimationFrame||
            _this[_prefix+'CancelAnimationFrame']
        );
        return function(){
            if (!_handler){
                _handler = function(_id){
                    window.clearTimeout(_id);
                };
            }
            return _handler.apply(this,arguments);
        };
    })();
    
    return _p;
},'345f1460138e362bb33cc48ffc7cd12b');
I$('f80e431a968a2dd9e0c4f28b7d50409e',function (_h,_m){
    return _h;
},'476aa5c6b6a2002cb12d11c487946eac','345f1460138e362bb33cc48ffc7cd12b');
I$('22f96934c3da23aa5543572084e13500',function (_m,_h,_p,_o,_f,_r){
    /**
     * 请求动画
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/timer/animation'
     * ],function(_p){
     *     // 桌面端一秒钟调用12.5次，ios端没秒调用20次，否则调用33次
     *     var _id  = _p.requestAnimationFrame(
     *         function(_time){
     *             console.log(_time);
     *         }
     *     );
     * });
     * ```
     * 
     * @method module:util/timer/animation.requestAnimationFrame
     * @param  {Function} arg0 - 动画回调
     * @return {String}          动画标识
     */
    _p.requestAnimationFrame = function(){
        _h.__requestAnimationFrame.apply(null,arguments);
    };
    /**
     * 取消动画
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/timer/animation'
     * ],function(_p){
     *     var _id  = _p.requestAnimationFrame(
     *         function(_time){
     *             console.log(_time);
     *         }
     *     );
     *     // 停止掉时钟
     *     _p.cancelAnimationFrame(_id);
     * });
     * ```
     * 
     * @method module:util/timer/animation.cancelAnimationFrame
     * @param  {String} arg0 - 动画标识
     * @return {Void}
     */
    _p.cancelAnimationFrame = function(){
        _h.__cancelAnimationFrame.apply(null,arguments);
    };
    
    if (CMPT){
        if (!this.requestAnimationFrame){
            this.requestAnimationFrame = _p.requestAnimationFrame;
        }
        if (!this.cancelAnimationFrame){
            this.cancelAnimationFrame = _p.cancelAnimationFrame;
        }
    }
    
    return _p;
},'345f1460138e362bb33cc48ffc7cd12b','f80e431a968a2dd9e0c4f28b7d50409e');
I$('945b12d10df966d4b53bc21b4753e005',function (_m,_p,_o,_f,_r){
    /**
     * 判断是否需要对Flash事件做代理，
     * 主要fix flash上的鼠标事件没法响应到DOM节点上的问题
     * @return {Boolean} 是否做代理
     */
    _p.__canFlashEventBubble = function(_wmode){
        return (_wmode||'').toLowerCase()!='transparent';
    };

    return _p;
},'345f1460138e362bb33cc48ffc7cd12b');
I$('020203798862e1e88db69fccac3b224b',function(_h,_m,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'){I$(31,function (){
        /**
         * 判断是否需要对Flash事件做代理，
         * 主要fix flash上的鼠标事件没法响应到DOM节点上的问题
         * @return {Boolean} 是否做代理
         */
        _h.__canFlashEventBubble = function(_wmode){
            return !0;
        };

    });}
if (_m._$KERNEL.engine==='webkit'){I$(32,function (){
        /**
         * 判断是否需要对Flash事件做代理，
         * 主要fix flash上的鼠标事件没法响应到DOM节点上的问题
         * @return {Boolean} 是否做代理
         */
        _h.__canFlashEventBubble = function(_wmode){
            return !0;
        };

    });}return _h;},'945b12d10df966d4b53bc21b4753e005','345f1460138e362bb33cc48ffc7cd12b');
I$('bf604a84712b227ef96b0f4b64b89e8d',"{var hide  = defined(\"hidden\")&&!!hidden}\n{var param = defined(\"params\")&&params||NEJ.O}\n{var width = !hide?width:\"1px\",height = !hide?height:\"1px\"}\n{if hide}<div style=\"position:absolute;top:0;left:0;width:1px;height:1px;z-index:10000;overflow:hidden;\">{/if}\n<object classid = \"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\"\n        codebase = \"http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab\"\n        width = \"${width|default:\"100px\"}\"\n        height = \"${height|default:\"100px\"}\" id=\"${id}\">\n    <param value=\"${src}\" name=\"movie\">\n    {for x in param}\n    <param value=\"${x}\" name=\"${x_key}\"/>\n    {/for}\n    <embed src=\"${src}\" name=\"${id}\"\n           width=\"${width|default:\"100px\"}\"\n           height=\"${height|default:\"100px\"}\"\n           pluginspage=\"http://www.adobe.com/go/getflashplayer\"\n           type=\"application/x-shockwave-flash\"\n           {for x in param}${x_key}=\"${x}\" {/for}></embed>\n</object>\n{if hide}</div>{/if}");
I$('1ef516cd8b268c36e031e36d3e0c9771',function (NEJ,_e,_v,_u,_t0,_t1,_h,_html,_p,_o,_f,_r){
    var _seed_html = _t0._$add(_html);
    /**
     * 页面嵌入flash，NEJ嵌入Flash如果需要同JS交互的遵循以下规则
     *
     *  1. Flash对象提供JS可访问接口 inited （返回Boolean值）
     *  2. 如果Flash未初始化完成inited返回为false
     *  3. 如果Flash初始化完成inited返回为true
     *  4. inited返回true表示Flash已完成所有初始化，此时JS可调用Flash的API
     *
     * Flash事件规则
     *
     *  1. JS中使用window.onflashevent监听flash中的事件（此步骤NEJ已封装）
     *  2. Flash通过flashvars参数输入当前flash的ID，如 &lt;param name="flashvars" value="id=ab&a=b"/&gt;
     *  3. Flash在需要触发事件时调用window.onflashevent回调函数，并输入一个Object作为参数,Object信息包括
     *     type   [String] - 鼠标事件类型，如click/mouseover/mouseout/play/pause...
     *     target [String] - 触发事件的flash标识，通过flashvars参数输入的id参数，做了encodeURIComponent，如a%23b
     *     ...
     *
     * 结构举例
     * ```html
     * <div id='flash'></div>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/flash/flash'
     * ],function(_e){
     *     // 生成flash对象，可以设置宽高，地址，父节点，flash参数在params中设置
     *     // flash需要提供inited接口，返回falsh已经准备好的状态
     *     _e._$flash({
     *         src:'../../qunit/res/FlexChart.swf',
     *         hidden:false,
     *         parent:'flash',
     *         width:900,
     *         height:600,
     *         params:{
     *             flashvars:'',
     *             wmode:'transparent',
     *             allowscriptaccess:'always'
     *         },
     *         onready:function(_flash){
     *             // 返回准备好的flash对象
     *             // 如果没有传入flash对象则表示无法识别到flash
     *         },
     *         oncustom:function(_event){
     *             // 自定义事件需Flash同JS预先协定好自定义事件名称，如这里的oncustom
     *             // Flash中通过调用JS的window.onflashevent({id:2222,type:'custom',...})调入此回调
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/flash/flash._$flash
     * @param    {Object}      arg0    - 可选配置参数
     * @property {String}      src     - Flash文件地址，必须指定地址
     * @property {Boolean}     hidden  - Flash是否不可见
     * @property {Number}      width   - Flash显示宽度，设为不可见时可以不设此参数
     * @property {Number}      height  - Flash显示高度，设为不可见时可以不设此参数
     * @property {String|Node} parent  - 容器节点，默认为document.body
     * @property {Object}      params  - 设置参数，object标签中的param标签参数
     * @property {String|Node} target  - 触发事件的源节点
     * @property {Function}    onready - Flash初始化完毕触发事件，输入可交互的Flash对象
     * @return   {Void}
     */
    _p._$flash = (function(){
        var _cache = {},_title,
            _reg0 = /^(?:mouse.*|(?:dbl)?click)$/i;
        // flash event
        window.onflashevent = function(_event){
            var _id = decodeURIComponent(_event.target),
                _type = _event.type.toLowerCase();
            // check mouse event bubble
            var _target = _cache[_id+'-tgt'];
            if (!!_target&&_reg0.test(_type)){
                _doMouseEventBubble(
                    _target,_event
                );
            }
            // check id-type handler
            var _handler = _cache[_id+'-on'+_type];
            if (!!_handler){
                var _result = '';
                try{
                    _result = _handler(_event);
                }catch(e){
                    // ignore
                }
                return _result;
            }
        };
        // append flash element
        var _doInitDOM = function(_options){
            // bugfix for ie title with flash
            _title = document.title;
            var _parent = _e._$get(_options.parent)||document.body,
                _html = _t0._$get(_seed_html,_options);
            _parent.insertAdjacentHTML(
               !_options.hidden?'beforeEnd':'afterBegin',_html
            );
        };
        // listen flash mouse event
        var _doMouseEventBubble = function(_id,_event){
            var _type = _event.type.toLowerCase();
            _t1.requestAnimationFrame(function(){
                _v._$dispatchEvent(_id,_type);
            });
        };
        // check flash init state
        var _doCheckFlashInit = function(_flash){
            return !!_flash&&!!_flash.inited&&!!_flash.inited();
        };
        var _doCheckFlash = function(_id){
            var _arr = [document.embeds[_id],
                       _e._$get(_id),document[_id],window[_id]],
                _index = _u._$forIn(_arr,_doCheckFlashInit),
                _flash = _arr[_index],
                _ctkey = _id+'-count';
            _cache[_ctkey]++;
            if (!!_flash||_cache[_ctkey]>100){
                if (!!_title){
                    document.title = _title;
                    _title = null;
                }
                _cache[_id](_flash);
                delete _cache[_id];
                delete _cache[_ctkey];
                return;
            }
            window.setTimeout(_doCheckFlash._$bind(null,_id),300);
        };
        // init flash event
        var _doInitFlashEvent = function(_options){
            // init flash vars
            var _id = _options.id,
                _params = _options.params;
            if (!_params){
                _params = {};
                _options.params = _params;
            }
            var _vars = _params.flashvars||'';
            _vars += (!_vars?'':'&')+('id='+_id);
            // delegate mouse event bubble
            if (!_options.hidden&&(!!_options.target||
                 _h.__canFlashEventBubble(_params.wmode))){
                var _tid = _e._$id(_options.target)||
                           _e._$id(_options.parent);
                _cache[_id+'-tgt'] = _tid;
            }
            _params.flashvars = _vars;
            // check event callback
            _u._$loop(_options,function(_value,_key){
                if (_u._$isFunction(_value)&&_key!='onready'){
                    _cache[_id+'-'+_key] = _value;
                }
            });
        };
        return function(_options){
            _options = NEJ.X({},_options);
            if (!_options.src) return;
            var _id = '_'+_u._$uniqueID();
            _options.id = _id;
            // delegate event
            _doInitFlashEvent(_options);
            // append flash
            _doInitDOM(_options);
            // check flash ready
            if (!_options.onready) return;
            _cache[_id] = _options.onready;
            _cache[_id+'-count'] = 0;
            _doCheckFlash(_id);
        };
    })();

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','1b12378d868a5877d4dba65367942b75','22f96934c3da23aa5543572084e13500','020203798862e1e88db69fccac3b224b','bf604a84712b227ef96b0f4b64b89e8d');
I$('d58889cefdcfefceb180642974043616',function (_t,_k,_c,_u,_e,_p,_o,_f,_r){
    var _pro,
        _cache = {},
        _seed = _u._$uniqueID();
    /*
     * ä»£ç†è¯·æ±‚æ­£å¸¸å›žè°ƒ
     * @param  {String} è¯·æ±‚æ ‡è¯†
     * @param  {String} è¿”å›žæ•°æ®
     * @return {Void}
     */
    this['ld'+_seed] = function(_key,_text){
        var _proxy = _cache[_key];
        if (!_proxy) return;
        delete _cache[_key];
        _proxy.__onLoadRequest({
            status:200,
            result:_text
        });
    };
    /*
     * ä»£ç†è¯·æ±‚å¼‚å¸¸å›žè°ƒ
     * @param  {String} è¯·æ±‚æ ‡è¯†
     * @param  {Number} è¯·æ±‚çŠ¶æ€
     * @return {Void} 
     */
    this['er'+_seed] = function(_key,_status){
        var _proxy = _cache[_key];
        if (!_proxy) return;
        delete _cache[_key];
        _proxy.__onLoadRequest({
            status:_status||0
        });
    };
    /**
     * Flashä»£ç†æ–¹å¼Ajaxè¯·æ±‚å¯¹è±¡
     * 
     * @class   module:util/ajax/proxy/flash._$$ProxyFlash
     * @extends module:util/ajax/proxy/proxy._$$ProxyAbstract
     * 
     * @param   {Object}  config - æž„é€ é…ç½®å‚æ•°
     */
    _p._$$ProxyFlash = _k._$klass();
    _pro = _p._$$ProxyFlash._$extend(_t._$$ProxyAbstract);
    /**
     * å¾€æœåŠ¡å™¨å‘é€è¯·æ±‚
     * 
     * @protected
     * @method module:util/ajax/proxy/flash._$$ProxyFlash#__doSendRequest
     * @param  {Object} arg0 - è¯·æ±‚ä¿¡æ¯
     * @return {Void}
     */
    _pro.__doSendRequest = function(_options){
        var _flash = _cache.flash;
        // callback list
        if (_u._$isArray(_flash)){
            _flash.push(
                this.__doSendRequest.
                    _$bind(this,_options)
            );
            return;
        }
        // build flash proxy
        if (!_flash){
            _cache.flash = [
                this.__doSendRequest.
                    _$bind(this,_options)
            ];
            _e._$flash({
                hidden:!0,
                src:_c._$get('ajax.swf'),
                onready:function(_flash){
                    if (!_flash) return;
                    var _list = _cache.flash;
                    _cache.flash = _flash;
                    _u._$reverseEach(
                        _list,function(_handler,_index,_list){
                            try{
                                _handler();
                            }catch(ex){
                                // ignore
                            }
                        }
                    );
                }
            });
            return;
        }
        // send request by flash
        this.__rkey = _u._$uniqueID();
        _cache[this.__rkey] = this;
        var _data = _u._$fetch({
            url:'',
            data:null,
            method:'GET'
        },_options.request);
        _data.key = this.__rkey;
        _data.headers  = _options.headers;
        _data.onerror  = 'cb.er'+_seed;
        _data.onloaded = 'cb.ld'+_seed;
        var _policy = _c._$getFlashProxy(_data.url);
        if (!!_policy){
            _data.policyURL = _policy;
        }
        _flash.request(_data);
    };
    /**
     * ä¸­æ–­è¯·æ±‚
     * 
     * @method module:util/ajax/proxy/flash._$$ProxyFlash#_$abort
     * @return {Void}
     */
    _pro._$abort = function(){
        delete _cache[this.__rkey];
        this.__onAbort();
    };

    return _p;
},'181227f3af1e0960a9790c6ccd64f2d4','5e5afc6c5ab9a60e963a7e2e41706b91','75482afbe8186c6aea54c5752fc62e9f','3ff9c25bd81a3c2a260c28122918263a','1ef516cd8b268c36e031e36d3e0c9771');
I$('92945a199403aa8eb66807a9ace68670',function (_p,_o,_f,_r){
    /**
     * æ ¼å¼åŒ–æºä¿¡æ¯
     * @param  {String} æº
     * @return {String} æ ¼å¼åŒ–åŽæº
     */
    _p.__formatOrigin = (function(){
        var _reg = /^([\w]+?:\/\/.*?(?=\/|$))/i;
        return function(_origin){
            _origin = _origin||'';
            if (_reg.test(_origin)){
                return RegExp.$1;
            }
            return '*';
        };
    })();
    /**
     * è§£æžæ¶ˆæ¯ä¼ é€’æ•°æ®
     * @param  {Variable} æ•°æ®
     * @return {Variable} æ•°æ®
     */
    _p.__formatPassData = function(_data){
        return _data;
    };
    /**
     * è·¨æ–‡æ¡£å‘é€æ•°æ®
     * @param  {Window} çª—ä½“å¯¹è±¡
     * @param  {Object} å‘é€é…ç½®
     * @return {Void}
     */
    _p.__postMessage = function(_window,_options){
        if (!_window.postMessage){
            return;
        }
        _options = _options||_o;
        _window.postMessage(
            _p.__formatPassData(_options.data),
            _p.__formatOrigin(_options.origin)
        );
    };
    
    return _p;
});
I$('1cba3cd6d566eae31f20db223434410e',function(b1490930307625,_h,_u,_v,_p,_o,_f,_r){if (b1490930307625._$KERNEL.engine==='trident'&&b1490930307625._$KERNEL.release>='4.0'&&b1490930307625._$KERNEL.release<='5.0'){I$(29,function (){
        /**
         * è§£æžæ¶ˆæ¯ä¼ é€’æ•°æ®
         * @param  {Variable} æ•°æ®
         * @return {Variable} æ•°æ®
         */
        _h.__formatPassData = function(_data){
            // ie8-9 only support string data
            return JSON.stringify(_data);
        };
    });}
if (b1490930307625._$KERNEL.engine==='trident'&&b1490930307625._$KERNEL.release<='3.0'){I$(30,function (_t){
        var _key = 'MSG|',
            _queue = [];
        /*
         * æ£€æµ‹window.nameå˜åŒ–æƒ…å†µ
         * @return {Void}
         */
        var _doCheckWindowName = function(){
            // check name
            var _name = unescape(window.name||'').trim();
            if (!_name||_name.indexOf(_key)!=0) return;
            window.name = '';
            // check result
            var _result = _u._$string2object(_name.replace(_key,''),'|'),
                _origin = (_result.origin||'').toLowerCase();
            // check origin
            if (!!_origin&&_origin!='*'&&
                location.href.toLowerCase().indexOf(_origin)!=0){
                return;
            }
            // dispatch onmessage event
            _v._$dispatchEvent(window,'message',{
                data:JSON.parse(_result.data||'null'),
                source:window.frames[_result.self]||_result.self,
                origin:_h.__formatOrigin(_result.ref||document.referrer)
            });
        };
        /*
         * æ£€æµ‹window.nameè®¾ç½®é˜Ÿåˆ—
         * @return {Void}
         */
        var _doCheckNameQueue = (function(){
            var _checklist;
            // set window.name
            var _doSetWindowName = function(_map,_index,_list){
                if (_u._$indexOf(_checklist,_map.w)<0){
                    _checklist.push(_map.w);
                    _list.splice(_index,1);
                    _map.w.name = _map.d;
                }
            };
            return function(){
                _checklist = [];
                _u._$reverseEach(_queue,_doSetWindowName);
                _checklist = null;
            };
        })();
        /**
         * è·¨æ–‡æ¡£å‘é€æ•°æ®
         * @param  {Window} çª—ä½“å¯¹è±¡
         * @param  {Object} å‘é€é…ç½®
         * @return {Void}
         */
        _h.__postMessage = (function(){
            // serialize send data
            var _doSerialize = function(_data){
                var _result = {};
                _data = _data||_o;
                _result.origin = _data.origin||'';
                _result.ref  = location.href;
                _result.self = _data.source;
                _result.data = JSON.stringify(_data.data);
                return _key+_u._$object2string(_result,'|',!0);
            };
            // function body
            return function(_window,_options){
                _queue.unshift({
                    w:_window,
                    d:escape(_doSerialize(_options))
                });
            };
        })();

        // init window onmessage event
        _t._$$CustomEvent._$allocate({
            element:window,
            event:'message'
        });
        setInterval(_doCheckNameQueue,100);
        setInterval(_doCheckWindowName,20);
    },'8717e18cf0d38e654531116f64f5593d','2893fe4191b99bbcb2db10b5332d9654');}return _h;},'345f1460138e362bb33cc48ffc7cd12b','92945a199403aa8eb66807a9ace68670','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4');
I$('93c8a9f7a2bacc220d9719bd1de9deb1',function (NEJ,_u,_e,_h,_p,_o,_f,_r){
    /**
     * å‘é€è·¨æ–‡æ¡£çš„æ¶ˆæ¯
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     * <!-- æ³¨æ„éœ€è¦é€šè¿‡sourceè¿›è¡ŒåŒå‘äº¤äº’çš„frameèŠ‚ç‚¹å¿…é¡»è®¾ç½®idå±žæ€§ä½œä¸ºæ ‡è¯† -->
     * <iframe id="targetFrame" src="http://a.b.com/a.html"></iframe>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'base/event'
     *     'util/ajax/message'
     * ],function(_v,_j){
     *     // topé¡µé¢ä»£ç 
     *     // å‘é€æ¶ˆæ¯è‡³ http://c.d.com çš„é¡µé¢
     *     _j._$postMessage('targetFrame',{
     *         data:'hello c.d.com',
     *         origin:'http://c.d.com'
     *     });
     *
     *     // http://a.b.com/a.htmlé¡µé¢ä»£ç 
     *     // æ·»åŠ æ¶ˆæ¯ç›‘æµ‹äº‹ä»¶
     *     _v._$addEvent(
     *         window,'message',function(_event){
     *             // å› ä¸ºtopé¡µé¢å‘é€æ¶ˆæ¯åˆ° http://c.d.com
     *             // æ‰€ä»¥åœ¨http://a.b.comé¡µé¢ä¸ä¼šæ”¶åˆ°ä»»ä½•æ¶ˆæ¯
     *         }
     *     );
     *
     *     // topé¡µé¢ä»£ç 
     *     // å‘é€æ¶ˆæ¯è‡³ http://a.b.com çš„é¡µé¢
     *     _j._$postMessage('targetFrame',{
     *         data:'hello a.b.com'
     *     });
     *
     *     // http://a.b.com/a.htmlé¡µé¢ä»£ç 
     *     // æ·»åŠ æ¶ˆæ¯ç›‘æµ‹äº‹ä»¶
     *     _v._$addEvent(
     *         window,'message',function(_event){
     *             // å¿…é¡»å…ˆéªŒè¯æ¶ˆæ¯æ¥æº_event.originæ˜¯å¦ä½ å…è®¸çš„åŸŸ
     *              if (!_isAllow(_event.origin))
     *                 return;
     *
     *             // å¤„ç†_event.dataä¸­çš„æ¶ˆæ¯å†…å®¹
     *             // TODO something
     *
     *             // å›žå¤æ¶ˆæ¯ï¼Œä½¿ç”¨_event.source
     *             _j._$postMessage(_event.source,{
     *                 data:'hello!',
     *                 origin:_event.origin
     *             });
     *         }
     *     );
     * });
     * ```
     *
     * @method module:util/ajax/message._$postMessage
     * @param  {String|Window} arg0   - windowå¯¹è±¡æˆ–è€…Frameçš„nameï¼Œæˆ–è€…å­—ç¬¦ä¸²å¦‚_topã€_parentã€_self
     * @param  {Object}        arg1   - æ¶ˆæ¯é…ç½®
     * @property {Variable}      data   - æ¶ˆæ¯å†…å®¹
     * @property {String}        origin - ç›®æ ‡Originï¼Œåªæœ‰æŒ‡å®šçš„é¡µé¢å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¦‚http://a.b.com
     * @property {String}        source - å½“å‰çª—ä½“æ ‡è¯†ï¼Œé™¤éžä½ éžå¸¸ç¡®å®šå½“å‰çª—ä½“çš„æ ‡è¯†æ˜¯ä»€ä¹ˆï¼Œå¦åˆ™è¯·é‡‡ç”¨è‡ªåŠ¨è¯†åˆ«
     * @return {Void}
     */
    _p._$postMessage = (function(){
        var _self = window.name||'_parent',
            _wmap = {
                '_top'   : window.top,
                '_self'  : window,
                '_parent': window.parent
            };
        return function(_target,_options){
            if (_u._$isString(_target)){
                _target = _wmap[_target]||
                          window.frames[_target]||
                         (_e._$get(_target)||_o).contentWindow;
                if (!_target) return;
            }
            // check data
            var _data = _u._$fetch({
                data:null,
                origin:'*',
                source:_self
            },_options);
            // send message
            _h.__postMessage(_target,_data);
        };
    })();

    if (CMPT){
        NEJ.copy(NEJ.P('nej.j'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','1cba3cd6d566eae31f20db223434410e');
I$('24417e7fa73f795907af31c263ae3ee3',function (_t,_u,_k,_v,_c,_e,_j,_p,_o,_f,_r){
    var _pro,
        _cache = {};
    /**
     * Frameä»£ç†æ–¹å¼Ajaxè¯·æ±‚å¯¹è±¡
     * 
     * @class   module:util/ajax/proxy/frame._$$ProxyFrame
     * @extends module:util/ajax/proxy/proxy._$$ProxyAbstract
     * 
     * @param   {Object}  config - æž„é€ é…ç½®å‚æ•°
     */
    _p._$$ProxyFrame = _k._$klass();
    _pro = _p._$$ProxyFrame._$extend(_t._$$ProxyAbstract);
    /**
     * æŽ§ä»¶åˆå§‹åŒ–
     *
     * @protected
     * @method module:util/ajax/proxy/frame._$$ProxyFrame#__init
     * @return {Void}
     */
    _pro.__init = (function(){
        var _flag = 'NEJ-AJAX-DATA:',
            _init = !1;
        // receive message
        var _doReceiveMessage = function(_event){
            var _data = _event.data;
            if (_data.indexOf(_flag)!=0) return;
            _data = JSON.parse(_data.replace(_flag,''));
            var _proxy = _cache[_data.key];
            if (!_proxy) return;
            delete _cache[_data.key];
            _data.result = decodeURIComponent(_data.result||'');
            _proxy.__onLoadRequest(_data);
        };
        // init message listener
        var _doInitMessage = function(){
            if (!_init){
                _init = !0;
                _v._$addEvent(
                    window,'message',
                    _doReceiveMessage
                );
            }
        };
        return function(){
            this.__super();
            _doInitMessage();
        };
    })();
    /**
     * å¾€æœåŠ¡å™¨å‘é€è¯·æ±‚
     *
     * @protected
     * @method module:util/ajax/proxy/frame._$$ProxyFrame#__doSendRequest
     * @param  {Object} arg0 - è¯·æ±‚ä¿¡æ¯
     * @return {Void}
     */
    _pro.__doSendRequest = function(_options){
        var _request = _options.request,
            _proxy = _c._$getFrameProxy(_request.url),
            _frame = _cache[_proxy];
        // callback list
        if (_u._$isArray(_frame)){
            _frame.push(
                this.__doSendRequest.
                    _$bind(this,_options)
            );
            return;
        }
        // build frame proxy
        if (!_frame){
            _cache[_proxy] = [
                this.__doSendRequest.
                    _$bind(this,_options)
            ];
            _e._$createXFrame({
                src:_proxy,visible:!1,
                onload:function(_event){
                    var _list = _cache[_proxy];
                    _cache[_proxy] = _v.
                        _$getElement(_event).contentWindow;
                    _u._$reverseEach(
                        _list,function(_handler){
                            try{
                                _handler();
                            }catch(ex){
                                // ignore
                            }
                        }
                    );
                }
            });
            return;
        }
        // send message to frame
        this.__rkey = _u._$uniqueID();
        _cache[this.__rkey] = this;
        var _data = _u._$fetch({
            url:'',data:null,
            timeout:0,method:'GET'
        },_request);
        _data.key = this.__rkey;
        _data.headers = _options.headers;
        _j._$postMessage(_cache[_proxy],{data:_data});
    };
    /**
     * ä¸­æ–­è¯·æ±‚
     * 
     * @method module:util/ajax/proxy/frame._$$ProxyFrame#_$abort
     * @return {Void}
     */
    _pro._$abort = function(){
        delete _cache[this.__rkey];
        this.__onAbort();
    };
    
    return _p;
},'181227f3af1e0960a9790c6ccd64f2d4','3ff9c25bd81a3c2a260c28122918263a','5e5afc6c5ab9a60e963a7e2e41706b91','b9845e13e284410cb0bb909f737020e4','75482afbe8186c6aea54c5752fc62e9f','555a9eecaf26c5c01fe9db8d965bc30f','93c8a9f7a2bacc220d9719bd1de9deb1');
I$('d832ba71fc50bac26c9d4a7d484c8c94',function (_t,_k,_u,_v,_e,_g,_j0,_j1,_p,_o,_f,_r){
    var _pro,
        _cache = {},
        _xflag = 'NEJ-UPLOAD-RESULT:';
    /**
     * æ–‡ä»¶ä¸Šä¼ ä»£ç†
     *
     * @class   module:util/ajax/proxy/upload._$$ProxyUpload
     * @extends module:util/ajax/proxy/proxy._$$ProxyAbstract
     *
     * @param   {Object}  config - 构造配置参数
     */
    _p._$$ProxyUpload = _k._$klass();
    _pro = _p._$$ProxyUpload._$extend(_t._$$ProxyAbstract);
    /**
     * 控件初始化
     *
     * @protected
     * @method module:util/ajax/proxy/upload._$$ProxyUpload#__init
     * @return {Void}
     */
    _pro.__init = (function(){
        var _init = !1;
        // receive message callback
        var _doReceiveMessage = function(_event){
            var _data = _event.data;
            if (_data.indexOf(_xflag)!=0) return;
            _data = JSON.parse(_data.replace(_xflag,''));
            var _proxy = _cache[_data.key];
            if (!_proxy) return;
            delete _cache[_data.key];
            _proxy.__onLoadRequest(
                decodeURIComponent(_data.result)
            );
        };
        // init message listener
        var _doInitMessage = function(){
            if (!_init){
                _init = !0;
                _v._$addEvent(
                    window,'message',
                    _doReceiveMessage
                );
            }
        };
        return function(){
            this.__super();
            _doInitMessage();
        };
    })();
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/ajax/proxy/upload._$$ProxyUpload#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        _e._$remove(this.__frame);
        delete this.__frame;
        window.clearTimeout(this.__timer);
        delete this.__timer;
    };
    /**
     * 请求载入回调
     * 
     * @protected
     * @method module:util/ajax/proxy/upload._$$ProxyUpload#__onLoadRequest
     * @param  {String} arg0 - 数据信息
     * @return {Void}
     */
    _pro.__onLoadRequest = function(_text){
        try{
            var _ret = _e._$text2type(
                _text,this.__request.type
            );
            this._$dispatchEvent('onload',_ret);
        }catch(ex){
            this._$dispatchEvent('onerror',{
                code:_g._$CODE_ERREVAL,
                message:_text
            });
        }
    };
    /**
     * 往服务器发送请求
     * 
     * @protected
     * @method module:util/ajax/proxy/upload._$$ProxyUpload#__doSendRequest
     * @param  {Object} arg0 - 请求信息
     * @return {Void}
     */
    _pro.__doSendRequest = (function(){
        // same domain upload result check
        var _doCheckResult = function(){
            var _body,_text;
            try{
                var _body = this.__frame.contentWindow.document.body,
                    _text = (_body.innerText||_body.textContent||'').trim();
                // check result for same domain with upload proxy html
                if (_text.indexOf(_xflag)>=0||
                    _body.innerHTML.indexOf(_xflag)>=0){
                    // use post message path
                    return;
                }
            }catch(ex){
                // ignore if not same domain
                return;
            }
            this.__onLoadRequest(_text);
        };
        // check upload progress
        var _doProgress = function(_url,_mode,_cookie){
            _j0._$request(_url,{
                type:'json',
                method:'POST',
                cookie:_cookie,
                mode:parseInt(_mode)||0,
                onload:function(_data){
                    if (!this.__timer) return;
                    this._$dispatchEvent('onuploading',_data);
                    this.__timer = window.setTimeout(
                        _doProgress._$bind(
                            this,_url,_mode,_cookie
                        ),1000
                    );
                }._$bind(this),
                onerror:function(_error){
                    if (!this.__timer) return;
                    this.__timer = window.setTimeout(
                        _doProgress._$bind(
                            this,_url,_mode,_cookie
                        ),1000
                    );
                }._$bind(this)
            });
        };
        return function(_options){
            var _request = _options.request,
                _headers = _options.headers,
                _form = _request.data,
                _name = _u._$uniqueID();
            _cache[_name]  = this;
            _form.target   = _name;
            _form.method   = 'POST';
            _form.enctype  = _g._$HEAD_CT_FILE;
            _form.encoding = _g._$HEAD_CT_FILE;
            var _url = _form.action||'',
                _sep = _url.indexOf('?')<=0?'?':'&';
            _form.action = _url+_sep+'_proxy_=form';
            this.__frame = _e._$createXFrame({
                name:_name,
                onload:function(_event){
                    var _frame = _v._$getElement(_event);
                    _v._$addEvent(
                        _frame,'load',
                        _doCheckResult._$bind(this)
                    );
                    _form.submit();
                    var _qurl = (_form.nej_query||_o).value;
                    if (!_qurl) return;
                    var _mode = (_form.nej_mode||_o).value,
                        _cookie = (_form.nej_cookie||_o).value==='true';
                    this.__timer = window.setTimeout(
                        _doProgress._$bind(
                            this,_qurl,_mode,_cookie
                        ),100
                    );
                }._$bind(this)
            });
        };
    })();
    /**
     * 中断请求
     * 
     * @method module:util/ajax/proxy/upload._$$ProxyUpload#_$abort
     * @return {Void}
     */
    _pro._$abort = function(){
        this.__onAbort();
    };

    return _p;
},'181227f3af1e0960a9790c6ccd64f2d4','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','036fce036df53014afe007bfc84b3324','19b4ef9670142281a6ff17ec75864bee','93c8a9f7a2bacc220d9719bd1de9deb1');
I$('ae50c4323a82dacd2b311b41c2c5e459',function (_t0,_t1,_t2,_t3,_p,_o,_f,_r){
    /**
     * 根据模式返回代理实例，模式说明
     * 0 - 自动模式，高版本使用HTML5的CORS协议，低版本采用Frame代理方式
     * 1 - 高版本使用HTML5的CORS协议，普通请求低版本采用Flash代理方式
     * 2 - 全部使用Frame代理方式
     * 3 - 全部使用Flash代理方式
     * @param  {Number}   模式
     * @param  {Boolean}  是否文件上传
     * @param  {Object}   构造配置参数
     * @return {_$$ProxyAbstract} 代理实例
     */
    _p.__getProxyByMode = function(_mode,_upload,_options){
        var _map = !!_upload 
                 ? {2:_t3._$$ProxyUpload}
                 : {2:_t2._$$ProxyFrame,3:_t1._$$ProxyFlash};
        return (_map[_mode]||_t0._$$ProxyXHR)._$allocate(_options);
    };
    
    return _p;
},'77322c4083e1992e07612592f5d11fdf','d58889cefdcfefceb180642974043616','24417e7fa73f795907af31c263ae3ee3','d832ba71fc50bac26c9d4a7d484c8c94');
I$('6cde11aef6e623ffcacf984746277b20',function(b1490930300825,_h,_p,_o,_f,_r){if (b1490930300825._$KERNEL.engine==='trident'&&b1490930300825._$KERNEL.release<='5.0'){I$(16,function (){
        /**
         * 根据模式返回代理实例，模式说明
         * 0 - 自动模式，高版本使用HTML5的CORS协议，低版本采用Frame代理方式
         * 1 - 高版本使用HTML5的CORS协议，普通请求低版本采用Flash代理方式
         * 2 - 全部使用Frame代理方式
         * 3 - 全部使用Flash代理方式
         * @param  {Number}  模式
         * @param  {Boolean} 是否文件上传
         * @param  {Object}  构造配置参数
         * @return {_$$ProxyAbstract} 代理实例
         */
        _h.__getProxyByMode = (function(){
            var _pmap = {0:2,1:3};
            return _h.__getProxyByMode._$aop(function(_event){
               var _args = _event.args,
                   _mode = _args[0]||0;
               _args[0] = !!_args[1] ? 2 :
                          _pmap[_mode]||_mode;
            });
        })();
    });}return _h;},'345f1460138e362bb33cc48ffc7cd12b','ae50c4323a82dacd2b311b41c2c5e459');
I$('19b4ef9670142281a6ff17ec75864bee',function (NEJ,_g,_u,_e,_t,_h,_p,_o,_f,_r){
    /**
     * 载入回调
     *
     * @callback module:util/ajax/xdr.onload
     * @param    {Variable|Object} event - 请求返回数据，根据请求时type指定格式返回，
     *                                     如果请求时指定了result参数，则此处输入为包含额外信息的对象，
     *                                     数据结果从此对象的data属性中取，如{headers:{'x-res-0':'12345', ...},data:{a:'aaa', ...}}
     */
    /**
     * 出错回调
     *
     * @callback module:util/ajax/xdr.onerror
     * @param    {Object}   event   - 错误信息
     * @property {Number}   code    - 错误代码
     * @property {String}   message - 错误描述
     * @property {Variable} data    - 出错时携带数据
     */
    /**
     * 请求之前对数据处理回调
     *
     * @callback module:util/ajax/xdr.onbeforerequest
     * @param    {Object} event   - 请求信息
     * @property {Object} request - 请求参数，数据信息 url/sync/cookie/type/method/timeout
     * @property {Object} headers - 请求头信息
     */
    /**
     * 上传进度回调
     *
     * @callback module:util/ajax/xdr.onuploading
     * @param    {Object} event  - 进度信息
     * @property {Number} loaded - 载入数量
     * @property {Number} total  - 总量
     */
    // sn:{req:proxy,onload:function(){},onerror:function(){}}
    var _xcache = {},
        _doFilter = _f;
    /**
     * 中断请求
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/xdr'
     * ],function(_j){
     *     var _id = _j._$request(
     *         'http://123.163.com/xhr/',{
     *             type:'json',
     *             method:'POST',
     *             data:{name:'ABC'},
     *             timeout:60000,
     *             onload:function(_data){
     *                 // TODO
     *             },
     *             onerror:function(_error){
     *                 // TODO
     *             }
     *         }
     *     );
     *     // 1秒后中断掉这个请求
     *     window.setTimeout(
     *         function(){
     *             _j._$abort(_id);
     *         },1000
     *     );
     * });
     * ```
     *
     * @method module:util/ajax/xdr._$abort
     * @param  {String} arg0 - 请求标识
     * @return {Void}
     */
    _p._$abort = function(_sn){
        var _cache = _xcache[_sn];
        if (!!_cache){
            _cache.req._$abort();
        }
    };
    /**
     * 全局请求过滤器，过滤器中可以通过设置输入事件对象的stopped值阻止继续回调
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/xdr'
     * ],function(_j){
     *     _j._$filter(function(_event){
     *         // _event.type     请求过滤类型
     *         // _event.result   请求结果
     *         // _event.stopped  是否阻止后续逻辑
     *
     *         // 过滤掉404的异常，如果type是onload不做处理
     *         if (_event.type == 'onerror'){
     *             if (_event.result.data == 404){
     *                 _event.stopped = false;
     *             }
     *         }
     *     });
     *     _j._$request('xxxx',{
     *         type:'json',
     *         method:'POST',
     *         data:{name:'abc'},
     *         timeout:3000,
     *         onload:function(_data){
     *             // TODO
     *         },
     *         onerror:function(_error){
     *             // TODO
     *         }
     *     });
     * });
     * ```
     *
     * @method module:util/ajax/xdr._$filter
     * @param  {Function} arg0 - 过滤器
     * @return {Void}
     */
    _p._$filter = function(_filter){
        _doFilter = _filter||_f;
    };
    /**
     * 发送ajax请求
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/xdr'
     * ],function(_p){
     *     var _id = _p._$request(
     *         'http://a.b.com/api',{
     *             sync:true,
     *             type:'json',
     *             data:'hello',
     *             query:'a=1&b=2',
     *             method:'post',
     *             timeout:3000,
     *             mode:0||1||2||3,
     *             onload:function(_data){
     *                 // 正常回调处理
     *             },
     *             onerror:function(_error){
     *                 // 异常处理
     *             },
     *             onbeforerequest:function(_data){
     *                 // 请求发送前，对请求数据处理
     *             }
     *         }
     *     );
     * });
     * ```
     *
     * @method   module:util/ajax/xdr._$request
     * @param    {String}   arg0    - 请求地址
     * @param    {Object}   arg1    - 配置参数
     * @property {Boolean}  sync    - 是否同步请求
     * @property {String}   type    - 返回数据格式,text/json/xml
     * @property {Variable} data    - 要发送的数据
     * @property {Variable} query   - 查询参数,字符串格式a=b&c=d,对象格式{a:'b',c:'d'}
     * @property {String}   method  - 请求方式,GET/POST
     * @property {Number}   timeout - 超时时间,0 禁止超时监测
     * @property {Object}   headers - 头信息表，标准HTTP头字段
     * @property {Boolean}  cookie  - 跨域请求是否带cookie，仅对CORS方式有效
     * @property {Number}   mode    - 请求模式,针对跨域请求采用的请求方式
     *
     * * 0 - 自动模式，高版本使用HTML5的CORS协议，低版本采用Frame代理方式
     * * 1 - 高版本使用HTML5的CORS协议，低版本采用Flash代理方式
     * * 2 - 全部使用Frame代理方式
     * * 3 - 全部使用Flash代理方式
     *
     * @property {Object}   result  - onload回调输入时需包含的额外信息，已处理额外数据
     *
     * * headers - 服务器返回头信息，如{headers:'x-res-0'}或者{headers:['x-res-0','x-res-1']}
     *
     * @property {module:util/ajax/xdr.onload}          onload  - 数据载入回调
     * @property {module:util/ajax/xdr.onerror}         onerror - 请求异常回调
     * @property {module:util/ajax/xdr.onbeforerequest} onbeforerequest - 请求之前回调
     *
     * @return   {String} 分配给请求的ID
     */
    _p._$request = (function(){
        var _location = (location.protocol+'//'
                        +location.host).toLowerCase();
        // check cross-domain request
        var _isXDomain = function(_url){
            var _origin = _u._$url2origin(_url);
            return !!_origin&&_origin!=_location;
        };
        // check file upload
        var _isUpload = function(_headers){
            return (_headers||_o)[_g._$HEAD_CT]==_g._$HEAD_CT_FILE;
        };
        // get ajax proxy
        var _getProxy = function(_options){
            var _upload = _isUpload(_options.headers);
            if (!_isXDomain(_options.url)&&!_upload)
                return _t._$$ProxyXHR._$allocate(_options);
            return _h.__getProxyByMode(_options.mode,_upload,_options);
        };
        // parse ext result
        var _doParseExtData = function(_cache,_result){
            var _data = {
                data:_result
            };
            // parse ext headers
            var _keys = _cache.result.headers;
            if (!!_keys){
                _data.headers = _cache.req._$header(_keys);
            }
            // TODO parse other ext data
            return _data;
        };
        // clear cache
        var _doClear = function(_sn){
            var _cache = _xcache[_sn];
            if (!_cache) return;
            if (!!_cache.req)
                _cache.req._$recycle();
            delete _xcache[_sn];
        };
        // do callback
        var _doCallback = function(_sn,_type){
            var _cache = _xcache[_sn];
            if (!_cache) return;
            var _data = arguments[2];
            if (_type=='onload'&&!!_cache.result){
                _data = _doParseExtData(_cache,_data);
            }
            _doClear(_sn);
            var _event = {
                type:_type,
                result:_data
            };
            _doFilter(_event);
            if (!_event.stopped){
               (_cache[_type]||_f)(_event.result);
            }
        };
        // onload callback
        var _onLoad = function(_sn,_data){
            _doCallback(_sn,'onload',_data);
        };
        // onerror callback
        var _onError = function(_sn,_error){
            _doCallback(_sn,'onerror',_error);
        };
        // check data for get method
        var _doMergeURL = function(_url,_data){
            var _sep = _url.indexOf('?')<0?'?':'&',
                _data = _data||'';
            if (_u._$isObject(_data))
                _data = _u._$object2query(_data);
            if (!!_data) _url += _sep+_data;
            return _url;
        };
        // function body
        return function(_url,_options){
            _options = _options||{};
            // cache request callback
            var _sn = _u._$uniqueID(),
                _cache = {
                    result:_options.result,
                    onload:_options.onload||_f,
                    onerror:_options.onerror||_f
                };
            _xcache[_sn] = _cache;
            _options.onload = _onLoad._$bind(null,_sn);
            _options.onerror = _onError._$bind(null,_sn);
            // append request query
            if (!!_options.query){
                _url = _doMergeURL(_url,_options.query);
            }
            // append request data for get
            var _method = _options.method||'';
            if ((!_method||/get/i.test(_method))&&!!_options.data){
                _url = _doMergeURL(_url,_options.data);
                _options.data = null;
            }
            _options.url = _url;
            _cache.req = _getProxy(_options);
            _cache.req._$send(_options.data);
            return _sn;
        };
    })();
    /**
     * 文件上传
     *
     * 结构举例
     * ```html
     * <form id="upload" name="upload" action="http://123.163.com:3000/xhr/uploadCallback">
     *    <input type="text" id="progress" />
     *    <input type="hidden" name="nej_mode" value="2" />
     *    <input type="hidden" name="nej_query" value="http://123.163.com:3000/xhr/progress" />
     * </form>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/xdr'
     * ],function(_j){
     *     _j._$upload('upload',{
     *         mode:2,
     *         cookie:true,
     *         onuploading:function(_data){
     *             // 后台处理http://123.163.com:3000/xhr/progress，返回一个json对象
     *             // 前台会去轮询此接口获取进度
     *             if(!!_data.total&&_data.progress){
     *                 _progress.value = _data.progress;
     *             }
     *         },
     *         onload:function(_url){
     *             // 此前会把进度轮询终止掉。如果要显示进度100%，可在此设置一次
     *             // 后台处理http://123.163.com:3000/xhr/uploadCallback，返回url
     *             // 文件上传完成的回调,url为返回的地址
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/xdr._$upload
     * @see      module:util/ajax/xdr._$request
     * @param    {HTMLFormElement}  arg0    - 表单对象，待上传的文件及目标地址信息封装在此对象中
     * @param    {Object}           arg1    - 可选配置参数
     * @property {String}           type    - 返回数据格式
     * @property {Variable}         query   - 查询参数
     * @property {Number}           mode    - 跨域类型，0/2，见_$request接口说明
     * @property {Object}           headers - 头信息
     * @property {Boolean}          cookie  - 跨域请求是否带cookie，仅对CORS方式有效
     *
     * @property {module:util/ajax/xdr.onload}          onload  - 数据载入回调
     * @property {module:util/ajax/xdr.onerror}         onerror - 请求异常回调
     * @property {module:util/ajax/xdr.onuploading}     onuploading     - 上传进度回调
     * @property {module:util/ajax/xdr.onbeforerequest} onbeforerequest - 请求之前回调
     *
     * @return   {String}                     分配给请求的ID
     */
    _p._$upload = function(_form,_options){
        _form = _e._$get(_form);
        if (!_form){
            return '';
        }
        // init param
        var _option = _u._$fetch({
            mode:0,
            type:'json',
            query:null,
            cookie:!1,
            headers:{},
            onload:null,
            onerror:null,
            onuploading:null,
            onbeforerequest:null
        },_options);
        _option.data = _form;
        _option.method = 'POST';
        _option.timeout = 0;
        _option.headers[_g._$HEAD_CT] =
                        _g._$HEAD_CT_FILE;
        return _p._$request(_form.action,_option);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.j'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','036fce036df53014afe007bfc84b3324','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','77322c4083e1992e07612592f5d11fdf','6cde11aef6e623ffcacf984746277b20');
I$('5c3b016d2f71002467979c5acea5b867',function (_t,_k,_e,_j,_p,_o,_f,_r){
    var _pro;
    /**
     * 文本资源加载器
     *
     * @class   module:util/ajax/loader/text._$$LoaderText
     * @extends module:util/ajax/loader/loader._$$LoaderAbstract
     *
     * @param   {Object} config - 可选配置参数
     */
    _p._$$LoaderText = _k._$klass();
    _pro = _p._$$LoaderText._$extend(_t._$$LoaderAbstract);
    /**
     * 取资源载入控件
     *
     * @protected
     * @method module:util/ajax/loader/style._$$LoaderText#__getRequest
     * @return {Node} 控件节点
     */
    _pro.__getRequest = function(){
        return null;
    };
    /**
     * 资源载入
     *
     * @protected
     * @method module:util/ajax/loader/style._$$LoaderText#__doRequest
     * @param  {Node} 控件节点
     * @return {Void}
     */
    _pro.__doRequest = function(){
        _j._$request(this.__url,{
            method:'GET',
            type:'text',
            onload:this.__onLoaded._$bind(this),
            onerror:this.__onError._$bind(this)
        });
    };
    /**
     * 资源载入成功事件
     *
     * @protected
     * @method module:util/ajax/loader/style._$$LoaderText#__onLoaded
     * @return {Void}
     */
    _pro.__onLoaded = function(_text){
        this.__doCallback('onload',{
            url:this.__url,
            content:_text
        });
    };

    return _p;
},'15b86578d249c817b9a2d8bd847934f1','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','19b4ef9670142281a6ff17ec75864bee');
I$('6d4a883ea9d139a016c39523dd0554a0',function (_e,_p,_o,_f,_r){
    /**
     * 删除IFrame节点，保留历史
     * @param  {Node} iframe节点
     * @return {Void}
     */
    _p.__removeIFrameKeepHistory = function(_iframe){
        _e._$remove(_iframe);
    };
    
    return _p;
},'555a9eecaf26c5c01fe9db8d965bc30f');
I$('9038f3e801e904281d7ff633d84002d1',function(_h,_e,_m,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='2.0'){I$(25,function (){
        /**
         * 删除IFrame节点，保留历史
         * @param  {Node} iframe节点
         * @return {Void}
         */
        _h.__removeIFrameKeepHistory = function(_iframe){
            _e._$setStyle(_iframe,'display','none');
            try{_iframe.contentWindow.document.body.innerHTML = '&nbsp;';}catch(ex){}
        };
    });}return _h;},'6d4a883ea9d139a016c39523dd0554a0','555a9eecaf26c5c01fe9db8d965bc30f','345f1460138e362bb33cc48ffc7cd12b');
I$('9d65886d3caa4751e0e74eb54fbc2518',function (_t,_k,_e,_h,_p,_o,_f,_r){
    var _pro;
    /**
     * HTML资源加载器
     * 
     * @class   module:util/ajax/loader/html._$$LoaderHtml
     * @extends module:util/ajax/loader/loader._$$LoaderAbstract
     * 
     * @param   {Object} config - 可选配置参数
     */
    _p._$$LoaderHtml = _k._$klass(); 
    _pro = _p._$$LoaderHtml._$extend(_t._$$LoaderAbstract);
    /**
     * 取资源载入控件
     * 
     * @protected
     * @method module:util/ajax/loader/html._$$LoaderHtml#__getRequest
     * @return {Node} IFrame节点
     */
    _pro.__getRequest = function(){
        var _iframe = _e._$create('iframe');
        _iframe.width = 0;
        _iframe.height = 0;
        _iframe.style.display = 'none';
        return _iframe;
    };
    /**
     * 资源载入
     * 
     * @protected
     * @method module:util/ajax/loader/html._$$LoaderHtml#__doRequest
     * @param  {Node} arg0 - 控件节点
     * @return {Void}
     */
    _pro.__doRequest = function(_request){
        try{
            // append first for history bug
            document.body.appendChild(_request);
            _request.src = this.__url;
        }catch(ex){
            console.log(_request);
            console.error(ex);
        }
    };
    /**
     * 资源载入异常事件
     * 
     * @protected
     * @method module:util/ajax/loader/html._$$LoaderHtml#__onError
     * @param  {Object} arg0 - 错误信息
     * @return {Void}
     */
    _pro.__onError = function(_error){
        var _iframe = (
            this.__getLoadData(this.__url)||_o
        ).request;
        this.__doCallback('onerror',_error);
        _h.__removeIFrameKeepHistory(_iframe);
    };
    /**
     * 资源载入成功事件
     * 
     * @protected
     * @method module:util/ajax/loader/html._$$LoaderHtml#__onLoaded
     * @return {Void}
     */
    _pro.__onLoaded = function(){
        var _body = null,
            _iframe = (this.__getLoadData(this.__url)||_o).request;
        try{
            if (_iframe.src!=this.__url) return;
            _body = _iframe.contentWindow.document.body;
        }catch(ex){
            // ignore
        }
        this.__doCallback('onload',_body);
        _h.__removeIFrameKeepHistory(_iframe);
    };

    return _p;
},'15b86578d249c817b9a2d8bd847934f1','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','9038f3e801e904281d7ff633d84002d1');
I$('d043976616a472ae7c37adb7d68f766f',function (_t,_k,_e,_p,_o,_f,_r){
    var _pro;
    /**
     * 样式加载器
     *
     * @class   module:util/ajax/loader/style._$$LoaderStyle
     * @extends module:util/ajax/loader/loader._$$LoaderAbstract
     *
     * @param   {Object} config - 可选配置参数
     */
    _p._$$LoaderStyle = _k._$klass();
    _pro = _p._$$LoaderStyle._$extend(_t._$$LoaderAbstract);
    /**
     * 取资源载入控件
     *
     * @protected
     * @method module:util/ajax/loader/style._$$LoaderStyle#__getRequest
     * @return {Node} 控件节点
     */
    _pro.__getRequest = function(){
        return _e._$create('link');
    };
    /**
     * 资源载入
     *
     * @protected
     * @method module:util/ajax/loader/style._$$LoaderStyle#__doRequest
     * @param  {Node} 控件节点
     * @return {Void}
     */
    _pro.__doRequest = function(_request){
        _request.href = this.__url;
        document.head.appendChild(_request);
    };

    return _p;
},'15b86578d249c817b9a2d8bd847934f1','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f');
I$('56694a4bb274aebea8cfe443dc7ac6ec',function (_t,_k,_e,_p,_o,_f,_r){
    var _pro;
    /**
     * 脚本加载器
     * 
     * @class    module:util/ajax/loader/script._$$LoaderScript
     * @extends  module:util/ajax/loader/loader._$$LoaderAbstract
     * 
     * @param    {Object} config   - 可选配置参数
     * @property {Boolean} async   - 异步载入并立刻执行，默认为!0
     * @property {String}  charset - 脚本编码
     */
    _p._$$LoaderScript = _k._$klass();
    _pro = _p._$$LoaderScript._$extend(_t._$$LoaderAbstract);
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/ajax/loader/script._$$LoaderScript#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__async = _options.async;
        this.__charset = _options.charset;
        this.__qopt.async = !1;
        this.__qopt.charset = this.__charset;
    };
    /**
     * 取资源载入控件
     * 
     * @protected
     * @method module:util/ajax/loader/script._$$LoaderScript#__getRequest
     * @return {Script} 控件
     */
    _pro.__getRequest = function(){
        var _request = _e._$create('script');
        if (this.__async!=null){
            _request.async = !!this.__async;
        }
        if (this.__charset!=null){
            _request.charset = this.__charset;
        }
        return _request;
    };
    /**
     * 删除控件
     * 
     * @protected
     * @method module:util/ajax/loader/script._$$LoaderScript#__doClearRequest
     * @param  {Node} arg0 - 控件节点
     * @return {Void}
     */
    _pro.__doClearRequest = function(_request){
        _e._$remove(_request);
    };
    
    return _p;
},'15b86578d249c817b9a2d8bd847934f1','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f');
I$('9455dd0e0cc186d8b5850a608ecf7163',function (NEJ,_t0,_t1,_t2,_t3,_p,_o,_f,_r){
    /**
     * 载入完成回调函数
     *
     * @callback module:util/ajax/tag.onload
     * @param    {Variable} event - 请求返回数据
     */
    /**
     * 载入出错回调函数
     *
     * @callback module:util/ajax/tag.onerror
     * @param    {Object} event   - 错误信息
     * @property {Number} code    - 错误码
     * @property {String} message - 错误信息
     */
    /**
     * 载入脚本文件
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$loadScript('../../../javascript/log.js',{
     *         onload:function(){
     *             // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *             // 抛出异常回调
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$loadScript
     * @see      module:util/ajax/tag._$queueScript
     * @param    {String}  arg0    - 请求地址
     * @param    {Object}  arg1    - 可选配置参数
     * @property {Boolean} async   - 异步载入并立刻执行，默认为!0
     * @property {Number}  timeout - 超时时间,0表示禁止超时监测
     * @property {String}  version - 版本信息
     * @property {String}  charset - 脚本编码
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return   {Void}
     */
    _p._$loadScript = function(_url,_options){
        _t3._$$LoaderScript._$allocate(_options)._$load(_url);
    };
    /**
     * 载入队列脚本并依次执行
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$queueScript([
     *         '../../../javascript/log.js',
     *         'http://123.163.com/a.js'
     *     ],{
     *         onload:function(){
     *            // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *            // 异常回调方法
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$queueScript
     * @see      module:util/ajax/tag._$loadScript
     * @param    {Array}  arg0    - 脚本队列
     * @param    {Object} arg1    - 可选配置参数
     * @property {String} version - 版本信息
     * @property {String} charset - 脚本编码
     * @property {Number} timeout - 每个脚本超时时间,0表示禁止超时监测
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return   {Void}
     */
    _p._$queueScript = function(_list,_options){
        _t3._$$LoaderScript._$allocate(_options)._$queue(_list);
    };
    /**
     * 载入样式文件
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$loadStyle('http://123.163.com/a.css',{
     *         onload:function(){
     *             // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *             // 异常回调方法
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$loadStyle
     * @see      module:util/ajax/tag._$queueStyle
     * @param    {String} arg0    - 样式文件地址
     * @param    {Object} arg1    - 可选配置参数
     * @property {Number} timeout - 超时时间,0表示禁止超时监测
     * @property {String} version - 版本信息
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return   {Void}
     */
    _p._$loadStyle = function(_url,_options){
        _t2._$$LoaderStyle._$allocate(_options)._$load(_url);
    };
    /**
     * 载入样式队列
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$queueStyle([
     *         'http://123.163.com/a.css',
     *         'http://123.163.com/b.css'
     *     ],{
     *         onload:function(){
     *             // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *             // 异常回调方法
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$queueStyle
     * @see      module:util/ajax/tag._$loadStyle
     * @param    {Array}  arg0    - 样式队列
     * @param    {Object} arg1    - 可选配置参数
     * @property {Number} timeout - 超时时间,0表示禁止超时监测
     * @property {String} version - 版本信息
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return   {Void}
     */
    _p._$queueStyle = function(_list,_options){
        _t2._$$LoaderStyle._$allocate(_options)._$queue(_list);
    };
    /**
     * 载入HTML文件
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$loadHtml('http://123.163.com/a.html',{
     *         onload:function(){
     *             // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *             // 异常回调方法
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$loadHtml
     * @param    {String} arg0    - 文件地址
     * @param    {Object} arg1    - 可选配置参数
     * @property {String} version - 版本信息
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return   {Void}
     */
    _p._$loadHtml = function(_url,_options){
        _t1._$$LoaderHtml._$allocate(_options)._$load(_url);
    };
    /**
     * 载入HTML文件
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/tag'
     * ],function(_j){
     *     _j._$loadText('http://123.163.com/a.txt',{
     *         onload:function(){
     *             // 载入成功的回调方法
     *         },
     *         onerror:function(_error){
     *             // 异常回调方法
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/ajax/tag._$loadText
     * @param    {String} arg0    - 文件地址
     * @param    {Object} arg1    - 可选配置参数
     * @property {String} version - 版本信息
     * @property {module:util/ajax/tag.onload}  onload  - 载入回调
     * @property {module:util/ajax/tag.onerror} onerror - 异常回调
     * @return {Void}
     */
    _p._$loadText = function(_url,_options){
        _t0._$$LoaderText._$allocate(_options)._$load(_url);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.j'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5c3b016d2f71002467979c5acea5b867','9d65886d3caa4751e0e74eb54fbc2518','d043976616a472ae7c37adb7d68f766f','56694a4bb274aebea8cfe443dc7ac6ec');
I$('356c13c039fe43b0aa515c031d53f736',function (NEJ,_u,_v,_e,_b,_y,_t,_j0,_j1,_x,_p,_o,_f,_r){
    var _cache = {}, // template cache
        _skey  = 'ntp-'+(+new Date)+'-';
    // only for test
    _p.tpl = function(){
        return _cache;
    };
    /**
     * 解析模板集合
     *
     * 结构举例
     * ```html
     * <textarea name="jst" id="jst-box">
     *     <div>${name}</div>
     * </textarea>
     * <textarea name="txt" id="txt-box">
     *     <div>pure text</div>
     * </textarea>
     * <textarea name="ntp" id="ntp-box">
     *     <div>ntp</div>
     * </textarea>
     * <textarea name="js" id="js-box" data-src='/nej-baseline/src/define.js'></textarea>
     * <textarea name="css" id="css-box" data-src='/nej-baseline/qunit/base/qunit.css'></textarea>
     * <textarea name="html" id="html-box" data-src='/nej-baseline/qunit/html/ui/audioTest.html'></textarea>
     * <textarea name="res" id="res-box" data-src='http://pagead2.googlesyndication.com/simgad/15167196758298977737'></textarea>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl'
     * ],function(_p){
     *     // 调用_$add接口缓存模版，id为key
     *     // 要用的时候通过_$get(key,{数据})合并模版后返回字符串
     *     _p._$parseTemplate('jst-box');
     *     // 生成结果：<div>jack</div>
     *     _p._$getTextTemplate('jst-box').trim();
     *
     *     // 通过_$addTextTemplate接口缓存纯文本,id为key
     *     _p._$parseTemplate('txt-box');
     *     // 要用的时候通过_e._$getTextTemplate(key)取到纯文本
     *     _p._$getTextTemplate('txt-box')
     *
     *
     *     // 通过_$addNodeTemplate接口缓存节点，第一次如果是字符串，缓存字符串，id为key
     *     _p._$parseTemplate('ntp-box');
     *     // 要用的时候通过_$getNodeTemplate('ntp-box')取出节点，
     *     // 如果缓存中是字符串,取的时候要重新转换成节点，然后重新缓存一边，下次直接是取节点
     *     _p._$getNodeTemplate('ntp-box');
     *
     *     // 加载id为js-box的textarea节点data-src指定的js文件
     *     _p._$parseTemplate('js-box');
     *
     *     // 加载id为css-box的textarea节点data-src指定的css文件
     *     _p._$parseTemplate('css-box');
     *
     *     // 加载id为html-box的textarea节点data-src指定的html文件
     *     _p._$parseTemplate('html-box');
     *
     *     // 加载id为res-box的textarea节点data-src指定的纯文本文件
     *     _p._$parseTemplate('res-box');
     * });
     * ```
     *
     * @method   module:util/template/tpl._$parseTemplate
     * @param    {String|Node} arg0 - 模板集合节点
     * @param    {Object}      arg1 - 可选配置参数
     * @property {String}      root - 根路径，相对规则
     * @return   {Void}
     */
    /**
     * @method CHAINABLE._$parseTemplate
     * @see module:util/template/tpl._$parseTemplate
     */
    _p._$parseTemplate = (function(){
        var _count = 0;
        var _doCheckReady = function(){
            if (_count>0) return;
            _count = 0;
            _v._$dispatchEvent(document,'templateready');
            _v._$clearEvent(document,'templateready');
        };
        var _doParseSrc = function(_textarea,_options){
            var _src = _e._$dataset(_textarea,'src');
            if (!_src) return;
            _options = _options||_o;
            var _root = _options.root;
            if (!_root){
                _root = _textarea.ownerDocument.location.href;
            }else{
                _root = _u._$absolute(_root);
            }
            _src = _src.split(',');
            _u._$forEach(_src,function(_value,_index,_list){
                _list[_index] = _u._$absolute(_value,_root);
            });
            return _src;
        };
        var _doDumpContent = function(_node){
            // bugfix textarea content not corrent for safari in mac 
            if (_b._$is('mac')&&_b._$KERNEL.browser==='safari'){
                return _u._$unescape(_node.innerHTML);
            }else{
                return _node.value||_node.innerText||'';
            }
        };
        var _doAddStyle = function(_textarea,_options){
            if (!_textarea) return;
            var _src = _doParseSrc(_textarea,_options);
            if (!!_src){
                _j0._$queueStyle(_src,{
                    version:_e._$dataset(_textarea,'version')
                });
            }
            _e._$addStyle(_textarea.value);
        };
        var _onAddScript = function(_value){
            _count--;
            _e._$addScript(_value);
            _doCheckReady();
        };
        var _doAddScript = function(_textarea,_options){
            if (!_textarea) return;
            var _src = _doParseSrc(_textarea,_options),
                _val = _textarea.value;
            if (!!_src){
                _count++;
                var _options = {
                    version:_e._$dataset(_textarea,'version'),
                    onload:_onAddScript._$bind(null,_val)
                };
                window.setTimeout(
                    _j0._$queueScript._$bind(
                        _j0,_src,_options
                    ),0
                );
                return;
            }
            _e._$addScript(_val);
        };
        var _onAddHtml = function(_body){
            _count--;
            _p._$parseTemplate(_body);
            _doCheckReady();
        };
        var _doAddHtml = function(_textarea,_options){
            if (!_textarea) return;
            var _src = _doParseSrc(_textarea,_options)[0];
            if (!!_src){
                _count++;
                var _options = {
                    version:_e._$dataset(_textarea,'version'),
                    onload:_onAddHtml
                };
                window.setTimeout(
                    _j0._$loadHtml._$bind(
                        _j0,_src,_options
                    ),0
                );
            }
        };
        var _onAddTextResource = function(_id,_text){
            _count--;
            _p._$addTextTemplate(_id,_text||'');
            _doCheckReady();
        };
        var _doAddTextResource = function(_textarea,_options){
            if (!_textarea||!_textarea.id) return;
            var _id = _textarea.id,
                _src = _doParseSrc(_textarea,_options)[0];
            if (!!_src){
                _count++;
                var _url = _src+(_src.indexOf('?')<0?'?':'&')+
                          (_e._$dataset(_textarea,'version')||''),
                    _options = {
                        type:'text',
                        method:'GET',
                        onload:_onAddTextResource._$bind(null,_id)
                    };
                window.setTimeout(
                    _j1._$request._$bind(
                        _j1,_url,_options
                    ),0
                );
            }
        };
        var _doAddTemplate = function(_node,_options){
            var _type = _node.name.toLowerCase();
            //console.debug(_type+'<'+_node.id+'> : '+_node.value.replace(/\n/g,' '));
            switch(_type){
                case 'jst':
                    _y._$addTemplate(_doDumpContent(_node),_node.id);
                return;
                case 'txt':
                    _p._$addTextTemplate(_node.id,_doDumpContent(_node));
                return;
                case 'ntp':
                    _p._$addNodeTemplate(_doDumpContent(_node),_node.id);
                return;
                case 'js':
                    _doAddScript(_node,_options);
                return;
                case 'css':
                    _doAddStyle(_node,_options);
                return;
                case 'html':
                    _doAddHtml(_node,_options);
                return;
                case 'res':
                    _doAddTextResource(_node,_options);
                return;
            }
        };
        /**
         * 模版准备完毕触发事件，包括所有外联模版载入完成
         *
         * 结构举例
         * ```html
         * <div id="template-box">
         *   <textarea name="jst">
         *     jst tempalte here
         *   </textarea>
         *   <!-- text template with id="txt-id-1" in widget.html -->
         *   <textarea name="html" data-src="./widget.html"></textarea>
         * </div>
         * ```
         *
         * 脚本举例
         * ```javascript
         * NEJ.define([
         *     'base/event'
         *     'util/template/tpl'
         * ],function(_v,_e){
         *     // 解析模版集合
         *     _e._$parseTemplate('template-box');
         *
         *     // 在templateready事件中使用外联模版可以保证正确性
         *     _v._$addEvent(
         *         document,'templateready',
         *         function(_event){
         *             var _text = _e._$getTextTemplate('txt-id-1');
         *             // TODO
         *         }
         *     );
         * });
         * ```
         *
         * @event    external:document.ontemplateready
         * @param    {Object} event - 事件信息
         */
        _t._$$CustomEvent._$allocate({
            element:document,
            event:'templateready',
            oneventadd:_doCheckReady
        });
        return function(_element,_options){
            _element = _e._$get(_element);
            if (!!_element){
                var _list = _element.tagName=='TEXTAREA' ? [_element]
                          : _u._$object2array(
                                _element.getElementsByTagName('textarea')
                            );
                _u._$forEach(_list,function(_node){
                    _doAddTemplate(_node,_options);
                });
                _e._$remove(_element,!0);
            }
            _doCheckReady();
        };
    })();
    /**
     * 添加文本模板
     *
     * 脚本举例
     * ```javascript
     * // 通过_e._$addTextTemplate接口缓存纯文本,id为key
     * _e._$addTextTemplate('txt-box','i am content');
     * // 要用的时候通过_e._$getTextTemplate(key)取到纯文本
     * _e._$getTextTemplate('txt-box')
     * ```
     *
     * @method module:util/template/tpl._$addTextTemplate
     * @see    module:util/template/tpl._$getTextTemplate
     * @param  {String} arg0 - 模板键值
     * @param  {String} arg1 - 模板内容
     * @return {Void}
     */
    _p._$addTextTemplate = function(_key,_value){
        if (_cache[_key]!=null&&((typeof _cache[_key])===(typeof _value))){
            console.warn('text template overwrited with key '+_key);
            console.debug('old template content: '+_cache[_key].replace(/\n/g,' '));
            console.debug('new template content: '+_value.replace(/\n/g,' '));
        }
        _cache[_key] = _value||'';
    };
    /**
     * 取文本模板
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl'
     * ],function(_p){
     *     // 通过_$addTextTemplate接口缓存纯文本,id为key
     *     _p._$addTextTemplate('txt-box','i am content');
     *     // 要用的时候通过_$getTextTemplate(key)取到纯文本
     *     _p._$getTextTemplate('txt-box')
     * });
     * ```
     *
     * @method module:util/template/tpl._$getTextTemplate
     * @see    module:util/template/tpl._$addTextTemplate
     * @param  {String} arg0 - 模板键值
     * @return {String}        模板内容
     */
    _p._$getTextTemplate = function(_key){
        return _cache[_key]||'';
    };
    /**
     * 添加节点模板
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl'
     * ],function(_p){
     *     // 通过_$addNodeTemplate接口缓存节点，第一次如果是字符串，缓存字符串，id为key
     *     _p._$addNodeTemplate(node,'ntp-box');
     *     // 要用的时候通过_$getNodeTemplate('ntp-box')取出节点，
     *     // 如果缓存中是字符串,取的时候要重新转换成节点，然后重新缓存一边，下次直接是取节点
     *     _p._$getNodeTemplate('ntp-box');
     * });
     * ```
     *
     * @method module:util/template/tpl._$addNodeTemplate
     * @see    module:util/template/tpl._$getNodeTemplate
     * @param  {String|Node} arg0 - 模板
     * @param  {String}      arg1 - 模板序列号
     * @return {String}             模板序列号
     */
    /**
     * @method CHAINABLE._$addNodeTemplate
     * @see module:util/template/tpl._$addNodeTemplate
     */
    _p._$addNodeTemplate = function(_element,_key){
        _key = _key||_u._$uniqueID();
        _element = _e._$get(_element)||_element;
        _p._$addTextTemplate(_skey+_key,_element);
        if (!_u._$isString(_element)){
            _e._$removeByEC(_element);
        }
        return _key;
    };
    /**
     * 取节点模板
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl'
     * ],function(_p){
     *     // 通过_$addNodeTemplate接口缓存节点，第一次如果是字符串，缓存字符串，id为key
     *     _p._$addNodeTemplate('txt-box');
     *     // 要用的时候通过_$getNodeTemplate('ntp-box')取出节点，
     *     // 如果缓存中是字符串,取的时候要重新转换成节点，然后重新缓存一边，下次直接是取节点
     *     _p._$getNodeTemplate('ntp-box');
     * });
     * ```
     *
     * @method module:util/template/tpl._$getNodeTemplate
     * @see    module:util/template/tpl._$addNodeTemplate
     * @param  {String} arg0 - 模板序列号
     * @return {Node}          节点模板
     */
    _p._$getNodeTemplate = function(_key){
        if (!_key) return null;
        _key = _skey+_key;
        var _value = _p._$getTextTemplate(_key);
        if (!_value) return null;
        var _node;
        if (_u._$isString(_value)){
            _value = _e._$html2node(_value);
            // bugfix: https://connect.microsoft.com/IE/feedback/details/811408
            var _list = _value.getElementsByTagName('textarea');
            if (_value.tagName!='TEXTAREA'&&
               (!_list||!_list.length)){
                _p._$addTextTemplate(_key,_value);
            }else{
                _node = _value;
            }
        }
        // clone node and push to memory
        if (!_node){
            _node = _value.cloneNode(!0);
        }
        _e._$removeByEC(_node);
        return _node;
    };
    /**
     * 取ITEM模板列表
     *
     * 结构举例
     * ```html
     * <div id="item-box"></div>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'ui/item/item',
     *     'util/template/tpl'
     * ],function(_k,_i,_t,_p){
     *     var _pro;
     *     var _html_key = _t._$addNodeTemplate('<div>123</div>');
     *
     *     _p._$$MyItem = _k._$klass();
     *     _pro = _p._$$MyItem._$extend(_i._$$Item);
     *
     *     _pro.__reset = function(_options){
     *         this.__data = _options.data;
     *         this.__super(_options);
     *     }
     *
     *     _pro.__doRefresh = function(){
     *         this.__body.innerText = this.__data.name;
     *     };
     *
     *     _pro.__initXGui = function(){
     *         this.__seed_html = _html_key;
     *     };
     *
     *     return _p;
     * });
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     '/path/to/my/item.js',
     *     'util/template/tpl'
     * ],function(_t,_p){
     *     // _$getItemTemplate接口生成item列表
     *     // 返回一个item的列表，可以循环调用_$recycle()，来销毁
     *     var _items = _p._$getItemTemplate(
     *         [{name:'jack'},{name:'sean'}],
     *         _t._$$MyItem,{parent:'item-box'}
     *     );
     * });
     * ```
     *
     * @method   module:util/template/tpl._$getItemTemplate
     * @param    {Array}   arg0   - 数据列表
     * @param    {module:ui/item/item._$$Item} arg1   - 列表项构造函数
     * @param    {Object}  arg2   - 可选配置参数，其他参数参见item指定的构造函数的配置参数
     * @property {Number}  offset - 起始指针【包含】，默认0
     * @property {Number}  limit  - 分配数据长度或者数量，默认为列表长度
     * @return   {Array}            ITEM模板列表
     */
    _p._$getItemTemplate = (function(){
        var _doFilter = function(_value,_key){
            return _key=='offset'||_key=='limit';
        };
        return function(_list,_item,_options){
            var _arr = [];
            if (!_list||!_list.length||!_item){
                return _arr;
            }
            _options = _options||_o;
            var _len = _list.length,
                _beg = parseInt(_options.offset)||0,
                _end = Math.min(_len,_beg+(
                       parseInt(_options.limit)||_len)),
                _opt = {total:_list.length,range:[_beg,_end]};
            _u._$merge(_opt,_options,_doFilter);
            for(var i=_beg,_instance;i<_end;i++){
                _opt.index = i;
                _opt.data = _list[i];
                _instance = _item._$allocate(_opt);
                var _id = _instance._$getId();
                _cache[_id] = _instance;
                _instance._$recycle =
                _instance._$recycle._$aop(
                    function(_id,_instance){
                        delete _cache[_id];
                        delete _instance._$recycle;
                    }._$bind(null,_id,_instance));
                _arr.push(_instance);
            }
            return _arr;
        };
    })();
    /**
     * 根据ID取列表项对象
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl'
     * ],function(_p){
     *     // 通过id拿某一项item
     *     // id是生成item的时候，'itm'+日期字符串生成,存在于_instance.__id变量中
     *     var _item = _p._$getItemById('itm-123');
     * });
     * ```
     *
     * @method module:util/template/tpl._$getItemById
     * @param  {String} arg0 - 列表项
     * @return {module:ui/item/item._$$Item} 列表项实例
     */
    _p._$getItemById = function(_id){
        return _cache[_id];
    };
    /**
     * 解析UI模板集合
     *
     * @method module:util/template/tpl._$parseUITemplate
     * @param  {String} html - 待解析字符串
     * @param  {Object} map  - 模版id的对应map
     * @return {Object} 模版id的map
     */
    _p._$parseUITemplate = (function(){
        var _reg = /#<(.+?)>/g;
        return function(_html,_map){ // {abc:'eeee'} // #<abc>
            _map = _map||{};
            _html = (_html||'').replace(_reg,function($1,$2){
                var _id = _map[$2];
                if (!_id){
                    _id = 'tpl-'+_u._$uniqueID();
                    _map[$2] = _id;
                }
                return _id;
            });
            //console.debug('template source code -> '+_html.replace(/\n/g,' '));
            /*
            _u._$forIn(
                _element.getElementsByTagName('textarea'),
                function(_textarea){
                    _textarea.id = (_textarea.id||'').replace(
                        _reg,function($1,$2){
                            var _id = _map[$2];
                            if (!_id){
                                _id = 'tpl-'+_u._$uniqueID();
                                _map[$2] = _id;
                            }
                            return _id;
                        }
                    );
                }
            );
            */
            _p._$parseTemplate(
                _e._$html2node(_html)
            );
            return _map;
        };
    })();
    // for chainable method
    _x._$merge({
        _$parseTemplate:_p._$parseTemplate,
        _$addNodeTemplate:_p._$addNodeTemplate
    });

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','345f1460138e362bb33cc48ffc7cd12b','1b12378d868a5877d4dba65367942b75','8717e18cf0d38e654531116f64f5593d','9455dd0e0cc186d8b5850a608ecf7163','19b4ef9670142281a6ff17ec75864bee','cefc834b106876d285d05b428248ca57');
I$('fce9a8422bde33344b47943d1b929a20',function (_p){
	/**
     * 将Hash推入历史
     * @param  {String} HASH值
     * @return {Void}
     */
    _p.__pushHistory = function(_hash){
        // do nothing
    };
    
    return _p;
});
I$('3323700551a6be3587e1534f46d367f2',function(b1490930303992,_h,_e,_p,_o,_f,_r){if (b1490930303992._$KERNEL.engine==='trident'&&b1490930303992._$KERNEL.release<='4.0'){I$(22,function (){
	    window.hst_lock = {};
		/**
	     * 将Hash推入历史
	     * @param  {String} HASH值
	     * @return {Void}
	     */
	    _h.__pushHistory = (function(){
	        var _timer,
	            _iframe,
	            _queue = [],
	            _hflag = 'cb-'+(+new Date),
	            _content = '<script>parent.hst_lock["'+_hflag+'"] = !0;parent.location.hash = decodeURIComponent("#<HASH>");</scr'+'ipt>';
	        var _doCheckQueue = function(){
	            _timer = window.clearTimeout(_timer);
	            if (!_queue.length) return;
	            var _hash = _queue.shift();
	            try{
	                var _document = _iframe.contentWindow.document;
	                _document.open();
	                _document.write('<head><title>');
	                _document.write(document.title);
	                _document.write('</title>');
	                _document.write(
	                    _content.replace(
	                        '#<HASH>',
	                        encodeURIComponent(_hash)
	                    )
	                );
	                _document.write('</head><body></body>');
	                if (location.hostname!=document.domain){
	                    _document.domain = document.domain;
	                }
	                _document.close();
	                hst_lock[_hflag] = !1;
	            }catch(ex){
	                console.log(ex.message||ex);
	                _queue.unshift(_hash);
	            }
	            _timer = window.setTimeout(_doCheckQueue,50);
	        };
	        return function(_hash){
               if (!!_h[_hflag]||(!_iframe&&!_hash)){
                   return;
               }
               _queue.push(_hash);
               if (!_iframe){
                   _iframe = _e._$createXFrame();
               }
               _doCheckQueue();
            };
	    })();
	});}return _h;},'345f1460138e362bb33cc48ffc7cd12b','fce9a8422bde33344b47943d1b929a20','555a9eecaf26c5c01fe9db8d965bc30f');
I$('7916fe9b42ff545d7310ae1278626196',function (_u,_v,_m,_t0,_t1,_h,_p,_o,_f,_r){
    var _reg1 = /^[#?]+/,
        _reg2 = /#(.*?)$/,
        _ctxt = this;
    /*
     * 判断是否需要做Hack处理
     * @return {Boolean} 是否需要做Hack处理
     */
    var _isHack = function(){
        return !history.pushState||_m._$IS.android||!history.auto;
    };
    /*
     * 设置地址
     * @param  {String}  页面地址
     * @param  {Boolean} 是否不保存历史
     * @return {Void}
     */
    var _setLocation = function(_url,_replaced){
        var _name = !_replaced?'pushState':'replaceState';
        _ctxt.history[_name](null,document.title,_url);
    };
    /*
     * 取位置信息
     * @return {Object} 位置信息
     */
    var _getLocation = function(){
        return location.parse(_ctxt.location.href);
    };
    // extend api
    _setLocation = 
    _setLocation._$aop(function(_event){
        if (!_isHack()) return;
        _event.stopped = !0;
        var _args = _event.args;
        // not encodeURIComponent
        _url = _args[0].replace(_reg1,'');
        !_args[1] ? _ctxt.location.hash = _url
                  : _ctxt.location.replace('#'+_url);
    });
    _getLocation = 
    _getLocation._$aop(function(_event){
        if (!_isHack()) return;
        _event.stopped = !0;
        // fix ie6 location.hash error for #/m/a?a=aaa
        var _hash = _reg2.test(_ctxt.location.href)?RegExp.$1:'';
        // not decodeURIComponent
        _event.value = location.parse(_hash.replace(_reg1,''));
    });
    /**
     * 重定向路径
     * 
     * @method external:location.redirect
     * @param  {String}  arg0 - 路径
     * @param  {Boolean} arg1 - 是否替换原来的历史
     * @return {Void}
     */
    location.redirect = function(_url,_replaced){
        _setLocation(_url,_replaced);
    };
    /**
     * 启动地址检测
     * 
     * @method external:location.active
     * @return {Void}
     */
    location.active = (function(){
        var _timer,_url,_location,_locked,_done;
        // parse location change
        var _onLocationChange = function(_href){
            // locked from history back
            if (!!_locked){
                _locked = !1;
                return;
            }
            var _event = {
                oldValue:_location,
                newValue:_getLocation()
            };
            // check ignore beforeurlchange event fire
            if (!!location.ignored){
                location.ignored = !1;
            }else{
                _v._$dispatchEvent(
                    location,'beforeurlchange',_event
                );
                if (_event.stopped){
                    if (!!_location){
                        _locked = !0;
                        _setLocation(_location.href,!0);
                    }
                    return;
                };
            }
            // fire urlchange
            _url = _ctxt.location.href;
            _location = _event.newValue;
            _v._$dispatchEvent(
                location,'urlchange',_location
            );
            _h.__pushHistory(_location.href);
        };
        // check location
        var _doCheckLocation = function(){
            if (_url!=_ctxt.location.href) _onLocationChange();
            _timer = _t1.requestAnimationFrame(_doCheckLocation);
        };
        // check use hashchange event on window
        var _useHashChange = function(){
            var _knl = _m._$KERNEL;
                 _ie7 = _knl.engine=='trident'&&_knl.release<='3.0';
            return _isHack()&&('onhashchange' in window)&&!_ie7;
        };
        return function(_context){
            // lock active
            if (!!_done){
                return;
            }
            _done = !0;
            // do init
            _ctxt = _context||window;
            // ignore onhashchange on ie7
            if (_useHashChange()){
                _v._$addEvent(
                    _ctxt,'hashchange',
                    _onLocationChange
                );
                _onLocationChange();
            }else if(!_timer){
                _timer = _t1.requestAnimationFrame(_doCheckLocation);
                _doCheckLocation();
            }
        };
    })();
    /**
     * åœ°å€ä¿¡æ¯å¯¹è±¡
     * 
     * @typedef  {Object} external:location~LocationModel
     * @property {String} path  - è·¯å¾„ä¿¡æ¯ï¼Œä¸å¸¦æŸ¥è¯¢å‚æ•°
     * @property {String} href  - å®Œæ•´è·¯å¾„ï¼Œå¸¦æŸ¥è¯¢å‚æ•°
     * @property {Object} query - æŸ¥è¯¢å‚æ•°è§£æžå‡ºæ¥çš„å¯¹è±¡
     */
    /**
     * è§£æžåœ°å€ä¿¡æ¯
     * 
     * @method external:location.parse
     * @param  {String} arg0 - åœ°å€
     * @return {external:location~LocationModel} åœ°å€ä¿¡æ¯
     */
    location.parse = (function(){
        var _reg0 = /^https?:\/\/.*?\//i,
            _reg1 = /[?#]/;
        return function(_url){
            // http://a.b.com/a/b/c?a=aa&b=bb#c=cc
            var _result = {href:_url};
            // /a/b/c?a=aa&b=bb#c=cc
            // 0 - /a/b/c
            // 1 - a=aa&b=bb
            // 2 - c=cc
            _url = (_url||'').replace(_reg0,'/').split(_reg1);
            // for /?/a/b?a=aa&b=bb
            var _count = 1;
            if (_url[0]=='/'&&
               (_url[1]||'').indexOf('/')==0)
                _count = 2;
            // /a/b/c or /?/a/b
            _result.path = _url.splice(0,_count).join('?');
            _result.query = _u._$query2object(_url.join('&'));
            return _result;
        };
    })();
    /**
     * åˆ¤æ–­è·¯å¾„å’Œå½“å‰åœ°å€æ è·¯å¾„æ˜¯å¦ä¸€è‡´
     * 
     * @method external:location.same
     * @param  {String}  arg0 - è·¯å¾„
     * @return {Boolean}        æ˜¯å¦ä¸€è‡´
     */
    location.same = function(_url){
        return _getLocation().href==_url;
    };
    /**
     * åœ°å€å˜åŒ–ä¹‹å‰è§¦å‘äº‹ä»¶
     *
     * @event    external:location.onbeforeurlchange
     * @param    {Object}  event   - åœ°å€ä¿¡æ¯
     * @property {external:location~LocationModel} oldValue - æ—§åœ°å€ä¿¡æ¯
     * @property {external:location~LocationModel} newValue - æ–°åœ°å€ä¿¡æ¯
     * @property {Boolean} stopped - æ˜¯å¦é˜»æ­¢åœ°å€è·³è½¬
     */
    /**
     * åœ°å€å˜åŒ–è§¦å‘äº‹ä»¶
     *
     * @event    external:location.onurlchange
     * @param    {external:location~LocationModel} event - åœ°å€ä¿¡æ¯
     */
    _t0._$$CustomEvent._$allocate({
        element:location,
        event:['beforeurlchange','urlchange']
    });
    
    return _p;
},'3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','345f1460138e362bb33cc48ffc7cd12b','8717e18cf0d38e654531116f64f5593d','22f96934c3da23aa5543572084e13500','3323700551a6be3587e1534f46d367f2');
I$('9ed4c2425e9a06a20d554eecbf926d86',function (NEJ,_k,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * æ ‘èŠ‚ç‚¹å¯¹è±¡
     * 
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/dsp/node'
     * ],function(_p){
     *     //      ___
     *     //     |_/_|       <-- èŠ‚ç‚¹åç§°ä¸º"/"çš„èŠ‚ç‚¹
     *     //     /   \
     *     //   _/_   _\_ 
     *     //  |_a_| |_b_|    <-- èŠ‚ç‚¹åç§°ä¸º"b"çš„èŠ‚ç‚¹
     * 
     *     // åˆ†é…ä¸€ä¸ªåç§°ä¸ºâ€œ/â€çš„èŠ‚ç‚¹
     *     var _root = _p._$$Node._$allocate();
     * 
     *     // åˆ†é…ä¸€ä¸ªåç§°ä¸ºâ€œaâ€çš„èŠ‚ç‚¹ï¼Œå¹¶æŒ‡å®šçˆ¶èŠ‚ç‚¹ä¸º_root
     *     var _node = _p._$$Node._$allocate({
     *         parent:_root,
     *         name:'a'
     *     });
     * 
     *     // åˆ†é…ä¸€ä¸ªåç§°ä¸ºâ€œbâ€çš„èŠ‚ç‚¹ï¼Œæ‰‹åŠ¨è®¾ç½®çˆ¶èŠ‚ç‚¹
     *     var _node = _$$Node._$allocate({
     *         name:'b'
     *     });
     *     _node._$setParent(_root);
     * 
     *     // å›žæ”¶æ ‘ï¼ŒåŒæ—¶å›žæ”¶èŠ‚ç‚¹çš„æ‰€æœ‰å­å­™èŠ‚ç‚¹
     *     _root = _root._$recycle();
     * });
     * ```
     * 
     * @class    module:util/dispatcher/dsp/node._$$Node
     * @extends  module:util/event._$$EventTarget
     * 
     * @param    {Object}  config - å¯é€‰é…ç½®å‚æ•°
     * @property {_$$Node} parent - çˆ¶èŠ‚ç‚¹
     * @property {String}  name   - èŠ‚ç‚¹åç§°ï¼Œé»˜è®¤ä¸º"/"
     * @property {Object}  data   - èŠ‚ç‚¹ç¼“å­˜çš„æ•°æ®ä¿¡æ¯
     */
    _p._$$Node = _k._$klass();
    _pro = _p._$$Node._$extend(_t._$$EventTarget);
    /**
     * æŽ§ä»¶åˆå§‹åŒ–
     * 
     * @protected
     * @method module:util/dispatcher/dsp/node._$$Node#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        this.__children = [];
    };
    /**
     * æŽ§ä»¶é‡ç½®
     * 
     * @protected
     * @method module:util/dispatcher/dsp/node._$$Node#__reset
     * @param  {Object} arg0 - å¯é€‰é…ç½®å‚æ•°
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this._$setParent(_options.parent);
        this.__name = _options.name||'/';
        this.__data = _options.data||{};
    };
    /**
     * æŽ§ä»¶é”€æ¯
     * 
     * @protected
     * @method module:util/dispatcher/dsp/node._$$Node#__destroy
     * @return {Void}
     */
    _pro.__destroy = (function(){
        var _doRecycle = function(_node,_index,_list){
            _list.splice(_index,1);
            _node._$recycle();
        };
        return function(){
            this.__super();
            delete this.__data;
            _u._$reverseEach(
                this.__children,
                _doRecycle
            );
            this._$setParent(null);
        };
    })();
    /**
     * æ˜¯å¦èŠ‚ç‚¹å®žä¾‹
     * 
     * @protected
     * @method module:util/dispatcher/dsp/node._$$Node#__isNode
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - èŠ‚ç‚¹
     * @return {Boolean} æ˜¯å¦èŠ‚ç‚¹å®žä¾‹
     */
    _pro.__isNode = function(_node){
        return _node instanceof this.constructor;
    };
    /**
     * æ˜¯å¦æœ‰å­èŠ‚ç‚¹
     * 
     * @protected
     * @method module:util/dispatcher/dsp/node._$$Node#__hasChild
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - å­èŠ‚ç‚¹
     * @return {Boolean} æ˜¯å¦æœ‰å­èŠ‚ç‚¹
     */
    _pro.__hasChild = function(_child){
        return _u._$indexOf(this.__children,_child)>=0;
    };
    /**
     * å–èŠ‚ç‚¹åç§°
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getName
     * @return {String} èŠ‚ç‚¹åç§°
     */
    _pro._$getName = function(){
        return this.__name;
    };
    /**
     * å–èŠ‚ç‚¹ä¿å­˜çš„ä¿¡æ¯
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getData
     * @return {Object} æ•°æ®ä¿¡æ¯
     */
    _pro._$getData = function(){
        return this.__data;
    };
    /**
     * å–å½“å‰èŠ‚ç‚¹è·¯å¾„
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getPath
     * @return {String} è·¯å¾„
     */
    _pro._$getPath = function(){
        var _parent = this._$getParent(),
            _name = this._$getName();
        if (!_parent) return _name;
        var _pname = _parent._$getName();
        if (_pname!='/'&&_name!='/')
            _name = '/'+_name;
        return _parent._$getPath()+_name;
    };
    /**
     * å–çˆ¶èŠ‚ç‚¹
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getParent
     * @return {_$$Node} çˆ¶èŠ‚ç‚¹
     */
    _pro._$getParent = function(){
        return this.__parent;
    };
    /**
     * å–å­èŠ‚ç‚¹åˆ—è¡¨
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getChildren
     * @return {Array} å­èŠ‚ç‚¹åˆ—è¡¨
     */
    _pro._$getChildren = function(){
        return this.__children;
    };
    /**
     * å–æŒ‡å®šåç§°çš„å­èŠ‚ç‚¹
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$getChildByName
     * @param  {String} arg0 - åç§°
     * @return {module:util/dispatcher/dsp/node._$$Node} 子节点
     */
    _pro._$getChildByName = function(_name){
        var _index = _u._$indexOf(
            this.__children,function(_node){
                return _name==_node._$getName();
            }
        );
        return this.__children[_index]||null;
    };
    /**
     * 设置父节点
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$setParent
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 父节点
     * @return {Void}
     */
    _pro._$setParent = function(_parent){
        _parent = this.__isNode(_parent)?_parent:null;
        if (_parent==this.__parent) return;
        !!_parent ? _parent._$appendChild(this)
                  : this.__parent._$removeChild(this);
        this.__parent = _parent;
    };
    /**
     * 添加子节点
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$appendChild
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 子节点
     * @return {Void}
     */
    _pro._$appendChild = function(_child){
        _child = this.__isNode(_child)?_child:null;
        if (!_child||this.__hasChild(_child)) return;
        this.__children.push(_child);
        _child._$setParent(this);
    };
    /**
     * 删除子节点
     * 
     * @method module:util/dispatcher/dsp/node._$$Node#_$removeChild
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 子节点
     * @return {module:util/dispatcher/dsp/node._$$Node} 删除的节点
     */
    _pro._$removeChild = function(_child){
        _child = this.__isNode(_child)?_child:null;
        var _index = _u._$indexOf(this.__children,_child);
        if (_index>=0){
            this.__children.splice(_index,1);
            _child._$setParent(null);
        }
        return _child;
    };
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0');
I$('396da9c39fc68b02a5861ec10a09eb54',function (_u,_t0,_t1,_p,_o,_f,_r){
    /*
     * 解析UMI对应的节点
     * @param  {_$$Node}  根节点
     * @param  {String}   UMI值
     * @param  {Function} 解析过程处理函数
     * @return {_$$Node}  对应节点
     */
    var _doParseUMI = function(_root,_umi,_hanlder){
        var _node = _root,
            _hanlder = _hanlder||_f;
        if (_umi!='/'){
            _u._$forEach(
                _umi.split('/'),function(_name){
                    var _result = _hanlder(_node,_name);
                    if (!_result) 
                        return !0;
                    _node = _result;
                }
            );
        }
        return _node;
    };
    /**
     * 根据UMI取对应的节点
     * 
     * @method module:util/dispatcher/dsp/util._$getNodeByUMI
     * @param  {module:util/dispatcher/dsp/node._$Node} arg0 - 根节点
     * @param  {String} arg1 - UMI值
     * @return {module:util/dispatcher/dsp/node._$Node} UMI对应的节点
     */
    _p._$getNodeByUMI = (function(){
        var _doSearch = function(_parent,_name){
            var _name = _name||'/',
                _pname = _parent._$getName();
            if (_pname=='/'&&_name=='/')
                return _parent;
            return _parent._$getChildByName(_name);
        };
        return function(_root,_umi){
            return _doParseUMI(_root,_umi,_doSearch);
        };
    })();
    /**
     * 根据UMI追加对应的节点
     * 
     * @method module:util/dispatcher/dsp/util._$appendNodeByUMI
     * @param  {module:util/dispatcher/dsp/node._$Node} arg0 - 根节点
     * @param  {String} arg1 - UMI值
     * @return {module:util/dispatcher/dsp/node._$Node} UMI对应的节点
     */
    _p._$appendNodeByUMI = (function(){
        // build tree
        var _doBuild = function(_parent,_name){
            var _pname = _parent._$getName();
            // root not add slash child
            if (!_name&&_pname=='/'){
                return _parent;
            }
            var _node = null;
            // check slash child first
            if (_pname!='/'){
                _node = _parent._$getChildByName('/');
                if (!_node){
                    _node = _t0._$$Node._$allocate();
                    _parent._$appendChild(_node);
                }
            }
            // check non-slash child
            if (!!_name){
                _node = _parent._$getChildByName(_name);
                if (!_node){
                    _node = _t0._$$Node._$allocate({name:_name});
                    _parent._$appendChild(_node);
                }
            }
            return _node;
        };
        return function(_root,_umi){
            return _doParseUMI(_root,_umi,_doBuild);
        };
    })();
    /**
     * 取两个节点的公共
     * 
     * @method module:util/dispatcher/dsp/util._$getCommonRoot
     * @param  {module:util/dispatcher/dsp/node._$Node} arg0 - 匹配节点
     * @param  {module:util/dispatcher/dsp/node._$Node} arg1 - 匹配节点
     * @return {module:util/dispatcher/dsp/node._$Node}        公共节点
     */
    _p._$getCommonRoot = function(_root,_source,_target){
        if (!_source||!_target) return _root;
        var _source = _source._$getPath().split('/'),
            _target = _target._$getPath().split('/'),
            _difidx = _u._$forIn(
                _source,function(_value,_index){
                    if (_value!=_target[_index]){
                        return !0;
                    }
                }
            )||1,
            _umi = _source.splice(0,_difidx).join('/')||'/';
        return _p._$getNodeByUMI(_root,_umi);
    };
    /**
     * 广度优先搜索
     * 
     * @method module:util/dispatcher/dsp/util._$breadthFirstSearch
     * @param  {module:util/dispatcher/dsp/node._$Node} arg0 - 起始节点
     * @param  {Function} arg1 - 搜索过程处理函数
     * @return {Void}
     */
    _p._$breadthFirstSearch = function(_root,_handler){
        var _arr = [_root],
            _node = _arr.shift(),
            _handler = _handler||_f;
        while(!!_node){
            _arr.push.apply(
                _arr,_node._$getChildren()
            );
            _handler(_node);
            _node = _arr.shift();
        }
    };
    /**
     * 判断是否节点实例
     * 
     * @method module:util/dispatcher/dsp/util._$isNode
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点
     * @return {Boolean} 是否节点实例
     */
    _p._$isNode = function(_node){
        return _node instanceof _t0._$$Node;
    };
    /**
     * 判断是否模块实例
     * 
     * @method module:util/dispatcher/dsp/util._$isModule
     * @param  {module:util/dispatcher/module._$$ModuleAbstract} arg0 - 模块实例
     * @return {Boolean}          是否模块实例
     */
    _p._$isModule = function(_module){
        return _module instanceof _t1._$$ModuleAbstract;
    };
    /**
     * 判断给定UMI是否代表私有模块
     * 
     * @method module:util/dispatcher/dsp/util._$isUMIPrivate
     * @param  {String}  arg0 - UMI值
     * @return {Boolean}        是否私有模块
     */
    _p._$isUMIPrivate = (function(){
        var _reg = /^\/?\?(?=\/|$)/;
        return function(_umi){
            return _reg.test(_umi||'');
        };
    })();
    /**
     * 路径转UMI
     * 
     * 转换逻辑
     * 
     * 1. 路径按照"?"或者"#"分割
     * 2. 识别私有模块，条件：第一个元素为"/"同时第二个元素以"?"开始
     * 3. 非私有模块返回第一个元素，私有模块返回用"?"合并的第一和第二个元素
     * 
     * 转换举例
     * ```
     * /a/b              ->   /a/b
     * /a/b?a=aa         ->   /a/b
     * /a/b#a=aa         ->   /a/b
     * /a/b?a=aa#b=bb    ->   /a/b
     * /a/b#a=aa?b=bb    ->   /a/b
     * /a/b?/a/b         ->   /a/b
     * /a/b#/a/b         ->   /a/b
     * /?/a/b            ->   /?/a/b
     * /?/a/b?a=aa       ->   /?/a/b
     * /?/a/b#a=aa       ->   /?/a/b
     * /?/a/b?a=aa#b=bb  ->   /?/a/b
     * /?/a/b#a=aa?b=bb  ->   /?/a/b
     * /?a=aa            ->   /
     * /#a=aa            ->   /
     * ```
     * 
     * @method module:util/dispatcher/dsp/util._$path2umi
     * 
     * @param  {String} arg0 - 路径，可带查询参数
     * @return {String}        模块UMI
     */
    _p._$path2umi = (function(){
        var _reg = /[\?#]/;
        return function(_url){
            var _arr = (_url||'').trim().split(_reg),
                _prv = _arr[0]=='/'&&(_arr[1]||'').indexOf('/')==0;
            return _arr[0]+(_prv?('?'+_arr[1]):'');
        };
    })();
    
    return _p;    
},'3ff9c25bd81a3c2a260c28122918263a','9ed4c2425e9a06a20d554eecbf926d86','ae709ce8ba298e2050e36c803ec1095e');
I$('ea4ade116c63b2ca8b34325f3293ca52',function (_u,_k,_g,_e,_j,_t0,_t1,_t2,_p,_o,_f,_r){
    var _pro;
    /**
     * 模块分组管理器
     * 
     * @class   module:util/dispatcher/dsp/group._$$GroupManager
     * @extends module:util/event._$$EventTarget
     * 
     * @param    {Object} config - 可选配置参数
     * @property {module:util/dispatcher/dsp/node._$$Node} root - 树根节点
     * @property {module:util/dispatcher/dispatcher._$$Dispatcher} dispatcher - 调度器
     */
    _p._$$GroupManager = _k._$klass();
    _pro = _p._$$GroupManager._$extend(_t0._$$EventTarget);
    /**
     * 控件重置
     * 
     * @protected
     * @method   module:util/dispatcher/dsp/group._$$GroupManager#__reset
     * @param    {Object} arg0 - 可选配置参数
     * @return   {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__root = _options.root;
        this.__dispatcher = _options.dispatcher;
        this.__mpool = {}; // umi in this group
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        delete this.__root;
        delete this.__mpool;
        delete this.__dispatcher;
    };
    /**
     * 判断父节点是否被阻止行为
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__isStopped
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点
     * @return {Boolean} 是否被阻止
     */
    _pro.__isStopped = function(_node){
        if (!_t2._$isNode(_node)) return !1;
        return !!_node._$getData().stopped||
               this.__isStopped(_node._$getParent());
    };
    /**
     * 清理阻止标记
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doClearStopped
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点
     * @return {Void}
     */
    _pro.__doClearStopped = function(_node){
        if (!_t2._$isNode(_node)) return;
        delete _node._$getData().stopped;
        this.__doClearStopped(_node._$getParent());
    };
    /**
     * 隐藏模块
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleHide
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 起始节点（包含）
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg1 - 结束节点（不包含）
     * @return {Void}
     */
    _pro.__doModuleHide = function(_from,_to){
        this.__doModuleCheck('onhide',_from,_to);
    };
    /**
     * 模块显示并检测
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleShow
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 起始节点（包含）
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg1 - 结束节点（不包含）
     * @return {Void}
     */
    _pro.__doModuleShow = function(_from,_to){
        this.__doModuleCheck('onshow',_from,_to);
        this.__doModuleAction(_from);
    };
    /**
     * 刷新模块
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleRefresh
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点对象
     * @return {Void}
     */
    _pro.__doModuleRefresh = function(_node){
        this.__doModuleCheck('onrefresh',_node);
        this.__doModuleAction(_node);
    };
    /**
     * 标记操作
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleCheck
     * @param  {String}  arg0 - 调度类型
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg1 - 起始节点（包含）
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg2 - 结束节点（不包含）
     * @return {Void}
     */
    _pro.__doModuleCheck = function(_type,_from,_to){
        if (_from==_to||!_t2._$isNode(_from)){
            return;
        }
        // dispatch first if hide module
        if (_type=='onhide'){
            this.__doModuleDispatch(_from,_type);
        }
        this.__doModuleCheck(
            _type,_from._$getParent(),_to
        );
        if (_type!='onhide'){
            this.__doModuleDispatch(_from,_type);
        }
    };
    /**
     * 执行模块行为
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleAction
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点对象
     * @return {Boolean} 节点行为是否执行完成
     */
    _pro.__doModuleAction = function(_node){
        if (!_t2._$isNode(_node)){
            return !0;
        }
        var _data = _node._$getData(),
            _action = _data.action,
            _module = _data.module;
        // check parent dispatched
        // check module loading
        if (!this.__doModuleAction(_node._$getParent())||
           (!!_action&&_u._$isString(_module))){
            return !1;
        }
        // dispatch action
        if (!!_module&&
            !!_module._$allocate&&
           (!!_action&&_action!='onhide')){
            // check node stopped
            if (this.__isStopped(_node)) return;
            var _options = {
                umi:_node._$getPath(),
                config:_data.config,
                composite:_data.composite,
                dispatcher:this.__dispatcher
            };
            _module = _module._$allocate(_options);
            if (_t2._$isModule(_module)){
                _data.module = _module;
                this.__doModuleDispatch(_node,'onshow');
            }else{
                delete _data.module;
            }
        }
        delete _data.action;
        
        return !0;
    };
    /**
     * 调度模块事件，如果模块已经载入则调度相应操作，如果模块未载入则先载入模块
     * 
     * @protected
     * @method module:util/dispatcher/dsp/group._$$GroupManager#__doModuleDispatch
     * @param  {module:util/dispatcher/dsp/node._$$Node} arg0 - 节点对象
     * @param  {String}  arg1 - 事件名称 onshow/onhide/onrefresh
     * @return {Void}
     */
    _pro.__doModuleDispatch = (function(){
        // get nearest parent export data
        var _getParentExport = function(_node){
            var _module;
            _node = _node._$getParent();
            while(!!_node){
                _module = _node._$getData().module;
                if (_t2._$isModule(_module)){
                    return _module._$getExportData();
                }
                _node = _node._$getParent();
            }
            return null;
        };
        return function(_node,_name){
            if (!_t2._$isNode(_node)){
                return;
            }
            // format data
            var _data = _node._$getData(),
                _module = _data.module,
                _nothide = _name!='onhide';
            if (_t2._$isModule(_module)){
                // check node stopped
                if (_nothide&&this.__isStopped(_node)){
                    return;
                }
                // check event
                var _event = !this.__source ? _data.event
                             :this.__source._$getData().event;
                if (!!_event){
                    _event.umi = _node._$getPath();
                    _event.data = _getParentExport(_node);
                }
                // check event name
                // order must be onhide->onshow->onrefresh
                // onshow must after onhide
                var _xname = _data.xname||'onhide';
                if (_name=='onshow'&&_xname!='onhide'){
                    _name = 'onrefresh';
                }
                // onrefresh must after onshow
                if (_name=='onrefresh'&&_xname=='onhide'){
                    _name = 'onshow';
                }
                _data.xname = _name;
                // do dispatch event
                _module._$dispatchEvent(_name,_event||{});
                // position to element
                if (_nothide&&
                    !!_event&&
                    !!_event.pos&&
                    _event.umi==_event.target){
                    _e._$scrollTo(_event.pos);
                }
                // check stopped flag
                if (_nothide&&!!_event){
                    _data.stopped = _event.stopped;
                    delete _event.stopped;
                }
            }else if(!!_module){
                _data.action = _name;
                if (_name=='onshow'&&_u._$isString(_module)){
                    // check module template inline
                    var _element = _e._$get('umi://'+_module);
                    if (!!_element){
                        _t1._$parseTemplate(_element);
                    }else{
                        var _config = location.config||_o;
                        _j._$loadHtml((_config.root||'')+_module,{
                            version:(_config.ver||_o)[_module],
                            onload:_t1._$parseTemplate
                        });
                    }
                }
            }
        };
    })();
    /**
     * 判断UMI是否属于该分组管理器
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$hasUMI
     * @param  {String}  arg0 - 模块UMI
     * @return {Boolean} 是否属于该分组管理器
     */
    _pro._$hasUMI = function(_umi){
        return !!this.__mpool[_umi];
    };
    /**
     * 将UMI加入分组管理器中
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$addUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$addUMI = function(_umi){
        this.__mpool[_umi] = !0;
    };
    /**
     * 删除分组管理器中的UMI
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$delUMI
     * @param  {Object} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$delUMI = function(_umi){
        delete this.__mpool[_umi];
    };
    /**
     * 指定UMI的模块载入完成
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$loadedUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$loadedUMI = function(_umi){
        if (this._$hasUMI(_umi)){
            this.__doModuleAction(
                _t2._$getNodeByUMI(this.__root,_umi)
            );
        }
    };
    /**
     * 调度到指定UMI的模块
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$dispatchUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$dispatchUMI = function(_umi){
        if (this._$hasUMI(_umi)){
            var _node = _t2._$getNodeByUMI(this.__root,_umi);
            this.__doClearStopped(_node);
            this.__doModuleShow(_node);
        }
    };
    /**
     * 隐藏指定UMI的模块
     * 
     * @method module:util/dispatcher/dsp/group._$$GroupManager#_$hideUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$hideUMI = function(_umi){
        if (this._$hasUMI(_umi)){
            this.__doModuleHide(
                _t2._$getNodeByUMI(this.__root,_umi)
            );
        }
    };
    
    return _p;
},'3ff9c25bd81a3c2a260c28122918263a','5e5afc6c5ab9a60e963a7e2e41706b91','036fce036df53014afe007bfc84b3324','555a9eecaf26c5c01fe9db8d965bc30f','9455dd0e0cc186d8b5850a608ecf7163','b3c0f3ceba0c279f7e6de06836b8d2f0','356c13c039fe43b0aa515c031d53f736','396da9c39fc68b02a5861ec10a09eb54');
I$('209690c1696f7ee895684893b01a513f',function (_k,_e,_t0,_t1,_p,_o,_f,_r){
    var _pro;
    /**
     * 模块分组管理器
     * 
     * @class   module:util/dispatcher/dsp/single._$$GroupManagerSingle
     * @extends module:util/dispatcher/dsp/group._$$GroupManager
     * 
     * @param    {Object}  config  - 可选配置参数
     * @property {Boolean} classed - 是否需要切换样式
     */
    _p._$$GroupManagerSingle = _k._$klass();
    _pro = _p._$$GroupManagerSingle._$extend(_t1._$$GroupManager);
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#__reset
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__classed = !!_options.classed;
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        delete this.__cmroot;
        delete this.__source;
    };
    /**
     * 判断当前模块是否可以退出
     * 
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#_$exitable
     * @param  {Object}  arg0 - 目标信息
     * @return {Boolean} 是否允许退出当前模块
     */
    _pro._$exitable = function(_event){
        if (!this.__source){
            return !0;
        }
        var _module = this.__source._$getData().module;
        // sure module has loaded
        if (_t0._$isModule(_module)){
            _module._$dispatchEvent('onbeforehide',_event);
        }
        return !_event.stopped;
    };
    /**
     * 刷新当前模块
     * 
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#_$refresh
     * @return {Void}
     */
    _pro._$refresh = function(){
        if (!this.__source) return;
        // keep asynchronous for finishing last process
        window.setTimeout(
            this._$dispatchUMI._$bind(
                this,this.__source._$getPath()
            ),0
        );
    };
    /**
     * 调度到指定UMI的模块,大致调度策略为:
     * 
     * 1. 计算原始节点与目标节点的公共节点
     * 2. 依次刷新根节点到公共节点之间的节点上注册的模块
     * 3. 依次隐藏原始节点到公共节点之间的节点上注册的模块
     * 4. 依次显示公共节点到目标节点之间的节点上注册的模块
     *   
     * 执行过程中遇到任何需要动态载入的模块均自动载入,
     * 子节点执行操作之前必须确保父节点已执行完相应操作
     * 
     * 以下两种情况忽略本次调度逻辑:
     * 
     * * 需要调度的UMI非本组管理器的UMI
     * * 需要调度的UMI上没有注册模块
     * 
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#_$dispatchUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$dispatchUMI = function(_umi){
        if (!this._$hasUMI(_umi)) return;
        var _target = _t0._$getNodeByUMI(this.__root,_umi),
            _data = _target._$getData();
        // no module registed in target
        if (!_data.module) return;
        // update event information
        var _source = this.__source,
            _event  = _data.event,
            _odata  = _o;
        this.__source = _target;
        this.__doClearStopped(_target);
        if (!!_source){
            _odata = _source._$getData().event;
            _event.referer = _odata.href||'';
        }
        // source==target do refresh
        if (_source==_target){
            this.__doModuleRefresh(this.__source);
            return;
        }
        // hide source
        this.__cmroot = _t0._$getCommonRoot(
            this.__root,_source,_target
        );
        if (_source!=null){
            // hide source -> common root
            if (_source!=this.__cmroot){
                if (this.__classed){
                    _e._$delClassName(
                        document.body,
                        _odata.clazz
                    );
                }
                this.__doModuleHide(
                    _source,this.__cmroot
                );
            }
            // refresh common root -> root
            this.__doModuleRefresh(this.__cmroot);
        }else{
            // show common root -> root
            this.__doModuleShow(this.__cmroot);
        }
        // show target
        if (_target!=this.__cmroot){
            if (this.__classed){
                _e._$addClassName(
                    document.body,_event.clazz
                );
            }
            // show target -> common root
            this.__doModuleShow(_target,this.__cmroot);
        }
    };
    /**
     * 指定UMI的模块载入完成
     * 
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#_$loadedUMI
     * @param  {String} arg0 - 模块UMI
     * @return {Void}
     */
    _pro._$loadedUMI = function(_umi){
        if (this._$hasUMI(_umi)){
            this.__doModuleAction(this.__source);
        }
    };
    /**
     * 隐藏当前分组
     * 
     * @method module:util/dispatcher/dsp/single._$$GroupManagerSingle#_$hide
     * @return {Void}
     */
    _pro._$hide = function(){
        if (!this.__source){
            return;
        }
        this._$hideUMI(
            this.__source._$getPath()
        );
        delete this.__cmroot;
        delete this.__source;
    };
    
    return _p;
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','396da9c39fc68b02a5861ec10a09eb54','ea4ade116c63b2ca8b34325f3293ca52');
I$('2f42d72d3d8c7e4416ec3e049e3ce40b',function (_m,_p,_o,_f,_r){
    /**
     * 修正标题
     * @param  {String} 上次标题
     * @return {String} 修正后的标题
     */
    _p.__doFixTitle = (function(){
        var _reg = /#.*?$/i;
        return function(_title){
            var _odttl = document.title,
                _nwttl = _odttl.replace(_reg,'');
            if (_odttl!=_nwttl){
                _title = _nwttl||_title;
                document.title = _title;
            }
            return document.title;
        };
    })();
    /**
     * 修正标题被Hash污染问题
     * @param  {String} 原始标题
     * @return {Void}
     */
    _p.__doFixHashTitle = function(_title){
        // TODO
    };
    
    return _p;
},'345f1460138e362bb33cc48ffc7cd12b');
I$('b9bab1c66bc686d3a5378353eaa7f27f',function(_h,_m,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release>='7.0'){I$(14,function (_u){
        /**
         * 修正标题被Hash污染问题
         * @param  {String} 原始标题
         * @return {Void}
         */
        _h.__doFixHashTitle = function(_title){
            new MutationObserver(function(_list){
                _u._$reverseEach(
                    _list,function(_record){
                        if (_record.target.tagName=='TITLE'||
                            _record.type=='characterData'){
                            _title = _h.__doFixTitle(_title);
                            return !0;
                        }
                    }
                );
            }).observe(
                document,{
                    subtree:!0,
                    childList:!0,
                    characterData:!0
                }
            );
        };
    },'3ff9c25bd81a3c2a260c28122918263a');}
if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<'7.0'){I$(15,function (_v){
        /** 
         * ä¿®æ­£æ ‡é¢˜è¢«Hashæ±¡æŸ“é—®é¢˜
         * @param  {String} åŽŸå§‹æ ‡é¢˜
         * @return {Void}
         */
        _h.__doFixHashTitle = function(_title){
            _v._$addEvent(
                document,'propertychange',function(_event){
                    if (_event.propertyName!='title'){
                        return;
                    }
                    _title = _h.__doFixTitle(_title);
                }
            );
        };
    },'b9845e13e284410cb0bb909f737020e4');}return _h;},'2f42d72d3d8c7e4416ec3e049e3ce40b','345f1460138e362bb33cc48ffc7cd12b');
I$('bb92431d6f4a552a0f923a98a20eace9',function (NEJ,_k,_e,_v,_u,_t0,_t1,_t2,_t3,_t4,_t5,_t6,_t7,_h,_p,_o,_f,_r){
    var _pro;
    /**
     * è°ƒåº¦å™¨å¯¹è±¡ï¼Œé¡¹ç›®ä»…å…è®¸å®žä¾‹åŒ–ä¸€ä¸ªè°ƒåº¦å™¨
     *
     * ä»£ç ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/template/tpl',
     *     'util/dispatcher/dispatcher'
     * ],function(_e,_p){
     *     // å–è°ƒåº¦å™¨å®žä¾‹
     *     var dispatcher = _p._$$Dispatcher._$getInstance();
     *
     *     // æ·»åŠ è§„åˆ™
     *     dispatcher._$rule({
     *         title:{
     *             '/m/a':'æ¨¡å—æ ‡é¢˜',
     *             '/m/b':'æ¨¡å—æ ‡é¢˜'
     *         },
     *         rewrite:[
     *             {'/m/a':''},
     *             {'/m/b':/^\/m\/d.*$/i}
     *         ]
     *     });
     *
     *     // æ³¨å†Œæ¨¡å—
     *     dispatcher._$regist({
     *         '/m/a':'/m/a.html',
     *         '/m/b':'/m/b.html',
     *         '/m/c':'/m/c.html'
     *     });
     *
     *     // æ¿€æ´»è°ƒåº¦å™¨
     *     dispatcher._$active();
     *
     *     // ä»¥ä¸Šé€»è¾‘ä¹Ÿå¯é€šè¿‡æž„é€ å‚æ•°æ–¹å¼è¾“å…¥
     *     var dispatcher = _p._$$Dispatcher._$getInstance({
     *         rules:{
     *             title:{
     *                 '/m/a':'æ¨¡å—æ ‡é¢˜',
     *                 '/m/b':'æ¨¡å—æ ‡é¢˜'
     *             },
     *             rewrite:[
     *                {'/m/a':''},
     *                {'/m/b':/^\/m\/b.*$/i}
     *             ]
     *         },
     *         modules:{
     *             '/m/a':'/m/a.html',
     *             '/m/b':'/m/b.html',
     *             '/m/c':'/m/c.html'
     *         },
     *         onbeforechange:function(_event){
     *             // æ ¹æ®dispatcherè§„åˆ™è§£æžå‡ºæ¥çš„è·¯å¾„ä¿¡æ¯
     *             // _event.path   <--- æ¨¡å—UMI
     *             // _event.href   <--- è·¯å¾„å®Œæ•´ä¿¡æ¯
     *             // _event.query  <--- æŸ¥è¯¢å‚æ•°ä¿¡æ¯
     *             // å¯ä»¥é€šè¿‡ä¿®æ”¹ä»¥ä¸Šå‚æ•°è°ƒæ•´è°ƒåº¦æ¨¡å—
     *         }
     *     })
     *     dispatcher._$active();
     *
     *     // è°ƒåº¦å™¨æ¿€æ´»å‰éœ€ç¡®ä¿å½“å‰å¯èƒ½å‡ºçŽ°çš„æ¨¡å—å‡å·²æ³¨å†Œåˆ°è°ƒåº¦å™¨ä¸­
     *     // å®žé™…åº”ç”¨ä¸­å¸¸å‡ºçŽ°ä»¥ä¸‹æƒ…å†µ
     *     var dispatcher = _$$Dispatcher._$getInstance({
     *         modules:{
     *             '/m/a':'/m/a.html',
     *             '/m/b':'/m/b.html',
     *             '/m/c':'/m/c.html'
     *         }
     *     });
     *     // å…ˆè§£æžé¡µé¢æ¨¡æ¿ï¼Œå› ä¸ºåœ¨è§£æžæ¨¡æ¿çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰æ¨¡å—æž„é€ å™¨çš„æ³¨å†Œé€»è¾‘
     *     // æ³¨å†Œæ¨¡å—æž„é€ å™¨çš„ä¼˜å…ˆçº§è¦æ¯”æ³¨å†Œæ¨¡æ¿æ–‡ä»¶åœ°å€çš„ä¼˜å…ˆçº§é«˜ï¼Œ
     *     // å› æ­¤å¿…é¡»ç¡®ä¿æ­¤å¤„å¯èƒ½å‡ºçŽ°æ³¨å†Œæž„é€ å™¨çš„é€»è¾‘å·²å¤„ç†ä»¥é¿å…è°ƒåº¦å™¨æ¿€æ´»æ—¶å‘å‡ºæ¨¡å—æ¨¡æ¿æ–‡ä»¶çš„è¯·æ±‚
     *     // æ¯”å¦‚ åœ¨æ¨¡æ¿å†…è”äº†'/m/c'æ¨¡å—çš„ç›¸å…³æ¨¡æ¿ï¼ˆåŒ…æ‹¬æ ·å¼ã€ç»“æž„å’Œé€»è¾‘ï¼‰ï¼Œå¦‚æžœæ­¤å¤„ä¸å…ˆè§£æžæ¨¡æ¿ï¼Œ
     *     // åˆ™åœ¨è°ƒåº¦å™¨æ¿€æ´»æ—¶ï¼Œè°ƒåº¦å™¨ä¼šè¯†åˆ«å‡º'/m/c'å¯¹åº”çš„æ˜¯æ¨¡æ¿æ–‡ä»¶'/m/c.html'ï¼Œå› æ­¤å›žåŽ»åŠ è½½è¿™ä¸ªæ–‡ä»¶ï¼Œ
     *     // è€Œå®žé™…ä¸Šè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å·²å†…è”åœ¨é¡µé¢çš„æ¨¡æ¿ä¸­ï¼Œå› æ­¤ä¼šäº§ç”Ÿé¢å¤–çš„è¯·æ±‚å¼€é”€
     *     _e._$parseTemplate('template-box');
     *     // æ¿€æ´»è°ƒåº¦å™¨
     *     dispatcher._$active();
     * });
     * ```
     *
     * @class    module:util/dispatcher/dispatcher._$$Dispatcher
     * @extends  module:util/event._$$EventTarget
     *
     * @param    {Object}  config  - å¯é€‰é…ç½®å‚æ•°ï¼Œå·²å¤„ç†çš„å‚æ•°åˆ—è¡¨å¦‚ä¸‹
     * @property {Object}  modules - æ¨¡å—é…ç½®
     * @property {Object}  rules   - è§„åˆ™é…ç½®
     * @property {Boolean} rest    - æ˜¯å¦æ”¯æŒRESTé£Žæ ¼çš„UMIè§£æž
     */
    /**
     * è¡Œä¸ºè§£æžä¹‹å‰è§¦å‘äº‹ä»¶ï¼Œä¸€èˆ¬ç”¨äºŽè§£æžèŠ‚ç‚¹ä¸­è¡Œä¸ºç›¸å…³ä¿¡æ¯
     *
     * ç»“æž„ä¸¾ä¾‹
     * ```html
     * <div data-res-id="xxxx"
     *      data-res-type="2"
     *      data-res-action="show"
     *      data-res-data="a=aaaa&b=bbbb&c=cccc">
     *   <!-- content here -->
     * </div>
     * ```
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/dispatcher'
     * ],function(_p){
     *     // startup dispatcher
     *     _p._$startup({
     *         // ...
     *         onbeforeaction:function(_event){
     *             var _data = _e._$dataset(_event.target,'resData');
     *             // _event.result -> {id:'xxxx',type:'2',action:'show'}
     *             _event.result.param = _data;
     *         }
     *     });
     * });
     * ```
     *
     * @event    module:util/dispatcher/dispatcher._$$Dispatcher#onbeforeaction
     * @param    {Object} event  - è¡Œä¸ºç›¸å…³ä¿¡æ¯
     * @property {Node}   target - è§¦å‘è¡Œä¸ºçš„èŠ‚ç‚¹å¯¹è±¡
     * @property {Event}  event  - åŽŸå§‹äº‹ä»¶å¯¹è±¡
     * @property {Object} result - è¡Œä¸ºç›¸å…³ä¿¡æ¯
     */
    /**
     * åœ°å€å˜æ¢ä¹‹å‰è§¦å‘äº‹ä»¶
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/dispatcher'
     * ],function(_p){
     *     // startup dispatcher
     *     _p._$startup({
     *         // ...
     *         onbeforechange:function(_event){
     *             // _event -> {path:'/m/a',href:'http://a.b.com/m/a',query:{a:'aaaaa'}}
     *             var _umi = _event.path||'';
     *             if (!!_umi&&_umi.indexOf('/?')<0&&_umi.indexOf('/m')<0){
     *                 _event.path = '/m'+_umi;
     *             }
     *         }
     *     });
     * });
     * ```
     *
     * @event    module:util/dispatcher/dispatcher._$$Dispatcher#onbeforechange
     * @param    {Object} event - åœ°å€ä¿¡æ¯
     * @property {String} path  - è·¯å¾„ä¿¡æ¯ï¼Œä¸å¸¦æŸ¥è¯¢å‚æ•°
     * @property {String} href  - å®Œæ•´è·¯å¾„ï¼Œå¸¦æŸ¥è¯¢å‚æ•°
     * @property {Object} query - æŸ¥è¯¢å‚æ•°è§£æžå‡ºæ¥çš„å¯¹è±¡
     */
    /**
     * æ¨¡å—æ— æ³•åŒ¹é…æ—¶è§¦å‘äº‹ä»¶
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/dispatcher'
     * ],function(_p){
     *     // startup dispatcher
     *     _p._$startup({
     *         // ...
     *         onnotfound:function(_event){
     *             // _event -> {path:'/m/a',href:'http://a.b.com/m/a'}
     *             _event.stopped = !0;
     *             location.href = '/404';
     *         }
     *     });
     * });
     * ```
     *
     * @event    module:util/dispatcher/dispatcher._$$Dispatcher#onnotfound
     * @param    {Object}  event - åœ°å€ä¿¡æ¯
     * @property {String}  path  - è·¯å¾„ä¿¡æ¯ï¼Œä¸å¸¦æŸ¥è¯¢å‚æ•°
     * @property {String}  href  - å®Œæ•´è·¯å¾„ï¼Œå¸¦æŸ¥è¯¢å‚æ•°
     * @property {Boolean} stopped - æ˜¯å¦é˜»æ­¢è¿›ä¸€æ­¥è°ƒåº¦å™¨é€»è¾‘
     */
    _p._$$Dispatcher = _k._$klass();
    _pro = _p._$$Dispatcher._$extend(_t2._$$EventTarget);
    /**
     * æŽ§ä»¶åˆå§‹åŒ–
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        var _seed = _u._$uniqueID();
        this.__pbseed = 'pb-'+_seed;
        this.__pvseed = 'pv-'+_seed;
    };
    /**
     * 控件重置
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        // temporary params
        // umi - input params
        this.__dtmp = {};
        this.__rest = !!_options.rest;
        this.__root = _t4._$$Node._$allocate();
        // config map
        // - m   config for module, umi:{title:'xxx' ... }
        // - mg  umi to group id map, umi:gid
        // - r   config for rewrite, [{umi:regexp or string or function or array}]
        // - rr  build-in rewrite
        // - al  alias map
        // - am  actions map, {click:[],dblclick:[]}
        this.__config = {m:{},mg:{},r:[],rr:{},al:{},am:{}};
        this.__groups = {};
        // for public module umi manager
        this.__doBuildGroup(this.__pbseed);
        // for private module umi manager
        this.__groups[this.__pvseed] =
            _t5._$$GroupManager._$allocate({
                root:this.__root,
                dispatcher:this
            });
        // bugfix hash title for ie with flash
        _h.__doFixHashTitle(document.title);
        // add listeners
        this.__doInitDomEvent([[
            location,'urlchange',
            this.__onURLChange._$bind(this)
        ]]);
        this.__super(_options);
        // init config
        this._$rule(_options.rules);
        this._$regist(_options.modules);
    };
    /**
     * 控件销毁
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__destroy
     * @return {Void}
     */
    _pro.__destroy = (function(){
        var _doRecycle = function(_group,_key,_map){
            delete _map[_key];
            _group._$recycle();
        };
        return function(){
            delete this.__config;
            this.__root = this.__root._$recycle();
            _u._$loop(this.__groups,_doRecycle);
            this.__super();
        };
    })();
    /**
     * 设置模块配置信息
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__setModuleConf
     * @param  {String}   arg0 - 模块UMI
     * @param  {String}   arg1 - 配置类别
     * @param  {Variable} arg2 - 配置信息
     * @return {Void}
     */
    _pro.__setModuleConf = function(_umi,_key,_value){
        var _mconf = this.__config.m[_umi];
        if (!_mconf){
            _mconf = {};
            this.__config.m[_umi] = _mconf;
        }
        _mconf[_key] = _value;
    };
    /**
     * 取模块配置信息
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__getModuleConf
     * @param  {String} arg0 - 模块UMI
     * @param  {String} arg1 - 配置标识
     * @return {String}        配置信息
     */
    _pro.__getModuleConf = function(_umi,_key){
        var _mconf = this.__config.m[_umi];
        return !_mconf?'':_mconf[_key];
    };
    /**
     * 构建分组管理器
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__doBuildGroup
     * @param  {String} arg0 - 管理器标识
     * @return {module:util/dispatcher/dsp/single._$$GroupManagerSingle} 分组管理器实例
     */
    _pro.__doBuildGroup = function(_gid){
        if (!_gid) return;
        var _group = this.__groups[_gid];
        if (!_group){
            _group = _t6._$$GroupManagerSingle._$allocate({
                root:this.__root,
                dispatcher:this,
                classed:_gid==this.__pbseed
            });
            this.__groups[_gid] = _group;
        }
        return _group;
    };
    /**
     * 添加UMI至分组管理器
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__doAddUMI2Group
     * @param  {String} arg0 - 模块UMI
     * @param  {String} arg1 - 分组标识
     * @return {Void}
     */
    _pro.__doAddUMI2Group = function(_umi,_gid){
        var _group = this.__doBuildGroup(_gid);
        if (!_group){
            _gid = _t3._$isUMIPrivate(_umi)
                 ? this.__pvseed : this.__pbseed;
            _group = this.__groups[_gid];
        }
        _group._$addUMI(_umi);
        this.__config.mg[_umi] = _gid;
    };
    /**
     * 重写UMI规则
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__doRewriteUMI
     * @param  {String} arg0 - 模块UMI
     * @return {String}        重写后模块UMI
     */
    _pro.__doRewriteUMI = (function(){
        var _reg = /\$\d/;
        return function(_umi,_href){
            var _result;
            _u._$forIn(this.__config.r,
                function(_config){
                    _u._$forIn(_config,
                        function(_value,_key){
                            // fix safari array bug #{404:'/'}
                            if (_value==null){
                                return;
                            }
                            // function
                            if (_u._$isFunction(_value)){
                                var _ret = !1;
                                try{
                                    _ret = _value.call(null,{
                                        umi:_umi,
                                        href:_href
                                    });
                                }catch(ex){
                                    // ignore
                                }
                                if (!!_ret){
                                    _result = _key;
                                    return !0;
                                }
                            }
                            // array
                            if (_u._$isArray(_value)){
                                var _index = _u._$indexOf(_value,function(v){
                                    return v===_umi||v===_href;
                                });
                                if (_index>=0){
                                    _result = _key;
                                    return !0;
                                }
                            }
                            // regexp
                            if (!!_value.test&&(
                                  _value.test(_umi)||
                                  _value.test(_href))){
                                // /^\/a\/([\d]+)\/([\d]+)\/$/ ---> /a/?p=$1&k=$2
                                // /a/123/456/ ---> /a/?p=123&k=456
                                _result = _reg.test(_key)?_umi.replace(_value,_key):_key;
                                return !0;
                            }
                            // string
                            if (_value===_umi||
                                _value===_href){
                                _result = _key;
                                return !0;
                            }
                        });
                    return !!_result;
                });
            return _result||_umi;
        };
    })();
    /**
     * URL变化触发事件
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__onURLChange
     * @param  {Object} arg0 - 地址信息
     * @return {Void}
     */
    _pro.__onURLChange = (function(){
        var _trim = /(?:^\/+)|(?:\/+$)/gi,
            _reg0 = /#(\$.*?)$/,
            _reg1 = /\/$/;
        var _doParseRestParam = function(_umi,_node){
            var _path = _node._$getPath(),
                _umi = _umi.replace(_path,'')
                           .replace(_trim,'');
            return _umi.split('/');
        };
        var _doTryGroupId = function(_umi,_map){
            // TODO improve performance
            var _value,
                _arr = _umi.split('/');
            while(_arr.length>0){
                if (!_arr[_arr.length-1]){
                    _arr.pop();
                }else{
                    _arr[_arr.length-1] = '';
                }
                _value = _map[_arr.join('/')];
                if (!!_value) return _value;
            }
            return '';
        };
        return function(_location){
            // ignore if hash start with $
            if (_location.path.indexOf('$')==0) return;
            // check input param
            var _input = this.__dtmp[_location.path];
            delete this.__dtmp[_location.path];
            // check outer logic
            this._$dispatchEvent('onbeforechange',_location);
            var _umi = this.__doRewriteUMI(
                    _location.path,
                    _location.href
                ),
                _gid = this.__config.mg[_umi];
            // try umi from rest path
            if (!_gid&&this.__rest){
                _gid = _doTryGroupId(
                       _umi,this.__config.mg);
            }
            // public umi not registed
            if (!_gid&&!_t3._$isUMIPrivate(_umi)){
                // check 404 callback
                var event = {
                    path:_umi,
                    href:_location.href
                };
                this._$dispatchEvent('onnotfound',event);
                if (event.stopped){
                    return;
                }
                // go 404 config
                _umi = this.__config.rr['404'];
                _gid = this.__config.mg[_umi];
            }
            // try umi from rest path
            if (!_gid&&this.__rest){
                _gid = _doTryGroupId(
                       _umi,this.__config.mg);
            }
            if (!_gid) return;
            // save dispatch event
            var _node = _t3._$getNodeByUMI(this.__root,_umi),
                _prst = null;
            if (this.__rest){
                _prst = _doParseRestParam(_umi,_node);
                // try rest umi end with /
                if (!_reg1.test(_umi)&&
                    !!this.__config.mg[_umi+'/']){
                    _node = _node._$getChildByName('/');
                }
            }
            // fix umi for module
            var _source = _umi;
            _umi = _node._$getPath();
            _node._$getData().event = {
                target:_umi,
                source:_source,
                href:_location.href,
                param:_location.query,
                input:_input,
                prest:_prst,
                clazz:this.__getModuleConf(_umi,'clazz'),
                pos:_reg0.test(_location.href)?RegExp.$1:''
            };
            // dispatch module
            var event = {
                title:this.__getModuleConf(_source,'title')
            };
            this._$dispatchEvent('ontitlechange',event);
            if (!!event.title){
                document.title = event.title;
            }
            this.__groups[_gid]._$dispatchUMI(_umi);
        };
    })();
    /**
     * 点击代理
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__onClickDelegate
     * @param  {Event} arg0 - 点击事件对象
     * @return {Void}
     */
    _pro.__onClickDelegate = (function(){
        // check event need delegated
        var _doCheckUMI = function(_url,_href){
            if (!_url) return;
            var _info = location.parse(_url);
            this._$dispatchEvent('onbeforechange',_info);
            var _umi = this.__doRewriteUMI(
                _info.path,_href||_info.href
            );
            return this.__groups[this.__pbseed]._$hasUMI(_umi);
        };
        var _doParseUMI = function(_node){
            // parse data-href
            var _umi = _e._$dataset(_node,'href');
            if (!!_umi) return _umi;
            // parse href without data-not-umi
            var _href = _e._$attr(_node,'href');
            if (!!_href&&!_e._$dataset(_node,'notUmi')){
                // umi in hash
                var _arr = _href.split('#');
                _arr.shift();
                var _umi = _arr.join('#');
                if (_doCheckUMI.call(this,_umi,_href)){
                    return _umi;
                }
                // umi in path
                if (_doCheckUMI.call(this,_href)){
                    var _info = location.parse(_href);
                    return _info.path+'?'+
                           _u._$object2query(_info.query);
                }
            }
        };
        var _isNode = function(_node){
            return !!_doParseUMI.call(this,_node);
        };
        return function(_event){
            var _element = _v._$getElement(
                _event,_isNode._$bind(this)
            );
            if (!!_element){
                _v._$stopDefault(_event);
                this._$redirect(
                    _doParseUMI.call(this,_element)
                );
            }
        };
    })();
    /**
     * 解析行为代理
     *
     * @protected
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#__onActionDelegate
     * @param  {Event} arg0 - 点击事件对象
     * @return {Void}
     */
    _pro.__onActionDelegate = function(_event){
        var _am = this.__config.am,
            _conf = _am[_event.type];
        if (!_conf) return;
        // has action delegate
        var _element = _v._$getElement(_event,'d:resAction');
        if (!_element) return;
        var _action = _e._$dataset(_element,'resAction')||'',
            _handler = _conf[_action.toLowerCase()];
        if (!_handler) return;
        // has action node
        var _options = {
            action:_action,
            target:_element,
            id:_e._$dataset(_element,'resId'),
            type:_e._$dataset(_element,'resType'),
            extra:_e._$dataset(_element,'resExtra')
        };
        // do other parse
        this._$dispatchEvent('onbeforeaction',{
            event:_event,
            target:_element,
            result:_options
        });
        // trigger action
        _handler.call(this,_options);
    };
    /**
     * 添加调度规则
     *
     * 脚本举例
     * ```javascript
     * // 配置模块标题
     * dispatcher._$rule('title',{
     *     '/m/a':'模块标题',
     *     '/m/b':'模块标题',
     *     '/m/c':'模块标题'
     * });
     *
     * // 配置别名
     * dispatcher._$rule('alias',{
     *     'a':'/m/a',
     *     'b':['/m/b','/m/bb'],
     *     'c':'/m/c'
     * });
     *
     * // 配置与匹配顺序无关重写规则
     * // 重写规则配置结构：{ 目标UMI:重写规则 }
     * // 重写规则可以是字符串（全字符匹配）或者正则表达式
     * dispatcher._$rule('rewrite',{
     *     '/m/b':/^\/m\/b.*$/i,
     *     '/m/c':'/m/d'
     * });
     *
     * // 批量配置重写规则
     * // 重写规则内置匹配代码支持
     * // 404 - 当模块不存在时重定向的模块UMI
     * dispatcher._$rule([
     *     {'/m/a':'/m/','/m/c':'/m/d'},  // <---- 此处两条规则匹配与顺序无关
     *     {'/m/b':/^\/m\/b.*$/i},
     *     {'404':'/m/a'}                 // <---- 模块不存在时定向到/m/a模块
     * ]);
     *
     * // 配置行为，默认为click行为，模块中通过options.input接收配置信息
     * // 默认行为信息解析节点上的以下内容：
     * // data-res-id         资源标识
     * // data-res-type       资源类型
     * // data-res-action     对资源操作的行为
     * // data-res-extra      其他信息，如a=aaa&b=bbb或者{"a":"aaa","b":"bbb"}等等，根据实际情况配置
     * dispatcher._$rule('action',{
     *     'show':'/m/a',    // 等价于dispatcher._$redirect('/m/a')
     *     'play':function(_options){
     *         // _options -> {type:'xxxx',id:'xxxx'}
     *         // TODO something
     *         // 返回结果如果为：
     *         // undefined/null  表明业务逻辑已在此函数内处理完毕
     *         // string          表明返回的是UMI，后续会调用_$redirect到该UMI
     *     },
     *     'fav':{
     *         event:'dblclick',
     *         value:'/m/b' // or function
     *     }
     * });
     *
     * // 批量配置标题和重写规则
     * dispatcher._$rule({
     *     'title':{
     *         '/m/a':'模块标题',
     *         '/m/b':'模块标题',
     *         '/m/c':'模块标题'
     *     },
     *     'rewrite':{
     *         '/m/b':/^\/m\/b.*$/i,
     *         '/m/c':'/m/d'
     *     },
     *     'alias':{
     *         'a':'/m/a',
     *         'b':['/m/b','/m/bb'],
     *         'c':'/m/c'
     *     },
     *     action:{
     *         'show':'/m/a',
     *         'play':function(_options){
     *             // TODO something
     *         }
     *     }
     * });
     * ```
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$rule
     * @param  {String}       arg0 - 规则类型，支持类型: title/rewrite/alias/action
     * @param  {Object|Array} arg1 - 规则配置，对于重写规则存在匹配的先后顺序
     * @return {Void}
     */
    _pro._$rule = (function(){
        var _buildin = ['404'];
        // regist rule
        var _doRegistRule = function(_config,_key){
            this._$rule(_key,_config);
        };
        // regist title
        var _doRegistTitle = function(_title,_umi){
            this.__setModuleConf(_umi,'title',_title);
        };
        // regist alias map
        var _doRegistAlias = function(_umi,_alias){
            this.__config.al[_alias] = _umi;
        };
        // regist rewrite
        var _doRegistRewrite = function(_config){
            if (!_config) return;
            this.__config.r.push(_config);
            // parse build-in rewrite rule
            _u._$forEach(_buildin,
                function(_key){
                    if (!_config[_key]) return;
                    this.__config.rr[_key] = _config[_key];
                    delete _config[_key];
                },this);
        };
        // regist actions
        var _doRegistAction = function(_action,_name){
            var _am = this.__config.am;
            // parse event/handler from object
            var _event = 'click',
                _handler = _action,
                _name = (_name||'').toLowerCase();
            if (_u._$isObject(_action)){
                _event = _action.event||_event;
                _handler = _action.value;
            }
            // parse handler
            if (_u._$isString(_handler)){
                _handler = function(_umi,_options){
                    this._$redirect(_umi,{
                        force:!0,
                        input:_options
                    });
                }._$bind(this,_handler);
            }else if(_u._$isFunction(_handler)){
                _handler = _handler._$aop(null,function(_event){
                    var _result = _event.value;
                    if (_u._$isString(_result)){
                        this._$redirect(_result,{
                            force:!0,
                            input:_event.args[0]
                        });
                    }
                }._$bind(this));
            }
            // push handler to cache
            if (_u._$isFunction(_handler)){
                // add event delegate
                if (!_am[_event]) {
                    this.__doInitDomEvent([[
                        document,_event,
                        this.__onActionDelegate._$bind(this)
                    ]]);
                    _am[_event] = {};
                }
                _am[_event][_name] = _handler;
            }
        };
        // rule parse function map
        var _fmap = {
            title:function(_config){
                _u._$loop(_config,
                   _doRegistTitle,this);
            },
            rewrite:function(_config){
                if (!_u._$isArray(_config)){
                    _doRegistRewrite.call(this,_config);
                }else{
                    _u._$forEach(
                        _config,
                        _doRegistRewrite,this
                    );
                }
            },
            alias:function(_config){
                _u._$loop(
                    _config,
                    _doRegistAlias,this
                );
            },
            action:function(_config){
                _u._$loop(
                    _config,
                    _doRegistAction,this
                );
            }
        };
        return function(_key,_config){
            if (_u._$isArray(_key)){
                _config = _key;
                _key = 'rewrite';
            }else if (!_u._$isString(_key)){
                _u._$forIn(_key,_doRegistRule,this);
                return;
            }
            // regist rule by type
            (_fmap[_key]||_f).call(this,_config);
        };
    })();
    /**
     * 注册UMI与模块的对应关系
     *
     * 脚本举例
     * ```javascript
     * // 注册模块的模板文件路径
     * dispatcher._$regist('/m/a/','/m/a.html');
     *
     * // 注册模块的配置信息，包括标题和文件路径
     * dispatcher._$regist('/m/a/',{
     *     title:'模块标题',
     *     clazz:'g-ma',
     *     module:'/m/a.html'
     * });
     *
     * // 注册模块的配置信息，包括标题和模块构造器
     * dispatcher._$regist('/m/a/',{
     *     title:'模块标题',
     *     clazz:'g-ma',
     *     module:np.m._$$ModuleA
     * });
     *
     * // 注册模块的构造器
     * dispatcher._$regist('/m/a/',np.m._$$ModuleA);
     *
     * // 注册私有模块指定分组ID，同一分组的私有模块调度时仅显示一个模块
     * dispatcher._$regist('/?/a/b/',{
     *     gid:'234567890',
     *     module:'/m/a/b.html'
     * });
     *
     * // 批量注册模块
     * dispatcher._$regist({
     *     '/m/a/':'/m/a.html',
     *     '/m/a/a':np.m._$$ModuleAA,
     *     '/m/b/':{
     *               title:'模块标题',
     *               clazz:'g-mb',
     *               module:'/m/b.html'
     *             },
     *     '/m/c/':{
     *               title:'模块标题',
     *               clazz:'g-mc',
     *               module:np.m._$$ModuleC
     *             },
     *     '/?/m/a/':'/m/s/a.html',
     *     '/?/m/a/a':np.m.s._$$ModuleAA,
     *     '/?/m/b/':{
     *                 gid:'abc',
     *                 title:'模块标题',
     *                 module:'/m/b.html'
     *               },
     *     '/?/m/c/':{
     *                 gid:'abc',
     *                 title:'模块标题',
     *                 module:np.m._$$ModuleC
     *               },
     * });
     * ```
     *
     * @method   module:util/dispatcher/dispatcher._$$Dispatcher#_$regist
     * @param    {String|Object} arg0      - 统一模块标识或者模块批量添加信息
     * @param    {String|Object|module:util/dispatcher/module._$$ModuleAbstract}
     *                           arg1      - 模块构造或者模块路径或者模块配置信息
     * @property {String}        gid       - 指定模块分组，仅对私有模块有效，对外模块忽略此配置
     * @property {String}        title     - 模块标题，显示模块时修改页面的标题
     * @property {String}        clazz     - 模块切换时body样式调整，仅对公共模块有效
     * @property {String|module:util/dispatcher/module._$$ModuleAbstract}
     *                           module    - 指定模块对应的模板文件地址或者模块的构造函数
     * @property {Object}        composite - 组合模块容器对应关系,{pid:umi},其中pid为umi对应模块的容器
     * @property {Object}        config    - 模块构建配置信息，在模块的init/reset/dobuild时可以获取到的配置信息
     * @return   {Void}
     */
    _pro._$regist = (function(){
        // regist single module
        var _doRegistUMI = function(_config,_umi){
            this._$regist(_umi,_config);
        };
        // check if module constructor
        var _isModuleClass = function(_module){
            return !!_module&&!!_module._$extend;
        };
        // function body
        return function(_umi,_config){
            // batch regist
            if (!_u._$isString(_umi)){
                _u._$forIn(_umi,_doRegistUMI,this);
                return;
            }
            // regist module with umi
            var _data = _t3._$appendNodeByUMI(
                    this.__root,_umi
                )._$getData(),
                _module = _data.module;
            // ignore if
            // - module constructor is registed
            // - module is instanced
            if (_t3._$isModule(_module)||
                _isModuleClass(_module)){
                return;
            }
            // parse conifg
            var _gid = this.__config.mg[_umi],_module;
            if (_u._$isString(_config)||
                _isModuleClass(_config)){
                // config is module template file or module constructor
                _module = _config;
            }else{
                // conifg is module information
                _config = _config||_o;
                _gid = _config.gid;
                _module = _config.module;
                // cache module title
                if (!!_config.title){
                    this.__setModuleConf(
                        _umi,'title',
                        _config.title
                    );
                }
                // cache module clazz
                if (!!_config.clazz){
                    this.__setModuleConf(
                        _umi,'clazz',
                        _config.clazz
                    );
                }
                // cache module composite
                if (!!_config.composite){
                    _data.composite = _config.composite;
                }
                // cache module build config
                if (!!_config.config){
                    _data.config = _config.config;
                }
            }
            // save module
            this.__doAddUMI2Group(_umi,_gid);
            _data.module = _module;
        };
    })();
    /**
     * 发送消息，消息模式
     *
     * * 0 - 目标消息【默认】，只有目标节点收到消息
     * * 1 - 目标广播，从根节点至路目标节点径上的节点收到消息
     * * 2 - 群体广播，节点下所有子孙子孙节点收到消息
     *
     * @method   module:util/dispatcher/dispatcher._$$Dispatcher#_$message
     * @param    {Object} arg0 - 消息相关信息
     * @property {String} to   - 消息目标UMI
     * @property {String} from - 消息来源UMI
     * @property {Object} data - 消息数据
     * @property {Number} mode - 消息模式
     * @return   {Void}
     */
    _pro._$message = (function(){
        // send message
        var _doSendMessage = function(_node,_message){
            var _module = _node._$getData().module;
            if (_t3._$isModule(_module)){
                _module._$dispatchEvent('onmessage',_message);
            }
        };
        // message mode function
        var _fmap = [
            _doSendMessage,
            // send message to every node in target path
            function(_target,_message){
                var _from = _message.from;
                while(!!_target){
                    if (_target._$getPath()!=_from){
                        _doSendMessage(_target,_message);
                    }
                    _target = _target._$getParent();
                }
            },
            // broadcast to all target descendants
            function(_target,_message){
                var _from = _message.from;
                _t3._$breadthFirstSearch(
                    _target,function(_node){
                        if (_node._$getPath()!=_from){
                            _doSendMessage(_node,_message);
                        }
                    }
                );
            }
        ];
        return function(_message){
            var _event = _u._$merge({},_message),
                _target = _t3._$getNodeByUMI(this.__root,_event.to);
            _event.path = _target._$getPath();
           (_fmap[_event.mode]||_fmap[0]).call(this,_target,_event);
        };
    })();
    /**
     * å‘å¸ƒæ¶ˆæ¯
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   dispatcher._$publish(
     *       'onchange',{
     *           from:'/m/login/',
     *           data:{action:'delete',value:'xxxxxx'}
     *       }
     *   );
     * ```
     *
     * @method   module:util/dispatcher/dispatcher._$$Dispatcher#_$publish
     * @param    {String} arg0 - æ¶ˆæ¯ç±»åž‹
     * @param    {Object} arg0 - æ¶ˆæ¯ç›¸å…³ä¿¡æ¯
     * @property {String} from - æ¶ˆæ¯æ¥æºUMI
     * @property {Object} data - æ¶ˆæ¯æ•°æ®
     * @return   {Void}
     */
    _pro._$publish = function(_type,_message){
        var _message = _u._$merge({},_message);
        _message.type = _type||'';
        this._$dispatchEvent(
            (_message.from||'')+':'
            +_message.type,_message
        );
    };
    /**
     * è®¢é˜…æ¶ˆæ¯
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   dispatcher._$subscribe(
     *       '/m/login/','onchange',
     *       function(_event){
     *           // _event.type
     *           // _event.from
     *           // _event.data
     *       }
     *   );
     * ```
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$subscribe
     * @param  {String}   arg0 - ç›®æ ‡æ¨¡å—çš„UMI
     * @param  {String}   arg1 - æ¶ˆæ¯ç±»åž‹
     * @param  {Function} arg2 - æ¶ˆæ¯å¤„ç†å›žè°ƒ
     * @return {Void}
     */
    _pro._$subscribe = function(_umi,_type,_callback){
        _umi = this.__config.al[_umi]||_umi;
        this._$addEvent(
            (_umi||'')+':'+(_type||''),_callback
        );
    };
    /**
     * å–æ¶ˆè®¢é˜…æ¶ˆæ¯
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   dispatcher._$unsubscribe(
     *       '/m/login/','onchange',
     *       function(_event){
     *           // å¿…é¡»åŒæ·»åŠ çš„äº‹ä»¶ä¸€è‡´
     *       }
     *   );
     * ```
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$unsubscribe
     * @param  {String}   arg0 - ç›®æ ‡æ¨¡å—çš„UMI
     * @param  {String}   arg1 - æ¶ˆæ¯ç±»åž‹
     * @param  {Function} arg2 - æ¶ˆæ¯å¤„ç†å›žè°ƒ
     * @return {Void}
     */
    _pro._$unsubscribe = function(_umi,_type,_callback){
        _umi = this.__config.al[_umi]||_umi;
        this._$delEvent(
            (_umi||'')+':'+(_type||''),_callback
        );
    };
    /**
     * éšè—éžåˆ†ç»„ç§æœ‰æ¨¡å—
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   // éšè—ç§æœ‰æ¨¡å—
     *   dispatcher._$hide('/?/m/a/b/');
     * ```
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$hide
     * @param  {String} arg0 - ç§æœ‰æ¨¡å—åœ°å€
     * @return {Void}
     */
    _pro._$hide = function(_umi){
        var _gid = this.__config.mg[_umi];
        if (_gid==this.__pvseed){
            this.__groups[_gid]._$hideUMI(_umi);
        }
    };
    /**
     * éšè—ç§æœ‰åˆ†ç»„
     * 
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$hideGroup
     * @param  {String} arg0 - åˆ†ç»„ID
     * @return {Void}
     */
    _pro._$hideGroup = function(_gid){
        var _group = this.__groups[_gid];
        if (!!_group){
            _group._$hide();
        }
    };
    /**
     * é‡å®šå‘æ¨¡å—ï¼Œæ­¤æŽ¥å£æ”¯æŒ
     *
     * * ç§æœ‰æ¨¡å—é‡å®šå‘
     * * å¯è®¿é—®æ¨¡å—é€€å‡ºå‰éªŒè¯
     * * é‡å®šå‘åœ°å€å¸¦æŸ¥è¯¢å‚æ•°
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   // é‡å®šå‘ç§æœ‰æ¨¡å—
     *   dispatcher._$redirect('/?/m/a/b?a=aa&b=bb');
     *
     *   // ç³»ç»Ÿå­˜åœ¨éœ€é€€å‡ºéªŒè¯æ¨¡å—æ—¶éœ€ä½¿ç”¨ä»¥ä¸‹ä¸šåŠ¡é€»è¾‘æŽ¥ç®¡é¡µé¢è‡ªåŠ¨è°ƒæ•´çš„é€»è¾‘
     *   _v._$addEvent(document,'click',function(_event){
     *       var _element = _v._$getElement(_event,
     *                      function(_node){
     *                          // filter node here
     *                          // e.g. _node.tagName=='A'
     *                      });
     *       if (!!_element){
     *           _v._$stopDefault(_event);
     *           dispatcher._$redirect(_e._$dataset(_element,'href'));
     *       }
     *   });
     *
     *   // å¦‚æžœé¡µé¢å¸¦è·³è½¬çš„èŠ‚ç‚¹æœ‰data-hrefæ ‡è¯†è·³è½¬åœ°å€çš„æƒ…å†µå¯ä»¥ä½¿ç”¨{#_$delegate}å¤„ç†ä»¥ä¸Šä¸šåŠ¡é€»è¾‘
     *   // <span data-href="#/m/a/?a=aa">aaaa</span>
     *   // <a href="#/m/a/?a=aa" data-href="#/m/a/?a=aa">bbbbbb</a>
     *   dispatcher._$delegate();
     * ```
     *
     * @method   module:util/dispatcher/dispatcher._$$Dispatcher#_$redirect
     * @param    {String}   arg0     - æ¨¡å—UMIï¼Œå¯ä»¥å¸¦æŸ¥è¯¢å‚æ•°
     * @param    {Object}   arg1     - é…ç½®ä¿¡æ¯
     * @property {Variable} input    - è¾“å…¥æ•°æ®
     * @property {Boolean}  replace  - æ˜¯å¦æ›¿æ¢å½“å‰åŽ†å²
     * @property {Boolean}  force    - æ˜¯å¦å¼ºåˆ¶åˆ·æ–°
     * @property {Boolean}  ignored  - æ˜¯å¦å¿½ç•¥åœ°å€å˜åŒ–å‰çš„éªŒè¯
     * @property {Boolean}  exitable - æ˜¯å¦å¯å¼ºè¡Œé€€å‡ºå‰é¢çš„æ¨¡å—
     * @return   {Void}
     */
    _pro._$redirect = function(_url,_options){
        _options = _options||_o;
        var _umi = _t3._$path2umi(_url),
            _location = location.parse(_url);
        this.__dtmp[_location.path] = _options.input;
        if (_t3._$isUMIPrivate(_umi)){
            // dispatch private module
            this.__onURLChange(_location);
        }else{
            // dispatch public module
            var _group = this.__groups[this.__pbseed],
                _event = {target:_location,umi:_umi};
            if (_options.exitable||!!_group._$exitable(_event)){
                if (location.same(_url)&&!!_options.force){
                    this.__onURLChange(_location);
                }else{
                    location.ignored = !!_options.ignored;
                    location.redirect(_url,!!_options.replace);
                }
            }
        }
    };
    /**
     * åˆ·æ–°æ¨¡å—
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$refresh
     * @param  {String} arg0 - æ¨¡å—UMIï¼Œå¯ä»¥å¸¦æŸ¥è¯¢å‚æ•°
     * @return {Void}
     */
    _pro._$refresh = function(_url){
        if (!!_url){
            this._$redirect(_url,{
                replace:!0,force:!0
            });
        }else{
            this.__groups[this.__pbseed]._$refresh();
        }
    };
    /**
     * æ¨¡å—åˆ‡æ¢è·³è½¬å§”æ‰˜ï¼Œ
     * å¦‚æžœç³»ç»Ÿå­˜åœ¨éœ€é€€å‡ºéªŒè¯æ¨¡å—æ—¶éœ€ä½¿ç”¨æ­¤æŽ¥å£æŽ¥ç®¡é¡µé¢è‡ªåŠ¨è°ƒæ•´çš„é€»è¾‘
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$delegate
     * @see    module:util/dispatcher/dispatcher._$$Dispatcher#_$redirect
     * @return {Void}
     */
    _pro._$delegate = function(){
        this.__doInitDomEvent([[
            document,'click',
            this.__onClickDelegate._$bind(this)
        ]]);
    };
    /**
     * æ¿€æ´»è°ƒåº¦å™¨ï¼Œæ¿€æ´»ä¹‹å‰ç¡®ä¿æ³¨å†Œå®Œä¼šè¢«è°ƒç”¨çš„æ¨¡å—
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$active
     * @return {Void}
     */
    _pro._$active = function(){
        location.active();
    };
    /**
     * æ¨¡å—è½½å…¥å›žè°ƒ
     *
     * @method module:util/dispatcher/dispatcher._$$Dispatcher#_$loaded
     * @param  {String} arg0 - æ¨¡å—UMI
     * @param  {module:util/dispatcher/module._$$ModuleAbstract} arg1 - æ¨¡å—æž„é€ å™¨
     * @return {Void}
     */
    _pro._$loaded = function(_umi,_module){
        _umi = this.__config.al[_umi]||_umi;
        if (!_u._$isArray(_umi)){
            this._$regist(_umi,_module);
            this.__groups[this.__config.mg[_umi]]._$loadedUMI(_umi);
        }else{
            _u._$forEach(
                _umi,function(_key){
                    this._$loaded(_key,_module);
                },this
            );
        }
    };
    /**
     * 获取对应UMI配置的标题信息
     * @param umi
     * @private
     */
    _pro._$getTitle = function(umi){
        return this.__getModuleConf(umi,'title');
    };
    /**
     * 启动调度系统
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/dispatcher'
     * ],function(_p){
     *     // 实例化调度器，并在全局设置dispatcher变量供模块使用
     *     _p._$startup({
     *         // 设置规则
     *         rules:{
     *             title:{
     *                 '/m/a/':'模块A',
     *                 '/m/b/':'模块B',
     *                 '/m/c/':'模块C'
     *             },
     *             rewrite:{
     *                 '404':'/m/c/0/',
     *                 '/m/c/$1/':/^\/c\/([\d])\/$/
     *             }
     *         },
     *         // 注册模块
     *         modules:{
     *             '/m':'/module/m.html',
     *             '/m/a/':'/module/m.c.html',
     *             '/m/b/':'/module/m.c.html',
     *             '/m/c/':{module:'/module/m.c.html',clazz:'g-mdl-c'}
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/dispatcher/dispatcher._$startup
     * @param    {Object} arg0 - 配置信息，其他配置同调度器实例化配置
     * @property {String} tid  - 模版ID，默认template-box
     * @return   {module:util/dispatcher/dispatcher._$$Dispatcher} 调度器实例
     */
    _p._$startup = function(_options){
        if (!!window.dispatcher){
            console.error('dispatcher is already startup');
            return;
        }
        window.dispatcher =
            _p._$$Dispatcher.
            _$getInstance(_options);
        _t7._$dumpModules();
        _t1._$parseTemplate(
            (_options||_o).tid||'template-box',
            location.config
        );
        _v._$addEvent(
            document,'templateready',function(){
                window.setTimeout(
                    dispatcher._$active._$bind(dispatcher),0
                );
            }
        );
        return window.dispatcher;
    };

    if (CMPT){
        NEJ.P('nej.e')._$startup = _p._$startup;
        NEJ.P('nej.ut')._$$Dispatcher = _p._$$Dispatcher;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','7916fe9b42ff545d7310ae1278626196','356c13c039fe43b0aa515c031d53f736','b3c0f3ceba0c279f7e6de06836b8d2f0','396da9c39fc68b02a5861ec10a09eb54','9ed4c2425e9a06a20d554eecbf926d86','ea4ade116c63b2ca8b34325f3293ca52','209690c1696f7ee895684893b01a513f','ae709ce8ba298e2050e36c803ec1095e','b9bab1c66bc686d3a5378353eaa7f27f');
I$('ae709ce8ba298e2050e36c803ec1095e',function (NEJ,_k,_e,_u,_t0,_t1,_p,_o,_f,_r){
    var _pro;
    /**
     * 项目模块基类对象
     * 
     * @class    module:util/dispatcher/module._$$ModuleAbstract
     * @extends  module:util/event._$$EventTarget
     * 
     * @param    {Object} config    - 可选配置参数
     * @property {String} umi       - 当前模块的统一模块标识符
     * @property {Object} composite - 组合模块配置信息
     * @property {module:util/dispatcher/dispatcher._$$Dispatcher} dispatcher - 调度器实例
     */
    _p._$$ModuleAbstract = _k._$klass();
    _pro = _p._$$ModuleAbstract._$extend(_t0._$$EventTarget);
    /**
     * 控件初始化
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__init
     * @return {Void}
     */
    _pro.__init = function(_options){
        this.__super(_options);
        this.__export = {};
        this.__doBuild(_options.config);
    };
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__umi = _options.umi||'';
        this.__dispatcher = _options.dispatcher;
        this.__composites = _options.composite||_o;
        // void rewrite
        this._$batEvent({
            onshow:this.__onShow._$bind(this),
            onhide:this.__onHide._$bind(this),
            onrefresh:this.__onRefresh._$bind(this),
            onmessage:this.__onMessage._$bind(this),
            onbeforehide:this.__onBeforeHide._$bind(this)
        });
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        this.__export = {};
        delete this.__umi;
        delete this.__composites;
        delete this.__dispatcher;
    };
    /**
     * 阻止事件
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__stop
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__stop = function(_event){
        if (!!_event){
            _event.stopped = !0;
        }
    };
    /**
     * 构建模块，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doBuild
     * @return {Void}
     */
    _pro.__doBuild = _f;
    /**
     * 模块退出前触发事件，通过阻止输入的事件做退出验证，子类实现具体逻辑
     * 
     * @abstract
     * @method module:util/dispatcher/module._$$ModuleAbstract#__onBeforeHide
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onBeforeHide = _f;
    /**
     * 清除所有组合控件，除了调度器控件
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doClearComponentExDsp
     * @return {Void}
     */
    _pro.__doClearComponentExDsp = (function(){
        var _doCheck = function(_component){
            return !!_t1._$$Dispatcher&&
                    (_component instanceof _t1._$$Dispatcher);
        };
        return function(){
            this.__doClearComponent(_doCheck);
        };
    })();
    /**
     * 接受到消息触发事件，子类实现具体逻辑
     * 
     * @abstract
     * @method module:util/dispatcher/module._$$ModuleAbstract#__onMessage
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onMessage = _f;
    /**
     * 向目标模块发送消息
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doSendMessage
     * @param  {String}   arg0 - 目标模块UMI
     * @param  {Variable} arg1 - 消息内容
     * @param  {Number}   arg2 - 消息模式
     * @return {Void}
     */
    _pro.__doSendMessage = function(_to,_message,_mode){
        this.__dispatcher._$message({
            to:_to,
            mode:_mode||0,
            data:_message,
            from:this.__umi
        });
    };
    /**
     * 发布消息
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doPublishMessage
     * @param  {String} arg0 - 消息类型
     * @param  {Object} arg1 - 消息信息
     * @return {Void}
     */
    _pro.__doPublishMessage = function(_type,_data){
        this.__dispatcher._$publish(
            _type,{
                from:this.__umi,
                data:_data
            }
        );
    };
    /**
     * 订阅消息
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doSubscribeMessage
     * @param  {String}   arg0 - 目标模块的UMI
     * @param  {String}   arg1 - 消息类型
     * @param  {Function} arg2 - 消息处理回调
     * @return {Void}
     */
    _pro.__doSubscribeMessage = function(){
        this.__dispatcher._$subscribe
            .apply(this.__dispatcher,arguments);
    };
    /**
     * 取模块对外开放的数据信息，依赖此模块的子模块可以访问到此信息
     * 
     * @method module:util/dispatcher/module._$$ModuleAbstract#_$getExportData
     * @return {Object} 对外开放的数据信息
     */
    _pro._$getExportData = function(){
        return this.__export;
    };
    /**
     * 解析模块所在容器节点
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doParseParent
     * @param  {Object} arg0 - 配置信息
     * @return {Node}          模块所在容器节点
     */
    _pro.__doParseParent = function(_options){
        // try get parent
        // check input first
        var _parent;
        if (!_parent){
            var _data = _options.input||_o;
            _parent = _e._$get(_data.parent);
        }
        if (!_parent){
            var _data = _options.data||_o;
            _parent = _e._$get(_data.parent);
        }
        if (!_parent){
            _parent = _e._$get(_options.parent);
        }
        return _parent;
    };
    /**
     * 显示模块触发事件，子类可重写具体逻辑
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__onShow
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onShow = function(_options){
        var _parent = this.__doParseParent(_options);
        // show and refresh module
        if (!!_parent&&!!this.__body){
            _parent.appendChild(this.__body);
        }
        this.__doApplyComposite('onshow',_options);
        this.__onRefresh(_options);
    };
    /**
     * 显示模块触发事件，子类实现具体逻辑
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__onRefresh
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onRefresh = function(_options){
        this.__doApplyComposite('onrefresh',_options);
    };
    /**
     * 隐藏模块触发事件，子类实现具体逻辑
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__onHide
     * @return {Void}
     */
    _pro.__onHide = function(){
        this.__doHideComposite();
        _e._$removeByEC(this.__body);
    };
    /**
     * 是否忽略模块组合
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__isEscapedComposite
     * @return {Boolean} 是否忽略
     */
    _pro.__isEscapedComposite = (function(){
        var _reg0 = /^onshow|onrefresh|delay$/;
        return function(_umi){
            return _reg0.test(_umi);    
        };
    })();
    /**
     * 动态生成组合模块的输入参数，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doGenCompositeParam
     * @param  {String} arg0 - 模块类别
     * @param  {Object} arg1 - 输入信息
     * @return {Object}        参数信息
     */
    _pro.__doGenCompositeParam = _f;
    /**
     * 应用组合模块
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doApplyComposite
     * @param  {String} arg0 - 类型，onshow/onrefresh
     * @param  {Object} arg1 - 事件对象
     * @return {Void}
     */
    _pro.__doApplyComposite = (function(){
        var _doRedirect = function(_query,_options,_umi,_pid){
            if (this.__isEscapedComposite(_pid)) return;
            if (!!_query) _umi += (_umi.indexOf('?')>1?'&':'?')+_query;
            var _input = this.__doGenCompositeParam(_pid,_options)||{};
            _input.location = _options;
            _input.parent = this.__export[_pid];
            this.__dispatcher._$redirect(_umi,{input:_input});
        };
        return function(_type,_options){
            if (!_options.nodelay){
                // delay all
                if (!!this.__composites.delay) return;
                // check delay
                var _composite = this.__composites[_type]||_o;
                if (_composite.delay) return;
            }
            // do apply
            var _query = _u._$object2query(_options.param)||'';
            if (_type=='onrefresh'){
                _u._$loop(
                    this.__composites,
                    _doRedirect._$bind(this,_query,_options)
                );
            }
            _u._$loop(
                _composite,_doRedirect.
                _$bind(this,_query,_options)
            );
        };
    })();
    /**
     * 隐藏组合模块
     * 
     * @protected
     * @method module:util/dispatcher/module._$$ModuleAbstract#__doHideComposite
     * @return {Void}
     */
    _pro.__doHideComposite = (function(){
        var _doHide = function(_umi,_pid){
            if (!this.__isEscapedComposite(_pid)){
                this.__dispatcher._$hide(_umi);
            }
        };
        return function(){
            _u._$loop(this.__composites,_doHide,this);
            _u._$loop(this.__composites.onshow,_doHide,this);
            _u._$loop(this.__composites.onrefresh,_doHide,this);
        };
    })();
    /**
     * 注册模块，如果调度器还没有被实例化则先缓存注册内容
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/dispatcher/module'
     * ],function(_t){
     *     // 注册别名
     *     _t._$regist('blog-list',a._$$Module);
     *
     *     // 注册UMI
     *     _t._$regist('/blog/list/',a._$$Module);
     * });
     * ```
     * 
     * @method module:util/dispatcher/module._$regist
     * @param  {String} arg0 - 模块UMI或者别名
     * @param  {module:util/dispatcher/module._$$ModuleAbstract} arg1 - 模块构造函数
     * @return {Void}
     */
    _p._$regist = (function(){
        var _modules;
        // dump modules for dispatcher startup
        _p._$dumpModules = function(){
            if (!_modules) return;
            _u._$loop(_modules,function(_module,_umi){
                dispatcher._$loaded(_umi,_module);
            });
            _modules = null;
        };
        return function(_umi,_module){
            if (!!window.dispatcher){
                dispatcher._$loaded.
                    apply(dispatcher,arguments);
            }else{
                if (!_modules){
                    _modules = {};
                }
                _modules[_umi] = _module;
            }
        };
    })();
    
    if (CMPT){
        NEJ.P('nej.e')._$regist = _p._$regist;
        NEJ.P('nej.ut')._$$Module = _p._$$ModuleAbstract;
        NEJ.P('nej.ut')._$$AbstractModule = _p._$$ModuleAbstract;
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0','bb92431d6f4a552a0f923a98a20eace9');
I$('993671841dcf289096c7171d53130309',{
    "CMN_FLG_OFF"       : 0,
    "CMN_FLG_ON"        : 1,

    "CMN_BOL_NO"        : 0,
    "CMN_BOL_YES"       : 1,

    "CMN_TYP_WEB"       : 0,
    "CMN_TYP_AOS"       : 1,
    "CMN_TYP_IOS"       : 2,
    "CMN_TYP_TEST"      : 3,

    "CMN_ACT_ADD"       : 1,
    "CMN_ACT_DELETE"    : 2,
    "CMN_ACT_UPDATE"    : 3,
    "CMN_ACT_SHARE"     : 4,
    "CMN_ACT_FOLLOW"    : 5,

    "CMN_ORD_CUSTOM"    : 0,
    "CMN_ORD_NAME_ASC"  : 1,
    "CMN_ORD_NAME_DESC" : 2,
    "CMN_ORD_TIME_ASC"  : 3,
    "CMN_ORD_TIME_DESC" : 4,
    "CMN_ORD_COUNT_ASC" : 5,
    "CMN_ORD_COUNT_DESC": 6,

    "USR_FRM_SITE"      : 0,
    "USR_FRM_OPENID"    : 1,
    "USR_FRM_URS"       : 2,
    "USR_ADMIN_ID"      : 10000,
    "USR_ROP_NONE"      : 0,
    "USR_ROP_PASS"      : 1,
    "USR_ROP_REFUSE"    : 2,
    "USR_ROP_SYSTEM"    : 3,
    "USR_ROL_NONE"      : 0,
    "USR_ROL_OTHER"     : 1,
    "USR_ROL_PM"        : 2,
    "USR_ROL_FRONT"     : 3,
    "USR_ROL_BACK"      : 4,
    "USR_ROL_IOS"       : 5,
    "USR_ROL_AOS"       : 6,
    "USR_ROL_TEST"      : 7,
    "USR_ROL_OM"        : 8,

    "SPC_NOD_DIR"       : 0,
    "SPC_NOD_FILE"      : 1,
    "SPC_ENG_NONE"      : 0,
    "SPC_ENG_FREEMARK"  : 11,
    "SPC_ENG_VELOCITY"  : 12,
    "SPC_ENG_EJS"       : 21,
    "SPC_ENG_SWIG"      : 22,
    "SPC_ENG_SMARTY"    : 31,
    "SPC_LNG_UNKNOWN"   : 0,
    "SPC_LNG_JAVA"      : 11,
    "SPC_LNG_NODE"      : 12,
    "SPC_LNG_PHP"       : 13,
    "SPC_LNG_SWIFT"     : 31,
    "SPC_LNG_OC"        : 32,
    "SPC_MAP_SPEC"      : 0,
    "SPC_MAP_PROGROUP"  : 1,
    "SPC_MAP_PROJECT"   : 2,
    "SPC_SYS_MAVEN"     : 10000,
    "SPC_SYS_NODE"      : 10001,
    "SPC_DTS_NONE"      : 0,
    "SPC_DTS_INTERFACE" : 1,
    "SPC_DTS_DATATYPE"  : 2,
    "SPC_DTS_TEMPLATE"  : 3,
    "SPC_DTS_WEBVIEW"   : 4,
    "SPC_DTS_HANDLEBAR" : 5,

    "PRG_TYP_NORMAL"    : 0,
    "PRG_TYP_DEFAULT"   : 1,
    "PRG_TYP_HIDDEN"    : 2,
    "PRG_VRF_AUTH"      : 0,
    "PRG_VRF_PASS"      : 1,
    "PRG_ROL_GUEST"     : 0,
    "PRG_ROL_DEVELOPER" : 1,
    "PRG_ROL_TESTER"    : 2,
    "PRG_ROL_ADMIN"     : 9,
    "PRG_ROL_OWNER"     : 10,
    "PRG_ROP_NONE"      : 0,
    "PRG_ROP_PASS"      : 1,
    "PRG_ROP_REFUSE"    : 2,
    "PRG_ROP_SYSTEM"    : 3,
    "PRG_SYS_HIDDEN"    : 10000,

    "PRO_TYP_NORMAL"    : 0,
    "PRO_TYP_COMMON"    : 1,
    "PRO_TYP_HIDDEN"    : 2,
    "PRO_SYS_HIDDEN"    : 10000,

    "MDL_TYP_NORMAL"    : 0,
    "MDL_TYP_SYSTEM"    : 1,
    "MDL_TYP_HIDDEN"    : 2,
    "MDL_FMT_HASH"      : 0,
    "MDL_FMT_ENUM"      : 1,
    "MDL_FMT_ARRAY"     : 2,
    "MDL_FMT_STRING"    : 3,
    "MDL_FMT_NUMBER"    : 4,
    "MDL_FMT_BOOLEAN"   : 5,
    "MDL_FMT_FILE"      : 6,
    "MDL_SYS_UNKNOWN"   :  9998,
    "MDL_SYS_FILE"      :  9999,
    "MDL_SYS_VARIABLE"  : 10000,
    "MDL_SYS_STRING"    : 10001,
    "MDL_SYS_NUMBER"    : 10002,
    "MDL_SYS_BOOLEAN"   : 10003,
    "API_TYP_REQUEST"   : 0,
    "API_TYP_MODULE"    : 1,
    "API_TST_TODO"      : 0,
    "API_TST_PASS"      : 1,
    "API_TST_FAILED"    : 2,
    "API_TST_DISABLED"  : 3,
    "API_HED_REQUEST"   : 0,
    "API_HED_RESPONSE"  : 1,

    "API_MDL_CRUD_POST"               : 0,
    "API_MDL_CRUD_SINGLE_DELETE"      : 1,
    "API_MDL_CRUD_BAT_DELETE"         : 2,
    "API_MDL_CRUD_PATCH"              : 3,
    "API_MDL_CRUD_SINGLE_GET"         : 4,
    "API_MDL_CRUD_BAT_GET"            : 5,

    "PAM_TYP_QUERY"     : 0,
    "PAM_TYP_VMODEL"    : 1,
    "PAM_TYP_INPUT"     : 2,
    "PAM_TYP_OUTPUT"    : 3,
    "PAM_TYP_ATTRIBUTE" : 4,

    "PAM_OVERWRITE_RESET_FLAG" : 9,

    "RES_TYP_SPEC"      : 0,
    "RES_TYP_PROGROUP"  : 1,
    "RES_TYP_PROJECT"   : 2,
    "RES_TYP_WEBVIEW"   : 3,
    "RES_TYP_TEMPLATE"  : 4,
    "RES_TYP_INTERFACE" : 5,
    "RES_TYP_DATATYPE"  : 6,
    "RES_TYP_BISGROUP"  : 7,
    "RES_TYP_CONSTRAINT": 8,
    "RES_TYP_TESTCASE"  : 9,
    "RES_TYP_PARAMETER"  : 10,

    "BIS_TYP_NORMAL"    : 0,
    "BIS_TYP_SYSTEM"    : 1,
    "BIS_TYP_HIDDEN"    : 2,
    "BIS_SYS_HIDDEN"    : 9999,

    "MSG_TYP_SYSTEM"    : 0,
    "MSG_TYP_PRIVATE"   : 1,

    "MSG_SYS_IDS"       : [9999],
    "MSG_SYS_NEW"       : 9999
}
);
I$('c946055836c26441b9d60b589f2e1581',function (_k, _m, dbConst, _p, _pro) {
    /**
     * 项目模块基类对象
     * @class   {wd.m._$$Module}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  可选配置参数，已处理参数列表如下所示
     */
    _p._$$Module = _k._$klass();
    _pro = _p._$$Module._$extend(_m._$$ModuleAbstract);

    /**
     * 数据库常量
     */
    _pro.dbConst = dbConst;

    /**
     * 从UMI信息中解析出真实地址
     * @return {String} UMI信息
     */
    _pro.__getPathFromUMI = function (_options) {
        var _reg0 = /\?|#/;
        var _reg1 = /^\/m\//i;
        var path = (_options && _options.basePath) || window.location.pathname;
        if (path.substr(-1) !== '/') {
            path += '/';
        }
        path = path.split(_reg0)[0].replace(_reg1, '/');

        var resRegExp = /^\/((interface|template|datatype|group|constraint)\/.*)$/;
        var pageRegExp = /^\/page\/(.*)$/;
        var projectRegExp = /^\/project(\/)?(.*)$/;
        var searchRegExp = /^\/search(\/)?(.*)$/;

        if (resRegExp.test(path)) {
            path = path.replace(resRegExp, '/progroup/p/res/$1');
        } else if (pageRegExp.test(path)) {
            path = path.replace(pageRegExp, '/progroup/p/page/$1');
        } else if (projectRegExp.test(path)) {
            path = path.replace(projectRegExp, '/progroup/p/$2');
        } else if (searchRegExp.test(path)) {
            path = path.replace(searchRegExp, '/progroup/search/$2');
        }

        switch (path) {
            case '/setting/':
                path += 'profile/';
                break;

            case '/spec/detail/':
                path += 'doc/';
                break;

            case '/progroup/':
                path += 'home/management/';
                break;

            case '/progroup/detail/':
                path += 'projectmanage/';
                break;

            case '/progroup/p/':
                path += 'res/interface/';
                break;

            case '/progroup/p/res/':
                path += 'interface/';
                break;

            case '/progroup/p/res/interface/detail/':
                path += 'req/';
                break;

            case '/progroup/search/':
                path += 'group/';
                break;

            case '/test/':
                path += 'group/create/';
                break;

            case '/test/record/':
                path += 'create/';
                break;

            case '/test/group/':
                path += 'create/';
                break;

            default:
                break;
        }
        return path;
    };
    // export regist api
    _p._$regist = _m._$regist;
},'5e5afc6c5ab9a60e963a7e2e41706b91','ae709ce8ba298e2050e36c803ec1095e','993671841dcf289096c7171d53130309');
I$('ec521e4e62dbac49438faa1e9a253744',function (NEJ,_v,_u,_g,_j,_t,_p,_o,_f,_r){
    /**
     * 使用REST进行数据交互接口
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/event',
     *     'util/ajax/rest'
     * ],function(_v,_j){
     *     // 通用错误处理，所有请求异常均会调用此回调处理
     *     _v._$addEvent(
     *         window,'resterror',function(_error){
     *             // _error.code
     *             // _error.message
     *             // _error.data
     *             // 通过设置_error.stopped阻止事件回调到请求的onerror中
     *         }
     *     );
     *
     *     var url = "http://a.b.com/rest/list";
     *     var opt = {
     *          param:{brand:'nokia',model:'9'},
     *          data:'123',
     *          method:'post',
     *          onload:function(_data){
     *              // 请求正常回调
     *          },
     *          onerror:function(_error){
     *              // _error.code
     *              // _error.message
     *              // _error.data
     *              // 如果window的resterror回调中stopped了事件则不会进入此回调
     *          },
     *          onbeforerequest:function(_event){
     *              // _event.request
     *              // _event.headers
     *          }
     *     }
     *     _j._$request(url,opt);
     * });
     * ```
     *
     * @method module:util/ajax/rest._$request
     * @param    {String}  arg0 - 请求地址
     * @param    {Object}  arg1 - 可选配置参数
     * @property {Boolean}  sync    - 是否同步请求
     * @property {Variable} data    - 要发送的数据
     * @property {Object}   param   - 请求参数,包括模板地址里使用的参数
     * @property {String}   method  - 请求方式,GET/POST/PUT/DELETE
     * @property {Number}   timeout - 超时时间,0 禁止超时监测
     * @property {Object}   headers - 头信息，标准HTTP头字段
     * @property {Object}   result  - onload回调输入时需包含的额外信息
     *
     * @property {module:util/ajax/xdr.onload} onload   - 请求载入成功回调
     * @property {module:util/ajax/xdr.onerror} onerror - 请求载入失败回调
     * @property {module:util/ajax/xdr.onbeforerequest} onbeforerequest - 发起请求之前回调
     *
     * @return   {String} 请求标识
     */
    _p._$request = (function(){
        var _cache = {},  // request cache - sn:{s:funciton(){},f:function(){}}
            _reg0 = /\{(.*?)\}/gi,
            _reg1 = /^get|delete|head$/i,
            _jsn = /json/i,
            _xml = /xml/i;
        // clear request
        var _doClear = function(_key){
            var _request = _cache[_key];
            if (!_request) return;
            delete _request.s;
            delete _request.f;
            delete _cache[_key];
        };
        // request callback
        var _doCallback = function(_key,_type){
            var _request = _cache[_key];
            if (!_request) return;
            var _callback = _request[_type],
                _args = _r.slice.call(arguments,2);
            try{
                (_callback||_f).apply(null,_args);
            }catch(ex){
                // ignore
                if (DEBUG) throw ex;
                console.error(ex.message);
                console.error(ex);
            }
            _doClear(_key);
        };
        // request success
        var _onLoad = function(_key,_data){
            _doCallback(_key,'s',_data);
        };
        // request error
        var _onError = function(_key,_error){
            _error = _error||{};
            // status 204 is ok
            if (_error.code==_g._$CODE_ERRSERV&&
                _error.data==204){
                _onLoad(_key,null);
                return;
            }
            // do error filter
            // set error attr stopped=!0 will stop request error callback
            _v._$dispatchEvent(
                window,'resterror',_error
            );
            if (!!_error.stopped){
                _doClear(_key);
                return;
            }
            // do request fail callback
            _doCallback(_key,'f',_error);
        };
        // check default headers
        var _doCheckWithDefault = function(_headers,_key,_default){
            var _value = _headers[_key]||
                         _headers[_key.toLowerCase()];
            if (!_value){
                _value = _default;
                _headers[_key] = _value;
            }
            return _value;
        };
        // pre convert array
        var _doCheckData = function(_data,_key,_map){
            if (_u._$isArray(_data)){
                _map[_key] = JSON.stringify(_data);
            }
        };
        return function(_url,_options){
            _options = _u._$merge({},_options);
            var _exist = {},
                _param = _options.param||_o;
            // parse uri template
            _url = _url.replace(_reg0,function($1,$2){
                var _value = _param[$2];
                if (_value!=null) _exist[$2] = !0;
                return encodeURIComponent(_value||'')||$1;
            });
            // parse remain param
            var _data = _options.data||{};
            _u._$loop(
                _param,function(_value,_key){
                    if (!_exist[_key]){
                        _data[_key] = _value;
                    }
                }
            );
            // parse headers
            var _type = 'text',
                _headers = _options.headers||{},
                _accept  = _doCheckWithDefault(_headers,'Accept','application/json'),
                _content = _doCheckWithDefault(_headers,'Content-Type','application/json');
            // response data format
            if (_jsn.test(_accept)){
                _type = 'json';
            }else if(_xml.test(_accept)){
                _type = 'xml';
            }
            // do request
            var _key = _u._$uniqueID();
            _cache[_key] = {
                s:_options.onload||_f,
                f:_options.onerror||_f
            };
            // add params to url with GET/HEAD/DELETE method
            _options.method = _options.method||'GET';
            if (_reg1.test(_options.method.trim())){
                _u._$forIn(_data,_doCheckData);
                _options.query = _data;
                _data = null;
            }else if (_jsn.test(_content)){
                _data = JSON.stringify(_data);
            }
            _options.type    = _type;
            _options.data    = _data;
            _options.headers = _headers;
            _options.onload  = _onLoad._$bind(null,_key);
            _options.onerror = _onError._$bind(null,_key);
            return _j._$request(_url,_options);
        };
    })();
    /**
     * 中断请求
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/rest'
     * ],function(_j){
     *     var _id = _j._$request(
     *         'http://123.163.com/rest/add',{
     *             method:'POST',
     *             data:{name:'ABC'},
     *             timeout:60000,
     *             onload:function(_data){
     *                 // TODO
     *             },
     *             onerror:function(_error){
     *                 // TODO
     *             }
     *         }
     *     );
     *     // 1秒后中断掉这个请求
     *     window.setTimeout(
     *         function(){
     *             _j._$abort(_id);
     *         },1000
     *     );
     * });
     * ```
     *
     * @method module:util/ajax/rest._$abort
     * @param  {String} arg0 - 请求标识
     * @return {Void}
     */
    _p._$abort = function(_sn){
        _j._$abort(_sn);
    };
    /**
     * 通用载入出错回调函数，所有REST请求的异常均会进入此事件的回调逻辑中
     *
     * @event    external:window.onresterror
     * @param    {Object}   event   - 错误信息
     * @property {Number}   code    - 错误代码
     * @property {String}   message - 错误描述
     * @property {Variable} data    - 出错时携带数据
     * @property {Boolean}  stopped - 是否阻止单个请求中的onerror回调
     */
    _t._$$CustomEvent._$allocate({
        element:window,
        event:'resterror'
    });

    if (CMPT){
        NEJ.P('nej.j')._$requestByREST = _p._$request;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','036fce036df53014afe007bfc84b3324','19b4ef9670142281a6ff17ec75864bee','8717e18cf0d38e654531116f64f5593d');
I$('047b1ac18d0fbb4b16ed0a3cbd00345b',function (_p,_o,_f,_r){
    /**
     * 取缓存信息
     * @param  {String} 缓存标识
     * @return {String} 缓存信息
     */
    _p.__getItemInStorage = function(_key){
        return localStorage.getItem(_key);
    };
    /**
     * 设置缓存信息
     * @param  {String} 缓存标识
     * @param  {String} 缓存信息
     * @return {Void}
     */
    _p.__setItemToStorage = function(_key,_value){
        localStorage.setItem(_key,_value);
    };
    /**
     * 删除缓存信息
     * @param  {String} 缓存标识
     * @return {Void}
     */
    _p.__removeItemFromStorage = function(_key){
        localStorage.removeItem(_key);
    };
    /**
     * 清除缓存
     * @return {Void}
     */
    _p.__clearStorage = function(){
        localStorage.clear();
    };
    /**
     * 初始化本地存储系统
     * @return {Void}
     */
    _p.__initStorage = function(){
        (document.onstorageready||_f)();
    };
    /**
     * 检测本地存储系统是否准备完毕
     * @return {Boolean} 是否准备完毕
     */
    _p.__isStorageReady = function(){
        return !0;
    };

    return _p;
});
I$('2ec2269bfde74e6733af80ddc50eb370',function(b1490930308065,_v,_h,_p,_o,_f,_r){if (b1490930308065._$KERNEL.engine==='trident'&&b1490930308065._$KERNEL.release<='3.0'){I$(33,function (_c,_e){
        var _localStorage;
        /*
         * 初始化本地存储系统
         * @return {Void}
         */
        var _doInitFlash = function(){
            if (!!_localStorage) return;
            // append storage flash
            _e._$flash({
                hidden:!0,
                src:_c._$get('storage.swf'),
                params:{
                    AllowScriptAccess:'sameDomain'
                },
                onready:function(_flash){
                    if (!_flash){
                        console.log('flash for localStorage unavailable');
                    }else{
                        _localStorage = _flash;
                        _localStorage.initStorage('nej-storage');
                    }
                    _v._$dispatchEvent(document,'storageready');
                }
            });
        };
        /**
         * 取缓存信息
         * @param  {String} 缓存标识
         * @return {String} 缓存信息
         */
        _h.__getItemInStorage = function(_key){
            if (!!_localStorage){
                return _localStorage.getItem(_key);
            }
        };
        /**
         * 设置缓存信息
         * @param  {String} 缓存标识
         * @param  {String} 缓存信息
         * @return {Void}
         */
        _h.__setItemToStorage = function(_key,_value){
            if (!!_localStorage){
                _localStorage.setItem(_key,_value);
            }
        };
        /**
         * 删除缓存信息
         * @param  {String} 缓存标识
         * @return {Void}
         */
        _h.__removeItemFromStorage = function(_key){
            if (!!_localStorage){
                _localStorage.removeItem(_key);
            }
        };
        /**
         * 清除缓存
         * @return {Void}
         */
        _h.__clearStorage = function(){
            if (!!_localStorage){
                _localStorage.clear();
            }
        };
        /**
         * 初始化本地存储系统
         * @return {Void}
         */
        _h.__initStorage = function(){
            _doInitFlash();
        };
        /**
         * 检测本地存储系统是否准备完毕
         * @return {Boolean} 是否准备完毕
         */
        _h.__isStorageReady = function(){
            return !!_localStorage;
        };
    },'75482afbe8186c6aea54c5752fc62e9f','1ef516cd8b268c36e031e36d3e0c9771');}return _h;},'345f1460138e362bb33cc48ffc7cd12b','b9845e13e284410cb0bb909f737020e4','047b1ac18d0fbb4b16ed0a3cbd00345b');
I$('8f16063d4ebdd43d235cb3fa10b4a2df',function (NEJ,_u,_v,_t,_j,_h,_p,_o,_f,_r){
    var _cache = {}; // dirty flag
    /**
     * 初始化低版本浏览器本地缓存
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/cache/storage'
     * ],function(_j){
     *     // 如果需要支持ie7-浏览器先执行一下初始行为
     *     _j._$init();
     *     // 设置一个hash值
     *     _j._$setDataInStorage('name','jack');
     *     // 返回jack
     *     var _data = _j._$getDataInStorage('name');
     * });
     * ```
     *
     * @method module:util/cache/storage._$init
     * @return {Void}
     */
    _p._$init = (function(){
        var inited = !1;
        return function(){
            if (inited){
                return;
            }
            inited = !0;
            // listen storage ready
            var __doFlushTempData = (function(){
                var _doFlush = function(_value,_key,_map){
                    _h.__setItemToStorage(
                        _key,JSON.stringify(_value));
                    delete _map[_key];
                };
                return function(){
                    _u._$loop(_cache,_doFlush);
                };
            })();
            _v._$addEvent(
                document,'storageready',
                __doFlushTempData
            );
            // init storage
            _h.__initStorage();
        };
    })();
    /**
     * å­˜å‚¨æ•°æ®
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/cache/storage'
     * ],function(_j){
     *     // è®¾ç½®ä¸€ä¸ªhashå€¼
     *     _j._$setDataInStorage('name','jack');
     *     // è¿”å›žjack
     *     var _data = _j._$getDataInStorage('name');
     * });
     * ```
     *
     * @method module:util/cache/storage._$setDataInStorage
     * @see    module:util/cache/storage._$getDataInStorage
     * @param  {String}   arg0 - å­˜å‚¨é”®å€¼
     * @param  {Variable} arg1 - å­˜å‚¨æ•°æ®
     * @return {Void}
     */
    _p._$setDataInStorage = function(_key,_value){
        _p._$init();
        var _sval = JSON.stringify(_value);
        try{
            _h.__setItemToStorage(_key,_sval);
        }catch(ex){
            console.error(ex.message);
            console.error(ex);
        }
        // set failed
        if (_sval!=_h.__getItemInStorage(_key)){
            _cache[_key] = _value;
        }
    };
    /**
     * å–å­˜å‚¨æ•°æ®
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/cache/storage'
     * ],function(_j){
     *     // è®¾ç½®ä¸€ä¸ªhashå€¼
     *     _j._$setDataInStorage('name','jack');
     *     // è¿”å›žjack
     *     var _data = _j._$getDataInStorage('name');
     * });
     * ```
     *
     * @method module:util/cache/storage._$getDataInStorage
     * @see    module:util/cache/storage._$setDataInStorage
     * @param  {String}   arg0 - å­˜å‚¨é”®å€¼
     * @return {Variable}        å­˜å‚¨æ•°æ®
     */
    _p._$getDataInStorage = function(_key){
        _p._$init();
        var _data = JSON.parse(
            _h.__getItemInStorage(_key)||'null'
        );
        return _data==null?_cache[_key]:_data;
    };
    /**
     * å–å­˜å‚¨æ•°æ®ï¼Œå¦‚æžœæŒ‡å®šçš„æ•°æ®ä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®åˆå§‹åŒ–
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/cache/storage'
     * ],function(_j){
     *     // å–keyä¸ºnameçš„å€¼ï¼Œæ²¡æœ‰åˆ™è®¾ç½®ä¸€ä¸ªkeyä¸ºnameï¼Œvalueä¸ºjackçš„å€¼
     *     var _data = _j._$getDataInStorageWithDefault('name','jack');
     * });
     * ```
     *
     * @method module:util/cache/storage._$getDataInStorageWithDefault
     * @see    module:util/cache/storage._$setDataInStorage
     * @see    module:util/cache/storage._$getDataInStorage
     * @param  {String}   arg0 - å­˜å‚¨é”®å€¼
     * @param  {Variable} arg1 - å­˜å‚¨æ•°æ®
     * @return {Variable}        å­˜å‚¨æ•°æ®
     */
    _p._$getDataInStorageWithDefault = function(_key,_value){
        var _data = _p._$getDataInStorage(_key);
        if (_data==null){
            _data = _value;
            _p._$setDataInStorage(_key,_data);
        }
        return _data;
    };
    /**
     * åˆ é™¤æœ¬åœ°å­˜å‚¨æ•°æ®
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       'util/cache/storage'
     *   ],function(_j){
     *       _j._$setDataInStorage('name','jack');
     *       // åˆ é™¤keyä¸ºnameçš„hashå€¼
     *       _j._$delDataInStorage('name');
     *   });
     * ```
     *
     * @method module:util/cache/storage._$delDataInStorage
     * @param  {String} arg0 - å­˜å‚¨é”®å€¼
     * @return {Void}
     */
    _p._$delDataInStorage = function(_key){
        _p._$init();
        delete _cache[_key];
        _h.__removeItemFromStorage(_key);
    };
    /**
     * æ¸…é™¤æœ¬åœ°ç¼“å­˜
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'util/cache/storage'
     * ],function(_p){
     *     _p._$setDataInStorage('name','jack');
     *     // æ¸…ç©ºæ‰€æœ‰hashå€¼
     *     _p._$clearDataInStorage();
     * });
     * ```
     *
     * @method module:util/cache/storage._$clearDataInStorage
     * @return {Void}
     */
    _p._$clearDataInStorage = (function(){
        var _doRemove = function(_item,_key,_map){
            delete _map[_key];
        };
        return function(){
            _p._$init();
            _u._$loop(_cache,_doRemove);
            _h.__clearStorage();
        };
    })();
    /**
     * æŒä¹…åŒ–å­˜å‚¨å™¨å‡†å¤‡å®Œæ¯•è§¦å‘äº‹ä»¶ï¼Œ
     * å¦‚æžœå­˜å‚¨å™¨å·²å‡†å¤‡å®Œæ¯•åˆ™åœ¨æ·»åŠ äº‹ä»¶æ—¶ç›´æŽ¥è§¦å‘å›žè°ƒ
     *
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'base/event'
     *     'util/cache/storage'
     * ],function(_v,_j){
     *     // ç›´æŽ¥è°ƒç”¨æŽ¥å£å­˜å‚¨æ•°æ®åœ¨ä½Žç‰ˆæœ¬æµè§ˆå™¨ä¸‹æœªèƒ½ä¿è¯æŒä¹…åŒ–æˆåŠŸ
     *     // å¦‚æžœæ­¤æ—¶æŒä¹…åŒ–å­˜å‚¨å™¨æœªå‡†å¤‡å®Œæ¯•åˆ™å…ˆç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œç­‰æŒä¹…åŒ–å­˜å‚¨å™¨å‡†å¤‡å¥½åŽå†æŒä¹…åŒ–
     *     _j._$setDataInStorage('name','jack');
     *
     *     // åœ¨æŒä¹…åŒ–å­˜å‚¨å™¨å‡†å¤‡å®Œæ¯•äº‹ä»¶ä¸­å­˜å‚¨æ•°æ®å¯æé«˜æŒä¹…åŒ–æˆåŠŸæ¦‚çŽ‡
     *     _v._$addEvent(
     *         document,'storageready',
     *         function(_event){
     *             _j._$setDataInStorage('name','jack');
     *         }
     *     );
     * });
     * ```
     *
     * @event    external:document.onstorageready
     * @param    {Object} event - äº‹ä»¶ä¿¡æ¯
     */
    _t._$$CustomEvent._$allocate({
        element:document,
        event:'storageready',
        oneventadd:function(){
            if (_h.__isStorageReady()){
                _v._$dispatchEvent(document,'storageready');
            }
        }
    });

    if (CMPT){
        NEJ.copy(NEJ.P('nej.j'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','2893fe4191b99bbcb2db10b5332d9654','2ec2269bfde74e6733af80ddc50eb370');
I$('51f7c7841c9e3d8e70dbe12bc0a175a1',function (NEJ,_k,_u,_t,_j,_p,_o,_f,_r){
    var _pro,
        _ckey = 'dat-'+(+new Date);
    /**
     * ç¼“å­˜å¯¹è±¡åŸºç±»
     * 
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'util/ajax/xdr',
     *     'util/cache/cache'
     * ],function(_k,_j,_t,_p){
     *     var _pro;
     * 
     *     _p._$$CacheCustom = _k._$klass();
     *     _pro = _p._$$CacheCustom._$extend(_t._$$CacheAbstract);
     * 
     *     // å–ç¼“å­˜æ•°æ®ï¼Œå…ˆä»Žå†…å­˜ä¸­å–ï¼Œæ²¡æœ‰ä»ŽæœåŠ¡å™¨ä¸Šå–
     *     _pro._$getDataInCache = function(_key){
     *         this.__setDataInCache(_key,_value);
     *     };
     * 
     *     // å–æ•°æ®
     *     _pro._$getData = function(_key){
     *         var _data = this._$getDataInCache(_key);
     *         // æ•°æ®å·²åœ¨ç¼“å­˜ä¸­
     *         if (_data!=null){
     *             this._$dispatchEvent('ondataload',{
     *                 key:_key
     *             });
     *             return;
     *         }
     *         // ä»ŽæœåŠ¡å™¨ç«¯è½½å…¥æ•°æ®
     *         // rkeyä¸ºè¯·æ±‚å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥æ˜¯URLï¼Œä¹Ÿå¯ä»¥æ˜¯æŸç§ç®—æ³•çš„ç»“æžœ
     *         var _rkey = this.__doGenReqKey(_key), 
     *             _callback = this._$dispatchEvent._$bind(
     *                 this,'ondataload',{key:_key}
     *             );
     *         if (!this.__doQueueRequest(_rkey,_callback)){
     *             _j._$request({
     *                 onload:function(_data){
     *                     // ç¼“å­˜æ•°æ®
     *                     this.__setDataInCache(_key,_data);
     *                     // è§¦å‘é˜Ÿåˆ—ä¸­åŒè¯·æ±‚çš„å›žè°ƒé€»è¾‘
     *                     this.__doCallbackRequest(_rkey);
     *                 }._$bind(this)
     *             });
     *         }
     *     };
     * 
     *     return _p;
     * });
     * ```
     * 
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     *   NEJ.define([
     *       '/path/to/custom/cache.js'
     *   ],function(_p){
     *       // ä½¿ç”¨Cache
     *       var _cache = _p._$$CacheCustom._$allocate({
     *           ondataload:function(_event){
     *               // get data in cache
     *               var _data = this._$getDataInCache(_event.key);
     *               // TODO 
     *           }
     *       });
     *       // ç¬¬ä¸€ä¸ªè¯·æ±‚
     *       _cache._$getData('a');
     *       // ç¬¬äºŒä¸ªè¯·æ±‚
     *       _cache._$getData('b');ã€
     *       // ä¸ä¼šå‘è¯·æ±‚ï¼Œç›´æŽ¥èµ°ç¼“å­˜
     *       _cache._$getData('a');
     *   });
     * ```
     * 
     * @class   module:util/cache/cache._$$CacheAbstract 
     * @extends module:util/event._$$EventTarget
     * 
     * @param   {Object} config - é…ç½®å‚æ•°
     */
    _p._$$CacheAbstract = _k._$klass();
    _pro = _p._$$CacheAbstract._$extend(_t._$$EventTarget);
    /**
     * åˆå§‹åŒ–å‡½æ•°
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        this.__cache = this.constructor[_ckey];
        if (!this.__cache){
            this.__cache = {};
            // request loading information
            this.__cache[_ckey+'-l'] = {};
            this.constructor[_ckey] = this.__cache;
        }
    };
    /**
     * æŽ§ä»¶é”€æ¯
     *
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__doClearReqFromQueue();
        this.__super();
    };
    /**
     * ä»Žç¼“å­˜ä¸­å–æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__getDataInCache
     * @param  {String}   arg0 - ç¼“å­˜é”®å€¼
     * @return {Variable}        ç¼“å­˜æ•°æ®
     */
    _pro.__getDataInCache = function(_key){
        return this.__cache[_key];
    };
    /**
     * æ•°æ®å­˜å…¥ç¼“å­˜
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__setDataInCache
     * @param  {String}   arg0 - ç¼“å­˜é”®å€¼
     * @param  {Variable} arg1 - ç¼“å­˜æ•°æ®
     * @return {Void}
     */
    _pro.__setDataInCache = function(_key,_value){
        this.__cache[_key] = _value;
    };
    /**
     * å¸¦é»˜è®¤å€¼å–æœ¬åœ°æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__getDataInCacheWithDefault
     * @param  {String}   arg0 - é”®å€¼
     * @param  {Variable} arg1 - é»˜è®¤å€¼
     * @return {Void}
     */
    _pro.__getDataInCacheWithDefault = function(_key,_default){
        var _data = this.__getDataInCache(_key);
        if (_data==null){
            _data = _default;
            this.__setDataInCache(_key,_data);
        }
        return _data;
    };
    /**
     * åˆ é™¤ç¼“å­˜æ•°æ®ï¼Œä¸ä¼ é”®å€¼åˆ™æ¸…é™¤æ‰€æœ‰ç¼“å­˜
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__delDataInCache
     * @param  {String} arg0 - ç¼“å­˜é”®å€¼
     * @return {Void}
     */
    _pro.__delDataInCache = function(_key){
        if (_key!=null){
            delete this.__cache[_key];
            return;
        }
        _u._$loop(
            this.__cache,function(_item,_key){
                if (_key!=(_ckey+'-l')){
                    this.__delDataInCache(_key);
                }
            },this
        );
    };
    /**
     * ä»Žæœ¬åœ°å­˜å‚¨ä¸­åˆ é™¤æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__delDataInStorage
     * @param  {String} arg0 - å­˜å‚¨é”®å€¼
     * @return {String}        å­˜å‚¨æ•°æ®
     */
    _pro.__delDataInStorage = function(_key){
        return _j._$delDataInStorage(_key);
    };
    /**
     * ä»Žæœ¬åœ°å­˜å‚¨ä¸­å–æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__getDataInStorage
     * @param  {String} arg0 - å­˜å‚¨é”®å€¼
     * @return {String}        å­˜å‚¨æ•°æ®
     */
    _pro.__getDataInStorage = function(_key){
        return _j._$getDataInStorage(_key);
    };
    /**
     * æ•°æ®å­˜å…¥æœ¬åœ°ç¼“å­˜
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__setDataInStorage
     * @param  {String}   arg0 - å­˜å‚¨é”®å€¼
     * @param  {Variable} arg1 - å­˜å‚¨æ•°æ®
     * @return {Void}
     */
    _pro.__setDataInStorage = function(_key,_value){
        _j._$setDataInStorage(_key,_value);
    };
    /**
     * å¸¦é»˜è®¤å€¼å–æœ¬åœ°æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__getDataLocalWithDefault
     * @param  {String}   arg0 - é”®å€¼
     * @param  {Variable} arg1 - é»˜è®¤å€¼
     * @return {Variable}        æ•°æ®
     */
    _pro.__getDataLocalWithDefault = function(_key,_default){
        var _data = this.__getDataLocal(_key);
        if (_data==null){
            _data = _default;
            this.__setDataLocal(_key,_data);
        }
        return _data;
    };
    /**
     * å–æœ¬åœ°æ•°æ®,æ£€æµ‹å†…å­˜å’Œæœ¬åœ°å­˜å‚¨
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__getDataLocal
     * @param  {String}   arg0 - é”®å€¼
     * @return {Variable}        æ•°æ®
     */
    _pro.__getDataLocal = function(_key){
        // get from memory
        var _data = this.__getDataInCache(_key);
        if (_data!=null){
            return _data;
        }
        // get from storage
        _data = this.__getDataInStorage(_key);
        if (_data!=null){
            this.__setDataInCache(_key,_data);
        }
        return _data;
    };
    /**
     * å­˜æœ¬åœ°æ•°æ®
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__setDataLocal
     * @param  {String}   arg0 - é”®å€¼
     * @param  {Variable} arg1 - æ•°æ®
     * @return {Void}
     */
    _pro.__setDataLocal = function(_key,_value){
        this.__setDataInStorage(_key,_value);
        this.__setDataInCache(_key,_value);
    };
    /**
     * æ¸…é™¤æœ¬åœ°ç¼“å­˜ï¼Œä¸ä¼ é”®å€¼åˆ™æ¸…é™¤æ‰€æœ‰ç¼“å­˜
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__delDataLocal
     * @param  {String} arg0 - ç¼“å­˜é”®å€¼
     * @return {Void}
     */
    _pro.__delDataLocal = function(_key){
        if (_key!=null){
            delete this.__cache[_key];
            _j._$delDataInStorage(_key);
            return;
        }
        _u._$loop(
            this.__cache,function(_item,_key){
                if (_key!=(_ckey+'-l')){
                    this.__delDataLocal(_key);
                }
            },this
        );
    };
    /**
     * æ¸…é™¤ç¼“å­˜æ•°æ®
     * 
     * è„šæœ¬ä¸¾ä¾‹
     * ```javascript
     * var _cache = new c._$$CacheAbstract();
     * j._$clearDataLocal('name','jack');
     * // æ¸…ç©ºæ‰€æœ‰hashå€¼
     * j._$clearDataInStorage();
     * ```
     * 
     * @method module:util/cache/cache._$$CacheAbstract#_$clearDataLocal
     * @return {Void}
     */
    _pro._$clearDataLocal = function(){
        this.__delDataLocal();
    };
    /**
     * è¯·æ±‚å›žè°ƒ
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__doCallbackRequest
     * @param  {String} arg0 - è¯·æ±‚æ ‡è¯†
     * @return {Void}
     */
    _pro.__doCallbackRequest = function(_key){
        var _data = this.__cache[_ckey+'-l'],
            _args = _r.slice.call(arguments,1);
        _u._$forEach(
            _data[_key],function(_callback){
                try{
                    _callback.apply(this,_args);
                }catch(ex){
                    // ignore
                    if (DEBUG) throw ex;
                    console.error(ex.message);
                    console.error(ex.stack);
                }
            }
        );
        delete _data[_key];
    };
    /**
     * 锁定请求，同样的请求只发送一次
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__doQueueRequest
     * @param  {String}   arg0 - 请求标识
     * @param  {Function} arg1 - 请求回调
     * @return {Boolean}         是否已存在相同请求
     */
    _pro.__doQueueRequest = function(_key,_callback){
        // cache to clear list
        if (!this.__qtmp){
            this.__qtmp = [];
        }
        this.__qtmp.push({
            key:_key,
            callback:_callback
        });
        // check request queue list
        _callback = _callback||_f;
        var _list = this.__cache[_ckey+'-l'][_key];
        if (!_list){
            _list = [_callback];
            this.__cache[_ckey+'-l'][_key] = _list;
            return !1;
        }
        _list.push(_callback);
        return !0;
    };
    /**
     * 从请求队列中移除回调
     *
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__doClearReqFromQueue
     * @return {Void}
     */
    _pro.__doClearReqFromQueue = function(){
        _u._$forEach(this.__qtmp,function(it){
            var _xlist = this.__cache[_ckey+'-l'][it.key];
            _u._$reverseEach(
                _xlist,function(item,index,list){
                    if (item===it.callback){
                        list.splice(index);
                    }
                }
            );
            if (!_xlist||!_xlist.length){
                this.__doClearReqQueue(it.key);
            }
        },this);
        delete this.__qtmp;
    };
    /**
     * 清除锁定请求
     *
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__doClearReqQueue
     * @param  {String}   arg0 - 请求标识
     * @return {Void}
     */
    _pro.__doClearReqQueue = function(_key){
        delete this.__cache[_ckey+'-l'][_key];
    };
    /**
     * 检测列表中是否已存在指定片段数据
     * 
     * @protected
     * @method module:util/cache/cache._$$CacheAbstract#__hasFragment
     * @param  {Array}   arg0 - 列表
     * @param  {Number}  arg1 - 偏移量
     * @param  {Number}  arg2 - 数量，0表示全列表，默认为0
     * @return {Boolean}        是否已经存在
     */
    _pro.__hasFragment = function(_list,_offset,_limit){
        if (!_list) return !1;
        _offset = parseInt(_offset)||0;
        _limit  = parseInt(_limit)||0;
        if (!_limit){
            if (!_list.loaded){
                return !1;
            }
            _limit = _list.length;
        }
        // length is list total number
        if (!!_list.loaded){
            _limit = Math.min(_limit,_list.length-_offset);
        }
        for(var i=0;i<_limit;i++){
            if (_list[_offset+i]===undefined){
                return !1;
            }
        }
        return !0;
    };
    /**
     * 判断列表指定片段是否填充满的
     *
     * @method module:util/cache/cache._$$CacheAbstract#_$isFragmentFilled
     * @param  {Array}   arg0 - 列表标识
     * @param  {Number}  arg1 - 偏移量
     * @param  {Number}  arg2 - 数量，0表示全列表，默认为0
     * @return {Boolean}        是否已经存在
     */
    _pro._$isFragmentFilled = function(_key,_offset,_limit){
        return this.__hasFragment(
            this._$getListInCache(_key),
            _offset,_limit
        );
    };
    
    if (CMPT){
        NEJ.P('nej.ut')._$$Cache = _p._$$CacheAbstract;
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0','8f16063d4ebdd43d235cb3fa10b4a2df');
I$('7e9128286db9a86efde148ece05b9aa0',function (NEJ,_k,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 列表缓存管理器
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/ajax/xdr',
     *     'util/cache/list'
     * ],function(_j,_t){
     *     var _cache = _t._$$CacheList._$allocate({
     *         id:'abc',
     *         doloadlist:function(_options){
     *             // 从服务器加载列表
     *             _j._$request(
     *                 '/api/list',{
     *                     data:_options.data,
     *                     onload:function(_list){
     *                         _options.onload(_list);
     *                     }
     *                 }
     *             );
     *         },
     *         doloaditem:function(_options){
     *             // 从服务器加载数据项
     *             _j._$request(
     *                 '/api/get',{
     *                     data:_options.data,
     *                     onload:function(_item){
     *                         _options.onload(_item);
     *                     }
     *                 }
     *             );
     *         },
     *         doadditem:function(_options){
     *             // 往服务器添加数据项
     *             _j._$request(
     *                 '/api/add',{
     *                     data:_options.data,
     *                     onload:function(_item){
     *                         _options.onload(_item);
     *                     }
     *                 }
     *             );
     *         },
     *         dodeleteitem:function(_options){
     *             // 从服务器删除数据项
     *             _j._$request(
     *                 '/api/delete',{
     *                     data:_options.data,
     *                     onload:function(_item){
     *                         _options.onload(_item);
     *                     }
     *                 }
     *             );
     *         },
     *         doupdateitem:function(_options){
     *             // 更新数据项至服务器
     *             _j._$request(
     *                 '/api/update',{
     *                     data:_options.data,
     *                     onload:function(_item){
     *                         _options.onload(_item);
     *                     }
     *                 }
     *             );
     *         },
     *         dopullrefresh:function(_options){
     *             // 从服务器加载列表
     *             _j._$request(
     *                 '/api/pull',{
     *                     data:_options.data,
     *                     onload:function(_list){
     *                         _options.onload(_list);
     *                     }
     *                 }
     *             );
     *         }
     *     });
     *
     *     // 第一个列表的请求
     *     _cache._$getList({key:'abc',data:{},offset:0,limit:10})
     *     // 不会发请求，直接走缓存
     *     _cache._$getList({key:'abc',data:{},offset:0,limit:10})
     *     // 第一个项请求
     *     _cache._$getItem({id:'abc',key:'123',data:{})
     *     // 不会发请求，直接走缓存
     *     _cache._$getItem({id:'abc',key:'123',data:{})
     * });
     * ```
     *
     * @class   module:util/cache/list._$$CacheList
     * @extends module:util/cache/cache._$$CacheAbstract
     *
     * @param    {Object}  config  - 可选配置参数
     * @property {String}  id      - 缓存标识，默认使用构造器缓存
     * @property {String}  key     - 列表项标识字段，默认为id
     * @property {Object}  data    - 列表关联数据
     * @property {Boolean} autogc  - 是否自动操作
     */
    /**
     * 列表载入完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onlistload
     * @param    {Object}   event - 可选配置参数
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 缓存项载入完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onitemload
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 缓存项添加完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onitemadd
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 缓存项删除完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onitemdelete
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 缓存项更新完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onitemupdate
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 服务器最新列表拉取完成回调
     * 
     * @event    module:util/cache/list._$$CacheList#onpullrefresh
     * @param    {Object}   event - 可选配置参数
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /**
     * 从服务器载入列表
     * 
     * @event    module:util/cache/list._$$CacheList#doloadlist
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {Number}   data   - 需要提交到服务器的其他信息
     * @property {Number}   offset - 偏移量
     * @property {Number}   limit  - 数量
     * @property {Function} onload - 请求回调
     */
    /**
     * 从服务器载入数据项
     * 
     * @event    module:util/cache/list._$$CacheList#doloaditem
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   id     - 项标识
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {Number}   data   - 需要提交到服务器的其他信息
     * @property {Function} onload - 请求回调
     */
    /**
     * 往服务器添加数据项
     * 
     * @event    module:util/cache/list._$$CacheList#doadditem
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {String}   data   - 数据项对象
     * @property {Function} onload - 请求回调
     */
    /**
     * 从服务器删除数据项
     * 
     * @event    module:util/cache/list._$$CacheList#dodeleteitem
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {String}   data   - 数据项对象
     * @property {Function} onload - 请求回调
     */
    /**
     * 更新服务器数据项
     * 
     * @event    module:util/cache/list._$$CacheList#doupdateitem
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {String}   data   - 数据项对象
     * @property {Function} onload - 请求回调
     */
    /**
     * 从服务器拉取最新列表
     * 
     * @event    module:util/cache/list._$$CacheList#dopullrefresh
     * @param    {Object}   event  - 可选配置参数
     * @property {String}   key    - 列表标识
     * @property {Variable} ext    - 回调回传数据
     * @property {Function} onload - 请求回调
     */
    _p._$$CacheList = _k._$klass();
    _pro = _p._$$CacheList._$extend(_t._$$CacheAbstract);
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__key = _options.key||'id';
        this.__data = _options.data||_o;
        this.__auto = !!_options.autogc;
        this.__doSwapCache(_options.id);
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__destroy
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        // check gc schedule
        if (!!this.__timer){
            this.__doGCAction();
        }
    };
    /**
     * 切换缓存
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doSwapCache
     * @param  {String} arg0 - 缓存标识
     * @return {Void}
     */
    _pro.__doSwapCache = function(_id){
        var _cache;
        if (!!_id){
            _cache = this.__cache[_id];
            if (!_cache){
                _cache = {};
                this.__cache[_id] = _cache;
            }
        }
        _cache = _cache||this.__cache;
        _cache.hash = _cache.hash||{};
        // hash    [Object] - item map by id
        // list    [Array]  - default list
        // x-list  [Array]  - list with key 'x'
        this.__lspl = _cache;
    };
    /**
     * 执行GC行为
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doGCAction
     * @return {Void}
     */
    _pro.__doGCAction = function(){
        this.__timer = window.clearTimeout(this.__timer);
        // dump id map for used items
        var _map = {};
        _u._$loop(
            this.__lspl,function(_list,_key){
                if (_key=='hash') return;
                if (!_u._$isArray(_list)) return;
                _u._$forEach(_list,function(_item){
                    if (!_item) return;
                    _map[_item[this.__key]] = !0;
                },this);
            },this
        );
        // check used in hash
        _u._$loop(
            this.__getHash(),
            function(_item,_id,_hash){
                if (!_map[_id]){
                    delete _hash[_id];
                }
            }
        );
    };
    /**
     * 调度执行GC操作，删除不用的数据对象
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doGCSchedule
     * @return {Void}
     */
    _pro.__doGCSchedule = function(){
        if (!!this.__timer){
            this.__timer = window.clearTimeout(this.__timer);
        }
        this.__timer = window.setTimeout(
            this.__doGCAction._$bind(this),150
        );
    };
    /**
     * 缓存列表项
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doSaveItemToCache
     * @param  {Object|Array} arg0 - 列表项或列表
     * @param  {String}       arg1 - 列表标识
     * @return {Object|Array}        缓存中列表项或列表
     */
    _pro.__doSaveItemToCache = function(_item,_lkey){
        // save item to cache
        if (!_u._$isArray(_item)){
            _item = this.__doFormatItem(_item,_lkey)||_item;
            if (!_item) return null;
            var _key = _item[this.__key];
            if (_key!=null){
                var _itm = this.__getHash()[_key];
                if (!!_itm){
                    _item = _u._$merge(_itm,_item);
                }
                this.__getHash()[_key] = _item;
            }
            delete _item.__dirty__;
            return _item;
        }
        // batch save to cache
        var _result = [];
        _u._$forEach(
            _item,function(_it){
                _result.push(
                    this.__doSaveItemToCache(_it,_lkey)
                );
            },this
        );
        return _result;
    };
    /**
     * 从缓存列表删除项
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doRemoveItemFromList
     * @param  {String}       arg0 - 列表标识
     * @param  {String|Array} arg1 - 项标识,['111',{id:'222',...},...]
     * @return {Object|Array}        删除项
     */
    _pro.__doRemoveItemFromList = function(_lkey,_id){
        var _result = null,
            _pkey = this.__key;
        // remove one item
        if (!_u._$isArray(_id)){
            var _result = null,
                _pkey = this.__key;
            _id = _id[_pkey]||_id;
            var _list = this._$getListInCache(_lkey),
                _index = _u._$indexOf(_list,function(_itm){
                    return !!_itm&&_itm[_pkey]==_id;
                });
            if (_index>=0){
                _result = _list[_index];
                _list.splice(_index,1);
            }
            return _result;
        }
        // batch remove items
        var _result = [];
        _u._$reverseEach(
            _id,function(_item){
                _result.unshift(
                    this.__doRemoveItemFromList(_lkey,_item)
                );
            },this
        );
        return _result;
    };
    /**
     * 格式化数据项，子类实现具体业务逻辑
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doFormatItem
     * @param  {Object} arg0 - 列表项
     * @param  {String} arg1 - 列表标识
     * @return {Object}        格式化后的列表项
     */
    _pro.__doFormatItem = _f;
    /**
     * 前向追加列表项至列表
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doUnshiftToList
     * @param  {String}       arg0 - 列表标识
     * @param  {Object|Array} arg1 - 列表项或者列表
     * @return {Void}
     */
    _pro.__doUnshiftToList = function(_key,_item){
        if (!_item) return;
        // item unshift
        if (!_u._$isArray(_item)){
            var _list = this._$getListInCache(_key),
                _item = this.__doSaveItemToCache(_item,_key);
            if (!!_item) _list.unshift(_item);
            return;
        }
        // batch unshift
        _u._$reverseEach(
            _item,function(_it){
                this.__doUnshiftToList(_key,_it);
            },this
        );
    };
    /**
     * 设置列表总数
     *
     * 脚本举例
     * ```javascript
     * // 列表总数已知的情况，这时候的total是100
     * // 因为这个100是第一次请求，从服务器带过来的缓存的，后续可能会变化
     * // 但是当前页面的总页面无法做出这种适应，所以不用有相应的变化
     * // 注意：cache是无法保证数据的同步的。如果在别的地方有数据删除，cache无法获知，需要刷新页面
     * _cc._$setTotal('abc',100);
     *
     * // 列表总数未知的情况，这时候的total是list的长度
     * // 未知总长度会有更多选项出现
     * var _total = _cc._$getTotal('abc');
     * // 如果offset+limit>_total说明已经没有数据了，把更多隐藏掉
     * // 否则会继续有一个更多选项在末尾
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$setTotal
     * @see    module:util/cache/list._$$CacheList#_$getTotal
     * @param  {String} arg0 - 列表缓存键值
     * @param  {Number} arg1 - 列表总数
     * @return {Void}
     */
    _pro._$setTotal = function(_key,_total){
        var _list = this._$getListInCache(_key);
        _list.length = Math.max(_list.length,_total);
        this._$setLoaded(_key);
    };
    /**
     * 取列表总长度
     *
     * 脚本举例
     * ```javascript
     * // 获取列表总长度，未知页码的情况是total和list.length较长的一个
     * // 页面已知的情况，取total的值
     * // 以上值被设置到list的length属性中
     * _cc._$getTotal('abc');
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$getTotal
     * @see    module:util/cache/list._$$CacheList#_$setTotal
     * @param  {String} arg0 - 列表标识
     * @return {Number}        列表总长度
     */
    _pro._$getTotal = function(_key){
        return this._$getListInCache(_key).length;
    };
    /**
     * 设置未知长度列表的载入完成标志
     *
     * 脚本举例
     * ```javascript
     * // 设置key为abc的完整数据已经载入完成
     * _cc._$setLoaded('abc');
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$setLoaded
     * @param  {String} arg0 - 列表标识
     * @return {Void}
     */
    _pro._$setLoaded = function(_key,_loaded){
        this._$getListInCache(_key).loaded = _loaded!==!1;
    };
    /**
     * 判断列表是否载入完成
     *
     * @method module:util/cache/list._$$CacheList#_$isLoaded
     * @param  {String}  arg0 - 列表标识
     * @return {Boolean}        是否载入完成
     */
    _pro._$isLoaded = function(_key){
        return !!this._$getListInCache(_key).loaded;
    };
    /**
     * 设置列表，清除原有列表
     *
     * 脚本举例
     * ```javascript
     * // 设置列表
     * _cc._$setListInCache('abc',[]);
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$setListInCache
     * @param  {String} arg0 - 列表标识
     * @return {Array}         列表
     */
    _pro._$setListInCache = function(_key,_list){
        this._$clearListInCache(_key);
        this.__getList({
            key:_key,
            offset:0,
            limit:_list.length+1
        },{
            list:_list,
            total:_list.length
        });
    };
    /**
     * 直接从缓存中取列表
     *
     * 脚本举例
     * ```javascript
     * // 从cache里取列表数据
     * _cc._$getListInCache('abc');
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$getListInCache
     * @param  {String} arg0 - 列表标识
     * @return {Array}         列表
     */
    _pro._$getListInCache = (function(){
        var _doFormatKey = function(_key){
            return (_key||'')+(!_key?'':'-')+'list';
        };
        return function(_key){
            var _key = _doFormatKey(_key),
                _list = this.__lspl[_key];
            if (!_list){
                _list = [];
                this.__lspl[_key] = _list;
            }
            return _list;
        };
    })();
    /**
     * 取Hash映射表
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__getHash
     * @return {Object} 映射表
     */
    _pro.__getHash = function(){
        var _hash = this.__lspl.hash;
        if (!_hash){
            _hash = {};
            this.__lspl.hash = _hash;
        }
        return _hash;
    };
    /**
     * 前向刷新列表
     * 
     * @method   module:util/cache/list._$$CacheList#_$pullRefresh
     * @param    {Object} arg0 - 可选配置参数
     * @property {String} key  - 列表标识
     * @property {Number} data - 发送到服务器数据信息
     * @return   {Void}
     */
    _pro._$pullRefresh = (function(){
        var _doFormatKey = function(_options){
            return 'r-'+_options.key;
        };
        return function(_options){
            var _ropt = _u._$merge({},_options),
                _rkey = _doFormatKey(_ropt),
                _callback = this._$dispatchEvent._$bind(this);
            if (!this.__doQueueRequest(_rkey,_callback)){
                _ropt.rkey = _rkey;
                _ropt.onload = this.__pullRefresh._$bind(this,_ropt);
                this._$dispatchEvent('dopullrefresh',_ropt);
            }
        };
    })();
    /**
     * 前向取列表回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__pullRefresh
     * @param  {Object} arg0 - 请求信息
     * @param  {Array}  arg1 - 数据列表
     * @return {Void}
     */
    _pro.__pullRefresh = function(_options,_result){
        // list with total
        // {total:12,result:[]} 或者 {total:13,list:[]}
        var _key = _options.key,
            _total = parseInt(_result.total),
            _list = _result.list||_result.result;
        this.__doUnshiftToList(_key,_list||_result);
        if (!isNaN(_total)&&!!_list){
            this._$getListInCache(_key).length = _total;
            this._$setLoaded(_key);
        }
        this.__doCallbackRequest(
            _options.rkey,'onpullrefresh',_options
        );
    };
    /**
     * 取列表
     *
     * 脚本举例
     * ```javascript
     * _cc._$getList({key:'abc',data:{},offset:0,limit:10});
     * ```
     *
     * @method   module:util/cache/list._$$CacheList#_$getList
     * @param    {Object} arg0   - 可选配置参数
     * @property {String} key    - 列表标识
     * @property {Number} data   - 其他数据信息
     * @property {Number} offset - 偏移量
     * @property {Number} limit  - 数量
     * @property {Object} ext    - 回传数据
     * @return   {Void}
     */
    _pro._$getList = (function(){
        var _doFormatKey = function(_options){
            return 'r-'+
                   _options.key+'-'+
                   _options.offset+'-'+
                   _options.limit;
        };
        return function(_options){
            _options = _options||_o;
            var _ropt = {
                    key:(''+_options.key)||'',
                    ext:_options.ext||null,
                    data:_options.data||null,
                    offset:parseInt(_options.offset)||0,
                    limit:parseInt(_options.limit)||0
                },
                _list = this._$getListInCache(_ropt.key),
                _has = this.__hasFragment(
                    _list,_ropt.offset,_ropt.limit
                );
            // hit in memory
            if (_has){
                this._$dispatchEvent('onlistload',_ropt);
                return;
            }
            // load from server
            var _rkey = _doFormatKey(_ropt),
                _callback = this._$dispatchEvent._$bind(this);
            if (!this.__doQueueRequest(_rkey,_callback)){
                _ropt.rkey = _rkey;
                _ropt.onload = this.__getList._$bind(this,_ropt);
                this._$dispatchEvent('doloadlist',_ropt);
            }
        };
    })();
    /**
     * 取列表回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__getList
     * @param  {Object}       arg0 - 请求信息
     * @param  {Array|Object} arg1 - 数据列表，或者带总数信息列表
     * @return {Void}
     */
    _pro.__getList = (function(){
        var _doClear = function(_item,_index,_list){
            if (!!_item){
                return !0;
            }
            _list.splice(_index,1);
        };
        return function(_options,_result){
            _options = _options||_o;
            // clear lock if no result
            if (!_result){
                // do callback
                this.__doCallbackRequest(
                    _options.rkey,'onlistload',_options
                );
                return;
            }
            // save list to cache
            var _key = _options.key,
                _offset = _options.offset,
                _chlist = this._$getListInCache(_key);
            // list with total
            // {total:12,result:[]} 或者 {total:13,list:[]}
            var _list = _result||[];
            if (!_u._$isArray(_list)){
                _list = _result.result||_result.list||[];
                var _total = parseInt(_result.total);
                if (!isNaN(_total)||_total>_list.length){
                    this._$setTotal(_key,_total);
                }
            }
            // merge list
            _u._$forEach(
                _list,function(_item,_index){
                    _chlist[_offset+_index] = this.
                         __doSaveItemToCache(_item,_key);
                },this
            );
            // check list all loaded
            if (_list.length<_options.limit){
                this._$setLoaded(_key);
                _u._$reverseEach(_chlist,_doClear);
            }
            // do callback
            this.__doCallbackRequest(
                _options.rkey,'onlistload',_options
            );
        };
    })();
    /**
     * 清除缓存列表
     *
     * 脚本举例
     * ```javascript
     * // 取列表数据
     * _cc._$clearListInCache('abc');
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$clearListInCache
     * @param  {String} arg0 - 列表标识
     * @return {Void}
     */
    _pro._$clearListInCache = (function(){
        var _doClear = function(_item,_index,_list){
            _list.splice(_index,1);
        };
        return function(_key){
            if (_u._$isString(_key)){
                // clear one list
                var _list = this._$getListInCache(_key);
                _u._$reverseEach(_list,_doClear);
                this._$setLoaded(_key,!1);
                if (this.__auto){
                    this.__doGCSchedule();
                }
            }else{
                // clear all list
                _u._$loop(
                    this.__lspl,function(_list,_key){
                        if (_key=='hash'||
                           !_u._$isArray(_list)) return;
                        _key = _key.substr(0,_key.length-5);
                        this._$clearListInCache(_key);
                    },this
                );
            }
        };
    })();
    /**
     * 验证项缓存中的项是否有效，子类可重写
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  arg0 - 数据项
     * @param  {String}  arg0 - 列表标识
     * @return {Boolean}        是否有效
     */
    _pro.__doCheckItemValidity = function(_item,_lkey){
        return !_item.__dirty__;
    };
    /**
     * 从缓存中取列表项
     *
     * 脚本举例
     * ```javascript
     * // 从cache中取某一项数据
     * _cc._$getItemInCache('abc');
     * ```
     *
     * @method module:util/cache/list._$$CacheList#_$getItemInCache
     * @param  {String}   arg0 - 项标识
     * @return {Variable}        列表项
     */
    _pro._$getItemInCache = function(_id){
        return this.__getHash()[_id];
    };
    /**
     * 清除缓存项
     * 
     * @method module:util/cache/list._$$CacheList#_$clearItemInCache
     * @param  {String} arg0 - 项标识
     * @return {Void}
     */
    _pro._$clearItemInCache = function(_id){
        var _item = this._$getItemInCache(_id);
        if (!!_item) _item.__dirty__ = !0;
    };
    /**
     * 取列表项项
     *
     * 脚本举例
     * ```javascript
     * // 取某一项数据
     * _cc._$getItem({
     *     id:'aaaa',
     *     key:'xxxxxx'
     * });
     * ```
     *
     * @method   module:util/cache/list._$$CacheList#_$getItem
     * @param    {Object} event - 请求信息
     * @property {String} id    - 项标识，该名称与配置的项标识键一致
     * @property {String} key   - 列表标识
     * @property {Object} data  - 发送到服务器的数据
     * @property {Object} ext   - 需要回传的数据信息
     * @return   {Void}
     */
    _pro._$getItem = (function(){
        var _doFormatKey = function(_options){
            return 'r-'+_options.key+'-'+_options.id;
        };
        return function(_options){
            _options = _options||_o;
            var _id = _options[this.__key],
                _ropt = {
                    id:_id,
                    ext:_options.ext,
                    data:_options.data||{},
                    key:(''+_options.key)||''
                };
                _item = this._$getItemInCache(_id);
            _ropt.data[this.__key] = _id;
            // hit in memory
            if (!!_item&&
                this.__doCheckItemValidity(_item,_ropt.key)){
                this._$dispatchEvent('onitemload',_ropt);
                return;
            }
            // load from server
            var _rkey = _doFormatKey(_ropt),
                _callback = this._$dispatchEvent._$bind(this);
            if (!this.__doQueueRequest(_rkey,_callback)){
                _ropt.rkey = _rkey;
                _ropt.onload = this.__getItem._$bind(this,_ropt);
                this._$dispatchEvent('doloaditem',_ropt);
            }
        };
    })();
    /**
     * 取列表项回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__getItem
     * @param  {Object} arg0 - 请求信息
     * @param  {Object} arg1 - 列表项对象
     * @return {Void}
     */
    _pro.__getItem = function(_options,_item){
        _options = _options||_o;
        this.__doSaveItemToCache(_item,_options.key);
        this.__doCallbackRequest(
            _options.rkey,'onitemload',_options
        );
    };
    /**
     * 添加列表项
     *
     * 脚本举例
     * ```javascript
     * _cc._$addItem({
     *     key: '123',
     *     item: {},
     *     push: false,
     *     offset:0
     * });
     * ```
     *
     * @method   module:util/cache/list._$$CacheList#_$addItem
     * @param    {Object}  arg0   - 配置信息
     * @property {String}  key    - 列表标识
     * @property {Object}  data   - 列表项数据
     * @property {Boolean} push   - 是否追加到列表尾部
     * @property {Number}  offset - 对于非尾部追加的项可通过此参数指定追加位置
     * @return   {Void}
     */
    _pro._$addItem = function(_options){
        _options = _u._$merge({},_options);
        _options.onload = this.__addItem._$bind(this,_options);
        this._$dispatchEvent('doadditem',_options);
    };
    /**
     * 添加列表项回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__addItem}
     * @param  {Object} arg0 - 请求信息
     * @param  {Object} arg1 - 列表项对象
     * @return {Void}
     */
    _pro.__addItem = function(_options,_item){
        var _key = _options.key;
        _item = this.__doSaveItemToCache(_item,_key);
        // add to list
        if (!!_item){
            var _flag = 0,
                _list = this._$getListInCache(_key);
            if (!_options.push){
                _flag = -1;
                var _offset = _options.offset||0;
                _list.splice(_offset,0,_item);
            }else if(_list.loaded){
                _flag = 1;
                _list.push(_item);
            }else{
                // add total
                _list.length++;
            }
        }
        // callback
        var _event = {
            key:_key,
            flag:_flag,
            data:_item,
            action:'add',
            ext:_options.ext
        };
        this._$dispatchEvent('onitemadd',_event);

        return _event;
    };
    /**
     * 删除列表项
     *
     * 脚本举例
     * ```javascript
     * _cc._$deleteItem({
     *     key: '123'
     * });
     * ```
     *
     * @method   module:util/cache/list._$$CacheList#_$deleteItem
     * @param    {Object} arg0 - 配置信息
     * @property {String} key  - 列表标识
     * @property {String} id   - 列表项标识
     * @property {Object} data - 列表项数据信息
     * @property {Object} ext  - 需要回传的数据信息
     * @return   {Void}
     */
    _pro._$deleteItem = function(_options){
        _options = _u._$merge({},_options);
        _options.onload = this.__deleteItem._$bind(this,_options);
        this._$dispatchEvent('dodeleteitem',_options);
    };
    /**
     * 删除列表项回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__deleteItem
     * @param  {Object}  arg0 - 请求信息
     * @param  {Boolean} arg1 - 是否删除成功
     * @return {Void}
     */
    _pro.__deleteItem = function(_options,_isok){
        var _item,
            _key = _options.key;
        // sync memory
        if (!!_isok){
            var _id = _options.id;
            _item = this._$getItemInCache(_id)||null;
            this.__doRemoveItemFromList(_key,_id);
        }
        // callback
        var _event = {
            key:_key,
            data:_item,
            action:'delete',
            ext:_options.ext
        };
        this._$dispatchEvent('onitemdelete',_event);

        return _event;
    };
    /**
     * 更新列表项
     *
     * 脚本举例
     * ```javascript
     * _cc._$updateItem({
     *     key:'123',
     *     item:{}
     * });
     * ```
     *
     * @method   module:util/cache/list._$$CacheList#_$updateItem
     * @param    {Object} arg0 - 配置信息
     * @property {String} key  - 列表标识
     * @property {Object} data - 列表项数据
     * @property {Object} ext  - 需要回传的数据信息
     * @return   {Void}
     */
    _pro._$updateItem = function(_options){
        _options = _u._$merge({},_options);
        _options.onload = this.__updateItem._$bind(this,_options);
        this._$dispatchEvent('doupdateitem',_options);
    };
    /**
     * 更新列表项回调
     * 
     * @protected
     * @method module:util/cache/list._$$CacheList#__updateItem
     * @param  {Object} arg0 - 请求信息
     * @param  {Object} arg1 - 列表项对象
     * @return {Void}
     */
    _pro.__updateItem = function(_options,_item){
        var _key = _options.key;
        // update memory
        if (!!_item){
            _item = this.__doSaveItemToCache(_item,_key);
        }
        // callback
        var _event = {
            key:_key,
            data:_item,
            action:'update',
            ext:_options.ext
        };
        this._$dispatchEvent('onitemupdate',_event);

        return _event;
    };

    if (CMPT){
        NEJ.P('nej.ut')._$$ListCache = _p._$$CacheList;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','51f7c7841c9e3d8e70dbe12bc0a175a1');
I$('472cf137872fdb27e5ea0f6b37405d90',function (NEJ,_k,_u,_v,_j,_jj,_t,_p,_o,_f,_r,_pro){
    // request config cache
    var config = {},
        seed = _u._$uniqueID();
    /**
     * 调度事件
     * @param name
     * @param event
     */
    var dispatch = function(name,event){
        event = event||{};
        _u._$forEach(
            config[name+'-'+seed],function(func){
                func.call(this,event);
                if (event.stopped){
                    return !0;
                }
            },this
        );
    };
    /**
     * 列表缓存管理基类
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'util/ajax/xdr',
     *     'util/cache/abstract'
     * ],function(_k,_j,_t,_p){
     *     // 创建自己的listCache管理类
     *     _p._$$CacheListCustom = _k._$klass();
     *     _pro = _p._$$CacheListCustom._$extend(_t._$$CacheListAbstract);
     *     
     *     // 实现取列表的方法
     *     // 根据offset+limit取列表
     *     // data表示取列表可能需要的额外数据信息
     *     // 数据返回的回调是onload
     *     _pro.__doLoadList = function(_options){
     *         var _key    = _options.key;
     *         var _data   = _options.data;
     *         var _offset = _options.offset;
     *         var _limit  = _options.limit;
     *         var _rkey   = _options.rkey;
     *         var _onload = _options.onload;
     *         _j._$request(
     *             '/xhr/list',{
     *                 type:'json',
     *                 method:'POST',
     *                 data:{offset:_offset,limit:_limit},
     *                 timeout:1000,
     *                 onload:_onload._$bind(this),
     *                 onerror:function(_error){
     *                     // TODO
     *                 }
     *             }
     *         );
     *     };
     * 
     *     // 实现取列表的方法
     *     // 根据id和key取一项数据
     *     // 数据返回的回调是onload
     *     _proCacheListCustom.__doLoadItem = function(_options){
     *         var _id     = _options.id;
     *         var _key    = _options.key;
     *         var _rkey   = _options.rkey;
     *         var _onload = _options.onload;
     *         _j._$request(
     *             '/xhr/get',{
     *                 type:'json',
     *                 method:'POST',
     *                 data:{id:_id,key:_key},
     *                 timeout:1000,
     *                 onload:_onload._$bind(this),
     *                 onerror:function(_error){
     *                     // TODO
     *                 }
     *             }
     *         );
     *     };
     * });
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     '/path/to/custom/cache.js'
     * ],function(_p){
     *     // 实例化一个上面的对象
     *     var _cache = c._$$CacheListCustom._$allocate({
     *         // id作为cache的标识
     *         id:'a',
     *         // 根据key，也就是上面的id，到缓存中取数据，然后处理数据
     *         onlistload:function(_ropt){
     *             _cache._$getListInCache(_ropt.key);
     *         },
     *          // 根据key，也就是上面的id，到缓存中取数据，然后处理数据
     *         onitemload:function(_ropt){
     *             _cache._$getItemInCache(_ropt.key);
     *         }
     *     });
     * 
     *     // 第一个列表的请求
     *     _cache._$getList({key:'abc',data:{},offset:0,limit:10})
     *     // 不会发请求，直接走缓存
     *     _cache._$getList({key:'abc',data:{},offset:0,limit:10})
     *     // 第一个项请求
     *     _cache._$getItem({id:'abc',key:'123',data:{})
     *     // 不会发请求，直接走缓存
     *     _cache._$getItem({id:'abc',key:'123',data:{})
     * });
     * ```
     * 
     * @class   module:util/cache/abstract._$$CacheListAbstract
     * @extends module:util/cache/list._$$CacheList
     * 
     * @param   {Object} config - 可选配置参数
     */
    /** 
     * 列表载入完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onlistload
     * @param    {Object}   event - 可选配置参数
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /** 
     * 缓存项载入完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onitemload
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /** 
     * 缓存项添加完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onitemadd
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /** 
     * 缓存项删除完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onitemdelete 
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /** 
     * 缓存项更新完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onitemupdate
     * @param    {Object}   event - 可选配置参数
     * @property {String}   id    - 项标识
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    /** 
     * 服务器最新列表拉取完成回调
     * 
     * @event    module:util/cache/abstract._$$CacheListAbstract#onpullrefresh
     * @param    {Object}   event - 可选配置参数
     * @property {String}   key   - 列表标识
     * @property {Variable} ext   - 传入数据原样返回
     */
    _p._$$CacheListAbstract = _k._$klass();
    _pro = _p._$$CacheListAbstract._$extend(_t._$$CacheList);
    /**
     * 发送请求
     *
     * @protected
     * @method module:util/cache/abstract._$$CacheListAbstract#__doSendRequest
     * @param  {String} key - 请求配置标识
     * @param  {Object} options - 请求信息
     * @return {Void}
     */
    _pro.__doSendRequest = function(key,options){
        // check config
        var conf = config[key];
        if (!conf){
            console.error('not found request config for '+key);
            return;
        }
        // onerror event
        var onerror = function(error){
            var event = {
                req:options,
                error:error||{}
            };
            // check global error handler
            dispatch.call(this,'error',event);
            if (event.stopped){
                return;
            }
            // dispatch error config event
            var onerror = options.onerror||conf.onerror||'onerror';
            if (_u._$isFunction(onerror)){
                onerror.call(this,event);
            }else if(_u._$isString(onerror)){
                this._$dispatchEvent(onerror,event);
            }
        };
        // onload event
        var onload = function(result){
            var event = {
                req:options,
                res:result
            };
            // check post handler
            if (_u._$isFunction(conf.post)){
                conf.post.call(this,event);
            }
            dispatch.call(this,'post',event);
            if (!!event.error){
                onerror.call(this,event.error);
                return;
            }
            // check global format handler
            if (_u._$isFunction(conf.format)){
                conf.format.call(this,event);
            }
            dispatch.call(this,'format',event);
            // callback
            var callback = options.onload||conf.onload,
                result = event.result||result;
            if (_u._$isFunction(callback)){
                callback.call(this,result);
            }else if(_u._$isString(callback)){
                this._$dispatchEvent(callback,result);
            }
            // finally action
            if (_u._$isFunction(conf.finaly)){
                conf.finaly.call(this,event);
            }
        };
        // before request
        var event = {
            url:conf.url,
            req:options
        };
        dispatch.call(this,'filter',event);
        if (_u._$isFunction(conf.filter)){
            conf.filter.call(this,event);
        }
        // send request
        var opt = _u._$merge({},options,{
            type:'json',
            method:conf.method||'POST',
            onload:onload._$bind(this),
            onerror:onerror._$bind(this)
        });
        (!conf.rest?_j:_jj)._$request(event.url,opt);
    };
    /**
     * 控件初始化
     * 
     * @protected
     * @method module:util/cache/abstract._$$CacheListAbstract#__init
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this._$batEvent({
            doloadlist:this.__doLoadList._$bind(this),
            doloaditem:this.__doLoadItem._$bind(this),
            doadditem:this.__doAddItem._$bind(this),
            dodeleteitem:this.__doDeleteItem._$bind(this),
            doupdateitem:this.__doUpdateItem._$bind(this),
            dopullrefresh:this.__doPullRefresh._$bind(this)
        });
    };
    /**
     * 从服务器端载入列表，子类实现具体逻辑
     * 
     * @abstract
     * @method   module:util/cache/abstract._$$CacheListAbstract#__doLoadList
     * @param    {Object}   arg0   - 请求信息
     * @property {String}   key    - 列表标识
     * @property {Number}   offset - 偏移量
     * @property {Number}   limit  - 数量
     * @property {String}   data   - 请求相关数据
     * @property {Function} onload - 列表项载入回调
     * @return   {Void}
     */
    _pro.__doLoadList = _f;
    /**
     * 从服务器端前向刷新列表，子类实现具体逻辑
     * 
     * @abstract
     * @method   module:util/cache/abstract._$$CacheListAbstract#__doPullRefresh
     * @param    {Object}   arg0   - 请求信息
     * @property {String}   key    - 列表标识
     * @property {String}   data   - 请求相关数据
     * @property {Function} onload - 列表项载入回调
     * @return   {Void}
     */
    _pro.__doPullRefresh = _f;
    /**
     * 从服务器端载入列表项，子类实现具体逻辑
     * 
     * @abstract
     * @method   module:util/cache/abstract._$$CacheListAbstract#__doLoadItem
     * @param    {Object}   arg0   - 请求信息
     * @property {String}   key    - 列表标识
     * @property {Number}   id     - 列表项标识
     * @property {String}   data   - 请求相关数据
     * @property {Function} onload - 列表项载入回调
     * @return   {Void}
     */
    _pro.__doLoadItem = _f;
    /**
     * 添加列表项至服务器，子类实现具体逻辑
     * 
     * @abstract
     * @method   module:util/cache/abstract._$$CacheListAbstract#__doAddItem
     * @param    {Object}   arg0   - 请求信息
     * @property {String}   key    - 列表标识
     * @property {Number}   id     - 列表项标识
     * @property {String}   data   - 请求相关数据
     * @property {Function} onload - 列表项载入回调
     * @return   {Void}
     */
    _pro.__doAddItem = _f;
    /**
     * 从服务器上删除列表项，子类实现具体逻辑
     * 
     * @abstract
     * @method    module:util/cache/abstract._$$CacheListAbstract#__doDeleteItem
     * @param     {Object}   event  - 请求信息
     * @property  {String}   key    - 列表标识
     * @property  {Number}   id     - 列表项标识
     * @property  {String}   data   - 请求相关数据
     * @property  {Function} onload - 列表项载入回调
     * @return    {Void}
     */
    _pro.__doDeleteItem = _f;
    /**
     * 更新列表项至服务器，子类实现具体逻辑
     * 
     * @abstract
     * @method module:util/cache/abstract._$$CacheListAbstract#__doUpdateItem
     * @param    {Object}   event  - 请求信息
     * @property {String}   key    - 列表标识
     * @property {Number}   id     - 列表项标识
     * @property {String}   data   - 请求相关数据
     * @property {Function} onload - 列表项载入回调
     * @return   {Void}
     */
    _pro.__doUpdateItem = _f;
    /**
     * 全局预处理事件配置
     *
     * @param  {Object}   map - 事件配置信息
     * @param  {function} map.filter - 请求发送之前统一预处理事件，输入为{req:options,url:'url'}
     * @param  {function} map.post   - 请求返回之后统一预处理事件，输入为{req:options,res:result}
     * @param  {function} map.format - 请求返回数据统一格式化事件, 输入为{req:options,res:result}
     * @param  {function} map.error  - 请求返回异常统一预处理事件, 输入为{req:options,error:error}
     * @return {Void}
     */
    _p._$on = (function(){
        var _doAdd = function(name,func){
            if (!_u._$isFunction(func)){
                return;
            }
            var key = name+'-'+seed,
                list = config[key]||[];
            list.push(func);
            config[key] = list;
        };
        return function(map){
            // for name and func
            if (_u._$isString(map)){
                _doAdd.apply(null,arguments);
                return;
            }
            // for batch add
            _u._$loop(map,function(func,key){
                _doAdd(key,func);
            });
        };
    })();
    /**
     * 执行缓存的同步方法，执行完毕后立即回收缓存
     *
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'util/cache/abstract'
     * ],function(k,t,p,pro){
     *     // 定义自己的缓存类
     *     p._$$Cache = k._$klass();
     *     pro = p._$$Cache._$extend(t._$$CacheListAbstract);
     *
     *     // 对外接口
     *     pro._$getDataForCheck = function(){
     *         // TODO something
     *         return 'result';
     *     }
     *
     *     // 重写_$do方法，绑定缓存构造器
     *     p._$do = t._$do._$bind(
     *         null,p._$$Cache
     *     );
     * });
     * ```
     *
     * ```javascript
     * NEJ.define([
     *     'path/to/cache'
     * ],function(t){
     *
     *     // 使用缓存
     *     var ret = t._$do(function(cache){
     *         return cache._$getDataForCheck();
     *     });
     *
     *     // TODO something
     * }
     * ```
     *
     * @method module:util/cache/abstract._$do
     * @param  {Function} Klass - 缓存构造器
     * @param  {function} func  - 执行回调
     * @return {Variable} 回调返回结果
     */
    _p._$do = function(Klass,func){
        if (!_u._$isFunction(func)){
            return;
        }
        var cache = Klass._$allocate(),
            ret = func.call(null,cache);
        cache._$recycle();
        return ret;
    };
    /**
     * 请求配置信息，项目中可以统一配置请求信息，可配置项如下表所示
     *
     * | 名称    | 类型     | 描述  |
     * | :----:  | :----:   | :---- |
     * | url     | String   | 请求地址 |
     * | method  | String   | 请求方式，GET/POST/PUT等，默认为POST |
     * | rest    | Boolean  | 是否REST接口 |
     * | filter  | Function | 请求发送之前配置信息过滤接口 |
     * | post    | Function | 请求返回之后结果检查接口 |
     * | format  | Function | 请求返回结果格式化接口 |
     * | finaly  | Function | 回调结束后执行业务逻辑接口 |
     * | onerror | Function | 异常处理接口 |
     * | onload  | Function | 回调处理接口 |
     *
     * @method module:util/cache/abstract._$config
     * @see    module:util/cache/abstract._$on
     * @param  {Object} map - 配置映射关系，如{'key1':{url:'url'},'key2':'url'}
     * @return {Void}
     */
    _p._$config = function(map){
        _u._$forIn(map,function(value,key){
            if (typeof value==='string'){
                value = {url:value};
            }
            config[key] = value;
        });
    };
    /**
     * 合并请求配置信息
     *
     * @method module:util/cache/abstract._$merge
     * @see    module:util/cache/abstract._$config
     * @param  {String} key - 配置标识
     * @param  {Object} map - 配置信息
     * @return {Void}
     */
    _p._$merge = function(key,map){
        var conf = config[key];
        if (!conf){
            config[key] = map;
        }else{
            config[key] = _u._$merge(conf,map);
        }
    };

    /**
     * 导出配置信息对象
     *
     * @method module:util/cache/abstract._$dump
     * @returns {Object} 配置信息对象
     */
    _p._$dump = function(){
        return config;
    };

    if (CMPT){
        NEJ.P('nej.ut')._$$AbstractListCache = _p._$$CacheListAbstract;
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','19b4ef9670142281a6ff17ec75864bee','ec521e4e62dbac49438faa1e9a253744','7e9128286db9a86efde148ece05b9aa0');
I$('27d8cb4fa0c9c5a46d8b26265d908569',function jsonBean() {
    /*
     * Generated by PEG.js 0.9.0.
     *
     * http://pegjs.org/
     */

    function peg$subclass(child, parent) {
      function ctor() { this.constructor = child; }
      ctor.prototype = parent.prototype;
      child.prototype = new ctor();
    }

    function peg$SyntaxError(message, expected, found, location) {
      this.message  = message;
      this.expected = expected;
      this.found    = found;
      this.location = location;
      this.name     = "SyntaxError";

      if (typeof Error.captureStackTrace === "function") {
        Error.captureStackTrace(this, peg$SyntaxError);
      }
    }

    peg$subclass(peg$SyntaxError, Error);

    function peg$parse(input) {
      var options = arguments.length > 1 ? arguments[1] : {},
          parser  = this,

          peg$FAILED = {},

          peg$startRuleFunctions = { Start: peg$parseStart },
          peg$startRuleFunction  = peg$parseStart,

          peg$c0 = function(items) {
            var result = {
              name: '',
              description: '',
              attributes: []
            }
            items.forEach(function(item) {
              if (item === null) return;
              if (item.class) {
                result.name = item.class
                result.description = item.description
              } else if (item.name) {
                result.attributes.push(item)
              }
            })
            return result
          },
          peg$c1 = ";",
          peg$c2 = { type: "literal", value: ";", description: "\";\"" },
          peg$c3 = function(dtm, dt, name, dv, ct) {
            return {
              name: name.join(''),
              type: dt.name,
              isArray: dt.isArray,
              defaultValue: dv.join(''),
              description: ct.join('')
            }
          },
          peg$c4 = "private",
          peg$c5 = { type: "literal", value: "private", description: "\"private\"" },
          peg$c6 = function(ct, dtm, name, dv) {
            return {
              name: name.join(''),
              type: dt.name,
              isArray: dt.isArray,
              defaultValue: dv.join(''),
              description: ct.join('')
            }
          },
          peg$c7 = "public",
          peg$c8 = { type: "literal", value: "public", description: "\"public\"" },
          peg$c9 = "class",
          peg$c10 = { type: "literal", value: "class", description: "\"class\"" },
          peg$c11 = "{",
          peg$c12 = { type: "literal", value: "{", description: "\"{\"" },
          peg$c13 = function(ct, clazz) {
            return {
              description: ct.join(''),
              class: clazz
            }
          },
          peg$c14 = "}",
          peg$c15 = { type: "literal", value: "}", description: "\"}\"" },
          peg$c16 = function() {
            return null
          },
          peg$c17 = function(a) {
            return null
          },
          peg$c18 = "List",
          peg$c19 = { type: "literal", value: "List", description: "\"List\"" },
          peg$c20 = "<",
          peg$c21 = { type: "literal", value: "<", description: "\"<\"" },
          peg$c22 = ">",
          peg$c23 = { type: "literal", value: ">", description: "\">\"" },
          peg$c24 = function(w) {
            return {
              name: w,
              isArray: true
            }
          },
          peg$c25 = function(w) {
            return {
              name: w,
              isArray: false
            }
          },
          peg$c26 = "protected",
          peg$c27 = { type: "literal", value: "protected", description: "\"protected\"" },
          peg$c28 = "=",
          peg$c29 = { type: "literal", value: "=", description: "\"=\"" },
          peg$c30 = function(w) {
            return w
          },
          peg$c31 = "//",
          peg$c32 = { type: "literal", value: "//", description: "\"//\"" },
          peg$c33 = function(c) {
            return c.join('')
          },
          peg$c34 = function(c) {
            return c
          },
          peg$c35 = /^[\/]/,
          peg$c36 = { type: "class", value: "[/]", description: "[/]" },
          peg$c37 = /^[*]/,
          peg$c38 = { type: "class", value: "[*]", description: "[*]" },
          peg$c39 = "*/",
          peg$c40 = { type: "literal", value: "*/", description: "\"*/\"" },
          peg$c41 = { type: "any", description: "any character" },
          peg$c42 = function(c) {
            var comments = c.map(function(item) {
              return item[1]
            }).join('').split('\n')
            var result = []
            comments.forEach(function(comment) {
              var trimResult = comment.trim().replace(/^\*+|\*+$/g, '').trim()
              if (trimResult) {
                result.push(trimResult)
              }
            })
            return result.join(', ')
          },
          peg$c43 = function(l) {
            return l.join('');
          },
          peg$c44 = /^[a-zA-Z0-9]/,
          peg$c45 = { type: "class", value: "[a-zA-Z0-9]", description: "[a-zA-Z0-9]" },
          peg$c46 = { type: "other", description: "Whitespace" },
          peg$c47 = /^[ \t]/,
          peg$c48 = { type: "class", value: "[ \\t]", description: "[ \\t]" },
          peg$c49 = { type: "other", description: "Zero or more whitespaces" },
          peg$c50 = { type: "other", description: "One or more whitespaces" },
          peg$c51 = /^[\r\n]/,
          peg$c52 = { type: "class", value: "[\\r\\n]", description: "[\\r\\n]" },
          peg$c53 = /^[^;{]/,
          peg$c54 = { type: "class", value: "[^;{]", description: "[^;{]" },
          peg$c55 = /^[^\r\n]/,
          peg$c56 = { type: "class", value: "[^\\r\\n]", description: "[^\\r\\n]" },

          peg$currPos          = 0,
          peg$savedPos         = 0,
          peg$posDetailsCache  = [{ line: 1, column: 1, seenCR: false }],
          peg$maxFailPos       = 0,
          peg$maxFailExpected  = [],
          peg$silentFails      = 0,

          peg$result;

      if ("startRule" in options) {
        if (!(options.startRule in peg$startRuleFunctions)) {
          throw new Error("Can't start parsing from rule \"" + options.startRule + "\".");
        }

        peg$startRuleFunction = peg$startRuleFunctions[options.startRule];
      }

      function text() {
        return input.substring(peg$savedPos, peg$currPos);
      }

      function location() {
        return peg$computeLocation(peg$savedPos, peg$currPos);
      }

      function expected(description) {
        throw peg$buildException(
            null,
            [{ type: "other", description: description }],
            input.substring(peg$savedPos, peg$currPos),
            peg$computeLocation(peg$savedPos, peg$currPos)
        );
      }

      function error(message) {
        throw peg$buildException(
            message,
            null,
            input.substring(peg$savedPos, peg$currPos),
            peg$computeLocation(peg$savedPos, peg$currPos)
        );
      }

      function peg$computePosDetails(pos) {
        var details = peg$posDetailsCache[pos],
            p, ch;

        if (details) {
          return details;
        } else {
          p = pos - 1;
          while (!peg$posDetailsCache[p]) {
            p--;
          }

          details = peg$posDetailsCache[p];
          details = {
            line:   details.line,
            column: details.column,
            seenCR: details.seenCR
          };

          while (p < pos) {
            ch = input.charAt(p);
            if (ch === "\n") {
              if (!details.seenCR) { details.line++; }
              details.column = 1;
              details.seenCR = false;
            } else if (ch === "\r" || ch === "\u2028" || ch === "\u2029") {
              details.line++;
              details.column = 1;
              details.seenCR = true;
            } else {
              details.column++;
              details.seenCR = false;
            }

            p++;
          }

          peg$posDetailsCache[pos] = details;
          return details;
        }
      }

      function peg$computeLocation(startPos, endPos) {
        var startPosDetails = peg$computePosDetails(startPos),
            endPosDetails   = peg$computePosDetails(endPos);

        return {
          start: {
            offset: startPos,
            line:   startPosDetails.line,
            column: startPosDetails.column
          },
          end: {
            offset: endPos,
            line:   endPosDetails.line,
            column: endPosDetails.column
          }
        };
      }

      function peg$fail(expected) {
        if (peg$currPos < peg$maxFailPos) { return; }

        if (peg$currPos > peg$maxFailPos) {
          peg$maxFailPos = peg$currPos;
          peg$maxFailExpected = [];
        }

        peg$maxFailExpected.push(expected);
      }

      function peg$buildException(message, expected, found, location) {
        function cleanupExpected(expected) {
          var i = 1;

          expected.sort(function(a, b) {
            if (a.description < b.description) {
              return -1;
            } else if (a.description > b.description) {
              return 1;
            } else {
              return 0;
            }
          });

          while (i < expected.length) {
            if (expected[i - 1] === expected[i]) {
              expected.splice(i, 1);
            } else {
              i++;
            }
          }
        }

        function buildMessage(expected, found) {
          function stringEscape(s) {
            function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }

            return s
                .replace(/\\/g,   '\\\\')
                .replace(/"/g,    '\\"')
                .replace(/\x08/g, '\\b')
                .replace(/\t/g,   '\\t')
                .replace(/\n/g,   '\\n')
                .replace(/\f/g,   '\\f')
                .replace(/\r/g,   '\\r')
                .replace(/[\x00-\x07\x0B\x0E\x0F]/g, function(ch) { return '\\x0' + hex(ch); })
                .replace(/[\x10-\x1F\x80-\xFF]/g,    function(ch) { return '\\x'  + hex(ch); })
                .replace(/[\u0100-\u0FFF]/g,         function(ch) { return '\\u0' + hex(ch); })
                .replace(/[\u1000-\uFFFF]/g,         function(ch) { return '\\u'  + hex(ch); });
          }

          var expectedDescs = new Array(expected.length),
              expectedDesc, foundDesc, i;

          for (i = 0; i < expected.length; i++) {
            expectedDescs[i] = expected[i].description;
          }

          expectedDesc = expected.length > 1
              ? expectedDescs.slice(0, -1).join(", ")
          + " or "
          + expectedDescs[expected.length - 1]
              : expectedDescs[0];

          foundDesc = found ? "\"" + stringEscape(found) + "\"" : "end of input";

          return "Expected " + expectedDesc + " but " + foundDesc + " found.";
        }

        if (expected !== null) {
          cleanupExpected(expected);
        }

        return new peg$SyntaxError(
            message !== null ? message : buildMessage(expected, found),
            expected,
            found,
            location
        );
      }

      function peg$parseStart() {
        var s0, s1, s2;

        s0 = peg$currPos;
        s1 = [];
        s2 = peg$parseStatement();
        while (s2 !== peg$FAILED) {
          s1.push(s2);
          s2 = peg$parseStatement();
        }
        if (s1 !== peg$FAILED) {
          peg$savedPos = s0;
          s1 = peg$c0(s1);
        }
        s0 = s1;

        return s0;
      }

      function peg$parseStatement() {
        var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11;

        s0 = peg$currPos;
        s1 = peg$parse_();
        if (s1 !== peg$FAILED) {
          s2 = peg$parseDataTypeModifier();
          if (s2 !== peg$FAILED) {
            s3 = peg$parse__();
            if (s3 !== peg$FAILED) {
              s4 = peg$parseDataType();
              if (s4 !== peg$FAILED) {
                s5 = peg$parse__();
                if (s5 !== peg$FAILED) {
                  s6 = [];
                  s7 = peg$parseCharacter();
                  if (s7 !== peg$FAILED) {
                    while (s7 !== peg$FAILED) {
                      s6.push(s7);
                      s7 = peg$parseCharacter();
                    }
                  } else {
                    s6 = peg$FAILED;
                  }
                  if (s6 !== peg$FAILED) {
                    s7 = [];
                    s8 = peg$parseDefaultValue();
                    while (s8 !== peg$FAILED) {
                      s7.push(s8);
                      s8 = peg$parseDefaultValue();
                    }
                    if (s7 !== peg$FAILED) {
                      if (input.charCodeAt(peg$currPos) === 59) {
                        s8 = peg$c1;
                        peg$currPos++;
                      } else {
                        s8 = peg$FAILED;
                        if (peg$silentFails === 0) { peg$fail(peg$c2); }
                      }
                      if (s8 !== peg$FAILED) {
                        s9 = [];
                        s10 = peg$parseComment();
                        while (s10 !== peg$FAILED) {
                          s9.push(s10);
                          s10 = peg$parseComment();
                        }
                        if (s9 !== peg$FAILED) {
                          peg$savedPos = s0;
                          s1 = peg$c3(s2, s4, s6, s7, s9);
                          s0 = s1;
                        } else {
                          peg$currPos = s0;
                          s0 = peg$FAILED;
                        }
                      } else {
                        peg$currPos = s0;
                        s0 = peg$FAILED;
                      }
                    } else {
                      peg$currPos = s0;
                      s0 = peg$FAILED;
                    }
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }
        if (s0 === peg$FAILED) {
          s0 = peg$currPos;
          s1 = [];
          s2 = peg$parseComment();
          while (s2 !== peg$FAILED) {
            s1.push(s2);
            s2 = peg$parseComment();
          }
          if (s1 !== peg$FAILED) {
            s2 = peg$parse_();
            if (s2 !== peg$FAILED) {
              if (input.substr(peg$currPos, 7) === peg$c4) {
                s3 = peg$c4;
                peg$currPos += 7;
              } else {
                s3 = peg$FAILED;
                if (peg$silentFails === 0) { peg$fail(peg$c5); }
              }
              if (s3 !== peg$FAILED) {
                s4 = peg$parse__();
                if (s4 !== peg$FAILED) {
                  s5 = peg$parseDataTypeModifier();
                  if (s5 !== peg$FAILED) {
                    s6 = peg$parse__();
                    if (s6 !== peg$FAILED) {
                      s7 = [];
                      s8 = peg$parseCharacter();
                      if (s8 !== peg$FAILED) {
                        while (s8 !== peg$FAILED) {
                          s7.push(s8);
                          s8 = peg$parseCharacter();
                        }
                      } else {
                        s7 = peg$FAILED;
                      }
                      if (s7 !== peg$FAILED) {
                        s8 = [];
                        s9 = peg$parseDefaultValue();
                        while (s9 !== peg$FAILED) {
                          s8.push(s9);
                          s9 = peg$parseDefaultValue();
                        }
                        if (s8 !== peg$FAILED) {
                          if (input.charCodeAt(peg$currPos) === 59) {
                            s9 = peg$c1;
                            peg$currPos++;
                          } else {
                            s9 = peg$FAILED;
                            if (peg$silentFails === 0) { peg$fail(peg$c2); }
                          }
                          if (s9 !== peg$FAILED) {
                            s10 = [];
                            s11 = peg$parseLB();
                            while (s11 !== peg$FAILED) {
                              s10.push(s11);
                              s11 = peg$parseLB();
                            }
                            if (s10 !== peg$FAILED) {
                              peg$savedPos = s0;
                              s1 = peg$c6(s1, s5, s7, s8);
                              s0 = s1;
                            } else {
                              peg$currPos = s0;
                              s0 = peg$FAILED;
                            }
                          } else {
                            peg$currPos = s0;
                            s0 = peg$FAILED;
                          }
                        } else {
                          peg$currPos = s0;
                          s0 = peg$FAILED;
                        }
                      } else {
                        peg$currPos = s0;
                        s0 = peg$FAILED;
                      }
                    } else {
                      peg$currPos = s0;
                      s0 = peg$FAILED;
                    }
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
          if (s0 === peg$FAILED) {
            s0 = peg$currPos;
            s1 = [];
            s2 = peg$parseComment();
            while (s2 !== peg$FAILED) {
              s1.push(s2);
              s2 = peg$parseComment();
            }
            if (s1 !== peg$FAILED) {
              s2 = peg$parse_();
              if (s2 !== peg$FAILED) {
                if (input.substr(peg$currPos, 6) === peg$c7) {
                  s3 = peg$c7;
                  peg$currPos += 6;
                } else {
                  s3 = peg$FAILED;
                  if (peg$silentFails === 0) { peg$fail(peg$c8); }
                }
                if (s3 !== peg$FAILED) {
                  s4 = peg$parse__();
                  if (s4 !== peg$FAILED) {
                    if (input.substr(peg$currPos, 5) === peg$c9) {
                      s5 = peg$c9;
                      peg$currPos += 5;
                    } else {
                      s5 = peg$FAILED;
                      if (peg$silentFails === 0) { peg$fail(peg$c10); }
                    }
                    if (s5 !== peg$FAILED) {
                      s6 = peg$parse__();
                      if (s6 !== peg$FAILED) {
                        s7 = peg$parseWord();
                        if (s7 !== peg$FAILED) {
                          s8 = peg$parseAnyWithoutTerminator();
                          if (s8 !== peg$FAILED) {
                            if (input.charCodeAt(peg$currPos) === 123) {
                              s9 = peg$c11;
                              peg$currPos++;
                            } else {
                              s9 = peg$FAILED;
                              if (peg$silentFails === 0) { peg$fail(peg$c12); }
                            }
                            if (s9 !== peg$FAILED) {
                              s10 = [];
                              s11 = peg$parseLB();
                              while (s11 !== peg$FAILED) {
                                s10.push(s11);
                                s11 = peg$parseLB();
                              }
                              if (s10 !== peg$FAILED) {
                                peg$savedPos = s0;
                                s1 = peg$c13(s1, s7);
                                s0 = s1;
                              } else {
                                peg$currPos = s0;
                                s0 = peg$FAILED;
                              }
                            } else {
                              peg$currPos = s0;
                              s0 = peg$FAILED;
                            }
                          } else {
                            peg$currPos = s0;
                            s0 = peg$FAILED;
                          }
                        } else {
                          peg$currPos = s0;
                          s0 = peg$FAILED;
                        }
                      } else {
                        peg$currPos = s0;
                        s0 = peg$FAILED;
                      }
                    } else {
                      peg$currPos = s0;
                      s0 = peg$FAILED;
                    }
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
            if (s0 === peg$FAILED) {
              s0 = peg$currPos;
              s1 = peg$parse_();
              if (s1 !== peg$FAILED) {
                if (input.charCodeAt(peg$currPos) === 125) {
                  s2 = peg$c14;
                  peg$currPos++;
                } else {
                  s2 = peg$FAILED;
                  if (peg$silentFails === 0) { peg$fail(peg$c15); }
                }
                if (s2 !== peg$FAILED) {
                  s3 = peg$parse_();
                  if (s3 !== peg$FAILED) {
                    s4 = [];
                    s5 = peg$parseLB();
                    while (s5 !== peg$FAILED) {
                      s4.push(s5);
                      s5 = peg$parseLB();
                    }
                    if (s4 !== peg$FAILED) {
                      peg$savedPos = s0;
                      s1 = peg$c16();
                      s0 = s1;
                    } else {
                      peg$currPos = s0;
                      s0 = peg$FAILED;
                    }
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
              if (s0 === peg$FAILED) {
                s0 = peg$currPos;
                s1 = peg$parseAnyWithoutLB();
                if (s1 !== peg$FAILED) {
                  s2 = [];
                  s3 = peg$parseLB();
                  if (s3 !== peg$FAILED) {
                    while (s3 !== peg$FAILED) {
                      s2.push(s3);
                      s3 = peg$parseLB();
                    }
                  } else {
                    s2 = peg$FAILED;
                  }
                  if (s2 !== peg$FAILED) {
                    peg$savedPos = s0;
                    s1 = peg$c17(s1);
                    s0 = s1;
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              }
            }
          }
        }

        return s0;
      }

      function peg$parseDataType() {
        var s0, s1, s2, s3, s4, s5, s6;

        s0 = peg$currPos;
        if (input.substr(peg$currPos, 4) === peg$c18) {
          s1 = peg$c18;
          peg$currPos += 4;
        } else {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c19); }
        }
        if (s1 !== peg$FAILED) {
          s2 = peg$parse_();
          if (s2 !== peg$FAILED) {
            if (input.charCodeAt(peg$currPos) === 60) {
              s3 = peg$c20;
              peg$currPos++;
            } else {
              s3 = peg$FAILED;
              if (peg$silentFails === 0) { peg$fail(peg$c21); }
            }
            if (s3 !== peg$FAILED) {
              s4 = peg$parseWord();
              if (s4 !== peg$FAILED) {
                s5 = peg$parse_();
                if (s5 !== peg$FAILED) {
                  if (input.charCodeAt(peg$currPos) === 62) {
                    s6 = peg$c22;
                    peg$currPos++;
                  } else {
                    s6 = peg$FAILED;
                    if (peg$silentFails === 0) { peg$fail(peg$c23); }
                  }
                  if (s6 !== peg$FAILED) {
                    peg$savedPos = s0;
                    s1 = peg$c24(s4);
                    s0 = s1;
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }
        if (s0 === peg$FAILED) {
          s0 = peg$currPos;
          s1 = peg$parseWord();
          if (s1 !== peg$FAILED) {
            peg$savedPos = s0;
            s1 = peg$c25(s1);
          }
          s0 = s1;
        }

        return s0;
      }

      function peg$parseDataTypeModifier() {
        var s0;

        if (input.substr(peg$currPos, 7) === peg$c4) {
          s0 = peg$c4;
          peg$currPos += 7;
        } else {
          s0 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c5); }
        }
        if (s0 === peg$FAILED) {
          if (input.substr(peg$currPos, 9) === peg$c26) {
            s0 = peg$c26;
            peg$currPos += 9;
          } else {
            s0 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c27); }
          }
          if (s0 === peg$FAILED) {
            if (input.substr(peg$currPos, 6) === peg$c7) {
              s0 = peg$c7;
              peg$currPos += 6;
            } else {
              s0 = peg$FAILED;
              if (peg$silentFails === 0) { peg$fail(peg$c8); }
            }
          }
        }

        return s0;
      }

      function peg$parseDefaultValue() {
        var s0, s1, s2, s3, s4;

        s0 = peg$currPos;
        s1 = peg$parse_();
        if (s1 !== peg$FAILED) {
          if (input.charCodeAt(peg$currPos) === 61) {
            s2 = peg$c28;
            peg$currPos++;
          } else {
            s2 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c29); }
          }
          if (s2 !== peg$FAILED) {
            s3 = peg$parse_();
            if (s3 !== peg$FAILED) {
              s4 = peg$parseWord();
              if (s4 !== peg$FAILED) {
                peg$savedPos = s0;
                s1 = peg$c30(s4);
                s0 = s1;
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }

        return s0;
      }

      function peg$parseComment() {
        var s0, s1, s2, s3, s4, s5, s6;

        s0 = peg$currPos;
        s1 = peg$parse_();
        if (s1 !== peg$FAILED) {
          if (input.substr(peg$currPos, 2) === peg$c31) {
            s2 = peg$c31;
            peg$currPos += 2;
          } else {
            s2 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c32); }
          }
          if (s2 !== peg$FAILED) {
            s3 = peg$parse_();
            if (s3 !== peg$FAILED) {
              s4 = peg$parseAnyWithoutLB();
              if (s4 !== peg$FAILED) {
                s5 = [];
                s6 = peg$parseLB();
                if (s6 !== peg$FAILED) {
                  while (s6 !== peg$FAILED) {
                    s5.push(s6);
                    s6 = peg$parseLB();
                  }
                } else {
                  s5 = peg$FAILED;
                }
                if (s5 !== peg$FAILED) {
                  peg$savedPos = s0;
                  s1 = peg$c33(s4);
                  s0 = s1;
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }
        if (s0 === peg$FAILED) {
          s0 = peg$currPos;
          s1 = peg$parse_();
          if (s1 !== peg$FAILED) {
            s2 = peg$parseCommentStart();
            if (s2 !== peg$FAILED) {
              s3 = peg$parseAnyWithoutCommentEnd();
              if (s3 !== peg$FAILED) {
                s4 = peg$parseCommentEnd();
                if (s4 !== peg$FAILED) {
                  s5 = [];
                  s6 = peg$parseLB();
                  while (s6 !== peg$FAILED) {
                    s5.push(s6);
                    s6 = peg$parseLB();
                  }
                  if (s5 !== peg$FAILED) {
                    peg$savedPos = s0;
                    s1 = peg$c34(s3);
                    s0 = s1;
                  } else {
                    peg$currPos = s0;
                    s0 = peg$FAILED;
                  }
                } else {
                  peg$currPos = s0;
                  s0 = peg$FAILED;
                }
              } else {
                peg$currPos = s0;
                s0 = peg$FAILED;
              }
            } else {
              peg$currPos = s0;
              s0 = peg$FAILED;
            }
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        }

        return s0;
      }

      function peg$parseCommentStart() {
        var s0, s1, s2, s3;

        s0 = peg$currPos;
        if (peg$c35.test(input.charAt(peg$currPos))) {
          s1 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c36); }
        }
        if (s1 !== peg$FAILED) {
          s2 = [];
          if (peg$c37.test(input.charAt(peg$currPos))) {
            s3 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s3 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c38); }
          }
          if (s3 !== peg$FAILED) {
            while (s3 !== peg$FAILED) {
              s2.push(s3);
              if (peg$c37.test(input.charAt(peg$currPos))) {
                s3 = input.charAt(peg$currPos);
                peg$currPos++;
              } else {
                s3 = peg$FAILED;
                if (peg$silentFails === 0) { peg$fail(peg$c38); }
              }
            }
          } else {
            s2 = peg$FAILED;
          }
          if (s2 !== peg$FAILED) {
            s1 = [s1, s2];
            s0 = s1;
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }

        return s0;
      }

      function peg$parseCommentEnd() {
        var s0, s1, s2;

        s0 = peg$currPos;
        s1 = [];
        if (peg$c37.test(input.charAt(peg$currPos))) {
          s2 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s2 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c38); }
        }
        if (s2 !== peg$FAILED) {
          while (s2 !== peg$FAILED) {
            s1.push(s2);
            if (peg$c37.test(input.charAt(peg$currPos))) {
              s2 = input.charAt(peg$currPos);
              peg$currPos++;
            } else {
              s2 = peg$FAILED;
              if (peg$silentFails === 0) { peg$fail(peg$c38); }
            }
          }
        } else {
          s1 = peg$FAILED;
        }
        if (s1 !== peg$FAILED) {
          if (peg$c35.test(input.charAt(peg$currPos))) {
            s2 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s2 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c36); }
          }
          if (s2 !== peg$FAILED) {
            s1 = [s1, s2];
            s0 = s1;
          } else {
            peg$currPos = s0;
            s0 = peg$FAILED;
          }
        } else {
          peg$currPos = s0;
          s0 = peg$FAILED;
        }

        return s0;
      }

      function peg$parseAnyWithoutCommentEnd() {
        var s0, s1, s2, s3, s4;

        s0 = peg$currPos;
        s1 = [];
        s2 = peg$currPos;
        s3 = peg$currPos;
        peg$silentFails++;
        if (input.substr(peg$currPos, 2) === peg$c39) {
          s4 = peg$c39;
          peg$currPos += 2;
        } else {
          s4 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c40); }
        }
        peg$silentFails--;
        if (s4 === peg$FAILED) {
          s3 = void 0;
        } else {
          peg$currPos = s3;
          s3 = peg$FAILED;
        }
        if (s3 !== peg$FAILED) {
          if (input.length > peg$currPos) {
            s4 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s4 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c41); }
          }
          if (s4 !== peg$FAILED) {
            s3 = [s3, s4];
            s2 = s3;
          } else {
            peg$currPos = s2;
            s2 = peg$FAILED;
          }
        } else {
          peg$currPos = s2;
          s2 = peg$FAILED;
        }
        while (s2 !== peg$FAILED) {
          s1.push(s2);
          s2 = peg$currPos;
          s3 = peg$currPos;
          peg$silentFails++;
          if (input.substr(peg$currPos, 2) === peg$c39) {
            s4 = peg$c39;
            peg$currPos += 2;
          } else {
            s4 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c40); }
          }
          peg$silentFails--;
          if (s4 === peg$FAILED) {
            s3 = void 0;
          } else {
            peg$currPos = s3;
            s3 = peg$FAILED;
          }
          if (s3 !== peg$FAILED) {
            if (input.length > peg$currPos) {
              s4 = input.charAt(peg$currPos);
              peg$currPos++;
            } else {
              s4 = peg$FAILED;
              if (peg$silentFails === 0) { peg$fail(peg$c41); }
            }
            if (s4 !== peg$FAILED) {
              s3 = [s3, s4];
              s2 = s3;
            } else {
              peg$currPos = s2;
              s2 = peg$FAILED;
            }
          } else {
            peg$currPos = s2;
            s2 = peg$FAILED;
          }
        }
        if (s1 !== peg$FAILED) {
          peg$savedPos = s0;
          s1 = peg$c42(s1);
        }
        s0 = s1;

        return s0;
      }

      function peg$parseWord() {
        var s0, s1, s2;

        s0 = peg$currPos;
        s1 = [];
        s2 = peg$parseCharacter();
        if (s2 !== peg$FAILED) {
          while (s2 !== peg$FAILED) {
            s1.push(s2);
            s2 = peg$parseCharacter();
          }
        } else {
          s1 = peg$FAILED;
        }
        if (s1 !== peg$FAILED) {
          peg$savedPos = s0;
          s1 = peg$c43(s1);
        }
        s0 = s1;

        return s0;
      }

      function peg$parseCharacter() {
        var s0;

        if (peg$c44.test(input.charAt(peg$currPos))) {
          s0 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s0 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c45); }
        }

        return s0;
      }

      function peg$parseWS() {
        var s0, s1;

        peg$silentFails++;
        if (peg$c47.test(input.charAt(peg$currPos))) {
          s0 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s0 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c48); }
        }
        peg$silentFails--;
        if (s0 === peg$FAILED) {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c46); }
        }

        return s0;
      }

      function peg$parse_() {
        var s0, s1;

        peg$silentFails++;
        s0 = [];
        s1 = peg$parseWS();
        while (s1 !== peg$FAILED) {
          s0.push(s1);
          s1 = peg$parseWS();
        }
        peg$silentFails--;
        if (s0 === peg$FAILED) {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c49); }
        }

        return s0;
      }

      function peg$parse__() {
        var s0, s1;

        peg$silentFails++;
        s0 = [];
        s1 = peg$parseWS();
        if (s1 !== peg$FAILED) {
          while (s1 !== peg$FAILED) {
            s0.push(s1);
            s1 = peg$parseWS();
          }
        } else {
          s0 = peg$FAILED;
        }
        peg$silentFails--;
        if (s0 === peg$FAILED) {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c50); }
        }

        return s0;
      }

      function peg$parseLB() {
        var s0;

        if (peg$c51.test(input.charAt(peg$currPos))) {
          s0 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s0 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c52); }
        }

        return s0;
      }

      function peg$parseAnyWithoutTerminator() {
        var s0, s1;

        s0 = [];
        if (peg$c53.test(input.charAt(peg$currPos))) {
          s1 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c54); }
        }
        while (s1 !== peg$FAILED) {
          s0.push(s1);
          if (peg$c53.test(input.charAt(peg$currPos))) {
            s1 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s1 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c54); }
          }
        }

        return s0;
      }

      function peg$parseAnyWithoutLB() {
        var s0, s1;

        s0 = [];
        if (peg$c55.test(input.charAt(peg$currPos))) {
          s1 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c56); }
        }
        while (s1 !== peg$FAILED) {
          s0.push(s1);
          if (peg$c55.test(input.charAt(peg$currPos))) {
            s1 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s1 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c56); }
          }
        }

        return s0;
      }

      function peg$parseAny() {
        var s0, s1;

        s0 = [];
        if (input.length > peg$currPos) {
          s1 = input.charAt(peg$currPos);
          peg$currPos++;
        } else {
          s1 = peg$FAILED;
          if (peg$silentFails === 0) { peg$fail(peg$c41); }
        }
        while (s1 !== peg$FAILED) {
          s0.push(s1);
          if (input.length > peg$currPos) {
            s1 = input.charAt(peg$currPos);
            peg$currPos++;
          } else {
            s1 = peg$FAILED;
            if (peg$silentFails === 0) { peg$fail(peg$c41); }
          }
        }

        return s0;
      }

      peg$result = peg$startRuleFunction();

      if (peg$result !== peg$FAILED && peg$currPos === input.length) {
        return peg$result;
      } else {
        if (peg$result !== peg$FAILED && peg$currPos < input.length) {
          peg$fail({ type: "end", description: "end of input" });
        }

        throw peg$buildException(
            null,
            peg$maxFailExpected,
            peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,
            peg$maxFailPos < input.length
                ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)
                : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)
        );
      }
    }

    return {
      SyntaxError: peg$SyntaxError,
      parse:       peg$parse
    };
  });
I$('55d56144588bf070fcaa6f8a541d9f62',[
  "Accept",
  "Accept-Charset",
  "Accept-Encoding",
  "Accept-Language",
  "Accept-Datetime",
  "Authorization",
  "Cache-Control",
  "Connection",
  "Cookie",
  "Content-Disposition",
  "Content-Length",
  "Content-MD5",
  "Content-Type",
  "Date",
  "Expect",
  "From",
  "Host",
  "If-Match",
  "If-Modified-Since",
  "If-None-Match",
  "If-Range",
  "If-Unmodified-Since",
  "Max-Forwards",
  "Origin",
  "Pragma",
  "Proxy-Authorization",
  "Range",
  "Referer",
  "TE",
  "User-Agent",
  "Upgrade",
  "Via",
  "Warning",
  "X-Requested-With",
  "DNT",
  "X-Forwarded-For",
  "X-Forwarded-Host",
  "X-Forwarded-Proto",
  "Front-End-Https",
  "X-Http-Method-Override",
  "X-ATT-DeviceId",
  "X-Wap-Profile",
  "Proxy-Connection",
  "X-UIDH",
  "X-Csrf-Token"
]);
I$('05f7800e1ab59353c18056fc4fba8b83',[
  "application/atom+xml",
  "application/ecmascript",
  "application/json",
  "application/javascript",
  "application/octet-stream",
  "application/ogg",
  "application/pdf",
  "application/postscript",
  "application/rdf+xml",
  "application/rss+xml",
  "application/soap+xml",
  "application/font-woff",
  "application/x-www-form-urlencoded",
  "application/x-yaml",
  "application/xhtml+xml",
  "application/xml",
  "application/xml-dtd",
  "application/xop+xml",
  "application/zip",
  "application/gzip",
  "audio/basic",
  "audio/L24",
  "audio/mp4",
  "audio/mpeg",
  "audio/ogg",
  "audio/vorbis",
  "audio/vnd.rn-realaudio",
  "audio/vnd.wave",
  "audio/webm",
  "image/gif",
  "image/jpeg",
  "image/pjpeg",
  "image/png",
  "image/svg+xml",
  "image/tiff",
  "message/http",
  "message/imdn+xml",
  "message/partial",
  "message/rfc822",
  "multipart/mixed",
  "multipart/alternative",
  "multipart/related",
  "multipart/form-data",
  "multipart/signed",
  "multipart/encrypted",
  "text/cmd",
  "text/css",
  "text/csv",
  "text/html",
  "text/plain",
  "text/vcard",
  "text/xml"
]);
I$('568ec88eab54cacd9c085e76e54cde59',function mockWorkerFunc() { //浏览器端

        var mockWorker = {
            getWorker: function (rootPath, constraints) {
                var s = [];
                s.push('importScripts(\'' + rootPath + '/src/lib/fb-modules/lib/mockjs/dist/mock.js\');');
                s.push('importScripts(\'' + rootPath + '/src/module/common/mockdata/mock_data_worker.js\');');
                s.push('importScripts(\'' + rootPath + '/src/lib/fb-modules/util/mock_data.js\');');
                constraints.forEach(function (item) {
                    if (item.type != 1) {
                        var body = item.function.replace(/NEI\.(id|str|chinese|email|url|num|bool|var|repeat|loop)\(([^()]*)\)/g, function ($0, $1, $2) {
                            return 'NEI.' + $1 + '(null, null' + ($2 ? ',' + $2 : '') + ')';
                        });
                        s.push('var ' + item.name + ' = function(){' + item.function + '};');
                    }
                });
               
                var blob = new Blob(s);
                var worker = new Worker(URL.createObjectURL(blob));
                return worker;
            },

            /**
             * 获取某个数据模型的 mock 数据
             * * @param {Array} constraints - 所有规则函数列表
             * @param {Number} id - 数据模型的 id
             * @param {Array} ds - 数据模型的数据源, 包括所有数据模型
             * 其他:
             * 环的检测: 在深度遍历的时候, 如果遍历的路径上第二次出现自定义的数据类型, 则说明存在环
             * 每次深度遍历完再进行广度遍历的时候(即遍历上一个结点的兄弟结点), 需要将上一次(同层级的)深度遍历时增加的结点去除
             * 这里使用一个小技巧, 把数组的长度更改为上一次(同层级的)深度遍历时的值就可以
             *
             * 处理逻辑：
             * 直接开启worker: 生成随机数据 -> 根据规则函数生成数据模型的mock数据 -> 合并
             */
            getDataTypeMockData: function (rootPath, constraints, id, ds, callback, errorback) {
                var worker = mockWorker.getWorker(rootPath, constraints);
                worker.onmessage = function (event) {
                    var data = JSON.parse(event.data);
                    if (data.error.length) {
                        errorback(data.error);
                    }
                    callback(data);
                };
                worker.onerror = function (event) {
                    errorback([event]);
                };
                var p = JSON.stringify([0, id, ds]);
                worker.postMessage(p);
            },
            getParameterMockData: function (rootPath, constraints, format, params, ds, callback, errorback) {
                var worker = mockWorker.getWorker(rootPath, constraints);
                worker.onmessage = function (event) {
                    var data = JSON.parse(event.data);
                    if (data.error.length) {
                        errorback(data.error);
                    }
                    callback(data);
                };
                worker.onerror = function (event) {
                    errorback([event]);
                };
                var p = JSON.stringify([1, format, params, ds]);
                worker.postMessage(p);
            },
            getDocMockData: function (rootPath, constraints, nodeParams, ds, callback, errorback) {
                var worker = mockWorker.getWorker(rootPath, constraints);
                worker.onmessage = function (event) {
                    var data = JSON.parse(event.data);
                    if (data.error.length) {
                        errorback(data.error);
                    }
                    callback(data);
                };
                worker.onerror = function (event) {
                    errorback([event]);
                };
                var p = JSON.stringify([2, nodeParams, ds]);
                worker.postMessage(p);
            }
        };
        return mockWorker;
    });
/**
@author	leeluolee
@version	0.4.3
@homepage	http://regularjs.github.io
*/
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define(factory);
	else if(typeof exports === 'object')
		exports["Regular"] = factory();
	else
		root["Regular"] = factory();
})(this, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;
/******/
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	var env =  __webpack_require__(1);
	var config = __webpack_require__(2); 
	var Regular = module.exports = __webpack_require__(3);
	var Parser = Regular.Parser;
	var Lexer = Regular.Lexer;

	if(env.browser){
	    __webpack_require__(6);
	    __webpack_require__(7);
	    __webpack_require__(8);
	    Regular.dom = __webpack_require__(4);
	}
	Regular.env = env;
	Regular.util = __webpack_require__(5);
	Regular.parse = function(str, options){
	  options = options || {};

	  if(options.BEGIN || options.END){
	    if(options.BEGIN) config.BEGIN = options.BEGIN;
	    if(options.END) config.END = options.END;
	    Lexer.setup();
	  }
	  var ast = new Parser(str).parse();
	  return !options.stringify? ast : JSON.stringify(ast);
	}




/***/ },
/* 1 */
/***/ function(module, exports, __webpack_require__) {

	// some fixture test;
	// ---------------
	var _ = __webpack_require__(5);
	exports.svg = (function(){
	  return typeof document !== "undefined" && document.implementation.hasFeature( "http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1" );
	})();


	exports.browser = typeof document !== "undefined" && document.nodeType;
	// whether have component in initializing
	exports.exprCache = _.cache(1000);
	exports.isRunning = false;


/***/ },
/* 2 */
/***/ function(module, exports, __webpack_require__) {

	
	module.exports = {
	  'BEGIN': '{',
	  'END': '}',
	  'PRECOMPILE': false
	}

/***/ },
/* 3 */
/***/ function(module, exports, __webpack_require__) {

	
	var env = __webpack_require__(1);
	var Lexer = __webpack_require__(12);
	var Parser = __webpack_require__(13);
	var config = __webpack_require__(2);
	var _ = __webpack_require__(5);
	var extend = __webpack_require__(14);
	var combine = {};
	if(env.browser){
	  var dom = __webpack_require__(4);
	  var walkers = __webpack_require__(9);
	  var Group = __webpack_require__(10);
	  var doc = dom.doc;
	  combine = __webpack_require__(15);
	}
	var events = __webpack_require__(16);
	var Watcher = __webpack_require__(17);
	var parse = __webpack_require__(18);
	var filter = __webpack_require__(19);


	/**
	* `Regular` is regularjs's NameSpace and BaseClass. Every Component is inherited from it
	* 
	* @class Regular
	* @module Regular
	* @constructor
	* @param {Object} options specification of the component
	*/
	var Regular = function(definition, options){
	  var prevRunning = env.isRunning;
	  env.isRunning = true;
	  var node, template;

	  definition = definition || {};
	  var usePrototyeString = typeof this.template === 'string' && !definition.template;
	  options = options || {};

	  definition.data = definition.data || {};
	  definition.computed = definition.computed || {};
	  definition.events = definition.events || {};
	  if(this.data) _.extend(definition.data, this.data);
	  if(this.computed) _.extend(definition.computed, this.computed);
	  if(this.events) _.extend(definition.events, this.events);

	  _.extend(this, definition, true);
	  if(this.$parent){
	     this.$parent._append(this);
	  }
	  this._children = [];
	  this.$refs = {};

	  template = this.template;

	  // template is a string (len < 16). we will find it container first
	  if((typeof template === 'string' && template.length < 16) && (node = dom.find(template))) {
	    template = node.innerHTML;
	  }
	  // if template is a xml
	  if(template && template.nodeType) template = template.innerHTML;
	  if(typeof template === 'string') {
	    template = new Parser(template).parse();
	    if(usePrototyeString) {
	    // avoid multiply compile
	      this.constructor.prototype.template = template;
	    }else{
	      delete this.template;
	    }
	  }

	  this.computed = handleComputed(this.computed);
	  this.$root = this.$root || this;
	  // if have events
	  if(this.events){
	    this.$on(this.events);
	  }
	  this.$emit("$config");
	  this.config && this.config(this.data);
	  this.$emit("$afterConfig");

	  var body = this._body;
	  this._body = null;

	  if(body && body.ast && body.ast.length){
	    this.$body = _.getCompileFn(body.ast, body.ctx , {
	      outer: this,
	      namespace: options.namespace,
	      extra: options.extra,
	      record: true
	    })
	  }
	  // handle computed
	  if(template){
	    this.group = this.$compile(template, {namespace: options.namespace});
	    combine.node(this);
	  }


	  if(!this.$parent) this.$update();
	  this.$ready = true;
	  this.$emit("$init");
	  if( this.init ) this.init(this.data);
	  this.$emit("$afterInit");

	  // @TODO: remove, maybe , there is no need to update after init; 
	  // if(this.$root === this) this.$update();
	  env.isRunning = prevRunning;

	  // children is not required;
	}


	walkers && (walkers.Regular = Regular);


	// description
	// -------------------------
	// 1. Regular and derived Class use same filter
	_.extend(Regular, {
	  // private data stuff
	  _directives: { __regexp__:[] },
	  _plugins: {},
	  _protoInheritCache: [ 'directive', 'use'] ,
	  __after__: function(supr, o) {

	    var template;
	    this.__after__ = supr.__after__;

	    // use name make the component global.
	    if(o.name) Regular.component(o.name, this);
	    // this.prototype.template = dom.initTemplate(o)
	    if(template = o.template){
	      var node, name;
	      if( typeof template === 'string' && template.length < 16 && ( node = dom.find( template )) ){
	        template = node ;
	      }

	      if(template && template.nodeType){
	        if(name = dom.attr(template, 'name')) Regular.component(name, this);
	        template = template.innerHTML;
	      } 

	      if(typeof template === 'string' ){
	        this.prototype.template = config.PRECOMPILE? new Parser(template).parse(): template;
	      }
	    }

	    if(o.computed) this.prototype.computed = handleComputed(o.computed);
	    // inherit directive and other config from supr
	    Regular._inheritConfig(this, supr);

	  },
	  /**
	   * Define a directive
	   *
	   * @method directive
	   * @return {Object} Copy of ...
	   */  
	  directive: function(name, cfg){

	    if(_.typeOf(name) === "object"){
	      for(var k in name){
	        if(name.hasOwnProperty(k)) this.directive(k, name[k]);
	      }
	      return this;
	    }
	    var type = _.typeOf(name);
	    var directives = this._directives, directive;
	    if(cfg == null){
	      if( type === "string" && (directive = directives[name]) ) return directive;
	      else{
	        var regexp = directives.__regexp__;
	        for(var i = 0, len = regexp.length; i < len ; i++){
	          directive = regexp[i];
	          var test = directive.regexp.test(name);
	          if(test) return directive;
	        }
	      }
	      return undefined;
	    }
	    if(typeof cfg === 'function') cfg = { link: cfg } 
	    if(type === 'string') directives[name] = cfg;
	    else if(type === 'regexp'){
	      cfg.regexp = name;
	      directives.__regexp__.push(cfg)
	    }
	    return this
	  },
	  plugin: function(name, fn){
	    var plugins = this._plugins;
	    if(fn == null) return plugins[name];
	    plugins[name] = fn;
	    return this;
	  },
	  use: function(fn){
	    if(typeof fn === "string") fn = Regular.plugin(fn);
	    if(typeof fn !== "function") return this;
	    fn(this, Regular);
	    return this;
	  },
	  // config the Regularjs's global
	  config: function(name, value){
	    var needGenLexer = false;
	    if(typeof name === "object"){
	      for(var i in name){
	        // if you config
	        if( i ==="END" || i==='BEGIN' )  needGenLexer = true;
	        config[i] = name[i];
	      }
	    }
	    if(needGenLexer) Lexer.setup();
	  },
	  expression: parse.expression,
	  Parser: Parser,
	  Lexer: Lexer,
	  _addProtoInheritCache: function(name, transform){
	    if( Array.isArray( name ) ){
	      return name.forEach(Regular._addProtoInheritCache);
	    }
	    var cacheKey = "_" + name + "s"
	    Regular._protoInheritCache.push(name)
	    Regular[cacheKey] = {};
	    if(Regular[name]) return;
	    Regular[name] = function(key, cfg){
	      var cache = this[cacheKey];

	      if(typeof key === "object"){
	        for(var i in key){
	          if(key.hasOwnProperty(i)) this[name](i, key[i]);
	        }
	        return this;
	      }
	      if(cfg == null) return cache[key];
	      cache[key] = transform? transform(cfg) : cfg;
	      return this;
	    }
	  },
	  _inheritConfig: function(self, supr){

	    // prototype inherit some Regular property
	    // so every Component will have own container to serve directive, filter etc..
	    var defs = Regular._protoInheritCache;
	    var keys = _.slice(defs);
	    keys.forEach(function(key){
	      self[key] = supr[key];
	      var cacheKey = '_' + key + 's';
	      if(supr[cacheKey]) self[cacheKey] = _.createObject(supr[cacheKey]);
	    })
	    return self;
	  }

	});

	extend(Regular);

	Regular._addProtoInheritCache("component")

	Regular._addProtoInheritCache("filter", function(cfg){
	  return typeof cfg === "function"? {get: cfg}: cfg;
	})


	events.mixTo(Regular);
	Watcher.mixTo(Regular);

	Regular.implement({
	  init: function(){},
	  config: function(){},
	  destroy: function(){
	    // destroy event wont propgation;
	    this.$emit("$destroy");
	    this.group && this.group.destroy(true);
	    this.group = null;
	    this.parentNode = null;
	    this._watchers = null;
	    this._children = [];
	    var parent = this.$parent;
	    if(parent){
	      var index = parent._children.indexOf(this);
	      parent._children.splice(index,1);
	    }
	    this.$parent = null;
	    this.$root = null;
	    this._handles = null;
	    this.$refs = null;
	  },

	  /**
	   * compile a block ast ; return a group;
	   * @param  {Array} parsed ast
	   * @param  {[type]} record
	   * @return {[type]}
	   */
	  $compile: function(ast, options){
	    options = options || {};
	    if(typeof ast === 'string'){
	      ast = new Parser(ast).parse()
	    }
	    var preExt = this.__ext__,
	      record = options.record, 
	      records;

	    if(options.extra) this.__ext__ = options.extra;

	    if(record) this._record();
	    var group = this._walk(ast, options);
	    if(record){
	      records = this._release();
	      var self = this;
	      if(records.length){
	        // auto destroy all wather;
	        group.ondestroy = function(){ self.$unwatch(records); }
	      }
	    }
	    if(options.extra) this.__ext__ = preExt;
	    return group;
	  },


	  /**
	   * create two-way binding with another component;
	   * *warn*: 
	   *   expr1 and expr2 must can operate set&get, for example: the 'a.b' or 'a[b + 1]' is set-able, but 'a.b + 1' is not, 
	   *   beacuse Regular dont know how to inverse set through the expression;
	   *   
	   *   if before $bind, two component's state is not sync, the component(passed param) will sync with the called component;
	   *
	   * *example: *
	   *
	   * ```javascript
	   * // in this example, we need to link two pager component
	   * var pager = new Pager({}) // pager compoennt
	   * var pager2 = new Pager({}) // another pager component
	   * pager.$bind(pager2, 'current'); // two way bind throw two component
	   * pager.$bind(pager2, 'total');   // 
	   * // or just
	   * pager.$bind(pager2, {"current": "current", "total": "total"}) 
	   * ```
	   * 
	   * @param  {Regular} component the
	   * @param  {String|Expression} expr1     required, self expr1 to operate binding
	   * @param  {String|Expression} expr2     optional, other component's expr to bind with, if not passed, the expr2 will use the expr1;
	   * @return          this;
	   */
	  $bind: function(component, expr1, expr2){
	    var type = _.typeOf(expr1);
	    if( expr1.type === 'expression' || type === 'string' ){
	      this._bind(component, expr1, expr2)
	    }else if( type === "array" ){ // multiply same path binding through array
	      for(var i = 0, len = expr1.length; i < len; i++){
	        this._bind(component, expr1[i]);
	      }
	    }else if(type === "object"){
	      for(var i in expr1) if(expr1.hasOwnProperty(i)){
	        this._bind(component, i, expr1[i]);
	      }
	    }
	    // digest
	    component.$update();
	    return this;
	  },
	  /**
	   * unbind one component( see $bind also)
	   *
	   * unbind will unbind all relation between two component
	   * 
	   * @param  {Regular} component [descriptionegular
	   * @return {This}    this
	   */
	  $unbind: function(){
	    // todo
	  },
	  $inject: combine.inject,
	  $mute: function(isMute){

	    isMute = !!isMute;

	    var needupdate = isMute === false && this._mute;

	    this._mute = !!isMute;

	    if(needupdate) this.$update();
	    return this;
	  },
	  // private bind logic
	  _bind: function(component, expr1, expr2){

	    var self = this;
	    // basic binding

	    if(!component || !(component instanceof Regular)) throw "$bind() should pass Regular component as first argument";
	    if(!expr1) throw "$bind() should  pass as least one expression to bind";

	    if(!expr2) expr2 = expr1;

	    expr1 = parse.expression( expr1 );
	    expr2 = parse.expression( expr2 );

	    // set is need to operate setting ;
	    if(expr2.set){
	      var wid1 = this.$watch( expr1, function(value){
	        component.$update(expr2, value)
	      });
	      component.$on('$destroy', function(){
	        self.$unwatch(wid1)
	      })
	    }
	    if(expr1.set){
	      var wid2 = component.$watch(expr2, function(value){
	        self.$update(expr1, value)
	      });
	      // when brother destroy, we unlink this watcher
	      this.$on('$destroy', component.$unwatch.bind(component,wid2))
	    }
	    // sync the component's state to called's state
	    expr2.set(component, expr1.get(this));
	  },
	  _walk: function(ast, arg1){
	    if( _.typeOf(ast) === 'array' ){
	      var res = [];

	      for(var i = 0, len = ast.length; i < len; i++){
	        res.push( this._walk(ast[i], arg1) );
	      }

	      return new Group(res);
	    }
	    if(typeof ast === 'string') return doc.createTextNode(ast)
	    return walkers[ast.type || "default"].call(this, ast, arg1);
	  },
	  _append: function(component){
	    this._children.push(component);
	    component.$parent = this;
	  },
	  _handleEvent: function(elem, type, value, attrs){
	    var Component = this.constructor,
	      fire = typeof value !== "function"? _.handleEvent.call( this, value, type ) : value,
	      handler = Component.event(type), destroy;

	    if ( handler ) {
	      destroy = handler.call(this, elem, fire, attrs);
	    } else {
	      dom.on(elem, type, fire);
	    }
	    return handler ? destroy : function() {
	      dom.off(elem, type, fire);
	    }
	  },
	  // 1. 用来处理exprBody -> Function
	  // 2. list里的循环
	  _touchExpr: function(expr){
	    var  rawget, ext = this.__ext__, touched = {};
	    if(expr.type !== 'expression' || expr.touched) return expr;
	    rawget = expr.get || (expr.get = new Function(_.ctxName, _.extName , _.prefix+ "return (" + expr.body + ")"));
	    touched.get = !ext? rawget: function(context){
	      return rawget(context, ext)
	    }

	    if(expr.setbody && !expr.set){
	      var setbody = expr.setbody;
	      expr.set = function(ctx, value, ext){
	        expr.set = new Function(_.ctxName, _.setName , _.extName, _.prefix + setbody);          
	        return expr.set(ctx, value, ext);
	      }
	      expr.setbody = null;
	    }
	    if(expr.set){
	      touched.set = !ext? expr.set : function(ctx, value){
	        return expr.set(ctx, value, ext);
	      }
	    }
	    _.extend(touched, {
	      type: 'expression',
	      touched: true,
	      once: expr.once || expr.constant
	    })
	    return touched
	  },
	  // find filter
	  _f_: function(name){
	    var Component = this.constructor;
	    var filter = Component.filter(name);
	    if(!filter) throw Error('filter ' + name + ' is undefined');
	    return filter;
	  },
	  // simple accessor get
	  _sg_:function(path, defaults, ext){
	    if(typeof ext !== 'undefined'){
	      // if(path === "demos")  debugger
	      var computed = this.computed,
	        computedProperty = computed[path];
	      if(computedProperty){
	        if(computedProperty.type==='expression' && !computedProperty.get) this._touchExpr(computedProperty);
	        if(computedProperty.get)  return computedProperty.get(this);
	        else _.log("the computed '" + path + "' don't define the get function,  get data."+path + " altnately", "warn")
	      }
	  }
	    if(typeof defaults === "undefined" || typeof path == "undefined" ){
	      return undefined;
	    }
	    return (ext && typeof ext[path] !== 'undefined')? ext[path]: defaults[path];

	  },
	  // simple accessor set
	  _ss_:function(path, value, data , op, computed){
	    var computed = this.computed,
	      op = op || "=", prev, 
	      computedProperty = computed? computed[path]:null;

	    if(op !== '='){
	      prev = computedProperty? computedProperty.get(this): data[path];
	      switch(op){
	        case "+=":
	          value = prev + value;
	          break;
	        case "-=":
	          value = prev - value;
	          break;
	        case "*=":
	          value = prev * value;
	          break;
	        case "/=":
	          value = prev / value;
	          break;
	        case "%=":
	          value = prev % value;
	          break;
	      }
	    }
	    if(computedProperty) {
	      if(computedProperty.set) return computedProperty.set(this, value);
	      else _.log("the computed '" + path + "' don't define the set function,  assign data."+path + " altnately", "warn" )
	    }
	    data[path] = value;
	    return value;
	  }
	});

	Regular.prototype.inject = function(){
	  _.log("use $inject instead of inject", "error");
	  return this.$inject.apply(this, arguments);
	}


	// only one builtin filter

	Regular.filter(filter);

	module.exports = Regular;



	var handleComputed = (function(){
	  // wrap the computed getter;
	  function wrapGet(get){
	    return function(context){
	      return get.call(context, context.data );
	    }
	  }
	  // wrap the computed setter;
	  function wrapSet(set){
	    return function(context, value){
	      set.call( context, value, context.data );
	      return value;
	    }
	  }

	  return function(computed){
	    if(!computed) return;
	    var parsedComputed = {}, handle, pair, type;
	    for(var i in computed){
	      handle = computed[i]
	      type = typeof handle;

	      if(handle.type === 'expression'){
	        parsedComputed[i] = handle;
	        continue;
	      }
	      if( type === "string" ){
	        parsedComputed[i] = parse.expression(handle)
	      }else{
	        pair = parsedComputed[i] = {type: 'expression'};
	        if(type === "function" ){
	          pair.get = wrapGet(handle);
	        }else{
	          if(handle.get) pair.get = wrapGet(handle.get);
	          if(handle.set) pair.set = wrapSet(handle.set);
	        }
	      } 
	    }
	    return parsedComputed;
	  }
	})();


/***/ },
/* 4 */
/***/ function(module, exports, __webpack_require__) {

	
	// thanks for angular && mootools for some concise&cross-platform  implemention
	// =====================================

	// The MIT License
	// Copyright (c) 2010-2014 Google, Inc. http://angularjs.org

	// ---
	// license: MIT-style license. http://mootools.net


	var dom = module.exports;
	var env = __webpack_require__(1);
	var _ = __webpack_require__(5);
	var consts = __webpack_require__(11);
	var tNode = document.createElement('div')
	var addEvent, removeEvent;
	var noop = function(){}

	var namespaces = consts.NAMESPACE;

	dom.body = document.body;

	dom.doc = document;

	// camelCase
	function camelCase(str){
	  return ("" + str).replace(/-\D/g, function(match){
	    return match.charAt(1).toUpperCase();
	  });
	}


	dom.tNode = tNode;

	if(tNode.addEventListener){
	  addEvent = function(node, type, fn) {
	    node.addEventListener(type, fn, false);
	  }
	  removeEvent = function(node, type, fn) {
	    node.removeEventListener(type, fn, false) 
	  }
	}else{
	  addEvent = function(node, type, fn) {
	    node.attachEvent('on' + type, fn);
	  }
	  removeEvent = function(node, type, fn) {
	    node.detachEvent('on' + type, fn); 
	  }
	}


	dom.msie = parseInt((/msie (\d+)/.exec(navigator.userAgent.toLowerCase()) || [])[1]);
	if (isNaN(dom.msie)) {
	  dom.msie = parseInt((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase()) || [])[1]);
	}

	dom.find = function(sl){
	  if(document.querySelector) {
	    try{
	      return document.querySelector(sl);
	    }catch(e){

	    }
	  }
	  if(sl.indexOf('#')!==-1) return document.getElementById( sl.slice(1) );
	}


	dom.inject = function(node, refer, position){

	  position = position || 'bottom';
	  if(!node) return ;
	  if(Array.isArray(node)){
	    var tmp = node;
	    node = dom.fragment();
	    for(var i = 0,len = tmp.length; i < len ;i++){
	      node.appendChild(tmp[i])
	    }
	  }

	  var firstChild, next;
	  switch(position){
	    case 'bottom':
	      refer.appendChild( node );
	      break;
	    case 'top':
	      if( firstChild = refer.firstChild ){
	        refer.insertBefore( node, refer.firstChild );
	      }else{
	        refer.appendChild( node );
	      }
	      break;
	    case 'after':
	      if( next = refer.nextSibling ){
	        next.parentNode.insertBefore( node, next );
	      }else{
	        refer.parentNode.appendChild( node );
	      }
	      break;
	    case 'before':
	      refer.parentNode.insertBefore( node, refer );
	  }
	}


	dom.id = function(id){
	  return document.getElementById(id);
	}

	// createElement 
	dom.create = function(type, ns, attrs){
	  if(ns === 'svg'){
	    if(!env.svg) throw Error('the env need svg support')
	    ns = namespaces.svg;
	  }
	  return !ns? document.createElement(type): document.createElementNS(ns, type);
	}

	// documentFragment
	dom.fragment = function(){
	  return document.createDocumentFragment();
	}



	var specialAttr = {
	  'class': function(node, value){
	     ('className' in node && (!node.namespaceURI || node.namespaceURI === namespaces.html  )) ? 
	      node.className = (value || '') : node.setAttribute('class', value);
	  },
	  'for': function(node, value){
	    ('htmlFor' in node) ? node.htmlFor = value : node.setAttribute('for', value);
	  },
	  'style': function(node, value){
	    (node.style) ? node.style.cssText = value : node.setAttribute('style', value);
	  },
	  'value': function(node, value){
	    node.value = (value != null) ? value : '';
	  }
	}


	// attribute Setter & Getter
	dom.attr = function(node, name, value){
	  if (_.isBooleanAttr(name)) {
	    if (typeof value !== 'undefined') {
	      if (!!value) {
	        node[name] = true;
	        node.setAttribute(name, name);
	        // lt ie7 . the javascript checked setting is in valid
	        //http://bytes.com/topic/javascript/insights/799167-browser-quirk-dynamically-appended-checked-checkbox-does-not-appear-checked-ie
	        if(dom.msie && dom.msie <=7 ) node.defaultChecked = true
	      } else {
	        node[name] = false;
	        node.removeAttribute(name);
	      }
	    } else {
	      return (node[name] ||
	               (node.attributes.getNamedItem(name)|| noop).specified) ? name : undefined;
	    }
	  } else if (typeof (value) !== 'undefined') {
	    // if in specialAttr;
	    if(specialAttr[name]) specialAttr[name](node, value);
	    else if(value === null) node.removeAttribute(name)
	    else node.setAttribute(name, value);
	  } else if (node.getAttribute) {
	    // the extra argument "2" is to get the right thing for a.href in IE, see jQuery code
	    // some elements (e.g. Document) don't have get attribute, so return undefined
	    var ret = node.getAttribute(name, 2);
	    // normalize non-existing attributes to undefined (as jQuery)
	    return ret === null ? undefined : ret;
	  }
	}


	dom.on = function(node, type, handler){
	  var types = type.split(' ');
	  handler.real = function(ev){
	    var $event = new Event(ev);
	    $event.origin = node;
	    handler.call(node, $event);
	  }
	  types.forEach(function(type){
	    type = fixEventName(node, type);
	    addEvent(node, type, handler.real);
	  });
	}
	dom.off = function(node, type, handler){
	  var types = type.split(' ');
	  handler = handler.real || handler;
	  types.forEach(function(type){
	    type = fixEventName(node, type);
	    removeEvent(node, type, handler);
	  })
	}


	dom.text = (function (){
	  var map = {};
	  if (dom.msie && dom.msie < 9) {
	    map[1] = 'innerText';    
	    map[3] = 'nodeValue';    
	  } else {
	    map[1] = map[3] = 'textContent';
	  }
	  
	  return function (node, value) {
	    var textProp = map[node.nodeType];
	    if (value == null) {
	      return textProp ? node[textProp] : '';
	    }
	    node[textProp] = value;
	  }
	})();


	dom.html = function( node, html ){
	  if(typeof html === "undefined"){
	    return node.innerHTML;
	  }else{
	    node.innerHTML = html;
	  }
	}

	dom.replace = function(node, replaced){
	  if(replaced.parentNode) replaced.parentNode.replaceChild(node, replaced);
	}

	dom.remove = function(node){
	  if(node.parentNode) node.parentNode.removeChild(node);
	}

	// css Settle & Getter from angular
	// =================================
	// it isnt computed style 
	dom.css = function(node, name, value){
	  if( _.typeOf(name) === "object" ){
	    for(var i in name){
	      if( name.hasOwnProperty(i) ){
	        dom.css( node, i, name[i] );
	      }
	    }
	    return;
	  }
	  if ( typeof value !== "undefined" ) {

	    name = camelCase(name);
	    if(name) node.style[name] = value;

	  } else {

	    var val;
	    if (dom.msie <= 8) {
	      // this is some IE specific weirdness that jQuery 1.6.4 does not sure why
	      val = node.currentStyle && node.currentStyle[name];
	      if (val === '') val = 'auto';
	    }
	    val = val || node.style[name];
	    if (dom.msie <= 8) {
	      val = val === '' ? undefined : val;
	    }
	    return  val;
	  }
	}

	dom.addClass = function(node, className){
	  var current = node.className || "";
	  if ((" " + current + " ").indexOf(" " + className + " ") === -1) {
	    node.className = current? ( current + " " + className ) : className;
	  }
	}

	dom.delClass = function(node, className){
	  var current = node.className || "";
	  node.className = (" " + current + " ").replace(" " + className + " ", " ").trim();
	}

	dom.hasClass = function(node, className){
	  var current = node.className || "";
	  return (" " + current + " ").indexOf(" " + className + " ") !== -1;
	}



	// simple Event wrap

	//http://stackoverflow.com/questions/11068196/ie8-ie7-onchange-event-is-emited-only-after-repeated-selection
	function fixEventName(elem, name){
	  return (name === 'change'  &&  dom.msie < 9 && 
	      (elem && elem.tagName && elem.tagName.toLowerCase()==='input' && 
	        (elem.type === 'checkbox' || elem.type === 'radio')
	      )
	    )? 'click': name;
	}

	var rMouseEvent = /^(?:click|dblclick|contextmenu|DOMMouseScroll|mouse(?:\w+))$/
	var doc = document;
	doc = (!doc.compatMode || doc.compatMode === 'CSS1Compat') ? doc.documentElement : doc.body;
	function Event(ev){
	  ev = ev || window.event;
	  if(ev._fixed) return ev;
	  this.event = ev;
	  this.target = ev.target || ev.srcElement;

	  var type = this.type = ev.type;
	  var button = this.button = ev.button;

	  // if is mouse event patch pageX
	  if(rMouseEvent.test(type)){ //fix pageX
	    this.pageX = (ev.pageX != null) ? ev.pageX : ev.clientX + doc.scrollLeft;
	    this.pageY = (ev.pageX != null) ? ev.pageY : ev.clientY + doc.scrollTop;
	    if (type === 'mouseover' || type === 'mouseout'){// fix relatedTarget
	      var related = ev.relatedTarget || ev[(type === 'mouseover' ? 'from' : 'to') + 'Element'];
	      while (related && related.nodeType === 3) related = related.parentNode;
	      this.relatedTarget = related;
	    }
	  }
	  // if is mousescroll
	  if (type === 'DOMMouseScroll' || type === 'mousewheel'){
	    // ff ev.detail: 3    other ev.wheelDelta: -120
	    this.wheelDelta = (ev.wheelDelta) ? ev.wheelDelta / 120 : -(ev.detail || 0) / 3;
	  }
	  
	  // fix which
	  this.which = ev.which || ev.keyCode;
	  if( !this.which && button !== undefined){
	    // http://api.jquery.com/event.which/ use which
	    this.which = ( button & 1 ? 1 : ( button & 2 ? 3 : ( button & 4 ? 2 : 0 ) ) );
	  }
	  this._fixed = true;
	}

	_.extend(Event.prototype, {
	  immediateStop: _.isFalse,
	  stop: function(){
	    this.preventDefault().stopPropagation();
	  },
	  preventDefault: function(){
	    if (this.event.preventDefault) this.event.preventDefault();
	    else this.event.returnValue = false;
	    return this;
	  },
	  stopPropagation: function(){
	    if (this.event.stopPropagation) this.event.stopPropagation();
	    else this.event.cancelBubble = true;
	    return this;
	  },
	  stopImmediatePropagation: function(){
	    if(this.event.stopImmediatePropagation) this.event.stopImmediatePropagation();
	  }
	})


	dom.nextFrame = (function(){
	    var request = window.requestAnimationFrame ||
	                  window.webkitRequestAnimationFrame ||
	                  window.mozRequestAnimationFrame|| 
	                  function(callback){
	                    setTimeout(callback, 16)
	                  }

	    var cancel = window.cancelAnimationFrame ||
	                 window.webkitCancelAnimationFrame ||
	                 window.mozCancelAnimationFrame ||
	                 window.webkitCancelRequestAnimationFrame ||
	                 function(tid){
	                    clearTimeout(tid)
	                 }
	  
	  return function(callback){
	    var id = request(callback);
	    return function(){ cancel(id); }
	  }
	})();

	// 3ks for angular's raf  service
	var k
	dom.nextReflow = dom.msie? function(callback){
	  return dom.nextFrame(function(){
	    k = document.body.offsetWidth;
	    callback();
	  })
	}: dom.nextFrame;





/***/ },
/* 5 */
/***/ function(module, exports, __webpack_require__) {

	/* WEBPACK VAR INJECTION */(function(global) {__webpack_require__(20)();



	var _  = module.exports;
	var entities = __webpack_require__(21);
	var slice = [].slice;
	var o2str = ({}).toString;
	var win = typeof window !=='undefined'? window: global;


	_.noop = function(){};
	_.uid = (function(){
	  var _uid=0;
	  return function(){
	    return _uid++;
	  }
	})();

	_.extend = function( o1, o2, override ){
	  // if(_.typeOf(override) === 'array'){
	  //  for(var i = 0, len = override.length; i < len; i++ ){
	  //   var key = override[i];
	  //   o1[key] = o2[key];
	  //  } 
	  // }else{
	  for(var i in o2){
	    if( typeof o1[i] === "undefined" || override === true ){
	      o1[i] = o2[i]
	    }
	  }
	  // }
	  return o1;
	}

	_.keys = function(obj){
	  if(Object.keys) return Object.keys(obj);
	  var res = [];
	  for(var i in obj) if(obj.hasOwnProperty(i)){
	    res.push(i);
	  }
	  return res;
	}

	_.varName = 'd';
	_.setName = 'p_';
	_.ctxName = 'c';
	_.extName = 'e';

	_.rWord = /^[\$\w]+$/;
	_.rSimpleAccessor = /^[\$\w]+(\.[\$\w]+)*$/;

	_.nextTick = typeof setImmediate === 'function'? 
	  setImmediate.bind(win) : 
	  function(callback) {
	    setTimeout(callback, 0) 
	  }



	_.prefix = "var " + _.varName + "=" + _.ctxName + ".data;" +  _.extName  + "=" + _.extName + "||'';";


	_.slice = function(obj, start, end){
	  var res = [];
	  for(var i = start || 0, len = end || obj.length; i < len; i++){
	    var item = obj[i];
	    res.push(item)
	  }
	  return res;
	}

	_.typeOf = function (o) {
	  return o == null ? String(o) :o2str.call(o).slice(8, -1).toLowerCase();
	}


	_.makePredicate = function makePredicate(words, prefix) {
	    if (typeof words === "string") {
	        words = words.split(" ");
	    }
	    var f = "",
	    cats = [];
	    out: for (var i = 0; i < words.length; ++i) {
	        for (var j = 0; j < cats.length; ++j){
	          if (cats[j][0].length === words[i].length) {
	              cats[j].push(words[i]);
	              continue out;
	          }
	        }
	        cats.push([words[i]]);
	    }
	    function compareTo(arr) {
	        if (arr.length === 1) return f += "return str === '" + arr[0] + "';";
	        f += "switch(str){";
	        for (var i = 0; i < arr.length; ++i){
	           f += "case '" + arr[i] + "':";
	        }
	        f += "return true}return false;";
	    }

	    // When there are more than three length categories, an outer
	    // switch first dispatches on the lengths, to save on comparisons.
	    if (cats.length > 3) {
	        cats.sort(function(a, b) {
	            return b.length - a.length;
	        });
	        f += "switch(str.length){";
	        for (var i = 0; i < cats.length; ++i) {
	            var cat = cats[i];
	            f += "case " + cat[0].length + ":";
	            compareTo(cat);
	        }
	        f += "}";

	        // Otherwise, simply generate a flat `switch` statement.
	    } else {
	        compareTo(words);
	    }
	    return new Function("str", f);
	}


	_.trackErrorPos = (function (){
	  // linebreak
	  var lb = /\r\n|[\n\r\u2028\u2029]/g;
	  var minRange = 20, maxRange = 20;
	  function findLine(lines, pos){
	    var tmpLen = 0;
	    for(var i = 0,len = lines.length; i < len; i++){
	      var lineLen = (lines[i] || "").length;

	      if(tmpLen + lineLen > pos) {
	        return {num: i, line: lines[i], start: pos - i - tmpLen , prev:lines[i-1], next: lines[i+1] };
	      }
	      // 1 is for the linebreak
	      tmpLen = tmpLen + lineLen ;
	    }
	  }
	  function formatLine(str,  start, num, target){
	    var len = str.length;
	    var min = start - minRange;
	    if(min < 0) min = 0;
	    var max = start + maxRange;
	    if(max > len) max = len;

	    var remain = str.slice(min, max);
	    var prefix = "[" +(num+1) + "] " + (min > 0? ".." : "")
	    var postfix = max < len ? "..": "";
	    var res = prefix + remain + postfix;
	    if(target) res += "\n" + new Array(start-min + prefix.length + 1).join(" ") + "^^^";
	    return res;
	  }
	  return function(input, pos){
	    if(pos > input.length-1) pos = input.length-1;
	    lb.lastIndex = 0;
	    var lines = input.split(lb);
	    var line = findLine(lines,pos);
	    var start = line.start, num = line.num;

	    return (line.prev? formatLine(line.prev, start, num-1 ) + '\n': '' ) + 
	      formatLine(line.line, start, num, true) + '\n' + 
	      (line.next? formatLine(line.next, start, num+1 ) + '\n': '' );

	  }
	})();


	var ignoredRef = /\((\?\!|\?\:|\?\=)/g;
	_.findSubCapture = function (regStr) {
	  var left = 0,
	    right = 0,
	    len = regStr.length,
	    ignored = regStr.match(ignoredRef); // ignored uncapture
	  if(ignored) ignored = ignored.length
	  else ignored = 0;
	  for (; len--;) {
	    var letter = regStr.charAt(len);
	    if (len === 0 || regStr.charAt(len - 1) !== "\\" ) { 
	      if (letter === "(") left++;
	      if (letter === ")") right++;
	    }
	  }
	  if (left !== right) throw "RegExp: "+ regStr + "'s bracket is not marched";
	  else return left - ignored;
	};


	_.escapeRegExp = function( str){// Credit: XRegExp 0.6.1 (c) 2007-2008 Steven Levithan <http://stevenlevithan.com/regex/xregexp/> MIT License
	  return str.replace(/[-[\]{}()*+?.\\^$|,#\s]/g, function(match){
	    return '\\' + match;
	  });
	};


	var rEntity = new RegExp("&(?:(#x[0-9a-fA-F]+)|(#[0-9]+)|(" + _.keys(entities).join('|') + '));', 'gi');

	_.convertEntity = function(chr){

	  return ("" + chr).replace(rEntity, function(all, hex, dec, capture){
	    var charCode;
	    if( dec ) charCode = parseInt( dec.slice(1), 10 );
	    else if( hex ) charCode = parseInt( hex.slice(2), 16 );
	    else charCode = entities[capture]

	    return String.fromCharCode( charCode )
	  });

	}


	// simple get accessor

	_.createObject = function(o, props){
	    function Foo() {}
	    Foo.prototype = o;
	    var res = new Foo;
	    if(props) _.extend(res, props);
	    return res;
	}

	_.createProto = function(fn, o){
	    function Foo() { this.constructor = fn;}
	    Foo.prototype = o;
	    return (fn.prototype = new Foo());
	}



	/**
	clone
	*/
	_.clone = function clone(obj){
	    var type = _.typeOf(obj);
	    if(type === 'array'){
	      var cloned = [];
	      for(var i=0,len = obj.length; i< len;i++){
	        cloned[i] = obj[i]
	      }
	      return cloned;
	    }
	    if(type === 'object'){
	      var cloned = {};
	      for(var i in obj) if(obj.hasOwnProperty(i)){
	        cloned[i] = obj[i];
	      }
	      return cloned;
	    }
	    return obj;
	  }

	_.equals = function(now, old){
	  var type = typeof now;
	  if(type === 'number' && typeof old === 'number'&& isNaN(now) && isNaN(old)) return true
	  return now === old;
	}

	var dash = /-([a-z])/g;
	_.camelCase = function(str){
	  return str.replace(dash, function(all, capture){
	    return capture.toUpperCase();
	  })
	}



	_.throttle = function throttle(func, wait){
	  var wait = wait || 100;
	  var context, args, result;
	  var timeout = null;
	  var previous = 0;
	  var later = function() {
	    previous = +new Date;
	    timeout = null;
	    result = func.apply(context, args);
	    context = args = null;
	  };
	  return function() {
	    var now = + new Date;
	    var remaining = wait - (now - previous);
	    context = this;
	    args = arguments;
	    if (remaining <= 0 || remaining > wait) {
	      clearTimeout(timeout);
	      timeout = null;
	      previous = now;
	      result = func.apply(context, args);
	      context = args = null;
	    } else if (!timeout) {
	      timeout = setTimeout(later, remaining);
	    }
	    return result;
	  };
	};

	// hogan escape
	// ==============
	_.escape = (function(){
	  var rAmp = /&/g,
	      rLt = /</g,
	      rGt = />/g,
	      rApos = /\'/g,
	      rQuot = /\"/g,
	      hChars = /[&<>\"\']/;

	  return function(str) {
	    return hChars.test(str) ?
	      str
	        .replace(rAmp, '&amp;')
	        .replace(rLt, '&lt;')
	        .replace(rGt, '&gt;')
	        .replace(rApos, '&#39;')
	        .replace(rQuot, '&quot;') :
	      str;
	  }
	})();

	_.cache = function(max){
	  max = max || 1000;
	  var keys = [],
	      cache = {};
	  return {
	    set: function(key, value) {
	      if (keys.length > this.max) {
	        cache[keys.shift()] = undefined;
	      }
	      // 
	      if(cache[key] === undefined){
	        keys.push(key);
	      }
	      cache[key] = value;
	      return value;
	    },
	    get: function(key) {
	      if (key === undefined) return cache;
	      return cache[key];
	    },
	    max: max,
	    len:function(){
	      return keys.length;
	    }
	  };
	}

	// // setup the raw Expression
	// _.touchExpression = function(expr){
	//   if(expr.type === 'expression'){
	//   }
	//   return expr;
	// }


	// handle the same logic on component's `on-*` and element's `on-*`
	// return the fire object
	_.handleEvent = function(value, type ){
	  var self = this, evaluate;
	  if(value.type === 'expression'){ // if is expression, go evaluated way
	    evaluate = value.get;
	  }
	  if(evaluate){
	    return function fire(obj){
	      self.$update(function(){
	        var data = this.data;
	        data.$event = obj;
	        var res = evaluate(self);
	        if(res === false && obj && obj.preventDefault) obj.preventDefault();
	        data.$event = undefined;
	      })

	    }
	  }else{
	    return function fire(){
	      var args = slice.call(arguments)      
	      args.unshift(value);
	      self.$update(function(){
	        self.$emit.apply(self, args);
	      })
	    }
	  }
	}

	// only call once
	_.once = function(fn){
	  var time = 0;
	  return function(){
	    if( time++ === 0) fn.apply(this, arguments);
	  }
	}

	_.fixObjStr = function(str){
	  if(str.trim().indexOf('{') !== 0){
	    return '{' + str + '}';
	  }
	  return str;
	}


	_.map= function(array, callback){
	  var res = [];
	  for (var i = 0, len = array.length; i < len; i++) {
	    res.push(callback(array[i], i));
	  }
	  return res;
	}

	function log(msg, type){
	  if(typeof console !== "undefined")  console[type || "log"](msg);
	}

	_.log = log;




	//http://www.w3.org/html/wg/drafts/html/master/single-page.html#void-elements
	_.isVoidTag = _.makePredicate("area base br col embed hr img input keygen link menuitem meta param source track wbr r-content");
	_.isBooleanAttr = _.makePredicate('selected checked disabled readonly required open autofocus controls autoplay compact loop defer multiple');

	_.isFalse - function(){return false}
	_.isTrue - function(){return true}

	_.isExpr = function(expr){
	  return expr && expr.type === 'expression';
	}
	// @TODO: make it more strict
	_.isGroup = function(group){
	  return group.inject || group.$inject;
	}

	_.getCompileFn = function(source, ctx, options){
	  return ctx.$compile.bind(ctx,source, options)
	}





	
	/* WEBPACK VAR INJECTION */}.call(exports, (function() { return this; }())))

/***/ },
/* 6 */
/***/ function(module, exports, __webpack_require__) {

	// Regular
	var _ = __webpack_require__(5);
	var dom = __webpack_require__(4);
	var animate = __webpack_require__(22);
	var Regular = __webpack_require__(3);
	var consts = __webpack_require__(11);
	var namespaces = consts.NAMESPACE;




	__webpack_require__(23);
	__webpack_require__(24);


	module.exports = {
	// **warn**: class inteplation will override this directive 
	  'r-class': function(elem, value){

	    if(typeof value=== 'string'){
	      value = _.fixObjStr(value)
	    }
	    var isNotHtml = elem.namespaceURI && elem.namespaceURI !== namespaces.html ;
	    this.$watch(value, function(nvalue){
	      var className = isNotHtml? elem.getAttribute('class'): elem.className;
	      className = ' '+ (className||'').replace(/\s+/g, ' ') +' ';
	      for(var i in nvalue) if(nvalue.hasOwnProperty(i)){
	        className = className.replace(' ' + i + ' ',' ');
	        if(nvalue[i] === true){
	          className += i+' ';
	        }
	      }
	      className = className.trim();
	      if(isNotHtml){
	        dom.attr(elem, 'class', className)
	      }else{
	        elem.className = className
	      }
	    },true);
	  },
	  // **warn**: style inteplation will override this directive 
	  'r-style': function(elem, value){
	    if(typeof value=== 'string'){
	      value = _.fixObjStr(value)
	    }
	    this.$watch(value, function(nvalue){
	      for(var i in nvalue) if(nvalue.hasOwnProperty(i)){
	        dom.css(elem, i, nvalue[i]);
	      }
	    },true);
	  },
	  // when expression is evaluate to true, the elem will add display:none
	  // Example: <div r-hide={{items.length > 0}}></div>
	  'r-hide': function(elem, value){
	    var preBool = null, compelete;
	    if( _.isExpr(value) || typeof value === "string"){
	      this.$watch(value, function(nvalue){
	        var bool = !!nvalue;
	        if(bool === preBool) return; 
	        preBool = bool;
	        if(bool){
	          if(elem.onleave){
	            compelete = elem.onleave(function(){
	              elem.style.display = "none"
	              compelete = null;
	            })
	          }else{
	            elem.style.display = "none"
	          }
	          
	        }else{
	          if(compelete) compelete();
	          elem.style.display = "";
	          if(elem.onenter){
	            elem.onenter();
	          }
	        }
	      });
	    }else if(!!value){
	      elem.style.display = "none";
	    }
	  },
	  'r-html': function(elem, value){
	    this.$watch(value, function(nvalue){
	      nvalue = nvalue || "";
	      dom.html(elem, nvalue)
	    }, {force: true});
	  },
	  'ref': {
	    accept: consts.COMPONENT_TYPE + consts.ELEMENT_TYPE,
	    link: function( elem, value ){
	      var refs = this.$refs || (this.$refs = {});
	      var cval;
	      if(_.isExpr(value)){
	        this.$watch(value, function(nval, oval){
	          cval = nval;
	          if(refs[oval] === elem) refs[oval] = null;
	          if(cval) refs[cval] = elem;
	        })
	      }else{
	        refs[cval = value] = elem;
	      }
	      return function(){
	        refs[cval] = null;
	      }
	    }
	  }
	}

	Regular.directive(module.exports);












/***/ },
/* 7 */
/***/ function(module, exports, __webpack_require__) {

	var // packages
	  _ = __webpack_require__(5),
	 animate = __webpack_require__(22),
	 dom = __webpack_require__(4),
	 Regular = __webpack_require__(3);


	var // variables
	  rClassName = /^[-\w]+(\s[-\w]+)*$/,
	  rCommaSep = /[\r\n\f ]*,[\r\n\f ]*(?=\w+\:)/, //  dont split comma in  Expression
	  rStyles = /^\{.*\}$/, //  for Simpilfy
	  rSpace = /\s+/, //  for Simpilfy
	  WHEN_COMMAND = "when",
	  EVENT_COMMAND = "on",
	  THEN_COMMAND = "then";

	/**
	 * Animation Plugin
	 * @param {Component} Component 
	 */


	function createSeed(type){

	  var steps = [], current = 0, callback = _.noop;
	  var key;

	  var out = {
	    type: type,
	    start: function(cb){
	      key = _.uid();
	      if(typeof cb === "function") callback = cb;
	      if(current> 0 ){
	        current = 0 ;
	      }else{
	        out.step();
	      }
	      return out.compelete;
	    },
	    compelete: function(){
	      key = null;
	      callback && callback();
	      callback = _.noop;
	      current = 0;
	    },
	    step: function(){
	      if(steps[current]) steps[current ]( out.done.bind(out, key) );
	    },
	    done: function(pkey){
	      if(pkey !== key) return; // means the loop is down
	      if( current < steps.length - 1 ) {
	        current++;
	        out.step();
	      }else{
	        out.compelete();
	      }
	    },
	    push: function(step){
	      steps.push(step)
	    }
	  }

	  return out;
	}

	Regular._addProtoInheritCache("animation")


	// builtin animation
	Regular.animation({
	  "wait": function( step ){
	    var timeout = parseInt( step.param ) || 0
	    return function(done){
	      // _.log("delay " + timeout)
	      setTimeout( done, timeout );
	    }
	  },
	  "class": function(step){
	    var tmp = step.param.split(","),
	      className = tmp[0] || "",
	      mode = parseInt(tmp[1]) || 1;

	    return function(done){
	      // _.log(className)
	      animate.startClassAnimate( step.element, className , done, mode );
	    }
	  },
	  "call": function(step){
	    var fn = this.$expression(step.param).get, self = this;
	    return function(done){
	      // _.log(step.param, 'call')
	      fn(self);
	      self.$update();
	      done()
	    }
	  },
	  "emit": function(step){
	    var param = step.param;
	    var tmp = param.split(","),
	      evt = tmp[0] || "",
	      args = tmp[1]? this.$expression(tmp[1]).get: null;

	    if(!evt) throw Error("you shoud specified a eventname in emit command");

	    var self = this;
	    return function(done){
	      self.$emit(evt, args? args(self) : undefined);
	      done();
	    }
	  },
	  // style: left {10}px,
	  style: function(step){
	    var styles = {}, 
	      param = step.param,
	      pairs = param.split(","), valid;
	    pairs.forEach(function(pair){
	      pair = pair.trim();
	      if(pair){
	        var tmp = pair.split( rSpace ),
	          name = tmp.shift(),
	          value = tmp.join(" ");

	        if( !name || !value ) throw Error("invalid style in command: style");
	        styles[name] = value;
	        valid = true;
	      }
	    })

	    return function(done){
	      if(valid){
	        animate.startStyleAnimate(step.element, styles, done);
	      }else{
	        done();
	      }
	    }
	  }
	})



	// hancdle the r-animation directive
	// el : the element to process
	// value: the directive value
	function processAnimate( element, value ){
	  var Component = this.constructor;

	  if(_.isExpr(value)){
	    value = value.get(this);
	  }

	  value = value.trim();

	  var composites = value.split(";"), 
	    composite, context = this, seeds = [], seed, destroies = [], destroy,
	    command, param , current = 0, tmp, animator, self = this;

	  function reset( type ){
	    seed && seeds.push( seed )
	    seed = createSeed( type );
	  }

	  function whenCallback(start, value){
	    if( !!value ) start()
	  }

	  function animationDestroy(element){
	    return function(){
	      element.onenter = null;
	      element.onleave = null;
	    } 
	  }

	  for( var i = 0, len = composites.length; i < len; i++ ){

	    composite = composites[i];
	    tmp = composite.split(":");
	    command = tmp[0] && tmp[0].trim();
	    param = tmp[1] && tmp[1].trim();

	    if( !command ) continue;

	    if( command === WHEN_COMMAND ){
	      reset("when");
	      this.$watch(param, whenCallback.bind( this, seed.start ) );
	      continue;
	    }

	    if( command === EVENT_COMMAND){
	      reset(param);
	      if( param === "leave" ){
	        element.onleave = seed.start;
	        destroies.push( animationDestroy(element) );
	      }else if( param === "enter" ){
	        element.onenter = seed.start;
	        destroies.push( animationDestroy(element) );
	      }else{
	        if( ("on" + param) in element){ // if dom have the event , we use dom event
	          destroies.push(this._handleEvent( element, param, seed.start ));
	        }else{ // otherwise, we use component event
	          this.$on(param, seed.start);
	          destroies.push(this.$off.bind(this, param, seed.start));
	        }
	      }
	      continue;
	    }

	    var animator =  Component.animation(command) 
	    if( animator && seed ){
	      seed.push(
	        animator.call(this,{
	          element: element,
	          done: seed.done,
	          param: param 
	        })
	      )
	    }else{
	      throw Error( animator? "you should start with `on` or `event` in animation" : ("undefined animator 【" + command +"】" ));
	    }
	  }

	  if(destroies.length){
	    return function(){
	      destroies.forEach(function(destroy){
	        destroy();
	      })
	    }
	  }
	}


	Regular.directive( "r-animation", processAnimate)
	Regular.directive( "r-anim", processAnimate)



/***/ },
/* 8 */
/***/ function(module, exports, __webpack_require__) {

	var Regular = __webpack_require__(3);

	/**
	 * Timeout Module
	 * @param {Component} Component 
	 */
	function TimeoutModule(Component){

	  Component.implement({
	    /**
	     * just like setTimeout, but will enter digest automately
	     * @param  {Function} fn    
	     * @param  {Number}   delay 
	     * @return {Number}   timeoutid
	     */
	    $timeout: function(fn, delay){
	      delay = delay || 0;
	      return setTimeout(function(){
	        fn.call(this);
	        this.$update(); //enter digest
	      }.bind(this), delay);
	    },
	    /**
	     * just like setInterval, but will enter digest automately
	     * @param  {Function} fn    
	     * @param  {Number}   interval 
	     * @return {Number}   intervalid
	     */
	    $interval: function(fn, interval){
	      interval = interval || 1000/60;
	      return setInterval(function(){
	        fn.call(this);
	        this.$update(); //enter digest
	      }.bind(this), interval);
	    }
	  });
	}


	Regular.plugin('timeout', TimeoutModule);
	Regular.plugin('$timeout', TimeoutModule);

/***/ },
/* 9 */
/***/ function(module, exports, __webpack_require__) {

	var diffArray = __webpack_require__(25).diffArray;
	var combine = __webpack_require__(15);
	var animate = __webpack_require__(22);
	var node = __webpack_require__(26);
	var Group = __webpack_require__(10);
	var dom = __webpack_require__(4);
	var _ = __webpack_require__(5);


	var walkers = module.exports = {};

	walkers.list = function(ast, options){

	  var Regular = walkers.Regular;  
	  var placeholder = document.createComment("Regular list"),
	    namespace = options.namespace,
	    extra = options.extra;
	  var self = this;
	  var group = new Group([placeholder]);
	  var indexName = ast.variable + '_index';
	  var keyName = ast.variable + '_key';
	  var variable = ast.variable;
	  var alternate = ast.alternate;
	  var track = ast.track, keyOf, extraObj;

	  if( track && track !== true ){
	    track = this._touchExpr(track);
	    extraObj = _.createObject(extra);
	    keyOf = function( item, index ){
	      extraObj[ variable ] = item;
	      extraObj[ indexName ] = index;
	      // @FIX keyName
	      return track.get( self, extraObj );
	    }
	  }

	  function removeRange(index, rlen){
	    for(var j = 0; j< rlen; j++){ //removed
	      var removed = group.children.splice( index + 1, 1)[0];
	      if(removed) removed.destroy(true);
	    }
	  }

	  function addRange(index, end, newList, rawNewValue){
	    for(var o = index; o < end; o++){ //add
	      // prototype inherit
	      var item = newList[o];
	      var data = {};
	      updateTarget(data, o, item, rawNewValue);

	      data = _.createObject(extra, data);
	      var section = self.$compile(ast.body, {
	        extra: data,
	        namespace:namespace,
	        record: true,
	        outer: options.outer
	      })
	      section.data = data;
	      // autolink
	      var insert =  combine.last(group.get(o));
	      if(insert.parentNode){
	        animate.inject(combine.node(section),insert, 'after');
	      }
	      // insert.parentNode.insertBefore(combine.node(section), insert.nextSibling);
	      group.children.splice( o + 1 , 0, section);
	    }
	  }

	  function updateTarget(target, index, item, rawNewValue){

	      target[ indexName ] = index;
	      if( rawNewValue ){
	        target[ keyName ] = item;
	        target[ variable ] = rawNewValue[ item ];
	      }else{
	        target[ variable ] = item;
	        target[keyName] = null
	      }
	  }


	  function updateRange(start, end, newList, rawNewValue){
	    for(var k = start; k < end; k++){ // no change
	      var sect = group.get( k + 1 ), item = newList[ k ];
	      updateTarget(sect.data, k, item, rawNewValue);
	    }
	  }

	  function updateLD(newList, oldList, splices , rawNewValue ){

	    var cur = placeholder;
	    var m = 0, len = newList.length;

	    if(!splices && (len !==0 || oldList.length !==0)  ){
	      splices = diffArray(newList, oldList, true);
	    }

	    if(!splices || !splices.length) return;
	      
	    for(var i = 0; i < splices.length; i++){ //init
	      var splice = splices[i];
	      var index = splice.index; // beacuse we use a comment for placeholder
	      var removed = splice.removed;
	      var add = splice.add;
	      var rlen = removed.length;
	      // for track
	      if( track && rlen && add ){
	        var minar = Math.min(rlen, add);
	        var tIndex = 0;
	        while(tIndex < minar){
	          if( keyOf(newList[index], index) !== keyOf( removed[0], index ) ){
	            removeRange(index, 1)
	            addRange(index, index+1, newList, rawNewValue)
	          }
	          removed.shift();
	          add--;
	          index++;
	          tIndex++;
	        }
	        rlen = removed.length;
	      }
	      // update
	      updateRange(m, index, newList, rawNewValue);

	      removeRange( index ,rlen)

	      addRange(index, index+add, newList, rawNewValue)

	      m = index + add - rlen;
	      m  = m < 0? 0 : m;

	    }
	    if(m < len){
	      for(var i = m; i < len; i++){
	        var pair = group.get(i + 1);
	        pair.data[indexName] = i;
	        // @TODO fix keys
	      }
	    }
	  }

	  // if the track is constant test.
	  function updateSimple(newList, oldList, rawNewValue ){

	    var nlen = newList.length;
	    var olen = oldList.length;
	    var mlen = Math.min(nlen, olen);

	    updateRange(0, mlen, newList, rawNewValue)
	    if(nlen < olen){ //need add
	      removeRange(nlen, olen-nlen);
	    }else if(nlen > olen){
	      addRange(olen, nlen, newList, rawNewValue);
	    }
	  }

	  function update(newValue, oldValue, splices){

	    var nType = _.typeOf( newValue );
	    var oType = _.typeOf( oldValue );

	    var newList = getListFromValue( newValue, nType );
	    var oldList = getListFromValue( oldValue, oType );

	    var rawNewValue;


	    var nlen = newList && newList.length;
	    var olen = oldList && oldList.length;

	    // if previous list has , we need to remove the altnated section.
	    if( !olen && nlen && group.get(1) ){
	      var altGroup = group.children.pop();
	      if(altGroup.destroy)  altGroup.destroy(true);
	    }

	    if( nType === 'object' ) rawNewValue = newValue;

	    if(track === true){
	      updateSimple( newList, oldList,  rawNewValue );
	    }else{
	      updateLD( newList, oldList, splices, rawNewValue );
	    }

	    // @ {#list} {#else}
	    if( !nlen && alternate && alternate.length){
	      var section = self.$compile(alternate, {
	        extra: extra,
	        record: true,
	        outer: options.outer,
	        namespace: namespace
	      })
	      group.children.push(section);
	      if(placeholder.parentNode){
	        animate.inject(combine.node(section), placeholder, 'after');
	      }
	    }
	  }

	  this.$watch(ast.sequence, update, { 
	    init: true, 
	    diff: track !== true ,
	    deep: true
	  });
	  return group;
	}


	function updateItem(){
	  
	}


	// {#include } or {#inc template}
	walkers.template = function(ast, options){
	  var content = ast.content, compiled;
	  var placeholder = document.createComment('inlcude');
	  var compiled, namespace = options.namespace, extra = options.extra;
	  var group = new Group([placeholder]);
	  if(content){
	    var self = this;
	    this.$watch(content, function(value){
	      var removed = group.get(1), type= typeof value;
	      if( removed){
	        removed.destroy(true); 
	        group.children.pop();
	      }
	      if(!value) return;

	      group.push( compiled = type === 'function' ? value(): self.$compile( type !== 'object'? String(value): value, {
	        record: true, 
	        outer: options.outer,
	        namespace: namespace, 
	        extra: extra}) ); 
	      if(placeholder.parentNode) {
	        compiled.$inject(placeholder, 'before')
	      }
	    }, {
	      init: true
	    });
	  }
	  return group;
	};

	function getListFromValue(value, type){
	  return type === 'object'? _.keys(value): (
	      type === 'array'? value: []
	    )
	}


	// how to resolve this problem
	var ii = 0;
	walkers['if'] = function(ast, options){
	  var self = this, consequent, alternate, extra = options.extra;
	  if(options && options.element){ // attribute inteplation
	    var update = function(nvalue){
	      if(!!nvalue){
	        if(alternate) combine.destroy(alternate)
	        if(ast.consequent) consequent = self.$compile(ast.consequent, {record: true, element: options.element , extra:extra});
	      }else{
	        if(consequent) combine.destroy(consequent)
	        if(ast.alternate) alternate = self.$compile(ast.alternate, {record: true, element: options.element, extra: extra});
	      }
	    }
	    this.$watch(ast.test, update, { force: true });
	    return {
	      destroy: function(){
	        if(consequent) combine.destroy(consequent);
	        else if(alternate) combine.destroy(alternate);
	      }
	    }
	  }

	  var test, consequent, alternate, node;
	  var placeholder = document.createComment("Regular if" + ii++);
	  var group = new Group();
	  group.push(placeholder);
	  var preValue = null, namespace= options.namespace;


	  var update = function (nvalue, old){
	    var value = !!nvalue;
	    if(value === preValue) return;
	    preValue = value;
	    if(group.children[1]){
	      group.children[1].destroy(true);
	      group.children.pop();
	    }
	    if(value){ //true
	      if(ast.consequent && ast.consequent.length){
	        consequent = self.$compile( ast.consequent , {record:true, outer: options.outer,namespace: namespace, extra:extra })
	        // placeholder.parentNode && placeholder.parentNode.insertBefore( node, placeholder );
	        group.push(consequent);
	        if(placeholder.parentNode){
	          animate.inject(combine.node(consequent), placeholder, 'before');
	        }
	      }
	    }else{ //false
	      if(ast.alternate && ast.alternate.length){
	        alternate = self.$compile(ast.alternate, {record:true, outer: options.outer,namespace: namespace, extra:extra});
	        group.push(alternate);
	        if(placeholder.parentNode){
	          animate.inject(combine.node(alternate), placeholder, 'before');
	        }
	      }
	    }
	  }
	  this.$watch(ast.test, update, {force: true, init: true});

	  return group;
	}


	walkers.expression = function(ast, options){
	  var node = document.createTextNode("");
	  this.$watch(ast, function(newval){
	    dom.text(node, "" + (newval == null? "": "" + newval) );
	  },{init: true})
	  return node;
	}
	walkers.text = function(ast, options){
	  var node = document.createTextNode(_.convertEntity(ast.text));
	  return node;
	}



	var eventReg = /^on-(.+)$/

	/**
	 * walkers element (contains component)
	 */
	walkers.element = function(ast, options){
	  var attrs = ast.attrs, self = this,
	    Constructor = this.constructor,
	    children = ast.children,
	    namespace = options.namespace, 
	    extra = options.extra,
	    tag = ast.tag,
	    Component = Constructor.component(tag),
	    ref, group, element;

	  if( tag === 'r-content' ){
	    _.log('r-content is deprecated, use {#inc this.$body} instead (`{#include}` as same)', 'warn');
	    return this.$body && this.$body();
	  } 

	  if(Component || tag === 'r-component'){
	    options.Component = Component;
	    return walkers.component.call(this, ast, options)
	  }

	  if(tag === 'svg') namespace = "svg";
	  // @Deprecated: may be removed in next version, use {#inc } instead
	  
	  if( children && children.length ){
	    group = this.$compile(children, {outer: options.outer,namespace: namespace, extra: extra });
	  }

	  element = dom.create(tag, namespace, attrs);

	  if(group && !_.isVoidTag(tag)){
	    dom.inject( combine.node(group) , element)
	  }

	  // sort before
	  if(!ast.touched){
	    attrs.sort(function(a1, a2){
	      var d1 = Constructor.directive(a1.name),
	        d2 = Constructor.directive(a2.name);
	      if( d1 && d2 ) return (d2.priority || 1) - (d1.priority || 1);
	      if(d1) return 1;
	      if(d2) return -1;
	      if(a2.name === "type") return 1;
	      return -1;
	    })
	    ast.touched = true;
	  }
	  // may distinct with if else
	  var destroies = walkAttributes.call(this, attrs, element, extra);

	  return {
	    type: "element",
	    group: group,
	    node: function(){
	      return element;
	    },
	    last: function(){
	      return element;
	    },
	    destroy: function(first){
	      if( first ){
	        animate.remove( element, group? group.destroy.bind( group ): _.noop );
	      }else if(group) {
	        group.destroy();
	      }
	      // destroy ref
	      if( destroies.length ) {
	        destroies.forEach(function( destroy ){
	          if( destroy ){
	            if( typeof destroy.destroy === 'function' ){
	              destroy.destroy()
	            }else{
	              destroy();
	            }
	          }
	        })
	      }
	    }
	  }
	}

	walkers.component = function(ast, options){
	  var attrs = ast.attrs, 
	    Component = options.Component,
	    Constructor = this.constructor,
	    isolate, 
	    extra = options.extra,
	    namespace = options.namespace,
	    ref, self = this, is;

	  var data = {}, events;

	  for(var i = 0, len = attrs.length; i < len; i++){
	    var attr = attrs[i];
	    // consider disabled   equlasto  disabled={true}
	    var value = this._touchExpr(attr.value === undefined? true: attr.value);
	    if(value.constant) value = attr.value = value.get(this);
	    if(attr.value && attr.value.constant === true){
	      value = value.get(this);
	    }
	    var name = attr.name;
	    if(!attr.event){
	      var etest = name.match(eventReg);
	      // event: 'nav'
	      if(etest) attr.event = etest[1];
	    }

	    // @compile modifier
	    if(attr.mdf === 'cmpl'){
	      value = _.getCompileFn(value, this, {
	        record: true, 
	        namespace:namespace, 
	        extra: extra, 
	        outer: options.outer
	      })
	    }
	    
	    // @if is r-component . we need to find the target Component
	    if(name === 'is' && !Component){
	      is = value;
	      var componentName = this.$get(value, true);
	      Component = Constructor.component(componentName)
	      if(typeof Component !== 'function') throw new Error("component " + componentName + " has not registed!");
	    }
	    // bind event proxy
	    var eventName;
	    if(eventName = attr.event){
	      events = events || {};
	      events[eventName] = _.handleEvent.call(this, value, eventName);
	      continue;
	    }else {
	      name = attr.name = _.camelCase(name);
	    }

	    if(!value || value.type !== 'expression'){
	      data[name] = value;
	    }else{
	      data[name] = value.get(self); 
	    }
	    if( name === 'ref'  && value != null){
	      ref = value
	    }
	    if( name === 'isolate'){
	      // 1: stop: composite -> parent
	      // 2. stop: composite <- parent
	      // 3. stop 1 and 2: composite <-> parent
	      // 0. stop nothing (defualt)
	      isolate = value.type === 'expression'? value.get(self): parseInt(value === true? 3: value, 10);
	      data.isolate = isolate;
	    }
	  }

	  var definition = { 
	    data: data, 
	    events: events, 
	    $parent: (isolate & 2)? null: this,
	    $root: this.$root,
	    $outer: options.outer,
	    _body: {
	      ctx: this,
	      ast: ast.children
	    }
	  }
	  var options = {
	    namespace: namespace, 
	    extra: options.extra
	  }


	  var component = new Component(definition, options), reflink;


	  if(ref && this.$refs){
	    reflink = Component.directive('ref').link
	    this.$on('$destroy', reflink.call(this, component, ref) )
	  }
	  if(ref &&  self.$refs) self.$refs[ref] = component;
	  for(var i = 0, len = attrs.length; i < len; i++){
	    var attr = attrs[i];
	    var value = attr.value||true;
	    var name = attr.name;
	    // need compiled
	    if(value.type === 'expression' && !attr.event){
	      value = self._touchExpr(value);
	      // use bit operate to control scope
	      if( !(isolate & 2) ) 
	        this.$watch(value, (function(name, val){
	          this.data[name] = val;
	        }).bind(component, name), { sync: true })
	      if( value.set && !(isolate & 1 ) ) 
	        // sync the data. it force the component don't trigger attr.name's first dirty echeck
	        component.$watch(name, self.$update.bind(self, value), {init: true});
	    }
	  }
	  if(is && is.type === 'expression'  ){
	    var group = new Group();
	    group.push(component);
	    this.$watch(is, function(value){
	      // found the new component
	      var Component = Constructor.component(value);
	      if(!Component) throw new Error("component " + value + " has not registed!");
	      var ncomponent = new Component(definition);
	      var component = group.children.pop();
	      group.push(ncomponent);
	      ncomponent.$inject(combine.last(component), 'after')
	      component.destroy();
	      // @TODO  if component changed , we need update ref
	      if(ref){
	        self.$refs[ref] = ncomponent;
	      }
	    }, {sync: true})
	    return group;
	  }
	  return component;
	}

	function walkAttributes(attrs, element, extra){
	  var bindings = []
	  for(var i = 0, len = attrs.length; i < len; i++){
	    var binding = this._walk(attrs[i], {element: element, fromElement: true, attrs: attrs, extra: extra})
	    if(binding) bindings.push(binding);
	  }
	  return bindings;
	}

	walkers.attribute = function(ast ,options){

	  var attr = ast;
	  var name = attr.name;
	  var value = attr.value || "";
	  var constant = value.constant;
	  var Component = this.constructor;
	  var directive = Component.directive(name);
	  var element = options.element;
	  var self = this;


	  value = this._touchExpr(value);

	  if(constant) value = value.get(this);

	  if(directive && directive.link){
	    var binding = directive.link.call(self, element, value, name, options.attrs);
	    if(typeof binding === 'function') binding = {destroy: binding}; 
	    return binding;
	  } else{
	    if(value.type === 'expression' ){
	      this.$watch(value, function(nvalue, old){
	        dom.attr(element, name, nvalue);
	      }, {init: true});
	    }else{
	      if(_.isBooleanAttr(name)){
	        dom.attr(element, name, true);
	      }else{
	        dom.attr(element, name, value);
	      }
	    }
	    if(!options.fromElement){
	      return {
	        destroy: function(){
	          dom.attr(element, name, null);
	        }
	      }
	    }
	  }

	}



/***/ },
/* 10 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);
	var combine = __webpack_require__(15)

	function Group(list){
	  this.children = list || [];
	}


	var o = _.extend(Group.prototype, {
	  destroy: function(first){
	    combine.destroy(this.children, first);
	    if(this.ondestroy) this.ondestroy();
	    this.children = null;
	  },
	  get: function(i){
	    return this.children[i]
	  },
	  push: function(item){
	    this.children.push( item );
	  }
	})
	o.inject = o.$inject = combine.inject



	module.exports = Group;




/***/ },
/* 11 */
/***/ function(module, exports, __webpack_require__) {

	module.exports = {
	  'COMPONENT_TYPE': 1,
	  'ELEMENT_TYPE': 2,
	  'NAMESPACE': {
	    html: "http://www.w3.org/1999/xhtml",
	    svg: "http://www.w3.org/2000/svg"
	  }
	}

/***/ },
/* 12 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);
	var config = __webpack_require__(2);

	// some custom tag  will conflict with the Lexer progress
	var conflictTag = {"}": "{", "]": "["}, map1, map2;
	// some macro for lexer
	var macro = {
	  'NAME': /(?:[:_A-Za-z][-\.:_0-9A-Za-z]*)/,
	  'IDENT': /[\$_A-Za-z][_0-9A-Za-z\$]*/,
	  'SPACE': /[\r\n\t\f ]/
	}


	var test = /a|(b)/.exec("a");
	var testSubCapure = test && test[1] === undefined? 
	  function(str){ return str !== undefined }
	  :function(str){return !!str};

	function wrapHander(handler){
	  return function(all){
	    return {type: handler, value: all }
	  }
	}

	function Lexer(input, opts){
	  if(conflictTag[config.END]){
	    this.markStart = conflictTag[config.END];
	    this.markEnd = config.END;
	  }

	  this.input = (input||"").trim();
	  this.opts = opts || {};
	  this.map = this.opts.mode !== 2?  map1: map2;
	  this.states = ["INIT"];
	  if(opts && opts.expression){
	     this.states.push("JST");
	     this.expression = true;
	  }
	}

	var lo = Lexer.prototype


	lo.lex = function(str){
	  str = (str || this.input).trim();
	  var tokens = [], split, test,mlen, token, state;
	  this.input = str, 
	  this.marks = 0;
	  // init the pos index
	  this.index=0;
	  var i = 0;
	  while(str){
	    i++
	    state = this.state();
	    split = this.map[state] 
	    test = split.TRUNK.exec(str);
	    if(!test){
	      this.error('Unrecoginized Token');
	    }
	    mlen = test[0].length;
	    str = str.slice(mlen)
	    token = this._process.call(this, test, split, str)
	    if(token) tokens.push(token)
	    this.index += mlen;
	    // if(state == 'TAG' || state == 'JST') str = this.skipspace(str);
	  }

	  tokens.push({type: 'EOF'});

	  return tokens;
	}

	lo.error = function(msg){
	  throw  Error("Parse Error: " + msg +  ':\n' + _.trackErrorPos(this.input, this.index));
	}

	lo._process = function(args, split,str){
	  // console.log(args.join(","), this.state())
	  var links = split.links, marched = false, token;

	  for(var len = links.length, i=0;i<len ;i++){
	    var link = links[i],
	      handler = link[2],
	      index = link[0];
	    // if(args[6] === '>' && index === 6) console.log('haha')
	    if(testSubCapure(args[index])) {
	      marched = true;
	      if(handler){
	        token = handler.apply(this, args.slice(index, index + link[1]))
	        if(token)  token.pos = this.index;
	      }
	      break;
	    }
	  }
	  if(!marched){ // in ie lt8 . sub capture is "" but ont 
	    switch(str.charAt(0)){
	      case "<":
	        this.enter("TAG");
	        break;
	      default:
	        this.enter("JST");
	        break;
	    }
	  }
	  return token;
	}
	lo.enter = function(state){
	  this.states.push(state)
	  return this;
	}

	lo.state = function(){
	  var states = this.states;
	  return states[states.length-1];
	}

	lo.leave = function(state){
	  var states = this.states;
	  if(!state || states[states.length-1] === state) states.pop()
	}


	Lexer.setup = function(){
	  macro.END = config.END;
	  macro.BEGIN = config.BEGIN;
	  //
	  map1 = genMap([
	    // INIT
	    rules.ENTER_JST,
	    rules.ENTER_TAG,
	    rules.TEXT,

	    //TAG
	    rules.TAG_NAME,
	    rules.TAG_OPEN,
	    rules.TAG_CLOSE,
	    rules.TAG_PUNCHOR,
	    rules.TAG_ENTER_JST,
	    rules.TAG_UNQ_VALUE,
	    rules.TAG_STRING,
	    rules.TAG_SPACE,
	    rules.TAG_COMMENT,

	    // JST
	    rules.JST_OPEN,
	    rules.JST_CLOSE,
	    rules.JST_COMMENT,
	    rules.JST_EXPR_OPEN,
	    rules.JST_IDENT,
	    rules.JST_SPACE,
	    rules.JST_LEAVE,
	    rules.JST_NUMBER,
	    rules.JST_PUNCHOR,
	    rules.JST_STRING,
	    rules.JST_COMMENT
	    ])

	  // ignored the tag-relative token
	  map2 = genMap([
	    // INIT no < restrict
	    rules.ENTER_JST2,
	    rules.TEXT,
	    // JST
	    rules.JST_COMMENT,
	    rules.JST_OPEN,
	    rules.JST_CLOSE,
	    rules.JST_EXPR_OPEN,
	    rules.JST_IDENT,
	    rules.JST_SPACE,
	    rules.JST_LEAVE,
	    rules.JST_NUMBER,
	    rules.JST_PUNCHOR,
	    rules.JST_STRING,
	    rules.JST_COMMENT
	    ])
	}


	function genMap(rules){
	  var rule, map = {}, sign;
	  for(var i = 0, len = rules.length; i < len ; i++){
	    rule = rules[i];
	    sign = rule[2] || 'INIT';
	    ( map[sign] || (map[sign] = {rules:[], links:[]}) ).rules.push(rule);
	  }
	  return setup(map);
	}

	function setup(map){
	  var split, rules, trunks, handler, reg, retain, rule;
	  function replaceFn(all, one){
	    return typeof macro[one] === 'string'? 
	      _.escapeRegExp(macro[one]) 
	      : String(macro[one]).slice(1,-1);
	  }

	  for(var i in map){

	    split = map[i];
	    split.curIndex = 1;
	    rules = split.rules;
	    trunks = [];

	    for(var j = 0,len = rules.length; j<len; j++){
	      rule = rules[j]; 
	      reg = rule[0];
	      handler = rule[1];

	      if(typeof handler === 'string'){
	        handler = wrapHander(handler);
	      }
	      if(_.typeOf(reg) === 'regexp') reg = reg.toString().slice(1, -1);

	      reg = reg.replace(/\{(\w+)\}/g, replaceFn)
	      retain = _.findSubCapture(reg) + 1; 
	      split.links.push([split.curIndex, retain, handler]); 
	      split.curIndex += retain;
	      trunks.push(reg);
	    }
	    split.TRUNK = new RegExp("^(?:(" + trunks.join(")|(") + "))")
	  }
	  return map;
	}

	var rules = {

	  // 1. INIT
	  // ---------------

	  // mode1's JST ENTER RULE
	  ENTER_JST: [/[^\x00<]*?(?={BEGIN})/, function(all){
	    this.enter('JST');
	    if(all) return {type: 'TEXT', value: all}
	  }],

	  // mode2's JST ENTER RULE
	  ENTER_JST2: [/[^\x00]*?(?={BEGIN})/, function(all){
	    this.enter('JST');
	    if(all) return {type: 'TEXT', value: all}
	  }],

	  ENTER_TAG: [/[^\x00]*?(?=<[\w\/\!])/, function(all){ 
	    this.enter('TAG');
	    if(all) return {type: 'TEXT', value: all}
	  }],

	  TEXT: [/[^\x00]+/, 'TEXT' ],

	  // 2. TAG
	  // --------------------
	  TAG_NAME: [/{NAME}/, 'NAME', 'TAG'],
	  TAG_UNQ_VALUE: [/[^\{}&"'=><`\r\n\f\t ]+/, 'UNQ', 'TAG'],

	  TAG_OPEN: [/<({NAME})\s*/, function(all, one){ //"
	    return {type: 'TAG_OPEN', value: one}
	  }, 'TAG'],
	  TAG_CLOSE: [/<\/({NAME})[\r\n\f\t ]*>/, function(all, one){
	    this.leave();
	    return {type: 'TAG_CLOSE', value: one }
	  }, 'TAG'],

	    // mode2's JST ENTER RULE
	  TAG_ENTER_JST: [/(?={BEGIN})/, function(){
	    this.enter('JST');
	  }, 'TAG'],


	  TAG_PUNCHOR: [/[\>\/=&]/, function(all){
	    if(all === '>') this.leave();
	    return {type: all, value: all }
	  }, 'TAG'],
	  TAG_STRING:  [ /'([^']*)'|"([^"]*)\"/, /*'*/  function(all, one, two){ 
	    var value = one || two || "";

	    return {type: 'STRING', value: value}
	  }, 'TAG'],

	  TAG_SPACE: [/{SPACE}+/, null, 'TAG'],
	  TAG_COMMENT: [/<\!--([^\x00]*?)--\>/, function(all){
	    this.leave()
	    // this.leave('TAG')
	  } ,'TAG'],

	  // 3. JST
	  // -------------------

	  JST_OPEN: ['{BEGIN}#{SPACE}*({IDENT})', function(all, name){
	    return {
	      type: 'OPEN',
	      value: name
	    }
	  }, 'JST'],
	  JST_LEAVE: [/{END}/, function(all){
	    if(this.markEnd === all && this.expression) return {type: this.markEnd, value: this.markEnd};
	    if(!this.markEnd || !this.marks ){
	      this.firstEnterStart = false;
	      this.leave('JST');
	      return {type: 'END'}
	    }else{
	      this.marks--;
	      return {type: this.markEnd, value: this.markEnd}
	    }
	  }, 'JST'],
	  JST_CLOSE: [/{BEGIN}\s*\/({IDENT})\s*{END}/, function(all, one){
	    this.leave('JST');
	    return {
	      type: 'CLOSE',
	      value: one
	    }
	  }, 'JST'],
	  JST_COMMENT: [/{BEGIN}\!([^\x00]*?)\!{END}/, function(){
	    this.leave();
	  }, 'JST'],
	  JST_EXPR_OPEN: ['{BEGIN}',function(all, one){
	    if(all === this.markStart){
	      if(this.expression) return { type: this.markStart, value: this.markStart };
	      if(this.firstEnterStart || this.marks){
	        this.marks++
	        this.firstEnterStart = false;
	        return { type: this.markStart, value: this.markStart };
	      }else{
	        this.firstEnterStart = true;
	      }
	    }
	    return {
	      type: 'EXPR_OPEN',
	      escape: false
	    }

	  }, 'JST'],
	  JST_IDENT: ['{IDENT}', 'IDENT', 'JST'],
	  JST_SPACE: [/[ \r\n\f]+/, null, 'JST'],
	  JST_PUNCHOR: [/[=!]?==|[-=><+*\/%\!]?\=|\|\||&&|\@\(|\.\.|[<\>\[\]\(\)\-\|\{}\+\*\/%?:\.!,]/, function(all){
	    return { type: all, value: all }
	  },'JST'],

	  JST_STRING:  [ /'([^']*)'|"([^"]*)"/, function(all, one, two){ //"'
	    return {type: 'STRING', value: one || two || ""}
	  }, 'JST'],
	  JST_NUMBER: [/(?:[0-9]*\.[0-9]+|[0-9]+)(e\d+)?/, function(all){
	    return {type: 'NUMBER', value: parseFloat(all, 10)};
	  }, 'JST']
	}


	// setup when first config
	Lexer.setup();



	module.exports = Lexer;


/***/ },
/* 13 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);

	var config = __webpack_require__(2);
	var node = __webpack_require__(26);
	var Lexer = __webpack_require__(12);
	var varName = _.varName;
	var ctxName = _.ctxName;
	var extName = _.extName;
	var isPath = _.makePredicate("STRING IDENT NUMBER");
	var isKeyWord = _.makePredicate("true false undefined null this Array Date JSON Math NaN RegExp decodeURI decodeURIComponent encodeURI encodeURIComponent parseFloat parseInt Object");




	function Parser(input, opts){
	  opts = opts || {};

	  this.input = input;
	  this.tokens = new Lexer(input, opts).lex();
	  this.pos = 0;
	  this.length = this.tokens.length;
	}


	var op = Parser.prototype;


	op.parse = function(){
	  this.pos = 0;
	  var res= this.program();
	  if(this.ll().type === 'TAG_CLOSE'){
	    this.error("You may got a unclosed Tag")
	  }
	  return res;
	}

	op.ll =  function(k){
	  k = k || 1;
	  if(k < 0) k = k + 1;
	  var pos = this.pos + k - 1;
	  if(pos > this.length - 1){
	      return this.tokens[this.length-1];
	  }
	  return this.tokens[pos];
	}
	  // lookahead
	op.la = function(k){
	  return (this.ll(k) || '').type;
	}

	op.match = function(type, value){
	  var ll;
	  if(!(ll = this.eat(type, value))){
	    ll  = this.ll();
	    this.error('expect [' + type + (value == null? '':':'+ value) + ']" -> got "[' + ll.type + (value==null? '':':'+ll.value) + ']', ll.pos)
	  }else{
	    return ll;
	  }
	}

	op.error = function(msg, pos){
	  msg =  "\n【 parse failed 】 " + msg +  ':\n\n' + _.trackErrorPos(this.input, typeof pos === 'number'? pos: this.ll().pos||0);
	  throw new Error(msg);
	}

	op.next = function(k){
	  k = k || 1;
	  this.pos += k;
	}
	op.eat = function(type, value){
	  var ll = this.ll();
	  if(typeof type !== 'string'){
	    for(var len = type.length ; len--;){
	      if(ll.type === type[len]) {
	        this.next();
	        return ll;
	      }
	    }
	  }else{
	    if( ll.type === type && (typeof value === 'undefined' || ll.value === value) ){
	       this.next();
	       return ll;
	    }
	  }
	  return false;
	}

	// program
	//  :EOF
	//  | (statement)* EOF
	op.program = function(){
	  var statements = [],  ll = this.ll();
	  while(ll.type !== 'EOF' && ll.type !=='TAG_CLOSE'){

	    statements.push(this.statement());
	    ll = this.ll();
	  }
	  // if(ll.type === 'TAG_CLOSE') this.error("You may have unmatched Tag")
	  return statements;
	}

	// statement
	//  : xml
	//  | jst
	//  | text
	op.statement = function(){
	  var ll = this.ll();
	  switch(ll.type){
	    case 'NAME':
	    case 'TEXT':
	      var text = ll.value;
	      this.next();
	      while(ll = this.eat(['NAME', 'TEXT'])){
	        text += ll.value;
	      }
	      return node.text(text);
	    case 'TAG_OPEN':
	      return this.xml();
	    case 'OPEN': 
	      return this.directive();
	    case 'EXPR_OPEN':
	      return this.interplation();
	    default:
	      this.error('Unexpected token: '+ this.la())
	  }
	}

	// xml 
	// stag statement* TAG_CLOSE?(if self-closed tag)
	op.xml = function(){
	  var name, attrs, children, selfClosed;
	  name = this.match('TAG_OPEN').value;
	  attrs = this.attrs();
	  selfClosed = this.eat('/')
	  this.match('>');
	  if( !selfClosed && !_.isVoidTag(name) ){
	    children = this.program();
	    if(!this.eat('TAG_CLOSE', name)) this.error('expect </'+name+'> got'+ 'no matched closeTag')
	  }
	  return node.element(name, attrs, children);
	}

	// xentity
	//  -rule(wrap attribute)
	//  -attribute
	//
	// __example__
	//  name = 1 |  
	//  ng-hide |
	//  on-click={{}} | 
	//  {{#if name}}on-click={{xx}}{{#else}}on-tap={{}}{{/if}}

	op.xentity = function(ll){
	  var name = ll.value, value, modifier;
	  if(ll.type === 'NAME'){
	    //@ only for test
	    if(~name.indexOf('.')){
	      var tmp = name.split('.');
	      name = tmp[0];
	      modifier = tmp[1]

	    }
	    if( this.eat("=") ) value = this.attvalue(modifier);
	    return node.attribute( name, value, modifier );
	  }else{
	    if( name !== 'if') this.error("current version. ONLY RULE #if #else #elseif is valid in tag, the rule #" + name + ' is invalid');
	    return this['if'](true);
	  }

	}

	// stag     ::=    '<' Name (S attr)* S? '>'  
	// attr    ::=     Name Eq attvalue
	op.attrs = function(isAttribute){
	  var eat
	  if(!isAttribute){
	    eat = ["NAME", "OPEN"]
	  }else{
	    eat = ["NAME"]
	  }

	  var attrs = [], ll;
	  while (ll = this.eat(eat)){
	    attrs.push(this.xentity( ll ))
	  }
	  return attrs;
	}

	// attvalue
	//  : STRING  
	//  | NAME
	op.attvalue = function(mdf){
	  var ll = this.ll();
	  switch(ll.type){
	    case "NAME":
	    case "UNQ":
	    case "STRING":
	      this.next();
	      var value = ll.value;
	      if(~value.indexOf(config.BEGIN) && ~value.indexOf(config.END) && mdf!=='cmpl'){
	        var constant = true;
	        var parsed = new Parser(value, { mode: 2 }).parse();
	        if(parsed.length === 1 && parsed[0].type === 'expression') return parsed[0];
	        var body = [];
	        parsed.forEach(function(item){
	          if(!item.constant) constant=false;
	          // silent the mutiple inteplation
	            body.push(item.body || "'" + item.text.replace(/'/g, "\\'") + "'");        
	        });
	        body = "[" + body.join(",") + "].join('')";
	        value = node.expression(body, null, constant);
	      }
	      return value;
	    case "EXPR_OPEN":
	      return this.interplation();
	    // case "OPEN":
	    //   if(ll.value === 'inc' || ll.value === 'include'){
	    //     this.next();
	    //     return this.inc();
	    //   }else{
	    //     this.error('attribute value only support inteplation and {#inc} statement')
	    //   }
	    //   break;
	    default:
	      this.error('Unexpected token: '+ this.la())
	  }
	}


	// {{#}}
	op.directive = function(){
	  var name = this.ll().value;
	  this.next();
	  if(typeof this[name] === 'function'){
	    return this[name]()
	  }else{
	    this.error('Undefined directive['+ name +']');
	  }
	}


	// {{}}
	op.interplation = function(){
	  this.match('EXPR_OPEN');
	  var res = this.expression(true);
	  this.match('END');
	  return res;
	}

	// {{~}}
	op.inc = op.include = function(){
	  var content = this.expression();
	  this.match('END');
	  return node.template(content);
	}

	// {{#if}}
	op["if"] = function(tag){
	  var test = this.expression();
	  var consequent = [], alternate=[];

	  var container = consequent;
	  var statement = !tag? "statement" : "attrs";

	  this.match('END');

	  var ll, close;
	  while( ! (close = this.eat('CLOSE')) ){
	    ll = this.ll();
	    if( ll.type === 'OPEN' ){
	      switch( ll.value ){
	        case 'else':
	          container = alternate;
	          this.next();
	          this.match( 'END' );
	          break;
	        case 'elseif':
	          this.next();
	          alternate.push( this["if"](tag) );
	          return node['if']( test, consequent, alternate );
	        default:
	          container.push( this[statement](true) );
	      }
	    }else{
	      container.push(this[statement](true));
	    }
	  }
	  // if statement not matched
	  if(close.value !== "if") this.error('Unmatched if directive')
	  return node["if"](test, consequent, alternate);
	}


	// @mark   mustache syntax have natrure dis, canot with expression
	// {{#list}}
	op.list = function(){
	  // sequence can be a list or hash
	  var sequence = this.expression(), variable, ll, track;
	  var consequent = [], alternate=[];
	  var container = consequent;

	  this.match('IDENT', 'as');

	  variable = this.match('IDENT').value;

	  if(this.eat('IDENT', 'by')){
	    if(this.eat('IDENT',variable + '_index')){
	      track = true;
	    }else{
	      track = this.expression();
	      if(track.constant){
	        // true is means constant, we handle it just like xxx_index.
	        track = true;
	      }
	    }
	  }

	  this.match('END');

	  while( !(ll = this.eat('CLOSE')) ){
	    if(this.eat('OPEN', 'else')){
	      container =  alternate;
	      this.match('END');
	    }else{
	      container.push(this.statement());
	    }
	  }
	  
	  if(ll.value !== 'list') this.error('expect ' + 'list got ' + '/' + ll.value + ' ', ll.pos );
	  return node.list(sequence, variable, consequent, alternate, track);
	}


	op.expression = function(){
	  var expression;
	  if(this.eat('@(')){ //once bind
	    expression = this.expr();
	    expression.once = true;
	    this.match(')')
	  }else{
	    expression = this.expr();
	  }
	  return expression;
	}

	op.expr = function(){
	  this.depend = [];

	  var buffer = this.filter()

	  var body = buffer.get || buffer;
	  var setbody = buffer.set;
	  return node.expression(body, setbody, !this.depend.length);
	}


	// filter
	// assign ('|' filtername[':' args]) * 
	op.filter = function(){
	  var left = this.assign();
	  var ll = this.eat('|');
	  var buffer = [], setBuffer, prefix,
	    attr = "t", 
	    set = left.set, get, 
	    tmp = "";

	  if(ll){
	    if(set) setBuffer = [];

	    prefix = "(function(" + attr + "){";

	    do{
	      tmp = attr + " = " + ctxName + "._f_('" + this.match('IDENT').value+ "' ).get.call( "+_.ctxName +"," + attr ;
	      if(this.eat(':')){
	        tmp +=", "+ this.arguments("|").join(",") + ");"
	      }else{
	        tmp += ');'
	      }
	      buffer.push(tmp);
	      setBuffer && setBuffer.unshift( tmp.replace(" ).get.call", " ).set.call") );

	    }while(ll = this.eat('|'));
	    buffer.push("return " + attr );
	    setBuffer && setBuffer.push("return " + attr);

	    get =  prefix + buffer.join("") + "})("+left.get+")";
	    // we call back to value.
	    if(setBuffer){
	      // change _ss__(name, _p_) to _s__(name, filterFn(_p_));
	      set = set.replace(_.setName, 
	        prefix + setBuffer.join("") + "})("+　_.setName　+")" );

	    }
	    // the set function is depend on the filter definition. if it have set method, the set will work
	    return this.getset(get, set);
	  }
	  return left;
	}

	// assign
	// left-hand-expr = condition
	op.assign = function(){
	  var left = this.condition(), ll;
	  if(ll = this.eat(['=', '+=', '-=', '*=', '/=', '%='])){
	    if(!left.set) this.error('invalid lefthand expression in assignment expression');
	    return this.getset( left.set.replace( "," + _.setName, "," + this.condition().get ).replace("'='", "'"+ll.type+"'"), left.set);
	    // return this.getset('(' + left.get + ll.type  + this.condition().get + ')', left.set);
	  }
	  return left;
	}

	// or
	// or ? assign : assign
	op.condition = function(){

	  var test = this.or();
	  if(this.eat('?')){
	    return this.getset([test.get + "?", 
	      this.assign().get, 
	      this.match(":").type, 
	      this.assign().get].join(""));
	  }

	  return test;
	}

	// and
	// and && or
	op.or = function(){

	  var left = this.and();

	  if(this.eat('||')){
	    return this.getset(left.get + '||' + this.or().get);
	  }

	  return left;
	}
	// equal
	// equal && and
	op.and = function(){

	  var left = this.equal();

	  if(this.eat('&&')){
	    return this.getset(left.get + '&&' + this.and().get);
	  }
	  return left;
	}
	// relation
	// 
	// equal == relation
	// equal != relation
	// equal === relation
	// equal !== relation
	op.equal = function(){
	  var left = this.relation(), ll;
	  // @perf;
	  if( ll = this.eat(['==','!=', '===', '!=='])){
	    return this.getset(left.get + ll.type + this.equal().get);
	  }
	  return left
	}
	// relation < additive
	// relation > additive
	// relation <= additive
	// relation >= additive
	// relation in additive
	op.relation = function(){
	  var left = this.additive(), ll;
	  // @perf
	  if(ll = (this.eat(['<', '>', '>=', '<=']) || this.eat('IDENT', 'in') )){
	    return this.getset(left.get + ll.value + this.relation().get);
	  }
	  return left
	}
	// additive :
	// multive
	// additive + multive
	// additive - multive
	op.additive = function(){
	  var left = this.multive() ,ll;
	  if(ll= this.eat(['+','-']) ){
	    return this.getset(left.get + ll.value + this.additive().get);
	  }
	  return left
	}
	// multive :
	// unary
	// multive * unary
	// multive / unary
	// multive % unary
	op.multive = function(){
	  var left = this.range() ,ll;
	  if( ll = this.eat(['*', '/' ,'%']) ){
	    return this.getset(left.get + ll.type + this.multive().get);
	  }
	  return left;
	}

	op.range = function(){
	  var left = this.unary(), ll, right;

	  if(ll = this.eat('..')){
	    right = this.unary();
	    var body = 
	      "(function(start,end){var res = [],step=end>start?1:-1; for(var i = start; end>start?i <= end: i>=end; i=i+step){res.push(i); } return res })("+left.get+","+right.get+")"
	    return this.getset(body);
	  }

	  return left;
	}



	// lefthand
	// + unary
	// - unary
	// ~ unary
	// ! unary
	op.unary = function(){
	  var ll;
	  if(ll = this.eat(['+','-','~', '!'])){
	    return this.getset('(' + ll.type + this.unary().get + ')') ;
	  }else{
	    return this.member()
	  }
	}

	// call[lefthand] :
	// member args
	// member [ expression ]
	// member . ident  

	op.member = function(base, last, pathes, prevBase){
	  var ll, path, extValue;


	  var onlySimpleAccessor = false;
	  if(!base){ //first
	    path = this.primary();
	    var type = typeof path;
	    if(type === 'string'){ 
	      pathes = [];
	      pathes.push( path );
	      last = path;
	      extValue = extName + "." + path
	      base = ctxName + "._sg_('" + path + "', " + varName + ", " + extName + ")";
	      onlySimpleAccessor = true;
	    }else{ //Primative Type
	      if(path.get === 'this'){
	        base = ctxName;
	        pathes = ['this'];
	      }else{
	        pathes = null;
	        base = path.get;
	      }
	    }
	  }else{ // not first enter
	    if(typeof last === 'string' && isPath( last) ){ // is valid path
	      pathes.push(last);
	    }else{
	      if(pathes && pathes.length) this.depend.push(pathes);
	      pathes = null;
	    }
	  }
	  if(ll = this.eat(['[', '.', '('])){
	    switch(ll.type){
	      case '.':
	          // member(object, property, computed)
	        var tmpName = this.match('IDENT').value;
	        prevBase = base;
	        if( this.la() !== "(" ){ 
	          base = ctxName + "._sg_('" + tmpName + "', " + base + ")";
	        }else{
	          base += "['" + tmpName + "']";
	        }
	        return this.member( base, tmpName, pathes,  prevBase);
	      case '[':
	          // member(object, property, computed)
	        path = this.assign();
	        prevBase = base;
	        if( this.la() !== "(" ){ 
	        // means function call, we need throw undefined error when call function
	        // and confirm that the function call wont lose its context
	          base = ctxName + "._sg_(" + path.get + ", " + base + ")";
	        }else{
	          base += "[" + path.get + "]";
	        }
	        this.match(']')
	        return this.member(base, path, pathes, prevBase);
	      case '(':
	        // call(callee, args)
	        var args = this.arguments().join(',');
	        base =  base+"(" + args +")";
	        this.match(')')
	        return this.member(base, null, pathes);
	    }
	  }
	  if( pathes && pathes.length ) this.depend.push( pathes );
	  var res =  {get: base};
	  if(last){
	    res.set = ctxName + "._ss_(" + 
	        (last.get? last.get : "'"+ last + "'") + 
	        ","+ _.setName + ","+ 
	        (prevBase?prevBase:_.varName) + 
	        ", '=', "+ ( onlySimpleAccessor? 1 : 0 ) + ")";
	  
	  }
	  return res;
	}

	/**
	 * 
	 */
	op.arguments = function(end){
	  end = end || ')'
	  var args = [];
	  do{
	    if(this.la() !== end){
	      args.push(this.assign().get)
	    }
	  }while( this.eat(','));
	  return args
	}


	// primary :
	// this 
	// ident
	// literal
	// array
	// object
	// ( expression )

	op.primary = function(){
	  var ll = this.ll();
	  switch(ll.type){
	    case "{":
	      return this.object();
	    case "[":
	      return this.array();
	    case "(":
	      return this.paren();
	    // literal or ident
	    case 'STRING':
	      this.next();
	      return this.getset("'" + ll.value + "'")
	    case 'NUMBER':
	      this.next();
	      return this.getset(""+ll.value);
	    case "IDENT":
	      this.next();
	      if(isKeyWord(ll.value)){
	        return this.getset( ll.value );
	      }
	      return ll.value;
	    default: 
	      this.error('Unexpected Token: ' + ll.type);
	  }
	}

	// object
	//  {propAssign [, propAssign] * [,]}

	// propAssign
	//  prop : assign

	// prop
	//  STRING
	//  IDENT
	//  NUMBER

	op.object = function(){
	  var code = [this.match('{').type];

	  var ll = this.eat( ['STRING', 'IDENT', 'NUMBER'] );
	  while(ll){
	    code.push("'" + ll.value + "'" + this.match(':').type);
	    var get = this.assign().get;
	    code.push(get);
	    ll = null;
	    if(this.eat(",") && (ll = this.eat(['STRING', 'IDENT', 'NUMBER'])) ) code.push(",");
	  }
	  code.push(this.match('}').type);
	  return {get: code.join("")}
	}

	// array
	// [ assign[,assign]*]
	op.array = function(){
	  var code = [this.match('[').type], item;
	  if( this.eat("]") ){

	     code.push("]");
	  } else {
	    while(item = this.assign()){
	      code.push(item.get);
	      if(this.eat(',')) code.push(",");
	      else break;
	    }
	    code.push(this.match(']').type);
	  }
	  return {get: code.join("")};
	}

	// '(' expression ')'
	op.paren = function(){
	  this.match('(');
	  var res = this.filter()
	  res.get = '(' + res.get + ')';
	  this.match(')');
	  return res;
	}

	op.getset = function(get, set){
	  return {
	    get: get,
	    set: set
	  }
	}



	module.exports = Parser;


/***/ },
/* 14 */
/***/ function(module, exports, __webpack_require__) {

	// (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
	// Backbone may be freely distributed under the MIT license.
	// For all details and documentation:
	// http://backbonejs.org

	// klass: a classical JS OOP façade
	// https://github.com/ded/klass
	// License MIT (c) Dustin Diaz 2014
	  
	// inspired by backbone's extend and klass
	var _ = __webpack_require__(5),
	  fnTest = /xy/.test(function(){"xy";}) ? /\bsupr\b/:/.*/,
	  isFn = function(o){return typeof o === "function"};


	function wrap(k, fn, supro) {
	  return function () {
	    var tmp = this.supr;
	    this.supr = supro[k];
	    var ret = fn.apply(this, arguments);
	    this.supr = tmp;
	    return ret;
	  }
	}

	function process( what, o, supro ) {
	  for ( var k in o ) {
	    if (o.hasOwnProperty(k)) {

	      what[k] = isFn( o[k] ) && isFn( supro[k] ) && 
	        fnTest.test( o[k] ) ? wrap(k, o[k], supro) : o[k];
	    }
	  }
	}

	// if the property is ["events", "data", "computed"] , we should merge them
	var merged = ["events", "data", "computed"], mlen = merged.length;
	module.exports = function extend(o){
	  o = o || {};
	  var supr = this, proto,
	    supro = supr && supr.prototype || {};

	  if(typeof o === 'function'){
	    proto = o.prototype;
	    o.implement = implement;
	    o.extend = extend;
	    return o;
	  } 
	  
	  function fn() {
	    supr.apply(this, arguments);
	  }

	  proto = _.createProto(fn, supro);

	  function implement(o){
	    // we need merge the merged property
	    var len = mlen;
	    for(;len--;){
	      var prop = merged[len];
	      if(o.hasOwnProperty(prop) && proto.hasOwnProperty(prop)){
	        _.extend(proto[prop], o[prop], true) 
	        delete o[prop];
	      }
	    }


	    process(proto, o, supro); 
	    return this;
	  }



	  fn.implement = implement
	  fn.implement(o)
	  if(supr.__after__) supr.__after__.call(fn, supr, o);
	  fn.extend = extend;
	  return fn;
	}



/***/ },
/* 15 */
/***/ function(module, exports, __webpack_require__) {

	// some nested  operation in ast 
	// --------------------------------

	var dom = __webpack_require__(4);
	var animate = __webpack_require__(22);

	var combine = module.exports = {

	  // get the initial dom in object
	  node: function(item){
	    var children,node, nodes;
	    if(!item) return;
	    if(item.element) return item.element;
	    if(typeof item.node === "function") return item.node();
	    if(typeof item.nodeType === "number") return item;
	    if(item.group) return combine.node(item.group)
	    if(children = item.children){
	      if(children.length === 1){
	        return combine.node(children[0]);
	      }
	      nodes = [];
	      for(var i = 0, len = children.length; i < len; i++ ){
	        node = combine.node(children[i]);
	        if(Array.isArray(node)){
	          nodes.push.apply(nodes, node)
	        }else if(node) {
	          nodes.push(node)
	        }
	      }
	      return nodes;
	    }
	  },
	  // @TODO remove _gragContainer
	  inject: function(node, pos ){
	    var group = this;
	    var fragment = combine.node(group.group || group);
	    if(node === false) {
	      animate.remove(fragment)
	      return group;
	    }else{
	      if(!fragment) return group;
	      if(typeof node === 'string') node = dom.find(node);
	      if(!node) throw Error('injected node is not found');
	      // use animate to animate firstchildren
	      animate.inject(fragment, node, pos);
	    }
	    // if it is a component
	    if(group.$emit) {
	      var preParent = group.parentNode;
	      var newParent = (pos ==='after' || pos === 'before')? node.parentNode : node;
	      group.parentNode = newParent;
	      group.$emit("$inject", node, pos, preParent);
	    }
	    return group;
	  },

	  // get the last dom in object(for insertion operation)
	  last: function(item){
	    var children = item.children;

	    if(typeof item.last === "function") return item.last();
	    if(typeof item.nodeType === "number") return item;

	    if(children && children.length) return combine.last(children[children.length - 1]);
	    if(item.group) return combine.last(item.group);

	  },

	  destroy: function(item, first){
	    if(!item) return;
	    if(Array.isArray(item)){
	      for(var i = 0, len = item.length; i < len; i++ ){
	        combine.destroy(item[i], first);
	      }
	    }
	    var children = item.children;
	    if(typeof item.destroy === "function") return item.destroy(first);
	    if(typeof item.nodeType === "number" && first)  dom.remove(item);
	    if(children && children.length){
	      combine.destroy(children, true);
	      item.children = null;
	    }
	  }

	}


	// @TODO: need move to dom.js
	dom.element = function( component, all ){
	  if(!component) return !all? null: [];
	  var nodes = combine.node( component );
	  if( nodes.nodeType === 1 ) return all? [nodes]: nodes;
	  var elements = [];
	  for(var i = 0; i<nodes.length ;i++){
	    var node = nodes[i];
	    if( node && node.nodeType === 1){
	      if(!all) return node;
	      elements.push(node);
	    } 
	  }
	  return !all? elements[0]: elements;
	}





/***/ },
/* 16 */
/***/ function(module, exports, __webpack_require__) {

	// simplest event emitter 60 lines
	// ===============================
	var slice = [].slice, _ = __webpack_require__(5);
	var API = {
	  $on: function(event, fn) {
	    if(typeof event === "object"){
	      for (var i in event) {
	        this.$on(i, event[i]);
	      }
	    }else{
	      // @patch: for list
	      var context = this;
	      var handles = context._handles || (context._handles = {}),
	        calls = handles[event] || (handles[event] = []);
	      calls.push(fn);
	    }
	    return this;
	  },
	  $off: function(event, fn) {
	    var context = this;
	    if(!context._handles) return;
	    if(!event) this._handles = {};
	    var handles = context._handles,
	      calls;

	    if (calls = handles[event]) {
	      if (!fn) {
	        handles[event] = [];
	        return context;
	      }
	      for (var i = 0, len = calls.length; i < len; i++) {
	        if (fn === calls[i]) {
	          calls.splice(i, 1);
	          return context;
	        }
	      }
	    }
	    return context;
	  },
	  // bubble event
	  $emit: function(event){
	    // @patch: for list
	    var context = this;
	    var handles = context._handles, calls, args, type;
	    if(!event) return;
	    var args = slice.call(arguments, 1);
	    var type = event;

	    if(!handles) return context;
	    if(calls = handles[type.slice(1)]){
	      for (var j = 0, len = calls.length; j < len; j++) {
	        calls[j].apply(context, args)
	      }
	    }
	    if (!(calls = handles[type])) return context;
	    for (var i = 0, len = calls.length; i < len; i++) {
	      calls[i].apply(context, args)
	    }
	    // if(calls.length) context.$update();
	    return context;
	  },
	  // capture  event
	  $one: function(){
	    
	}
	}
	// container class
	function Event() {}
	_.extend(Event.prototype, API)

	Event.mixTo = function(obj){
	  obj = typeof obj === "function" ? obj.prototype : obj;
	  _.extend(obj, API)
	}
	module.exports = Event;

/***/ },
/* 17 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);
	var parseExpression = __webpack_require__(18).expression;
	var diff = __webpack_require__(25);
	var diffArray = diff.diffArray;
	var diffObject = diff.diffObject;

	function Watcher(){}

	var methods = {
	  $watch: function(expr, fn, options){
	    var get, once, test, rlen, extra = this.__ext__; //records length
	    if(!this._watchers) this._watchers = [];

	    options = options || {};
	    if(options === true){
	       options = { deep: true }
	    }
	    var uid = _.uid('w_');
	    if(Array.isArray(expr)){
	      var tests = [];
	      for(var i = 0,len = expr.length; i < len; i++){
	          tests.push(this.$expression(expr[i]).get)
	      }
	      var prev = [];
	      test = function(context){
	        var equal = true;
	        for(var i =0, len = tests.length; i < len; i++){
	          var splice = tests[i](context, extra);
	          if(!_.equals(splice, prev[i])){
	             equal = false;
	             prev[i] = _.clone(splice);
	          }
	        }
	        return equal? false: prev;
	      }
	    }else{
	      if(typeof expr === 'function'){
	        get = expr.bind(this);      
	      }else{
	        expr = this._touchExpr( parseExpression(expr) );
	        get = expr.get;
	        once = expr.once;
	      }
	    }

	    var watcher = {
	      id: uid, 
	      get: get, 
	      fn: fn, 
	      once: once, 
	      force: options.force,
	      // don't use ld to resolve array diff
	      diff: options.diff,
	      test: test,
	      deep: options.deep,
	      last: options.sync? get(this): options.last
	    }
	    
	    this._watchers.push( watcher );

	    rlen = this._records && this._records.length;
	    if(rlen) this._records[rlen-1].push(uid)
	    // init state.
	    if(options.init === true){
	      var prephase = this.$phase;
	      this.$phase = 'digest';
	      this._checkSingleWatch( watcher, this._watchers.length-1 );
	      this.$phase = prephase;
	    }
	    return watcher;
	  },
	  $unwatch: function(uid){
	    uid = uid.id || uid;
	    if(!this._watchers) this._watchers = [];
	    if(Array.isArray(uid)){
	      for(var i =0, len = uid.length; i < len; i++){
	        this.$unwatch(uid[i]);
	      }
	    }else{
	      var watchers = this._watchers, watcher, wlen;
	      if(!uid || !watchers || !(wlen = watchers.length)) return;
	      for(;wlen--;){
	        watcher = watchers[wlen];
	        if(watcher && watcher.id === uid ){
	          watchers.splice(wlen, 1);
	        }
	      }
	    }
	  },
	  $expression: function(value){
	    return this._touchExpr(parseExpression(value))
	  },
	  /**
	   * the whole digest loop ,just like angular, it just a dirty-check loop;
	   * @param  {String} path  now regular process a pure dirty-check loop, but in parse phase, 
	   *                  Regular's parser extract the dependencies, in future maybe it will change to dirty-check combine with path-aware update;
	   * @return {Void}   
	   */

	  $digest: function(){
	    if(this.$phase === 'digest' || this._mute) return;
	    this.$phase = 'digest';
	    var dirty = false, n =0;
	    while(dirty = this._digest()){

	      if((++n) > 20){ // max loop
	        throw Error('there may a circular dependencies reaches')
	      }
	    }
	    if( n > 0 && this.$emit) this.$emit("$update");
	    this.$phase = null;
	  },
	  // private digest logic
	  _digest: function(){

	    var watchers = this._watchers;
	    var dirty = false, children, watcher, watcherDirty;
	    if(watchers && watchers.length){
	      for(var i = 0, len = watchers.length;i < len; i++){
	        watcher = watchers[i];
	        watcherDirty = this._checkSingleWatch(watcher, i);
	        if(watcherDirty) dirty = true;
	      }
	    }
	    // check children's dirty.
	    children = this._children;
	    if(children && children.length){
	      for(var m = 0, mlen = children.length; m < mlen; m++){
	        var child = children[m];
	        
	        if(child && child._digest()) dirty = true;
	      }
	    }
	    return dirty;
	  },
	  // check a single one watcher 
	  _checkSingleWatch: function(watcher, i){
	    var dirty = false;
	    if(!watcher) return;

	    var now, last, tlast, tnow,  eq, diff;

	    if(!watcher.test){

	      now = watcher.get(this);
	      last = watcher.last;
	      tlast = _.typeOf(last);
	      tnow = _.typeOf(now);
	      eq = true, diff;

	      // !Object
	      if( !(tnow === 'object' && tlast==='object' && watcher.deep) ){
	        // Array
	        if( tnow === 'array' && ( tlast=='undefined' || tlast === 'array') ){
	          diff = diffArray(now, watcher.last || [], watcher.diff)
	          if( tlast !== 'array' || diff === true || diff.length ) dirty = true;
	        }else{
	          eq = _.equals( now, last );
	          if( !eq || watcher.force ){
	            watcher.force = null;
	            dirty = true; 
	          }
	        }
	      }else{
	        diff =  diffObject( now, last, watcher.diff );
	        if( diff === true || diff.length ) dirty = true;
	      }
	    } else{
	      // @TODO 是否把多重改掉
	      var result = watcher.test(this);
	      if(result){
	        dirty = true;
	        watcher.fn.apply(this, result)
	      }
	    }
	    if(dirty && !watcher.test){
	      if(tnow === 'object' && watcher.deep || tnow === 'array'){
	        watcher.last = _.clone(now);
	      }else{
	        watcher.last = now;
	      }
	      watcher.fn.call(this, now, last, diff)
	      if(watcher.once) this._watchers.splice(i, 1);
	    }

	    return dirty;
	  },

	  /**
	   * **tips**: whatever param you passed in $update, after the function called, dirty-check(digest) phase will enter;
	   * 
	   * @param  {Function|String|Expression} path  
	   * @param  {Whatever} value optional, when path is Function, the value is ignored
	   * @return {this}     this 
	   */
	  $set: function(path, value){
	    if(path != null){
	      var type = _.typeOf(path);
	      if( type === 'string' || path.type === 'expression' ){
	        path = this.$expression(path);
	        path.set(this, value);
	      }else if(type === 'function'){
	        path.call(this, this.data);
	      }else{
	        for(var i in path) {
	          this.$set(i, path[i])
	        }
	      }
	    }
	  },
	  // 1. expr canbe string or a Expression
	  // 2. detect: if true, if expr is a string will directly return;
	  $get: function(expr, detect)  {
	    if(detect && typeof expr === 'string') return expr;
	    return this.$expression(expr).get(this);
	  },
	  $update: function(){
	    var rootParent = this;
	    do{
	      if(rootParent.data.isolate || !rootParent.$parent) break;
	      rootParent = rootParent.$parent;
	    } while(rootParent)

	    var prephase =rootParent.$phase;
	    rootParent.$phase = 'digest'

	    this.$set.apply(this, arguments);

	    rootParent.$phase = prephase

	    rootParent.$digest();
	    return this;
	  },
	  // auto collect watchers for logic-control.
	  _record: function(){
	    if(!this._records) this._records = [];
	    this._records.push([]);
	  },
	  _release: function(){
	    return this._records.pop();
	  }
	}


	_.extend(Watcher.prototype, methods)


	Watcher.mixTo = function(obj){
	  obj = typeof obj === "function" ? obj.prototype : obj;
	  return _.extend(obj, methods)
	}

	module.exports = Watcher;

/***/ },
/* 18 */
/***/ function(module, exports, __webpack_require__) {

	var exprCache = __webpack_require__(1).exprCache;
	var _ = __webpack_require__(5);
	var Parser = __webpack_require__(13);
	module.exports = {
	  expression: function(expr, simple){
	    // @TODO cache
	    if( typeof expr === 'string' && ( expr = expr.trim() ) ){
	      expr = exprCache.get( expr ) || exprCache.set( expr, new Parser( expr, { mode: 2, expression: true } ).expression() )
	    }
	    if(expr) return expr;
	  },
	  parse: function(template){
	    return new Parser(template).parse();
	  }
	}



/***/ },
/* 19 */
/***/ function(module, exports, __webpack_require__) {

	
	var f = module.exports = {};

	// json:  two way 
	//  - get: JSON.stringify
	//  - set: JSON.parse
	//  - example: `{ title|json }`
	f.json = {
	  get: function( value ){
	    return typeof JSON !== 'undefined'? JSON.stringify(value): value;
	  },
	  set: function( value ){
	    return typeof JSON !== 'undefined'? JSON.parse(value) : value;
	  }
	}

	// last: one-way
	//  - get: return the last item in list
	//  - example: `{ list|last }`
	f.last = function(arr){
	  return arr && arr[arr.length - 1];
	}

	// average: one-way
	//  - get: copute the average of the list
	//  - example: `{ list| average: "score" }`
	f.average = function(array, key){
	  array = array || [];
	  return array.length? f.total(array, key)/ array.length : 0;
	}


	// total: one-way
	//  - get: copute the total of the list
	//  - example: `{ list| total: "score" }`
	f.total = function(array, key){
	  var total = 0;
	  if(!array) return;
	  array.forEach(function( item ){
	    total += key? item[key] : item;
	  })
	  return total;
	}

	// var basicSortFn = function(a, b){return b - a}

	// f.sort = function(array, key, reverse){
	//   var type = typeof key, sortFn; 
	//   switch(type){
	//     case 'function': sortFn = key; break;
	//     case 'string': sortFn = function(a, b){};break;
	//     default:
	//       sortFn = basicSortFn;
	//   }
	//   // need other refernce.
	//   return array.slice().sort(function(a,b){
	//     return reverse? -sortFn(a, b): sortFn(a, b);
	//   })
	//   return array
	// }




/***/ },
/* 20 */
/***/ function(module, exports, __webpack_require__) {

	// shim for es5
	var slice = [].slice;
	var tstr = ({}).toString;

	function extend(o1, o2 ){
	  for(var i in o2) if( o1[i] === undefined){
	    o1[i] = o2[i]
	  }
	  return o2;
	}


	module.exports = function(){
	  // String proto ;
	  extend(String.prototype, {
	    trim: function(){
	      return this.replace(/^\s+|\s+$/g, '');
	    }
	  });


	  // Array proto;
	  extend(Array.prototype, {
	    indexOf: function(obj, from){
	      from = from || 0;
	      for (var i = from, len = this.length; i < len; i++) {
	        if (this[i] === obj) return i;
	      }
	      return -1;
	    },
	    // polyfill from MDN 
	    // https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach
	    forEach: function(callback, ctx){
	      var k = 0;

	      // 1. Let O be the result of calling ToObject passing the |this| value as the argument.
	      var O = Object(this);

	      var len = O.length >>> 0; 

	      if ( typeof callback !== "function" ) {
	        throw new TypeError( callback + " is not a function" );
	      }

	      // 7. Repeat, while k < len
	      while( k < len ) {

	        var kValue;

	        if ( k in O ) {

	          kValue = O[ k ];

	          callback.call( ctx, kValue, k, O );
	        }
	        k++;
	      }
	    },
	    // @deprecated
	    //  will be removed at 0.5.0
	    filter: function(fun, context){

	      var t = Object(this);
	      var len = t.length >>> 0;
	      if (typeof fun !== "function")
	        throw new TypeError();

	      var res = [];
	      for (var i = 0; i < len; i++)
	      {
	        if (i in t)
	        {
	          var val = t[i];
	          if (fun.call(context, val, i, t))
	            res.push(val);
	        }
	      }

	      return res;
	    }
	  });

	  // Function proto;
	  extend(Function.prototype, {
	    bind: function(context){
	      var fn = this;
	      var preArgs = slice.call(arguments, 1);
	      return function(){
	        var args = preArgs.concat(slice.call(arguments));
	        return fn.apply(context, args);
	      }
	    }
	  })
	  
	  // Array
	  extend(Array, {
	    isArray: function(arr){
	      return tstr.call(arr) === "[object Array]";
	    }
	  })
	}



/***/ },
/* 21 */
/***/ function(module, exports, __webpack_require__) {

	// http://stackoverflow.com/questions/1354064/how-to-convert-characters-to-html-entities-using-plain-javascript
	var entities = {
	  'quot':34, 
	  'amp':38, 
	  'apos':39, 
	  'lt':60, 
	  'gt':62, 
	  'nbsp':160, 
	  'iexcl':161, 
	  'cent':162, 
	  'pound':163, 
	  'curren':164, 
	  'yen':165, 
	  'brvbar':166, 
	  'sect':167, 
	  'uml':168, 
	  'copy':169, 
	  'ordf':170, 
	  'laquo':171, 
	  'not':172, 
	  'shy':173, 
	  'reg':174, 
	  'macr':175, 
	  'deg':176, 
	  'plusmn':177, 
	  'sup2':178, 
	  'sup3':179, 
	  'acute':180, 
	  'micro':181, 
	  'para':182, 
	  'middot':183, 
	  'cedil':184, 
	  'sup1':185, 
	  'ordm':186, 
	  'raquo':187, 
	  'frac14':188, 
	  'frac12':189, 
	  'frac34':190, 
	  'iquest':191, 
	  'Agrave':192, 
	  'Aacute':193, 
	  'Acirc':194, 
	  'Atilde':195, 
	  'Auml':196, 
	  'Aring':197, 
	  'AElig':198, 
	  'Ccedil':199, 
	  'Egrave':200, 
	  'Eacute':201, 
	  'Ecirc':202, 
	  'Euml':203, 
	  'Igrave':204, 
	  'Iacute':205, 
	  'Icirc':206, 
	  'Iuml':207, 
	  'ETH':208, 
	  'Ntilde':209, 
	  'Ograve':210, 
	  'Oacute':211, 
	  'Ocirc':212, 
	  'Otilde':213, 
	  'Ouml':214, 
	  'times':215, 
	  'Oslash':216, 
	  'Ugrave':217, 
	  'Uacute':218, 
	  'Ucirc':219, 
	  'Uuml':220, 
	  'Yacute':221, 
	  'THORN':222, 
	  'szlig':223, 
	  'agrave':224, 
	  'aacute':225, 
	  'acirc':226, 
	  'atilde':227, 
	  'auml':228, 
	  'aring':229, 
	  'aelig':230, 
	  'ccedil':231, 
	  'egrave':232, 
	  'eacute':233, 
	  'ecirc':234, 
	  'euml':235, 
	  'igrave':236, 
	  'iacute':237, 
	  'icirc':238, 
	  'iuml':239, 
	  'eth':240, 
	  'ntilde':241, 
	  'ograve':242, 
	  'oacute':243, 
	  'ocirc':244, 
	  'otilde':245, 
	  'ouml':246, 
	  'divide':247, 
	  'oslash':248, 
	  'ugrave':249, 
	  'uacute':250, 
	  'ucirc':251, 
	  'uuml':252, 
	  'yacute':253, 
	  'thorn':254, 
	  'yuml':255, 
	  'fnof':402, 
	  'Alpha':913, 
	  'Beta':914, 
	  'Gamma':915, 
	  'Delta':916, 
	  'Epsilon':917, 
	  'Zeta':918, 
	  'Eta':919, 
	  'Theta':920, 
	  'Iota':921, 
	  'Kappa':922, 
	  'Lambda':923, 
	  'Mu':924, 
	  'Nu':925, 
	  'Xi':926, 
	  'Omicron':927, 
	  'Pi':928, 
	  'Rho':929, 
	  'Sigma':931, 
	  'Tau':932, 
	  'Upsilon':933, 
	  'Phi':934, 
	  'Chi':935, 
	  'Psi':936, 
	  'Omega':937, 
	  'alpha':945, 
	  'beta':946, 
	  'gamma':947, 
	  'delta':948, 
	  'epsilon':949, 
	  'zeta':950, 
	  'eta':951, 
	  'theta':952, 
	  'iota':953, 
	  'kappa':954, 
	  'lambda':955, 
	  'mu':956, 
	  'nu':957, 
	  'xi':958, 
	  'omicron':959, 
	  'pi':960, 
	  'rho':961, 
	  'sigmaf':962, 
	  'sigma':963, 
	  'tau':964, 
	  'upsilon':965, 
	  'phi':966, 
	  'chi':967, 
	  'psi':968, 
	  'omega':969, 
	  'thetasym':977, 
	  'upsih':978, 
	  'piv':982, 
	  'bull':8226, 
	  'hellip':8230, 
	  'prime':8242, 
	  'Prime':8243, 
	  'oline':8254, 
	  'frasl':8260, 
	  'weierp':8472, 
	  'image':8465, 
	  'real':8476, 
	  'trade':8482, 
	  'alefsym':8501, 
	  'larr':8592, 
	  'uarr':8593, 
	  'rarr':8594, 
	  'darr':8595, 
	  'harr':8596, 
	  'crarr':8629, 
	  'lArr':8656, 
	  'uArr':8657, 
	  'rArr':8658, 
	  'dArr':8659, 
	  'hArr':8660, 
	  'forall':8704, 
	  'part':8706, 
	  'exist':8707, 
	  'empty':8709, 
	  'nabla':8711, 
	  'isin':8712, 
	  'notin':8713, 
	  'ni':8715, 
	  'prod':8719, 
	  'sum':8721, 
	  'minus':8722, 
	  'lowast':8727, 
	  'radic':8730, 
	  'prop':8733, 
	  'infin':8734, 
	  'ang':8736, 
	  'and':8743, 
	  'or':8744, 
	  'cap':8745, 
	  'cup':8746, 
	  'int':8747, 
	  'there4':8756, 
	  'sim':8764, 
	  'cong':8773, 
	  'asymp':8776, 
	  'ne':8800, 
	  'equiv':8801, 
	  'le':8804, 
	  'ge':8805, 
	  'sub':8834, 
	  'sup':8835, 
	  'nsub':8836, 
	  'sube':8838, 
	  'supe':8839, 
	  'oplus':8853, 
	  'otimes':8855, 
	  'perp':8869, 
	  'sdot':8901, 
	  'lceil':8968, 
	  'rceil':8969, 
	  'lfloor':8970, 
	  'rfloor':8971, 
	  'lang':9001, 
	  'rang':9002, 
	  'loz':9674, 
	  'spades':9824, 
	  'clubs':9827, 
	  'hearts':9829, 
	  'diams':9830, 
	  'OElig':338, 
	  'oelig':339, 
	  'Scaron':352, 
	  'scaron':353, 
	  'Yuml':376, 
	  'circ':710, 
	  'tilde':732, 
	  'ensp':8194, 
	  'emsp':8195, 
	  'thinsp':8201, 
	  'zwnj':8204, 
	  'zwj':8205, 
	  'lrm':8206, 
	  'rlm':8207, 
	  'ndash':8211, 
	  'mdash':8212, 
	  'lsquo':8216, 
	  'rsquo':8217, 
	  'sbquo':8218, 
	  'ldquo':8220, 
	  'rdquo':8221, 
	  'bdquo':8222, 
	  'dagger':8224, 
	  'Dagger':8225, 
	  'permil':8240, 
	  'lsaquo':8249, 
	  'rsaquo':8250, 
	  'euro':8364
	}



	module.exports  = entities;

/***/ },
/* 22 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);
	var dom  = __webpack_require__(4);
	var animate = {};
	var env = __webpack_require__(1);


	var 
	  transitionEnd = 'transitionend', 
	  animationEnd = 'animationend', 
	  transitionProperty = 'transition', 
	  animationProperty = 'animation';

	if(!('ontransitionend' in window)){
	  if('onwebkittransitionend' in window) {
	    
	    // Chrome/Saf (+ Mobile Saf)/Android
	    transitionEnd += ' webkitTransitionEnd';
	    transitionProperty = 'webkitTransition'
	  } else if('onotransitionend' in dom.tNode || navigator.appName === 'Opera') {

	    // Opera
	    transitionEnd += ' oTransitionEnd';
	    transitionProperty = 'oTransition';
	  }
	}
	if(!('onanimationend' in window)){
	  if ('onwebkitanimationend' in window){
	    // Chrome/Saf (+ Mobile Saf)/Android
	    animationEnd += ' webkitAnimationEnd';
	    animationProperty = 'webkitAnimation';

	  }else if ('onoanimationend' in dom.tNode){
	    // Opera
	    animationEnd += ' oAnimationEnd';
	    animationProperty = 'oAnimation';
	  }
	}

	/**
	 * inject node with animation
	 * @param  {[type]} node      [description]
	 * @param  {[type]} refer     [description]
	 * @param  {[type]} direction [description]
	 * @return {[type]}           [description]
	 */
	animate.inject = function( node, refer ,direction, callback ){
	  callback = callback || _.noop;
	  if( Array.isArray(node) ){
	    var fragment = dom.fragment();
	    var count=0;

	    for(var i = 0,len = node.length;i < len; i++ ){
	      fragment.appendChild(node[i]); 
	    }
	    dom.inject(fragment, refer, direction);

	    // if all nodes is done, we call the callback
	    var enterCallback = function (){
	      count++;
	      if( count === len ) callback();
	    }
	    if(len === count) callback();
	    for( i = 0; i < len; i++ ){
	      if(node[i].onenter){
	        node[i].onenter(enterCallback);
	      }else{
	        enterCallback();
	      }
	    }
	  }else{
	    dom.inject( node, refer, direction );
	    if(node.onenter){
	      node.onenter(callback)
	    }else{
	      callback();
	    }
	  }
	}

	/**
	 * remove node with animation
	 * @param  {[type]}   node     [description]
	 * @param  {Function} callback [description]
	 * @return {[type]}            [description]
	 */
	animate.remove = function(node, callback){
	  if(!node) return;
	  var count = 0;
	  function loop(){
	    count++;
	    if(count === len) callback && callback()
	  }
	  if(Array.isArray(node)){
	    for(var i = 0, len = node.length; i < len ; i++){
	      animate.remove(node[i], loop)
	    }
	    return node;
	  }
	  if(node.onleave){
	    node.onleave(function(){
	      removeDone(node, callback)
	    })
	  }else{
	    removeDone(node, callback)
	  }
	}

	var removeDone = function (node, callback){
	    dom.remove(node);
	    callback && callback();
	}



	animate.startClassAnimate = function ( node, className,  callback, mode ){
	  var activeClassName, timeout, tid, onceAnim;
	  if( (!animationEnd && !transitionEnd) || env.isRunning ){
	    return callback();
	  }

	  if(mode !== 4){
	    onceAnim = _.once(function onAnimateEnd(){
	      if(tid) clearTimeout(tid);

	      if(mode === 2) {
	        dom.delClass(node, activeClassName);
	      }
	      if(mode !== 3){ // mode hold the class
	        dom.delClass(node, className);
	      }
	      dom.off(node, animationEnd, onceAnim)
	      dom.off(node, transitionEnd, onceAnim)

	      callback();

	    });
	  }else{
	    onceAnim = _.once(function onAnimateEnd(){
	      if(tid) clearTimeout(tid);
	      callback();
	    });
	  }
	  if(mode === 2){ // auto removed
	    dom.addClass( node, className );

	    activeClassName = _.map(className.split(/\s+/), function(name){
	       return name + '-active';
	    }).join(" ");

	    dom.nextReflow(function(){
	      dom.addClass( node, activeClassName );
	      timeout = getMaxTimeout( node );
	      tid = setTimeout( onceAnim, timeout );
	    });

	  }else if(mode===4){
	    dom.nextReflow(function(){
	      dom.delClass( node, className );
	      timeout = getMaxTimeout( node );
	      tid = setTimeout( onceAnim, timeout );
	    });

	  }else{
	    dom.nextReflow(function(){
	      dom.addClass( node, className );
	      timeout = getMaxTimeout( node );
	      tid = setTimeout( onceAnim, timeout );
	    });
	  }



	  dom.on( node, animationEnd, onceAnim )
	  dom.on( node, transitionEnd, onceAnim )
	  return onceAnim;
	}


	animate.startStyleAnimate = function(node, styles, callback){
	  var timeout, onceAnim, tid;

	  dom.nextReflow(function(){
	    dom.css( node, styles );
	    timeout = getMaxTimeout( node );
	    tid = setTimeout( onceAnim, timeout );
	  });


	  onceAnim = _.once(function onAnimateEnd(){
	    if(tid) clearTimeout(tid);

	    dom.off(node, animationEnd, onceAnim)
	    dom.off(node, transitionEnd, onceAnim)

	    callback();

	  });

	  dom.on( node, animationEnd, onceAnim )
	  dom.on( node, transitionEnd, onceAnim )

	  return onceAnim;
	}


	/**
	 * get maxtimeout
	 * @param  {Node} node 
	 * @return {[type]}   [description]
	 */
	function getMaxTimeout(node){
	  var timeout = 0,
	    tDuration = 0,
	    tDelay = 0,
	    aDuration = 0,
	    aDelay = 0,
	    ratio = 5 / 3,
	    styles ;

	  if(window.getComputedStyle){

	    styles = window.getComputedStyle(node),
	    tDuration = getMaxTime( styles[transitionProperty + 'Duration']) || tDuration;
	    tDelay = getMaxTime( styles[transitionProperty + 'Delay']) || tDelay;
	    aDuration = getMaxTime( styles[animationProperty + 'Duration']) || aDuration;
	    aDelay = getMaxTime( styles[animationProperty + 'Delay']) || aDelay;
	    timeout = Math.max( tDuration+tDelay, aDuration + aDelay );

	  }
	  return timeout * 1000 * ratio;
	}

	function getMaxTime(str){

	  var maxTimeout = 0, time;

	  if(!str) return 0;

	  str.split(",").forEach(function(str){

	    time = parseFloat(str);
	    if( time > maxTimeout ) maxTimeout = time;

	  });

	  return maxTimeout;
	}

	module.exports = animate;

/***/ },
/* 23 */
/***/ function(module, exports, __webpack_require__) {

	/**
	 * event directive  bundle
	 *
	 */
	var _ = __webpack_require__(5);
	var dom = __webpack_require__(4);
	var Regular = __webpack_require__(3);

	Regular._addProtoInheritCache("event");

	Regular.directive( /^on-\w+$/, function( elem, value, name , attrs) {
	  if ( !name || !value ) return;
	  var type = name.split("-")[1];
	  return this._handleEvent( elem, type, value, attrs );
	});
	// TODO.
	/**
	- $('dx').delegate()
	*/
	Regular.directive( /^(delegate|de)-\w+$/, function( elem, value, name ) {
	  var root = this.$root;
	  var _delegates = root._delegates || ( root._delegates = {} );
	  if ( !name || !value ) return;
	  var type = name.split("-")[1];
	  var fire = _.handleEvent.call(this, value, type);

	  function delegateEvent(ev){
	    matchParent(ev, _delegates[type], root.parentNode);
	  }

	  if( !_delegates[type] ){
	    _delegates[type] = [];

	    if(root.parentNode){
	      dom.on(root.parentNode, type, delegateEvent);
	    }else{
	      root.$on( "$inject", function( node, position, preParent ){
	        var newParent = this.parentNode;
	        if( preParent ){
	          dom.off(preParent, type, delegateEvent);
	        }
	        if(newParent) dom.on(this.parentNode, type, delegateEvent);
	      })
	    }
	    root.$on("$destroy", function(){
	      if(root.parentNode) dom.off(root.parentNode, type, delegateEvent)
	      _delegates[type] = null;
	    })
	  }
	  var delegate = {
	    element: elem,
	    fire: fire
	  }
	  _delegates[type].push( delegate );

	  return function(){
	    var delegates = _delegates[type];
	    if(!delegates || !delegates.length) return;
	    for( var i = 0, len = delegates.length; i < len; i++ ){
	      if( delegates[i] === delegate ) delegates.splice(i, 1);
	    }
	  }

	});


	function matchParent(ev , delegates, stop){
	  if(!stop) return;
	  var target = ev.target, pair;
	  while(target && target !== stop){
	    for( var i = 0, len = delegates.length; i < len; i++ ){
	      pair = delegates[i];
	      if(pair && pair.element === target){
	        pair.fire(ev)
	      }
	    }
	    target = target.parentNode;
	  }
	}

/***/ },
/* 24 */
/***/ function(module, exports, __webpack_require__) {

	// Regular
	var _ = __webpack_require__(5);
	var dom = __webpack_require__(4);
	var Regular = __webpack_require__(3);

	var modelHandlers = {
	  "text": initText,
	  "select": initSelect,
	  "checkbox": initCheckBox,
	  "radio": initRadio
	}


	// @TODO


	// two-way binding with r-model
	// works on input, textarea, checkbox, radio, select

	Regular.directive("r-model", function(elem, value){
	  var tag = elem.tagName.toLowerCase();
	  var sign = tag;
	  if(sign === "input") sign = elem.type || "text";
	  else if(sign === "textarea") sign = "text";
	  if(typeof value === "string") value = this.$expression(value);

	  if( modelHandlers[sign] ) return modelHandlers[sign].call(this, elem, value);
	  else if(tag === "input"){
	    return modelHandlers.text.call(this, elem, value);
	  }
	});



	// binding <select>

	function initSelect( elem, parsed){
	  var self = this;
	  var wc =this.$watch(parsed, function(newValue){
	    var children = _.slice(elem.getElementsByTagName('option'))
	    children.forEach(function(node, index){
	      if(node.value == newValue){
	        elem.selectedIndex = index;
	      }
	    })
	  });

	  function handler(){
	    parsed.set(self, this.value);
	    wc.last = this.value;
	    self.$update();
	  }

	  dom.on(elem, "change", handler);
	  
	  if(parsed.get(self) === undefined && elem.value){
	     parsed.set(self, elem.value);
	  }
	  return function destroy(){
	    dom.off(elem, "change", handler);
	  }
	}

	// input,textarea binding

	function initText(elem, parsed){
	  var self = this;
	  var wc = this.$watch(parsed, function(newValue){
	    if(elem.value !== newValue) elem.value = newValue == null? "": "" + newValue;
	  });

	  // @TODO to fixed event
	  var handler = function (ev){
	    var that = this;
	    if(ev.type==='cut' || ev.type==='paste'){
	      _.nextTick(function(){
	        var value = that.value
	        parsed.set(self, value);
	        wc.last = value;
	        self.$update();
	      })
	    }else{
	        var value = that.value
	        parsed.set(self, value);
	        wc.last = value;
	        self.$update();
	    }
	  };

	  if(dom.msie !== 9 && "oninput" in dom.tNode ){
	    elem.addEventListener("input", handler );
	  }else{
	    dom.on(elem, "paste", handler)
	    dom.on(elem, "keyup", handler)
	    dom.on(elem, "cut", handler)
	    dom.on(elem, "change", handler)
	  }
	  if(parsed.get(self) === undefined && elem.value){
	     parsed.set(self, elem.value);
	  }
	  return function (){
	    if(dom.msie !== 9 && "oninput" in dom.tNode ){
	      elem.removeEventListener("input", handler );
	    }else{
	      dom.off(elem, "paste", handler)
	      dom.off(elem, "keyup", handler)
	      dom.off(elem, "cut", handler)
	      dom.off(elem, "change", handler)
	    }
	  }
	}


	// input:checkbox  binding

	function initCheckBox(elem, parsed){
	  var self = this;
	  var watcher = this.$watch(parsed, function(newValue){
	    dom.attr(elem, 'checked', !!newValue);
	  });

	  var handler = function handler(){
	    var value = this.checked;
	    parsed.set(self, value);
	    watcher.last = value;
	    self.$update();
	  }
	  if(parsed.set) dom.on(elem, "change", handler)

	  if(parsed.get(self) === undefined){
	    parsed.set(self, !!elem.checked);
	  }

	  return function destroy(){
	    if(parsed.set) dom.off(elem, "change", handler)
	  }
	}


	// input:radio binding

	function initRadio(elem, parsed){
	  var self = this;
	  var wc = this.$watch(parsed, function( newValue ){
	    if(newValue == elem.value) elem.checked = true;
	    else elem.checked = false;
	  });


	  var handler = function handler(){
	    var value = this.value;
	    parsed.set(self, value);
	    self.$update();
	  }
	  if(parsed.set) dom.on(elem, "change", handler)
	  // beacuse only after compile(init), the dom structrue is exsit. 
	  if(parsed.get(self) === undefined){
	    if(elem.checked) {
	      parsed.set(self, elem.value);
	    }
	  }

	  return function destroy(){
	    if(parsed.set) dom.off(elem, "change", handler)
	  }
	}


/***/ },
/* 25 */
/***/ function(module, exports, __webpack_require__) {

	var _ = __webpack_require__(5);

	function simpleDiff(now, old){
	  var nlen = now.length;
	  var olen = old.length;
	  if(nlen !== olen){
	    return true;
	  }
	  for(var i = 0; i < nlen ; i++){
	    if(now[i] !== old[i]) return  true;
	  }
	  return false

	}

	function equals(a,b){
	  return a === b;
	}

	// array1 - old array
	// array2 - new array
	function ld(array1, array2, equalFn){
	  var n = array1.length;
	  var m = array2.length;
	  var equalFn = equalFn || equals;
	  var matrix = [];
	  for(var i = 0; i <= n; i++){
	    matrix.push([i]);
	  }
	  for(var j=1;j<=m;j++){
	    matrix[0][j]=j;
	  }
	  for(var i = 1; i <= n; i++){
	    for(var j = 1; j <= m; j++){
	      if(equalFn(array1[i-1], array2[j-1])){
	        matrix[i][j] = matrix[i-1][j-1];
	      }else{
	        matrix[i][j] = Math.min(
	          matrix[i-1][j]+1, //delete
	          matrix[i][j-1]+1//add
	          )
	      }
	    }
	  }
	  return matrix;
	}
	// arr2 - new array
	// arr1 - old array
	function diffArray(arr2, arr1, diff, diffFn) {
	  if(!diff) return simpleDiff(arr2, arr1);
	  var matrix = ld(arr1, arr2, diffFn)
	  var n = arr1.length;
	  var i = n;
	  var m = arr2.length;
	  var j = m;
	  var edits = [];
	  var current = matrix[i][j];
	  while(i>0 || j>0){
	  // the last line
	    if (i === 0) {
	      edits.unshift(3);
	      j--;
	      continue;
	    }
	    // the last col
	    if (j === 0) {
	      edits.unshift(2);
	      i--;
	      continue;
	    }
	    var northWest = matrix[i - 1][j - 1];
	    var west = matrix[i - 1][j];
	    var north = matrix[i][j - 1];

	    var min = Math.min(north, west, northWest);

	    if (min === west) {
	      edits.unshift(2); //delete
	      i--;
	      current = west;
	    } else if (min === northWest ) {
	      if (northWest === current) {
	        edits.unshift(0); //no change
	      } else {
	        edits.unshift(1); //update
	        current = northWest;
	      }
	      i--;
	      j--;
	    } else {
	      edits.unshift(3); //add
	      j--;
	      current = north;
	    }
	  }
	  var LEAVE = 0;
	  var ADD = 3;
	  var DELELE = 2;
	  var UPDATE = 1;
	  var n = 0;m=0;
	  var steps = [];
	  var step = {index: null, add:0, removed:[]};

	  for(var i=0;i<edits.length;i++){
	    if(edits[i] > 0 ){ // NOT LEAVE
	      if(step.index === null){
	        step.index = m;
	      }
	    } else { //LEAVE
	      if(step.index != null){
	        steps.push(step)
	        step = {index: null, add:0, removed:[]};
	      }
	    }
	    switch(edits[i]){
	      case LEAVE:
	        n++;
	        m++;
	        break;
	      case ADD:
	        step.add++;
	        m++;
	        break;
	      case DELELE:
	        step.removed.push(arr1[n])
	        n++;
	        break;
	      case UPDATE:
	        step.add++;
	        step.removed.push(arr1[n])
	        n++;
	        m++;
	        break;
	    }
	  }
	  if(step.index != null){
	    steps.push(step)
	  }
	  return steps
	}



	// diffObject
	// ----
	// test if obj1 deepEqual obj2
	function diffObject( now, last, diff ){


	  if(!diff){

	    for( var j in now ){
	      if( last[j] !== now[j] ) return true
	    }

	    for( var n in last ){
	      if(last[n] !== now[n]) return true;
	    }

	  }else{

	    var nKeys = _.keys(now);
	    var lKeys = _.keys(last);

	    /**
	     * [description]
	     * @param  {[type]} a    [description]
	     * @param  {[type]} b){                   return now[b] [description]
	     * @return {[type]}      [description]
	     */
	    return diffArray(nKeys, lKeys, diff, function(a, b){
	      return now[b] === last[a];
	    });

	  }

	  return false;


	}

	module.exports = {
	  diffArray: diffArray,
	  diffObject: diffObject
	}

/***/ },
/* 26 */
/***/ function(module, exports, __webpack_require__) {

	module.exports = {
	  element: function(name, attrs, children){
	    return {
	      type: 'element',
	      tag: name,
	      attrs: attrs,
	      children: children
	    }
	  },
	  attribute: function(name, value, mdf){
	    return {
	      type: 'attribute',
	      name: name,
	      value: value,
	      mdf: mdf
	    }
	  },
	  "if": function(test, consequent, alternate){
	    return {
	      type: 'if',
	      test: test,
	      consequent: consequent,
	      alternate: alternate
	    }
	  },
	  list: function(sequence, variable, body, alternate, track){
	    return {
	      type: 'list',
	      sequence: sequence,
	      alternate: alternate,
	      variable: variable,
	      body: body,
	      track: track
	    }
	  },
	  expression: function( body, setbody, constant ){
	    return {
	      type: "expression",
	      body: body,
	      constant: constant || false,
	      setbody: setbody || false
	    }
	  },
	  text: function(text){
	    return {
	      type: "text",
	      text: text
	    }
	  },
	  template: function(template){
	    return {
	      type: 'template',
	      content: template
	    }
	  }
	}


/***/ }
/******/ ])
});

I$('f1834edae975e5e4f98508a3c747ba5f',function (r) {
    var dom = Regular.dom;
    return {
        'enter': function (elem, fire) {
            var _eventHandle = function (event) {
                if (event.which == 13) {
                    event.preventDefault();
                    event.stopPropagation();
                    fire(event);
                }
            };
            dom.on(elem, 'keypress', _eventHandle);
            return function destroy() {
                dom.off(elem, 'keypress', _eventHandle);
            }
        }
    }
},'b7f023da04085988ad5aa329ad30e7aa');
I$('764200f19923af91400d9fd80d388666',function (e, r) {
    return {
        'r-autofocus': function (elem, value) {
            setTimeout(function () {
                elem.focus();
            }, 0)
        },
        'r-show': function (elem, value) {
            if (typeof value === 'object' && value.type == 'expression') {
                this.$watch(value, function (newValue, oldValue) {
                    if (!newValue == !oldValue) return;

                    if (typeof newValue === 'string') {
                        elem.style.display = newValue;
                    }
                    else {
                        elem.style.display = newValue ? 'block' : '';
                    }
                });

            } else if (!!value || value === '') {
                if (typeof value === 'string' && value !== '') {
                    elem.style.display = value;
                } else {
                    elem.style.display = value ? 'block' : '';
                }
            }
        },
        'z-sel': function (elem, value) {
            if (typeof  value === 'object' && value.type == 'expression') {
                this.$watch(value, function (newV, oldV) {
                    if (newV) {
                        e._$addClassName(elem, 'z-sel');
                    } else {
                        e._$delClassName(elem, 'z-sel');
                    }
                })
            } else if (!!value || value === '') {
                e._$addClassName(elem, 'z-sel');
            }
        }
    }
},'555a9eecaf26c5c01fe9db8d965bc30f','b7f023da04085988ad5aa329ad30e7aa');
I$('ffa820b4cb293ae990489967d5c4a899',function (event, directive, p, pro) {
    p.Component = Regular.extend({
            emitter: new Regular(),
            copy: function (object) {
                return JSON.parse(JSON.stringify(object));
            }
        })
        .event(event)
        .directive(directive)
        .filter({
            "ignoreTextStatus":function (item,index) {
                var text = "";
                var unignoreList = this.data.params[index].imports.filter(function (itm) {
                    return !itm.ignored;
                });
                if(unignoreList.length <= 1 && !item.ignored){
                    text = "";
                } else {
                    text = item.ignored ? "取消忽略" : "忽略";
                }
                return text;
            }
        })
    ;
    return p.Component;
},'f1834edae975e5e4f98508a3c747ba5f','764200f19923af91400d9fd80d388666');
I$('729d743c4edbdf34dd526cdccdb93714',"<div class=\"m-modal {@(class)}\" r-hide={!show} on-click={this._onclickBody($event)}>\n    <div class=\"modal-dialog modal-dialog-{size}\">\n        <div class=\"modal-hd\">\n            {#if closeButton}\n            <a class=\"modal-close\" on-click={this.close($event)}><i class=\"u-icon-close-normal-2\"></i><i class=\"u-icon-close-hover-2\"></i></a>\n            {/if}\n            {#if !noTitle}\n            <h3 class=\"modal-title\">{title}</h3>\n            {/if}\n        </div>\n        <div class=\"modal-bd\" ref=\"modalbd\">\n            {#if contentTemplate}{#include @(contentTemplate)}{#else}{content}{/if}\n        </div>\n        <div class=\"modal-ft\">\n            {#if cancelButton}\n            <button class=\"u-btn u-btn-gray cancel\" on-click={this.cancel($event)} >{cancelButton === true ? '取消' : cancelButton}</button>\n            {/if}\n            {#if okButton}\n            <button class=\"u-btn\" on-click={this.ok($event)} ref=\"ok-btn\">{okButton === true ? '确定' : okButton}</button>\n            {/if}\n        </div>\n    </div>\n</div>\n");
I$('0ec1721486f69583c2f916fe18a11797',".m-modal{\n\tbackground-color:rgba(0,0,0,0.2);\n\tposition:fixed;\n\tz-index:999;\n\ttop:0;\n\tright:0;\n\tbottom:0;\n\tleft:0;\n\ttext-align:center;\n\twhite-space:nowrap;\n\toverflow-x:hidden;\n\toverflow-y:auto;\n}\n.m-modal:before{\n\tcontent:\"\";\n\tdisplay:inline-block;\n\tvertical-align:middle;\n\theight:100%;\n}\n.m-modal .modal-dialog{\n\tposition:relative;\n\tdisplay:inline-block;\n\tvertical-align:middle;\n\twidth:500px;\n\tmax-height:90%;\n\toverflow:auto;\n\tpadding:30px 50px 60px 50px;\n\tbox-sizing:border-box;\n\tbackground:#fff;\n\tborder-radius:3px;\n}\n.m-modal .modal-hd{\n\tposition:relative;\n}\n.m-modal .modal-hd .modal-close{\n\tposition:absolute;\n\tright:-30px;\n\ttop:-10px;\n}\n.m-modal .modal-hd h3{\n\tcolor:#37474f;\n\theight:18px;\n\tline-height:18px;\n\tpadding:30px 0px 30px 0px;\n\tfont-size:20px;\n\ttext-align:center;\n\toverflow:hidden;\n\tword-wrap:normal;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n}\n.m-modal .modal-bd{\n\tmargin-bottom:20px;\n}\n.m-modal .modal-ft{\n\tdisplay:flex;\n\tjustify-content:center;\n}\n.m-modal .modal-ft button{\n\tmargin:0px 5px;\n}\n.m-modal .modal-close .u-icon-close-hover-2{\n\tdisplay:none;\n}\n.m-modal .modal-close:hover .u-icon-close-normal-2{\n\tdisplay:none;\n}\n.m-modal .modal-close:hover .u-icon-close-hover-2{\n\tdisplay:block;\n}\n.m-modal .modal-dialog-large{\n\twidth:900px;\n}\n.m-modal .modal-dialog-large .modal-ft{\n\tdisplay:flex;\n\tjustify-content:start !important;\n}\n.m-modal .modal-dialog-large .modal-ft button{\n\tmargin:0px 5px;\n\twidth:30%;\n}\n.m-modal-confirm .modal-ft .u-btn:focus{\n\tbox-shadow:2px 2px 5px #94c8e2;\n}");
I$('a17dfb1aca7e5bcf1c99411da2601159',function (base, e, tpl, css, Modal) {
    // 加载一次即可
    e._$addStyle(css);

    Modal = base.extend({
        template: tpl,
        /**
         * @protected
         */
        config: function (data) {
            this.data.title = this.data.title || '提示';
            this.data.show = this.data.show || true;
            this.data.modalType = this.data.modalType;
            //设定modal的尺寸参数
            this.data.size = this.data.size || 'normal';
            this.data.noTitle = this.data.noTitle || false;
            if (this.data.okButton === undefined) {
                this.data.okButton = true;
            }
            if (this.data.cancelButton === undefined) {
                this.data.cancelButton = true;
            }
            this.supr(this.data);
        },
        /**
         * @protected
         */
        init: function () {
            this.supr();
            // 证明不是内嵌组件
            if (this.$root === this) {
                this.$inject(document.body);
            }
        },
        /**
         * @method close(result) 关闭模态对话框
         * @public
         * @param  {boolean} result 点击确定还是取消
         * @return {void}
         */
        close: function (event) {
            this.$emit('close');
            this.destroy();
        },
        /**
         * @override
         */
        ok: function () {
            this.$emit('ok');
            this.destroy();
        },
        /**
         * @override
         */
        cancel: function () {
            /**
             * @event cancel 取消对话框时触发
             */
            this.$emit('cancel');
            this.destroy();
        },

        hide: function () {
            this.data.show = false;
            this.$update();
        },
        show: function () {
            this.data.show = true;
            this.$update();
        },
        destroy:function () {
            this.supr();
        },
        _onclickBody:function ($event) {
           //$event.stopPropagation();
        }
    });


    /**
     * @method alert([content][,title]) 弹出一个alert对话框。关闭时始终触发确定事件。
     * @static
     * @param  {string=''} content 对话框内容
     * @param  {string='提示'} title 对话框标题
     * @return {void}
     */
    Modal.alert = function (option) {
        var modal = new Modal({
            data: {
                "class": "m-modal-alert " + (option.clazz || ""),
                content: option.content,
                modalType: 'alert',
                title: option.title || "",
                okButton: true,
                cancelButton: false,
                closeButton:true
            }
        });
        return modal;
    }

    /**
     * @method confirm([content][,title]) 弹出一个confirm对话框
     * @static
     * @param  {string=''} content 对话框内容
     * @param  {string='提示'} title 对话框标题
     * @return {void}
     */
    Modal.confirm = function (option) {
        var modal = new Modal({
            data: {
                "class": "m-modal-confirm " + (option.clazz || ""),
                contentTemplate: '<h3 class="message">' + option.content + '</h3>',
                confirmIcon: option.confirmIcon || false,
                content:option.content || "",
                modalType: 'confirm',
                title: option.title || '提示',
                closeButton:true,
                okButton: true,
                cancelButton:true
            }
        });
        modal.$refs["ok-btn"].focus();
        return modal;
    }
    return Modal;
},'ffa820b4cb293ae990489967d5c4a899','555a9eecaf26c5c01fe9db8d965bc30f','729d743c4edbdf34dd526cdccdb93714','0ec1721486f69583c2f916fe18a11797');
I$('8cbc286a7834dfcf29c8f7a018e77c02',function (u, e, v, t, jst, jsonbean, db, headname, headvalue, MockDataWorkerUtil, _dbConst, Modal, p) {
    /**
     *对象扩展
     * @param target 目标对象
     * @param source 扩展来源
     * @param override 是否重写
     * return {object}
     */
    p._$extend = function (target, source, override) {
        for (var i in source) {
            if (typeof target[i] === 'undefined' || target[i] === null || override) {
                target[i] = source[i];
            }
        }
        return target;
    };
    /**
     *
     * @param {object} obj
     * @returns {object}
     */
    p._$clone = function (obj) {
        if (!obj) return [];
        var newobj = obj.constructor === Array ? [] : {};
        if (typeof  obj !== "object") return;
        for (var i in obj) {
            if (typeof  obj[i] === 'object') {
                newobj[i] = arguments.callee.call(null, obj[i]);
            } else {
                newobj[i] = obj[i];
            }
        }
        return newobj;

    };
    //前后端公用常量
    p.db = db;
    p.headname = headname;
    p.headvalue = headvalue;
    p.dtSysType = [db.MDL_SYS_UNKNOWN, db.MDL_SYS_FILE, db.MDL_SYS_VARIABLE, db.MDL_SYS_STRING, db.MDL_SYS_NUMBER, db.MDL_SYS_BOOLEAN];
    /**
     * 将字符串转换为JSON对象
     * @param {String} _value
     * return {Object}
     */
    p._$getValidJSON = function (_value) {
        var _json = null;
        try {
            _json = JSON.parse(_value);
        } catch (_er) {
            try {
                _json = eval('(' + _value + ')');
            } catch (_err) {
            }
        }
        return _json;
    };
    /**
     * 数组排序
     * @param  {Array}   arr  排序数组
     * @param  {String}  type 排序类型 (String,Number)
     * @param  {String}  tag  排序字段
     * @param  {Boolean} flag 排序标志 (true:升序,false:降序)
     * @return {Void}
     * added by wzt
     */
    p._$sortBy = function (arr, type, tag, flag) {
        if (!arr.length) {
            return;
        }
        if (!!flag) {
            if (type == 'string') {
                arr.sort(function (a, b) {
                    return b[tag].localeCompare(a[tag]);
                });
            } else {
                arr.sort(function (a, b) {
                    return a[tag] - b[tag];
                });
            }
        } else {
            if (type == 'string') {
                arr.sort(function (a, b) {
                    return a[tag].localeCompare(b[tag]);
                });
            } else {
                arr.sort(function (a, b) {
                    return b[tag] - a[tag];
                });
            }
        }
    }

    /**
     * 根据对象计算 css class 名
     * @param  {Object} config - 配置对象
     * @return {String} - 类名
     */
    p.classNames = function (config) {
        if (typeof config === 'string') {
            return config;
        } else {
            var classStr = '';
            Object.keys(config).forEach(function (key, index) {
                if (config[key]) {
                    if (index !== 0) {
                        classStr += ' ' + key;
                    } else {
                        classStr += key;
                    }
                }
            });
            return classStr;
        }
    }

    /**
     * 匹配拼音
     * @param  {String} pinyin - 拼音字符串
     * @param  {String} value - 输入字符串
     * @return {Boolean|Array} - 不匹配返回 false, 否则返回匹配的索引值信息
     */
    p.matchPinyin = function (pinyin, value) {
        if (!pinyin) {
            return false;
        }
        // todo: 多个标签以逗号分隔, 它的拼音是这样的: tag: "资源,模板", tagPinyin: "zi'yuan','mo'ban"
        // 也就是, 拼音字段的最前面和最后面可能会出现多余的单引号, 需要去掉, 这里使用正则
        pinyin = pinyin.replace(/^'|'$/g, '');
        var pys = pinyin.split("'");
        var py;
        var chars = value.split('');
        var i;
        var hitIndexes = [];
        var index = 0;
        while (py = pys.shift()) {
            if (py.startsWith(chars[0])) {
                for (i = 0; i < py.length; i++) {
                    if (py[i] === chars[0]) {
                        chars.shift();
                    } else {
                        break;
                    }
                }
                hitIndexes.push(index);
            }
            index++;
        }
        // 没有消耗完就说明匹配不成功
        if (chars.length) {
            return false;
        } else {
            return hitIndexes;
        }
    };

    /**
     * 匹配拼音, 返回高亮字符串，转义非高亮字符
     * @param  {String} name - 原始字符串
     * @param  {String} namePinyin - 原始对应的拼音字符串
     * @param  {String} value - 输入字符串
     * @return {Boolean|String} - 不匹配返回 false, 否则返回匹配的含高亮信息的html字符串
     */
    p.highlightPinyin = function (name, namePinyin, value) {
        var matchResult = this.matchPinyin(namePinyin, value);
        if (matchResult) {
            namePinyin = namePinyin.replace(/^'|'$/g, '');
            var pys = namePinyin.split("'");
            var charIndex = 0;
            var uiName = '';
            pys.forEach(function (py, idx) { // eg: pys = [ 1a, wo, 2b, ai, 3c, ni ] 字符单词或者拼音, name = '1a我2b爱3c你'
                var stepChars = name.substr(charIndex, py.length); // 取单词长度的连续字符
                if (stepChars.toLowerCase() === py.toLowerCase()) { // 肯定是非中文
                    uiName += u._$escape(py);
                    charIndex += py.length;
                }
                else { // 中文
                    stepChars = name.substr(charIndex, 1);
                    if (matchResult.indexOf(idx) !== -1) { // 命中的字
                        uiName += ('<b class="hl">' + stepChars + '</b>');
                    }
                    else {
                        uiName += stepChars;
                    }
                    charIndex++;
                }
            });
            return uiName;
        }
        return false;
    };

    /**
     * 提取列表中tag字段信息
     * @param {Array} list header列表
     * @returns {Array}
     */
    p.getTagList = function (list) {
        var pinYinlist = {};
        list.map(function (item) {
            if (!item.tag) return;
            var tags = item.tag.split(',');
            var tagPinyins = item.tagPinyin.split(',');
            tags.forEach(function (tag, idx) {
                // 会有空字符串 NEI-277
                if (tag) {
                    pinYinlist[tag] = tagPinyins[idx];
                }
            });
        });
        var tags = Object.keys(pinYinlist).map(function (tag) {
            return {
                id: tag,
                name: tag,
                value: tag, /*stripedlist 头部标签会用到这个属性*/
                namePinyin: pinYinlist[tag]
            }
        });
        tags.sort(function (a, b) {
            return a.name.localeCompare(b.name);
        });
        return tags;
    };
    /**
     * 添加导入参数的时候进行转换成后端对应的参数格式
     * @param _imports
     * @returns {Array}
     */
    p._$getImportsParams = function (_imports) {
        //将导入的参数进行归类
        var _obj = {
            id: "",
            vars: []
        }
        var _temp = [];
        u._$forEach(_imports, function (item, i) {
            if (item.parentId == _obj.id) {
                _obj.vars.push(item);
            } else {
                if (_obj.id != "") {
                    _temp.push(u._$merge({}, _obj));
                }
                _obj.id = item.parentId;
                _obj.vars = [item];
            }
            if (i == _imports.length - 1) {
                _temp.push(u._$merge({}, _obj));
            }
        });
        return _temp;
    }
    /**
     * 高亮代码
     * @param{Object} json - json 数据
     * @param{Node} container - DOM 容器
     */
    p._$initSampleCode = function (json, container) {
        var str = JSON.stringify(json, null, '\t');
        var editor = ace.edit(container);
        editor.setTheme("ace/theme/eclipse");
        editor.getSession().setMode("ace/mode/json");
        editor.setValue(str, -1);
        editor.setOptions({
            maxLines: 20
        });
        editor.setOption("showPrintMargin", false);
        editor.setReadOnly(true);
    };
    /**
     * 判断数据类型是否是系统类型
     * @param {Number} id - 数据模型id
     * @return {Boolean} 是否为系统类型
     */
    p._$isSystem = function (id) {
        return this.dtSysType.indexOf(id) != -1;
    };
    /**
     * 高亮数据模型范例代码
     * @param{Number} id - 数据模型的 id
     * @param{Array} dataTypes - 所有数据模型列表
     * @param{Array} constraints - 所有规则函数列表
     * @param{Node} container1 - 范例代码 DOM 容器
     * @param{Node} container2 - 没有范例代码时显示提示的 DOM 容器
     */
    p._$initDataTypeSampleCode = function (id, dataTypes, constraints, container1, container2) {

        MockDataWorkerUtil.getDataTypeMockData(
            window.location.origin,
            constraints,
            id,
            dataTypes,
            function (result) {
                if (result.checkError) {
                    e._$addClassName(container1, 'f-dn');
                    e._$delClassName(container2, 'f-dn');
                    container2.innerHTML = result.checkError;
                } else {
                    e._$delClassName(container1, 'f-dn');
                    e._$addClassName(container2, 'f-dn');
                    this._$initSampleCode(result.json, container1);
                }
            }.bind(this),
            function (error) {
                var content = '';
                error.forEach(function (item) {
                    content += (item.name ? '参数' + item.name + ' : ' : '') + item.message + '\n';
                });
                Modal.alert({
                    title: '生成规则JS脚本错误',
                    content: content,
                    clazz: 'modal-exp-error'
                });
            }.bind(this)
        );
    };
    /**
     * 高亮参数范例代码
     * @param{Number} format - 参数类别
     * @param{Array} params - 参数数组
     * @param{Array} dataTypes - 所有数据模型列表
     * @param{Node} container1 - 范例代码 DOM 容器
     * @param{Node} container2 - 没有范例代码时显示提示的 DOM 容器
     */
    p._$initParamsSampleCode = function (format, params, constraints, dataTypes, container1, container2, callback) {
        if (params && params.length === 0) {
            // 没有参数
            e._$addClassName(container1, 'f-dn');
            e._$delClassName(container2, 'f-dn');
            (typeof callback === 'function') && callback({});
            return container2.innerHTML = '无';
        }
        MockDataWorkerUtil.getParameterMockData(
            window.location.origin,
            constraints,
            format,
            params,
            dataTypes,
            function (result) {
                if (result.checkError) {
                    e._$addClassName(container1, 'f-dn');
                    e._$delClassName(container2, 'f-dn');
                    container2.innerHTML = result.checkError;
                } else {
                    e._$delClassName(container1, 'f-dn');
                    e._$addClassName(container2, 'f-dn');
                    this._$initSampleCode(result.json, container1);
                    (typeof callback === 'function') && callback(result.json);
                }
            }.bind(this),
            function (error) {
                var content = '';
                error.forEach(function (item) {
                    content += (item.name ? 'å‚æ•°' + item.name + ' : ' : '') + item.message + '\n';
                });
                Modal.alert({
                    title: 'ç”Ÿæˆè§„åˆ™JSè„šæœ¬é”™è¯¯',
                    content: content,
                    clazz: 'modal-exp-error'
                });
            }.bind(this)
        );
    };
    /**
     * èŽ·å– http method åˆ—è¡¨
     */
    p._$getMethodList = function () {
        return [
            {name: 'GET', id: 'GET'},
            {name: 'POST', id: 'POST'},
            {name: 'PUT', id: 'PUT'},
            {name: 'PATCH', id: 'PATCH'},
            {name: 'DELETE', id: 'DELETE'},
            {name: 'HEAD', id: 'HEAD'}
        ];
    }
    /**
     * ä¸Šä¼ å¤´åƒé»˜è®¤èƒŒæ™¯åŠé¦–å­—æ¯
     * @param {Array} list è¦å¤„ç†çš„æ•°ç»„
     * @param {String} name åç§°å­—æ®µ
     * @param {String} namePinyin åç§°æ‹¼éŸ³å­—æ®µ
     * *added by gegenhasi
     */
    p._$resetLogo = function (list, name, namePinyin) {
        var v;
        var letterMap = {
            b: v = 'u-avatar-second', h: v, n: v, t: v, z: v,
            c: v = 'u-avatar-third', i: v, o: v, u: v,
            d: v = 'u-avatar-fourth', j: v, p: v, v: v,
            e: v = 'u-avatar-fifth', l: v, q: v, w: v,
            f: v = 'u-avatar-sixth', k: v, r: v, x: v
        };

        list.forEach(function (item) {
            if (item.logo) {
                return;
            }
            item.letterText = item[name].trim().charAt(0).toUpperCase();
            item.bgClassName = letterMap[item[namePinyin].trim().charAt(0)] || 'u-avatar-default';
        });
    };
    /**
     * æ ¹æ®å­—ç¬¦ä¸²æ¨¡æ¿å’Œæ•°æ®, è¿”å›žæ›¿æ¢åŽçš„å­—ç¬¦ä¸²
     * @param{String} str - å­—ç¬¦ä¸²æ¨¡æ¿
     * @param{Object} data - æ•°æ®
     * @return{String} æ›¿æ¢åŽçš„å­—ç¬¦ä¸²
     */
    p._$renderByJst = function (str, data) {
        return jst._$get(jst._$add(str), data);
    }
    /**
     * æ¸…é™¤é€‰ä¸­
     * added by gegenhasi
     */
    p.__clearSelections = function () {
        if (window.getSelection) {
            // èŽ·å–é€‰ä¸­
            var selection = window.getSelection();
            // æ¸…é™¤é€‰ä¸­
            selection.removeAllRanges();
        } else if (document.selection && document.selection.empty) {
            // å…¼å®¹ IE8 ä»¥ä¸‹ï¼Œä½† IE9+ ä»¥ä¸ŠåŒæ ·å¯ç”¨
            document.selection.empty();
        }
    };
    /**
     * åˆå§‹åŒ–æŽ’åºæ–¹å¼
     * @param  {Number} orderType æŽ’åºæ–¹å¼
     * @param {String} sortType å½“å‰æŽ’åºæ–¹å¼ï¼ˆå­—ç¬¦ä¸²ï¼‰
     * added by gegenhasi
     */
    p.__initOrder = function (orderType, sortType) {
        switch (orderType) {
            case 0:
                sortType = '';
                break;
            case 1:
                sortType = 'name-up';
                break;
            case 2:
                sortType = 'name-down';
                break;
            case 3:
                sortType = 'time-up';
                break;
            case 4:
                sortType = 'time-down';
                break;
            case 5:
                sortType = 'count-up';
                break;
            case 6:
                sortType = 'count-down';
                break;
        }
        return sortType;
    };
    /**
     * é¡¹ç›®ï¼Œé¡¹ç›®ç»„æŒ‰å­—æ®µæŽ’åº
     * @param  {Object} resList é¡¹ç›®ç»„ï¼Œé¡¹ç›®åˆ—è¡¨
     * @param {String} tag å½“å‰æŽ’åºå­—æ®µåç§°
     * @param {String}sortType æŽ’åºæ–¹å¼ æ¯”å¦‚'name-up'
     * @param {Array} toplist ç½®é¡¶æ•°ç»„
     * @param {Array} noToplist éžç½®é¡¶æ•°ç»„
     * @param {Array} publist é»˜è®¤||å…¬å…±æ•°ç»„
     * @param {Boolean} isChangeSort æ˜¯å¦æ”¹å˜å½“å‰æŽ’åºæ–¹å¼
     * added by gegenhasi
     */
    p.__sortByField = function (tag, sortType, toplist, noToplist, publist, isChangeSort) {
        var typeX = tag === 'name' ? 'string' : 'number';
        var flag, exchange, typeNum;
        var pids = [];
        if (tag == sortType.split('-')[0]) {
            if (isChangeSort) {
                flag = sortType.split('-')[1] == 'up' ? false : true;
                exchange = sortType.split('-')[1] == 'up' ? 'down' : 'up';
            } else {
                flag = sortType.split('-')[1] == 'up' ? true : false;
                exchange = sortType.split('-')[1] == 'up' ? 'up' : 'down';
            }
        } else {
            flag = true;
            exchange = 'up';
        }
        switch (tag) {
            case 'name':
                if (flag == true) {
                    typeNum = _dbConst.CMN_ORD_NAME_ASC;
                } else {
                    typeNum = _dbConst.CMN_ORD_NAME_DESC;
                }
                break;
            case 'time':
                if (flag == true) {
                    typeNum = _dbConst.CMN_ORD_TIME_ASC;
                } else {
                    typeNum = _dbConst.CMN_ORD_TIME_DESC;
                }
                break;
            case 'count':
                if (flag == true) {
                    typeNum = _dbConst.CMN_ORD_COUNT_ASC;
                } else {
                    typeNum = _dbConst.CMN_ORD_COUNT_DESC;
                }
                break;
        }

        var sortPROs = noToplist;
        this._$sortBy(sortPROs, typeX, tag, flag);
        sortPROs = toplist.concat(sortPROs);
        if (publist.constructor == Array) {
            sortPROs = sortPROs.concat(publist);
        } else {
            sortPROs = sortPROs.concat([publist]);
        }
        sortType = tag + '-' + exchange;
        u._$forEach(sortPROs, function (item) {
            pids.push(item.id);
        });
        var _returnData = {
            pids: pids,
            typeNum: typeNum,
            sortType: sortType
        }
        return _returnData;
    };
    /**
     * è§£æžjavabeanæ–‡ä»¶å¹¶èŽ·å¾—æ•°æ®æ¨¡åž‹ç›¸å…³å±žæ€§
     * @param {Files} æ‰€æœ‰æ–‡ä»¶æ•°æ®
     * @param {Function} æ–‡ä»¶è§£æžå®Œæˆä¹‹åŽæ‰§è¡Œçš„å‡½æ•°
     *
     */
    p._$importJavaBean = function (files, callback) {
        var typeNameMap = {
            'MDL_SYS_STRING': {
                reg: /^(String|byte|Byte|char|Character|)$/,
                type: 'String'
            },
            'MDL_SYS_NUMBER': {
                reg: /^(short|Short|int|Integer|long|Long|float|Float|double|Double)$/,
                type: 'Number'
            },
            'MDL_SYS_BOOLEAN': {
                reg: /^(boolean|Boolean)$/,
                type: 'Boolean'
            }
        };
        var importDT = [],
            fileLength = files.length,
            index = 0;
        /**
         * è¯»å–æ–‡ä»¶å†…å®¹è§£æžå‡ºæ•°æ®æ¨¡åž‹
         * @param {File} æ–‡ä»¶
         */
        var parseJavaBean = function (file) {
            var reader = new FileReader();
            reader.readAsText(file);
            reader.onload = function () {
                var data = jsonbean.parse(reader.result);
                var params = [];
                if (data.attributes) { //æ•°æ®ç±»åž‹çš„å±žæ€§æ•°ç»„
                    data.attributes.forEach(function (item) {
                        var obj = getTypeName(item.type);
                        params.push({
                            typeName: obj.typeName,
                            name: item.name,
                            type: obj.type,
                            isArray: item.isArray ? db.CMN_BOL_YES : db.CMN_BOL_NO,
                            description: item.description
                        });
                    });
                }
                if (params.length > 0) {
                    importDT.push({ //一个数据类型
                        name: file.name.replace('.java', ''),
                        params: params
                    });
                }
                index++;
                if (index === fileLength && importDT.length > 0) {
                    //弹框
                    callback(importDT);
                }
            }.bind(this);
        };
        /**
         * javabean类型名称转换
         * @param {String} 原类型名称
         * @return {Object} 转换后的类型名称
         * @property {String} typeName 需要传递给后台的类型名称
         * @property {String} type 前端列表展示的类型名称
         */
        var getTypeName = function (typeName) {
            var realTypeName = Object.keys(typeNameMap).find(function (item) {
                return typeNameMap[item].reg.test(typeName);
            }.bind(this));
            if (realTypeName) {
                return {typeName: realTypeName, type: typeNameMap[realTypeName].type};
            } else {
                return {typeName: typeName, type: typeName};
            }
        };
        //遍历并解析全部文件
        for (var i = 0, file; file = files[i]; i++) {
            if (file.name.match(/.+\.java$/)) { //java文件
                parseJavaBean(file);
            } else { //不是Java文件
                index++;
            }
        }
    };

    /**
     * 是否是字符、数字、下划线组成
     * @param str
     * @returns {boolean}
     * @private
     */
    p._$isNumberStr = function (str) {
        return /^[\d|a-zA-Z|_]+$/.test(str);
    };

    /**
     * localstorage 字符串转布尔值
     */
    p._$toBool = function (str) {
        return str !== 'false';
    };

    /**
     * 对象与数组深拷贝
     * @param {Object || Array} obj 要拷贝的对象
     */
    p._$cloneObj = function (obj) {
        var str, newobj = obj.constructor === Array ? [] : {};
        if (typeof obj !== 'object') {
            return;
        } else if (window.JSON) {
            str = JSON.stringify(obj), //系列化对象
                newobj = JSON.parse(str); //还原
        } else {
            for (var i in obj) {
                newobj[i] = typeof obj[i] === 'object' ?
                    cloneObj(obj[i]) : obj[i];
            }
        }
        return newobj;
    };

    p._$getDataByPromise = function (cacheClazz, onloadFunc, onload, oncancel, fetchFunc, prepareData, thisObj) {
        var onreject;
        var onresolve;
        var cache;
        if (!oncancel) {
            oncancel = function (cache) {
                cache._$recycle();
            };
        }
        if (!onload) {
            onload = function (cache, event, promise, resolve) {
                var listData = cache._$getListInCache(event.key);
                cache._$recycle();
                onresolve(listData);
            }.bind(thisObj);
        }
        var promise = new Promise(function (resolve, reject) {
            onreject = reject;
            onresolve = resolve;
            var cacheOption = {};
            cacheOption[onloadFunc] = function (event) {
                delete promise.__cancel;
                var index = this._promises.indexOf(promise);
                this._promises.splice(index, 1);
                onload(cache, event, promise, resolve);
            }.bind(this);
            cache = cacheClazz._$allocate(cacheOption);
            if (typeof prepareData === 'function') {
                prepareData = prepareData(cache);
            }
            setTimeout(function () {
                cache[fetchFunc](prepareData);
            }, 0);
        }.bind(thisObj));
        thisObj._promises.push(promise);
        promise.__cancel = function () {
            var index = this._promises.indexOf(promise);
            this._promises.splice(index, 1);
            onreject('cancel');
            oncancel(cache);
        }.bind(thisObj);
        return promise;
    };

    /**
     * 执行规则函数
     * @param {String} options
     * @property {String} options.code - 待执行的函数
     * @property {Object} options.params - 传给函数的参数
     * @property {Array} options.constraints - 传给函数的参数
     * @property {String} options.rootPath - 传给函数的参数
     * @property {Function} options.onmessage
     * @property {Function} options.onerror
     */
    p._$runScript = function (options) {
        var code = options.code;
        if (!code || !code.replace(/\s/g, '')) {
            if (options.onerror && typeof options.onerror === 'function') options.onerror(new Error());
            return;
        }
        var s = [];
        s.push('importScripts(\'' + window.location.origin + '/src/lib/fb-modules/lib/mockjs/dist/mock.js\');');
        s.push('importScripts(\'' + window.location.origin + '/src/lib/fb-modules/util/mock_data.js\');');
        options.constraints.forEach(function (item) {
            if (item.type != 1) {
                var body = item.function.replace(/NEI\.(id|str|chinese|email|url|num|bool|var|repeat|loop)\((.*?)\)/g, function ($0, $1, $2) {
                    return $1 + '(null,null' + ($2 ? ',' + $2 : '') + ')';
                });
                s.push('var ' + item.name + ' = function(){' + body + '};');
            }
        });
        code = 'var result=' + code.replace(/\((.*)\)/, function ($0, $1) {
                return '(JSON.parse(event.data)' + ($1 ? ',' + $1 : '') + ')';
            });
        !~code.indexOf('(JSON.parse(event.data)') && (code += ';(JSON.parse(event.data))');
        s.push('var onmessage=function(event){{' + code + '};postMessage(JSON.stringify(result, null, "\t"));}');
        debugger
        var blob = new Blob(s);
        var worker = new Worker(URL.createObjectURL(blob));
        options.onmessage && (worker.onmessage = options.onmessage);
        options.onerror && (worker.onerror = options.onerror);
        worker.postMessage(JSON.stringify(options.params));
    };

    return p;
},'3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','356c13c039fe43b0aa515c031d53f736','1b12378d868a5877d4dba65367942b75','27d8cb4fa0c9c5a46d8b26265d908569','993671841dcf289096c7171d53130309','55d56144588bf070fcaa6f8a541d9f62','05f7800e1ab59353c18056fc4fba8b83','568ec88eab54cacd9c085e76e54cde59','993671841dcf289096c7171d53130309','a17dfb1aca7e5bcf1c99411da2601159');
I$('4f0d587ab8719a69290e13b2e6698bf2',"@-webkit-keyframes down{\n\t0%{\n\t\ttop:-50px;\n\t}\n\t100%{\n\t\ttop:0px;\n\t}\n}\n.bounceOutDown{\n\t-webkit-animation-name:down;\n\t-webkit-animation-duration:0.4s;\n}\n.m-notify{\n\tposition:fixed;\n\tz-index:99999;\n\tleft:50%;\n\ttransform:translateX(-50%);\n\t-webkit-box-sizing:border-box;\n\t-moz-box-sizing:border-box;\n\tbox-sizing:border-box;\n\twhite-space:nowrap;\n\ttop:0;\n}\n.m-notify .u-message:before,.m-notify .u-message:after{\n\tdisplay:table;\n\tcontent:\"\";\n\tline-height:0;\n}\n.m-notify .u-message:after{\n\tclear:both;\n}\n.m-notify .u-message{\n\tposition:relative;\n\tpadding:10px 20px;\n\tbackground:#f5f5f5;\n\tcolor:#333;\n\tfont-size:14px;\n\t*zoom:1;\n}\n.m-notify .u-message span{\n\tpadding-right:5px;\n}\n.m-notify .u-message .message_icon{\n\tfont-size:20px;\n\tvertical-align:middle;\n\tmargin-top:-2px;\n\tline-height:1;\n}\n.m-notify .u-message-info{\n\tbackground:#fdf7e5;\n\tcolor:#e0c05e;\n}\n.m-notify .u-message-success{\n\tbackground:#e5f6e7;\n\tcolor:#56c969;\n}\n.m-notify .u-message-warning{\n\tbackground:#fbe4e4;\n\tcolor:#8a6d3b;\n}\n.m-notify .u-message-error{\n\tbackground:#fbe4e4;\n\tcolor:#f04c62;\n}\n.m-notify .u-message-tip{\n\tcursor:pointer;\n\tbackground:#fdf7e5;\n\tcolor:#e0c05e;\n\tborder:1px solid #fdf7e5;\n}\n.m-notify .u-icon{\n\ttext-indent:0px;\n\tvertical-align:bottom;\n}");
I$('38431beff7750cfde3693e84776aab18',"<div class=\"m-notify m-notify-{position} {class}\" >\n    {#list messages as message}\n    <div class=\"u-message u-message-{message.state} bounceOutDown\" on-click={this._onclick(message.state)}>\n        {#if message.state == \"success\"}\n        <i class=\" u-icon u-icon-tips-done-normal\"></i>\n        {#elseif message.state == \"error\"}\n        <i class=\" u-icon u-icon-tips-error-normal\" ></i>\n        {#elseif message.state == \"tip\"}\n        <i class=\" u-icon u-icon-notice2-normal\"></i>\n        {#else}\n        <i class=\" u-icon u-icon-notice2-normal\" ></i>\n        {/if}\n        <span>{message.text}</span>\n    </div>\n    {/list}\n</div>");
I$('afb57ef5a0e0ee34baead79fa46d3e43',function (base, v, u, e, css, tpl) {
    /**
     * 调用方式 Notify.show("提交成功",'success',2000)
     * 调用方式 Notify.show("提交失败",'error',2000)
     * **/

    e._$addStyle(css);
    var Notify = base.extend({
        name: 'notify',
        template: tpl,
        config: function () {
            u._$merge(this.data, {
                messages: [],
                position: 'topcenter',
                duration: 2000,
                single: true
            });
            this.supr();
        },
        init: function () {
            this.supr();
            //证明不是内嵌组件
            if (this.$root === this) {
                this.$inject(document.body);
            }
        },
        /**
         * 显示消息提示
         * @param text 消息内容
         * @param state 消息类型，可选参数：`info`、`success`、`warning`、`error`
         * @param duration 该条消息的停留毫秒数，如果为0，则表示消息常驻不消失。
         */
        show: function (text, state, duration) {
            var message = {
                text: text,
                state: state,
                duration: duration === 0 ? 0 : (duration || this.data.duration)
            };
            var messages = this.data.messages;
            if (this.data.single && messages[0]) {
                clearTimeout(this.interval);
                messages[0] = message;
            } else {
                messages.unshift(message);
            }
            this.$update();
            if (message.duration) {
                this.interval = setTimeout(function () {
                    this.close(message);
                }._$bind(this), message.duration);
            }
            this.$emit('show', {
                sender: this,
                message: message
            })
        },
        /**
         * 关闭消息提示
         * @param index
         */
        close: function (message) {
            var index = this.data.messages.indexOf(message);
            if (index < 0) return;
            this.data.messages.splice(index, 1);
            this.$update();
            this.$emit('close', {
                sender: this,
                index: index
            })
        },
        closeAll: function () {
            this.data.messages = [];
            this.$update();
        },
        _onclick: function (state) {
            if (state != "tip") return;
            this.$emit('click', {
                sender: this
            });
        }

    });

    //原型增加其他方法
    var STATUS = ['success', 'warning', 'info', 'error', 'tip'];
    STATUS.forEach(function (status) {
        Notify.prototype[status] = function (text, duration) {
            this.show(text, status, duration);
        }
    });
    //直接初始化一个实例
    var notify = new Notify();
    Notify.notify = notify;
    var METHODS = ['show', 'close', 'closeAll', 'success', 'warning', 'info', 'error', 'tip'];
    Notify.methods = METHODS;

    METHODS.forEach(function (method) {
        Notify[method] = notify[method]._$bind(notify);
    });
    Notify.destroy = function () {
        Notify.notify.data.messages = [];
        Notify.notify.$update();
    }

    return Notify;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','4f0d587ab8719a69290e13b2e6698bf2','38431beff7750cfde3693e84776aab18');
I$('c6dbf51c390a9de703c7bf6c9b46ff41',function (k, d, j, c, u, v, cu, notify, dbConst, p, pro) {
    p._$$Cache = k._$klass();
    pro = p._$$Cache._$extend(d._$$CacheListAbstract);

    /**
     * 初始化
     */
    pro.__init = function (options) {
        this.__super(options);
        this._dbConst = dbConst;
        // 全局事件, 方便模块间通信
        if (!this.constructor.__eventAdded) {
            // 类可能会被多次实例化, 但事件不能添加多次, 不然在回收事件的时候会失败
            this.constructor.__eventAdded = true;
            c._$$CustomEvent._$allocate({
                element: this.constructor,
                event: [
                    'add', 'delete', 'update',
                    'listchange', 'itemsadded', 'itemsdeleted',
                    'error'
                ]
            });
        }
    }

    /**
     * 新增一条数据
     * @param {Object} options - 参数对象
     * @success dispatch event: onitemadd, listchange
     */
    pro.__doAddItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            data: options.data,
            ext: options.ext,
            method: 'POST',
            onload: function (item) {
                options.onload(item);
                ga('send', 'event', 'resources', 'create', this.__cacheKey, 1);
                v._$dispatchEvent(
                    this.constructor, 'listchange', {
                        data: item,
                        action: 'add',
                        key: options.key,
                        ext: options.ext
                    }
                );
                // 触发全局的 add 事件
                v._$dispatchEvent(
                    this.constructor, 'add', {
                        data: item,
                        action: 'add',
                        key: options.key,
                        ext: options.ext
                    }
                );
            }.bind(this)
        };
        var url = this.__getUrl(options);
        this.__sendRequest(url, _sendOptions);
    };

    /**
     * 删除一条数据
     * @param {Object} options - 参数对象
     * @success dispatch event: onitemdelete, listchange
     */
    pro.__doDeleteItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            method: 'DELETE',
            ext: options.ext,
            onload: function (item) {
                options.onload(item);
                // 从缓存中删除这项
                this.__doRemoveItemFromList(options.key, item[this.__key]);
                v._$dispatchEvent(
                    this.constructor, 'listchange', {
                        data: item,
                        action: 'delete',
                        ext: options.ext
                    }
                );
                // 触发全局的 delete 事件
                v._$dispatchEvent(
                    this.constructor, 'delete', {
                        data: item,
                        action: 'delete',
                        key: options.key,
                        ext: options.ext
                    }
                );
            }.bind(this)
        };
        var url = this.__getUrl({
            key: this.__cacheKey,
            id: options.id
        });
        this.__sendRequest(url, _sendOptions);
    };

    /**
     * 更新一条数据
     * @param {Object} options - 参数对象
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            method: 'PATCH',
            data: options.data,
            ext: options.ext,
            actionMsg: options.actionMsg,
            onload: function (item) {
                options.onload(item);
                v._$dispatchEvent(
                    this.constructor, 'update', {
                        data: item,
                        action: 'update',
                        options: options,
                        ext: options.ext
                    }
                );
            }.bind(this)
        };
        var url = this.__getUrl({
            key: this.__cacheKey,
            id: options.id
        });
        this.__sendRequest(url, _sendOptions);
    };

    /**
     * 加载某一项
     * @param {Object} [options] - 参数对象
     * @property {Number} options.id - 要加载资源的id
     * @property {String} options.key - 这个 key 主要用于获取相应的 url
     * @success dispatch event: onloaditem
     */
    pro.__doLoadItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            onload: options.onload
        };
        var url = this.__getUrl({
            key: this.__cacheKey,
            id: options.id
        });
        this.__sendRequest(url, _sendOptions);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        // 在缓存命中计算时(module:util/cache/cache._$$CacheAbstract#__hasFragment), 需要考虑 offset 和 limit 的信息
        // 将 limit 设置为较大的值后, 在一定程度上保证了可以全部加载列表数据
        options.limit = 100000;
        var url = this.__getUrl(options);
        this.__sendRequest(url, options);
    };

    /**
     * 发送请求参数构造
     * @param {Object} options - 参数对象
     */
    pro.__doAction = function (options) {
        options.key = options.key || this.__cacheKey;
        var sendOptions = {
            data: options.data,
            ext: options.ext,
            action: options.action,
            method: options.method,
            headers: options.headers,
            actionMsg: options.actionMsg,
            onload: function (data) {
                var event = {
                    key: options.key,
                    data: data,
                    action: options.action,
                    ext: options.ext
                };
                var list;
                // 更新单条数据或者更新列表
                if (options.updateItem) {
                    list = this._$getListInCache(options.key);
                    // 更新单条数据
                    var oldItem = list.find(function (item) {
                        return item.id === data.id;
                    });
                    u._$merge(oldItem, data);
                } else if (options.updateList) {
                    // 更新列表, 比如导入列表或者清空
                    list = data;
                    this._$setListInCache(options.key, data);
                } else if (options.updateListOrder) {
                    // 更新列表, 比如后端排序等操作, 此时data是id数组列表
                    list = this._$getListInCache(options.key);
                    data.forEach(function (item) {
                        var index = null;
                        list.find(function (itm, idx) {
                            if (itm.id == item.id) {
                                index = idx;
                                return true;
                            }
                        });
                        list.push(list.splice(index, 1)[0]);
                    });
                }
                if (u._$isString(options.onload)) {
                    this._$dispatchEvent(options.onload, event);
                } else if (u._$isFunction(options.onload)) {
                    options.onload(event);
                }
                // 触发 listchange 事件
                if (options.triggerListchange) {
                    v._$dispatchEvent(
                        this.constructor, 'listchange', {
                            data: list,
                            action: event.action,
                            ext: options.ext
                        }
                    );
                }
            }.bind(this)
        };
        var url = this.__getUrl({
            key: this.__cacheKey,
            action: options.action,
            id: options.id
        });
        this.__sendRequest(url, sendOptions);
    }

    /**
     * 发送请求
     * @param {String} url
     * @param {Object} [options]
     */
    pro.__sendRequest = function (url, options) {
        options.headers = u._$merge(
            {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            options.headers
        );
        options = u._$merge(
            {
                type: 'json',
                timeout: 30000,
                method: 'GET'
            },
            options
        );
        if (options.headers['Content-Type'] === 'multipart/form-data') {
            var fd = new FormData();
            Object.keys(options.data).forEach(function (key) {
                fd.append(key, options.data[key]);
            });
            options.data = fd;
        } else if (/^(post|put|patch)$/i.test(options.method)) {
            options.data = JSON.stringify(options.data);
        } else if (options.data && /^(get|head|delete)$/i.test(options.method)) {
            Object.keys(options.data).forEach(function (key) {
                if (url.indexOf('?') === -1) {
                    url += '?';
                } else {
                    url += '&';
                }
                url += key + '=' + options.data[key];
            });
            delete options.data;
        }
        var onload = options.onload;
        var onerror = function (data) {
            notify.show(data.msg || data.message, 'error', 2000);
            var evt = {
                options: options,
                type: 'error',
                data: data
            };
            this._$dispatchEvent('onerror', evt);
            v._$dispatchEvent(
                this.constructor, 'error', evt
            );
        }.bind(this);
        options.onload = function (data) {
            var result = null;
            if (!data) {
                return onerror(data);
            }
            var code = data.code.toString();
            if (code === '401') {
                window.location.href = '/login';
            } else if (code === '404') {
                window.location.href = '/404';
            } else if (code.charAt(0) === '2') {
                // 分页列表
                if (data.hasOwnProperty('total')) {
                    result = {
                        result: data.result,
                        total: data.total
                    }
                } else {
                    result = data.result;
                }
                // 是否有格式化数据的方法
                if (this.__doFormatItems) {
                    this.__doFormatItems(result, options);
                }
                // 统一提示信息
                if (options.actionMsg || options.actionMsg == null) {
                    switch (options.method) {
                        case 'POST':
                            var tip = options.actionMsg || '创建成功';
                            if (code === '210') {
                                // 210 code 表示创建成功，但有其他问题，比如相同请求方式和路径的接口已存在
                                tip += '，' + data.msg;
                            }
                            notify.show(tip, 'success', 2000);
                            break;
                        case 'DELETE':
                            notify.show(options.actionMsg || '删除成功', 'success', 2000);
                            break;
                        case 'PUT':
                        case 'PATCH':
                            notify.show(options.actionMsg || '更新成功', 'success', 2000);
                            break;
                        default:
                            break;
                    }
                }
                onload(result);
            } else {
                onerror(data);
            }
        }.bind(this);
        j._$request(url, options);
    };

    /**
     * 批量添加
     * @param {Object} options - 参数对象
     * @property {Number} options.items- 要添加的对象列表
     * @success dispatch event: onitemsadd
     */
    pro._$addItems = function (options) {
        this.__doAction({
            headers: options.headers || {},
            data: options.data,
            ext: options.ext,
            key: options.key,
            method: 'POST',
            triggerListchange: true,
            onload: function (event) {
                var addedList = event.data;
                if (!Array.isArray(addedList)) {
                    addedList = [addedList];
                }
                var list = this._$getListInCache(options.key);
                addedList.forEach(function (item) {
                    item = this.__doSaveItemToCache(item, options.key);
                    item && list.push(item);
                }, this);
                // 有些缓存还需要处理额外的逻辑, 比如参数缓存, 添加项后还需要更新相应缓存(比如数组模型缓存)中的数据
                if (options.onload) {
                    options.onload(event);
                }
                this._$dispatchEvent('onitemsadd', event);
                // 批量添加后需要触发的事件
                v._$dispatchEvent(
                    this.constructor, 'itemsadded', {
                        data: addedList,
                        action: options.action,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        this.__doAction({
            data: options.data,
            ext: options.ext,
            key: options.key,
            method: 'DELETE',
            triggerListchange: true,
            onload: function (event) {
                var deletedList = event.data;
                // 从缓存中删除列表
                this.__doRemoveItemFromList(options.key, deletedList);
                // 有些缓存还需要处理额外的逻辑, 比如参数缓存, 删除项后还需要更新相应缓存(比如数组模型缓存)中的数据
                if (options.onload) {
                    options.onload(event);
                }
                this._$dispatchEvent('onitemsdelete', event);
                // 批量删除后需要触发的事件
                v._$dispatchEvent(
                    this.constructor, 'itemsdeleted', {
                        data: deletedList,
                        action: options.action,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    };

    /**
     * 根据 key 值获取相应列表中的 tag 列表
     * @param {String} listKey - 列表的key
     * @return {Array} - tag 列表
     */
    pro._$getTagList = function (listKey) {
        return cu.getTagList(this._$getListInCache(listKey));
    };

    /**
     * 根据 key 值获取相应列表中的状态(status)列表
     * @param {String} listKey - 列表的key
     * @param {Boolean} addDefault - 是否要加上内置的3个状态: 未开始、进行中、已完成
     * @return {Array} - status 列表
     */
    pro._$getStatusList = function (listKey, addDefault) {
        var list = this._$getListInCache(listKey);
        var statusList = {};
        list.map(function (item) {
            if (!item.status) return;
            statusList[item.status] = item.statusPinyin;
        });
        if (addDefault) {
            statusList['未开始'] = "wei'kai'shi";
            statusList['进行中'] = "jin'xing'zhong";
            statusList['已完成'] = "yi'wan'cheng";
        }
        var status = Object.keys(statusList).map(function (st) {
            return {
                id: st,
                name: st,
                value: st, /*stripedlist 头部标签会用到这个属性*/
                namePinyin: statusList[st]
            }
        });
        status.sort(function (a, b) {
            return a.name.localeCompare(b.name);
        });
        return status;
    };

    /**
     * 根据 key 值获取相应列表中的"业务分组"列表
     * @param {String} listKey - 列表的key
     * @return {Array} - 业务分组列表
     */
    pro._$getGroupList = function (listKey) {
        var list = this._$getListInCache(listKey);
        var xlist = {};
        var groups = [];
        list.map(function (item) {
            if (!xlist[item.group.id]) {
                xlist[item.group.id] = 1;
                groups.push({
                    name: item.group.name,
                    namePinyin: item.group.namePinyin,
                    value: item.group.id,
                    title: item.group.description ? item.group.name + '(' + item.group.description + ')' : item.name
                });
            }
        });
        groups.sort(function (groupA, groupB) {
            return groupA.name.localeCompare(groupB.name);
        });
        return groups;
    };

    /**
     * 根据 key 值获取相应列表中的"负责人"列表
     * @param {String} listKey - 列表的key
     * @return {Array} - 负责人列表
     */
    pro._$getRespoList = function (listKey) {
        return this.__getUserList('respo', listKey);
    };

    /**
     * 根据 key 值获取相应列表中的"创建者"列表
     * @param {String} listKey - 列表的key
     * @return {Array} - 创建者列表
     */
    pro._$getCreatorList = function (listKey) {
        return this.__getUserList('creator', listKey);
    };

    /**
     * 根据类型, 获取用户列表
     * @param {String} userType - 用户类型
     * @param {String} listKey - 列表的key
     * @return {Array} - 用户列表
     */
    pro.__getUserList = function (userType, listKey) {
        var list = this._$getListInCache(listKey);
        var xlist = {};
        var users = [];
        list.map(function (item) {
            // 需要排除已经被删除的项
            if (!item.__dirty__ && !xlist[item[userType].id]) {
                xlist[item[userType].id] = 1;
                users.push({
                    name: item[userType].realname || item[userType].username,
                    namePinyin: item[userType].realnamePinyin,
                    value: item[userType].id,
                    title: item[userType].realname ? (item[userType].realname + '(' + item[userType].username + ')') : item[userType].username
                });
            }
        });
        users.sort(function (itemA, itemB) {
            return itemA.name.localeCompare(itemB.name);
        });
        return users;
    };

    /**
     * 根据key值, 从缓存中获取数据
     * @property {String} cacheKey - 缓存 key
     * @return {Object} - 缓存数据
     */
    pro._$getDataInCache = function (cacheKey) {
        return this.__getDataInCache(cacheKey);
    };

    /**
     * 获取列表 key, 这里主要是统一规则
     * @param {Number} id - 资源(项目、项目组或者规范)的id
     * @param {String} [type] - 资源类型(项目、项目组、规范), 可选
     * @return {String} - 列表 key
     */
    pro._$getListKey = function (id, type) {
        return this.__cacheKey + '-' + id + (type ? ('-' + type) : '');
    };

    /**
     * 从服务器获取某个资源的引用列表
     * @param {String} refKey - 引用的key
     * @param {Object} caches - 缓存集对象
     * @param {Object} options - 参数对象
     * @success dispatch event: onreflistload
     */
    pro.__getRefList = function (refKey, caches, options) {
        options.onload = function (evt) {
            var result = evt.data;
            if (result.datatypes && caches.dc) {
                caches.dc._$setListInCache(refKey, result.datatypes);
                caches.dc._$recycle();
            }
            if (result.interfaces && caches.ic) {
                caches.ic._$setListInCache(refKey, result.interfaces);
                caches.ic._$recycle();
            }
            if (result.pages && caches.pc) {
                caches.pc._$setListInCache(refKey, result.pages);
                caches.pc._$recycle();
            }
            if (result.templates && caches.tc) {
                caches.tc._$setListInCache(refKey, result.templates);
                caches.tc._$recycle();
            }
            if (result.constraints && caches.cc) {
                caches.cc._$setListInCache(refKey, result.constraints);
                caches.cc._$recycle();
            }
            if (result.projects && caches.proc) {
                caches.proc._$setListInCache(refKey, result.projects);
                caches.proc._$recycle();
            }
            if (result.progroups && caches.progc) {
                caches.progc._$setListInCache(refKey, result.progroups);
                caches.progc._$recycle();
            }
            this._$dispatchEvent('onreflistload', evt);
        }.bind(this);
        this.__doAction(options);
    };
    /**
     * 获取上传文件到 NOS 时所需要的 token
     * @param {Object} [options] - 参数对象
     * @property {Number} n - 要获取的token数量, 后端默认返回一个
     * @success dispatch event: ontokensload
     */
    pro._$getTokens = function (options) {
        var key = options.key;
        var callback = this._$dispatchEvent._$bind(
            this, 'ontokensload', {key: key, ext: options.ext}
        );
        var url = '/api/specdocs/?token';
        this.__sendRequest(url, {
            data: {
                n: options.n || 1
            },
            onload: function (_data) {
                // 缓存数据
                this.__setDataInCache(key, _data);
                callback();
            }._$bind(this)
        });
    };
    /**
     * 根据id列表获取资源列表
     * @param {Array} ids - id列表
     * @return {Array} 资源列表
     */
    pro._$getResListByIds = function (ids) {
        if (!ids instanceof Array) {
            ids = [ids];
        }
        var xlist = [];
        ids.forEach(function (id) {
            var item = this._$getItemInCache(id);
            item && xlist.push(item);
        }.bind(this));
        return xlist;
    };
    /**
     * 判断列表中是否有共享数据
     * @param {Array} list - 资源列表
     * @return {Object} 共享资源（没有的话返回undefined）
     */
    pro.__hasSharedRes = function (list) {
        return list.find(function (item) {
            return item.__isShare;
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','472cf137872fdb27e5ea0f6b37405d90','19b4ef9670142281a6ff17ec75864bee','8717e18cf0d38e654531116f64f5593d','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8cbc286a7834dfcf29c8f7a018e77c02','afb57ef5a0e0ee34baead79fa46d3e43','993671841dcf289096c7171d53130309');
I$('701adc0082f520daef1f96ababcde918',function (_k, _u, _v, _c, _d, _p, _pro) {
    _p._$$CacheNotification = _k._$klass();
    _pro = _p._$$CacheNotification._$extend(_d._$$Cache);
    _p._$cacheKeySystem = 'notification-system';
    _p._$cacheKeyPersonal = 'notification-personal';
    // 未读消息
    _p._$cacheKeyUnread = 'notification-unread';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__cacheKey = _p._$cacheKey;
        // 全局事件, 方便模块间通信
        if (!this.constructor.__eventAdded2) {
            this.constructor.__eventAdded2 = true;
            _c._$$CustomEvent._$allocate({
                element: this.constructor,
                event: [
                    'onunreadload', 'onunreadupdate'
                ]
            });
        }
        this.__super(options);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    _pro.__doLoadList = function (options) {
        options.data = _u._$merge({
            limit: options.limit,
            total: options.total,
            offset: options.offset
        }, options.data, options.ext);
        var url = this.__getUrl(options);
        this.__sendRequest(url, options);
    };

    /**
     * 请求未读消息数量
     * @success dispatch event: onunreadload
     */
    _pro._$getUnread = function (_options) {
        var key = _p._$cacheKeyUnread;
        var dispatchEvent = function () {
            this._$dispatchEvent('onunreadload', {
                key: key,
                ext: _options.ext
            });
            // 全局事件
            _v._$dispatchEvent(
                this.constructor, 'onunreadload', {
                    key: key,
                    ext: _options.ext,
                    isPolling: _options.isPolling
                }
            );
        }.bind(this);
        var data = this.__getDataInCache(key);
        if (!_options.isPolling) {
            if (data) {
                return dispatchEvent();
            } else {
                return;
            }
        }
        var url = this.__getUrl({
            key: key
        });
        this.__sendRequest(url, {
            onload: function (_data) {
                // 缓存数据
                this.__setDataInCache(key, _data);
                if (data) {
                    //判断数据是否更新
                    if (data.system < _data.system) {
                        _options.ext.systemUpdated = true;
                    }
                    if (data.personal < _data.personal) {
                        _options.ext.personalUpdated = true;
                    }
                }
                // 触发队列中同请求的回调逻辑
                return dispatchEvent();
            }._$bind(this)
        });
    };

    /**
     * 批量设置已读状态
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要更新的 id 列表
     * @property {String} options.type- 要更新的消息类型（personal，system）
     * @property {String} options.key- 要更新cache list key
     * @success dispatch event: onunreadupdate, listchange
     */
    _pro._$setRead = function (options) {
        var key = _p._$cacheKeyUnread;
        this.__doAction({
            action: 'read',
            data: {
                ids: options.ids
            },
            method: 'PUT',
            triggerListchange: true,
            onload: function (event) {
                var list = this._$getListInCache(options.key);
                var updatedList = event.data;
                var updateNum = 0;
                // 设置已读字段
                updatedList.forEach(function (item) {
                    item = list.find(function (itm) {
                        return itm.id === item.id;
                    });
                    if (!item.isRead) {
                        item.isRead = true;
                        updateNum++;
                    }
                }, this);
                //更新unread数据，减去已读的数量
                var data = this.__getDataInCache(key);
                data[options.type] = Math.max(data[options.type] - updateNum, 0);
                // 批量更新后需要触发的事件
                _v._$dispatchEvent(
                    this.constructor, 'onunreadupdate', {
                        data: updatedList,
                        action: options.type
                    }
                );
            }.bind(this)
        });
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url = '/api/notifications/';

        switch (options.key) {

            case _p._$cacheKey:
                if (options.action) {
                    url += '?' + options.action;
                }
                break;

            case _p._$cacheKeyUnread:
                url += '?unread';
                break;

            default:
                break;
        }
        return url;
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('d81f928b2e8dc2e94031eba0a018b644',function (NEJ,_k,_e,_u,_t,_t0,_p,_o,_f,_r){
    var _pro;
    /**
     * UI控件基类，框架及项目中所有涉及UI的控件均继承此类
     *
     * 脚本举例
     * ```javascript
     * // 分配控件实例
     * NEJ.define([
     *     'ui/base'
     * ],function(_i,_p,_o,_f,_r){
     *     var ctrl = _i._$allocate({
     *         clazz:'xxx',
     *         parent:document.body
     *     });
     *     ctrl._$appendTo(document.body);
     *     // 如果在分配时传入了parent则这步可省略
     *     ctrl._$appendTo(function(_body){
     *         // 如果需要自定义body插入的位置可以输入函数，返回父容器节点
     *         _parent.insertAdjacentElement('afterBegin',_body);
     *         return _parent;
     *     });
     * });
     * ```
     *
     * @class     module:ui/base._$$Abstract
     * @extends   module:util/event._$$EventTarget
     * @param     {Object}               arg0    - 可选配置参数
     * @property  {String}               clazz   - 控件样式
     * @property  {String|Node|Function} parent  - 控件所在容器节点或者追加控件节点执行函数
     * @property  {Object}               dataset - 控件携带的数据集信息
     */
    _p._$$Abstract = _k._$klass();
    _pro = _p._$$Abstract._$extend(_t._$$EventTarget);
    /**
     * 初始化
     *
     * @protected
     * @method module:ui/base._$$Abstract#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        _e._$dumpCSSText();
        this.__initXGui();
        this.__initNode();
    };
    /**
     * 控件重置
     *
     * @protected
     * @method module:ui/base._$$Abstract#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__doInitClass(_options.clazz);
        this.__doInitDataset(_options.dataset);
        this._$appendTo(_options.parent);
    };
    /**
     * 控件销毁
     *
     * @protected
     * @method module:ui/base._$$Abstract#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        // clear parent
        this.__doDelParentClass();
        this.__doDelParentDataset();
        delete this.__parent;
        // clear body
        _e._$removeByEC(this.__body);
        _e._$delClassName(
            this.__body,
            this.__class
        );
        delete this.__class;
    };
    /**
     * 初始化外观信息，子类实现具体逻辑
     *
     * @abstract
     * @method module:ui/base._$$Abstract#__initXGui
     * @return {Void}
     */
    _pro.__initXGui = _f;
    /**
     * 初始化节点，子类重写具体逻辑
     *
     * @protected
     * @method module:ui/base._$$Abstract#__initNode
     * @return {Void}
     */
    _pro.__initNode = function(){
        if (!this.__seed_html){
            this.__initNodeTemplate();
        }
        this.__body = _t0._$getNodeTemplate(this.__seed_html);
        if (!this.__body){
            this.__body = _e._$create('div',this.__seed_css);
        }
        _e._$addClassName(this.__body,this.__seed_css);
    };
    /**
     * 动态构建控件节点模板，子类实现具体逻辑
     *
     * @abstract
     * @method module:ui/base._$$Abstract#__initNodeTemplate
     * @return {Void}
     */
    _pro.__initNodeTemplate = _f;
    /**
     * 添加节点样式
     *
     * @protected
     * @method module:ui/base._$$Abstract#__doInitClass
     * @param  {String} arg0 - 样式名称
     * @return {Void}
     */
    _pro.__doInitClass = function(_clazz){
        this.__class = _clazz||'';
        _e._$addClassName(this.__body,this.__class);
    };
    /**
     * 添加携带数据
     *
     * @protected
     * @method module:ui/base._$$Abstract#__doInitDataset
     * @param _dataset
     * @private
     */
    _pro.__doInitDataset = function(_dataset){
        this.__datamap = _u._$merge({},_dataset);
        _e._$dataset(this.__body,this.__datamap);
    };
    /**
     * 删除携带数据
     *
     * @protected
     * @method module:ui/base._$$Abstract#__doDelParentDataset
     * @private
     */
    _pro.__doDelParentDataset = function(){
        _u._$forIn(
            this.__datamap,function(v,k){
                _e._$dataset(this.__body,k,'');
            },this
        );
    };
    /**
     * 父节点增加辅助样式
     *
     * @protected
     * @method module:ui/base._$$Abstract#__doAddParentClass
     * @return {Void}
     */
    _pro.__doAddParentClass = function(){
        if (!!this.__seed_css){
            var _arr = this.__seed_css.split(/\s+/);
            _e._$addClassName(
                this.__parent,
                _arr.pop()+'-parent'
            );
        }
    };
    /**
     * 父节点删除辅助样式
     *
     * @protected
     * @method module:ui/base._$$Abstract#__doDelParentClass
     * @return {Void}
     */
    _pro.__doDelParentClass = function(){
        if (!!this.__seed_css){
            var _arr = this.__seed_css.split(/\s+/);
            _e._$delClassName(
                this.__parent,
                _arr.pop()+'-parent'
            );
        }
    };
    /**
     * 取当前控件节点
     *
     * 脚本举例
     * ```javascript
     * // _mask是一个继承了此基类的实例化对象
     * // 获取当前控件的节点
     *   _mask._$getBody();
     * ```
     *
     * @method module:ui/base._$$Abstract#_$getBody
     * @return {Node} 控件节点
     */
    _pro._$getBody = function(){
        return this.__body;
    };
    /**
     * 控件节点追加至容器
     *
     * 脚本举例
     * ```javascript
     * // _mask是一个继承了此基类的实例化对象
     * _mask._$appendTo(document.body);
     * // 还可以传方法
     * _mask._$appendTo(function(_body){
     *    // 根据情况插入节点
     *    var _parent = document.body;
     *    _parent.insertAdjacentElement('afterBegin',_body);
     *    return _parent;
     * });
     * ```
     *
     * @method module:ui/base._$$Abstract#_$appendTo
     * @param  {String|Node|Function} arg0 - 控件所在容器节点
     * @return {Void}
     */
    _pro._$appendTo = function(_parent){
        if (!this.__body) return;
        this.__doDelParentClass();
        if (_u._$isFunction(_parent)){
            this.__parent = _parent(this.__body);
        }else{
            this.__parent = _e._$get(_parent);
            if (!!this.__parent){
                this.__parent.appendChild(this.__body);
            }
        }
        this.__doAddParentClass();
    };
    /**
     * 显示控件
     *
     * 脚本举例
     * ```javascript
     * // _mask是一个继承了此基类的实例化对象
     * _mask._$show();
     * ```
     *
     * @method module:ui/base._$$Abstract#_$show
     * @return {Void}
     */
    _pro._$show = function(){
        if (!this.__parent||!this.__body||
             this.__body.parentNode==this.__parent){
            return;
        }
        this.__parent.appendChild(this.__body);
    };
    /**
     * 隐藏控件
     *
     * 脚本举例
     * ```javascript
     * // _mask是一个继承了此基类的实例化对象
     * _mask._$hide();
     * ```
     *
     * @method module:ui/base._$$Abstract#_$hide
     * @return {Void}
     */
    _pro._$hide = function(){
        _e._$removeByEC(this.__body);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ui'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0','356c13c039fe43b0aa515c031d53f736');
I$('99716f069c73fb887ed97aa1edbad5d5',".#<uispace>{font-size:12px;line-height:160%;}\n.#<uispace> a{margin:0 2px;padding:2px 8px;color:#333;border:1px solid #aaa;text-decoration:none;}\n.#<uispace> .js-disabled{cursor:default;}\n.#<uispace> .js-selected{cursor:default;background-color:#bbb;}");
I$('6d8bd1d9cf7e4c160f9f1dbf19bdde0c',function (NEJ,_k,_e,_u,_i,_t0,_css,_p,_o,_f,_r){
    // variable declaration
    var _pro;
    /**
     * 分页器控件基类封装
     *
     * 页面结构举例
     * ```html
     *   <div id="pagerCnt">page</div>
     *   <div id="pagerCnt2">page</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'base/klass',
     *       'ui/pager/pager.base',
     *       'util/page/page'
     *   ],function(_k,_u,_t,_p,_o,_f,_r){
     *       // 第一步：继承此类，新建一个子类
     *       _p._$$Pager = _k._$klass();
     *       _pro = _p._$$Pager._$extend(_u._$$AbstractPager);
     *
     *      // 调用父类reset方法后，
     *   实例化一个_t._$page对象，首尾页用数字表示
     *       // 表现为,上一页 1 2 3.. 10 下一页
     *       // 或者实例化一个page.simple对象，首尾页需要辅助，数字可能不会出现
     *       // 表现为,首页 上一页 5 6 7 8 9 10 下一页 末页
     *       _pro.__reset = function(_options){
     *           this.__super(_options);
     *           this.__page = _t._$$PageFragment._$allocate(this.__popt);
     *           };
     *
     *      // reset之前生成需要的页码结构
     *      _pro.__initNode = function(){
     *
     *      };
     *
     *      // reset之前生成需要的页码结构
     *      _pro.__initNodeTemplate = function(){
     *          // _seed_html根据需求定制
     *          this.__seed_html = _seed_html;
     *      };
     *      return _p;
     *   })
     *
     *   NEJ.define([
     *       '/path/to/custom/pager.js'
     *   ],function(_u,_p,_o,_f,_r){
     *       // 第二步：生成一个pager实例
     *       // 总页数10，默认第一页
     *       var _pager = _u._$$Pager._$allocate({
     *           parent:'pagerCnt',
     *           onchange: function(_event){},
     *           total: 10,
     *           index:1
     *       });
     *   })
     * ```
     *
     * @class     module:ui/pager/base._$$AbstractPager
     * @extends   module:ui/base._$$Abstract
     * @param     {Object} arg0   - 可选配置参数
     * @property  {Number} index  - 当前页码
     * @property  {Number} total  - 总页码数
     * @property  {Number} number - 显示页数
     * @property  {Number} limit  - 总页数限制
     * @property  {Object} label  - 按钮文案，{prev:'&lt;',next:'&gt;'}
     */
    /**
     * 页码切换事件，输入{last:3,index:1,total:12}
     *
     * @event    module:ui/pager/base._$$AbstractPager#onchange
     * @param    {Object} arg0  - 页码状态对象
     * @property {Number} last  - 上一次的页码
     * @property {Number} index - 当前要切换的页面
     * @property {Number} total - 总页面数
     *
     */
    _p._$$AbstractPager = _k._$klass();
    _pro = _p._$$AbstractPager._$extend(_i._$$Abstract);
    /**
     * 控件重置
     *
     * @protected
     * @method module:ui/pager/base._$$AbstractPager#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__bopt = _u._$merge({},_options);
        this.__popt = _u._$merge({},_options);
        delete this.__bopt.onchange;
        this.__popt.onchange =
            this.__onChange._$bind(this);
        this.__super(_options);
        this.__doResetNumber(_options);
    };
    /**
     * 控件销毁
     *
     * @protected
     * @method module:ui/pager/base._$$AbstractPager#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        if (!!this.__page){
            this.__page._$recycle();
            delete this.__page;
        }
        this.__super();
        delete this.__bopt;
        delete this.__popt;
        this._$unbind();
        this.__body.innerHTML = '&nbsp;';
    };
    /**
     * 初始化外观信息
     *
     * @protected
     * @method module:ui/pager/base._$$AbstractPager#__initXGui
     * @return {Void}
     */
    _pro.__initXGui = (function(){
        var _seed_css = _e._$pushCSSText(_css);
        return function(){
            this.__seed_css  = _seed_css;
        };
    })();
    /**
     * 重置页码数
     *
     * @protected
     * @method module:ui/pager/base._$$AbstractPager#__doResetNumber
     * @return {Void}
     */
    _pro.__doResetNumber = function(_data){
        var _label = _data.label||_o;
        // previous button
        if (!_data.noprv){
            this.__popt.pbtn = _e._$create(
                'a','zbtn zprv',this.__body
            );
            this.__popt.pbtn.innerHTML = _label.prev||'上一页';
        }
        // page show
        var _arr = [];
        for(var i=1,l=_data.number;i<=l;i++){
            _arr.push(_e._$create(
                'a','zpgi zpg'+i,this.__body
            ));
        }
        this.__popt.list = _arr;
        // next button
        if (!_data.nonxt){
            this.__popt.nbtn = _e._$create(
                'a','zbtn znxt',this.__body
            );
            this.__popt.nbtn.innerHTML = _label.next||'下一页';
        }
    };
    /**
     * 页面变化触发事件
     *
     * @protected
     * @method module:ui/pager/base._$$AbstractPager#__onChange
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onChange = function(_event){
        if (this.__flag) return;
        var _index = _event.index,
            _total = _event.total;
        // sync pagers
        this.__flag = !0;
        this._$updatePage(_index,_total);
        _u._$forEach(this.__binders,
            function(_pager){
                _pager._$updatePage(_index,_total);
            });
        this.__flag = !1;
        this._$dispatchEvent('onchange',_event);
    };
    /**
     * 绑定联动分页器
     *
     * 脚本举例
     * ```javascript
     * // 绑定一个联动翻页器
     * _pager._$bind('pagerCnt2')
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$bind
     * @param  {String|Node} arg0 - 联动分页器父容器
     * @return {Void}
     */
    _pro._$bind = function(_parent){
        _parent = _e._$get(_parent);
        if (!_parent) return;
        var _opt = _u._$merge(
            {},this.__bopt
        );
        _opt.parent = _parent;
        _opt.index = this._$getIndex();
        _opt.total = this._$getTotal();
        var _pager = this.constructor._$allocate(_opt);
        _pager._$setEvent('onchange',this.__popt.onchange);
        if (!this.__binders) this.__binders = [];
        this.__binders.push(_pager);
    };
    /**
     * 解除联动分页器
     *
     * 脚本举例
     * ```javascript
     * // 解绑所以联动翻页器
     * _pager._$unbind()
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$unbind
     * @return {nej.ui._$$AbstractPager}
     */
    _pro._$unbind = (function(){
        var _doRemove = function(_pager,_index,_list){
            _pager._$recycle();
            _list.splice(_index,1);
        };
        return function(){
            _u._$reverseEach(this.__binders,_doRemove);
        };
    })();
    /**
     * 跳转至指定页码
     *
     * 脚本举例
     * ```javascript
     * // 设置页码到第二页
     * _pager._$setIndex(2)
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$setIndex
     * @param  {Number} arg0 - 页码
     * @return {nej.ui._$$AbstractPager}
     */
    _pro._$setIndex = function(_index){
        if (!this.__page) return;
        this.__page._$setIndex(_index);
    };
    /**
     * 取当前页码
     *
     * 脚本举例
     * ```javascript
     * // 取当前页码
     * _pager._$getIndex()
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$getIndex
     * @return {Number} 当前页码
     */
    _pro._$getIndex = function(){
        if (!this.__page) return 1;
        return this.__page._$getIndex();
    };
    /**
     * 取总页数
     *
     * 脚本举例
     * ```javascript
     * // 取总页数
     * _pager._$getTotal()
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$getTotal
     * @return {Number} 总页数
     */
    _pro._$getTotal = function(){
        if (!this.__page) return 1;
        return this.__page._$getTotal();
    };
    /**
     * 更新页码信息
     *
     * 脚本举例
     * ```javascript
     * // 重新设置默认页和总页数
     * _pager._$updatePage(2,10);
     * ```
     *
     * @method module:ui/pager/base._$$AbstractPager#_$updatePage
     * @param  {Number} arg0 - 当前页码
     * @param  {Number} arg1 - 总页码数
     * @return {nej.ui._$$AbstractPager}
     */
    _pro._$updatePage = function(_index,_total){
        if (!this.__page) return;
        this.__page._$updatePage(_index,_total);
    };
    /**
     * 更新总页数
     *
     * @method module:ui/pager/base._$$AbstractPager#_$updateTotal
     * @param  {Number} arg0 - 总页数
     * @return {Void}
     */
    _pro._$updateTotal = function(_total){
        if (!this.__page) return;
        this.__page._$updateTotal(_total);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ui'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','d81f928b2e8dc2e94031eba0a018b644','1b12378d868a5877d4dba65367942b75','99716f069c73fb887ed97aa1edbad5d5');
I$('fb63ed7115e08dfb247af14e069a3e31',function (NEJ,_k,_u,_e,_v,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 分页逻辑封装基类
     * 
     * 结构举例
     * ```html
     * <div id="page">
     *   <a href="#" class="zbtn sbtn">首页</a>
     *   <a href="#" class="zbtn zprv">上一页</a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zbtn znxt">下一页</a>
     *   <a href="#" class="zbtn ebtn">末页</a>
     * </div>
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'base/util',
     *     'util/page/base'
     * ],function(_k,_u,_t,_p,_o,_f,_r){
     *     var _pro;
     *     
     *     // 首先继承此基类，重写__doRefreshPage方法
     *     _p._$$PageSimple = _k._$klass();
     *     _pro = _p._$$PageSimple._$extend(_t._$$PageAbstract);
     *     
     *     // 刷新页码列表算法
     *     _pro.__doRefreshPage = function(){
     *         var _length = this.__list.length;
     *         if (!_length) return;
     *         var _middle = Math.floor(_length/2),
     *             _offset = Math.min(this.__total-_length+1,
     *                       Math.max(1,this.__index-_middle));
     *         _u._$forEach(
     *             this.__list,function(_node,_index){
     *                 var _page = _offset+_index;
     *                 this.__doSetNodeIndex(
     *                     _node,
     *                     _page>this.__total?null:_page
     *                 );
     *             },this
     *         );
     *     };
     *     
     *     return _p;
     * })
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/element',
     *     '/path/to/custom/page.js'
     * ],function(_e,_t,_p,_o,_f,_r){
     * 
     *     // 第二步，生成simplePage的实例
     *     var _list = _e._$getChildren('page');
     *     var _page = _t._$$PageSimple._$allocate({
     *         list:_e._$getByClassName('page','zpgi'),
     *         event:'click',
     *         pbtn:_list[1],
     *         nbtn:_list[11],
     *         sbtn:_list[0],
     *         ebtn:_list[12],
     *         index:90,
     *         total:100,
     *         onchange:function(_obj){
     *         // 返回页码信息，last:上一次页面,
     *            index:当前页面，total:总页数
     *         }
     *     });
     *     
     *     // 第三步，可以调用提供的共有接口
     *     _page._$setTotal(100);
     * })
     * ```
     * 
     * @class    module:util/page/base._$$PageAbstract
     * @extends  module:util/event._$$EventTarget
     * 
     * @param    {Object}      config   - 可选配置参数
     * @property {Array}       list     - 页码节点列表【长度保持奇数】
     * @property {String}      event    - 触发页码切换事件，默认为click
     * @property {String|Node} pbtn     - 上一页按钮
     * @property {String|Node} nbtn     - 下一页按钮
     * @property {String|Node} sbtn     - 首页按钮
     * @property {String|Node} ebtn     - 尾页按钮
     * @property {Number}      index    - 当前页码
     * @property {Number}      total    - 总页码数
     * @property {Number}      limit    - 总页数限制
     * @property {Boolean}     parented - 选中样式是否在父节点
     * @property {String}      selected - 选中样式，默认为js-selected
     * @property {String}      disabled - 禁用样式，默认为js-disabled
     */
    /**
     * 页码变化触发事件，输入{last:3,index:1,total:12}
     * 
     * @event    module:util/page/base._$$PageAbstract#onchange
     * @param    {Object} event - 页码信息
     * @property {Number} last  - 上一次的页码
     * @property {Number} index - 当前要切换的页面
     * @property {Number} total - 总页面数
     */
    _p._$$PageAbstract = _k._$klass();
    _pro = _p._$$PageAbstract._$extend(_t._$$EventTarget);
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__pbtn  = _options.pbtn;
        this.__nbtn  = _options.nbtn;
        this.__sbtn  = _options.sbtn;
        this.__ebtn  = _options.ebtn;
        this.__name  = _options.event||'click';
        this.__parented = !!_options.parented;
        this.__selected = _options.selected||'js-selected';
        this.__disabled = _options.disabled||'js-disabled';
        this.__doPageListCheck(_options.list);
        this.__limit = _options.limit||Infinity;
        this._$updatePage(
            _options.index||1,
            _options.total||1
        );
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        delete this.__list;
        delete this.__name;
        delete this.__pbtn;
        delete this.__nbtn;
        delete this.__sbtn;
        delete this.__ebtn;
        delete this.__last;
        delete this.__total;
        delete this.__index;
        delete this.__extdata;
        delete this.__selected;
        delete this.__disabled;
    };
    /**
     * 取选中样式所在节点
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__getSelectNode
     * @param  {Node} arg0 - 页码节点
     * @return {Node}        选中样式作用节点
     */
    _pro.__getSelectNode = function(_node){
        return !this.__parented?_node:_node.parentNode;
    };
    /**
     * 检查页码列表节点
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doPageListCheck
     * @param  {Array} arg0 - 列表节点
     * @return {Void}
     */
    _pro.__doPageListCheck = (function(){
        var _doInitDomEvent = function(_node){
            this.__list.push(_node);
            this.__doInitDomEvent([[
                 _node,this.__name,this.
                 __onClick._$bind2(this,0)
            ]]);
        };
        return function(_list){
            this.__list = [];
            this.__doInitDomEvent([[
                this.__pbtn,'click',
                this.__onClick._$bind2(this,-1)
            ],[
                this.__nbtn,'click',
                this.__onClick._$bind2(this, 1)
            ],[
                this.__sbtn,'click',
                this.__onClick._$bind2(this,-2)
            ],[
                this.__ebtn,'click',
                this.__onClick._$bind2(this, 2)
            ]]);
            _u._$forEach(_list,_doInitDomEvent,this);
        };
    })();
    /**
     * 设置节点的页码值
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doSetNodeIndex
     * @param  {Node}   arg0 - 页码节点
     * @param  {Number} arg1 - 页码值
     * @return {Void}
     */
    _pro.__doSetNodeIndex = function(_node,_index){
        var _parent = this.__getSelectNode(_node);
        if (_index==null){
            _node.innerText = '';
            _e._$setStyle(_node,'display','none');
            _e._$delClassName(_parent,this.__selected);
        }else{
            _node.innerText = _index;
            _e._$setStyle(_node,'display','');
            _index==this.__index
            ? _e._$addClassName(_parent,this.__selected)
            : _e._$delClassName(_parent,this.__selected);
        }
    };
    /**
     * 同步按钮状态
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doSyncBtnState
     * @return {Void}
     */
    _pro.__doSyncBtnState = function(){
        // sync start and previous
        if (this.__index<=1){
            _e._$addClassName(this.__pbtn,this.__disabled);
            _e._$addClassName(this.__sbtn,this.__disabled);
        }else{
            _e._$delClassName(this.__pbtn,this.__disabled);
            _e._$delClassName(this.__sbtn,this.__disabled);
        }
        // sync end and next
        if (this.__index>=this.__total){
            _e._$addClassName(this.__nbtn,this.__disabled);
            _e._$addClassName(this.__ebtn,this.__disabled);
        }else{
            _e._$delClassName(this.__nbtn,this.__disabled);
            _e._$delClassName(this.__ebtn,this.__disabled);
        }
    };
    /**
     * 刷新页码列表算法
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doRefreshPage
     * @return {Void}
     */
    _pro.__doRefreshPage = _f;
    /**
     * 强制刷新至新页码
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doChangeIndex
     * @return {Void}
     */
    _pro.__doChangeIndex = function(){
        this.__doRefreshPage();
        this.__doSyncBtnState();
        this._$dispatchEvent(
            'onchange',{
                last:this.__last,
                total:this.__total,
                index:this.__index,
                ext:this.__extdata
            }
        );
    };
    /**
     * 保存当前页码
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doSaveIndex
     * @param  {Number}  arg0 - 页码
     * @return {Boolean}        是否保存成功
     */
    _pro.__doSaveIndex = function(_index){
        _index = parseInt(_index);
        if (isNaN(_index)||
            this.__total==null)
            return !1;
        _index = Math.max(1,Math.min
                (_index,this.__total));
        this.__last  = this.__index;
        this.__index = _index;
        return !0;
    };
    /**
     * 保存总页码
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__doSaveTotal
     * @param  {Number}  arg0 - 总页码
     * @return {Boolean}        页码是否保存成功
     */
    _pro.__doSaveTotal = function(_total){
        _total = parseInt(_total);
        if (isNaN(_total)||_total<1)
            return !1;
        this.__total = Math.min(
            _total,this.__limit
        );
        return !0;
    };
    /**
     * 触发点击事件
     * 
     * @protected
     * @method module:util/page/base._$$PageAbstract#__onClick
     * @param  {Event}  arg0 - 事件对象
     * @param  {Number} arg1 - 页码标记
     * @return {Void}
     */
    _pro.__onClick = function(_event,_flag){
        _v._$stopDefault(_event);
        // check state
        var _element = _v._$getElement(_event),
            _selected = _e._$hasClassName(
                this.__getSelectNode(_element
            ),this.__selected),
            _disabled = _e._$hasClassName(_element,this.__disabled);
        if (!_element||_selected||_disabled){
            return;
        }
        // update index
        var _index = _element.innerText;
        switch(_flag){
            // previous or next
            case  1:
            case -1:
                _index = this.__index+_flag;
            break;
            // end
            case  2:
                _index = this.__total;
            break;
            // start
            case -2:
                _index = 1;
            break;
        }
        this._$setIndex(_index);
    };
    /**
     * 返回当前页码数
     * 
     * 脚本举例
     * ```javascript
     * // 获取当前页码
     * var _index = _page._$getIndex();
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$getIndex
     * @return {Number} 当前页码
     */
    _pro._$getIndex = function(){
        return this.__index;
    };
    /**
     * 跳转至指定页码
     * 
     * 脚本举例
     * ```javascript
     * // 设置当前页码
     * _page._$setIndex(2);
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$setIndex
     * @param  {Number} arg0 - 页码值
     * @return {Void}
     */
    _pro._$setIndex = function(_index){
        var _oidx = this.__index;
        this.__doSaveIndex(_index);
        if (_oidx!=this.__index){
            this.__doChangeIndex();
        }
    };
     /**
     * 返回页码总数
     * 
     * 脚本举例
     * ```javascript
     * // 获取总页码数
     * var _total = _page._$getTotal();
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$getTotal
     * @return {Number} 页码总数
     */
    _pro._$getTotal = function(){
        return this.__total;
    };
    /**
     * 设置总页码数，当前页码重置为首页
     * 
     * 脚本举例
     * ```javascript
     * // 设置总页码数
     * _page._$setTotal(10);
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$setTotal
     * @param  {Number} arg0 - 总页码数
     * @return {Void}
     */
    _pro._$setTotal = function(_total){
        if (this.__doSaveTotal(_total)&&
            this.__index!=null){
            this.__index = 1;
            this.__doChangeIndex();
        }
    };
    /**
     * 更新总页码数，当前页码不变，无回调
     * 
     * 脚本举例
     * ```javascript
     * // 设置总页码数
     * _page._$updateTotal(10);
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$updateTotal
     * @param  {Number} arg0 - 总页码数
     * @return {Void}
     */
    _pro._$updateTotal = function(_total){
        if (this.__doSaveTotal(_total)){
            this.__doRefreshPage();
            this.__doSyncBtnState();
        }
    };
    /**
     * 更新页码信息
     * 
     * 脚本举例
     * ```javascript
     * // 设置总页码数，并且跳转到指定页面
     * _page._$updatePage(2,10);
     * ```
     * 
     * @method module:util/page/base._$$PageAbstract#_$updatePage
     * @param  {Number} arg0 - 当前页码
     * @param  {Number} arg1 - 总页码数
     * @return {Void}
     */
    _pro._$updatePage = function(_index,_total){
        if (!this.__doSaveTotal(_total)||
            !this.__doSaveIndex(_index))
            return;
        this.__doChangeIndex();
    };

    if (CMPT){
        NEJ.P('nej.ut')._$$AbstractPage = _p._$$PageAbstract;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','b3c0f3ceba0c279f7e6de06836b8d2f0');
I$('b253744647bac38a3b41c0229d492fd1',function (NEJ,_k,_e,_u,_t,_p,_o,_f,_r){
    // variable declaration
    var _pro;
    /**
     * 三段分页器业务逻辑封装，适合于以下形式的分页器
     * 
     * 此结构没有首页，末页，因为首页，末页都可点击
     * 
     * ```
     *     ____      _       _   _   _   _   _       ___    ____
     *    |上一页|  |1| ... |5| |6| |7| |8| |9| ... |100|  |下一页|
     *     ----      -       -   -   -   -   -       ---    ----
     * ```
     * 
     * 结构举例
     * ```html
     * <div id="pagebox">
     *   <a href="#" class="zbtn zprv">上一页</a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zpgi"></a>
     *   <a href="#" class="zbtn znxt">下一页</a>
     * </div>
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/element',
     *     'util/page/page'
     * ],function(_e,_t,_p,_o,_f,_r){
     *     var _page  = _t._$$PageFragment._$allocate({
     *         parent:'pagebox',
     *         event:'click',
     *         index:9,
     *         total:10,
     *         onchange:function(_event){
     *             // 返回页码信息，last:上一次页面,index:当前页面，total:总页数
     *         }
     *     });
     *     
     *     // 翻到第4页
     *     _page._$setIndex(4);
     *     // 改变总页数,状态复原到第一页
     *     _page._$getTotal(20);
     *     // 想要保持页面信息状态
     *     _page._$updatePage(5,10);
     * })
     * ```
     * 
     * @class    module:util/page/page._$$PageFragment
     * @extends  module:util/page/base._$$PageAbstract
     * 
     * @param    {Object}      config   - 可选配置参数
     * @property {Array}       list     - 页码节点列表【长度保持奇数】
     * @property {String}      event    - 触发页码切换事件，默认为click
     * @property {String|Node} pbtn     - 上一页按钮
     * @property {String|Node} nbtn     - 下一页按钮
     * @property {String|Node} sbtn     - 首页按钮
     * @property {String|Node} ebtn     - 尾页按钮
     * @property {Number}      index    - 当前页码
     * @property {Number}      total    - 总页码数
     * @property {String}      selected - 选中样式，默认为js-selected
     * @property {String}      disabled - 禁用样式，默认为js-disabled
     */
    _p._$$PageFragment = _k._$klass();
    _pro = _p._$$PageFragment._$extend(_t._$$PageAbstract);
    /**
     * 初始化控件
     * 
     * @protected
     * @method module:util/page/page._$$PageFragment#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__ndot = [];
        this.__super();
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/page/page._$$PageFragment#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        this.__doRecycleDotNode();
    };
    /**
     * 回收省略节点
     * 
     * @protected
     * @method module:util/page/page._$$PageFragment#__doRecycleDotNode
     * @return {Void}
     */
    _pro.__doRecycleDotNode = (function(){
        var _doRecycle = function(_node,_index,_list){
            _e._$remove(_node);
            _list.splice(_index,1);
        };
        return function(){
            _u._$reverseEach(
                this.__ndot,_doRecycle
            );
        };
    })();
    /**
     * 刷新页码列表算法
     * 
     * @protected
     * @method module:util/page/page._$$PageFragment#__doRefreshPage
     * @return {Void}
     */
    _pro.__doRefreshPage = function(){
        this.__extdata = {
            last:!1,
            first:!1,
            list:this.__list
        };
        this.__doRecycleDotNode();
        this.__doSetNodeIndex(this.__list[0],1);
        // for total<length
        var _point = 1,
            _length = this.__list.length;
        if (this.__total<_length){
            for(var _page;_point<_length;_point++){
                _page = _point+1;
                this.__doSetNodeIndex(
                    this.__list[_point],
                    _page>this.__total?null:_page
                );
            }
            return;
        }
        // 2 -> index
        if (this.__index>1){
            var _count = Math.floor((_length-2)/2),
                _mxbeg = this.__total-_length+2,
                _start = Math.max(2,this.__index-_count);
            if (this.__total>=_length){
                _start = Math.min(_start,_mxbeg);
            }
            if (_start>2){
                var _node = _e._$create('span','zdot');
                this.__ndot.push(_node);
                _node.innerText = '...';
                this.__list[0].insertAdjacentElement(
                    'afterEnd',_node
                );
                this.__extdata.first = !0;
            }
            for(var _index;;_point++){
                _index = _start+_point-1;
                if (_index>this.__index)
                    break;
                this.__doSetNodeIndex(
                    this.__list[_point],_index
                );
            }
        }
        // index -> total
        if (this.__index<this.__total){
            var _index,_start = this.__index+1;
            for(var i=0,l=_length-2;;i++,_point++){
                _index = _start+i;
                if (_point>l||_index>this.__total)
                    break;
                this.__doSetNodeIndex(
                    this.__list[_point],_index
                );
            }
            if (_index<this.__total){
                var _node = _e._$create('span','zdot');
                this.__ndot.push(_node);
                _node.innerText = '...';
                this.__list[_point].insertAdjacentElement(
                    'beforeBegin',_node
                );
                this.__extdata.last = !0;
            }
            if (_index<=this.__total){
                this.__doSetNodeIndex(
                    this.__list[_point++],
                    this.__total
                );
            }
        }
        // hidden point -> length
        for(;_point<_length;_point++){
            this.__doSetNodeIndex(this.__list[_point]);
        }
    };

    if (CMPT){
        NEJ.P('nej.ut')._$$Page = _p._$$PageFragment;
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','fb63ed7115e08dfb247af14e069a3e31');
I$('e61cba3c1c523802688888e6fbd0ccb7',function (NEJ,_k,_e,_i0,_t0,_p,_o,_f,_r){
    // variable declaration
    var _pro;
    /**
     * 分页器控件封装
     *
     * 页面结构举例
     * ```html
     *   <div id="pagerCnt">page</div>
     *   <div id="pagerCnt2">page</div>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'ui/pager/pager'
     *   ],function(_u,_p,_o,_f,_r){
     *           // 默认第一页
     *       var _setIndex = 1;
     *       // 页面更改的回调方法
     *       var _onchangeHandle = function(_obj){
     *           var _index = _obj.index;
     *       };
     *       // 实例化一个pager对象，总共10页
     *       var _pager = _u._$$Pager._$allocate({
     *           parent:'pagerCnt',
     *           onchange: _onchangeHandle,
     *           total: 10,
     *           index:_setIndex
     *       });
     *       // 从第2页翻到第10页
     *       for(var i = 2 ; i < 11 ; i++){
     *           _setIndex = i;
     *           _pager._$setIndex(_setIndex);
     *       }
     *       // 绑定一个翻页器,视觉上翻页器会联动，
     *       但最后触发一次翻页器的回调,避免重复触发
     *       _pager._$bind('pagerCnt2');
     *   })
     * ```
     *
     * @class     module:ui/pager/pager._$$Pager
     * @uses      module:util/page/page._$$PageFragment
     * @extends   module:ui/base._$$Abstract
     * @param     {Object}  arg0 - 可选配置参数
     * @property  {Number}  index - 当前页码
     * @property  {Number}  total - 总页码数
     * @property  {Boolean} noend - 无尾页显示
     */
    /**
     * 页码切换事件，输入{last:3,index:1,total:12}
     *
     * @event  module:ui/pager/pager._$$Pager#onchange
     * @param  {Object}   arg0  - 页码状态对象
     * @property {Number} last  - 上一次的页码
     * @property {Number} index - 当前要切换的页面
     * @property {Number} total - 总页面数
     *
     */
    _p._$$Pager = _k._$klass();
    _pro = _p._$$Pager._$extend(_i0._$$AbstractPager);
    /**
     * 控件重置
     *
     * @protected
     * @method module:ui/pager/pager._$$Pager#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        _options.number =
            parseInt(_options.number)||9;
        this.__super(_options);
        this.__page = _t0._$$PageFragment._$allocate(this.__popt);
    };
    /**
     * 页面变化触发事件
     *
     * @protected
     * @method module:ui/pager/pager._$$Pager#__onChange
     * @param  {Object} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onChange = function(_event){
        if (!!this.__bopt.noend){
            var _dext = _event.ext||_o,
                _list = _dext.list||_r;
            if (_dext.last){
                _e._$setStyle(
                    _list[_list.length-1],
                    'display','none'
                );
            }
        }
        this.__super(_event);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ui'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','6d8bd1d9cf7e4c160f9f1dbf19bdde0c','b253744647bac38a3b41c0229d492fd1');
I$('4f974133cc48417770aab7278404f301',function (util, jst, e, db, pro) {

    var cUtil = {

        getColValue: function (config, obj, objState, isPinyin) {
            var value;
            var key = isPinyin ? config.keyPinyin : config.key;
            if (!key) {
                return '';
            }
            switch (config.valueType) {
                case 'tag':
                    value = this.getTag(obj[key])
                    break;

                case 'deepKey':
                    value = this.getDeepValue(key, obj);
                    break;

                case 'time':
                    value = this.getTime(obj[key], true);
                    break;

                case 'datatypeFormat':
                    value = this.datatypeFormat(obj[key], obj);
                    break;

                case '__nei-actions':
                    return objState['__nei-actions'] || '';

                case 'share' :
                    value = this.getShare(obj[key]);
                    break;

                case 'lock' :
                    value = this.getLock(obj[key]);
                    break;

                case 'testResult' :
                    value = this.getTestResultIcon(obj[key]);
                    break;

                case 'constraintType' :
                    value = this.getConstraintType(obj[key]);
                    break;

                default:
                    value = obj[key];
                    break;
            }
            // undefined or null
            if (value == undefined) {
                value = '';
            }
            return String(value);
        },

        getColTitle: function (config, obj) {
            switch (config.valueType) {
                case 'deepKey':
                    return this.getDeepValue(config.key, obj);

                case 'tag':
                    return '';

                case 'time':
                    return this.getTime(obj[config.key]);

                case 'datatypeFormat':
                    return this.datatypeFormat(obj[config.key], obj);
                    break;

                case 'share' :
                    return this.getShareTitle(obj[config.key]);

                case 'lock' :
                    return this.getLockTitle(obj[config.key]);

                case 'constraintType':
                    return this.getConstraintType(obj[config.key]);

                case '__nei-actions':
                    return '';

                case 'testResult' :
                    return this.getTestResult(obj[config.key]);

                case 'notificationTitle' :
                    // 后端已经转义过, 并且有超链接
                    return this.getText(obj[config.key]);

                default:
                    return obj[config.key];
            }
        },

        getShare: function (isShared) {
            var str = '';
            if (isShared) {
                str = '<em class="u-icon-share-pressed"></em>';
            }
            return str;
        },
        getLock: function (isLock) {
            var str = '';
            if (isLock) {
                str = '<em class="u-icon-lock-pressed"></em>';
            }
            return str;
        },
        getShareTitle: function (isShared) {
            return isShared ? '共享资源' : '';
        },
        getLockTitle: function (isLock) {
            return isLock ? '已被锁定' : '';
        },
        getTag: function (tag) {
            var str = '';
            if (!tag) {
                return str;
            }
            var tags = tag.split(',');
            tags.forEach(function (tag) {
                var escapeTag = tag;
                str += '<em class="tag-item" title="' + escapeTag + '">' + escapeTag + '</em>';
            }, this);
            return str;
        },

        getTag2: function (tags) {
            var str = '';
            tags.forEach(function (tag) {
                str += '<em class="tag-item" title="' + (tag.title ||tag) + '">' + (tag.name || tag) + '</em>';
            }, this);
            return str;
        },

        getDeepValue: function (key, obj) {
            var keys = key.split('.');
            var value = obj[keys[0]];
            var k;
            keys.shift();
            while (k = keys.shift()) {
                value = value ? value[k] : '';
            }
            return value;
        },

        getTime: function (time, short) {
            if (time) {
                var _time = new Date(time);
                return util._$format(_time, 'yyyy/MM/dd HH:mm:ss');
            }
            return '';
        },

        getTestResult: function (result) {
            var _resultStr = '';
            switch (result) {
                case db.API_TST_TODO:
                    _resultStr = '待开始';
                    break;
                case db.API_TST_FAILED:
                    _resultStr = '测试失败';
                    break;
                case db.API_TST_PASS:
                    _resultStr = '测试通过';
                    break;
                default:
                    _resultStr = '测试失效';
                    break;
            }
            return _resultStr;
        },

        datatypeFormat: function (format, obj) {
            var _resultStr = '';
            switch (format) {
                case db.MDL_FMT_HASH:
                    if (obj.id === 10000) {
                        _resultStr = '可变';
                    } else {
                        _resultStr = '哈希';
                    }
                    break;
                case db.MDL_FMT_ENUM:
                    _resultStr = '枚举';
                    break;
                case db.MDL_FMT_ARRAY:
                    _resultStr = '数组';
                    break;
                case db.MDL_FMT_STRING:
                    _resultStr = '字符';
                    break;
                case db.MDL_FMT_NUMBER:
                    _resultStr = '数值';
                    break;
                case db.MDL_FMT_BOOLEAN:
                    _resultStr = '布尔';
                    break;
                case db.MDL_FMT_FILE:
                    _resultStr = '文件';
                    break;
                default:
                    _resultStr = '未知';
                    break;
            }
            return _resultStr;
        },

        getTestResultIcon: function (result) {
            var _result = '';
            switch (result) {
                case db.API_TST_TODO:
                    _result = '<i class="u-icon-waiting-test-normal"></i>';
                    break;
                case db.API_TST_FAILED:
                    _result = '<i class="u-icon-state-fail-normal"></i>';
                    break;
                case db.API_TST_PASS:
                    _result = '<i class="u-icon-state-done-normal"></i>';
                    break;
                default:
                    _result = '<i class="u-icon-alert-normal-2"></i>';
            }
            return _result;
        },

        getConstraintType: function (type) {
            return {
                0: '所有类型'
            }[type || 0];
        },

        escapeHtml: function (str) {
            if (str === undefined) {
                return '';
            }
            var _html_seed = jst._$add('${value|escape}');
            return jst._$get(_html_seed, {value: str});
        },

	    escapeHtml2: function (str) {
		    if (str === undefined) {
			    return '';
		    }
		    var _html_seed = jst._$add('${value|escape2}');
		    return jst._$get(_html_seed, {value: str});
	    },

        getText: function (str) {
            var div = e._$create('div');
            div.innerHTML = str;
            return div.innerText;
        },

        escape2: function (string) {
            // jst 的 escape 会把换行转成 <br/>, 还会把空格转成 &nbsp;, 有时不适用
            /*
             * from escape-html
             * Copyright(c) 2012-2013 TJ Holowaychuk
             * Copyright(c) 2015 Andreas Lubbe
             * Copyright(c) 2015 Tiancheng "Timothy" Gu
             * MIT Licensed
             */
            var matchHtmlRegExp = /["'&<>]/;
            var str = '' + string;
            var match = matchHtmlRegExp.exec(str);
            if (!match) {
                return str;
            }
            var escape;
            var html = '';
            var index;
            var lastIndex = 0;
            for (index = match.index; index < str.length; index++) {
                switch (str.charCodeAt(index)) {
                    case 34: // "
                        escape = '&quot;';
                        break;
                    case 38: // &
                        escape = '&amp;';
                        break;
                    case 39: // '
                        escape = '&#39;';
                        break;
                    case 60: // <
                        escape = '&lt;';
                        break;
                    case 62: // >
                        escape = '&gt;';
                        break;
                    default:
                        continue;
                }
                if (lastIndex !== index) {
                    html += str.substring(lastIndex, index);
                }
                lastIndex = index + 1;
                html += escape;
            }
            return lastIndex !== index
                ? html + str.substring(lastIndex, index)
                : html;
        }
    }

    jst._$extend(cUtil);

    util._$merge(pro, cUtil);

},'3ff9c25bd81a3c2a260c28122918263a','1b12378d868a5877d4dba65367942b75','555a9eecaf26c5c01fe9db8d965bc30f','993671841dcf289096c7171d53130309');
I$('157930804aa02d98044660f35964ae05',"<div r-class={{\"u-select\":true,\"u-select2\":true,\"list-open\":isOpen,\"create-item\":hasCreate}} ref=\"element\">\n    <div r-class={{\"select-hd\":true,\"js-preview\":preview&&!isOpen,\"js-disabled\":!editable}} title={selected?selected.name:placeholder} on-click={this.toggle($event)}>\n        <input ref=\"input\" class=\"dis-name\" placeholder={placeholder} type=\"text\" r-model={inputValue}\n               title={inputValue} on-input={this.input($event)} on-focus={this.focusInput($event)} on-keydown={this.keydown($event)} readonly={!editable} maxlength={maxLen}/>\n        <i class=\"u-trigon-down\" ref=\"trigon\"></i>\n        <!-- 没有选中项并且preview为true时的提示 -->\n        <span r-class={{\"empty-tip\":true,\"f-dn\":!(!inputValue&&preview&&!isOpen)}} on-click={this.toggle($event)}>{emptyTip}</span>\n    </div>\n    <div class=\"select-bd\" r-show={isOpen}>\n        <ul class=\"list-view\" ref=\"listcon\">\n            {#list xlist as item by item.id}\n            <li r-class={{\"js-disabled\":item.id===undefined,\"z-sel\":sIndex===item_index}} title={item.title||item.name}\n                on-click={this.select($event,item,item_index)}>\n                {#if item.__uiName}\n                <span r-html={item.__uiName}></span>\n                {#else}\n                <span>{item.name}</span>\n                {/if}\n            </li>\n            {/list}\n        </ul>\n        {#if hasCreate}\n        <div class=\"create-dt\" title=\"新建模型\" on-click={this.create($event)}>\n            <span><strong>+</strong>新建模型</span>\n        </div>\n        {/if}\n    </div>\n</div>");
I$('ec8a454397dd26b215ac74a20206f8ef',".u-trigon-down{\n\tdisplay:inline-block;\n\tborder-width:5px;\n\tborder-style:solid dashed dashed dashed;\n\tborder-color:#777 transparent transparent transparent;\n}\n.u-select{\n\tdisplay:inline-block;\n\tvertical-align:middle;\n\tposition:relative;\n\tfont-size:12px;\n\tcursor:pointer;\n\ttext-align:left;\n}\n.u-select.list-open .select-hd{\n\tborder-bottom-color:#fff;\n\tbackground:#fff;\n}\n.u-select .select-hd{\n\tbox-sizing:border-box;\n\tpadding:0 8px;\n\tborder:1px solid #e6e6e6;\n\tposition:relative;\n\theight:30px;\n\tline-height:30px;\n\ttransition:all ease 0.3s;\n\twidth:100%;\n}\n.u-select .select-hd.js-preview{\n\tborder-color:transparent;\n}\n.u-select .select-hd.js-preview .u-trigon-down{\n\topacity:0;\n}\n.u-select .select-hd.js-preview:hover{\n\tborder-color:#e6e6e6;\n}\n.u-select .select-hd.js-preview:hover .u-trigon-down{\n\topacity:1;\n}\n.u-select .select-hd.js-disabled{\n\tborder-color:#fff;\n}\n.u-select .select-hd.js-disabled .u-trigon-down{\n\topacity:0;\n}\n.u-select .select-hd.js-disabled:hover{\n\tborder-color:#fff;\n}\n.u-select .select-hd.js-disabled:hover .u-trigon-down{\n\topacity:0;\n}\n.u-select .select-hd .dis-name{\n\twidth:98%;\n\tdisplay:inline-block;\n\tbox-sizing:border-box;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n\theight:24px;\n\tline-height:24px;\n\tborder:0 none;\n\tbackground-color:transparent;\n\tfont-size:12px;\n}\n.u-select .select-hd .btn{\n\tpadding:0 12px;\n\tdisplay:inline-block;\n\twidth:100%;\n\theight:30px;\n\tbox-sizing:border-box;\n\tline-height:30px;\n\tcolor:#999;\n\tborder:1px solid #ddd;\n}\n.u-select .select-hd .btn-error{\n\tborder-color:#f00;\n}\n.u-select .select-hd .u-trigon-down{\n\tposition:absolute;\n\ttop:12px;\n\tright:5px;\n\topacity:1;\n\ttransition:opacity ease 0.3s;\n\tz-index:1;\n}\n.u-select .select-bd{\n\tposition:absolute;\n\tz-index:99;\n\twidth:100%;\n\ttop:100%;\n\tmargin-top:-1px;\n\tdisplay:none;\n\tbackground-color:#fff;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n\tfont-size:12px;\n}\n.u-select .select-bd .u-input{\n\tdisplay:block;\n\theight:30px;\n\tline-height:30px;\n}\n.u-select .list-view{\n\tbox-sizing:border-box;\n\tbackground:#fff;\n\tcolor:#555;\n\tmax-height:220px;\n\toverflow-y:auto;\n\tborder:1px solid #e6e6e6;\n\tborder-top:0 none;\n}\n.u-select .list-view>li{\n\tpadding:0 8px;\n\tline-height:30px;\n\tcolor:#222;\n\tcursor:pointer;\n\tposition:relative;\n\toverflow:hidden;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\ttransition:all ease 0.3s;\n}\n.u-select .list-view>li:hover{\n\tbackground:#eee;\n\topacity:0.8;\n}\n.u-select .list-view>li.js-disabled:hover{\n\tbackground:#fff;\n\topacity:1;\n\tcursor:not-allowed;\n}\n.u-select .list-view>li.z-sel{\n\tbackground:#eee;\n}\n.u-select .hl{\n\tbackground-color:#fd9c41;\n\tcolor:#333;\n}\n.u-select .empty-tip{\n\tposition:absolute;\n\ttop:0;\n\tright:0;\n\tbottom:0;\n\tleft:4px;\n\tbackground-color:#fff;\n\tcolor:#bbb;\n\tpointer-events:none;\n}\n.u-select .empty-tip.f-dn{\n\tdisplay:none !important;\n}\n.u-select.create-item .create-dt{\n\tbackground:#fff;\n\ttext-align:center;\n\theight:30px;\n\tline-height:30px;\n\tborder:1px solid #e6e6e6;\n\tborder-top:1px solid #f5f5f5;\n\tcolor:#30a1f2;\n}\n.u-select.create-item .list-view{\n\tborder-bottom:0 none;\n}\n.u-select2{\n\twidth:160px;\n}");
I$('e26ac58445dd3bc2b730e5275fb45f6f',function (rb, v, u, e, util, jstex, html, css) {
    // 加载一次
    e._$addStyle(css);
    // 常量
    var ARROW_UP_KEY = 38;
    var ARROW_DOWN_KEY = 40;
    var ENTER_KEY = 13;

    // 默认选项
    var defaultOptions = {
        // 自动提示的数据源
        source: [],
        // 初始化时选中的项
        selected: undefined,
        // input 的 placeholder
        placeholder: '',
        // 是否打开列表, 如果没有这个值, 则初始时, config 中的 this.$watch('isOpen',...) 不会触发
        isOpen: false,
        // 是否只可选择
        choseOnly: true,
        // 是否要选中第一项, 前提是 choseOnly 为 true, 并且没有设置 selected
        selectFirst: true,
        // 是否为预览模式
        preview: false,
        // 是否可以编辑
        editable: true,
        // 是否有新创建的按钮
        hasCreate: false,
        // 初始化赋值时, 是否要触发 change 事件
        initSilent: false,
        // 是否是数据模型下拉框
        isDataType: false,
        // 是否要对列表进行排序
        sortList: true,
        // 没有选中项, 并且preview为true时的提示
        emptyTip: '无',
        // 输入框最大长度
        maxLen: null
    };

    // 支持事件:
    // 1. change: 选项有变化时触发
    //    select.$on('change', function(evt) {
    //      evt.sender
    //      evt.selected
    //    })

    var Select2 = rb.extend({
        name: "select2",

        template: html,

        config: function () {
            this.data = u._$merge({}, defaultOptions, this.data);
            this._sortData();
            this.initSelected = null;
            //有时候传过来的selected不是一个对象，可能是一个数值或字符串 ，这时候就要转换为对象 add by lihl 2016.12.16
            if(typeof this.data.selected === "string" || typeof this.data.selected === "number"){
                this.data.selected = {
                    id:this.data.selected
                };
                this.data.source.forEach(function (item) {
                    if(item.id == this.data.selected.id){
                        this.data.selected.name = item.name;
                    }
                },this);
                if(!this.data.selected.name){
                    this.data.selected.name = this.data.selected.id;
                }
            }
            if (this.data.selected) {
                this.initSelected = this.data.selected;
                this.data.inputValue = this.data.selected.name;
                if (!this.data.choseOnly) {
                    // 不是只选择模式, 如果选中的值不在列表中, 则将它添加到列表中
                    var found = this.data.source.find(function (m) {
                        return m.id === this.data.selected.id;
                    }, this);
                    if (!found) {
                        this.data.source.push(this.data.selected);
                    }
                }
            }
            this._resetXlist();
            this.$watch('isOpen', function (isOpen) {
                if (isOpen) {
                    // 这个值只对初始化赋值时有用
                    this.data.initSilent = false;
                    if (this.data.selected) {
                        this.data.__oSelected = this.data.selected;
                    }
                    this._resetXlist();
                    this._setListScrollTop();
                    this._addEventOnce();
                    return;
                } else {
                    if (!this.data.selected) {
                        var value = this.$refs.input.value.trim();
                        if (this.data.choseOnly) {
                            if (this.data.selectFirst) {
                                // 如果是只可选择下拉列表中的某一项
                                var firstItem = this.data.xlist[0];
                                if (firstItem && typeof(firstItem.id) !== 'undefined') {
                                    this.data.selected = firstItem;
                                    // 自动选择某一项时需要设置input的值
                                    this.data.inputValue = this.data.selected.name;
                                } else if (this.data.source[0]) {
                                    // 没有可选项的时候, 选择 source 里面的第一个
                                    this.data.selected = this.data.source[0];
                                    // 自动选择某一项时需要设置input的值
                                    this.data.inputValue = this.data.selected.name;
                                }
                            } else {
                                // 选择之前的值
                                this.data.selected = this.data.__oSelected || {};
                                this.data.inputValue = this.data.selected.name;
                            }
                        } else if (value) {
                            this.data.selected = {
                                name: value,
                                id: value
                            }
                        }
                    }
                }
                var emitChange = function () {
                    // 初始化赋值时, 不需要触发 change 事件
                    if (this.initSelected !== null && this.data.initSilent) {
                        this.data.initSilent = false;
                        return;
                    }
                    this.$emit('change', {
                        sender: this,
                        selected: this.data.selected || {},
                        oSelected: this.data.__oSelected || {}
                    });
                }.bind(this);
                // 打开前和关闭后都没有选中项, 不处理
                if (!this.data.__oSelected && !this.data.selected) {
                    return;
                }
                if (!this.data.__oSelected && this.data.selected) {
                    // 打开前没有选中项, 关闭时有选中项, 抛事件
                    emitChange();
                } else if (this.data.__oSelected && !this.data.selected) {
                    // 打开前有选中项, 关闭时没有选中项, 抛事件
                    emitChange();
                } else if (this.data.__oSelected.id !== this.data.selected.id) {
                    // 打开前和关闭后都有选中项, 比较两者的 id, 如果不相等, 抛事件
                    emitChange();
                }
                // 删除__oSelected, 每次打开会重新设置
                // delete this.data.__oSelected;
                // 关闭时清除高亮选中状态
                this.data.sIndex = null;
            }.bind(this));
        },

        _sortFunc: function (itemA, itemB) {
            if (itemA.name && itemB.name) {
                return itemA.name.toLowerCase().localeCompare(itemB.name.toLowerCase());
            }
        },

        _sortData: function () {
            if (!this.data.sortList) return;
            if (this.data.isDataType) {
                // 如果是数据模型下拉框
                var systemDataTypes = [];
                var normalDataTypes = [];
                var hasArrayType = false;
                var hasObjectType = false;
                this.data.source.forEach(function (dt) {
                    if (dt.id <= 10003 || /^(array|object)$/.test(dt.id)) {
                        systemDataTypes.push(dt);
                        if (dt.id === 'array') {
                            hasArrayType = true;
                        } else if (dt.id === 'object') {
                            hasObjectType = true;
                        }
                    } else {
                        normalDataTypes.push(dt);
                    }
                });
                var handlerDataType = function (configName, dataType, dataTypeName, hasType) {
                    if (this.data[configName]) {
                        // 移除该类型
                        var index = null;
                        var found = systemDataTypes.find(function (dt, idx) {
                            if (dt.id === dataType) {
                                index = idx;
                                return true;
                            }
                        });
                        if (found) {
                            systemDataTypes.splice(index, 1);
                            // 如果选中的是该类型, 则默认换成选中 String 类型
                            if (this.data.selected && this.data.selected.id === dataType) {
                                this.data.selected = {
                                    id: 10001,
                                    name: 'String'
                                };
                            }
                        }
                    } else if (!hasType) {
                        // 添加该类型
                        systemDataTypes.push({
                            name: dataTypeName,
                            id: dataType
                        });
                    }
                }.bind(this);
                handlerDataType('noArray', 'array', 'Array', hasArrayType);
                handlerDataType('noObject', 'object', 'Object', hasObjectType);
                systemDataTypes.sort(this._sortFunc);
                normalDataTypes.sort(this._sortFunc);
                this.data.source = systemDataTypes.concat(normalDataTypes).map(function (item) {
                    return {
                        id: item.id,
                        name: item.name,
                        title: item.title || (item.description ? (item.name + '(' + item.description + ')') : item.name)
                    }
                });
            } else {
                // 按名称排序
                this.data.source.sort(this._sortFunc);
            }
        },

        _resetXlist: function () {
            this.data.xlist = this.data.source.map(function (item, index) {
                if (this.data.selected && this.data.selected.id === item.id) {
                    this.data.sIndex = index;
                    this.data.inputValue = this.data.selected.name;
                }
                return {
                    id: item.id,
                    name: item.name,
                    title: item.title
                }
            }, this);
        },

        toggle: function (evt) {
            this.$emit("toggle");
            if (!this.data.editable) {
                // 不可编辑模式
                return;
            }
            this.data.isOpen = !this.data.isOpen;
            this.$refs.input.focus();
        },

        focusInput: function (evt) {
            // 记住打开前的选中项, 关闭时做对比, 如果有变化就发出 change 事件
            this.data.__oSelected = this.data.selected;
            this.$emit("focus");
        },

        _addEventOnce: function () {
            this._hideHandler = this._hideHandler || function (evt) {
                    if (evt && this.$refs && evt.target === this.$refs.input
                        || evt && this.$refs && evt.target === this.$refs.trigon
                    ) {
                        return;
                    }
                    this.data.isOpen = false;
                    Regular.dom.off(document, 'click', this._hideHandler);
                    this.$update();
                }.bind(this);
            // 需要先移除事件, 不然反复点击时会重复触发
            Regular.dom.off(document, 'click', this._hideHandler);
            Regular.dom.on(document, 'click', this._hideHandler);
        },

        select: function (evt, item, index) {
            if (item.disabled) {
                return evt.event.stopPropagation();
            }
            this.data.isOpen = false;
            this.data.selected = item;
            this.data.sIndex = index;
            this.data.inputValue = item.name;
        },

        input: function (evt) {
            evt.event.preventDefault();
            // 只要有输入动作, 就需要打开下拉框
            this.data.isOpen = true;
            this.data.sIndex = null;
            this.data.selected = null;
            this.matchXlist();
            this.data.inputValue = this.$refs.input.value.trim();
        },

        matchXlist: function () {
            var value = this.$refs.input.value.trim();
            this.data.xlist = this.data.source.filter(function (item) {
                delete item.__uiName;
                if (!value) {
                    return true;
                }
                var iv = item.name;
                var hitIndex = iv.toLowerCase().indexOf(value.toLowerCase());
                if (hitIndex !== -1) {
                    item.__uiName = jstex.escapeHtml(iv.substr(0, hitIndex)) + '<b class="hl">' + jstex.escapeHtml(iv.substr(hitIndex, value.length)) + '</b>' + jstex.escapeHtml(iv.substr(hitIndex + value.length, iv.length - 1));
                    return true;
                }
                var ivpy = item.namePinyin;
                var matchPinyinResult = util.highlightPinyin(iv, ivpy, value);
                if (matchPinyinResult) {
                    item.__uiName = matchPinyinResult;
                    return true;
                }
            }, this);
            this.checkXList();
        },

        keydown: function (evt) {
            var keyCode = evt.event.keyCode;
            if (keyCode === ENTER_KEY) {
                evt.event.preventDefault();
                this.data.isOpen = !this.data.isOpen;
                if (!this.data.isOpen) {
                    if (this.data.sIndex) {
                        this.data.selected = this.data.xlist[this.data.sIndex];
                    } else {
                        if (this.data.choseOnly) {
                            var firstItem = this.data.xlist[0];
                            if (firstItem.id) {
                                this.data.selected = firstItem;
                            } else {
                                // 没有可选项的时候, 选择 source 里面的第一个
                                this.data.selected = this.data.source[0];
                                // 更新自动提示列表, 以便再次打开时的状态保持一致
                                this.data.xlist = [this.data.selected];
                            }
                            this.data.inputValue = this.data.selected.name;
                        }
                    }
                    this._hideHandler();
                }
            } else if (keyCode === ARROW_UP_KEY) {
                evt.event.preventDefault();
                if (!this.data.isOpen) {
                    this.data.isOpen = true;
                }
                if (this.data.sIndex === null) {
                    this.data.sIndex = this.data.xlist.length - 1;
                } else {
                    this.data.sIndex -= 1;
                    if (this.data.sIndex < 0) {
                        this.data.sIndex = this.data.xlist.length - 1;
                    }
                }
                if (this.data.xlist[this.data.sIndex].id) {
                    this.data.selected = this.data.xlist[this.data.sIndex];
                    this.data.inputValue = this.data.selected.name;
                    this._setListScrollTop();
                } else {
                    // 没有可选择的项
                    this.data.sIndex = null;
                }
            } else if (keyCode === ARROW_DOWN_KEY) {
                evt.event.preventDefault();
                if (!this.data.isOpen) {
                    this.data.isOpen = true;
                }
                if (this.data.sIndex === null) {
                    this.data.sIndex = 0;
                } else {
                    this.data.sIndex += 1;
                    if (this.data.sIndex > this.data.xlist.length - 1) {
                        this.data.sIndex = 0;
                    }
                }
                if (this.data.xlist[this.data.sIndex].id) {
                    this.data.selected = this.data.xlist[this.data.sIndex];
                    this.data.inputValue = this.data.selected.name;
                    this._setListScrollTop();
                } else {
                    // 没有可选择的项
                    this.data.sIndex = null;
                }
            }
        },

        checkXList: function () {
            if (this.data.xlist.length === 0) {
                this.data.xlist.push({
                    name: '没有可选择的项',
                    disabled: true
                });
            }
        },

        _setListScrollTop: function () {
            setTimeout(function () {
                if (this.$refs) {
                    if (this.data.sIndex > 5) {
                        this.$refs.listcon.scrollTop = (this.data.sIndex - 5) * 36;
                    } else {
                        this.$refs.listcon.scrollTop = 0;
                    }
                }
            }.bind(this), 0);
        },

        create: function (evt) {
            this.$emit('create');
        },

        /**
         * 选择某一项, 如果该项不在 source 中, 就将它添加到 source 中
         * @param {Object} item -  需要选中的项
         **/
        $select: function (item) {
            var index = null;
            var found = this.data.source.find(function (it, idx) {
                if (it.id === item.id) {
                    index = idx;
                    return true;
                }
            });
            // 判断该项是否和已经选中的相同
            if (found && this.data.selected && this.data.selected.id === found.id) {
                // 如果相同就返回, 不处理
                // console.log('没变化')
                return;
            }
            if (!found) {
                // 如果列表中不存在, 就将它添加到列表中
                this.data.source.push(item);
                this._sortData();
                this.data.selected = this.data.source.find(function (it, idx) {
                    if (it.id === item.id) {
                        index = idx;
                        return true;
                    }
                });
            } else {
                this.data.selected = found;
            }
            this.data.sIndex = index;
            this.data.inputValue = this.data.selected.name;
            this.$update();
            // 触发 change 事件
            this.$emit('change', {
                sender: this,
                selected: this.data.selected
            });
        },

        /**
         * 更新 source
         * @param {Array} source -  新的数据源
         * @param {Object} [selected]-  选中的项, 如果不传就默认为当前选中的项, 如果当前没有选中的项, 走初始化的逻辑:
         *                              1. 有 placeholder, 不处理
         *                              2. 没有 placeholder, 选中第一项
         * @return  {Void}
         **/
        $updateSource: function (source, selected) {
            selected = selected || this.data.selected;
            this.data.source = source;
            this._sortData();
            this._resetXlist();
            if (selected) {
                var index = null;
                this.data.selected = this.data.source.find(function (it, idx) {
                    if (it.id === selected.id) {
                        index = idx;
                        return true;
                    }
                });
                if (!this.data.selected) {
                    // 说明之前的选中项在新的 source 中不存在
                    if (!this.data.placeholder) {
                        this.data.selected = this.data.source[0];
                        this.data.sIndex = 0;
                        this.data.inputValue = this.data.selected.name;
                    } else {
                        this.data.inputValue = null;
                    }
                } else {
                    this.data.sIndex = index;
                    this.data.inputValue = this.data.selected.name;
                }
            } else {
                if (!this.data.placeholder) {
                    this.data.selected = this.data.source[0];
                    this.data.sIndex = 0;
                    this.data.inputValue = this.data.selected.name;
                }
            }
            this.$update();
        }
    });

    return Select2;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','4f974133cc48417770aab7278404f301','157930804aa02d98044660f35964ae05','ec8a454397dd26b215ac74a20206f8ef');
I$('7de92aae3e26e733b4a3773f1128f398',function (_k, _u, _d, db, _p, _pro) {
    _p._$$CacheActivity = _k._$klass();
    _pro = _p._$$CacheActivity._$extend(_d._$$Cache);
    // 项目组所有动态缓存 key
    _p._$progroupsAllCacheKey = 'activities-progroups-all';
    // 指定项目组的所有动态缓存 key
    _p._$progroupsCacheKey = 'activities-progroups';
    // 指定项目的所有动态缓存 key
    _p._$projectsCacheKey = 'activities-projects';
    //  指定接口的操作历史缓存 key
    _p._$interfacesCacheKey = 'activities-interfaces';
    //  指定规范的操作历史缓存 key
    _p._$specsCacheKey = 'activities-specs';
    //  指定页面的操作历史缓存 key
    _p._$pagesCacheKey = 'activities-pages';
    //  指定页面模板的操作历史缓存 key
    _p._$templatesCacheKey = 'activities-templates';
    //  指定数据模型的操作历史缓存 key
    _p._$datatypesCacheKey = 'activities-datatypes';
    //  指定规则函数的操作历史缓存 key
    _p._$constraintsCacheKey = 'activities-constraints';
    //  用户所有的操作历史缓存 key
    _p._$allCacheKey = 'activities-all';

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    _pro.__doLoadList = function (options) {
        var data = this._$getListInCache(options.key);
        var lct = new Date().getTime();
        if (data.length > 0) {
            var last = data[options.data.offset - 1];
            if (last) {
                lct = data[options.data.offset - 1].createTime;
            } else {
                lct = null;
            }
        }
        options.data = _u._$merge({
            limit: options.limit,
            total: options.total
        }, options.data);
        if (lct) {
            options.data.lct = lct;
        }
        var url = this.__getUrl(options);
        this.__sendRequest(url, options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url = '/api/activities/';

        switch (options.ext.key) {
            case _p._$progroupsAllCacheKey:
                options.data.type = db.RES_TYP_PROGROUP;
                break;

            case _p._$projectsCacheKey:
                options.data.type = db.RES_TYP_PROJECT;
                break;

            case _p._$interfacesCacheKey:
                options.data.type = db.RES_TYP_INTERFACE;
                break;

            case _p._$specsCacheKey:
                url += '?spec';
                break;

            case _p._$pagesCacheKey:
                options.data.type = db.RES_TYP_WEBVIEW;
                break;

            case _p._$templatesCacheKey:
                options.data.type = db.RES_TYP_TEMPLATE;
                break;

            case _p._$datatypesCacheKey:
                options.data.type = db.RES_TYP_DATATYPE;
                break;
            
            case _p._$constraintsCacheKey:
                options.data.type = db.RES_TYP_CONSTRAINT;
                break;

            case _p._$allCacheKey:
                url += '?all';
                break;

            default:
                break;
        }
        return url;
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','c6dbf51c390a9de703c7bf6c9b46ff41','993671841dcf289096c7171d53130309');
I$('29f4b2dc96ca931edfeb9264ffe3e954',function (_k, _u, _v, _c, _d, _p, _pro) {
    _p._$$CacheUser = _k._$klass();
    _pro = _p._$$CacheUser._$extend(_d._$$Cache);
    _p._$cacheKey = 'user';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
        // user cache 可能被多个模块实例化, 所以这里需要判断一下
        if (window.pageConfig.user) {
            var user = window.pageConfig.user;
            var propertyToEscape = ['company', 'realname', 'username', 'blog','github', 'weixin', 'yixin', 'paopao', 'qq'];
            propertyToEscape.forEach(function (item) {
                user[item] = user[item].replace(/&quot;/g, '"').replace(/&amp;/g, '&').replace(/&#39;/g, "'").replace(/&lt;/g, '<').replace(/&gt;/g, '>');
            });
            this.__setDataInCache(_p._$cacheKey, user);
            // 防止后续直接操作该数据,直接冻结该对象
            // Object.freeze(window.pageConfig.user);
            delete window.pageConfig.user;
        }
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * 支持更新用户基本资料的字段有:
     * @property {String} [options.name] - 姓名
     * @property {String} [options.company] - 企业
     * @property {String} [options.role] - 角色
     * @property {String} [options.phone] - 手机
     * @property {Array} [options.email] - 邮箱
     * @property {Array} [options.workTime] - 工作时间
     * @property {Array} [options.blog] - 个人博客
     * @property {Array} [options.github] - github
     * @property {Array} [options.weixin] - 微信
     * @property {Array} [options.yixin] - 易信
     * @property {Array} [options.popo] - 泡泡
     * @property {Array} [options.qq] - QQ
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        options.onload = function (data) {
            this.__setDataInCache(_p._$cacheKey, data);
            var event = {
                key: options.id,
                data: data,
                action: 'update'
            };
            _v._$dispatchEvent(
                this.constructor, 'update', {
                    data: data,
                    action: event.action
                }
            );
        }.bind(this);
        this.__super(options);
    };

    /**
     * 获取用户信息
     * @return {Object} 用户对象
     */
    _pro._$getUserInCache = function () {
        return this.__getDataInCache(_p._$cacheKey);
    };

    /**
     * 绑定邮箱或者手机(V3只支持邮箱绑定)
     * @param {Object} options - 参数对象
     * 支持绑定的类型有:
     * @property {String} [options.email] - 需要绑定的邮箱
     * @success dispatch event: onbind
     */
    _pro._$bind = function (options) {
        this.__doAction({
            actionMsg: false,
            data: {
                email: options.email
            },
            method: 'PUT',
            ext: options.ext,
            action: 'bind',
            onload: 'onbind'
        });
    };

    /**
     * 解绑邮箱或者手机(V3只支持邮箱解绑)
     * @param {Object} options - 参数对象
     * 支持解绑的类型有:
     * @property {Boolean} [options.isEmail] - 是否是解绑邮箱
     * @success dispatch event: onunbind
     */
    _pro._$unbind = function (options) {
        this.__doAction({
            actionMsg: false,
            data: {
                isEmail: options.isEmail
            },
            method: 'PUT',
            action: 'unbind',
            onload: 'onunbind'
        });
    };

    /**
     * 校验验证码正确性
     * @param {Object} options - 参数对象
     * 支持解绑的类型有:
     * @property {String} [options.code] - 验证码
     * @success dispatch event: onunbind
     */
    _pro._$verify = function (options) {
        this.__doAction({
            data: {
                code: options.code
            },
            method: 'PUT',
            action: 'verify',
            ext: options.ext,
            onload: function (result) {
                this.__setDataInCache(_p._$cacheKey, result.data);
                this._$dispatchEvent('onverify', result)
            }.bind(this)
        });
    };
    /**
     * 修改密码
     * @param {Object} options - 参数对象
     * @property {String} [options.opwd] - 原密码
     * @property {String} [options.npwd] - 新密码
     * @success dispatch event: onupdatepwd
     */
    _pro._$updatePwd = function (options) {
        this.__doAction({
            data: {
                opwd: options.opwd,
                npwd: options.npwd
            },
            method: 'PUT',
            action: 'cpwd',
            onload: 'onupdatepwd'
        });
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        switch (options.key) {
            case _p._$cacheKey:
                url = '/api/users/';
                if (options.action) {
                    url += '?' + options.action;
                }
                break;

            default:
                break;
        }
        return url;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('09437bf7199eb808a35a38e5178e5151',function (_k, _u, v, _c, baseCache, pgCache, userCache, dbConst, _p, pro) {
    _p._$$CachePro = _k._$klass();
    pro = _p._$$CachePro._$extend(baseCache._$$Cache);
    _p._$cacheKey = 'projects'; // 项目列表
    _p._$searchCacheKey = 'projects-searchlist'; // 搜索项目列表
    _p._$recentCacheKey = 'projects-recent'; // 最近使用的项目列表
    _p._$cloneCacheKey = 'project-clone';//复制项目的key
    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    pro.__isGetSearchList = function (options) {
        return options.key === _p._$searchCacheKey || options.key === _p._$recentCacheKey;
    };

    pro._$getList = function (options) {
        if (options.ext && options.ext.needFlush) {
            this._$clearListInCache(options.key);
        }
        this.__super(options);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        // 如果是搜索列表或者最近使用列表, 就去请求数据
        if (this.__isGetSearchList(options)) {
            var url = this.__getUrl(options);
            return this.__sendRequest(url, options);
        }
        // 项目列表, 目前都是附着在项目组列表上的, 所以这里直接去请求项目组列表
        // 进到这个函数中, 说明此时项目组列表并未加载完成
        // 项目组列表是肯定会加载的, 需要显示左边的树
        var _pgCache = pgCache._$$CacheProGroup._$allocate({
            onlistload: function (evt) {
                var event = {
                    key: options.key,
                    data: evt.data,
                    action: options.action,
                    ext: options.ext
                };
                this._$dispatchEvent('onlistload', event);
            }.bind(this)
        });
        _pgCache._$getList({
            key: pgCache._$cacheKey
        });
    };

    /**
     * 新建项目
     * @param {Object} options - 参数对象
     * @property {String} options.data.name - 新的项目组名称
     * @property {String} [options.data.description=''] - 新的项目组描述信息
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!_u._$isString(options.data.name) || !options.data.name.trim()) {
            // console.error('请输入有效的项目名称');
            return;
        }
        this.__super(options);
    };

    /**
     * 更新项目
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 资源 id
     * 支持更新的字段有:
     * @property {String} [options.name] - 项目名称
     * @property {String} [options.description] - 项目描述
     * @property {String} [options.toolSpecWebId] - 使用的Web规范标识
     * @property {String} [options.toolSpecAosId] - 使用的Aos规范标识
     * @property {String} [options.toolSpecIosId] - 使用的Ios规范标识
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        //项目复制的时候key值用来标识项目组缓存ext.xkey来代替
        if(options.ext && options.ext.xkey == _p._$cloneCacheKey) {
            url = '/api/projects/?clone';
            return url;
        }
        if (options.key === _p._$searchCacheKey) {
            url = '/api/projects/?search';
        } else if (options.key === _p._$recentCacheKey) {
            url = '/api/projects/?recent';
        }  else if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/projects/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 项目组内的项目排序
     * @param {Object} options - 参数对象
     * @property {Number} options.pgId - 项目组 id
     * @property {Array|Number} options.ids - 项目 id 列表
     * @property {Number} options.type - 排序方式
     * @success dispatch event: onsort, onlistchange
     */
    pro._$sort = function (options) {
        this.__doAction({
            data: {
                ids: options.ids,
                type: options.type,
                pgId: options.pgId
            },
            ext: options.ext,
            key: options.key,
            method: 'PUT',
            action: 'sort',
            updateListOrder: true,
            triggerListchange: true,
            onload: function (evt) {
                // 更新项目组上的项目排序方式
                var _pgCache = pgCache._$$CacheProGroup._$allocate();
                var pg = _pgCache._$getItemInCache(options.pgId);
                pg.projectOrder = options.type;
                this._$dispatchEvent('onsort', evt);
            }.bind(this),
            id: options.id
        });
    };

    /**
     * 重新生成工具标识key
     * @param {Object} options - 参数对象
     * @success dispatch event: onrefreshkey
     */
    pro._$refreshKey = function (options) {
        this.__doAction({
            key: options.key,
            method: 'PUT',
            data: {
                reqHolder: 1
            },
            action: 'rtk',
            onload: function (evt) {
                this.__setDataInCache(evt.key, evt.data);
                this._$dispatchEvent('onrefreshkey', evt);
            }.bind(this),
            id: options.id
        });
    };

    /**
     * 项目置顶
     * @param {Object} options - 参数对象
     * @property {Array|Number} options.id -  资源 id
     * @property {Number} options.pgId -  项目所在的项目组 id
     * @property {Boolean} options.v - true 时为置顶, false 时为取消置顶
     * @success dispatch event: onlistchange
     */
    pro._$stick = function (options) {
        this.__doAction({
            data: {
                v: options.v,
                pgId: options.pgId
            },
            ext: options.ext,
            key: options.key,
            method: 'PUT',
            action: 'stick',
            id: options.id,
            onload: function (evt) {
                // 更新项目组对象上的 projectTopList
                var _pgCache = pgCache._$$CacheProGroup._$allocate();
                var progroup = _pgCache._$getItemInCache(options.pgId);
                var projectTopList = evt.data.filter(function (item) {
                    return item.isTop;
                });
                progroup.projectTopList = projectTopList.map(function (item) {
                    return item.id;
                }).join(',');
                // 调整缓存中的项目列表顺序
                var list = this._$getListInCache(this._$getListKey(progroup.id));
                var newList = [];
                // evt.data 的顺序后端保证是正确的, 即置顶的会在最前面
                evt.data.forEach(function (item) {
                    newList.push(list.find(function (pro) {
                        //设置当前项目的置顶状态
                        if(pro.id == item.id && pro.id == options.id){
                            pro.isTop = item.isTop;
                        }
                        return pro.id === item.id;
                    }));
                });
                this._$setListInCache(this._$getListKey(progroup.id), newList);
                // 触发 listchange 事件
                v._$dispatchEvent(
                    this.constructor, 'listchange', {
                        data: newList,
                        action: evt.action,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    };

    /**
     * 根据项目 id 查项目组, 同步方法
     * @param {String} pid - 项目id
     */
    pro._$getProgroupByProId = function (pid) {
        var project = this._$getItemInCache(pid);
        var pgId = project.progroupId;
        var _pgCache = pgCache._$$CacheProGroup._$allocate();
        var progroup = _pgCache._$getItemInCache(pgId);
        _pgCache._$recycle();
        return progroup;
    };
    /**
     * 根据项目 id 查项目组 同步方法(可配置是否包含当前项目，公共资源库)
     * @param {String} pid - 项目id
     * @param {Boolean} hasCurrent - 是否包含当前项目
     * @param {Boolean} hasPublic - 是否包含公共资源库
     */
    pro._$getProgroupByProId2 = function (pid, hasCurrent, hasPublic) {
        if (hasCurrent === undefined) { //默认包含当前项目，hasCurrent为true
            hasCurrent = true;
        }
        if (hasPublic === undefined) {//默认包含当前项目，hasCurrent为true
            hasPublic = true;
        }
        var progroup = this._$getProgroupByProId(pid);
        var result = _u._$merge({}, progroup);
        result.projects = [];
        progroup.projects.forEach(function (item) {
            if ((item.type === dbConst.PRO_TYP_COMMON && hasPublic) || item.type === dbConst.PRO_TYP_NORMAL && (hasCurrent || item.id !== pid)) {
                result.projects.push(item);
            }
        });
        return result;
    };


    /**
     * 根据项目 id, 判断是否为项目的创建者
     * @param {String} pid - 项目id
     * @return {Boolean} 是否为创建者
     */
    pro._$isCreator = function (pid) {
        var project = this._$getItemInCache(pid);
        if (!project) {
            return false;
        }
        var userId = userCache._$$CacheUser._$allocate()._$getUserInCache().id;
        return project.creatorId === userId;
    };
    /**
     * 判断项目是否为公共资源库
     * @param {Number} id - 项目id
     * @return {Boolean} 是否为公共资源库
     */
    pro._$isPublic = function (id) {
        var project = this._$getItemInCache(id);
        return project && project.type === dbConst.PRO_TYP_COMMON;
    }
    /**
     * 根据项目id, 获取它所属的项目组中的公共项目
     * @param {Number} id - 项目id
     * @return {Object} 公共资源库
     */
    pro._$getPublicById = function (id) {
        var project = this._$getItemInCache(id);
        if (project.type === dbConst.PRO_TYP_COMMON) {
            return project;
        } else {
            var list = this._$getListInCache(this._$getListKey(project.progroupId));
            return list.find(function (item) {
                return item.type === dbConst.PRO_TYP_COMMON;
            });
        }
    };
    /**
     * 更换项目创建者
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 项目 id
     * @property {Number} options.toId - 要移交的用户id
     * @success dispatch event: onchangecreator
     */
    pro._$changeCreator = function (options) {
        var existItem = this._$getItemInCache(options.id);
        if (!existItem) return;
        this.__doAction({
            data: {
                toId: options.data.toId
            },
            method: 'PUT',
            action: 'changecreator',
            onload: function (evt) {

                //修改项目组里成员信息
                //项目移交之后，角色变成了普通开发者
                _u._$merge(existItem,evt.data);

                this._$dispatchEvent("onchangecreator",evt);

                v._$dispatchEvent(this.constructor,"listchange",options);
            }._$bind(this),
            id: options.id
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','e8507450a35f1adad6e9dae810fd545a','29f4b2dc96ca931edfeb9264ffe3e954','993671841dcf289096c7171d53130309');
I$('e8507450a35f1adad6e9dae810fd545a',function (_k, u, v, _c, baseCache, proCache, userCache, db,_p, pro) {
    _p._$$CacheProGroup = _k._$klass();
    _p._$cacheKey = 'progroups'; // 项目组列表
    _p._$searchCacheKey = 'pg-searchlist'; // 搜索项目组列表
    pro = _p._$$CacheProGroup._$extend(baseCache._$$Cache);

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__cacheKey = _p._$cacheKey;
        this.__super(options);
    };

    /**
     * 新建项目组
     * @param {Object} options - 参数对象
     * @property {String} options.data.name - 新的项目组名称
     * @property {String} [options.data.description=''] - 新的项目组描述信息
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!u._$isString(options.data.name) || !options.data.name.trim()) {
            // console.error('请输入有效的项目组名称');
            return;
        }
        var onload = options.onload;
        options.onload = function (progroup) {
            // 新创建项目组后, 要把默认自带的 公共资源库 加到项目的 cache 中去
            this._setProjectListToCache([progroup]);
            onload(progroup);
        }.bind(this);
        this.__super(options);
    };

    pro.__isGetSearchList = function (options) {
        return options.ext && options.ext.isSearch;
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        if (this.__isGetSearchList(options)) {
            var url = this.__getUrl(options);
            this.__sendRequest(url, options);
            return ;
        }
        var onload = options.onload;
        options.onload = function (progroups) {
            this._setProjectListToCache(progroups);
            onload(progroups);
        }.bind(this);
        this.__super(options);
    };

    pro._$getList = function (options) {
        if (options.ext && options.ext.needFlush) {
            this._$clearListInCache(options.key);
        }
        this.__super(options);
    };

    /**
     * 将项目数据数据设置到项目的 cache 中去
     * @param {Object} progroups - 项目组列表
     */
    pro._setProjectListToCache = function (progroups) {
        var _proCache = proCache._$$CachePro._$allocate();
        progroups.forEach(function (progroup) {
            // 设置项目的isTop 属性
            var projectTopList = progroup.projectTopList.split(',');
            progroup.projects.forEach(function (project) {
                project.isTop = projectTopList.indexOf(project.id) != -1 ? 1 : 0;
            });
            // 存到缓存中
            _proCache._$setListInCache(_proCache._$getListKey(progroup.id), progroup.projects);
            // todo: delete progroup.projects;
        });
    };

    /**
     * 更新项目组
     * @param {Object} options - 参数对象
     * @property {Number} options.data.id - 资源 id
     * 支持更新的字段有(需要更新哪个字段就传哪个字段):
     * @property {String} [options.data.name] - 项目组名称
     * @property {String} [options.data.description] - 项目组描述
     * @property {String} [options.data.verification] - 项目组验证方式
     * @property {String} [options.data.verificationRole] - 项目组的自动通过角色
     * @property {String} [options.data.toolSpecWebId] - 项目组使用的WEB工程规范id
     * @property {String} [options.data.toolSpecAosId] - 项目组使用的AOS工程规范id
     * @property {String} [options.data.toolSpecIosId] - 项目组使用的IOS工程规范id
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        switch (options.key) {
            // 列表
            case _p._$cacheKey:
                url = '/api/progroups/' + (options.id || '');
                if (options.action) {
                    url += '?' + options.action;
                }
                break;

            case _p._$searchCacheKey:
                url = '/api/progroups?search';
                break;
            default:
                break;
        }
        return url;
    };

    /**
     * 更换项目组创建者
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 项目组 id
     * @property {Number} options.toId - 要移交的用户id
     * @success dispatch event: onchangecreator
     */
    pro._$changeCreator = function (options) {
        var existItem = this._$getItemInCache(options.id);
        if (!existItem) return;
        this.__doAction({
            data: {
                toId: options.data.toId
            },
            method: 'PUT',
            action: 'changecreator',
            onload: function (evt) {

                //修改项目组里成员信息
                //项目移交之后，角色变成了普通开发者
                u._$merge(existItem,evt.data,{role:"normal"});

                this._$dispatchEvent("onchangecreator",evt);

                v._$dispatchEvent(this.constructor,"listchange");
            }._$bind(this),
            id: options.id
        });
    };

    /**
     * 退出项目组
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 项目组 id
     * @success dispatch event: onquit, listchange
     */
    pro._$quit = function (options) {
        var existItem = this._$getItemInCache(options.id);
        if (!existItem) return;
        this.__doAction({
            data: {
                id: options.id
            },
            method: 'PUT',
            action: 'quit',
            onload: function (evt) {
                //从我的项目组缓存里面删除该项目组
                this.__doRemoveItemFromList(_p._$cacheKey,options.id);

                this._$dispatchEvent("onquit",evt);
                v._$dispatchEvent(this.constructor,"listchange");
            }._$bind(this),
            id: options.id
        });
    };

    /**
     * 设置项目组成员, 前端需要将所有成员信息一起发给后端
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 项目组 id
     * @property {Array} options.admins - 操作的用户列表
     * @success dispatch event: onsetmembers
     */
    pro._$setMembers = function (options) {
        var existItem = this._$getItemInCache(options.id);
        if (!existItem) return;
        this.__doAction({
            data: {
                users:options.users
            },
            method: 'PUT',
            action: 'setmembers',
            onload: 'onsetmembers',
            updateItem: true,
            id: options.id,
            ext: options.ext
        });
    };

    /**
     * 项目组排序
     * @param {Object} options - 参数对象
     * @property {Array|Number} options.ids 项目组的 id 数组
     * @property {Number} options.type - 排序方式
     * @success dispatch event: onsort, onlistchange
     */
    pro._$sort = function (options) {
        this.__doAction({
            ext: options.ext,
            key: options.key,
            data: {
                ids: options.ids,
                type: options.type
            },
            method: 'PUT',
            action: 'sort',
            updateListOrder: true,
            triggerListchange: true,
            onload: function (evt) {
                // 更新user上的项目组排序方式
                var user = userCache._$$CacheUser._$allocate()._$getUserInCache();
                user.progroupOrder = options.type;
                this._$dispatchEvent('onsort', evt);
            }.bind(this)
        });
    };

    /**
     * 项目组置顶
     * @param {Object} options - 参数对象
     * @property {Array|Number} options.id -  项目组 id
     * @property {Boolean} options.v - true 时为置顶, false 时为取消置顶
     * @success dispatch event: onlistchange
     */
    pro._$stick = function (options) {
        this.__doAction({
            data: {
                v: options.v
            },
            ext: options.ext,
            key: options.key,
            method: 'PUT',
            action: 'stick',
            id: options.id,
            onload: function (evt) {
                // 更新 user 对象中的 progroupTopList
                var user = userCache._$$CacheUser._$allocate()._$getUserInCache();
                var progroupTopList = evt.data.filter(function (item) {
                    return item.isTop;
                });
                user.progroupTopList = progroupTopList.map(function (item) {
                    return item.id;
                }).join(',');
                // 调整缓存中的项目组顺序
                var list = this._$getListInCache(this.__cacheKey);
                var newList = [];
                // evt.data 的顺序后端保证是正确的, 即置顶的会在最前面
                evt.data.forEach(function (item) {
                    newList.push(list.find(function (pg) {
                        return pg.id === item.id;
                    }));
                });
                this._$setListInCache(this.__cacheKey, newList);
                // 触发 listchange 事件
                v._$dispatchEvent(
                    this.constructor, 'listchange', {
                        data: newList,
                        action: evt.action,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    };

    /**
     * 获取某个项目组下的成员, 用于 select2 组件的 source 数据源
     * @param {Number} pgId - 项目组id
     * @return {Array} - 成员列表
     */
    pro._$getRespoSelectSource = function (pgId) {
        var progroup = this._$getItemInCache(pgId);
        var members = [progroup.creator].concat(
            progroup.admins, progroup.developers, progroup.testers
        );
        return members.map(function (m) {
            // 外部账号的 realname 字段可能为空
            return {
                id: m.id,
                name: m.realname || m.username,
                namePinyin: m.realnamePinyin,
                title: m.realname ? (m.realname + '(' + m.username + ')') : m.username
            }
        });
    };

    /**
     * 获取当前登录用户在某个项目组中的角色
     * @param  {String} pgId -  项目组id
     * @return {String} 角色名
     */
    pro._$getRole = function (pgId) {
        var progroup = this._$getItemInCache(pgId);
        if (!progroup) {
            return 'others';
        }
        // 后端创建成功后, 并没有返回 admins 字段
        var user = userCache._$$CacheUser._$allocate();
        var userId = user._$getUserInCache().id;  //当前登录用户ID
        user._$recycle();
        if (userId == progroup.creator.id) {
            return 'creator';
        }
        // 查看自己不可见的项目组
        if (!progroup.hasOwnProperty('admins')) {
            return 'others';
        }
        var userType = null;
        var found = null;
        var handler = function (users, type) {
            if (!userType) {
                found = users.find(function (item) {
                    return item.id === userId;
                });
                if (found) {
                    userType = type;
                }
            }
        };
        handler(progroup.admins, 'administrator');
        handler(progroup.developers, 'developer');
        handler(progroup.testers, 'tester');
        handler(progroup.observers, 'observer');
        return userType;
    };

    /**
     * 获取当前登录用户在某个项目组中的权限
     * @param  {String} pgId -  项目组id
     * @return {Object} 权限
     */
    pro._$getPrivilege = function (pgId) {
        var userRole = this._$getRole(pgId);
        return {
            isOthers: userRole === 'others',
            isObserver: userRole === 'observer',
            isTester: userRole === 'tester',
            isDev: userRole === 'developer',
            isCreator: userRole === 'creator',
            isAdmin: userRole === 'administrator',
            isInGroup: userRole !== 'others',
            isAdminOrCreator: /^(creator|administrator)$/.test(userRole)
        }
    };
    /**
     * 获取当前用户的所有用户组及项目（不包括公共项目）
     * @return {Array} 项目组
     */
    pro._$getGroupsWithoutPublic = function () {
        var groups = this._$getListInCache(this.__cacheKey), result = [];
        groups.forEach(function (group) {
            var projects = [];
            group.projects.forEach(function (project) {
                if (project.type === db.PRO_TYP_NORMAL) {
                    projects.push(project);
                }
            });
            if (projects.length) {
                group = u._$merge({}, group);
                group.projects = projects;
                result.push(group);
            }
        });
        return result;
    };
    /**
     * 项目组锁定/解锁
     * @param {Object} options - 参数对象
     * @property {Array|Number} options.id -  项目组 id
     * @property {Boolean} options.v - true 时为锁定, false 时为解锁
     * @success dispatch event: onlistchange
     */
    pro._$lock = function (options) {
        this.__doAction({
            data: {
                v: options.v
            },
            ext: options.ext,
            key: options.key,
            method: 'PUT',
            action: 'lock',
            id: options.id,
            onload: function (evt) {
                var item = this._$getItemInCache(options.id);
                item.isLock = evt.data.isLock;
                // 触发 listchange 事件
                v._$dispatchEvent(
                    this.constructor, 'update', {
                        data: item,
                        action: evt.action,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    }
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','09437bf7199eb808a35a38e5178e5151','29f4b2dc96ca931edfeb9264ffe3e954','993671841dcf289096c7171d53130309');
I$('1df06fa53683579bcb9b2b4b07c5c812',function (_k, _u, _v, _c, _d, dbConst, _p, pro) {
    _p._$$CachePGApplying = _k._$klass();
    _p._$cacheKey = 'pg-applying';
    _p._$cacheKeyVerifying = 'pg-applying-verifying';
    pro = _p._$$CachePGApplying._$extend(_d._$$Cache);

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    }

    /**
     * 申请加入某个项目组
     * @param {Object} options - 参数对象
     * @property {String} options.data.pgId - 要申请的项目组标识
     * @property {String} [options.data.message=''] - 申请消息
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!options.data.pgId) {
            // console.error('请输入有效的项目组标识');
            return;
        }
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key === _p._$cacheKeyVerifying) {
            url = '/api/applying/?verifying';
        } else if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/applying/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    }

    /**
     * 申请加入项目组的审批验证
     * @param {Object} options - 参数对象
     * @property {Boolean} options.v - true 时为通过, false 时为拒绝
     * @property {Boolean} options.id - 申请记录标识
     * @property {String} [options.role=""] - 通过的角色, options.v 为 true 有效
     * @property {String} [options.message=""] - 拒绝的消息, options.v 为 false 有效
     * @success dispatch event: onverify
     */
    pro._$verify = function (options) {
        var existItem = this._$getItemInCache(options.id);
        if (!existItem) return;
        var data = {
            v: options.v
        };
        if (data.v) {
            data.role = options.role;
        } else {
            data.message = options.message;
        }
        this.__doAction({
            key: options.key,
            data: data,
            method: 'PUT',
            action: 'verify',
            updateItem: true,
            triggerListchange: true,
            onload: 'onverify',
            id: options.id,
            ext: options.ext
        });
    };

    /**
     * 判断某个项目组是否正在申请中
     * @param  {String} pgId -  项目组id
     * @return {Object} 权限
     */
    pro._$isApplying = function (pgId) {
        var list = this._$getListInCache(this.__cacheKey);
        var found = list.find(function (item) {
            return item.applyingProGroup.id === pgId && item.verifyResult === dbConst.PRG_ROP_NONE;
        });
        return !!found;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','993671841dcf289096c7171d53130309');
I$('1bbc1cf173fb9db0d298605b7123f682',function (NEJ,_k,_e,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 标签切换控件封装
     * 
     * 结构举例
     * ```html
     * <div id="box">
     *   <a href="#" data-abc="111">1</a>
     *   <a href="#" data-abc="222">2</a>
     *   <a href="#" data-abc="333">3</a>
     *   <a href="#" data-abc="444">4</a>
     * </div>
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/tab/tab.view'
     * ],function(_t){
     *     // instance
     *     var _tv = _t._$$TabView._$allocate({
     *         dataset:'abc',
     *         list:_e._$getChildren('box'),
     *         oncheck:function(_event){
     *             _event.matched = _event.target.indexOf(_event.source)>=0;
     *         }
     *     });
     *     // check match
     *     _tv._$match('333');
     * });
     * ```
     * 
     * @class    module:util/tab/view._$$TabView
     * @extends  module:util/event._$$EventTarget
     * @param    {Object} config   - 可选配置参数
     * @property {Array}  list     - 标签项列表
     * @property {Number} dataset  - 属性名称，默认为id
     * @property {String} selected - 选中样式名，默认为js-selected
     */
    /** 
     * 标签值验证事件
     * 
     * @event    module:util/tab/view._$$TabView#oncheck
     * @param    {Object}  event   - 事件信息
     * @property {Number}  source  - 原始值
     * @property {Number}  target  - 目标值
     * @property {Boolean} matched - 是否匹配
     */
    _p._$$TabView = _k._$klass();
    _pro = _p._$$TabView._$extend(_t._$$EventTarget);
    /**
     * 控件重置
     *
     * @protected
     * @method module:util/tab/view._$$TabView#__reset
     * @param  {Object} arg0 - 配置信息
     * @return {Void}
     */
    _pro.__reset = (function(){
        // check equal
        var _doMatchEq = function(_event){
            _event.matched = _event.source==_event.target;
        };
        return function(_options){
            _options.oncheck = 
                _options.oncheck||_doMatchEq;
            this.__super(_options);
            this.__list = _options.list;
            this.__name = _options.dataset||'id';
            this.__selected = _options.selected||'js-selected';
        };
    })();
    /**
     * 验证匹配情况
     *
     * @method module:util/tab/view._$$TabView#_$match
     * @param  {String} arg0 - 待匹配值
     * @return {Node}          匹配的节点
     */
    _pro._$match = function(_value){
        var _element,
            _event = {target:_value};
        _u._$forEach(
            this.__list,
            function(_node){
                delete _event.matched;
                _event.source = _e._$dataset(_node,this.__name);
                this._$dispatchEvent('oncheck',_event);
                if (!_event.matched){
                    _e._$delClassName(_node,this.__selected);
                }else{
                    _element = _node;
                    _e._$addClassName(_node,this.__selected);
                }
            },this
        );
        return _element;
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0');
!function(win, doc, undefined) {
  // __nes命名空间__
  var nes = function(node, context){return all(node, context);},
    locals = {}; //存放local属性...被global坑死了

  // 常用属性local化
  var ap = Array.prototype,
    op = Object.prototype,
    sp = String.prototype,
    fp = Function.prototype,
    slice = ap.slice,
    body = doc.body,
    testNode = doc.createElement("div"),
    // 1. Helper(助手函数)
    // =================================
    // 将类数组(如Nodelist、Argument)变为数组
    toArray = function(arr) {
      return slice.call(arr);
    },
    // 够用的短小类型判断
    typeOf = function(o) {
      return o == null ? String(o) : op.toString.call(o).slice(8, -1).toLowerCase();
    },
    // 够用的简单对象扩展
    extend = function(o1, o2, override) {
      for (var i in o2) {
        if (o1[i] == null || override) o1[i] = o2[i];
      }
    },
    // 最简单先进先出缓存队列, max设置最大缓存长度, 为了不必要重复parse
    // nes会多次用到这个方法创建cache
    createCache = function(max) {
      var keys = [],
        cache = {};
      return {
        set: function(key, value) {
          if (keys.length > this.length) {
            delete cache[keys.shift()];
          }
          cache[key] = value;
          keys.push(key);
          return value;
        },
        get: function(key) {
          if (key === undefined) return cache;
          return cache[key];
        },
        length: max,
        len: function() {
          return keys.length;
        }
      };
    },
    // 让setter型函数fn支持object型的参数
    // 即支持`set(name:value)`
    // 也支持`set({name1:value1,name2:value2})`
    autoSet = function(fn) {
      return function(key, value) {
        if (typeOf(key) == "object") {
          for (var i in key) {
            fn.call(this, i, key[i]);
          }
        } else {
          fn.call(this, key, value);
        }
        return this;
      };
    },
    assert = function(fn) {
      try {
        return fn();
      } catch (e) {
        return false;
      } finally {
        testNode = document.createElement("div");
      }
    };
  // Fixed: toArray 低于IE8的 Nodelist无法使用slice获得array
  try {
    slice.call(doc.getElementsByTagName("body"));
  } catch (e) {
    toArray = function(arr) {
      var result = [],
        len = arr.length;
      for (var i = 0; i < len; i++) {
        result.push(arr[i]);
      }
      return result;
    };
  }

  // 扩展ES5 Native支持的函数，坑爹的远古浏览器
  //es5 trim
  var trimReg = /^\s+|\s+$/g;
  sp.trim = sp.trim ||
  function() {
    return this.replace(trimReg, "");
  };

  //es5 bind
  fp.bind = fp.bind ||
  function(context, args) {
    args = slice.call(arguments, 1);
    var fn = this;
    return function() {
      return fn.apply(context, args.concat(slice.call(arguments)));
    };
  };
  //es5 Array indexOf
  ap.indexOf = ap.indexOf ||
  function(a) {
    for (var i = 0, len = this.length; i < len; i++) {
      if (a === this[i]) return i;
    }
    return -1;
  };

  // Parser 相关
  var
  //抽离出字匹配数目
  ignoredRef = /\(\?\!|\(\?\:/,
    extractRefNum = function(regStr) {
      var left = 0,
        right = 0,
        len = regStr.length,
        ignored = regStr.split(ignoredRef).length - 1; //忽略非捕获匹配
      for (; len--;) {
        var letter = regStr.charAt(len);
        if (len === 0 || regStr.charAt(len - 1) !== "\\") { //不包括转义括号
          if (letter === "(") left++;
          if (letter === ")") right++;
        }
      }
      if (left !== right) throw regStr + "中的括号不匹配";
      else return left - ignored;
    },
    //前向引用 如\1 \12 等在TRUNK合并时要做处理
    refIndexReg = /\\(\d+)/g,
    extractRefIndex = function(regStr, curIndex) {
      return regStr;
      // .replace(refIndexReg, function(a, b) {
      //   return "\\" + (parseInt(b, 10) + curIndex);
      // });
    },
    // // 生成默认的action，这个会将匹配到的参数推入一个同名的数组内
    // createAction = function(name) {
    //   return function(all) {
    //     var parsed = this.parsed,
    //       current = parsed[name] || (parsed[name] = [])
    //       current.push(slice.call(arguments))
    //   }
    // },
    // Object.keys 规则排序时的调用方法
    keys = Object.keys ||
  function(obj) {
    var result = [];
    for (var prop in obj) {
      if (obj.hasOwnProperty(prop)) result.push(prop);
    }
    return result;
  },
  // 将规则中的reg中的macro替换掉
  cleanRule = function(rule) {
    var reg = rule.reg;
    //如果已经是regexp了就转为string
    if (typeOf(reg) === "regexp") reg = reg.toString().slice(1, -1);
    //将macro替换
    rule.regexp = reg.replace(replaceReg, function(a, b) {
      if (b in macros) return macros[b];
      else throw new Error('can"t replace undefined macros:' + b);
    });
    return rule;
  }, cleanRules = function(rules) {
    for (var i in rules) {
      if (rules.hasOwnProperty(i)) cleanRule(rules[i]);
    }
    return rules;
  };


  // ##2. Parser
  // 
  // 为何要抽象成一个类? 其实这里只用到了一个实例
  // 事实上这个简单Parser还帮我实现了命令行参数解析，
  // zen-coding的实现等等, 它可以帮助实现基于正则式的
  // 字符串解析


  function Parser(opts) {
    opts = opts || {};
    if (opts.macros) this._macros = opts.macros;
    this._links = {}; //symbol link map
    this._rules = {}; //symbol def
    this.TRUNK = null;
    this.cache = createCache(opts.maxCache || 200);
    this.cache.set("", [[] ]); //输入空字符串返回空数组
  }

  extend(Parser.prototype, {
    // ### 解析输入字符串input、返回action定义的data数据
    parse: function(input) {
      // 清理input数据、因为parsed数据最终会被缓存，
      // 我们要尽量让相同的选择器只对应一份parsed数据
      input = clean(input);
      // 先检查缓存中是否有数据
      if (parsed = this.cache.get(input)) return parsed;
      // 如果没有: 初始化参数
      var parsed = this.parsed = [
        [null]
      ];
      var remain = this.input = input;
      var TRUNK = this.TRUNK;
      var prevRemain;
        // 将remain进行this._process这里每匹配一个字符串都会进行一次reduce
      while (prevRemain != (remain = remain.replace(TRUNK, this._process.bind(this)))) {
        prevRemain = remain;
      }
      // 如果没有被解析完 证明选择器字符串有不能被解析的部分
      if (remain !== '') this.error(remain);
      // 返回数据并推入cache
      return this.cache.set(input, parsed);
    },
    // ###添加新规则 : 
    // 在nes中你可以想象成添加一个与Id、className、pesudo等价简单选择符
    on: function(rules) {
      if (typeOf(rules) === "string") { //当不是hash传入时
        var tmp = {};
        tmp[rules] = arguments[1];
        rules = tmp;
      }
      // 可以同时接受object型或者key, value对的参数
      for (var i in rules) {
        var rule = rules[i];
        if (typeOf(rule) !== "object") {
          rule = {
            regexp: rule
          };
        }
        var reg = rule.regexp;
        if (typeOf(reg) === "regexp") {
          rule.regexp = reg.toString().slice(1, -1);
        }
        // 初始化order
        if (rule.order === undefined) rule.order = 1;
        this._rules[i] = rule;
      }
      // 每进行一次新规则监听，都重新组装一次
      this.setup();
      return this;
    },
    // ###__åˆ é™¤è§„åˆ™__ :
    // åˆ é™¤å¯¹åº”è§„åˆ™, å³nesçš„è§„åˆ™éƒ½æ˜¯åœ¨è¿è¡Œæ—¶å¯åˆ å¯å¢žçš„
    off: function(name) {
      if (typeOf(name) === "array") {
        for (var i = name.length; i--;) {
          this.off(name[i]);
        }
      } else {
        if (this._rules[name]) {
          delete this._rules[name];
        }
      }
      return this;
    },
    // èŽ·å¾—å½“å‰è§£æžä½ç½®æ‰€åœ¨çš„datumï¼Œä½ åªéœ€è¦åœ¨è¿™ä¸ªdatumä¸­å¡žæ•°æ®å³å¯
    current: function() {
      var data = this.parsed;
      var piece = data[data.length - 1],
        len = piece.length;
      return piece[len - 1] || (piece[len - 1] = {
        tag: "*"
      });
    },
    error: function(info) {
      throw Error("è¾“å…¥  " + this.input + "  å«æœ‰æœªè¯†åˆ«è¯­å¥:" + info || "");
    },

    clone: function(parser) {
      return new Parser().on(this._rules);
    },
    // __`this.parser`__çš„ä¾èµ–æ–¹æ³•ï¼Œ
    // å³éåŽ†linksæ£€æŸ¥æ˜¯å¦æœ‰å­åŒ¹é…æ»¡è¶³å…³ç³»ï¼Œ
    // æœ‰åˆ™æŽ¨å…¥å¯¹åº”çš„actionæ•°ç»„,
    // æ³¨æ„ç”±äºŽå…¶æ˜¯æ˜¯replaceæ–¹æ³•çš„è°ƒç”¨ï¼Œæ¯æ¬¡éƒ½è¦è¿”å›ž""å®Œæˆ
    // reduceæ“ä½œ
    _process: function() {
      var links = this._links,
        rules = this._rules,
        args = slice.call(arguments);

        for (var i in links) {
          var link = links[i],
            retain = link[1],
            index = parseInt(link[0]);
            if (args[index] && (rule = rules[i])) {
              rule.action.apply(this, args.slice(index, index + retain));
              return "";
            }
        }
      return "";
    },
    // ç»„è£…
    setup: function() {
      cleanRules(this._rules);
      var curIndex = 1,
        //å½“å‰ä¸‹æ ‡
        splits = [],
        rules = this._rules,
        links = this._links,
        ruleNames = keys(rules).sort(function(a, b) {
          return rules[a].order >= rules[b].order;
        }),
        len = ruleNames.length;

      for (; len--;) {
        var i = ruleNames[len],
          rule = rules[i],
          retain = extractRefNum(rule.regexp) + 1; // 1å°±æ˜¯é‚£ä¸ªall
        if (rule.filter && !filters[i]) {
          filters[i] = rule.filter;
        } //å°†filterè½¬ç§»åˆ°filtersä¸‹
        links[i] = [curIndex, retain]; //åˆ†åˆ«æ˜¯ruleåï¼Œå‚æ•°æ•°é‡
        var regexp = extractRefIndex(rule.regexp, curIndex - 1);
        curIndex += retain;
        splits.push(regexp);
      }
      this.TRUNK = new RegExp("^(?:(" + splits.join(")|(") + "))");
      return this;
    }
  });



  // ### parseçš„è§„åˆ™å®šä¹‰éƒ¨åˆ†å¼€å§‹
  // ä¸€äº›ç”¨åˆ°çš„æ­£åˆ™å¼ï¼Œä½†æ˜¯åˆä¸å±žäºŽparserçš„è§„åˆ™ç»„æˆ
  var
  replaceReg = /\{\{([^\}]*)\}\}/g,
    //æ›¿æ¢ruleä¸­çš„macro
    nthValueReg = /^(?:(\d+)|([+-]?\d*)?n([+-]\d+)?)$/,
    // nthä¼ªç±»çš„valueè§„åˆ™
    posPesudoReg = /^(nth)[\w-]*(-of-type|-child)/,
    //åˆ¤æ–­éœ€è¦pos
    // ç¬¬ä¸€ä¸ªcache ç”¨æ¥è£…è½½nthä¼ªç±»ä¸­çš„å‚æ•°è§£æžåŽçš„æ•°æ®
    // å¦‚nth-childã€nth-of-typeç­‰8ä¸ªä¼ªç±»
    nthCache = createCache(100),
    // æå–nthValueä¸­çš„æœ‰ç”¨ä¿¡æ¯ æ¯”å¦‚an + b æˆ‘ä»¬éœ€è¦æå–å‡ºaä»¥åŠ,bå¹¶å¯¹é¢å¤–æƒ…å†µå¦‚ç¼ºå°‘aå‚æ•°æˆ–bå‚æ•°
    // æˆ–è€…æœ‰aã€bå°äºŽ0è¿™äº›æƒ…å†µä½œç»Ÿä¸€å¤„ç†ï¼Œè¿”å›žfindé€‚åˆä½¿ç”¨çš„æ•°æ®
    extractNthValue = function(param) {
      var step, start, res;
      //å¦‚æžœæ— å‚æ•° å½“æˆæ˜¯èŽ·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
      if (!param || !(param = param.replace(/\s+/g, ""))) {
        return {
          start: 1,
          step: 0
        };
      }
      if (res = nthCache.get(param)) return res;
      // å¯¹even oddç­‰è½¬åŒ–ä¸ºæ ‡å‡†çš„aï¼Œbç»„åˆ(å³stepä¸Žstart)
      if (param == "even") {
        start = 2;
        step = 2;
      } else if (param == "odd") {
        step = 2;
        start = 1;
      } else {
        res = param.match(nthValueReg);
        // å¯¹é”™è¯¯çš„nthå‚æ•°æŠ›å‡ºé”™è¯¯
        if (!res) step = null; // æ— è®ºå…¶ä»–å‚æ•°ï¼Œå¦‚æžœstepä¸ºnullï¼Œåˆ™æ°¸è¿œä¸ºfalse
        else {
          if (res[1]) {
            step = 0;
            start = parseInt(res[1]);
          } else {
            if (res[2] == "-") res[2] = "-1";
            step = res[2] ? parseInt(res[2]) : 1;
            start = res[3] ? parseInt(res[3]) : 0;
          }
        }
      }
      if (start < 1) {
        if (step < 1) {
          step = null; //æ ‡å¿—false
        } else {
          start = -(-start) % step + step;
        }
      }
      return nthCache.set(param, {
        start: start,
        step: step
      });
    };

    // ### parse Rule ç›¸å…³
    // äº†è§£bisonç­‰è§£æžå™¨ç”Ÿæˆçš„åŒå­¦å¯ä»¥æŠŠè¿™éƒ¨åˆ†çœ‹æˆæ˜¯è¯æ³•ä¸Žè¯­æ³•å®šä¹‰çš„æ‚ç³…
    // å¾ˆæ··ä¹±ä¹Ÿå¾ˆä¸æ ‡å‡†ï¼Œä½†å¯¹äºŽé€‰æ‹©å™¨è¿™ç§æœ€ç®€å•çš„DSLå…¶å®žå¤Ÿç”¨ï¼Œå¹¶ä¸”æœ‰äº†å¥‡æ•ˆ
    // æ•´ä¸ªParseræ ¹æ®rulesåŠ¨æ€äº§ç”Ÿ(å³å¯åœ¨ä½¿ç”¨æ—¶å‘ç”Ÿæ”¹å˜)
    // å…·ä½“çš„æµç¨‹æ˜¯ä¸‹é¢çš„ruleså¯¹è±¡å®šä¹‰äº†ä¸€ç»„è¯­æ³•(è¯æ³•?)ruleâ€”â€”å¦‚attributeï¼Œ
    // ä½ å¯ä»¥æŠŠæ¯ä¸ªruleä¸­çš„regæƒ³è±¡æˆä¸€ä¸ªtoken(word?),è¿™äº›tokenå¯èƒ½ä¼šæœ‰{{word}}è¿™ç§å ä½ç¬¦
    // å ä½ç¬¦é¦–å…ˆä¼šè¢«macrosä¸­å¯¹åº”çš„macroæ›¿æ¢ï¼Œç„¶åŽè¿™äº›tokenä¼šè¢«ç»„è£…æˆä¸€ä¸ªå¤§ç‰ˆçš„Regexpï¼Œå³ä¸Šé¢çš„
    // Trunkå˜é‡,è¿™ä¸ªè¿‡ç¨‹æ²¡ä»€ä¹ˆç‰¹æ®Šï¼Œä¸€èˆ¬æ¯”è¾ƒä¼˜ç§€çš„é€‰æ‹©å™¨éƒ½æ˜¯åŸºäºŽè¿™ä¸ªæ–¹æ³•ã€‚ åœ¨nesä¸­,æœ€ç»ˆçš„Trunkå¯èƒ½æ˜¯
    // è¿™æ ·çš„:
    //
    // `/(\s*,\s*)|(#([\w\u4e00-\u9fbf-]+))|(\*|\w+)|(\.([\w\u4e00-\u9fbf-]+))|
    // (:([\w\u4e00-\u9fbf-]+)(?:\(([^\(\)]*|(?:\([^\)]+\)|[^\(\)]*)+)\))?)|
    // (\[([\w\u4e00-\u9fbf-]+)(?:([*^$|~!]?=)['"]?((?:[\w\u4e00-\u9fbf-]||\s)+)['"]?)?\])|(::([\w\u4e00-\u9fbf-]+))
    // |([>\s+~&%](?!=))|(\s*\{\s*(\d*),(\-?\d*)\s*\}\s*)/g`
    // 
    // çœ‹åˆ°ä¸Šé¢é‚£é•¿ä¸²ï¼Œä½ å¤§æ¦‚ç†è§£äº†å°†regexpæŒ‰è¯æ³•åˆ†å¼€è¿™æ ·åšçš„ç¬¬ä¸€ä¸ªåŽŸå›  : __ç»´æŠ¤__. 
    // ç¬¬äºŒä¸ªåŽŸå› å°±æ˜¯: __æ•ˆçŽ‡__  ä¸€æ¬¡å¤§åž‹æ­£åˆ™çš„è°ƒç”¨æ—¶é—´è¦è¿œä½ŽäºŽå¤šæ¬¡å°åž‹æ­£åˆ™çš„åŒ¹é…(å‰æå®ƒä»¬åšåŒæ ·è§„æ¨¡çš„åŒ¹é…)
  var
  // ä¸€äº›macro
  macros = {
    split: "\\s*,\\s*",
    // åˆ†éš”ç¬¦
    operator: "[*^$|~!]?=",
    // å±žæ€§æ“ä½œç¬¦ å¦‚= ã€!=
    combo: "[>\\s+~](?!=)",
    // è¿žæŽ¥ç¬¦ å¦‚ > ~ 
    word: "[\\\\\\w\\u00A1-\\uFFFF-]"
  },
    // è¯­æ³•è§„åˆ™å®šä¹‰
    rules = {
      split: {
        // åˆ†éš”ç¬¦ å¦‚ ï¼Œ
        reg: "{{split}}",
        action: function(all) {
          this.parsed.push([null]);
        },
        order: 0
      },
      // id å¦‚ #home
      id: {
        reg: "#({{word}}+)",
        action: function(all, id) {
          this.current().id = id;
        }
      },
      // èŠ‚ç‚¹ç±»åž‹é€‰æ‹©ç¬¦ å¦‚ div
      tag: {
        reg: "\\*|[a-zA-Z-]\\w*",
        // å•çº¯çš„æ·»åŠ åˆ°
        action: function(tag) {
          this.current().tag = tag.toLowerCase();
        }
      },
      // ç±»é€‰æ‹©ç¬¦ å¦‚ .m-home
      classList: {
        reg: "\\.({{word}}+)",
        action: function(all, className) {
          var current = this.current(),
            classList = current.classList || (current.classList = []);
            classList.push(className);
        }
      },
      // ä¼ªç±»é€‰æ‹©ç¬¦ å¦‚ :nth-child(3n+4)
      pesudos: {
        reg: ":({{word}}+)" + //ä¼ªç±»å
        "(?:\\(" + //æ‹¬å·å¼€å§‹
        "([^\\(\\)]*" + //ç¬¬ä¸€ç§æ— æ‹¬å·
        "|(?:" + //æœ‰æ‹¬å·(å³ä¼ªç±»ä¸­ä»æœ‰ä¼ªç±»å¹¶ä¸”æ˜¯å¸¦æ‹¬å·çš„)
        "\\([^\\)]+\\)" + //æ‹¬å·éƒ¨åˆ†
        "|[^\\(\\)]*" + ")+)" + //å…³é—­æœ‰æ‹¬å·
        "\\))?",
        // å…³é—­æœ€å¤–åœˆæ‹¬å·
        action: function(all, name, param) {
          var current = this.current(),
            pesudos = current.pesudos || (current.pesudos = []),
            name = name.toLowerCase(),
            res = {
              name: name
            };

          if (param) param = param.trim();
          if (posPesudoReg.test(name)) {
            // parse 的成本是很小的 尽量在find前把信息准备好
            // 这里我们会把nth-child(an+b) 的 a 与 b 在不同输入下标准化
            param = extractNthValue(param);
          }
          if (param) res.param = param;
          pesudos.push(res);
        }
      },
      // 属性选择符  如  [class=hahaha]
      //
      // 这里以属性选择符为例，说明下reg与action的关系
      // 
      attributes: {
        reg: "\\[\\s*({{word}}+)(?:({{operator}})[\'\"]?([^\'\"\\[]+)[\'\"]?)?\\s*\\]",
        action: function(all, key, operator, value) {
          var current = this.current(),
            attributes = current.attributes || (current.attributes = []);
            var res = {};
          attributes.push({
            key: key,
            operator: operator,
            value: value
          });
        }
      },
      // 伪元素可以实现么？ 占位
      combo: {
        reg: "\\s*({{combo}})\\s*",
        action: function(all, combo) {
          var data = this.parsed,
            cur = data[data.length - 1];
            this.current().combo = combo;
            cur.push(null);
        },
        order: 0
      }
    };

  var cleanReg = new RegExp("\\s*(,|" + macros.combo + "|" + macros.operator + ")\\s*", "g");
  clean = function(sl) {
      return sl.trim().replace(/\s+/g, " ").replace(cleanReg, "$1");
    };
    // ### parser生成
    // 初始化parser实例
  var parser = new Parser();
  parser.on(rules); //生成规则
  // 为了兼容前面版本，仍然提供这个parse函数, 也为了与find想对应


  function parse(sl) {
    return parser.parse(sl);
  }

  //   3. Finder
  // ================
  //   Util
  // -------------------------
  // 将nodelist转变为array
  //  DOM related Util
  // --------------------
  var root = doc.documentElement || doc;
  var attrMap = {
    'for': "htmlFor",
    "href": function(node) {
      return "href" in node ? node.getAttribute("href", 2) : node.getAttribute("href");
    },
    "type": function(node) {
      return "type" in node ? node.getAttribute("type") : node.type;
    }
  };
  var checkTagName = assert(function() {
    testNode.appendChild(doc.createComment(""));
    // 有些版本的getElementsByTagName("*")会返回注释节点
    return !testNode.getElementsByTagName("*").length ||
    // 低版本ie下input name 或者 id为length时 length返回异常
    typeof doc.getElementsByTagName("input").length !== "number";
  });
  //form __sizzle__line200 判断getAttribute是否可信
  var checkAttributes = assert(function() {
    testNode.innerHTML = "<select></select>";
    var type = typeOf(testNode.lastChild.getAttribute("multiple"));
    // IE8 returns a string for some attributes even when not present
    return type !== "boolean" && type !== "string";
  });
  // 将nth类方法的判断部分统一抽离出来,
  // 其中type代表是否是nth-type-of类型的判断,下面类似


  function checkNth(node, type) {
    return type? node.nodeName === type : node.nodeType === 1;
  }
  // 获得父节点node的顺数第n(从1开始)个子节点


  function nthChild(node, type) {
    var node = node.firstChild;
    return (!node || checkNth(node, type)) ? node : nthNext(node, type);
  };
  // 获得父节点node的倒数第n(从1开始)个子节点


  function nthLastChild(node,type) {
    var node = node.lastChild;
    return (!node || checkNth(node, type))? node:nthPrev(node, type);
  };
  // 获得节点node的第n(从1开始)个前置兄弟节点


  function nthPrev(node, type) {
    while (node = node.previousSibling) {
      if (checkNth(node, type)) return node;
    }
    return node;
  };
  // 获得节点node的倒数第n(从1开始)个前置兄弟节点


  function nthNext(node, type) {
    while (node = node.nextSibling) {
      if (checkNth(node, type)) return node;
    }
    return node;
  };
  // 获得节点node的key属性的值, 修改自from sizzle...蛋疼啊各浏览器的属性获取

  function getAttribute(node, key) {
    var map = attrMap[key];
    if (map) return typeof map === "function" ? map(node) : node[map];
    if (checkAttributes) {
      return node.getAttribute(key);
    }
    var attrNode = node.getAttributeNode(key);
    // 对于selected checked 当返回为bool值时  将其标准化为 selected = "selected"
    // 方便后续处理
    // 很多时候null可以作为标志位，nes中大部分特殊flag都用null标示
    return typeof node[key] === "boolean" 
            ? node[key] ? key : null
            : (attrNode && attrNode.specified ?attrNode.value : null);
  };
  // __数组去重__


  function distinct(array) {
    for (var i = array.length; i--;) {
      var n = array[i];
      // 先排除 即 如果它是清白的 后面就没有等值元素
      array.splice(i, 1, null);
      if (~array.indexOf(n)) {
        array.splice(i, 1); //不清白
      } else {
        array.splice(i, 1, n); //不清白
      }
    }
    return array;
  }
  // 从sizzle抄袭的 document sorter 
  // 将匹配元素集按文档顺序排列好 这很重要!
  var sortor = (doc.compareDocumentPosition) ?
  function(a, b) {
    if (!a.compareDocumentPosition || !b.compareDocumentPosition) return 0;
    return a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;
  } : ('sourceIndex' in doc) ?
  function(a, b) {
    if (!a.sourceIndex || !b.sourceIndex) return 0;
    return a.sourceIndex - b.sourceIndex;
  } : function(a, b) {
    var i = 0,
      ap = [a],
      bp = [b],
      aup = a.parentNode,
      bup = b.parentNode,
      cur = aup;

    if (a === doc) {
      return -1;
    } else if (b === doc) {
      return 1;
    } else if (!aup && !bup) {
      return 0;
    } else if (!bup) {
      return -1;
    } else if (!aup) {
      return 1;
    } else if (aup === bup) {
      return siblingCheck(a, b);
    }
    while (cur) {
      ap.unshift(cur);
      cur = cur.parentNode;
    }
    cur = bup;
    while (cur) {
      bp.unshift(cur);
      cur = cur.parentNode;
    }
    while (ap[i] === bp[i]) {
      i++;
    }
    return siblingCheck(ap[i], bp[i]);
  };

  function siblingCheck(a, b) {
    if (a && b) {
      var cur = a.nextSibling;
      while (cur) {
        if (cur === b) {
          return -1;
        }
        cur = cur.nextSibling;
      }
    }
    return a ? 1 : -1;
  };

  function uniqueSort(nodeList) {
    return distinct(nodeList.sort(sortor));
  };

  // ### nth position Cache 部分
  // 对于nth类型的查找，有时候一次节点查找会遍历到多次相同节点，
  // 由于一次节点查找时，由于js的单线程，节点不可能发生改变，介于此，我们将
  // nth类的node的节点位置缓存起来，在本次查找结束后再清空
  // 获得node的唯一标示
  var getUid = (function(token) {
    var _uid = 0;
    return function(node) {
      return node._uid || (node._uid = token + _uid++);
    };
  })("nes_" + (+new Date).toString(36));
  // 创建nth相关的Filter，由于都类似，就统一通过工厂函数生成了
  // 参数有两个  
  //    1. isNext: 代表遍历顺序是向前还是向后
  //    2. isType: 代表是否是要指定nodeName


  function createNthFilter(isNext, isType) {
    var next, prev, cacheKey, getStart;
    if (isNext) {
      cacheKey = isType ? "type" : "child";
      // if(typeof isType === "function") cacheKey = "match"
      next = nthNext;
      prev = nthPrev;
      getStart = nthChild;
    } else {
      // Fixed:!!! 这里cache是首次生成的cache被写死了，即使后面clear了也没有用,
      // 即永远无法被释放
      cacheKey = "last" + (isType ? "type" : "child");
      // if(typeof isType === "function") cacheKey = "last-match"
      prev = nthNext;
      next = nthPrev;
      getStart = nthLastChild;
    }
    // 实际返回函数, param即pesudo的action定义的参数形如
    // `{step:1, start:1}` 所有的类似even、odd或者其他形如n、-3n-11都会标准化
    // 成这种形势
    return function(node, param) {
      var cache = nthPositionCache[cacheKey];
      if (node === root) return false; // 如果是html直接返回false 坑爹啊
      var _uid = getUid(node),
        parent = node.parentNode,
        traverse = param.step > 0 ? next : prev,
        step = param.step,
        start = param.start,
        type = isType && node.nodeName;
        //Fixed
      if (step === null) return false; //means always false
      if (!cache[_uid]) {
        var startNode = getStart(parent, type),
          index = 0;
          do {
            cache[getUid(startNode)] = ++index;
            nthPositionCache.length++;
          } while (startNode = next(startNode, type));
      }
      var position = cache[_uid];
      if (step === 0) return position === start;
      return ((position - start) / step >= 0) && ((position - start) % step === 0);
    };
  }
  // 
  var nthPositionCache = {length: 1 };
  function clearNthPositionCache() {
    if (nthPositionCache.length) {
      nthPositionCache = {
        child: {},
        lastchild: {},
        type: {},
        lasttype: {},
        length: 0
      };
    }
  }
  // 初始化positioncache
  clearNthPositionCache();


  // 这里的几个finders是第一轮获取目标节点集的依赖方法
  // 我没有对byClassName做细致优化，比如用XPath的方式
  // form sizzle line 147
  var finders = {
    byId: function(id) {
      var node = doc.getElementById(id);
      return node ? [node] : [];
    },
    byClassName: doc.getElementsByClassName ? function(classList, node) {
      classList = classList.join(" ");
      return toArray((node || doc).getElementsByClassName(classList));
    } : null,
    byTagName: checkTagName ? function(tagName, node) {
      var results = (node || doc).getElementsByTagName(tagName);
      return toArray(results);
    } : function(tagName, node) {
      var results = (node || doc).getElementsByTagName(tagName);
      var elem, tmp = [],
        i = 0;
      for (;
      (elem = results[i]); i++) {
        if (elem.nodeType === 1) tmp.push(elem);
      }
      return tmp;
    }
  };
  // ### filter: 
  // Action中塞入的数据会统一先这里处理，可能是直接处理如id、class等简单的.
  // 也可能是分发处理，甚至是多重的分发，如那些复杂的attribute或者是pesudo
  // 这里简化到过滤单个节点 逻辑清晰 ,但可能性能会降低，因为有些属性会重复获取
  var filters = {
    id: function(node, id) {
      return node.id === id;
    },
    classList: function(node, classList) {
      var len = classList.length,
        className = " " + node.className + " ";
      for (; len--;) {
        if (className.indexOf(" " + classList[len] + " ") === -1) {
          return false;
        }
      }
      return true;
    },
    tag: function(node, tag) {
      if (tag == "*") return true;
      return node.tagName.toLowerCase() === tag;
    },
    // pesudos会分发到ExpandsFilter中pesudo中去处理
    pesudos: function(node, pesudos) {
      var len = pesudos.length,
        pesudoFilters = expandFilters["pesudos"];

      for (; len--;) {
        var pesudo = pesudos[len],
          name = pesudo.name,
          filter = pesudoFilters[name];

        if (!filter) throw Error("不支持的伪类:" + name);
        if (!filter(node, pesudo.param)) return false;
      }
      return true;
    },
    // attributes会分发到ExpandsFilter中的operator去处理
    attributes: function(node, attributes) {
      var len = attributes.length,
        operatorFilters = expandFilters["operators"];

      for (; len--;) {
        var attribute = attributes[len],
          operator = attribute["operator"],
          filter = operatorFilters[operator],
          nodeValue = getAttribute(node, attribute.key);

          if (nodeValue === null) {
            if (operator !== "!=") return false;
            continue;
          }
        if (!operator) continue;
        if (!filter) throw Error("不支持的操作符:" + operator);
        if (!filter(attribute.value, nodeValue + "")) return false;
      }
      return true;
    }
  };

  // expandFilters 
  // -------------------------
  // 原生可扩展的方法
  var expandFilters = {
    // __扩展连接符__:
    // 选择符filter 与其他filter不同 node 同样是当前节点 区别是
    // 如果成功返回成功的上游节点(可能是父节点 可能是兄弟节点等等)
    // 其中 match(node) 返回 这个上游节点是否匹配剩余选择符(内部仍是一个递归)
    combos: {
      ">": function(node, match) {
        var parent = node.parentNode;
        if (match(parent)) return parent;
      },
      "~": function(node, match) {
        var prev = nthPrev(node);
        while (prev) {
          if (match(prev)) return prev;
          prev = nthPrev(prev);
        }
      },
      " ": function(node, match) {
        var parent = node.parentNode;
        while (parent) {
          var pass = match(parent);
          if (pass) return parent;
          if (pass === null) return null;
          parent = parent.parentNode;
        }
        return null;
      },
      "+": function(node, match) {
        var prev = nthPrev(node);
        if (prev && match(prev)) return prev;
      }
    },
    // __扩展操作符__ :
    operators: {
      "^=": function(value, nodeValue) {
        if (nodeValue == null) return false;
        return nodeValue.indexOf(value) === 0;
      },
      "=": function(value, nodeValue) {
        return nodeValue === value;
      },
      "~=": function(value, nodeValue) {
        if (nodeValue == null) return false;
        return ~ (" " + nodeValue + " ").indexOf(value);
      },
      "$=": function(value, nodeValue) { //以value结尾
        return nodeValue.substr(nodeValue.length - value.length) === value;
      },
      "|=": function(value, nodeValue) { // 连接符
        return ~ ("-" + nodeValue + "-").indexOf("-" + value + "-");
      },
      "*=": function(value, nodeValue) { //出现在nodeValue的任意位置
        return ~ (nodeValue).indexOf(value);
      },
      "!=": function(value, nodeValue) {
        return nodeValue !== value;
      }
    },
    // __扩展伪类__:
    pesudos: {
      //TODO:这里如果出自 SELECtorAPI 标注下处处
      "not": function(node, sl) {
        return !matches(node, sl);
      },
      "matches": function(node, sl) {
        return matches(node, sl);
      },
      // child pesudo 统一由工厂函数生成
      "nth-child": createNthFilter(true, false),
      "nth-last-child": createNthFilter(false, false),
      "nth-of-type": createNthFilter(true, true),
      "nth-last-of-type": createNthFilter(false, true),
  
      "first-child": function(node) {
        return !nthPrev(node);
      },
      "last-child": function(node) {
        return !nthNext(node);
      },
      "last-of-type": function(node) {
        return !nthNext(node, node.nodeName);
      },
      "first-of-type": function(node) {
        return !nthPrev(node, node.nodeName);
      },
      "only-child": function(node) {
        return !nthPrev(node) && !nthNext(node);
      },
      "only-of-type": function(node) {
        return !nthPrev(node, node.nodeName) && !nthNext(node, node.nodeName);
      },
      //找出有具体text内容的节点
      "contains": function(node, param) {
        return ~ (node.innerText || node.textContent || '').indexOf(param);
      },
      "checked": function(node) {
        return !!node.checked || !! node.selected;
      },
      "selected": function(node) {
        return node.selected;
      },
      "enabled": function(node) {
        return node.disabled === false;
      },
      "disabled": function(node) {
        return node.disabled === true;
      },
      "empty": function(node) {
        var nodeType;
        node = node.firstChild;
        while (node) {
          if (node.nodeName > "@" || (nodeType = node.nodeType) === 3 || nodeType === 4) {
            return false;
          }
          node = node.nextSibling;
        }
        return true;
      },
      "focus": function(node) {
        return node === doc.activeElement && (!doc.hasFocus || doc.hasFocus()) && !! (node.type || node.href || ~node.tabIndex);
      },
      "target": function(node, param) {
        var id = node.id || node.name;
        if (!id) return false;
        return ("#" + id) === location.hash;
      }
    }
  };

  // 这里主要是整合之前的ExpandsFilter中的mathch, 单层数据


  function matchDatum(node, datum, ignored) {
    var subFilter;
    for (var i in datum) {
      if (ignored !== i && (subFilter = filters[i]) && !subFilter(node, datum[i])) {
        return false;
      }
    }
    return true;
  };
  // 这个全局cache的引入是为了避免多次传入参数。
  // 当然全局的缺点也很明显，维护会不方便, 不利于测试
  var matchesCache = null; //保存那些matches函数
  

  function matchData(node, data, ignored) { // 稍后再看存入step
    var len = data.length,
      datum = data[len - 1];
      // 首先要满足自身
    if (!matchDatum(node, datum, ignored)) return false;
    else {
      if (len == 1) return true;
      var nextDatum = data[len - 2],
        getNext = expandFilters.combos[nextDatum.combo],
        match = matchesCache[len - 2],
        next = getNext(node, match);

        if (next) return true;
        else return false;
    }
  };
  //动态产生供FilterOneNode使用的match


  function createMatch(data) {
    return function(node) {
      if (node == root || node == null || node == doc) return null; //null 相当于休止符
      return matchData(node, data);
    };
  };

  function createMatches(data) {
    var matches = [];
    for (var i = 0, len = data.length; i < len; i++) {
      matches.push(createMatch(data.slice(0, i + 1)));
    }
    return matches;
  };
  // 过滤主函数filter
  // -----------------------------------
  // 自底向上过滤非匹配节点


  function filter(results, data, ignored) {
    if (!data.length) return results;
    //这里是为了缓存match匹配函数
    var preMatchesCache = matchesCache;
    matchesCache = createMatches(data);
    for (var i = results.length; i--;) {
      if (!matchData(results[i], data, ignored)) {
        results.splice(i, 1);
      }
    }
    // Fixed: 因为一次filter可能会有字filter调用，比如matches、not、include
    matchesCache = preMatchesCache; // warning :以后写全局变量一定当心
    return results;
  }
  // 获得第一次目标节点集


  function getTargets(data, context) {
    var results, ignored, lastPiece = data[data.length - 1];
    if (lastPiece.id) {
      results = finders.byId(lastPiece.id);
      ignored = "id";
    } else if (lastPiece.classList && lastPiece.classList.length && finders.byClassName) {
      results = finders.byClassName(lastPiece.classList, context);
      ignored = "classList";
    } else {
      results = finders.byTagName(lastPiece.tag || "*", context);
      ignored = "tag";
    }
    if (!results.length) return results;
    return filter(results, data, ignored);
  }
  // API : find (private)
  // -------------
  // 根据parse后的数据进行节点查找
  // options:
  //    1. parsed.data  parse数据为一数组
  //    2. node         context节点
  // 事实上没有data这个单词，我这里算是自定了这个单词
  //     datas : [data,data]   
  //     data : [datum, datum]
  //     datum: {tag:"*"....etc}


  function find(datas, context) {
    if (!datas[0][0]) return [];
    var results = [],
      notNullResult = 0;

    for (var i = 0, len = datas.length; i < len; i++) {
      var data = datas[i],
        dlen = data.length,
        last = data[dlen - 1],
        result = getTargets(data, context);

      if (result && result.length) {notNullResult++;};
      if (!results) results = result;
      else results =results.concat(result);
    }
    clearNthPositionCache();//清理
    if (notNullResult > 1) uniqueSort(results);
    return results;
  }
  // API : 测试用get相当于all (private)
  // -------------------------------------
  // 为了测试时避免原生querySelector的影响
  // 


  function get(sl, context) {
    var data = parse(sl);
    var result = find(data, context || doc);
    return result;
  }

  // API 
  // ----------------------------------------------------------------------
  var supportQuerySelector = !! doc.querySelector;

  // API1——__one__:对应标准的querySelector方法


  function one(sl, context) {
    var node;
    if (supportQuerySelector && !nes.debug) {
      try {
        node = (context || doc).querySelector(sl);
      } catch (e) {
        node = get(sl, context)[0];
      }
    } else {
      node = get(sl, context)[0];
    }
    return node;
  }

  // API2——__all__
  // -------------------------------
  // 对应标准的querySelectorAll方法


  function all(sl, context) {
    var nodeList;
    if (supportQuerySelector && !nes.debug) {
      try {
        nodeList = toArray((context || doc).querySelectorAll(sl));
      } catch (e) {
        nodeList = get(sl, context);
      }
    } else {
      nodeList = get(sl, context);
    }
    return nodeList;
  }

  // API 3: 
  // ----------------------------------------------------------------------
  // 对应标准的matches方法
  // nes的matches功能稍强，它支持用分隔符链接符组合的复杂选择器
  // 即与all、one函数的支持是一样的
  //
  // 注: 由于:not与:matches依赖于这个函数 ,所以同样支持复杂选择器


  function matches(node, sl) {
    if (!node || node.nodeType !== 1) return false;
    var datas = parse(sl),
      len = datas.length;
    if (!datas[len - 1][0]) return false;
    for (; len--;) {
      if (matchOneData(node, datas[len])) return true;
    }
    return false;
  }

  // matches 单步调用方法


  function matchOneData(node, data) {
    var len = data.length;
    if (!matchDatum(node, data[len - 1])) {
      return false;
    } else {
      return filter([node], data.slice(0)).length === 1;
    }
  }

  // ASSEMBLE 
  // =========================
  // 组装分为几个步骤
  //
  // 1. 生成pesudo 、 operator、combo 等expand方法
  // ----------------------------------------------------------------------
  // 具体扩展方法的使用请参见 [nes的github](https://github.com/leeluolee/nes)
  // 统一由工厂函数createExpand
  ;
  (function createExpand(host, beforeAssign) {
    for (var i in host) {
      nes[i] = (function(i) {
        var container = host[i];
        // autoSet代表了这三个函数除了key、value参数
        // 也支持字面量的参数输入
        return autoSet(function(key, value) {
          // Warning: 直接覆盖，如果存在的话
          container[key] = value;
          if (i in beforeAssign) {
            beforeAssign[i](key, value);
          }
        });
      })(i);
    }
    // 有些扩展如combos、operators由于为了避免冲突
    // 关键字都写入了正则式中，这种情况下需要将新的正则式
    // 填入相关正则，并进行parser的setup
  })(expandFilters, {
    "operators": function(key) {
      var befores = macros.operator.split("]");
      befores.splice(1, 0, key.charAt(0) + "]");
      macros.operator = befores.join("");
      parser.setup();
    },
    "combos": function(key) {
      var befores = macros.combo.split("]");
      befores.splice(1, 0, key + "]");
      macros.combo = befores.join("");
      parser.setup();
    }
  });

  // 2. 暴露API
  // -------------------------------------
  //
  // 直接设置其为true 来强制不适用原生querySelector Api
  nes.debug = false; 
  nes._nthCache = nthCache;
  // parser , 抽离的parser部分
  // ---------------------------
  // 它可以:
  //
  //    1. parser.parse 解析内部规则定义的字符串匹配
  //    2. parser.on    添加新规则
  //    3. parser.clone 复制此parser，这个作用会在后面的zen-coding的demo中体现
  //    4. parser.off   删除规则
  //    5. parser.cache 缓存控制
  nes.parser = parser;

  //解析, 这个将被移除，使用parser.parse来代替
  nes.parse = parse;
  //查找parser解析后的data代表的节点 __private__
  nes._find = find;
  //测试时排除原生querySelector的影响 __deprecated__! 使用nes.debug来控制
  nes._get = get;
  //        *主要API*
  // -------------------------
  nes.one = one; 
  nes.all = all; 
  nes.matches = matches;
  // 内建扩展 api 这三个已经内建:
  // 
  // 1. `pesudos`
  // 2. `operators`
  // 3. `combos`
  nes._uniqueSort = uniqueSort;
  nes._cleanSelector = clean;
  nes._getUid = getUid;


  //          5.Exports
  // ----------------------------------------------------------------------
  // 暴露API:  amd || commonjs  || global 
  // 支持commonjs
  if (typeof exports === 'object') {
    module.exports = nes;
    // 支持amd
  } else if (typeof define === 'function' && define.amd) {
/* */define(function() {
      return nes;
    });
  } else {
    // 直接暴露到全局
    win.nes = nes;
  }

  //        6. extension
  //-------------------------------------------------------------
  // 很多人不看extend文件夹， 所以这部分也作为Demo实例

  /**
   * nth Math 的调用方法
   * @param  {[type]} first [description]
   * @return {[type]}
   */
  function nthMatch(first) {
    return function(node, param) {
      var tmp = param.split(/\s+of\s+/);
      if(tmp.length<2) throw Error("no 'of' keyword in nth-match\"s selector");

      var params = extractNthValue(tmp[0]),
        sl = tmp[1],
        testNode = node.parentNode[first? "firstChild":"lastChild"],
        next = first? "nextSibling" : "previousSibling",
        step = params.step,
        start = params.start,
        position = 0;

        if(!matches(node, sl)) return false;
        if (step === null) return false; //means always false
        do {
          if (testNode.nodeType === 1 && nes.matches(testNode, sl)) position++;
          if (testNode === node) break;
        } while (testNode = testNode[next]);
        
        if (step === 0) return position === start;
        return ((position - start) / step >= 0) && ((position - start) % step === 0);
    };
  }
  nes.pesudos({
    // 例如 :nth-match(3 of li.active) 第三个满足这个li.active的节点
    "nth-match": nthMatch(true),
    "nth-last-match": nthMatch(false),
    "local-link": function(_node, param){
      if(param) param = parseInt(param);
    }
  });
}(window, document, undefined);
I$('0b798b37310e41bdc73c7ed5b6638d62',function (NEJ,_t0,_p,_o,_f,_r){
    /**
     * 节点选择器
     *
     * 结构示例
     * ```html
     * <ul class="w-tab">
     *   <li class="itm">Tab-0</li>
     *   <li class="itm">Tab-1</li>
     *   <li class="itm">Tab-2</li>
     *   <li class="itm js-selected">Tab-3</li>
     *   <li class="itm">Tab-4</li>
     *   <li class="itm">Tab-5</li>
     * </ul>
     * ```
     *
     * 脚本示例
     * ```javascript
     * NEJ.define([
     *     'util/query/query',
     *     'util/tab/tab'
     * ],function(_e,_t){
     *     // 使用选择器接口来取列表
     *     _t._$$Tab._$allocate({
     *         list:_e._$all('.w-tab > li'),
     *         onchange:function(_event){
     *                // TODO
     *         }
     *     });
     * });
     * ```
     *
     * @method module:util/query/query._$all
     * @param  {String} arg0 - 选择器
     * @param  {Node}   arg1 - 用于匹配的根节点，默认为document
     * @return {Array}         符合规则的节点列表
     */
    _p._$all = function(){
        try{
            return nes.all.apply(nes,arguments);
        }catch(e){
            return null;
        }
    };
    /**
     * 节点选择器
     *
     * 结构示例
     * ```html
     * <ul class="w-tab">
     *   <li class="itm">Tab-0</li>
     *   <li class="itm">Tab-1</li>
     *   <li class="itm">Tab-2</li>
     *   <li class="itm js-selected">Tab-3</li>
     *   <li class="itm">Tab-4</li>
     *   <li class="itm">Tab-5</li>
     * </ul>
     * ```
     *
     * 脚本示例
     * ```javascript
     * NEJ.define([
     *     'util/query/query'
     * ],function(_t){
     *     // 使用选择器接口来取选中的节点
     *     var _node = _t._$one('.w-tab > li.js-selected');
     * });
     * ```
     *
     * @method module:util/query/query._$one
     * @param  {String} arg0 - 选择器
     * @param  {Node}   arg1 - 用于匹配的根节点，默认为document
     * @return {Node}          符合规则的节点
     */
    _p._$one = function(){
        try{
            return nes.one.apply(nes,arguments);
        }catch(e){
            return null;
        }
    };
    // for test only
    _p._$g = nes._get;

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','a7b65ba9a7315b3c86092b770270bffb');
I$('2136bd70d3b73e965c72388f69873d99',function (_v,_e,_u,_x,_t){
    var fragmentRE = /^\s*<(\w+|!)[^>]*>/,
        // local vals
        _slice = [].slice,
        _doc = document,
        _de = "documentElement",
        _docElem = _doc[_de],
        _testNode = _doc.createElement('div'),

        // assert
        _textHandle = _testNode.textContent == null? 'innerText' : 'textContent' ,
        _extend = function(_name, _value, _options) {
            _options = _options || {};
            if (this[_name] == null || _options.override) this[_name] = _value;
            return this;
        },
        _bubbleUp = function(_sl, _node, _container) {
            while (_node && _node !== _container) {
                if (nes.matches(_node, _sl)){
                    return _node;
                }
                _node = _node.parentNode;
            }
        },
        /**
         * 根据返回类型决定返回this，还是别的什么
         * @param  {Mix} _result
         * @param  {String} _methodName 当前方法名
         * @return {Mix}
         */
        _ischainableRet = function(_result, _methodName, _node){
            return (_result === _node || _result === "undefined" || _result === this ||
                    _result === _e || _result === _v);// 这两个是为了兼容nej
        },
        _isAcceptedNode = function(_node){
            if(!_node) return false;
            var _type = _node.nodeType;
            return _type === 1 || _type === 9 || //  element document
                _type === 11|| _node.window === _node; // framement window
        },
        // 安全的添加原型, 本作用域内
        _safeProtoExtend = function(Type){
            var _proto = Type.prototype,
                _list = {};
            return {
                extend:function(_name, _fn){
                    _list[_name] = _proto[_name];//先保存之前的
                    _proto[_name] = _fn;
                    return this;
                },
                reset: function(){
                    for(var _i in _list) if(_list.hasOwnProperty(_i)){
                        if(_list[_i] === undefined){
                            delete _proto[_i];
                        }else{
                            _proto[_i] = _list[_i];
                        }
                    }
                }
            };
        },
        _fn = _safeProtoExtend(Function);

    // 安全扩展函数原型
    // 1. autoSet, 自动转换set({name:value})为多重set(name, value)
    _fn.extend("autoSet", function(){
        var _fn = this;
        return function(_key, _value) {
            if (_u._$isObject(_key)){
                var _args = _slice.call(arguments, 1);
                for(var _i in _key){
                    _fn.apply(this, [_i, _key[_i]].concat(_args));
                }
                return this;
            }else{
                return _fn.apply(this, arguments);
            }
        };
    // 2. splitProcess, 自动在首参数为数组时，拆分为多步，
    }).extend("splitProcess", function(_isGetter){
        var _fn = this;
        return function(_params){
            if(_u._$isArray(_params)){
                var _args = _slice.call(arguments, 1),
                    _len = _params.length,
                    _ret;
                if(_isGetter) _ret = {}; //当时getter函数需要返回值
                for(var _i = 0 ; _i < _len ;_i++){
                    var _param = _params[_i],
                        _tmpRet = _fn.apply(this, [_param].concat(_args));
                    if(_isGetter && typeof _param === "string") _ret[_param] = _tmpRet;
                }
                return _isGetter? _ret : this;
            }else{
                return _fn.apply(this, arguments);
            }
        };
    });

    _extend = _extend.autoSet();

  /**
    *    将输入的选择器指定节点或节点和节点数组包装成_$$NodeList对象，NodeList是一个类似jQuery的对象
    *    可以进行链式操作，拥有大部分nej.e下的接口，并扩展了一部分jQuery的常用方法。
    *
    *    一个脑残的例子告诉你链式调用可以做什么
    *    ```javascript
    *    // 获得某个节点集, 设置样式
    *    $("#chainable li:nth-child(odd)")._$style({
    *        "background": "#cca",
    *        "cursor": "pointer"
    *    })
    *    // 然后抛弃他们 找他们的下一个位置条件满足是4倍数的兄弟节点并设置样式
    *    ._$next(":nth-child(2n)")._$style({
    *        "background": "#a19",
    *        "cursor": "help"
    *    })
    *    // 过滤出其中是4倍数的行,并绑定事件
    *    ._$filter(":nth-child(4n)")._$click(function(_e) {
    *        $(this)._$style("background", "#111");
    *    // 并给他们中的第一行设置边框
    *    })._$get(1, true)._$style("border", "3px solid #222")
    *    // 找到父节点div并且有chainable的id并且设置样式
    *    ._$parent("div#chainable")._$style({
    *        width: "800px",
    *        left: "300px",
    *        position:"absolute"
    *    // 绑定事件以及代理事件
    *    })._$on({
    *        "click" :function(){
    *            var div = document.createElement("div")
    *            div.innerHTML = "haha插入一行"
    *            //每次点击插入一行
    *            $(this)._$insert(div, "bottom");
    *        },
    *        "mouseover li:nth-child(odd)":function(_e){
    *            this._isLight = !this._isLight;
    *            // 每次点击改变背景色
    *            $(this)._$style("background-color", this._isLight? "#cca":"#331")
    *        }
    *    // 获得样式值
    *    })._$style(["width", "left"])
    *    // 到这里链式结束返回{"width":"80px", "left":"30px"}
    *    ```
    *
    *    nej.$ 支持的选择器与nes选择器一致，具体请参考 https://github.com/leeluolee/nes
    * 
    *    结构举例
    *    ```html
    *      <ul>
    *          <li><a href=""></a></li>
    *          <li><a href=""></a></li>
    *          <li><a href=""></a></li>
    *          <li><a href=""></a></li>
    *      </ul>
    *    ```
    * 
    *    ```javascript
    *      var $ = NEJ.P('nej.$');
    *      $('ul > li:nth-child(2n+1) >a')
    *       .addClassName('odd')
    *       ._$on('click', _callback) //将所有的奇数li节点下的a标签加上className，并进行事件绑定
    *    ```
    *
    *    $接受的参数与jQuery的一致 ，非常灵活
    *    ```javascript
    *    // 获得"body"节点， 很明显此时节点集只有一个元素
    *    $("body")
    *
    *    // 找到有class1并且有rel属性的节点集，这时可能会有很多个节点
    *    $("body li.class1[rel]")
    *    // 会过滤出childNodes的节点，其他Array Like也是类似
    *    $(document.body.childNodes)
    *
    *    // 有时候你不确定输入的是什么参数， 安全的再包一次吧，无副作用
    *    $body = $("body")
    *    $body2 = $($body2)
    *    ```
    * 
    *    @method CHAINABLE.$
    *    @param  {String|Array|_$$NodeList|Node} _selector 可以是选择器、节点、节点数组或另一个_$$NodeList实例
    *    @param  {String|Node|_$$NodeList} _context  代表从这个根节点下查找节点，特别是页面上节点还不存在时，需要传入这个参数
    *    @return {_$$NodeList}           返回_$$NodeList实例
    */
    var $ = function(_selector, _context){
        
        // dump nej methods implement
        $._$implement(_x._$dump(), {"statics": true});
        _x._$clear();
        
        if (typeof _selector === 'string' && _selector.trim().indexOf("<") == 0) {
        var container = document.createElement('div');
            container.innerHTML = _selector;
            var res = $(container.childNodes);
            return res;
        }
        return new _$$NodeList(_selector, _context);
    };

    function _$$NodeList(_selector, _context){
        this.length = 0;
        this._signs = {};//标示是否有了当前节点
        this._context = _context || _doc;
        if(!_selector) return ;
        if(typeof _selector === "string"){
            // if(/\^<[-\w]+/.test(_selector)) return $.fragment(_selector);
            if(_context && _context instanceof _$$NodeList) _context = _context[0];
            if(typeof _context == 'string') _context = $(_context)[0];
            this._$add(_t._$all(_selector, _context));
        }else if(_selector instanceof _$$NodeList || _isAcceptedNode(_selector) ||
            _selector.length){ // _$$NodeList 或者 是单节点、或者是类数组(如childNodes)
            this._$add(_selector);
        }
    }

    // 扩展接口
    $._$extend = _extend._$bind($);


    $._$extend({
        _$signal: "_uid",//会绑定在节点上的唯一标示
        _$instances:{},// 缓存对象
        _$handlers:[], // 保存原始handler方法
        _$fragment: function(){
        },
        /**
         * 扩展链式化接口，你可以通过两种方式，一是迁移已有的静态接口(比如NEJ的大部分接口都是这样迁移过来的)，而是直接进行_$$NodeList的原型扩展
         *
         * Example:
         * ```javascript
         * // 1. 直接扩展
         * $._$implement("_$hello", function(){
         *     // 遍历容器内的所有节点
         *     this._$forEach(function(_node, _index){
         *         _node.hello = "Hello World"
         *     })
         * })
         * $("li:nth-child(2n)")._$hello() // 所有偶数行都被加上了 hello属性
         * // 2. 直接利用静态方法进行扩展(常用语迁移), 上面扩展等价于
         * $._$implement("_$hello", function(_node){
         *    _node.hello = "Hello World"
         * }, {static: true})
         * // 3. 创建jQuey的wrap 方法
         * // 创建wrap方法
         * $._$implement("_$wrap", function(_selector){
         *     var $content = $(_selector)
         *     $content._$after2(this)._$insert(this);
         * })
         * $("#list")._$wrap(document.createElement("div"))
         * ```
         *
         * 需要注意的是，当静态接口的迁移时，有如下约定(同时也是NEJ原接口在链式调用的表现约定)
         * 
         * * 当返回值为: this 、 传入节点 、 nej.v 、 nej.e 、 undefined (即不返回)时, 视为setter操作,可以进行链式调用, 如上例:
         * * 当返回值为其他类型时: 视为getter操作, 返回节点列表中 第一个元素 的返回值，这个也是jQuery的链式接口的表现
         * 
         *
         * @method CHAINABLE._$implement
         * @param  {Object} _definition 要扩展的接口集合 (注意不要使用字符串作为键值)
         * @param  {Object} _options 参数  目前只有两个选项{statics: 代表是否是静态接口迁移, override: 是否覆盖原同名方法}
         * @return {this}
         */
        _$implement: function(_name, _fn, _options){
            _options = _options || {};
            _extend.call(_$$NodeList.prototype, _name, _options.statics? this._transport(_fn): _fn);
        }.autoSet(),
        _transport: function(_fn){
            return function(){
                // if(!this.length) throw Error("内部节点集为空")
                var _args = _slice.call(arguments);
                _args.unshift(this[0]);

                var _ret = _fn.apply(this,_args);
                // 当返回_e、_v、this、_node、undefined(无返回值)都视为链式
                if(!_ischainableRet.call(this, _ret)) return _ret;

                this._$forEach(function(_node, _index){
                    if(_index === 0) return;
                    _args[0] = _node;
                    _fn.apply(this ,_args);
                });
                return this;
            };
        },
        _merge: function(_list1, _list2 , _filter){
            var _i = _list1.length || 0,
                _j = 0;
            for( ;_list2[_j] !== undefined;){
                var _tmp = _list2[_j++];
                if(!_filter || _filter.call(_list1, _tmp)){
                    _list1[_i++] = _tmp;
                }
            }
            _list1.length = _i;
            return _list1;
        },
        _toArray: function(_list){
            return $._merge([], _list);
        },
        // ** fork form jQuery **
        _contains: _docElem.contains ? function( _a, _b ) {
            return _a === _b || (_a.nodeType == 9? _a[_de]: _a).contains(_b);
        }: _docElem.compareDocumentPosition ?
        function( _a, _b ) {
            // more info : https://gist.github.com/4601579
            return _b && !!( _a.compareDocumentPosition( _b ) & 16 );
        }: function( _a, _b ) {
            // fallback
            while ( (_b = _b.parentNode) ) {
                if ( _b === _a ) return true;
            }
            return false;
        },
        _$cloneNode:function(_node, _withContent){
            _withContent = !!_withContent;
            var _clone = _node.cloneNode(_withContent),
                _ce, _be;

            if(_withContent){
                _be = nes.all("*", _node);
                _be.push(_node);
                _ce = nes.all("*", _clone);
                _ce.push(_clone);
            }else{
                _be = [_node];
                _ce = [_clone];
            }

            for (_i = _ce.length; _i--;){
                _definitions.fixture.clone(_ce[_i], _be[_i]);
            }
            return _clone;
        },
        _delegateHandlers : {},// for delegate
        _cleanSelector : nes._cleanSelector,
        _$uniqueSort : nes._uniqueSort,
        _$matches : nes.matches,
        _$fn: _$$NodeList.prototype,
        _$uid : nes._getUid
    });

    // proto function 扩展
    // ================================
    var _rclickEvents = /^(?:click|dblclick|contextmenu|DOMMouseScroll|mouse(?:\w+))$/,
        _rkeyEvents = /^key(?:)/,
        _definitions ={
        // for insert
        // 这里统一视为_node2为插入点
        "insertor":{
            "top":function(_node, _node2){
                _node.insertBefore(_node2, _node.firstChild);
            },
            "bottom": function(_node, _node2){
                _node.appendChild(_node2);
            },
            "before":function(_node, _node2){
                var _parent = _node.parentNode;
                if(_parent) _parent.insertBefore(_node2, _node);
            },
            "after":function(_node, _node2){
                var _parent = _node.parentNode;
                if(_parent) _parent.insertBefore(_node2, _node.nextSibling);
            }
        },
        fixProps :{
            // 确保表单元素属性被正确设置 IE lt9
            input: 'checked',
            option: 'selected',
            textarea: 'value',
            // clone时 , IE某些版本不会正确设置text
            script:"text"
        },
        fixture:{
            // dest src attribute fixed
            "clone": function(_dest, _src){
                var _nodeName, _attr;

                if (_dest.nodeType !== 1) {
                    return;
                }
                // lt ie9 才有
                if (_dest.clearAttributes) {
                    _dest.clearAttributes();
                    _dest.mergeAttributes(_src);
                }
                // 判断是否有需要处理属性的节点
                _nodeName = _dest.nodeName.toLowerCase();
                if(_prop = _definitions.fixProps[_nodeName]){
                    _dest[_prop] = _src[_prop];
                }
                //移除节点标示
                _dest.removeAttribute($._$signal);
                // 移除ID:  TODO? 是否允许有重复ID?
                _dest.removeAttribute("id");
            },
            //patch event
            "event":function(_e){
                var _type = _e.type;
                var _button = _e.button;
                _e.__fixed = true; //标示被fix过
                _e.target = _e.target || _e.srcElement || document; //for ie
                _e.metaKey = !!_e.metaKey; //低版本ie会返回undefined 应该返回


                if(_e.target.nodeType === 3) _e.target = _e.target.parentNode;
                if(_rclickEvents.test(_type)){ //如果是鼠标事件 则初始化page相关
                    _e.pageX = _v._$pageX(_e);
                    _e.pageY = _v._$pageY(_e);
                    if (_type === 'mouseover' || _type === 'mouseout'){//如果是鼠标事件中的mouseover与mouseout
                        var related = _e.relatedTarget || _e[(_type == 'mouseover' ? 'from' : 'to') + 'Element'];
                        while (related && related.nodeType == 3) related = related.parentNode;
                        _e.relatedTarget = related;
                    }
                }
                _e.which = _e.charCode != null ? _e.charCode : _e.keyCode;
                if( !_e.which && _button !== undefined){
                    // http://api.jquery.com/event.which/ use which
                    _e.which = ( _button & 1 ? 1 : ( _button & 2 ? 3 : ( _button & 4 ? 2 : 0 ) ) );
                }
                if(!_e.preventDefault) _e.preventDefault = function(){
                    this.returnValue = false;
                    return this;
                };

                if(!_e.stopPropagation) _e.stopPropagation = function(){
                   this.cancelBubble = true;
                   return this;
                };
            }
        }
    },
    // for traverse
    _traverse = function(_direct){
        var _$matches = $._$matches;

        return function(_selector, _all){
            var _ret = $([]);
            if(typeof _selector === "boolean"){
                _all = _selector;
                _selector = null;
            }
            this._$forEach(function(_node){
                var _tmp = _node[_direct];
                while (_tmp) {
                  if(_tmp.nodeType ===1 && (!_selector || _$matches(_tmp, _selector))){
                    _ret._$add(_tmp);
                    if(!_all) break;
                  }
                  _tmp = _tmp[_direct];
                }
            });
            return _ret;
        };
    };


    $._$implement({
     /**
      * 获取节点样式或者设置节点样式, 这个接口的表现与jQuery的css方法一致, 根据参数不同有不同的表现
      * 比如:
      * ```javascript
      * $('li')._$style(name) //相当于_$getStyle 返回样式值
      * $('li')._$style([name1,name2...]) //相当于多重_$getStyle 返回一个Object(如{"height:20px, width:30px..."})
      * $('li')._$style(name, value) // 相当于setStyle 返回this
      * $('li')._$style(obj) //相当于多重版setStyle(即原_$style) 返回this
      * ```
      * @method CHAINABLE._$style
      * @param  {String|Object|Array} _key  可以是String(单取值或设置)，一个对象(多重赋值)，一个数组(多重取值)
      * @param  {String} _value 样式值
      * @return {_$$Nodelist|String|Object} setter操作返回_$$NodeList，单重取值返回String，多重取值返回样式属性为键的Object，表现与jQuery的css接口一致
      */
        _$style: function(_key, _value){
            if(!_key) throw Error("缺少css样式名");
            if(_value === undefined){
                return _e._$getStyle(this[0], _key);
            }
            return this._$forEach(function(_node){
                _e._$setStyle(_node, _key, _value);
            });
        }.splitProcess(true).autoSet(),
       /**
        * 获取节点属性或者设置节点属性, 这个接口的表现与jQuery的attr一致, 同_$style接口，根据参数不同有不同的表现
        * 比如:
        * ```javascript
        * $('li')._$attr(name): 相当于_$attr 返回属性值
        * $('li')._$attr([name1, name2]) 同style描述 返回{titile:"xxx",rel:"xxx", href:"xxx"}
        * $('li')._$attr(name, value): 相当于_$attr 返回this
        * $('li')._$attr(obj): 相当于多重版的_$attr 返回this
        * ```
        * 
        * @method CHAINABLE._$attr
        * @param  {String|Object|Array} _key  可以是String(单取值或设置)，一个对象(多重赋值)，一个数组(多重取值)
        * @param  {String} _value 属性值
        * @return {_$$Nodelist|String|Object} setter操作返回_$$NodeList，单重取值返回String，多重取值返回样式属性为键的Object，表现与jQuery的css接口一致
        */
        _$attr: function(_key, _value){
            if(!_key) throw Error("缺少属性名");
            if(_value === undefined){
                return _e._$attr(this[0], _key);
            }
            return this._$forEach(function(_node){
                _e._$attr(_node, _key, _value);
            });
        }.splitProcess(true).autoSet(),

        /**
         * 类似于ES5的Array#forEach, 一个遍历函数, 即遍历_$$NodeList的所有节点集
         * 比如:
         * ```javascript
         * // 将1,4,7...class含有strong的li元素分别加上阶梯型的高度
         * $("li.strong:nth-child(3n+1)")._$forEach(function(_node, _index){
         *     _node.style.height = "" + (_index+1)*10 + "px";
         *     // 这里的this指向实例
         * })
         * ```
         * 注意callback中传入的节点是裸节点，而不是包装后的_$$NodeList
         * 
         * @method CHAINABLE._$forEach
         * @param  {Function} _fn 遍历回掉，接受两个参数，当前遍历到的节点和节点下标
         * @return {_$$NodeList}
         */
        _$forEach: function(_fn){
            _u._$forEach(this, _fn);
            return this;
        },

      /**
       * 类似于ES5的Array#filter, 一个过滤, 即过滤_$$NodeList的所有节点集并筛选符合的节点
       * 比如:
       * ```javascript
       * // 返回节点集中的匹配选择器.strong:nth-child(3n)的节点
       * $("li")._$filter(".strong:nth-child(3n)")

       * // 相当于  ===>
       * $("li")._$filter(function(_node){
       *     return $(_node)._$matches(".strong:nth-child(3n)");
       * });
       * ```
       * 注意callback中传入的节点是裸节点，而不是包装后的_$$NodeList
       * 
       * @method CHAINABLE._$filter
       * @param  {Function|String} _fn 遍历函数，接受两个参数，当前遍历到的节点和节点下标。同时也接受一个Selector，筛选出节点集中满足选择器的节点
       * @return {_$$NodeList}
      */
        _$filter: function(_fn){
            var _ret = [],
                _isSelctor = typeof _fn === "string";
            this._$forEach(function(_node, _index){
                var _test = _isSelctor ? $._$matches(_node, _fn):_fn.call(this, _node, _index);
                if(_test) _ret.push(_node);
            });
            return $(_ret);
        },
        /**
         * 相当于ES5的Array#map, 当返回值全部是节点类型时，返回$NodeListchainable, 否则返回标准结果数组(此时chainable不能)
         *
         * example:
         * ```javascript
         * // 此时返回Array : ["li", "li", "li".........]
         * $("li")._$map(function(_node){
         *     return _node.tagName.toLowerCase()
         * });
         * // 此时返回 $NodeList: 即所有节点的下一个兄弟节点
         * $("li")._$map(function(_node){
         *     return _node.nextSibling
         * });
         * ```
         * 注意callback中传入的节点是裸节点，而不是包装后的_$$NodeList
         * 
         * @method CHAINABLE._$map
         * @param  {Function} _fn 遍历callback，接受两个参数，当前遍历到的节点和节点下标
         * @return {_$$NodeList}
         */
        _$map:function(_fn){
            var _ret = [],
                _isNotAllNode = false;
            this._$forEach(function(_node, _index){
                var _res = _fn.call(this, _node, _index);
                if(!_isAcceptedNode(_res)) _isNotAllNode = true;
                _ret.push(_res);
            });
            return _isNotAllNode ? _ret : $([])._$add(_ret);
        },
        /**
         * NodeList中的节点是不保证按文档顺序的(如果是用选择器，则保证是有序的), 你可以手动排序
         * 
         * @method CHAINABLE._$sort
         * @return {_$$NodeList}
         */
        _$sort:function(){
            var _array = this._$get();
            $._$uniqueSort(_array);
            return $(_array);
        },
        /**
         * 向内部节点集填入元素, 会处理好重复以及过滤的逻辑。这个也是$接口依赖的方法。
         * ```javascript
         * var $body = $("body")
         * $body._$add($("tbody")) //==> 添加tbody
         * $body._$add($("tbody")) //==> 什么都不会发生 因为重复了
         * $body._$add(document.body.childNodes) //==> 添加所有的body下的子节点,过滤掉不符合的
         * ```
         * 
         * @method CHAINABLE._$add
         * @param  {Node|Array|_$$NodeList} _node 要添加的节点或节点集
         * @return {_$$NodeList}      返回this
         */
        _$add:function(_node){
            if(!_node) return;
            // TODO: 把window 排除在外
            if(_node.tagName || typeof _node.length !== "number" || _node === window ) _node = [_node];
            $._merge(this, _node, function(_nodum){
                if(!_isAcceptedNode(_nodum)) return false;
                var _uid = $._$uid(_nodum);
                if(this._signs[_uid]){
                    return false;
                }else{
                    this._signs[_uid] = 1;
                    return true;
                }
            });
            return this;
        },
        _$get:function(_index, wrap){
            if(typeof _index !== "number") return $._toArray(this);
            return wrap ? $(this[_index]) : this[_index];
        },
        _$last: function(wrap){
            return wrap? $(this[this.length-1]) : this[this.length-1];
        },
        _$first: function(wrap){
            return wrap? $(this[0]) : this[0];
        },
        /**
         * 判断包装节点是否满足某个选择器，即Selector API的matches方法。如果节点集内不止一个节点，则只判断第一个节点
         * Exmaple:
         * ```javascript
         *  $("body tbody td:nth-child(4n)")._$matches("body tbody td:nth-child(2n)")
         *  //返回 true... 这个是当然的, 4倍数的节点当然满足偶数条件
         * ```
         *
         * 
         * @method CHAINABLE._$matches
         * @param  {String} _selector 供测试的选择器
         * @return {Boolean}          是否通过测试
         */
        _$matches: function(_selector){
            return $._$matches(this[0],_selector);
        },
        /**
         * 查找 所有节点 的第一个(或所有)满足关系的 父节点 集, 并返回$NodeList
         *
         * Example:
         * ```javascript
         * $("tr")._$parent()
         * //=> ['tbody', 'thead'],两个是因为节点集中的tr元素可能在tbody或thead中
         * $("tr")._$parent("tbody")
         * //=> ['tbody'] 必须满足tbody
         * $("tr")._$parent(true)
         * // =>['tbody', 'thead', 'div', 'body' ....] //会向上查找所有父节点
         * $("tr")._$parent("tbody, body",true)
         * // =>['body', 'tbody'] //会向上查找所有父节点,但是必须满足选择器
         * ```
         * @method CHAINABLE._$parent
         * @param  {String} _selector 选择器
         * @param  {Boolean} _all     是否获取所有层级的父节点
         * @return {[type]}
         * @type {[type]}
         */
        _$parent: _traverse("parentNode"),
        /**
         * 与_$parent类似,查找 所有节点 的第一个(或所有根据_all参数)满足关系的 前序兄弟节点 (previousSibling)集, 并返回$NodeList
         * ```javascript
         * $("td")._$prev("th[scope=row]", true)
         * // 返回所有在td之前的th元素, 它们的scope属性为 row
         * $("td")._$prev("th[scope=row]")
         * // 只返回直接相邻的前节点，如果不满足选择器则返回空节点集
         * ```
         * @method CHAINABLE._$prev
         * @param  {String} _selector 选择器
         * @param  {Boolean} _all     是否获取所有前序节点
         * @return {[type]}
         */
        _$prev: _traverse("previousSibling"),
        /**
         * 与_$prev类似,查找 所有节点 的第一个(或所有根据_all参数)满足关系的 向后兄弟节点 (nextSibling)集, 并返回$NodeList
         * @method CHAINABLE._$next
         * @param  {String} _selector 选择器
         * @param  {Boolean} _all     是否获取所有后序节点
         * @return {[type]}
         */
        _$next: _traverse("nextSibling"),
        /**
         * 查找到 本节点集中 所有节点 的满足选择器关系的 直接子节点 (或 任意层级子节点 )集, 并返回$NodeList
         * ```javascript
         * $("body, table")._$children();
         * // => 相当于 合并body与table的直接子节点
         * $("body, table")._$children("div, thead");
         * // => 只要他们子节点中的div 与 thead元素
         * $("body, table")._$children(true);
         * // => 这里会获取所有body下的所有层级的子节点(table也在body中)
         * $("body, table")._$children("td:not(:last-child, :nth-child(2n))",true);
         * // => 返回所有层级的td元素并且满足选择器 td:not(:last-child, :nth-child(2n))
         * ```
         *
         * @method CHAINABLE._$children
         * @param  {String} _selector 选择器
         * @param  {Boolean} _all     是否获取所有层级的节点
         * @return {[type]}
         */
        _$children: function(_selector, _all){
            var _ret = $([]);
            if(typeof _selector === "boolean"){
                _all = _selector;
                _selector = null;
            }
            this._$forEach(function(_node){
                var _backed = _all? _t._$all(_selector || "*", _node)
                    : _selector? $(_node.childNodes)._$filter(_selector)
                    : $(_node.childNodes);
                _ret._$add(_backed);
            });
            return _ret;
        },
        /**
         * 满足选择器条件的同级节点，但不包含本身
         * Example
         * ```javascript
         * $("script")._$siblings("title,h2"); // => 返回script的同级节点中的
         * ```
         *
         * 
         * @method CHAINABLE._$siblings
         * @param  {String} _selector
         * @return {_$$NodeList}    这些同级节点会被包装为一个_$$NodeList
         */
        _$siblings: function(_selector){ // sibling 默认就是取所有
            return this._$prev(_selector, true)._$add(this._$next(_selector, true));
        },
        /**
         * 这个insert 拥有jQuery的四个接口的功能(before, after, prepend , append) ，分别用_direct参数控制
         *
         * Example:
         * ```javascript
         * //将`a.next`插到`#home`的内部的最上方
         * $('#home')._$insert('a.next', 'up');
         * //将a.next插入到`#home`节点后面
         * $('#home')._$insert('a.next', 'after');
         * ```
         *
         * @method CHAINABLE._$insert
         * @param  {String|Node|_$$NodeList} _selector 代表被插入的节点，可以是选择器、节点或是另外一个_$$NodeList对象
         * @param  {String} _direct   插入位置，可以是节点内的底部、顶部(bottom, top)，或节点同层的前后位置(before, after)，默认为bottom
         * @return {_$$NodeList}    返回this
         */
        _$insert: function(_selector, _direct){
            _direct = (_direct && _direct.toLowerCase()) || "bottom";
            if(!_definitions.insertor[_direct]) _direct = "bottom";
            var _content = $(_selector)[0], //将被插入的节点
                _insertor = _definitions.insertor[_direct];
            if(!_content) throw Error("The Element to be inserted is not exist");

            return this._$forEach(function(_node, _index){
                _insertor(_node, _index === 0? _content
                    : $._$cloneNode(_content, true));//如果是多个节点则cloneNode
            });
        },
        /**
         * 这个_$insert2 拥有jQuery的四个接口的功能(insertBefore, insertAfter, prependTo , appendTo) ，分别用_direct参数控制。其实就是_$insert接口的相反版，
         * 你做的是将被插入节点插入到某个节点的指定位置。
         *
         * Example:
         * ```javascript
         * //将`#home`插到`a.next`的内部的最上方
         * $('#home')._$insert2('a.next', 'up');
         * //将`#home`插入到`a.next`节点后面
         * $('#home')._$insert2('a.next', 'after');
         * ```
         *
         * @method CHAINABLE._$insert2
         * @param  {String|Node|_$$NodeList} _selector 代表参考节点，可以是选择器、节点或是另外一个_$$NodeList对象
         * @param  {String} _direct   插入位置，可以是节点内的底部、顶部(bottom, top)，或节点同层的前后位置(before, after)，默认为bottom
         * @return {_$$NodeList}    返回this
         */
        _$insert2: function(_selector, _direct){
            $(_selector)._$insert(this, _direct);
            return this;
        },
        /**
         * 克隆节点集内部的 所有节点, 并返回clone的目标节点集 $NodeList 实例
         *
         * Example:
         * ```javascript
         * $('.m-template')._$clone(true)._$insert2('body');//将`.m-template`节点clone一份插入到`body`的内部下方
         * ```
         *
         * @method CHAINABLE._$clone
         * @param  {Boolean} _withContent 是否要克隆子节点
         * @return {_$$NodeList}
         */
        _$clone: function(_withContent){
            return this._$map(function(_node){
                return $._$cloneNode(_node, _withContent);
            });
        },
        /**
         * 获得节点集中的 第一个元素的innerText 或者 设置所有元素的innerText
         *
         * Example:
         * ```javascript
         * $("title,h2")._$text("haha")
         * // 同时设置title与h2的text内容为haha
         * $("title,h2")._$text()
         * // 获得title(第一个元素)的innerText
         * ```
         *
         * 
         * @method CHAINABLE._$text
         * @param  {content} _content 要插入的内容 , 不传入则认为是getter操作
         * @return {_$$NodeList|String} setter操作返回_$$NodeList getter操作返回String
         */
        _$text: function(_content){
            if(_content === undefined){
                if(!this[0]) throw Error("内部节点为空，无法完成get操作");
                return this[0][_textHandle];
            }
            return this._$forEach(function(_node){
                _node[_textHandle] = _content;
            });
        },
        /**
         * 获得节点集中的 第一个元素的innerHTML 或者设置所有元素的innerHTML(与_$text接口类似)
         *
         * Example:
         * ```javascript
         * $("title,h2")._$html("haha")
         * // 同时设置title与h2的innerHTML为haha
         * $("title,h2")._$html()
         * // 获得title(第一个元素)的innerHTML
         * ```
         *
         * 
         * @method CHAINABLE._$html
         * @param  {content} _content 要插入的内容 不传入则认为是getter操作
         * @return {_$$NodeList|String} setter操作返回_$$NodeList getter操作返回String
         */
        _$html: function(_content){
            if(_content === undefined){
                if(!this[0]) throw Error("内部节点为空，无法完成get操作");
                return this[0].innerHTML;
            }
            return this._$forEach(function(_node){
                _node.innerHTML = _content;
            });
            return this;
        },
        /**
         * 获得节点集中的 第一个元素的value 或者设置所有元素的value(与_$text接口类似)
         *
         * Example:
         * ```javascript
         * $("input,textarea")._$val()
         * // 获取第一个满足'input,textarea'选择器元素的value值
         * $("title,h2")._$html("haha")
         * // 获得title(第一个元素)的innerHTML
         * ```
         *
         * 
         * @method CHAINABLE._$html
         * @param  {content} _content 要插入的内容
         * @return {_$$NodeList|String} setter操作返回_$$NodeList getter操作返回String
         */
        _$val:function(_content){
            if(_content === undefined){
                if(!this[0]) throw Error("内部节点为空，无法完成get操作");
                return this[0].value;
            }
            return this._$forEach(function(_node){
                _node.value = _content;
            });
            return this;
        },

        // 事件相关
        // ==============
        // 私有方法  注册事件代理
        _delegate:function(_event, _selector, _handler){
            _selector = $._cleanSelector(_selector);
            return this._$forEach(function(_node){
                var _uid = $._$uid(_node),
                    _handlers = $._delegateHandlers[_uid] || ($._delegateHandlers[_uid] = {}),
                    _events = _handlers[_event] || (_handlers[_event] = {}),
                    _selectors = _events[_selector] || (_events[_selector] = []);

                var _realCb = function(_e) {//正式回调
                    var _trigger;
                    if (_trigger = _bubbleUp(_selector, _e.target || _e.srcElement , _node)) {
                        _handler.apply(_trigger, arguments);
                    }
                };
                // ä¿å­˜å¼•ç”¨ ä»¥å¯ä»¥æ­£ç¡®off
                _realCb._raw = _handler;
                _selectors.push(_realCb);
                // å‡å¦‚ä¸å­˜åœ¨å¯¹åº”çš„å®¹å™¨ï¼Œåˆ™å…ˆåˆ›å»º
                _v._$addEvent(_node, _event, _realCb);
                // Fix: æˆ‘ä»¬ä¿å­˜åŽŸå§‹_handlerä¸ºäº† nejçš„ delEventå¯ä»¥æ­£ç¡®è§£ç»‘
                // çœåŽ»å†å­˜å‚¨ä¸€ä»½handleråˆ—è¡¨çš„å¼€é”€
            });
        },
        // ç§æœ‰æ–¹æ³• è§£ç»‘äº‹ä»¶ä»£ç†
        _undelegate:function(_event, _selector, _handler){
            _selector = $._cleanSelector(_selector);
            return this._$forEach(function(_node){
                var _uid = $._$uid(_node);
                var _handlers, _events, _selectors;
                if (!(_handlers = $._delegateHandlers[_uid]) ||
                    !(_events = _handlers[_event]) || !(_selectors = _events[_selector])){
                    return;
                }
                for(var _len = _selectors.length;_len--;){
                    var _fn = _selectors[_len];
                    //å¦‚æžœæ²¡æœ‰ä¼ å…¥_handleræˆ–è€… å‡½æ•°åŒ¹é…äº†
                    if(!_handler || _fn._raw === _handler){
                        _v._$delEvent(_node, _event, _fn);
                        _selectors.splice(_len,1);
                    }
                }
                // å¦‚æžœè¢«åˆ å…‰äº†
                if(!_selectors.length) delete _events[_selector];
            });
            return this;
        },
        /**
         * ç»‘å®šäº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶ä»£ç†, ä¸ŽjQueryçš„onç±»ä¼¼
         *
         * __Example:__
         * ```javascript
         * // 1. æ™®é€šäº‹ä»¶ç»‘å®š
         * $("body")._$on("click", function(_e){
         *     alert("å•ä¸ªäº‹ä»¶ç»‘å®š"+_e.type)
         * })
         * // 2. å¤šä¸ªæ™®é€šç±»åž‹ç»‘å®šåˆ°åŒä¸€ä¸ªhandler
         * $("body")._$on(["click", "mouseover"], function(_e){
         *     alert("å¤šä¸ªtypeç»‘å®š"+_e.type)
         * })
         * // 3. å•ä¸ªä»£ç†äº‹ä»¶ç»‘å®š è¿™é‡Œç­‰åŒäºŽ_$on("click", "tr:nth-child(2n)", handler)
         * $("body")._$on("click tr:nth-child(2n)", function(_e){
         *     // this å¯¹è±¡æŒ‡å‘å½“å‰`è§¦å‘`äº‹ä»¶çš„tr:nth-child(2n)
         *     _e.preventDefault()
         *     alert("å•ä¸ªä»£ç†äº‹ä»¶ç»‘å®š"+_e.type)
         * })
         * // 4. å¤šä¸ªäº‹ä»¶ç»‘å®š(åŒå›žè°ƒ), è¿™é‡Œåˆ†åˆ«æ˜¯æ™®é€šäº‹ä»¶dblclickä¸Žä»£ç†äº‹ä»¶click tr:nth-child(2n)
         * $("body")._$on(["dblclick", "click tr:nth-child(2n)"], function(_e){
         *     _e.preventDefault()
         *     alert("å¤šä¸ªäº‹ä»¶ç±»åž‹ç»‘å®š"+_e.type)
         * })
         * // 5. å¤šé‡äº‹ä»¶ç»‘å®š,
         * $("body")._$on({
         *     "dblclick":function(_e){
         *         alert("å¤šé‡äº‹ä»¶ç»‘å®šä¹‹æ™®é€šç‰ˆ"+_e.type)
         *     },
         *     "click tr:nth-child(2n)":function(_e){
         *         alert("å¤šé‡äº‹ä»¶ç»‘å®šä¹‹ä»£ç†ç‰ˆ"+_e.type)
         *     }
         * })
         * ```
         * 
         * @method CHAINABLE._$on
         * @param  {String|Array|Object} _event     äº‹ä»¶åï¼Œ_eventæ”¯æŒå¤šç§å‚æ•°ç±»åž‹ä¼šæœ‰ä¸åŒçš„ç»“æžœ
         *                             å¦‚æžœ_eventå‚æ•°ä¸­ä¸åŒ…å«ç©ºæ ¼, åˆ™è§†ä¸ºç®€å•äº‹ä»¶ç»‘å®šå¦‚ï¼Œclick,
         *                             å¦‚æžœ_eventå‚æ•°ä¸­åŒ…å«ç©ºæ ¼,åˆ™ä¼šè¢«split, å·¦è¾¹è§†ä¸ºeventå‚æ•°ï¼Œå³è¾¹è§†ä¸º_selectorå‚æ•°å¦‚'click .next',
         *                             å¦‚æžœ_eventæ˜¯ä¸ªOjbect,åˆ™ä¼šè§†ä¸ºå¤šé‡ç»‘å®š,å¦‚{'click .next': callback1, 'mouseover': callback2}
         *                             å¦‚æžœ_eventæ˜¯ä¸ªArray, åˆ™ä¼šå¯¹å¤šä¸ª_eventè¿›è¡ŒåŒä¸€ä¸ªå‡½æ•°çš„ç»‘å®š, å¦‚['click','mouseover']
         * @param  {String} _selector  å¦‚æžœä¼ å…¥åˆ™ä»£è¡¨æ˜¯ä¸€ä¸ªäº‹ä»¶ä»£ç†,å¯å¿½ç•¥
         * @param  {Function} _handler å›žæŽ‰å‡½æ•°
         * @return {_$$NodeList}
         */
        _$on:function(_event, _selector, _handler){
            if(_event === undefined) throw Error("ç¼ºå°‘äº‹ä»¶åå‚æ•°");
            if(typeof _selector === "function"){
                _handler = _selector;
                _selector = null;
            };
            var _index = _event.indexOf(" ");
            if(~_index){//æœ‰ç©ºæ ¼åˆ†éš” å¦‚"click div.m-model"
                _selector = _event.slice(_index + 1);
                _event = _event.slice(0, _index);
            }
            if(!_handler) throw Error("ç¼ºå°‘å›žè°ƒå‡½æ•°");
            // åˆ›å»ºä¸€ä¸ªrealHandler
            else {
                var _raw = _handler;
                var _handler = function(_e){
                    _definitions.fixture.event(_e);
                    _raw.apply(this, arguments);
                };
                _raw.real = _handler;//
            }
            if(_selector){ // on ("click", "li.clas1", handler)æˆ– on("click", "li.class1")
                return this._delegate(_event,_selector, _handler);
            }
            // on("click", handler)
            return this._$forEach(function(_node){
                _v._$addEvent(_node, _event, _handler);
            });
        }.splitProcess().autoSet(),

        /**
         * ä¸º èŠ‚ç‚¹é›†å†…çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ è§£é™¤äº‹ä»¶å›žè°ƒ, ç±»ä¼¼jQueryçš„offæ–¹æ³•
         * __Example__
         * ```javascript
         * // 1. æ™®é€šäº‹ä»¶è§£ç»‘
         * $("body")._$off("click", handler)
         * // 2. å¤šä¸ªæ™®é€šç±»åž‹äº‹ä»¶è§£ç»‘(åŒä¸€ä¸ªhandler)
         * $("body")._$off(["click", "mouseover"], handler)
         * // 3. æ™®é€šäº‹ä»¶æ¸…é™¤(å³ä¸ä¼ å…¥handler) __åŒæ—¶ä¼šæŠŠèŠ‚ç‚¹ä¸Šclickç±»åž‹çš„ä»£ç†äº‹ä»¶æ¸…é™¤!__
         * $("body")._$off("click")
         * // 4. å¤šä¸ªæ™®é€šäº‹ä»¶æ¸…é™¤ åŒæ—¶ä¼šæŠŠèŠ‚ç‚¹ä¸Šç›¸åº”ç±»åž‹çš„ä»£ç†äº‹ä»¶æ¸…é™¤!
         * $("body")._$off(["click","mouseover"])
         * // 5. å•ä¸ªä»£ç†äº‹ä»¶çš„è§£ç»‘
         * $("body")._$off("click","tr:nth-child(2n)", handler)
         * // æˆ–
         * $("body")._$off("click tr:nth-child(2n)", handler)
         * // 6. å¤šä¸ªä»£ç†äº‹ä»¶çš„è§£ç»‘(åŒä¸€ä¸ªhandler)
         * $("body")._$off(["dblclick td[title]", "click tr:nth-child(2n)"], handler)
         * // 7. ä»£ç†äº‹ä»¶çš„æ¸…é™¤
         * $("body")._$off("dblclick","td[title]");
         * $("body")._$off("dblclick td[title]");
         * $("body")._$off(["dblclick td[title]", "click tr:nth-child(2n)"])
         * // 8. å¤šé‡äº‹ä»¶è§£ç»‘
         * $("body")._$off({
         *     "dblclick td":handler1,
         *     "click tr":handler2
         * });
         * // 9. æ‰€æœ‰äº‹ä»¶æ¸…é™¤
         * $("body")._$off() //æ…Žé‡
         * ```
         *
         * 
         * @method CHAINABLE._$off
         * @param  {String|Array|Object} _event ä¸Ž_$onæ–¹æ³•ä¸€æ ·ï¼Œè§£ç»‘ä¹Ÿä¼šæ ¹æ®å‚æ•°ä¸åŒå¯ä»¥æœ‰å¾ˆå¤§çš„çµæ´»åº¦
         *                                      å¦‚æžœ_eventå‚æ•°ä¸­ä¸åŒ…å«ç©ºæ ¼, åˆ™è§†ä¸ºç®€å•äº‹ä»¶è§£ç»‘å¦‚ï¼Œclick,
         *                                      å¦‚æžœ_eventå‚æ•°ä¸­åŒ…å«ç©ºæ ¼,åˆ™ä¼šè¢«split, å·¦è¾¹è§†ä¸ºeventå‚æ•°ï¼Œå³è¾¹è§†ä¸º_selectorå‚æ•°å¦‚'click .next',
         *                                      å¦‚æžœ_eventæ˜¯ä¸ªOjbect,åˆ™ä¼šè§†ä¸ºå¤šé‡è§£ç»‘, å¦‚{'click .next': callback1, 'mouseover': callback2}
         *                                      å¦‚æžœ_eventæ˜¯ä¸ªArray, åˆ™ä¼šå¯¹å¤šä¸ª_eventè¿›è¡ŒåŒä¸€ä¸ªå‡½æ•°çš„è§£ç»‘, å¦‚['click','mouseover']
         *                                      éœ€è¦æ³¨æ„_$offä¸Ž_$onä¸åŒçš„æ˜¯_eventä¹Ÿå¯ä»¥æ˜¯ä¸ªç©ºå€¼ï¼Œä»£è¡¨ä¼šè§£å†³èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰äº‹ä»¶
         * @param  {[type]} _selector [description] å¦‚æžœä¼ å…¥_selectorå‚æ•°ï¼Œåˆ™ä¼šè¿›è¡Œäº‹ä»¶ä»£ç†çš„äº‹ä»¶è§£ç»‘, å¯å¿½ç•¥
         * @param  {[type]} _handler  [description] è¦è§£ç»‘å¯¹åº”å›žè°ƒï¼Œå¯å¿½ç•¥
         * @return {_$$NodeList}
         */
        _$off:function(_event, _selector, _handler){
            if(typeof _selector === "function"){
                _handler = _selector;
                _selector = null;
            }
            var _index;
            if(_event && ~(_index = _event.indexOf(" "))){//有空格分隔 如"click hello"
                _selector = _event.slice(_index + 1);
                _event = _event.slice(0, _index);
            }
            if(_handler) _handler = _handler.real || _handler;
            if(_selector){ // off("click", ".class")   off("click", ".class", handler)
                return this._undelegate(_event, _selector, _handler);
            }
            return this._$forEach(function(_node){
                var _uid = $._$uid(_node),
                    _handlers = $._delegateHandlers[_uid],
                    _events;
                if(!_event){ // off()
                    if(_handlers){
                        delete $._delegateHandlers[_uid]; // 删除所有
                    }
                    _v._$clearEvent(_node, _event);
                }else{
                    if(_handlers) _events = _handlers[_event];
                    if(!_handler){ // off("click")
                        if(_events){
                            delete _handlers[_event];
                        }
                        _v._$clearEvent(_node, _event);
                    }else{ // off("click", handler)
                        // 这里不对delegate做清理是因为 这样不会对delegate发生影响
                        _v._$delEvent(_node, _event, _handler);
                    }
                }
            });
        }.splitProcess().autoSet(),
        /**
         * 触发每个节点的对应事件, 同nej.v._$dispatchEvent，区别是参数类型自由度高一点
         *                                      如果_event参数为String, 则视为简单事件触发如，click,
         *                                      如果_event是个Ojbect,则会视为多重触发, 如{'click': param1, 'mouseover': param2}
         *                                      如果_event是个Array, 则会对多个_event进行触发(公用一个options), 如['click','mouseover']
         * Example:
         * ```javascript
         * //触发一个事件
         * _$trigger("click", params)
         * //一次触发多个事件(如果有参数，他们共用这个参数)
         * _$trigger(["click", "mouseover"], params)
         * // 触发多个事件有不同参数
         * _$trigger({
         *     "click": params1,
         *     "dblclick": params2
         * })
         * ```
         *
         * @method CHAINABLE._$trigger
         * @param  {String|Array|Object} _event   可以传入多种参数类型
         * @param  {Whatever} _options 同_$dispatchEvent的_options
         * @return {_$$NodeList}
         */
        _$trigger:function(_event, _options){
            if(typeof _event !== 'string') throw Error("事件类型参数错误");
            this._$forEach(function(_node){
                _v._$dispatchEvent(_node, _event, _options);
            });
            return this;
        }.splitProcess().autoSet(),

        // http://stackoverflow.com/questions/6599071/array-like-objects-in-javascript
        // 让这个对象看起来像数组
        splice: function(){ throw Error("don't use the NodeList#splice");}
    });
    // @ remove 无法被混淆的方法
    // // 无奈 添加 _$before // _$before2   _$bottom _$bottom2等方法
    // _u._$forIn(_definitions.insertor, function(_value, _key){
    //     $._$implement("_$" + _key, function(){
    //        var _args = _slice.call(arguments);
    //        _args.push(_key)
    //        return this._$insert.apply(this, _args)
    //     })
    //     $._$implement("_$" + _key+"2", function(){
    //        var _args = _slice.call(arguments);
    //        _args.push(_key)
    //        return this._$insert2.apply(this, _args)
    //     })
    // })

    // // 添加类似 _$click的事件
    // // ================================
    // // TODO: 检查是否有遗漏的方法
    //    @
    // var _beAttached = "click dbclick blur change focus focusin focusout keydown keypress keyup mousedown mouseover mouseup mousemove mouseout scroll select submit".split(" ");

    // @ remove 无法被混淆 移除
    // _u._$forEach(_beAttached, function(_eventName){
    //     $._$implement("_$"+_eventName, function(){
    //         var _type = typeof arguments[0];
    //         var _args = _slice.call(arguments);
    //         _args.unshift(_eventName);
    //         // click("li", handler)   或者  click(handler)
    //         if((_type == "function") || (_type === "string" && typeof arguments[1] === "function")){
    //             this._$on.apply(this, _args);
    //         }else{
    //         // click(options) 或者 click()
    //             this._$trigger.apply(this, _args);
    //         }
    //         return this;
    //     }.autoSet())
    // });
    // 把原型还回去, WARN:千万注意
    _fn.reset();
    
    if (CMPT){
        nej.$ = $;
    }
    
    return $;
},'b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','cefc834b106876d285d05b428248ca57','0b798b37310e41bdc73c7ed5b6638d62');
I$('ac1e584495dcf57f8a3472dfeddbf19b',function (_l){
    return _l;
},'2136bd70d3b73e965c72388f69873d99');
I$('88b09690bf9da6d44c6964c8030be9da',function (_k, _u, _v, _c, _d, p, pro) {
    p._$$CacheCliArg = _k._$klass();
    pro = p._$$CacheCliArg._$extend(_d._$$Cache);
    p._$cacheKey = 'cliarg';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__cacheKey = p._$cacheKey;
        this.__super(options);
    }

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {String} options.projectId - 参数所在项目标识
     * @property {String} options.type - 归属类型
     * @property {String} options.key - 键
     * @property {String} options.value - 值
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!_u._$isString(options.data.key) || !options.data.key.trim()) {
            // console.error('请输入有效的键名');
            return;
        }
        if (!_u._$isString(options.data.value) || !options.data.value.trim()) {
            // console.error('请输入有效的值名');
            return;
        }
        var onload = options.onload;
        options.onload = function (item) {
            this._splitListToCache([item], options, true);
            onload(item);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (data) {
            this._splitListToCache(data.params, options);
            onload(data);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 将列表数据按照type值分片, 存到缓存中
     * @param {Object} list - 命令行参数列表
     * @param {Object} options - 发送请求时携带的参数对象
     * @param {Boolean} [isAppend] - 是否追回
     */
    pro._splitListToCache = function (list, options, isAppend) {
        var types = {};
        list.forEach(function (item) {
            if (!types.hasOwnProperty(item.type)) {
                types[item.type] = [];
            }
            types[item.type].push(item);
        });
        Object.keys(types).forEach(function (type) {
            var listKey = options.key + '-' + type;
            var listData = types[type];
            if (isAppend) {
                var existList = this._$getListInCache(listKey);
                listData = listData.concat(existList);
            }
            this._$setListInCache(listKey, listData);
        }.bind(this));
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - id
     * 支持更新的字段有:
     * @property {String} [options.key] - 键
     * @property {String} [options.value] - 值
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(p._$cacheKey) > -1) {
            url = '/api/cliargs/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('cc04b9f6ed49f9ff59e36f80707cf153',function (_k, _u, _v, _c, _d, pageCache, groupCache, datatypeCache, _p, _pro) {
    _p._$$CacheTemplate = _k._$klass();
    _pro = _p._$$CacheTemplate._$extend(_d._$$Cache);
    _p._$cacheKey = 'template';
    _p._$cacheRefKey = 'template-ref-';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    }

    /**
     * 新建模板
     * @param {Object} options - 参数对象
     * @property {String} options.projectId - 模板所在的项目id
     * @property {String} options.name - 名称
     * @property {String} options.path - 路径
     * @property {String} [options.tag=''] - 标签
     * @property {String} [options.description=''] - 描述信息
     * @property {Array} [options.parameters=[]] - 参数
     * @property {String} [options.respoId=''] - 负责人id
     * @property {String} [options.groupId=''] - 所在业务分组id
     * @property {Array} [options.imports=[]] - 导入的数据模型
     * @success dispatch event: onitemadd
     */
    _pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        options.data.path = options.data.path.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('请输入有效的模板名称');
            return;
        }
        if (!_u._$isString(options.data.path)) {
            // console.error('请输入有效的模板地址');
            return;
        }
        var onload = options.onload;
        options.onload = function (result) {
            var _cache = datatypeCache._$$CacheDatatype._$allocate();
            var key = _cache._$getListKey(result.projectId);
            if (result.hasOwnProperty('hiddenDts')) { //如果存在匿名类型，需要将匿名类型添加到datatype cache中
                _cache.__doUnshiftToList(key, result.hiddenDts);
            }
            _cache._$recycle();
            onload(result);
        };
        this.__super(options);
    };

    /**
     * 更新模板
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 模板 id
     * 支持更新的字段有:
     * @property {String} [options.name] - 名称
     * @property {String} [options.tag] - 标签
     * @property {String} [options.path] - 路径
     * @property {String} [options.description] - 描述
     * @property {Array} [options.parameters] - 参数列表
     * @property {Array} [options.respoId] - 负责人id
     * @property {Array} [options.groupId] - 业务分组id
     * @property {Array} [options.imports] - 导入的参数列表
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 验证项缓存中的项是否有效，子类可重写
     *
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  _item - æ•°æ®é¡¹
     * @param  {String}  _lkey - åˆ—è¡¨æ ‡è¯†
     * @return {Boolean}        æ˜¯å¦æœ‰æ•ˆ
     */
    _pro.__doCheckItemValidity = function (_item, _lkey) {
        // å¦‚æžœæ²¡æœ‰ params å±žæ€§, åˆ™åœ¨è°ƒç”¨ $getItem æ–¹æ³•æ—¶éœ€è¦é‡æ–°èŽ·å–æ•°æ®
        return _item.params;
    };

    /**
     * æ ¹æ®å‚æ•°, èŽ·å–è¯·æ±‚ url
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        if (options.key === _p._$cacheRefKey) {
            url = '/api/templates' + options.id + '?ref';
        } else if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/templates/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * ä»ŽæœåŠ¡å™¨èŽ·å–å¼•ç”¨æŸä¸ªé¡µé¢æ¨¡æ¿çš„é¡µé¢åˆ—è¡¨
     * @param {Object} options - å‚æ•°
     * @property {Number} options.id - é¡µé¢æ¨¡æ¿çš„id
     * @success dispatch event: onreflistload
     */
    _pro._$getRefList = function (options) {
        var refKey = _p._$cacheKeyRef + options.id;
        this.__getRefList(
            refKey,
            {
                pc: pageCache._$$CachePage._$allocate()
            },
            options
        );
    };
    /**
     * å¤åˆ¶æ¨¡æ¿
     * @param options é…ç½®å‚æ•°
     * @property {String} options.key cacheæ‰€éœ€çš„key
     * @property {Number} options.data.pid é¡¹ç›®id
     * @property {Number} options.data.gid åˆ†ç»„id
     * @property {Array} options.data.copys å¤åˆ¶çš„æ¨¡æ¿æ•°æ®
     * @property {String} options.data.tags æ ‡ç­¾
     */
    _pro._$clone = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'clone',
            actionMsg: options.actionMsg,
            onload: function () {
                //æ¸…ç©ºå¤åˆ¶åˆ°çš„é¡¹ç›®çš„template cache
                this._$clearListInCache(options.key);
                //å¤åˆ¶æ¨¡æ¿çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿæ–°çš„åŒ¿åç±»åž‹ï¼Œè¿™æ—¶å€™æ¸…ç©ºç¼“å­˜ï¼Œä¸ç»´æŠ¤æ•°æ®æ¨¡åž‹ç¼“å­˜ï¼ŒåŽé¢ä¼šé‡æ–°åŠ è½½æ•°æ®æ¨¡åž‹åˆ—è¡¨
                var dtCache = datatypeCache._$$CacheDatatype._$allocate();
                dtCache._$clearListInCache(dtCache._$getListKey(options.data.pid));
                dtCache._$recycle();
                this._$dispatchEvent('onclone', {pid: options.data.pid});
            }.bind(this)
        });
    };
    /**
     * ç§»åŠ¨æ¨¡æ¿
     * @param options é…ç½®å‚æ•°
     * @property {String} options.key cacheæ‰€éœ€çš„key
     * @property {Number} options.data.pid é¡¹ç›®id
     * @property {Number} options.data.gid åˆ†ç»„id
     * @property {Array} options.data.moves ç§»åŠ¨çš„æ¨¡æ¿æ•°æ®
     * @property {String} options.data.tags æ ‡ç­¾
     */
    _pro._$move = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'move',
            actionMsg: options.actionMsg,
            onload: function () {
                //æ¸…ç©ºå¤åˆ¶åˆ°çš„é¡¹ç›®çš„datatype cache
                this._$clearListInCache(options.key);
                this._$dispatchEvent('onmove', {pid: options.data.pid});
            }.bind(this)
        });
    };
    /**
     * æ‰¹é‡è®¾ç½®åˆ†ç»„
     * @param options é…ç½®å‚æ•°
     * @property {String} options.key cacheæ‰€éœ€çš„key
     * @property {Array} options.data.ids æ‰¹é‡èµ„æºid
     * @property {Number} options.data.groupId åˆ†ç»„id
     */
    _pro._$setGroup = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bisgroup',
            actionMsg: options.actionMsg,
            onload: function () {
                //ä¿®æ”¹æ‰€é€‰æ•°æ®æ¨¡åž‹çš„åˆ†ç»„
                var _groupCache = groupCache._$$CacheGroup._$allocate();
                var groupId = options.data.groupId, group = _groupCache._$getItemInCache(groupId);
                options.data.ids.forEach(function (id) {
                    var template = this._$getItemInCache(id);
                    template.groupId = groupId;
                    template.group = group;
                }.bind(this));
                this._$dispatchEvent('onsetgroup');
                _groupCache._$recycle();
            }.bind(this)
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','8c66819555c8938ee8838636d552569a','7c1169d958213d2faeb6056f33ac4ad6','afd9bc71d3ea5904e51ae183b2351b6e');
I$('8c66819555c8938ee8838636d552569a',function (_k, _u, _v, _c, _d, interCache, templateCache, groupCache, datatypeCache, _p, _pro) {
    _p._$$CachePage = _k._$klass();
    _pro = _p._$$CachePage._$extend(_d._$$Cache);
    _p._$cacheKey = 'page';

    /**
     * åˆå§‹åŒ–
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * æ–°å»ºé¡µé¢
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @property {String} options.projectId - æ‰€åœ¨çš„é¡¹ç›®id
     * @property {String} options.name - åç§°
     * @property {String} options.path - è·¯å¾„
     * @property {String} [options.tag=''] - æ ‡ç­¾
     * @property {String} [options.description=''] - æè¿°ä¿¡æ¯
     * @property {Array} [options.parameters=[]] - å‚æ•°
     * @property {Array} options.templateIds - å¼•ç”¨çš„æ¨¡æ¿idåˆ—è¡¨
     * @property {Array} [options.interfaceIds=[]] - å¼•ç”¨çš„å¼‚æ­¥æŽ¥å£idåˆ—è¡¨
     * @property {String} [options.respoId=''] - è´Ÿè´£äººid
     * @property {String} [options.groupId=''] - æ‰€åœ¨ä¸šåŠ¡åˆ†ç»„id
     * @property {Array} [options.imports=[]] - å¯¼å…¥çš„æ•°æ®æ¨¡åž‹
     * @success dispatch event: onitemadd
     */
    _pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        options.data.path = options.data.path.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('è¯·è¾“å…¥æœ‰æ•ˆçš„é¡µé¢åç§°');
            return;
        }
        if (!_u._$isString(options.data.path)) {
            // console.error('è¯·è¾“å…¥æœ‰æ•ˆçš„é¡µé¢åœ°å€');
            return;
        }
        var onload = options.onload;
        options.onload = function (result) {
            var _cache = datatypeCache._$$CacheDatatype._$allocate();
            var key = _cache._$getListKey(result.projectId);
            if (result.hasOwnProperty('hiddenDts')) { //å¦‚æžœå­˜åœ¨åŒ¿åç±»åž‹ï¼Œéœ€è¦å°†åŒ¿åç±»åž‹æ·»åŠ åˆ°datatype cacheä¸­
                _cache.__doUnshiftToList(key, result.hiddenDts);
            }
            _cache._$recycle();
            onload(result);
        };
        this.__super(options);
    };

    /**
     * æ›´æ–°é¡µé¢
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @property {Number} options.id - èµ„æº id
     * æ”¯æŒæ›´æ–°çš„å­—æ®µæœ‰:
     * @property {String} [options.name] - åç§°
     * @property {String} [options.tag] - æ ‡ç­¾
     * @property {String} [options.path] - è·¯å¾„
     * @property {String} [options.description] - æè¿°
     * @property {Array} [options.interfaceIds] - å¼•ç”¨çš„å¼‚æ­¥æŽ¥å£idåˆ—è¡¨
     * @property {Array} [options.templateIds] - å¼•ç”¨çš„æ¨¡æ¿idåˆ—è¡¨
     * @property {Array} [options.parameterIds] - å‚æ•°åˆ—è¡¨
     * @property {Array} [options.respoId] - è´Ÿè´£äººid
     * @property {Array} [options.groupId] - ä¸šåŠ¡åˆ†ç»„id
     * @property {Array} [options.imports] - å¯¼å…¥çš„å‚æ•°åˆ—è¡¨
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (page) {
            this._updateListCache(page);
            onload(page);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 加载某一项
     * @param {Object} [options] - 参数对象
     * @property {Number} options.id - 要加载资源的id
     * @property {String} options.key - 这个 key 主要用于获取相应的 url
     * @success dispatch event: onloaditem
     */
    _pro.__doLoadItem = function (options) {
        var onload = options.onload;
        options.onload = function (page) {
            this._updateListCache(page);
            onload(page);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 将页面中的模板列表或者接口列表存到相应的缓存中去, 分加载和更新两种情况:
     * 1. 加载页面详情时, 直接将数据存到相应的缓存中
     * 2. 并不是所有的更新操作后端都会返回 interfaces 和 templates 信息, 这里只在后端返回 interfaces 或者 templates 信息的时候更新相应的缓存
     * @param {Object} page - 页面对象
     */
    _pro._updateListCache = function (page) {
        if (page.hasOwnProperty('interfaces')) {
            var _interCache = interCache._$$CacheInterface._$allocate();
            _interCache._$setListInCache(_interCache._$getListKey(page.projectId, page.id), page.interfaces);
            _interCache._$recycle();
        }
        if (page.hasOwnProperty('templates')) {
            var _tplCache = templateCache._$$CacheTemplate._$allocate();
            _tplCache._$setListInCache(_tplCache._$getListKey(page.projectId, page.id), page.templates);
            _tplCache._$recycle();
        }
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url = '/api/pages/' + (options.id || '');
        if (options.action) {
            url += '?' + options.action;
        }
        return url;
    };

    /**
     * 验证项缓存中的项是否有效，子类可重写
     *
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  _item - 数据项
     * @param  {String}  _lkey - 列表标识
     * @return {Boolean}        是否有效
     */
    _pro.__doCheckItemValidity = function (_item, _lkey) {
        // 如果没有 params 属性, 则在调用 $getItem 方法时需要重新获取数据
        return _item.params;
    };
    /**
     * 复制页面
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.copys 复制的页面数据
     * @property {String} options.data.tags 标签
     */
    _pro._$clone = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'clone',
            actionMsg: options.actionMsg,
            onload: function () {
                //清空复制到的项目的页面 cache
                this._$clearListInCache(options.key);
                //复制模板的时候，有可能会产生新的匿名类型，这时候清空缓存，不维护数据模型缓存，后面会重新加载数据模型列表
                var dtCache = datatypeCache._$$CacheDatatype._$allocate();
                dtCache._$clearListInCache(dtCache._$getListKey(options.data.pid));
                dtCache._$recycle();
                this._$dispatchEvent('onclone', {pid: options.data.pid});
            }.bind(this)
        });
    };
    /**
     * 移动页面
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.moves 移动的页面数据
     * @property {String} options.data.tags 标签
     */
    _pro._$move = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'move',
            actionMsg: options.actionMsg,
            onload: function () {
                //清空复制到的项目的datatype cache
                this._$clearListInCache(options.key);
                this._$dispatchEvent('onmove', {pid: options.data.pid});
            }.bind(this)
        });
    };
    /**
     * 批量设置分组
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Array} options.data.ids 批量资源id
     * @property {Number} options.data.groupId 分组id
     */
    _pro._$setGroup = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bisgroup',
            actionMsg: options.actionMsg,
            onload: function () {
                //修改所选数据模型的分组
                var _groupCache = groupCache._$$CacheGroup._$allocate();
                var groupId = options.data.groupId, group = _groupCache._$getItemInCache(groupId);
                options.data.ids.forEach(function (id) {
                    var page = this._$getItemInCache(id);
                    page.groupId = groupId;
                    page.group = group;
                }.bind(this));
                this._$dispatchEvent('onsetgroup');
                _groupCache._$recycle();
            }.bind(this)
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','7385ee68edde0ba303fb20b28ecfb227','cc04b9f6ed49f9ff59e36f80707cf153','7c1169d958213d2faeb6056f33ac4ad6','afd9bc71d3ea5904e51ae183b2351b6e');
I$('7385ee68edde0ba303fb20b28ecfb227',function (_k, _u, _v, _c, _d, pageCache, dataTypeCache, pgCache, proCache, groupCache, _p, pro) {
    _p._$$CacheInterface = _k._$klass();
    pro = _p._$$CacheInterface._$extend(_d._$$Cache);
    _p._$cacheKey = 'interface';
    _p._$cacheRefKey = 'interface-ref-';
    _p._$cacheBatKey = 'interface-bat';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            this.__setShareTagOnItems(result);
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {Number} options.projectId - 所在项目的id
     * @property {String} options.name - 名称
     * @property {String} options.path - 异步接口请求地址
     * @property {String} options.method - 异步接口请求方式
     * @property {String} [options.className=''] - 代码映射(接口类名)
     * @property {String} [options.tag=''] - 标签
     * @property {String} [options.description=''] - 描述信息
     * @property {String} [options.respoId=''] - 负责人id
     * @property {String} [options.groupId=''] - 所在业务分组id
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        options.data.path = options.data.path.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('请输入有效的接口名称');
            return;
        }
        if (!_u._$isString(options.data.path)) {
            // console.error('请输入有效的接口地址');
            return;
        }
        var onload = options.onload;
        options.onload = function (item) {
            // 如果是在公共资源库添加了数据模型, 则需要更新所有项目组中的所有项目的数据模型列表
            var _proCache = proCache._$$CachePro._$allocate();
            if (_proCache._$isPublic(item.projectId)) {
                // 是公共资源库
                item.__isShare = true; // 设置共享标记
                var allProjects = _proCache.__getHash();
                Object.keys(allProjects).forEach(function (projectId) {
                    var project = allProjects[projectId];
                    if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                        // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                        this.__doUnshiftToList(this._$getListKey(project.id), item);
                    }
                }, this);
            }
            _proCache._$recycle();
            onload(item);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 资源 id
     * 支持更新的字段有:
     * @property {String} [options.name] - 名称
     * @property {String} [options.tag] - 标签
     * @property {String} [options.path] - 路径
     * @property {String} [options.description] - 描述
     * @property {Array} [options.parameters] - 参数列表
     * @property {Array} [options.respoId] - 负责人id
     * @property {Array} [options.groupId] - 业务分组id
     * @property {Array} [options.imports] - 导入的参数列表
     * @property {Number} [options.reqFormat] - 请求参数类别
     * @property {Array} [options.resFormat] - 响应参数类别
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            // 在修改 reqFormat 和 resFormat 的时候, 后端只返回 params 相应的参数(inputs 或者 outputs), 不能直接交给 nej 处理, 不然其他参数会丢失
            var interfaceData = this._$getItemInCache(result.id);
            Object.keys(interfaceData.params).forEach(function (item) {
                if (!result.params.hasOwnProperty(item)) {
                    result.params[item] = interfaceData.params[item];
                }
            });
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key === _p._$cacheRefKey) {
            url = '/api/interfaces' + options.id + '?ref';
        } else if (options.key === _p._$cacheBatKey) {
            url = '/api/interfaces?bat';
        } else if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/interfaces/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 设置 __isShare 属性
     * @param  {Array} items - 列表项
     */
    pro.__setShareTagOnItems = function (items) {
        // 接口列表的请求, 设置 __isShare 字段
        var _proCache = proCache._$$CachePro._$allocate();
        items.forEach(function (item) {
            // 资源共享与否, 就看它所属的项目是否为公共资源库
            // 设置 __isShare 字段
            item.__isShare = item.id > 10003 && _proCache._$isPublic(item.projectId);
        });
        _proCache._$recycle();
    };

    /**
     * 验证项缓存中的项是否有效，子类可重写
     *
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  _item - 数据项
     * @param  {String}  _lkey - 列表标识
     * @return {Boolean}        是否有效
     */
    pro.__doCheckItemValidity = function (_item, _lkey) {
        // 如果没有 params 属性, 则在调用 $getItem 方法时需要重新获取数据
        return _item.hasOwnProperty('params');
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        options.onload = function (event) {
            // 如果删除的是公共资源库中的异步接口, 则其他项目(同个项目组)中对应的异步接口也删除
            var _proCache = proCache._$$CachePro._$allocate();
            var deletedList = event.data;
            deletedList.forEach(function (item) {
                if (_proCache._$isPublic(item.projectId)) {
                    // 是公共资源库
                    var allProjects = _proCache.__getHash();
                    Object.keys(allProjects).forEach(function (projectId) {
                        var project = allProjects[projectId];
                        if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                            // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                            this.__doRemoveItemFromList(this._$getListKey(project.id), item);
                        }
                    }, this);
                }
                delete this.__getHash()[item.id];
            }, this);
            _proCache._$recycle();
        }.bind(this);
        this.__super(options);
    };

    /**
     * 共享
     * @param {Object} options - 参数对象
     * @property {id} options.id 接口id
     * @success dispatch event: onshare
     */
    pro._$share = function (options) {
        this.__doAction({
            data: {
                isShare: 1
            },
            id: options.id,
            method: 'PUT',
            action: 'share',
            onload: function (evt) {
                var list = this._$getListInCache(options.ext.cacheKey);
                // 更新异步接口单条数据
                var sharedItem = list.find(function (item) {
                    return item.id === evt.data.interface.id;
                });
                // 分享后, 它的 projectId 有变化了, 需要更新
                Object.assign(sharedItem, evt.data.interface);
                // 设置分享字段
                sharedItem.__isShare = true;
                var _proCache = proCache._$$CachePro._$allocate();
                var publicProject = _proCache._$getPublicById(sharedItem.projectId);
                // 分享的资源, 需要加到公共资源库去中
                var listKey = this._$getListKey(publicProject.id);
                var projectList = this._$getListInCache(listKey);
                var found = projectList.find(function (it) {
                    return it.id == sharedItem.id;
                });
                if (!found) {
                    // __doUnshiftToList 方法并没有判断是否已经存在
                    this.__doUnshiftToList(this._$getListKey(publicProject.id), sharedItem);
                }
                // 更新被共享的数据模型列表
                var dc = dataTypeCache._$$CacheDatatype._$allocate();
                dc._$setSharedItems(evt.data.datatypes, dc._$getListKey(options.ext.pid));
                this._$dispatchEvent('onshare', evt);
            }.bind(this)
        });
    };

    /**
     * 从服务器获取引用某个异步接口的页面列表
     * @param {Object} options - 参数
     * @property {Number} options.id - 异步接口的id
     * @success dispatch event: onreflistload
     */
    pro._$getRefList = function (options) {
        var refKey = _p._$cacheKeyRef + options.id;
        this.__getRefList(
            refKey,
            {
                pc: pageCache._$$CachePage._$allocate()
            },
            options
        );
    };

    /**
     * 批量获取接口详情
     * @param {Object} options - 参数
     * @property {String} options.ids - 异步接口的 id 列表, 以逗号分隔
     * @success dispatch event: oncustomlistload
     */
    pro._$getCustomList = function (options) {
        var key = _p._$cacheBatKey;
        var callback = this._$dispatchEvent._$bind(
            this, 'oncustomlistload', {key: key, ext: options.ext}
        );
        var url = this.__getUrl({
            key: key
        });
        // 过滤掉已经存在在缓存中的数据
        var sendIds = [];
        var ids = options.ids.split(',');
        ids.forEach(function (id) {
            var item = this._$getItemInCache(id);
            if (!item || !item.hasOwnProperty('params')) {
                // 接口不存在或者还没有详情数据
                sendIds.push(id);
            }
        }, this);
        if (sendIds.length === 0) {
            // 缓存中已经有所有的数据
            return callback();
        }
        this.__sendRequest(url, {
            data: {
                ids: sendIds.join(',')
            },
            onload: function (result) {
                // 缓存数据
                result.forEach(function (item) {
                    this.__doSaveItemToCache(item);
                }, this);
                callback();
            }.bind(this)
        });
    };
    /**
     * 复制异步接口
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.copys 复制的异步接口数据
     * @property {String} options.data.tags 标签
     */
    pro._$clone = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'clone',
            actionMsg: options.actionMsg,
            onload: function () {
                //清空复制到的项目的interface cache
                this._$clearListInCache(options.key);
                //复制接口的时候，有可能会产生新的匿名类型，这时候清空缓存，不维护数据模型缓存，后面会重新加载数据模型列表
                var dtCache = dataTypeCache._$$CacheDatatype._$allocate();
                dtCache._$clearListInCache(dtCache._$getListKey(options.data.pid));
                dtCache._$recycle();
                this._$dispatchEvent('onclone', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 移动异步接口
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.moves 移动的异步接口数据
     * @property {String} options.data.tags 标签
     */
    pro._$move = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'move',
            actionMsg: options.actionMsg,
            onload: function () {
                // 接口被移动后，它的参数可能会发生变化，这里将它们的参数删除
                options.data.moves.forEach(function (itf) {
                    delete this._$getItemInCache(itf).params;
                }, this);
                // 接口被移动后，在目标项目可能会生成新的数据模型，这里清除目标项目的数据模型列表
                var _dtCache = dataTypeCache._$$CacheDatatype._$allocate();
                _dtCache._$clearListInCache(options.data.pid);

                var _proCache = proCache._$$CachePro._$allocate();
                if (options.ext.isPublic) { //对于移动到公共资源库，需要将该项目下的所有项目的cache清空
                    var group = _proCache._$getProgroupByProId(options.ext.originPid);
                    group.projects.forEach(function (item) {
                        this._$clearListInCache(this._$getListKey(item.id));
                    }.bind(this));
                } else {
                    //从当前项目cache中删除移动项，并清空目标项目cache数据
                    this._$clearListInCache(options.key);
                }
                this._$dispatchEvent('onmove', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 批量创建CRUD接口
     * @param options 配置参数
     * @property {Number} options.data.pid 项目id
     * @property {Array} options.data.items 创建接口的配置数据
     * @property {String} options.data.items.tag 接口标签
     * @property {Number} options.data.items.gid 接口分组id
     * @property {Array} options.data.items.interfaces 接口数据
     * @property {String} options.data.items.interfaces.name 接口名称
     * @property {String} options.data.items.interfaces.method 接口请求方法
     * @property {String} options.data.items.interface.path 接口路径
     * @private
     */
    pro._$crud = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'crud',
            onload: function () {
                this._$clearListInCache(options.key);
                this._$dispatchEvent('oncrud');
            }.bind(this)
        });
    };
    /**
     * 批量设置分组
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Array} options.data.ids 批量资源id
     * @property {Number} options.data.groupId 分组id
     */
    pro._$setGroup = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bisgroup',
            actionMsg: options.actionMsg,
            onload: function () {
                //修改所选数据模型的分组
                var _groupCache = groupCache._$$CacheGroup._$allocate();
                var groupId = options.data.groupId, group = _groupCache._$getItemInCache(groupId);
                options.data.ids.forEach(function (id) {
                    var interface = this._$getItemInCache(id);
                    interface.groupId = groupId;
                    interface.group = group;
                }.bind(this));
                this._$dispatchEvent('onsetgroup');
                _groupCache._$recycle();
            }.bind(this)
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','8c66819555c8938ee8838636d552569a','afd9bc71d3ea5904e51ae183b2351b6e','e8507450a35f1adad6e9dae810fd545a','09437bf7199eb808a35a38e5178e5151','7c1169d958213d2faeb6056f33ac4ad6');
I$('afd9bc71d3ea5904e51ae183b2351b6e',function (_k, _u, _v, _c, _d, interfaceCache, pageCache, templateCache, pgCache, proCache, groupCache, _p, pro) {
    _p._$$CacheDatatype = _k._$klass();
    pro = _p._$$CacheDatatype._$extend(_d._$$Cache);
    _p._$cacheKey = 'datatype';
    _p._$cacheKeyRef = 'datatype-ref-';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            this.__setShareTagOnItems(result);
            result = result.filter(function (item) {
                this._setAnon(item);
                // 过滤掉"未知类型"
                return item.id >= 9999;
            }, this);
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 如果是匿名类型, 列表中不需要显示, 这里加个自定义属性
     * @param {Object} item - 模型对象
     */
    pro._setAnon = function (item) {
        if (item.type === this._dbConst.MDL_TYP_HIDDEN && item.id > 10003) {
            item.__isAnon = true;
        }
    }

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {Number} options.projectId - 所在项目的id
     * @property {String} options.name - 名称
     * @property {String} options.format - 数据模型的类型
     * @property {String} options.type - 数据模型形式
     * @property {String} [options.tag=''] - 标签
     * @property {String} [options.description=''] - 描述信息
     * @property {String} [options.groupId=''] - 所在业务分组id
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('请输入有效的名称');
            return;
        }
        options.onload = function (data) {
            var items = [];
            if (data.hasOwnProperty('hiddenDts')) { //这里数据模型可能包含匿名数据模型
                items = data.hiddenDts.splice(0);
                delete data.hiddenDts;
            }
            items.push(data);
            // 如果是在公共资源库添加了数据模型, 则需要更新所有项目组中的所有项目的数据模型列表
            var _proCache = proCache._$$CachePro._$allocate();
            items.forEach(function (item) {
                this._setAnon(item);
                if (_proCache._$isPublic(item.projectId)) {
                    // 是公共资源库
                    item.__isShare = true; // 设置共享标记
                    var allProjects = _proCache.__getHash();
                    Object.keys(allProjects).forEach(function (projectId) {
                        var project = allProjects[projectId];
                        if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                            // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                            this.__doUnshiftToList(this._$getListKey(project.id), item);
                        }
                    }, this);
                }
                this.__doUnshiftToList(options.key, item);
            }.bind(this));
            _proCache._$recycle();
            this._$dispatchEvent('onitemadd', _u._$merge(options, {data: data}));
        }.bind(this);
        this.__super(options);
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 资源 id
     * 支持更新的字段有:
     * @property {String} [options.name] - 名称
     * @property {String} [options.tag] - 标签
     * @property {String} [options.description] - 描述
     * @property {Array} [options.groupId] - 业务分组id
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            var _groupCache = groupCache._$$CacheGroup._$allocate();
            // 如果更新分组id，则需要将数据中的group更新
            if (options.data.hasOwnProperty('groupId')) {
                result.group = _groupCache._$getItemInCache(result.groupId);
            }
            // 如果更新的是数据模型名称, 则更新完成后, 还需要更新引用了它的数据模型、异步接口、页面模板
            // 后端返回的是所有需要更新的数据模型列表, 包括当前被修改的数据模型
            if (options.data.hasOwnProperty('name')) {
                this._updateResources(result, options);
            }
            _groupCache._$recycle();
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 根据分组id返回该分组下的数据模型列表
     * @param {Number} groupId - 分组id
     * @return {Array} 数据模型列表
     */
    pro._$getListByGroupId = function (groupId) {
        var list = this._$getListInCache(this.__cacheKey);
        return list.filter(function (item) {
            return item.group.id === groupId;
        });
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/datatypes/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 设置 __isShare 属性
     * @param  {Array} items - 列表项
     */
    pro.__setShareTagOnItems = function (items) {
        var _proCache = proCache._$$CachePro._$allocate();
        items.forEach(function (item) {
            // 资源共享与否, 就看它所属的项目是否为公共资源库
            // 设置 __isShare 字段
            item.__isShare = item.id > 10003 && _proCache._$isPublic(item.projectId);
        });
        _proCache._$recycle();
    };

    /**
     * 验证项缓存中的项是否有效，子类可重写
     *
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  _item - 数据项
     * @param  {String}  _lkey - 列表标识
     * @return {Boolean}        是否有效
     */
    pro.__doCheckItemValidity = function (_item, _lkey) {
        // 如果没有 params 属性, 则在调用 $getItem 方法时需要重新获取数据
        return _item.params;
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        options.onload = function (event) {
            // 如果删除的是公共资源库中的数据模型, 则其他项目(同个项目组)中对应的数据模型也删除
            var _proCache = proCache._$$CachePro._$allocate();
            var deletedList = event.data;
            deletedList.forEach(function (item) {
                if (_proCache._$isPublic(item.projectId)) {
                    // 是公共资源库
                    var allProjects = _proCache.__getHash();
                    Object.keys(allProjects).forEach(function (projectId) {
                        var project = allProjects[projectId];
                        if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                            // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                            this.__doRemoveItemFromList(this._$getListKey(project.id), item);
                        }
                    }, this);
                }
            }, this);
            _proCache._$recycle();
        }.bind(this);
        this.__super(options);
    };

    /**
     * 共享
     * @param {Object} options - 参数对象
     * @property {id} options.id - 数据模型id
     * @success dispatch event: onshare
     */
    pro._$share = function (options) {
        this.__doAction({
            data: {
                isShare: 1
            },
            id: options.id,
            method: 'PUT',
            action: 'share',
            onload: function (evt) {
                this._$setSharedItems(evt.data, options.ext.cacheKey);
                this._$dispatchEvent('onshare', evt);
            }.bind(this)
        });
    };

    /**
     * 设置共享属性
     * @param {Array} items - 被共享的数据模型列表
     * @param {String} cacheKey - 当前项目中的存储数据模型列表的缓存key
     */
    pro._$setSharedItems = function (items, cacheKey) {
        var list = this._$getListInCache(cacheKey);
        if (!list.length) {
            // 该方法在共享异步接口的时候也会调用, 有可能还未加载过数据模型列表
            return;
        }
        var _pgCache = pgCache._$$CacheProGroup._$allocate();
        // 分享时, 被它引用的数据模型也会被分享, 此时后端返回的是一个数组, 数组里面的每一项都是被分享的
        // 更新所有被分享的数据模型的 __isShare 字段
        items.forEach(function (dt) {
            var sharedItem = list.find(function (item) {
                return item.id === dt.id;
            });
            // 设置分享字段
            sharedItem.__isShare = true;
            // 分享的资源, 需要添加到该项目组下的所有项目的数据模型中
            var progroup = _pgCache._$getItemInCache(sharedItem.progroupId);
            progroup.projects.forEach(function (project) {
                var listKey = this._$getListKey(project.id);
                var dtList = this._$getListInCache(listKey);
                var found = dtList.find(function (it) {
                    return it.id == sharedItem.id;
                });
                if (!found) {
                    // __doUnshiftToList 方法并没有判断是否已经存在
                    this.__doUnshiftToList(listKey, sharedItem);
                }
            }.bind(this));
        }, this);

        _pgCache._$recycle();
    };

    /**
     * 根据 java 数据模型, 返回 nei 中真实的数据模型
     * @param {String} name - 类型名
     * @param {Number} pid - 项目id
     * @return {Object} - 数据模型
     *
     * 说明:
     * java 基本类型 vs   包装类型
     *      String  --   java.lang.String
     *      byte    --   java.lang.Byte
     *      char    --   java.lang.Character
     *      short   --   java.lang.Short
     *      int     --   java.lang.Integer
     *      long    --   java.lang.Long
     *      float   --   java.lang.Float
     *      double  --   java.lang.Double
     *      boolean --   java.lang.Boolean
     */
    pro._$getByJavaDataType = function (name, pid) {
        var map = [{
            reg: /^(String|byte|Byte|char|Character|)$/,
            name: 'String'
        }, {
            reg: /^(short|Short|int|Integer|long|Long|float|Float|double|Double|BigDecimal)$/,
            name: 'Number'
        }, {
            reg: /^(boolean|Boolean)$/,
            name: 'Boolean'
        }];
        var opt = map.find(function (item) { //系统类型，替换name
            return item.reg.test(name);
        });
        opt && (name = opt.name);
        var dataTypes = this._$getListInCache(this._$getListKey(pid));

        var foundDataType = dataTypes.find(function (dataType) { //根据名称找到对应的数据模型
            return dataType.name === name;
        });
        if (!foundDataType) {
            //如果没有匹配，默认返回VARIABLE类型
            foundDataType = dataTypes.find(function (dataType) {
                return dataType.id === 10000;
            });
        }
        return foundDataType;
    };

    /**
     * 根据数据模型的id, 返回它的默认值
     * @param {Number} id - 数据模型的id
     * @return {String} - 默认值
     *
     * 说明: 字符、数值、布尔类型可能有默认值
     */
    pro._$getDefaultValue = function (id) {
        var defaultValue = '';
        var dataType = this._$getItemInCache(id);
        if (!dataType) {
            return defaultValue;
        }
        switch (dataType.format) {
            case this._dbConst.MDL_FMT_STRING:
            case this._dbConst.MDL_FMT_NUMBER:
            case this._dbConst.MDL_FMT_BOOLEAN:
                defaultValue = dataType.params[0] && dataType.params[0].defaultValue;
                break;
            default:
                break;
        }
        return defaultValue;
    };

    /**
     * 从服务器获取引用某个数据模型的资源列表
     * @param {Object} options - 参数
     * @property {Number} options.id - 数据模型的id
     * @success dispatch event: onreflistload
     */
    pro._$getRefList = function (options) {
        var refKey = _p._$cacheKeyRef + options.id;
        this.__getRefList(
            refKey,
            {
                dc: _p._$$CacheDatatype._$allocate(),
                ic: interfaceCache._$$CacheInterface._$allocate(),
                pc: pageCache._$$CachePage._$allocate(),
                tc: templateCache._$$CacheTemplate._$allocate()
            },
            options
        );
    };

    /**
     * 更新数据模型的名称, 更新引用了该数据模型的 异步接口、页面模板、页面
     * @param {Object} dataType - 数据模型
     * @param {Object} options - 操作参数
     */
    pro._updateResources = function (dataType, options) {
        // 从某个参数数组中查找是否引用了当前被更新的数据模型 或者以数组的形式引用数据模型
        var updateParams = function (params) {
            params && params.forEach(function (param) {
                if (param.datatypeId === dataType.id) {
                    param.datatypeName = dataType.name;
                } else if (param.type === dataType.id) { //数组类型
                    param.typeName = dataType.name;
                }
            });
        }.bind(this);
        // 数据模型、页面模板、页面
        var updateByCache = function (cache, recycle) {
            var list = cache.__getHash();
            Object.keys(list).forEach(function (key) {
                var item = list[key];
                if (!item.hasOwnProperty('params')) {
                    return;
                }
                updateParams(item.params);
            });
            if (recycle) {
                cache._$recycle();
            }
        };
        // 异步接口
        var updateByItfCache = function (cache, recycle) {
            var list = cache.__getHash();
            Object.keys(list).forEach(function (key) {
                var item = list[key];
                if (!item.hasOwnProperty('params')) {
                    return;
                }
                updateParams(item.params.inputs);
                updateParams(item.params.outputs);
                updateParams(item.params.reqHeaders);
                updateParams(item.params.resHeaders);
            });
            if (recycle) {
                cache._$recycle();
            }
        };
        // 更新数据模型列表
        updateByCache(this);
        // 查找异步接口, 如果异步接口引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问接口详情时会重新获取
        var _interCache = interfaceCache._$$CacheInterface._$allocate();
        // 因为有可能更改的是公共资源, 所以简便起见, 更新缓存中的所有数据, 而不是只更新当前项目的数据
        updateByItfCache(_interCache, true);
        // 查找页面模板, 如果页面模板引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问接口详情时会重新获取
        var _tplCache = templateCache._$$CacheTemplate._$allocate();
        updateByCache(_tplCache, true);
        // 查找页面, 如果页面的请求参数引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问页面详情时会重新获取
        var _pageCache = pageCache._$$CachePage._$allocate();
        updateByCache(_pageCache, true);
    };
    /**
     * 批量新建数据模型
     * @param {Object} 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.projectId 项目id
     * @property {Number} options.data.groupId 分组id
     * @property {Array} options.data.items 导入的数据类型数据
     * @success dispatch event: onbatch
     */
    pro._$batch = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bat',
            actionMsg: options.actionMsg,
            onload: function (evt) {
                var key = options.key;
                evt.data.forEach(function (item) {
                    var obj = this._$getItemInCache(item.id);
                    if (obj) {
                        this.__doRemoveItemFromList(key, item.id);
                    }
                }.bind(this));
                this.__doUnshiftToList(key, evt.data);
                this._$dispatchEvent('onbatch', evt);
            }.bind(this)
        });
    };
    /**
     * 复制数据模型
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.copys 复制的数据模型数据
     * @property {String} options.data.tags 标签
     */
    pro._$clone = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'clone',
            actionMsg: options.actionMsg,
            onload: function () {
                //清空复制到的项目的datatype cache
                this._$clearListInCache(options.key);
                this._$dispatchEvent('onclone', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 移动数据模型
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.moves 移动的数据模型数据
     * @property {String} options.data.tags 标签
     */
    pro._$move = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'move',
            actionMsg: options.actionMsg,
            onload: function () {
                var _proCache = proCache._$$CachePro._$allocate();
                if (options.ext.isPublic) { //对于移动到公共资源库，需要将该项目下的所有项目的cache清空
                    var group = _proCache._$getProgroupByProId(options.ext.originPid);
                    group.projects.forEach(function (item) {
                        this._$clearListInCache(this._$getListKey(item.id));
                    }.bind(this));
                } else {
                    // 从当前项目cache中删除移动项，并清空目标项目cache数据
                    this._$clearListInCache(options.key);
                }
                this._$dispatchEvent('onmove', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 批量设置分组
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Array} options.data.ids 批量资源id
     * @property {Number} options.data.groupId 分组id
     */
    pro._$setGroup = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bisgroup',
            actionMsg: options.actionMsg,
            onload: function () {
                //修改所选数据模型的分组
                var _groupCache = groupCache._$$CacheGroup._$allocate();
                var groupId = options.data.groupId, group = _groupCache._$getItemInCache(groupId);
                options.data.ids.forEach(function (id) {
                    var datatype = this._$getItemInCache(id);
                    datatype.groupId = groupId;
                    datatype.group = group;
                }.bind(this));
                this._$dispatchEvent('onsetgroup');
                _groupCache._$recycle();
            }.bind(this)
        });
    };

    /**
     * 根据 json 获取相应的数据模型
     * @param {Object} json - json 数据
     * @param {Number} pid - 项目id
     * @return {Object|Datatype} - 返回类型
     */
    pro._$getTypeByJson = function (json, pid) {
        var dbConst = this._dbConst;
        var dataTypes = this._$getListInCache(this._$getListKey(pid));
        var typesMap = {
            string: dbConst.MDL_SYS_STRING,
            boolean: dbConst.MDL_SYS_BOOLEAN,
            number: dbConst.MDL_SYS_NUMBER
        };
        var getType = function (json, skipAnonymous) {
            var foundType = null;
            if (json === null || json === undefined) {
                foundType = typesMap.string;
            } else if (Array.isArray(json)) {
                dataTypes.forEach(function (dt) {
                    // 查找所有数组类型，并根据 skipAnonymous 的值是否需要排除匿名类型
                    if (!foundType && (skipAnonymous ? dt.name : true) && dt.format === dbConst.MDL_FMT_ARRAY) {
                        // 假设数组的所有元素类型都是一样的，检查数组的第一个元素即可
                        if (dt.params[0].type === getType(json[0], false)) {
                            foundType = dt.params[0].type;
                        }
                    }
                });
            } else {
                var jsonType = typeof json;
                if (jsonType === 'object') {
                    // 严格检查对象的每个属性
                    dataTypes.forEach(function (dt) {
                        // 查找所有哈希类型，并根据 skipAnonymous 的值是否需要排除匿名类型
                        if (!foundType && (skipAnonymous ? dt.name : true) && dt.format === dbConst.MDL_FMT_HASH) {
                            if (dt.params.length === Object.keys(json).length) {
                                // 所有字段的名称和类型都完全匹配
                                var allMatch = true;
                                dt.params.forEach(function (param) {
                                    if (!json.hasOwnProperty(param.name) || param.type !== getType(json[param.name], false)) {
                                        allMatch = false;
                                    }
                                });
                                if (allMatch) {
                                    // 找到
                                    foundType = dt.id;
                                }
                            }
                        }
                    });
                } else {
                    foundType = typesMap[jsonType];
                }
            }
            return foundType;
        };
        return getType(json, true);
    };

    /**
     * 获取数据模型的参数，按真实顺序排列，只找第一层参数
     * @param {Number} pid - 数据模型所属项目的id
     * @param {Number} id - 数据模型id
     * @return {Array|Param|Object} - 返回参数数组
     */
    pro._$getParamsByPosition = function (pid, id) {
        var datatypes = this._$getListInCache(this._$getListKey(pid));
        var datatype = datatypes.find(function (dt) {
            return dt.id === id;
        });
        // 因为数据模型本身也可能导入了其他数据模型
        var result = datatype.params.map(function (param) {
            // 参数是导入数据模型的字段
            if (param.datatypeId) {
                var importedDatatype = datatypes.find(function (dt) {
                    return dt.id === param.datatypeId;
                });
                var importedDatatypeParams = importedDatatype.params.concat();
                importedDatatypeParams.sort(function (a, b) {
                    return a.position - b.position;
                });
                var importedDatatypeParamIndex = 0;
                importedDatatypeParams.find(function (p, idx) {
                    if (param.id === p.id) {
                        importedDatatypeParamIndex = idx;
                    }
                });
                // todo: 这种算position的方法其实并不完全正确，
                // 但考虑到相邻参数的 position 相差值不会很小，用索引值来微调也是可行的
                return {
                    position: importedDatatypeParamIndex + param.position,
                    name: param.name,
                    id: param.id
                }
            } else {
                return {
                    position: param.position,
                    name: param.name,
                    id: param.id
                }
            }
        });
        return result;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','7385ee68edde0ba303fb20b28ecfb227','8c66819555c8938ee8838636d552569a','cc04b9f6ed49f9ff59e36f80707cf153','e8507450a35f1adad6e9dae810fd545a','09437bf7199eb808a35a38e5178e5151','7c1169d958213d2faeb6056f33ac4ad6');
I$('7c1169d958213d2faeb6056f33ac4ad6',function (_k, _u, _v, _c, _d, datatypeCache, interfaceCache, pageCache, templateCache, constraintCache, _p, _pro) {
    _p._$$CacheGroup = _k._$klass();
    _pro = _p._$$CacheGroup._$extend(_d._$$Cache);
    _p._$cacheKey = 'group';
    _p._$cacheKeyRef = 'group-ref-';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    }

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {Number} options.projectId - 所在项目的id
     * @property {String} options.name - 名称
     * @property {String} [options.description=''] - 描述信息
     * @property {String} [options.respoId=''] - 负责人id
     * @success dispatch event: onitemadd
     */
    _pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('请输入有效的业务分组名称');
            return;
        }
        this.__super(options);
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 资源 id
     * 支持更新的字段有:
     * @property {String} [options.name] - 名称
     * @property {String} [options.description] - 描述
     * @property {Array} [options.respoId] - 负责人id
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            //更新接口里面引用了的业务分组数据
            var infCache = interfaceCache._$$CacheInterface._$allocate();
            var hash = infCache.__getHash();
            _u._$loop(hash,function (item) {
               if(item.groupId === result.id){
                   _u._$merge(item.group,result)
               }
            });
            infCache._$recycle();
            onload(result);
        };
        this.__super(options);
    };

    /**
     * 验证项缓存中的项是否有效，子类可重写
     *
     * @protected
     * @method module:util/cache/list._$$CacheList#__doCheckItemValidity
     * @param  {Object}  _item - 数据项
     * @param  {String}  _lkey - 列表标识
     * @return {Boolean}        是否有效
     */
    _pro.__doCheckItemValidity = function (_item, _lkey) {
        // 如果没有 refs 属性, 则在调用 $getItem 方法时需要重新获取数据
        return _item.refs;
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/groups/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 获取某个项目中的所有业务分组, 运用于 select2 组件的 source 源数据
     * @param {Number} pid - 项目id
     * @return {Array} - 业务分组列表
     */
    _pro._$getGroupSelectSource = function (pid) {
        var groups = this._$getListInCache(this._$getListKey(pid));
        groups = groups.filter(function (group) {
            if (group.projectId === pid) {
                return true;
            }
        }, this);
        return groups.map(function (g) {
            return {
                id: g.id,
                name: g.name,
                title: g.description ? (g.name + '(' + g.description + ')') : g.name
            }
        });
    };

    /**
     * 从服务器获取属于某个业务分组的资源列表
     * @param {Object} options - 参数
     * @property {Number} options.id - 数据模型的id
     * @success dispatch event: onreflistload
     */
    _pro._$getRefList = function (options) {
        var refKey = _p._$cacheKeyRef + options.id;
        this.__getRefList(
            refKey,
            {
                dc: datatypeCache._$$CacheDatatype._$allocate(),
                ic: interfaceCache._$$CacheInterface._$allocate(),
                pc: pageCache._$$CachePage._$allocate(),
                tc: templateCache._$$CacheTemplate._$allocate(),
                cc: constraintCache._$$CacheConstraint._$allocate(),
            },
            options
        );
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','afd9bc71d3ea5904e51ae183b2351b6e','7385ee68edde0ba303fb20b28ecfb227','8c66819555c8938ee8838636d552569a','cc04b9f6ed49f9ff59e36f80707cf153','7f69de0f0fa6d9d6f0b6273610f4c7c5');
I$('7f69de0f0fa6d9d6f0b6273610f4c7c5',function (_k, _u, _v, _c, _d, pgCache, proCache, groupCache, _p, pro) {
    _p._$$CacheConstraint = _k._$klass();
    pro = _p._$$CacheConstraint._$extend(_d._$$Cache);
    _p._$cacheKey = 'constraint';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            this.__setShareTagOnItems(result);
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {Number} options.projectId - 所在项目的id
     * @property {String} options.name - 名称
     * @property {String} options.apply - 适用类型
     * @property {String} options.type - 函数类型
     * @property {String} [options.tag=''] - 标签
     * @property {String} [options.description=''] - 描述信息
     * @property {String} [options.groupId=''] - 所在业务分组id
     * @property {String} [options.function=''] - 函数执行体
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        options.data.name = options.data.name.trim();
        if (!_u._$isString(options.data.name)) {
            // console.error('请输入有效的名称');
            return;
        }
        var onload = options.onload;
        options.onload = function (item) {
            // 如果是在公共资源库添加了数据模型, 则需要更新所有项目组中的所有项目的数据模型列表
            var _proCache = proCache._$$CachePro._$allocate();
            if (_proCache._$isPublic(item.projectId)) {
                // 是公共资源库
                item.__isShare = true; // 设置共享标记
                var allProjects = _proCache.__getHash();
                Object.keys(allProjects).forEach(function (projectId) {
                    var project = allProjects[projectId];
                    if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                        // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                        this.__doUnshiftToList(this._$getListKey(project.id), item);
                    }
                }, this);
            }
            _proCache._$recycle();
            onload(item);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 资源 id
     * 支持更新的字段有:
     * @property {String} options.name - 名称
     * @property {String} options.apply - 适用类型
     * @property {String} options.type - 函数类型
     * @property {String} [options.tag=''] - 标签
     * @property {String} [options.description=''] - 描述信息
     * @property {String} [options.groupId=''] - 所在业务分组id
     * @property {String} [options.function=''] - 函数执行体
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/constraints/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 设置 __isShare 属性
     * @param  {Array} items - 列表项
     */
    pro.__setShareTagOnItems = function (items) {
        // 设置 __isShare 字段
        var _proCache = proCache._$$CachePro._$allocate();
        items.forEach(function (item) {
            // 资源共享与否, 就看它所属的项目是否为公共资源库
            // 设置 __isShare 字段
            item.__isShare = item.id > 10003 && _proCache._$isPublic(item.projectId);
        });
        _proCache._$recycle();
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        options.onload = function (event) {
            // 如果删除的是公共资源库中的异步接口, 则其他项目(同个项目组)中对应的异步接口也删除
            var _proCache = proCache._$$CachePro._$allocate();
            var deletedList = event.data;
            deletedList.forEach(function (item) {
                if (_proCache._$isPublic(item.projectId)) {
                    // 是公共资源库
                    var allProjects = _proCache.__getHash();
                    Object.keys(allProjects).forEach(function (projectId) {
                        var project = allProjects[projectId];
                        if (project.progroupId === item.progroupId && project.id !== item.projectId) {
                            // 在当前公共资源库所属项目组的项目列表中, 并且不是当前项目
                            this.__doRemoveItemFromList(this._$getListKey(project.id), item);
                        }
                    }, this);
                }
            }, this);
            _proCache._$recycle();
        }.bind(this);
        this.__super(options);
    };

    /**
     * 共享
     * @param {Object} options - 参数对象
     * @property {id} options.id - 规则函数id
     * @success dispatch event: onshare
     */
    pro._$share = function (options) {
        this.__doAction({
            data:{
                isShare:1
            },
            id: options.id,
            method: 'PUT',
            action: 'share',
            onload: function (evt) {
                var list = this._$getListInCache(options.ext.cacheKey);
                // 更新单条数据
                var sharedItem = list.find(function (item) {
                    return item.id === evt.data.id;
                });
                // 分享后, 它的 projectId 有变化了, 需要更新
                Object.assign(sharedItem, evt.data);
                // 分享的资源, 需要加到公共资源库去中
                var _proCache = proCache._$$CachePro._$allocate();
                var publicProject = _proCache._$getPublicById(sharedItem.projectId);
                var listKey = this._$getListKey(publicProject.id);
                var projectList = this._$getListInCache(listKey);
                var found = projectList.find(function (it) {
                    return it.id == sharedItem.id;
                });
                if (!found) {
                    // __doUnshiftToList 方法并没有判断是否已经存在
                    this.__doUnshiftToList(this._$getListKey(publicProject.id), sharedItem);
                }
                // 设置分享字段
                sharedItem.__isShare = true;
                this._$dispatchEvent('onshare', evt);
            }.bind(this)
        });
    };
    /**
     * 复制规则函数
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.copys 复制的规则函数
     * @property {String} options.data.tags 标签
     */
    pro._$clone = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'clone',
            actionMsg: options.actionMsg,
            onload: function () {
                //清空复制到的项目的constraint cache
                this._$clearListInCache(options.key);
                this._$dispatchEvent('onclone', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 移动规则函数
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Number} options.data.pid 项目id
     * @property {Number} options.data.gid 分组id
     * @property {Array} options.data.moves 移动的规则函数
     * @property {String} options.data.tags 标签
     */
    pro._$move = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'move',
            actionMsg: options.actionMsg,
            onload: function () {
                var _proCache = proCache._$$CachePro._$allocate();
                if (options.ext.isPublic) { //对于移动到公共资源库，需要将该项目下的所有项目的cache清空
                    var group = _proCache._$getProgroupByProId(options.ext.originPid);
                    group.projects.forEach(function (item) {
                        this._$clearListInCache(this._$getListKey(item.id));
                    }.bind(this));
                } else {
                    //从当前项目cache中删除移动项，并清空目标项目cache数据
                    this._$clearListInCache(options.key);
                }
                this._$dispatchEvent('onmove', {pid: options.data.pid, ext: options.ext});
            }.bind(this)
        });
    };
    /**
     * 批量设置分组
     * @param options 配置参数
     * @property {String} options.key cache所需的key
     * @property {Array} options.data.ids 批量资源id
     * @property {Number} options.data.groupId 分组id
     */
    pro._$setGroup = function (options) {
        this.__doAction({
            data: options.data,
            method: 'POST',
            action: 'bisgroup',
            actionMsg: options.actionMsg,
            onload: function () {
                //修改所选数据模型的分组
                var _groupCache = groupCache._$$CacheGroup._$allocate();
                var groupId = options.data.groupId, group = _groupCache._$getItemInCache(groupId);
                options.data.ids.forEach(function (id) {
                    var constraint = this._$getItemInCache(id);
                    constraint.groupId = groupId;
                    constraint.group = group;
                }.bind(this));
                this._$dispatchEvent('onsetgroup');
                _groupCache._$recycle();
            }.bind(this)
        });
    };
    /**
     * 规则函数生成响应的js函数字符串
     * @param constraints 规则函数列表
     * @returns {Array} - 规则函数字符串数据
     */
    pro._$getConstraintsFunction = function (constraints) {
        var functions = [];
        constraints.forEach(function (item) {
            var func = 'var ' + item.name + '=function(){' + item.function.replace(/'/g, /\\'/) + '};';
            functions.push(func)
        });
        return functions;
    }

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','e8507450a35f1adad6e9dae810fd545a','09437bf7199eb808a35a38e5178e5151','7c1169d958213d2faeb6056f33ac4ad6');
I$('46b0f1b07fd20dd48ca972387c49ba1d',function (k, u, v, c, d, interCache, p, pro) {
    p._$$CacheIHeader = k._$klass();
    pro = p._$$CacheIHeader._$extend(d._$$Cache);
    p._$cacheKey = 'iheader';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = p._$cacheKey;
    }

    /**
     * 更新
     * @param {Object} options - 参数对象
     * 必须要传的参数:
     * @property {Number} options.id - 请求头 id
     * @property {Number} options.parentId - 所属接口标识
     * @property {Number} options.parentType - 头类型
     * 支持更新的字段有:
     * @property {String} [options.name] - 头字段名称
     * @property {String} [options.defaultValue] - 字段值
     * @property {String} [options.description] - 字段描述信息
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            var headers = this._getHeaders(options.data.parentId, options.data.parentType);
            var header = headers.find(function (item) {
                return item.id === result.id || item.id === result.parameterId;
            });
            u._$merge(header, result);
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量添加
     * @param {Object} options - 参数对象
     * @property {Number} options.items- 要添加的对象列表
     * @success dispatch event: onitemsadd
     */
    pro._$addItems = function (options) {
        options.onload = function (evt) {
            var headers = this._getHeaders(options.data.parentId, options.data.parentType);
            evt.data.params.forEach(function (item) {
                headers.push(item);
            }, this);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        options.onload = function (evt) {
            var headers = this._getHeaders(options.data.parentId, options.data.parentType);
            u._$reverseEach(headers, function (item1, index) {
                u._$forEach(evt.data.params, function (item2) {
                    if ( item1.id === item2) {
                        headers.splice(index, 1);
                    }
                });
            });
            u._$reverseEach(headers, function (item1, index) {
                u._$forEach(evt.data.imports, function (item2) {
                    if (item1.datatypeId === item2) {
                        headers.splice(index, 1);
                    }
                });
            });
        }.bind(this);
        this.__super(options);
    };


    /**
     * 获取请求头参数
     * @param {String} interfaceId - 异步接口id
     * @param {Number} headerType - 请求头类型
     * @return {Array} 参数列表
     */
    pro._getHeaders = function (interfaceId, headerType) {
        var cache = interCache._$$CacheInterface._$allocate();
        var interfaceData = cache._$getItemInCache(interfaceId);
        var headers = null;
        if (headerType === this._dbConst.API_HED_REQUEST) {
            headers = interfaceData.params.reqHeaders;
        } else if (headerType === this._dbConst.API_HED_RESPONSE) {
            headers = interfaceData.params.resHeaders;
        }
        return headers;
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        switch (options.key) {
            case p._$cacheKey:
                url = '/api/iheaders/' + (options.id || '');
                if (options.action) {
                    url += '?' + options.action;
                }
                break;

            default:
                break;
        }
        return url;
    };

    /**
     * 批量更新 position
     * @param {Object} options - 参数对象
     * @property {Number} options.parentId- 所属资源id
     * @property {Number} options.parentType- 所属资源类型
     * @property {Array|Object} options.params- 所属资源类型
     * @property {Number} options.params: id- 参数id
     * @property {Number} options.params: datatypeId- 导入的数据模型id
     * @property {Number} options.params: position- 排序位置
     * @success dispatch event: onupdatepositions
     */
    pro._$updatePositions = function (options) {
        this.__doAction({
            data: {
                params: options.params,
                parentId: options.parentId,
                parentType: options.parentType,
            },
            method: 'PATCH',
            action: 'position',
            onload: function (evt) {
                this._$dispatchEvent('onupdatepositions', evt);
            }._$bind(this)
        });
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','7385ee68edde0ba303fb20b28ecfb227');
I$('75824b27a51205ba0a8f15ebf23575c4',function (_k, _u, _v, _c, _d, _p, _pro) {
    _p._$$CacheNotifySetting = _k._$klass();
    _pro = _p._$$CacheNotifySetting._$extend(_d._$$Cache);
    _p._$cacheKey = 'notify-setting';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * 支持更新通知设置的字段有:
     * @property {Boolean} [options.flag] - 通知开关
     * @property {Boolean} [options.methodYixin] - 通知方式 － 易信
     * @property {Boolean} [options.methodEmail] - 通知方式 － 邮箱通知
     * @property {Boolean} [options.methodPhone] - 通知方式 － 手机
     * @property {Boolean} [options.methodPaopao] - 通知方式 － 泡泡
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    _pro.__doLoadItem = function (options) {
        var _options = {
            onload: function (data) {
                this.__setDataInCache(_p._$cacheKey, data);
                // 父类中的回调
                options.onload();
            }.bind(this)
        };
        this.__super(_options);
    };

    _pro._$getNotifySettingsInCache = function () {
        return this.__getDataInCache(_p._$cacheKey);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        switch (options.key) {
            case _p._$cacheKey:
                url = '/api/notifysettings/';
                break;

            default:
                break;
        }
        return url;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('35e8999e6afda708a192e93b3e184448',function (_k, u, v, _c, _d, pageCache, templateCache, dtCache, interCache, _p, pro) {
    _p._$$CacheParameter = _k._$klass();
    pro = _p._$$CacheParameter._$extend(_d._$$Cache);
    _p._$cacheKey = 'parameter';
    _p._$cacheKeyAnonymousModify = 'anonymous-datatype-modify';//匿名类型修改

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    }

    /**
     * 更新
     * @param {Object} options - 参数对象
     * 必须要传的参数:
     * @property {Number} options.id - 参数 id
     * @property {Number} options.parentId - 参数归属资源标识
     * @property {Number} options.parentType - 参数归属资源类型
     * 支持更新的字段有:
     * @property {String} [options.name] - 名称
     * @property {String} [options.type] - 数据模型标识
     * @property {String} [options.isArray] - 是否数组类型
     * @property {String} [options.description] - 参数描述
     * @property {Array} [options.genExpression] - 生成规则表达式
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            // 如果更新的是数据模型, 则更新完成后, 还需要更新引用了它的数据模型、异步接口、页面模板
            // 后端返回的是所有需要更新的数据模型列表, 包括当前被修改的数据模型
            this._updateResources(result.datatypes, options);

            var params = this._getParams({
                parentType: options.data.parentType,
                parentId: options.data.parentId
            });
            if (params) {
                var param = params.find(function (param) {
                    return param.id === result.params[0].id;
                });
                // 更新字段的值, 在更新 typeName 时, 后端并没有返回 typeName 信息, 所以加上 options.data 的数据
                u._$merge(param, options.data, result.params[0]);
            }
            onload(result);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量添加
     * @param {Object} options - 参数对象
     * @property {Number} options.items- 要添加的对象列表
     * @success dispatch event: onitemsadd
     */
    pro._$addItems = function (options) {
        options.onload = function (evt) {
            // 如果添加的是数据模型的参数, 则添加成功后, 还需要更新引用了它的数据模型、异步接口、页面模板
            // 后端返回的是所有需要更新的数据模型列表, 包括当前被修改的数据模型
            this._updateResources(evt.data.datatypes, options);

            // 更新资源的参数，但数据模型不用更新
            evt.data.params.forEach(function (item) {
                var params = this._getParams(item);
                if (params) {
                    params.push(item);
                }
            }, this);

        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    pro._$deleteItems = function (options) {
        options.onload = function (evt) {
            // 如果删除的是数据模型的参数, 则删除成功后, 还需要更新引用了它的数据模型、异步接口、页面模板
            // 后端返回的是所有需要更新的数据模型列表, 包括当前被修改的数据模型
            this._updateResources(evt.data.datatypes, options);

            var params = this._getParams({
                parentType: options.data.parentType,
                parentId: options.data.parentId
            });
            if (!params) {
                return;
            }
            u._$reverseEach(params, function (item1, index) {
                u._$forEach(evt.data.params, function (item2) {
                    if (item1.id === item2) {
                        params.splice(index, 1);
                    }
                });
            });
            u._$reverseEach(params, function (item1, index) {
                u._$forEach(evt.data.imports, function (item2) {
                    if (item1.datatypeId === item2) {
                        params.splice(index, 1);
                    }
                });
            });
        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量更新 position
     * @param {Object} options - 参数对象
     * @property {Number} options.parentId- 所属资源id
     * @property {Number} options.parentType- 所属资源类型
     * @property {Array|Object} options.params- 所属资源类型
     * @property {Number} options.params: id- 参数id
     * @property {Number} options.params: datatypeId- 导入的数据模型id
     * @property {Number} options.params: position- 排序位置
     * @success dispatch event: onupdatepositions
     */
    pro._$updatePositions = function (options) {
        this.__doAction({
            data: {
                params: options.params,
                parentId: options.parentId,
                parentType: options.parentType,
            },
            method: 'PATCH',
            action: 'position',
            onload: function (evt) {
                this._updateParamsPosition(evt.data);
                this._$dispatchEvent('onupdatepositions', evt);
            }._$bind(this)
        });
    };
    /**
     * 根据 parentType 返回相应的缓存实例
     * @param {Number} parentType - 参数所属的资源类型
     * @return {Object} cache 实例
     */
    pro._getCache = function (parentType) {
        switch (parentType) {
            case this._dbConst.PAM_TYP_QUERY:
                return pageCache._$$CachePage._$allocate();
            case this._dbConst.PAM_TYP_VMODEL:
                return templateCache._$$CacheTemplate._$allocate();
            case this._dbConst.PAM_TYP_ATTRIBUTE:
                return dtCache._$$CacheDatatype._$allocate();
            case this._dbConst.PAM_TYP_INPUT:
            case this._dbConst.PAM_TYP_OUTPUT:
                return interCache._$$CacheInterface._$allocate();
        }
    };

    /**
     * 根据 parentType 返回相应的缓存中的参数列表
     * @param {Object} result - 后端返回的参数信息
     * @return {Array} 缓存中对应的参数列表
     */
    pro._getParams = function (result) {
        var cache = this._getCache(result.parentType);
        // 更新相应缓存中的数据
        var data = cache._$getItemInCache(result.parentId);
        var params = null;
        switch (result.parentType) {
            case this._dbConst.PAM_TYP_QUERY:
            case this._dbConst.PAM_TYP_VMODEL:
            // 数据模型有单独的更新逻辑，这里不需要再更新它的属性
            // case this._dbConst.PAM_TYP_ATTRIBUTE:
                params = data.params;
                break;
            case this._dbConst.PAM_TYP_INPUT:
                params = data.params.inputs;
                break;
            case this._dbConst.PAM_TYP_OUTPUT:
                params = data.params.outputs;
                break;
        }
        return params;
    };

    /**
     * 根据 parentType 更新相应的缓存中的参数的位置信息
     * @param {Object} data - 后端返回的参数信息
     */
    pro._updateParamsPosition = function (data) {
        var cache = this._getCache(data.parentType);
        // 更新相应缓存中的数据
        var resource = cache._$getItemInCache(data.parentId);
        var setPosition = function (params) {
            data.params.forEach(function (movedParam) {
                if (movedParam.datatypeId) {
                    var importedParams = params.filter(function (p) {
                        return p.datatypeId === movedParam.datatypeId;
                    });
                    importedParams.forEach(function (p) {
                        p.position = movedParam.position;
                    });
                } else {
                    var _param = params.find(function (p) {
                        return p.id === movedParam.id;
                    });
                    _param.position = movedParam.position;
                }
            });
        }
        switch (data.parentType) {
            case this._dbConst.PAM_TYP_QUERY:
            case this._dbConst.PAM_TYP_VMODEL:
            case this._dbConst.PAM_TYP_ATTRIBUTE:
                setPosition(resource.params);
                break;
            case this._dbConst.PAM_TYP_INPUT:
                setPosition(resource.params.inputs);
                break;
            case this._dbConst.PAM_TYP_OUTPUT:
                setPosition(resource.params.outputs);
                break;
        }
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        switch (options.key) {
            case _p._$cacheKey:
                url = '/api/parameters/' + (options.id || '');
                if (options.action) {
                    url += '?' + options.action;
                }
                break;
            default:
                break;
        }
        return url;
    };

    /**
     * 更新数据模型, 更新引用了该数据模型的 异步接口、页面模板、页面
     * @param {Array} dataTypes - 数据模型
     * @param {Object} options - 操作参数
     */
    pro._updateResources = function (dataTypes, options) {
        var updateResource = function (updatedDataTypeId) {
            // 从某个参数数组中查找是否引用了当前被更新的数据模型
            var foundRef = function (params) {
                return params.find(function (item) {
                    return item.datatypeId === updatedDataTypeId;
                });
            }
            // 查找异步接口, 如果异步接口引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问接口详情时会重新获取
            var _interCache = interCache._$$CacheInterface._$allocate();
            // 因为有可能更改的是公共资源, 所以简便起见, 更新缓存中的所有数据, 而不是只更新当前项目的数据
            //var itfList = _interCache._$getListInCache(_interCache._$getListKey(options.ext.pid));
            var itfList = _interCache.__getHash();

            u._$loop(itfList, function (item) {
                if (!item.hasOwnProperty('params')) {
                    return;
                }
                var params = item.params;
                var found = foundRef(params.inputs);
                if (!found) {
                    found = foundRef(params.outputs);
                }
                if (!found) {
                    found = foundRef(params.reqHeaders);
                }
                if (!found) {
                    found = foundRef(params.resHeaders);
                }
                if (found) {
                    delete item.params;
                }
            });
            _interCache._$recycle();
            // 查找页面模板, 如果页面模板引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问接口详情时会重新获取
            var _tplCache = templateCache._$$CacheTemplate._$allocate();
            var tplList = _tplCache.__getHash();
            u._$loop(tplList, function (item) {
                if (!item.hasOwnProperty('params')) {
                    return;
                }
                var found = foundRef(item.params);
                if (found) {
                    delete item.params;
                }
            });
            _tplCache._$recycle();
            // 查找页面, 如果页面的请求参数引用了这个数据模型, 则把它的 params 属性删除, 这样下次访问页面详情时会重新获取
            var _pageCache = pageCache._$$CachePage._$allocate();
            var pageList = _pageCache.__getHash();
            u._$loop(pageList, function (item) {
                if (!item.hasOwnProperty('params')) {
                    return;
                }
                var found = foundRef(item.params);
                if (found) {
                    delete item.params;
                }
            });
            _pageCache._$recycle();
        }.bind(this);
        // 更新数据模型列表
        var _dtCache = dtCache._$$CacheDatatype._$allocate();
        dataTypes.forEach(function (dt) {
            var item = _dtCache._$getItemInCache(dt.id);
            if (typeof item === "undefined") {
                // 需要添加到缓存
                //如果参数添加里面有添加匿名数据模型则要写到数据类型缓存中 added by lihl 12.2
                var key = _dtCache._$getListKey(dt.projectId);
                //添加匿名类型标志
                dt.__isAnon = true;
                _dtCache.__doUnshiftToList(key, dt);
            } else {
                u._$merge(item, dt);
            }
            updateResource(dt.id);
        });
        _dtCache._$recycle();
    };
    /**
     * 修改匿名数据类型的属性
     * update by lihl
     * @private
     */
    pro._$updateAnonymousDatatype = function (options) {
        this.__doAction({
            headers: options.headers || {},
            data: options.data,
            ext: options.ext,
            key: options.key,
            method: 'PATCH',
            onload: function (data) {
                // 更新匿名数据模型的参数
                var _dtCache = dtCache._$$CacheDatatype._$allocate();
                //更新缓存
                data.data.datatypes.forEach(function (dt) {
                    var item = _dtCache._$getItemInCache(dt.id);
                    u._$merge(item, dt);
                });
                this._$dispatchEvent('onitemupdate', data);
                v._$dispatchEvent(this.constructor, "update");
                _dtCache._$recycle();
            }.bind(this)
        });
    }

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','8c66819555c8938ee8838636d552569a','cc04b9f6ed49f9ff59e36f80707cf153','afd9bc71d3ea5904e51ae183b2351b6e','7385ee68edde0ba303fb20b28ecfb227');
I$('cea4e30538d6300bc40f1aecaa365134',function (_k, _u, _v, _c, _d, _p, _pro) {
    _p._$$CacheRef = _k._$klass();
    _pro = _p._$$CacheRef._$extend(_d._$$Cache);
    _p._$cacheKey = 'ref';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
        // 指定作为唯一标识的字段名
        this.__key = '__resKey';
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        return '/api/' + options.ext.type + '/' + options.ext.id + '/?ref';
    };
    /**
     * 格式化数据项，子类实现具体业务逻辑
     * @method module:util/cache/list._$$CacheList#__doFormatItem
     * @param  {Object} item - 列表项
     * @param  {String} lkey - 列表标识
     * @return {Object}        格式化后的列表项
     */
    _pro.__doFormatItem = function (item, lkey) {
        // 因为资源分属不同的表, 所以它们的 id 有可能是相同的, 需要给他们设置唯一的标识
        // 这里可以通过 id 和 type(资源所属的种类) 确定一条资源
        item[this.__key] = item.id + '-' + item.type;
        // 可以返回 item, 也可以不返回, 不返回的时候 /util/cache/list.js#__doSaveItemToCache 默认会用 item 值
        // return item;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('cc2e09517a742da0179cf6f4484b2b0b',function (k, u, v, c, d, proCache, pgCache, p, pro) {
    p._$$CacheSpec = k._$klass();
    pro = p._$$CacheSpec._$extend(d._$$Cache);
    p._$cacheKeyRef = 'spec-ref-';
    p._$cacheKey = 'spec';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = p._$cacheKey;
        // 全局事件, 方便模块间通信
        if (!this.constructor.__eventAdded2) {
            this.constructor.__eventAdded2 = true;
            c._$$CustomEvent._$allocate({
                element: this.constructor,
                event: [
                    'onlanguageupdate'
                ]
            });
        }
    };

    /**
     * 根据 key 值获取相应的列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        // 在缓存命中计算时(module:util/cache/cache._$$CacheAbstract#__hasFragment), 需要考虑 offset 和 limit 的信息
        // 将 limit 设置为较大的值后, 在一定程度上保证了可以全部加载列表数据
        if (options.key === this.__cacheKey) {
            options.limit = 100000;
        }
        this.__super(options);
    };

    /**
     * 收藏和取消收藏
     * @param {Object} [options] - 参数对象
     * @property {Boolean} [options.id] - 规范id
     * @property {Boolean} [options.v] - true 表示收藏, false 表示取消收藏
     * @success dispatch event: onfavorite
     */
    pro._$favorite = function (options) {
        this.__doAction({
            method: 'PUT',
            action: 'favorite',
            id: options.id,
            data: {
                v: options.v
            },
            actionMsg: options.actionMsg,
            onload: function (event) {
                if (event.data) {
                    // 更新单条数据
                    var oldItem = this._$getItemInCache(options.id);
                    u._$merge(oldItem, event.data);
                    event.data = oldItem;
                } else { // 删除规范数据
                    this.__doRemoveItemFromList(event.key, options.id);
                }
                this._$dispatchEvent('onfavorite', event);
            }.bind(this)
        });
    };
    /**
     * 共享和取消共享
     * @param {Object} [options] - 参数对象
     * @property {Boolean} [options.id] - 规范id
     * @property {Boolean} [options.v] - true 表示共享, false 表示取消共享
     * @success dispatch event: onshare
     */
    pro._$share = function (options) {
        this.__doAction({
            method: 'PUT',
            action: 'share',
            id: options.id,
            data: {
                v: options.v
            },
            actionMsg: options.actionMsg,
            onload: function (event) {
                if (event.data) {
                    // 更新单条数据
                    var list = this._$getListInCache(event.key);
                    var oldItem = list.find(function (item) {
                        return item.id === options.id;
                    });
                    u._$merge(oldItem, event.data);
                    event.data = oldItem;
                    if (options.v) {
                        ga('send', 'event', 'spec', 'share');
                    }
                } else { //删除规范数据
                   // this.__doRemoveItemFromList(event.key, options.id);
                }
                this._$dispatchEvent('onshare', event);
            }.bind(this)
        });
    };
    /**
     * 锁定和取消锁定
     * @param {Object} [options] - 参数对象
     * @property {Boolean} [options.id] - 规范id
     * @property {Boolean} [options.v] - true 表示锁定, false 表示取消锁定
     * @success dispatch event: onlock
     */
    pro._$lock = function (options) {
        this.__doAction({
            method: 'PUT',
            action: 'lock',
            id: options.id,
            data: {
                v: options.v
            },
            actionMsg: options.actionMsg,
            onload: function (event) {
                if (event.data) {
                    // 更新单条数据
                    var list = this._$getListInCache(event.key);
                    var oldItem = list.find(function (item) {
                        return item.id === options.id;
                    });
                    u._$merge(oldItem, event.data);
                    event.data = oldItem;
                } else { //删除规范数据
                    //this.__doRemoveItemFromList(event.key, options.id);
                }
                this._$dispatchEvent('onlock', event);
            }.bind(this)
        });
    };
    /**
     * 复制单个规范
     * @param {Object} [options] - 参数对象
     * @property {Boolean} [options.id] - 规范id
     * @property {String} [options.name] - 规范名称
     * @success dispatch event: onclone
     */
    pro._$clone = function (options) {
        this.__doAction({
            method: 'POST',
            action: 'clone',
            id: options.id,
            data: {
                name: options.name
            },
            onload: function (event) {
                this.__doUnshiftToList(this.__cacheKey, event.data);
                this._$dispatchEvent('onclone', event);
            }.bind(this)
        });
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(p._$cacheKey) > -1) {
            url = '/api/specs/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

    /**
     * 从服务器获取引用某个规范的项目列表
     * @param {Object} options - 参数
     * @property {Number} options.id - 规范的id
     * @success dispatch event: onreflistload
     */
    pro._$getRefList = function (options) {
        var refKey = p._$cacheKeyRef + options.id;
        this.__getRefList(
            refKey,
            {
                proc: proCache._$$CachePro._$allocate(),
                progc: pgCache._$$CacheProGroup._$allocate()
            },
            options
        );
    };

    /**
     * 重新生成工具标识key
     * @param {Object} options - 参数对象
     * @success dispatch event: onrefreshkey
     */
    pro._$refreshKey = function (options) {
        this.__doAction({
            key: options.key,
            data: {
                reqHolder: 1
            },
            method: 'PUT',
            action: 'rtk',
            onload: function (evt) {
                this.__setDataInCache(evt.key, evt.data);
                this._$dispatchEvent('onrefreshkey', evt);
            }.bind(this),
            id: options.id
        });
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','09437bf7199eb808a35a38e5178e5151','e8507450a35f1adad6e9dae810fd545a');
I$('18b1bc9298d424c8e455480bdc21afd6',function (_k, _u, _v, _c, _d, _specCache, db, _p, _pro) {
    _p._$$CacheSpecDoc = _k._$klass();
    _pro = _p._$$CacheSpecDoc._$extend(_d._$$Cache);
    _p._$cacheKey = 'specdocs';
    _p._$cacheKeyToken = 'specdocs-token';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };
    /**
     * 根据 key 值获取相应的列表
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.offset] - 列表缓存列表起始位置
     * @property {Number} [options.limit] - 列表缓存列表当前查询条数
     * @property {Number} [options.total] - 是否有总数信息
     * @success dispatch event: onlistload
     */
    _pro.__doLoadList = function (options) {
        // 在缓存命中计算时(module:util/cache/cache._$$CacheAbstract#__hasFragment), 需要考虑 offset 和 limit 的信息
        // 将 limit 设置为较大的值后, 在一定程度上保证了可以全部加载列表数据
        if (options.key.indexOf(this.__cacheKey) > -1) {
            options.limit = 100000;
        }
        this.__super(options);
    };
    /**
     * 根据id查找节点
     * @param {Array} 节点数组
     * @param {Number} 节点id
     * @returns {Object} 所查找的节点
     */
    _pro.__findItem = function (arr, id) {
        for (var i = 0, l = arr.length; i < l; i++) {
            var item = arr[i];
            if (item.id === id) {
                return item;
            } else if (item.children) {
                var result = this.__findItem(item.children, id);
                if (result) return result;
            }
        }
    };
    /**
     * 根据id查找节点在数组中的下标
     * @param {Array} 节点数组
     * @param {Number} 节点id
     * @returns {Number} 节点下标
     */
    _pro.__findItemIndex = function (arr, id) {
        var index = undefined;
        arr.forEach(function (item, i) {
            if (item.id === id) {
                index = i;
                return;
            }
        });
        return index;
    };
    /**
     * 新增一个规范节点，(根据parent将节点添加到指定位置)
     * @param options
     * @private
     */
    _pro.__doAddItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            data: options.data,
            ext: options.ext,
            action: 'add',
            method: 'POST',
            onload: function (item) {
                var data = this._$getListInCache(options.key);
                if (item.type === db.SPC_NOD_DIR) {
                    item.children = [];
                }
                if (item.parent == 0) {
                    data.push(item);
                } else {
                    var parent = this.__findItem(data, item.parent);
                    if (!parent.children) {
                        parent.children = [];
                    }
                    parent.children.push(item);
                }
                item = _u._$merge({}, item);
                delete item.children;
                this._$dispatchEvent('onitemadd', {
                    key: options.key,
                    data: item,
                    action: 'add',
                    ext: options.ext
                });
            }.bind(this)
        };
        var url = this.__getUrl(options);
        this.__sendRequest(url, _sendOptions);
    };
    /**
     * 删除一个规范节点，(根据parent和id查找节点)
     * @param options
     * @private
     */
    _pro.__doDeleteItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            method: 'DELETE',
            ext: options.ext,
            action: 'delete',
            onload: function (item) {
                var data = this._$getListInCache(options.key);
                var arr, parent;
                if (item.parent == 0) {
                    arr = data;
                } else {
                    parent = this.__findItem(data, item.parent);
                    arr = parent ? parent.children : null; //可能父节点已经被删除
                }
                if (arr) {
                    var index = this.__findItemIndex(arr, item.id);
                    arr.splice(index, 1);
                    if (parent && arr.length === 0) {
                        parent.hasChildren = false;
                    }

                }
                //触发delete事件
                this._$dispatchEvent('onitemdelete', {
                        data: item,
                        action: 'delete',
                        key: options.key,
                        ext: options.ext
                    }
                );
            }.bind(this)
        };
        var url = this.__getUrl(options);
        this.__sendRequest(url, _sendOptions);
    };
    /**
     * 批量删除
     * @param {Object} options - 参数对象
     * @property {Number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete
     */
    _pro._$deleteItems = function (options) {
        this.__doAction({
            data: {
                ids: options.ids
            },
            ext: options.ext,
            key: options.key,
            method: 'DELETE',
            onload: function (event) {
                var deletedList = event.data;
                var data = this._$getListInCache(options.key);
                //从缓存中删除
                deletedList.forEach(function (item) {
                    var arr, parent;
                    if (item.parent == 0) {
                        arr = data;
                    } else {
                        parent = this.__findItem(data, item.parent);
                        arr = parent ? parent.children : null; //可能父节点已经被删除
                    }
                    if (arr) {
                        var index = this.__findItemIndex(arr, item.id);
                        arr.splice(index, 1);
                        if (parent && arr.length === 0) {
                            parent.hasChildren = false;
                        }
                    }
                }.bind(this));
                //触发itemsdelete事件
                this._$dispatchEvent('onitemsdelete', {
                        data: deletedList,
                        key: options.key,
                        ext: options.ext
                    }
                );
            }.bind(this)
        });
    };
    /**
     * 更新一条数据
     * @param {Object} options - 参数对象
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        options.key = options.key || this.__cacheKey;
        var _sendOptions = {
            method: 'PATCH',
            data: options.data,
            ext: options.ext,
            action: 'update',
            onload: function (item) {
                var data = this._$getListInCache(options.key);
                var old = this.__findItem(data, item.id);
                _u._$merge(old, item);
                this._$dispatchEvent('onitemupdate', {
                        data: item,
                        action: 'update',
                        key: options.key,
                        ext: options.ext
                    }
                );
            }.bind(this)
        };
        var url = this.__getUrl(options);
        this.__sendRequest(url, _sendOptions);
    };
    /**
     * 从cache中获取一个节点数据
     * @param {Object} 参数对象
     * @private
     */
    _pro._$getItemInCache = function (options) {
        var data = this._$getListInCache(options.key);
        var item = this.__findItem(data, options.id);
        return item;

    };
    /**
     * 获取上传文件到 NOS 时所需要的 token
     * @param {Object} [options] - 参数对象
     * @property {Number} n - 要获取的token数量, 后端默认返回一个
     * @success dispatch event: ontokensload
     */
    _pro._$getTokens = function (options) {
        var key = _p._$cacheKeyToken;
        var callback = this._$dispatchEvent._$bind(
            this, 'ontokensload', {key: key, ext: options.ext}
        );
        var url = this.__getUrl({
            key: key
        });
        this.__sendRequest(url, {
            data: {
                n: options.n || 1
            },
            onload: function (_data) {
                // 缓存数据
                this.__setDataInCache(key, _data);
                callback();
            }._$bind(this)
        });
    };

    /**
     * 清除目录结构
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onempty
     */
    _pro._$empty = function (options) {
        this.__doAction({
            key: options.key,
            method: 'DELETE',
            action: 'empty',
            data: {
                specId: options.specId
            },
            onload: 'onempty',
            updateList: true
        });
    };

    /**
     * 导入工程模板
     * @param {Object} [options] - 参数对象
     * @property {String} [options.key] - 规范列表的key
     * @property {Number} [options.data.specId] - 结点所属规范的id
     * 以下两个参数二选一
     * @property {Number} [options.data.importSpecId] - 导入的预置规范的id
     * @property {File} [options.data.file] - 要上传的zip包文件
     * @success dispatch event: onimport
     */
    _pro._$import = function (options) {
        this.__doAction({
            key: options.key,
            method: 'POST',
            action: 'import',
            ext: options.ext,
            headers: {
                'Content-Type': 'multipart/form-data'
            },
            data: options.data,
            onload: function (event) {
                this._$setListInCache(options.key, event.data.tree);
                var specCache = _specCache._$$CacheSpec._$allocate();
                var spec = specCache._$getItemInCache(options.data.specId);
                _u._$merge(spec, event.data.spec);
                this._$dispatchEvent('onimport', {
                    key: options.key,
                    data: event.data,
                    ext: options.ext
                });
            }.bind(this)

        });
    };
    /**
     * 批量添加文档节点
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.data.specId] - 规范id
     * @property {Number} [options.data.parent] - 添加节点的父节点id
     * @property {Number} [options.data.isUpload] - 是否是上传节点（0,1）
     * @property {Array} [options.data.items] - 要添加的节点数组
     * @success dispatch event: onbatch
     */
    _pro._$batch = function (options) {
        this.__doAction({
            key: options.key,
            method: 'POST',
            action: 'bat',
            data: options.data,
            onload: function (event) {
                var arr = event.data;
                var data = this._$getListInCache(options.key);
                if (options.data.parent === 0) {
                    this._$setListInCache(options.key, arr);
                }
                else {
                    var parent = this.__findItem(data, options.data.parent);
                    parent.children = arr;
                }
                this._$dispatchEvent('onbatch', {
                    key: options.key,
                    data: arr,
                    action: 'bat',
                    ext: options.ext
                });
            }.bind(this)
        })
    };

    /**
     * 移动规范文档节点
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onmove
     */
    _pro._$move = function (options) {
        this.__doAction({
            key: options.key,
            method: 'PUT',
            action: 'move',
            data: options.data,
            onload: function (event) {
                var moves = [];
                var data = this._$getListInCache(options.key);
                var oldArr, oldObj, newArr, oldParents = options.ext.oldParents, newParent = options.ext.newParent;
                if (newParent === 0) {
                    newArr = data;
                } else {
                    var obj = this.__findItem(data, newParent);
                    obj.hasChildren = true;
                    newArr = obj.children;
                    if (!newArr) {

                        newArr = [];
                    }
                }
                for (var item in oldParents) { //遍历删除原节点
                    item = Number(item);
                    if (item === 0) {
                        oldArr = data;
                    } else {
                        oldObj = this.__findItem(data, item)
                        oldArr = oldObj.children;
                    }
                    oldParents[item].forEach(function (childId) {
                        var index = this.__findItemIndex(oldArr, childId);
                        var oldItem = oldArr.splice(index, 1)[0];
                        oldItem = _u._$merge(oldItem, {
                            parent: newParent
                        });
                        if (oldArr.length === 0) {
                            oldObj.hasChildren = false;
                        }
                        newArr.push(oldItem);
                        moves.push(oldItem);
                    }.bind(this));
                }
                this._$dispatchEvent('onmove', {
                    data: moves,
                    key: options.key,
                    action: 'move',
                    ext: options.ext
                });

            }.bind(this)
        });
    };
    /**
     * 获取某节点的孩子节点和孙子节点
     * @param {Object} [options] - 参数对象
     * @property {Number} [options.data.specId] - 规范id
     * @property {Number} [options.data.id] - 当前节点的id
     * @success dispatch event: ongetchildren
     */
    _pro._$getChildren = function (options) {
        this.__doAction({
            key: options.key,
            method: 'GET',
            data: options.data,
            onload: function (event) {
                var children = event.data;
                var data = this._$getListInCache(options.key);
                if (options.ext.parent === 0) {
                    this._$setListInCache(options.key, children);
                }
                else {
                    var item = this.__findItem(data, options.ext.parent);
                    item.children = children;
                }
                this._$dispatchEvent('ongetchildren', {
                    key: options.key,
                    data: children,
                    action: 'getchildren',
                    ext: options.ext
                });
            }.bind(this)
        })
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        if (options.key === _p._$cacheKeyToken) {
            url = '/api/specdocs/?token'
        } else if (options.key.indexOf(this.__cacheKey) > -1) {
            url = '/api/specdocs/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };
    // /**
    //  * 导出规范结构
    //  * @param {Object} options - 参数对象
    //  * @success dispatch event: onexport
    //  */
    // _pro._$export = function (options) {
    //     this.__doAction({
    //         key: options.key,
    //         method: 'GET',
    //         action: 'export',
    //         data: options.data,
    //         onload: function (evt) {
    //             // this.__setDataInCache(evt.key, evt.data);
    //             // this._$dispatchEvent('onexport', evt);
    //         }.bind(this)
    //     });
    // };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','cc2e09517a742da0179cf6f4484b2b0b','993671841dcf289096c7171d53130309');
I$('53ae16a47e896f65063e7d0eb3867c57',function (_k, _u, _d, _caseCache, _infCache, _p, _pro) {
    _p._$$CacheTestcollection = _k._$klass();
    _pro = _p._$$CacheTestcollection._$extend(_d._$$Cache);
    _p._$cacheKey = 'testcollection';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url = '/api/testcollections/' + (options.id || '');
        if (options.action) {
            url += ('?' + options.action);
        }
        return url;
    };

    _pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (list) {
            var cache = _infCache._$$CacheInterface._$allocate();
            var listKey = cache._$getListKey(options.data.pid);
            (list || []).forEach(function (collect) {
                cache.__doSaveItemToCache(collect.interfaces, listKey);
            });
            cache._$recycle();
            if (onload) {
                onload(list);
            }
        }.bind(this);
        this.__super(options);
    };

    _pro._$getInterfaces = function (id) {
        var collect = this._$getItemInCache(id);
        var infOrder = collect.interfaceOrderList;
        var res = [];
        if (infOrder) {
            var infIdOrderList = infOrder.split(',');
            var infIds = [];
            var cache = _infCache._$$CacheInterface._$allocate();
            infIdOrderList.forEach(function (infId) {
                var inf = cache._$getItemInCache(infId);
                if (inf) {
                    res.push(inf);
                    infIds.push(infId);
                }
            });
            collect.interfaceOrderList = infIds.join(',');
            cache._$recycle();
        }
        return res;
    };

    _pro._$addInfs = function (options) {
        this.__doAction({
            headers: options.headers || {},
            action: 'interface',
            data: options.data,
            id: options.id,
            key: options.key,
            method: 'POST',
            actionMsg: '增加成功',
            onload: function (event) {
                _u._$merge(this.__getHash()[options.id], event.data);

                var cache = _caseCache._$$CacheTestCase._$allocate();
                var collAllKey = cache._$getListKeyByCollection(options.id);
                if (cache._$isLoaded(collAllKey)) {
                    cache._$clearListInCache(collAllKey);
                }
                options.data.interfaceIds.split(',').forEach(function (infId) {
                    cache._$clearListInCache(cache._$getListKeyByCollection(options.id, infId));
                });
                cache._$recycle();

                if (options.onload) {
                    options.onload(event);
                }
            }.bind(this)
        });
    };
    _pro._$removeInfs = function (options) {
        this.__doAction({
            headers: options.headers || {},
            action: 'interface',
            data: options.data,
            id: options.id,
            key: options.key,
            method: 'DELETE',
            actionMsg: '移除成功',
            onload: function (event) {
                _u._$merge(this.__getHash()[options.id], event.data);

                var cache = _caseCache._$$CacheTestCase._$allocate();
                var collAllKey = cache._$getListKeyByCollection(options.id);
                if (cache._$isLoaded(collAllKey)) {
                    var allCaseList = cache._$getListInCache(collAllKey);
                    var infs = options.data.interfaceIds.split(',').map(Number);
                    var ids = [];
                    allCaseList.forEach(function (caseItem) {
                        if (infs.indexOf(caseItem.interfaceId) > -1) {
                            ids.push(caseItem.id);
                        }
                    });
                    cache.__doRemoveItemFromList(collAllKey, ids);

                    infs.forEach(function (infId) {
                        cache._$clearListInCache(cache._$getListKeyByCollection(options.id, infId));
                    });
                }
                cache._$recycle();
                if (options.onload) {
                    options.onload(event);
                }
            }.bind(this)
        });
    };
    _pro._$removeCases = function (options) {
        this.__doAction({
            headers: options.headers || {},
            action: 'testcase',
            data: options.data,
            id: options.id,
            key: options.key,
            method: 'DELETE',
            actionMsg: '移除成功',
            onload: function (event) {
                var cache = _caseCache._$$CacheTestCase._$allocate();
                cache.__doRemoveItemFromList(cache._$getListKeyByCollection(options.id, options.data.interfaceId), event.data);
                var collAllKey = cache._$getListKeyByCollection(options.id);
                if (cache._$isLoaded(collAllKey)) {
                    cache.__doRemoveItemFromList(collAllKey, event.data);
                }
                cache._$recycle();
                if (options.onload) {
                    options.onload(event);
                }
            }.bind(this)
        });
    };
    _pro._$addCases = function (options) {
        this.__doAction({
            headers: options.headers || {},
            action: 'testcase',
            data: options.data,
            id: options.id,
            key: options.key,
            method: 'POST',
            actionMsg: '增加成功',
            onload: function (event) {
                var cache = _caseCache._$$CacheTestCase._$allocate();
                var addedList = event.data;
                var caseList = cache._$getListInCache(cache._$getListKeyByCollection(options.id, options.data.interfaceId));
                var allCaseList = cache._$getListInCache(cache._$getListKeyByCollection(options.id));
                addedList.forEach(function (caseItem) {
                    var originCase = cache._$getItemInCache(caseItem.id);
                    _u._$merge(originCase, caseItem);
                    caseList.push(originCase);
                    if (allCaseList.loaded) {
                        allCaseList.push(originCase);
                    }
                });
                cache._$recycle();
                if (options.onload) {
                    options.onload(event);
                }
            }.bind(this)
        });
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','c6dbf51c390a9de703c7bf6c9b46ff41','b8ce6d41dfffbb736de372f078b83c7e','7385ee68edde0ba303fb20b28ecfb227');
I$('b8ce6d41dfffbb736de372f078b83c7e',function (_k, _u, _v, _c, _d, _infCache, _collectCache, db, notify, util, modal, _p, _pro) {
    _p._$$CacheTestCase = _k._$klass();
    _pro = _p._$$CacheTestCase._$extend(_d._$$Cache);
    _p._$cacheKey = 'testcase';

    /**
     * åˆå§‹åŒ–
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
        // æ•°æ®æ£€æŸ¥é”™è¯¯ç±»åž‹å¸¸é‡
        this.ERROR_TYPE = {
            JSON_ERROR: 0, // jsonæ ¼å¼é”™è¯¯
            TYPE_ERROR: 1, // æ•°æ®ç±»åž‹é”™è¯¯
            EXPECT_ERROR: 2, // æœŸæœ›å€¼ä¸åŒ¹é…
            MISS_ERROR: 3 // ç¼ºå°‘å­—æ®µ
        };
        // æµ‹è¯•ç”¨ä¾‹stateå¢žåŠ TESTINGçŠ¶æ€
        this.API_TST_TESTING = 4;
        // æµ‹è¯•é˜Ÿåˆ—æœ€å¤§é•¿åº¦,å¦‚æžœæŸæ—¶åˆ»æœ‰è¶…è¿‡æ­¤æ•°é‡çš„è¯·æ±‚æœªå¾—åˆ°å“åº”åˆ™æ­¤æ—¶ä¸ç»§ç»­å‘é€è¯·æ±‚ï¼Œç­‰å¾…æœ‰å“åº”åˆ°è¾¾åŽç»§ç»­
        this.__MAX_TEST_NUM = 5;
        // é¿å…é‡å¤æ·»åŠ äº‹ä»¶
        if (!this.constructor.__isItemsAddedEventListened) {
            this.constructor.__isItemsAddedEventListened = true;
            _v._$addEvent(
                this.constructor, 'update', function (evt) {
                    var testQueue = this._$getTestQueue();
                    var caseId = evt.data.id;
                    var state = evt.data.state;
                    _u._$forIn(testQueue, function (test) {
                        // æ‰¾åˆ°è¢«æ›´æ–°çš„ä¸€é¡¹å¹¶ä¿®æ”¹æµ‹è¯•çŠ¶æ€
                        if (test.id === caseId) {
                            test.state = state;
                        }
                    });
                }.bind(this)
            );
        }
    };

    /**
     * èŽ·å–æ­£åœ¨æµ‹è¯•çš„é˜Ÿåˆ—
     */
    _pro._$getTestQueue = function () {
        // ä¸‰ä¸ªé˜Ÿåˆ—åˆèµ·æ¥æ˜¯æµ‹è¯•è¿›åº¦è¦æ˜¾ç¤ºçš„å…¨éƒ¨é˜Ÿåˆ—
        return this.__getDataInCache('testedqueue').concat(this.__getDataInCache('testingqueue').concat(this.__getDataInCache('testqueue')));
    };

    /**
     * è®¾ç½®æµ‹è¯•æ‰€éœ€çš„å‚æ•°
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @param {Object} options.datatype - å‚æ•°å¯¹è±¡
     * @param {Object} options.constraints - å‚æ•°å¯¹è±¡
     */
    _pro._$setTestOptions = function (options) {
        // è¿™ä¸ªå‡½æ•°ç”¨æ¥è®¾ç½®ä¸€äº›æµ‹ç»˜å¿…é¡»çš„å‚æ•°ï¼Œå…¶å®žåº”è¯¥åœ¨éœ€è¦è¿™äº›ä¸œè¥¿çš„å‡½æ•°é‡Œä¼ ï¼Œä½†æ˜¯å¥½å‡ ä¸ªå‡½æ•°éƒ½éœ€è¦ï¼Œä¼ ç€å¾ˆçƒ¦ï¼Œæ‰€ä»¥ç›´æŽ¥å…ˆåœ¨è¿™é‡Œé…ç½®ä¸€ä¸‹äº†ï¼Œä½†ä¸å‘¢ä¹ˆä¼˜é›…ï¼Œå¾…ä¼˜åŒ–
        this.__datatypes = {};
        _u._$forEach(options.datatypes, function (datatype) {
            this.__datatypes[datatype.id] = datatype;
        }._$bind(this));
        if (options.constraints) this.__constraints = options.constraints;
    };

    /**
     * æ›´æ–°
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @property {Number} options.id - æµ‹è¯•ç”¨ä¾‹ id
     * æ”¯æŒæ›´æ–°çš„å­—æ®µæœ‰:
     * @property {String} [options.name] - åç§°
     * @property {String} [options.description] - æè¿°ä¿¡æ¯
     * @property {Number} [options.testerId] - æ‰§è¡Œè€…id
     * @property {Number} [options.testBeginTime] - å¼€å§‹æ—¶é—´
     * @property {Number} [options.testEndTime] - ç»“æŸæ—¶é—´
     * @property {String} [options.reqHeader] - æŽ¥å£è¯·æ±‚å¤´ï¼ŒJSONä¸²
     * @property {String} [options.reqData] - æŽ¥å£è¯·æ±‚æ¶ˆæ¯ä½“
     * @property {String} [options.resHeader] - æŽ¥å£å“åº”å¤´ï¼ŒJSONä¸²
     * @property {String} [options.resData] - æŽ¥å£å“åº”æ¶ˆæ¯ä½“
     * @property {String} [options.report] - ç”¨ä¾‹è¿è¡ŒåŽç»“æžœæŠ¥å‘Š
     * @success dispatch event: onitemupdate
     */
    _pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    _pro._$getListInCache = function (key) {
        var list = this.__super(key);
        if (/(\d+)-collection-(\d+)/.test(key)) {
            var cache = _infCache._$$CacheInterface._$allocate();
            var ids = [];
            _u._$reverseEach(list, function (caseItem, index) {
                if (!cache._$getItemInCache(caseItem.interfaceId) || !this.__getHash()[caseItem.id]) {
                    ids.push(index);
                }
            }, this);
            ids.forEach(function (index) {
                list.splice(index, 1);
            })
            cache._$recycle();

            // æŒ‰ç…§æŽ¥å£æŽ’åº
            var iid = RegExp.$1;
            if (iid === '0') {
                var cid = parseInt(RegExp.$2, 10);
                var collectCache = _collectCache._$$CacheTestcollection._$allocate({});
                var collect = collectCache._$getItemInCache(cid);
                var infIds = collect.interfaceOrderList.split(',').map(Number);
                list.sort(function (case1, case2) {
                    return infIds.indexOf(case1.interfaceId) > infIds.indexOf(case2.interfaceId + '');
                });
                collectCache._$recycle();
            }
        }
        return list;
    };

    _pro._$deleteItems = function (options) {
        options.onload = function (event) {
            var deletedList = event.data;
            deletedList.forEach(function (item) {
                delete this.__getHash()[item.id];
            }, this);
        }.bind(this);
        this.__super(options);
    };

    /**
     * æ ¹æ®å‚æ•°, èŽ·å–è¯·æ±‚ url
     * @param {Object} options - å‚æ•°å¯¹è±¡
     * @return {String} request url
     */
    _pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf('collection') > -1) {
            url = '/api/testcases/?collection';
        }
        else if (options.key.indexOf(_p._$cacheKey) > -1) {
            url = '/api/testcases/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };


    /**
     * å¼€å§‹æµ‹è¯•
     * @param {Array} tests - æµ‹è¯•ç”¨ä¾‹æ•°æ®åˆ—è¡¨
     * @param {Number} pid
     * @return {Void}
     */
    _pro._$startTests = function (tests, pid) {
        var tip = (tests.length === 1 ? '' : (tests.length + 'ä¸ª' )) + 'æµ‹è¯•å¼€å§‹';
        notify.show(tip, 'success', 1200);
        this.__statusMap = this.__statusMap || {};
        // å–è¯¥é˜Ÿåˆ—ï¼Œå–ä¸åˆ°æ–°å¢žä¸€ä¸ªå†å–ï¼Œä¸‹ä¸‰åŒ
        this.__testQueue = this.__getDataInCache('testqueue') || this.__setDataInCache('testqueue', []) || this.__getDataInCache('testqueue'); //è¯·æ±‚æŽ’é˜Ÿï¼Œå¾…è¿›å…¥testingqueue
        this.__testingQueue = this.__getDataInCache('testingqueue') || this.__setDataInCache('testingqueue', []) || this.__getDataInCache('testingqueue'); //è¯·æ±‚å¤„äºŽé•¿åº¦å—æŽ§åˆ¶çš„å¾…å‘é€é˜Ÿä¼ï¼Œè“„åŠ¿å¾…å‘
        this.__testedQueue = this.__getDataInCache('testedqueue') || this.__setDataInCache('testedqueue', []) || this.__getDataInCache('testedqueue'); //è¯·æ±‚åœ¨è·¯ä¸Š
        tests.forEach(function (test) {
            // æ‰¹é‡ä¿®æ”¹æµ‹è¯•çŠ¶æ€ä¸ºå¾…å¼€å§‹
            test.state = db.API_TST_TODO;
            if (!test.pid && pid) test.pid = pid; //ä¸ºæµ‹è¯•é˜Ÿåˆ—ä¸­çš„æµ‹è¯•æŠ¥å‘Šå…¥å£æä¾›æ‰€éœ€å‚æ•°
            this.__statusMap[test.id] = 1;
            this.__testQueue.push(test);
            // 触发全局的 update 事件
            _v._$dispatchEvent(
                this.constructor, 'update', {
                    data: test,
                    action: 'update',
                    key: this.__cacheKey
                }
            );
        }._$bind(this));
        // 控制待发送队伍长度，防止一把请求炸了服务器
        while ((this.__testingQueue.length < this.__MAX_TEST_NUM) && this.__testQueue.length) this.__testingQueue.push(this.__testQueue.shift());
        this.__continueTests();
        if (tests.length) {
            ga('send', 'event', {
                'eventCategory': 'testcase',
                'eventAction': 'run',
                'eventValue': tests.length
            });
        }
    };


    /**
     * 组织测试数据(搞成这样是为了测试的时候好用)
     * @param {Object} test - 单个测试用例详情
     * @return {Object}
     */
    _pro._$getTestData = function (test, interface, oldtest, reqdata) {
        var _reqdata = this.__parseJSON(test.reqData, interface.params.inputs);
        reqdata = reqdata || (_reqdata ? _reqdata.reqParams : '');
        var reqheader = this.__parseJSON(test.reqHeader, interface.params.reqHeaders);
        var data = {
            name: test.name,
            state: test.state,
            id: test.id || oldtest.id,
            iid: interface.id,
            pgid: interface.progroupId,
            method: interface.method,
            urlOpt: {
                format: interface.reqFormat,
                host: test.host,
                path: interface.path,
                method: interface.method,
                params: _reqdata ? _reqdata.__urlParams : '',
                reqdata: interface.method.toLowerCase() !== 'get' ? '' : reqdata
            },
            data: {
                reqHeader: reqheader,
                reqData: interface.method.toLowerCase() === 'get' ? '' : reqdata
            },
            updatedata: {
                id: test.id || oldtest.id,
                data: {
                    state: db.API_TST_PASS,
                    host: test.host,
                    name: test.name,
                    description: test.description,
                    report: '',
                    reqHeader: reqheader ? JSON.stringify(reqheader) : '',
                    reqData: _reqdata ? JSON.stringify(_reqdata) : '',
                    resHeader: '',
                    resData: '',
                    resExpect: test.resExpect,
                    resExpectHeader: test.resExpectHeader
                }
            },
            resparams: {
                outputs: interface.params.outputs,
                resHeaders: interface.params.resHeaders
            },
            resformat: interface.resFormat,
            resExpect: test.resExpect,
            resExpectHeader: test.resExpectHeader,
            beforeScript: interface.beforeScript,
            afterScript: interface.afterScript
        };
        oldtest = oldtest || test;
        // 不传未改动的字段
        _u._$forIn(data.updatedata.data, function (item, key, data) {
            if (item === oldtest[key]) {
                delete data[key];
            }
        }._$bind(this));
        return data;
    };

    _pro.__parseJSON = function (json, params) {
        // 应对修改了接口之后直接在列表中开始测试的情况，如果删除了接口字段，则在用例中也清除。关于修改了接口还不进测试详情就直接开始测试这么傲娇的用户我也不知道怎么服务更多了。
        var obj = null;
        var keys = '';
        var paramname;
        try {
            obj = JSON.parse(json);
            params.forEach(function (param) {
                paramname = param.name.trim();
                // 用于找出已删除的字段
                paramname && (keys += paramname + ',');
            });
            if (keys && _u._$isObject(obj.reqParams)) {
                // 删除测试用例中存在而接口定义中已删除的字段
                _u._$forIn(obj.reqParams, function (value, key, obj) {
                    if (keys.indexOf(key) < 0) delete obj[key];
                })
            }
        } catch (ex) {
            // ignore
        }
        return obj;
    }

    _pro._$getListKeyByCollection = function (cid, id) {
        return this.__cacheKey + '-' + (id || 0) + '-collection-' + cid;
    };

    /**
     * 控制测试队列
     * @return {Void}
     */
    _pro.__continueTests = function () {
        // 完成从待测试队列中抓出若干项调用this.__doTestInterface()发出请求并塞回已测试队列，修改state
        var testing;
        while (this.__testingQueue.length) {
            testing = this.__testingQueue.shift();
            testing.state = this.API_TST_TESTING;
            this.__testedQueue.push(testing);
            // 触发全局的 update 事件
            _v._$dispatchEvent(
                this.constructor, 'update', {
                    data: testing,
                    action: 'update',
                    key: this.__cacheKey
                }
            );
            this.__doTestInterface(testing);
        }
    }

    /**
     * 执行测试接口
     * @param  {Object} options
     * @param  {Object} options.updatedata 测试用例更新的数据
     * @param  {Object} options.data 测试用例的输入数据
     * @param  {Object} options.method 请求方法
     * @param  {Object} options.url 请求路径
     * @param  {Object} options.resparams 接口定义的响应参数
     * @param  {Object} options.resFormat 接口定义的响应参数
     * @return {Void}
     */
    _pro.__doTestInterface = function (options) {
        options.updatedata.data.testBegTime = Date.now();

        var handleTestResult = function (result) {
            _u._$merge(options.updatedata.data, result, function (v, k) {
                // 保证只merge这几个字段：'resData', 'resHeader', 'report', 'state'
                return !~['resData', 'resHeader', 'report', 'state'].indexOf(k);
            });
            options.updatedata.data.testEndTime = Date.now();
            options.updatedata.actionMsg = false;
            // 更新用例数据
            this._$updateItem(options.updatedata);
            // 继续测试
            while ((this.__testingQueue.length < this.__MAX_TEST_NUM) && this.__testQueue.length) {
                // 当前测试完成，空出测试一个坑，从排队的里面抓出一只塞进坑里并告诉老板可以继续了 (代码没达到这效果)
                this.__testingQueue.push(this.__testQueue.shift());
                this.__continueTests();
            }
            delete this.__statusMap[options.id];
            if (Object.keys(this.__statusMap).length === 0) {
                notify.show('测试完成', 'success', 1200);
            }
        };
        var sendRequest = function (sendOpt) {
            this.__sendXhrReq(sendOpt, function (result) {
                result = this.__parseResult(result);
                if (result[0]) {
                    result = result[1];
                    // 有接收规则时在发请求前执行，同发送规则
                    if (options.afterScript) {
                        // 执行处理规则
                        util._$runScript({
                            code: options.afterScript,
                            params: {
                                host: options.urlOpt.host,
                                path: options.urlOpt.path,
                                method: result.reqData.method,
                                headers: JSON.parse(result.resHeader),
                                data: JSON.parse(result.resData)
                            },
                            constraints: this.__constraints,
                            onmessage: function (event) {
                                var scriptResult = JSON.parse(event.data);
                                // 检查用户返回的data字段
                                if (scriptResult && scriptResult.data) {
                                    var dataCheckResult = this._$checkResData(scriptResult.data, options.resformat, options.resparams.outputs, options.resExpect).result;
                                }
                                // 检查用户返回的header字段
                                if (scriptResult && scriptResult.headers) {
                                    var headerCheckResult = this._$checkResData(scriptResult.headers, db.MDL_FMT_HASH, options.resparams.resHeaders, options.resExpectHeader).result;
                                }
                                // 检出任一字段有错误时修改state
                                if (!dataCheckResult || !headerCheckResult) {
                                    result.state = db.API_TST_FAILED;
                                }
                                handleTestResult.call(this, result);
                            }.bind(this),
                            onerror: function (error) {
                                // 执行规则出错时弹框提示并发出事件让外面onerror知道
                                this._$dispatchEvent('onerror', error);
                                if (!this.__afterScriptErrorModal) {
                                    this.__afterScriptErrorModal = new modal({
                                        data: {
                                            "content": error.message,
                                            'title': '接收规则执行失败',
                                            'closeButton': true,
                                            "okButton": '修改规则',
                                            "cancelButton": true
                                        }
                                    }).$on('ok', function () {
                                        dispatcher._$redirect('/interface/detail/res/?pid=' + options.pid + '&id=' + options.iid);
                                    }._$bind(this)).$on('cancel', function () {
                                        this.__afterScriptErrorModal = this.__afterScriptErrorModal.destroy();
                                    }.bind(this));
                                }
                            }.bind(this)
                        });
                    } else {
                        if (result.resData) {
                            var dataCheckResult = this._$checkResData(JSON.parse(result.resData), options.resformat, options.resparams.outputs, options.resExpect).result;
                        }
                        if (result.resHeader) {
                            var headerCheckResult = this._$checkResData(JSON.parse(result.resHeader), db.MDL_FMT_HASH, options.resparams.resHeaders, options.resExpectHeader).result;
                        }
                        if (!dataCheckResult || !headerCheckResult) {
                            result.state = db.API_TST_FAILED;
                        }
                        handleTestResult.call(this, result);
                    }
                } else {
                    handleTestResult.call(this, result[1]);
                }
            }.bind(this));
        };

        if (options.beforeScript) {
            // 执行发送规则
            util._$runScript({
                code: options.beforeScript,
                params: {
                    host: options.urlOpt.host,
                    path: options.urlOpt.path,
                    method: options.method,
                    headers: options.data.reqHeader,
                    data: options.data.reqData
                },
                constraints: this.__constraints,
                onmessage: function (event) {
                    // 发送规则可能影响URL成分，所以重新生成一把URL
                    var scriptResult = JSON.parse(event.data);
                    _u._$forIn(options.urlOpt, function (value, key, obj) {
                        if (scriptResult[key]) obj[key] = scriptResult[key];
                    });
                    sendRequest.call(this,
                        {
                            url: this._$getTestUrl(options.urlOpt),
                            method: scriptResult.method || options.method,
                            data: {
                                reqHeader: scriptResult.headers || options.data.reqHeader,
                                reqData: scriptResult.data || options.data.reqData
                            }
                        });
                }.bind(this),
                onerror: function (error) {
                    this._$dispatchEvent('onerror', error);
                    if (!this.__beforeScriptErrorModal) {
                        this.__beforeScriptErrorModal = new modal({
                            data: {
                                "content": error.message,
                                'title': '发送规则执行失败',
                                'closeButton': true,
                                "okButton": '修改规则',
                                "cancelButton": true
                            }
                        }).$on('ok', function () {
                            dispatcher._$redirect('/interface/detail/?pid=' + options.pid + '&id=' + options.iid);
                        }._$bind(this)).$on('cancel', function () {
                            this.__beforeScriptErrorModal = this.__beforeScriptErrorModal.destroy();
                        }.bind(this));
                    }
                }.bind(this)
            })
        } else {
            sendRequest.call(this, {
                url: this._$getTestUrl(options.urlOpt),
                method: options.method,
                data: options.data
            });
        }
    };

    /**
     * 解析返回结果
     * @param  {Object} result
     * @return {Array} [reuslt,data]
     */
    _pro.__parseResult = function (result) {
        var data = {reqData: result.reqData, resData: result.resData};
        var isLegal = this._$checkJSON(result.resData).result;
        // 在跨域插件返回的xhr中抓出响应头并解析为object
        if (result.xhr.responseHeaders) {
            var _resheader = this._$doTransformType(result.xhr.responseHeaders, 'resheaders');
            data.resHeader = JSON.stringify(_resheader);
        } else data.resHeader = JSON.stringify({});
        if (result.xhr.status != '200') {
            isLegal = false;
            data.report = result.xhr.responseText ? result.xhr.status + ':' + result.xhr.responseText : '无响应';
        }
        !isLegal && (data.state = db.API_TST_FAILED);
        return [isLegal, data];
    };

    /**
     * 检查返回结果
     * @param  {Object} data - 待检查数据
     * @param  {Number} format - 待检查数据类别
     * @param  {Array} params - 期望数据类型参数
     * @param  {Object} expect - 预期数据
     * @return {Array} 错误信息列表
     */
    _pro._$checkResData = function (data, format, params, expect) {
        var checkResult = this.__checkResType(data, params, format);
        if (!checkResult.result)return checkResult;// 检查出数据类型错误的情况下不进行预期值检查，直接返回数据类型错误信息
        expect && (expect = JSON.parse(expect));
        return this.__checkByExpect(data, expect);
    };

    /**
     * 检查预期值匹配情况
     * @param  {Object} value
     * @param  {Object} expect
     * @return {Array} 错误信息列表
     */
    _pro.__checkByExpect = function (value, expect) {
        var checkResult = {
            result: true,
            errorMessage: []
        };
        if (!value || !expect)return checkResult;
        if (_u._$isObject(value)) {
            for (i in expect) {
                if (JSON.stringify(value[i]) !== JSON.stringify(expect[i].value)) {
                    checkResult.result = false;
                    checkResult.errorMessage = checkResult.errorMessage.concat({
                        type: this.ERROR_TYPE.EXPECT_ERROR,
                        data: JSON.stringify(value[i]),
                        keys: [i],
                        message: expect[i].error,
                        expect: JSON.stringify(expect[i].value)
                    });
                }
            }
        } else if (expect.value && (JSON.stringify(value) !== JSON.stringify(expect.value))) {
            checkResult.result = false;
            checkResult.errorMessage = [{
                type: this.ERROR_TYPE.EXPECT_ERROR,
                data: JSON.stringify(value),
                message: expect.error,
                expect: JSON.stringify(expect.value)
            }];
        }
        return checkResult;
    }
    /**
     * 拼接接口url
     * @param {Object} options
     * @param {String} options.host - 服务器地址
     * @param {String} options.path - 接口路径
     * @param {String} options.method - 请求方法
     * @param {Object} options.params - 参数对象
     * @return {String} url
     */
    _pro._$getTestUrl = function (options) {
        var host = options.host.replace(/\/$/, '');
        var pathIndex = options.path.indexOf('?');
        var reqPath = options.path;
        var queryStr = '';
        if (pathIndex > -1) {
            reqPath = options.path.substring(0, pathIndex);
            queryStr = options.path.substring(pathIndex);
        }
        _u._$forIn(options.params, function (val, param) {
            reqPath = reqPath.replace('/:' + param, '/' + val);
        });
        var url = host + reqPath + queryStr;
        // 请求方法为get时请求数据拼接到URL后
        if (options.method.toLowerCase() === 'get' && options.format == db.MDL_FMT_HASH) {
            var query = [];
            _u._$forIn(options.reqdata, function (val, key) {
                if (val !== '') {
                    query.push(key + '=' + encodeURIComponent(val));
                }
            });
            if (query.length) {
                url = url + (queryStr ? '&' : '?') + query.join('&');
            }
        }

        return url;
    }
    /**
     * 将数据转换为指定类型
     * @param {} value - 待转换数据
     * @param {Number} type - 目标数据模型类别
     * @param {Boolean} isArray - 目标数据模型是否数组
     * @return {} value - 转换后数据
     */
    _pro.__transformToType = function (value, type, isArray) {
        // 把从表单里新鲜取出的统一字符串转换为定义的格式
        var typeobj = this.__datatypes[type];
        if (isArray) {
            if (typeof value === 'string') {
                try {
                    value = JSON.parse(value);
                } catch (err) {
                    // ignore
                }
            }
        } else switch (typeobj.format) {
            case db.MDL_FMT_STRING:
                // 数据从页面传回默认string类型，此处去掉用户可能自己输入的多余引号
                if (value !== '""') {
                    if ((value[0] === "'" && value[value.length - 1] === "'") || (value[0] === '"' && value[value.length - 1] === '"')) {
                        value = value.slice(1, -1);
                    }
                    value += '';
                }
                break;
            case db.MDL_FMT_NUMBER:
                value = /\D/.test(value) ? value : Number(value);
                break;
            case db.MDL_FMT_BOOLEAN:
                value = /^([01]|true|false)?$/.test(value) ? !!('' + value).match(/^([01]|true|false)?$/)[0] : value;
                break;
            case db.MDL_FMT_ENUM:
                // 转换为数字或布尔类型
                value = this.__transformToType(value, typeobj.params[0].type);
                break;
            case db.MDL_FMT_HASH:
                if (typeof value === 'string') {
                    try {
                        value = JSON.parse(value);
                    } catch (err) {
                        // ignore
                    }
                }
            // _u._$forEach(typeobj.params, function(param){
            //     if (value[param.name]) {
            //         value[param.name] = this.__transformToType(value[param.name], param.type, param.isArray);
            //     }
            // }.bind(this));
            // break;
        }
        return value;
    }

    /**
     * 按照定义转换数据模型
     * @param {} value - 待转换数据
     * @param {Number} format - 目标数据模型类别
     * @param {Array} params - 目标数据模型参数列表
     * @return {} value - 转换后数据
     */
    _pro._$doTransformType = function (value, format, params) {
        switch (format) {
            case db.MDL_FMT_ENUM:
                value = this.__transformToType(value, params[0].type);
                break;
            case db.MDL_FMT_ARRAY:
                value = this.__transformToType(value, params[0].type, params[0].isArray + 1);
                break;
            case db.MDL_FMT_HASH:
                if (typeof value === 'string') {
                    try {
                        value = JSON.parse(value);
                    } catch (err) {
                        // ignore
                    }
                }
                _u._$forEach(params, function (param) {
                    if (value[param.name]) {
                        value[param.name] = this.__transformToType(value[param.name], param.type, param.isArray);
                    }
                }.bind(this));
                break;
            // 解析跨域插件拿回的响应头
            case 'resheaders':
                var valueArr = value.split('\n');
                value = {};
                valueArr.forEach(function (item) {
                    if (item) {
                        var index = item.indexOf(':');
                        value[item.slice(0, index)] = item.slice(index + 1).trim();
                    }
                })
                break;
            default:
                value = this.__transformToType(value, params[0].type, false);
                break;
        }
        return value;
    }

    _pro._$checkJSON = function (value) {
        // 检查响应数据是否是合法json，不是的话抛出对应错误
        var isLegal = true;
        var errorMessage;
        try {
            value = JSON.parse(value);
        } catch (err) {
            errorMessage = [{type: this.ERROR_TYPE.JSON_ERROR, message: err}];
            isLegal = false;
        }
        return {
            result: isLegal,
            errorMessage: errorMessage,
            value: value
        }
    }

    /**
     * 检查响应数据格式是否符合定义
     * @param  {Object} value - 待检查数据
     * @param  {Array} params - 数据模型参数数组
     * @param  {Number} format - 预期数据类型类别
     * @return {Object}
     */
    _pro.__checkResType = function (value, params, format) {
        var isLegal = true,
            errorMessage = [],
            checkResult;
        // array,string,number,boolean,file类型的参数列表里只有一个没名字的参数
        if (params.length === 1 && !params[0].name) {
            checkResult = this._$isTypeMatched(value, this.__datatypes[params[0].type],
                (format == db.MDL_FMT_ARRAY) + params[0].isArray);
            if (checkResult.result !== true) {
                errorMessage = checkResult.errorMessage;
                isLegal = false;
            } else value = checkResult.value;
        } else {
            _u._$forIn(this._$clearRepeatedParam(params), function (param) {
                // 未传则判断为字段缺失错误
                if (typeof value[param.name] !== 'undefined') {
                    // header参数没有type字段，默认string类型
                    checkResult = this._$isTypeMatched(value[param.name], this.__datatypes[param.type || db.MDL_SYS_STRING], param.isArray, [param.name]);
                    if (checkResult.result !== true) {
                        errorMessage = errorMessage.concat(checkResult.errorMessage);
                        isLegal = false;
                    } else value[param.name] = checkResult.value;
                } else {
                    errorMessage = errorMessage.concat({
                        type: this.ERROR_TYPE.MISS_ERROR,
                        keys: [param.name]
                    });
                    isLegal = false;
                }
            }._$bind(this));
        }

        return {
            result: isLegal,
            errorMessage: errorMessage,
            value: value
        }
    }

    /**
     * 检查数据模型是否匹配
     * @param {String} value - 待检测值
     * @param {String} datatype - 待匹配数据模型详情
     * @param {Number} isArray - 待匹配数据模型是否是数组
     * @param {Array} keys - 检测字段路径
     * @return {Object} options
     * @property {Boolean} options.result - 是否匹配
     * @property {Boolean} options.value - result为true时为转换后的值
     * @property {Array} options.errorMessage - 错误信息数组
     * @property {Number} options.errorMessage.type - 错误类型标识
     * @property {String} options.errorMessage.data - 出错值
     * @property {String} options.errorMessage.datatype - 期待数据类型名称
     */
    _pro._$isTypeMatched = function (value, datatype, isArray, keys) {
        var isMatched = true;
        var errorMessage = [];
        var datatypeName, checkResult;
        var params = datatype.params || [];
        keys = keys || [];
        // 先处理数组类型情况
        if (isArray > 0) {
            checkArray.call(this);
        } else {
            switch (datatype.format) {
                case db.MDL_FMT_STRING:
                    datatypeName = 'string';
                    isMatched = typeof value === datatypeName;
                    if (!isMatched) {
                        errorMessage = {
                            type: this.ERROR_TYPE.TYPE_ERROR,
                            data: JSON.stringify(value),
                            datatype: datatype.name || datatypeName,
                            keys: keys
                        };
                    }
                    break;
                case db.MDL_FMT_NUMBER:
                    datatypeName = 'number';
                    isMatched = typeof value === datatypeName;
                    if (!isMatched) {
                        errorMessage = {
                            type: this.ERROR_TYPE.TYPE_ERROR,
                            data: JSON.stringify(value),
                            datatype: datatype.name || datatypeName,
                            keys: keys
                        };
                    }
                    break;
                // boolean使用正则表达式检查
                case db.MDL_FMT_BOOLEAN:
                    datatypeName = 'boolean';
                    isMatched = /^([01]|true|false)?$/.test(value);
                    if (!isMatched) {
                        errorMessage = {
                            type: this.ERROR_TYPE.TYPE_ERROR,
                            data: JSON.stringify(value),
                            datatype: datatype.name || datatypeName,
                            keys: keys
                        };
                    }
                    break;
                // 检查枚举类型
                case db.MDL_FMT_ENUM:
                    datatypeName = 'enum';
                    // 先假设匹配失败
                    isMatched = false;
                    _u._$forIn(params, function (param) {
                        // 若value等于枚举中任一项，并且类型匹配，则匹配成功，并跳出循环
                        value = this.__transformToType(value, param.type);// 现转换参数类型再严格比较
                        if (value == param.defaultValue) {
                            return (isMatched = true);
                        }
                    }._$bind(this))
                    if (!isMatched) {
                        errorMessage = {
                            type: this.ERROR_TYPE.TYPE_ERROR,
                            data: JSON.stringify(value),
                            datatype: datatype.name || "枚举",
                            keys: keys
                        };
                    }
                    break;
                case db.MDL_FMT_ARRAY:
                    checkArray.call(this);
                    break;
                // 检查哈希和匿名类型
                case db.MDL_FMT_HASH:
                    datatypeName = 'hash';
                    if (typeof value === 'string') {
                        try {
                            value = JSON.parse(value);
                        } catch (err) {
                            isMatched = false;
                            errorMessage = {type: this.ERROR_TYPE.JSON_ERROR, message: err, keys: keys};
                        }
                    }
                    if (isMatched) {
                        if (!_u._$isObject(value)) {
                            isMatched = false;
                            errorMessage = {
                                type: this.ERROR_TYPE.TYPE_ERROR,
                                data: JSON.stringify(value),
                                datatype: datatype.name || 'object',
                                keys: keys
                            };
                        } else {
                            errorMessage = [];
                            _u._$forEach(this._$clearRepeatedParam(params), function (param) {
                                // 判断该属性是否存在
                                if (param && value && typeof value[param.name] !== 'undefined') {
                                    // 判断属性类型是否匹配
                                    checkResult = this._$isTypeMatched(value[param.name],
                                        this.__datatypes[param.type],
                                        param.isArray, keys.concat(param.name));
                                    if (checkResult.result !== true) {
                                        // 这里只能concat新数组不能push直接传，否则会引起引用类型问题
                                        errorMessage = errorMessage.concat(checkResult.errorMessage);
                                        isMatched = false;
                                    }
                                } else {
                                    errorMessage = errorMessage.concat({
                                        type: this.ERROR_TYPE.MISS_ERROR,
                                        keys: keys.concat(param.name)
                                    });
                                    isMatched = false;
                                }
                            }._$bind(this))
                        }
                    }
                    break;
            }
        }
        return {
            result: isMatched,
            errorMessage: errorMessage,
            value: value
        }

        function checkArray() {
            if (typeof value === 'string') {
                try {
                    value = JSON.parse(value);
                } catch (err) {
                    isMatched = false;
                    errorMessage = {type: this.ERROR_TYPE.JSON_ERROR, message: err, keys: keys};
                }
            }
            if (isMatched) {
                if (Array.isArray(value)) {
                    _u._$forEach(value, function (value, index) {
                        var isArrayBack = isArray;
                        checkResult = this._$isTypeMatched(value, isArray > 0 ? datatype : this.__datatypes[params[0].type], --isArray, keys.concat(index));//--isArray 用来表示请求类型为数组时嵌套数组
                        if (checkResult.result !== true) {
                            errorMessage = errorMessage.concat(checkResult.errorMessage);
                            isMatched = false;
                        }
                        isArray = isArrayBack;
                    }._$bind(this))
                } else {
                    isMatched = false;
                    errorMessage = {
                        type: this.ERROR_TYPE.TYPE_ERROR,
                        data: JSON.stringify(value, null, '\t'),
                        datatype: isArray > 0 ? 'Array' : datatype.name, // 用isArray标记数组时数据类型存储省略一层Array，datatype.name,不是类型名而是数组参数的类型名
                        keys: keys
                    };
                }
            }
        }
    }

    /**
     * 判断是否空对象
     * @param {Object} obj
     * @return {Boolean}
     */
    _pro.__isEmptyObject = function (obj) {
        var t;
        for (t in obj) return false;
        return true;
    };

    /**
     * 删除重复的参数
     * @param {Array} params - 参数数组
     * @return {Array} 去重后的参数数组
     */
    _pro._$clearRepeatedParam = function (params) {
        var newparams = [];
        var k = {}; //记录某一名字的属性是否已存在
        var i, n;
        for (i = params.length - 1; i >= 0; i--) {
            n = params[i].name; //属性名
            // 属性名唯一或为空时保留，重复则丢弃
            if (!k[n] || n === '') {
                newparams.push(params[i]);
                k[n] = true;
            }
        }
        return newparams;
    }

    /**
     * 检查XHR proxy tool插件是否安装
     * @param {Function} callback
     * @return {Void}
     */
    _pro._$checkXhrpt = function (callback) {
        var that = this, sendId = Date.now();
        document.addEventListener('check-xhrpt-ext-res', function (e) {
            if (!e.detail || !e.detail.reqData || e.detail.reqData.sendId !== sendId) return;
            callback.apply(that);
        }._$bind(this), false);
        var event = new CustomEvent('check-xhrpt-ext', {
            detail: {
                sendId: sendId
            }
        });
        document.dispatchEvent(event);
    }

    /**
     * 发送异步请求
     * @param  {Object} options
     * @property {String} options.url
     * @property {String} options.method
     * @property {Object} options.data
     * @param  {Function} callback
     * @return {Void}
     */
    _pro.__sendXhrReq = function (options, callback) {
        var that = this;
        var sendId = Date.now() + '-' + Math.random();
        var defaultHeaders = {
            'Content-Type': 'application/json'
        };
        var data = {
            url: options.url,
            method: options.method,
            headers: _u._$merge(defaultHeaders, options.data.reqHeader || {}, function (v, k) {
                var uk = k.split('-').map(function (h) {
                    return h.charAt(0).toUpperCase() + h.substring(1);
                }).join('-');
                if (defaultHeaders[uk]) {
                    delete defaultHeaders[uk];
                }
                defaultHeaders[uk] = v;
                return true;
            }),
            sendId: sendId
        };
        if (options.data.reqData) {
            var sendData = {};
            _u._$loop(options.data.reqData, function (v, k) {
                if (v !== '') {
                    if (v === '""') {
                        sendData[k] = '';
                    }
                    else {
                        sendData[k] = v.replace(/(\\\\)|(\\")/g, function (m) {
                            if (m === '\\\\') {
                                return '\\';
                            }
                            else {
                                return '"';
                            }
                        });
                    }
                }
            });
            data.data = sendData;
        }
        var event = new CustomEvent('sendto-xhrpt-ext', {detail: data});
        document.addEventListener('sendto-xhrpt-ext-res', function (e) {
            if (!e.detail || !e.detail.reqData || e.detail.reqData.sendId !== sendId) return;
            if (callback && typeof(callback) === "function") {
                try {
                    console.log(e);
                    callback.call(that, e.detail);
                } catch (ex) {
                    console.error(ex.message);
                    console.error(ex.stack);
                }
            }
            _v._$clearEvent(document, 'sendto-xhrpt-ext-res');
        }._$bind(this), false);
        document.dispatchEvent(event);
    }
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41','7385ee68edde0ba303fb20b28ecfb227','53ae16a47e896f65063e7d0eb3867c57','993671841dcf289096c7171d53130309','afb57ef5a0e0ee34baead79fa46d3e43','8cbc286a7834dfcf29c8f7a018e77c02','a17dfb1aca7e5bcf1c99411da2601159');
I$('81a3fb8e9bc8b7b175292bc37f0793dd',function (k, u, v, c, d, p, pro) {
    p._$$CacheVarMap = k._$klass();
    pro = p._$$CacheVarMap._$extend(d._$$Cache);
    p._$cacheKey = 'varmap';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__cacheKey = p._$cacheKey;
        this.__super(options);
    }

    /**
     * 新建变量映射
     * @param {Object} options - 参数对象
     * @property {String} options.parentId - 映射关系归属标识
     * @property {String} options.parentType - 映射关系归属类型
     * @property {String} options.orgName - 原始数据模型名称
     * @property {String} options.varName - 映射代码变量名称
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!u._$isString(options.data.orgName) || !options.data.orgName.trim()) {
            // console.error('请输入有效的原始数据模型名称');
            return;
        }
        if (!u._$isString(options.data.varName) || !options.data.varName.trim()) {
            // console.error('请输入有效的映射代码变量名称');
            return;
        }
        this.__super(options);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (data) {
            this._splitListToCache(data.params, options);
            onload(data);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 将列表数据按照type值分片, 存到缓存中
     * @param {Object} list - 映射规则列表
     * @param {Object} options - 发送请求时携带的参数对象
     * @param {Boolean} [isAppend] - 是否追回
     */
    pro._splitListToCache = function (list, options, isAppend) {
        var types = {};
        list.forEach(function (item) {
            if (!types.hasOwnProperty(item.type)) {
                types[item.type] = [];
            }
            types[item.type].push(item);
        });
        Object.keys(types).forEach(function (type) {
            var listKey = options.key + '-' + type;
            var listData = types[type];
            if (isAppend) {
                var existList = this._$getListInCache(listKey);
                listData = listData.concat(existList);
            }
            this._$setListInCache(listKey, listData);
        }.bind(this));
    };

    /**
     * 更新模板
     * @param {Object} options - 参数对象
     * @property {Number} options.id - 模板 id
     * 支持更新的字段有:
     * @property {String} [options.orgName] - 原始数据模型名称
     * @property {String} [options.varName] - 映射代码变量名称
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(p._$cacheKey) > -1) {
            url = '/api/varmaps/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('466ba5cf27f05a9d8f067d83a0b3604b',function (_k, _u, _v, _c, _d, p, pro) {
    p._$$CacheJarMap = _k._$klass();
    pro = p._$$CacheJarMap._$extend(_d._$$Cache);
    p._$cacheKey = 'jarmap';

    /**
     * 初始化
     */
    pro.__reset = function (options) {
        this.__cacheKey = p._$cacheKey;
        this.__super(options);
    }

    /**
     * 新建
     * @param {Object} options - 参数对象
     * @property {String} options.projectId - 参数所在项目标识
     * @property {String} options.type - 归属类型
     * @property {String} options.key - 键
     * @property {String} options.klassName - 值
     * @success dispatch event: onitemadd
     */
    pro.__doAddItem = function (options) {
        if (!_u._$isString(options.data.key) || !options.data.key.trim()) {
            // console.error('请输入有效的实例名');
            return;
        }
        if (!_u._$isString(options.data.value) || !options.data.value.trim()) {
            // console.error('请输入有效的类名');
            return;
        }
        var onload = options.onload;
        options.onload = function (item) {
            this._splitListToCache([item], options, true);
            onload(item);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 加载列表
     * @param {Object} [options] - 参数对象
     * @success dispatch event: onlistload
     */
    pro.__doLoadList = function (options) {
        var onload = options.onload;
        options.onload = function (data) {
            var listKey = options.key;
            this._$setListInCache(listKey, data.params);
            onload(data);
        }.bind(this);
        this.__super(options);
    };

    /**
     * 更新
     * @param {Object} options - 参数对象
     * @property {Number} options.id - id
     * 支持更新的字段有:
     * @property {String} [options.key] - 键
     * @property {String} [options.value] - 值
     * @success dispatch event: onitemupdate
     */
    pro.__doUpdateItem = function (options) {
        this.__super(options);
    };

    /**
     * 根据参数, 获取请求 url
     * @param {Object} options - 参数对象
     * @return {String} request url
     */
    pro.__getUrl = function (options) {
        var url;
        if (options.key.indexOf(p._$cacheKey) > -1) {
            url = '/api/klassmaps/' + (options.id || '');
            if (options.action) {
                url += '?' + options.action;
            }
        }
        return url;
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','8717e18cf0d38e654531116f64f5593d','c6dbf51c390a9de703c7bf6c9b46ff41');
I$('18fdbc27498bb1c4312201f146717dc0',function (activityCache,
             cliArgCache,
             constraintCache,
             datatypeCache,
             groupCache,
             iHeaderCache,
             interfaceCache,
             notificationCache,
             notifySettingCache,
             pageCache,
             parameterCache,
             pgApplyingCache,
             progroupCache,
             projectCache,
             refCache,
             specCache,
             specdocCache,
             templateCache,
             testcaseCache,
             testcollectionCache,
             userCache,
             varmapCache,
             jarmapCache) {
    return {
        activity: activityCache._$$CacheActivity,
        cliArg: cliArgCache._$$CacheCliArg,
        constraint: constraintCache._$$CacheConstraint,
        datatype: datatypeCache._$$CacheDatatype,
        group: groupCache._$$CacheGroup,
        iHeader: iHeaderCache._$$CacheIHeader,
        interface: interfaceCache._$$CacheInterface,
        notification: notificationCache._$$CacheNotification,
        notifySetting: notifySettingCache._$$CacheNotifySetting,
        page: pageCache._$$CachePage,
        parameter: parameterCache._$$CacheParameter,
        pgApplying: pgApplyingCache._$$CachePGApplying,
        progroup: progroupCache._$$CacheProGroup,
        project: projectCache._$$CachePro,
        ref: refCache._$$CacheRef,
        spec: specCache._$$CacheSpec,
        specdoc: specdocCache._$$CacheSpecDoc,
        template: templateCache._$$CacheTemplate,
        testcase: testcaseCache._$$CacheTestCase,
        testcollection: testcollectionCache._$$CacheTestcollection,
        user: userCache._$$CacheUser,
        varmap: varmapCache._$$CacheVarMap,
        jarmap: jarmapCache._$$CacheJarMap
    }
},'7de92aae3e26e733b4a3773f1128f398','88b09690bf9da6d44c6964c8030be9da','7f69de0f0fa6d9d6f0b6273610f4c7c5','afd9bc71d3ea5904e51ae183b2351b6e','7c1169d958213d2faeb6056f33ac4ad6','46b0f1b07fd20dd48ca972387c49ba1d','7385ee68edde0ba303fb20b28ecfb227','701adc0082f520daef1f96ababcde918','75824b27a51205ba0a8f15ebf23575c4','8c66819555c8938ee8838636d552569a','35e8999e6afda708a192e93b3e184448','1df06fa53683579bcb9b2b4b07c5c812','e8507450a35f1adad6e9dae810fd545a','09437bf7199eb808a35a38e5178e5151','cea4e30538d6300bc40f1aecaa365134','cc2e09517a742da0179cf6f4484b2b0b','18b1bc9298d424c8e455480bdc21afd6','cc04b9f6ed49f9ff59e36f80707cf153','b8ce6d41dfffbb736de372f078b83c7e','53ae16a47e896f65063e7d0eb3867c57','29f4b2dc96ca931edfeb9264ffe3e954','81a3fb8e9bc8b7b175292bc37f0793dd','466ba5cf27f05a9d8f067d83a0b3604b');
I$('7738e0f450927f99410932edaaf8f468',"<div r-class={{\"m-stripedlist\":true,\"list-group-mode\":!!xlistGroups}}>\n    {#if hasSearchBox || hasViewMode}\n    <div class=\"f-cb list-option-action\">\n        {#if listGroups}\n        <div class=\"f-cb view-mode\">\n            <div r-class={{\"view-mode-icon\":true,\"list-mode\":true,\"js-selected\":listViewMode==='list'}} on-click={this.changeListViewMode('list')} title=\"列表视图\">\n                <em class=\"u-icon-list-normal\"></em>\n                <em class=\"u-icon-list-pressed\"></em>\n            </div>\n            <div r-class={{\"view-mode-icon\":true,\"group-mode\":true,\"js-selected\":listViewMode==='group'}} on-click={this.changeListViewMode('group')} title=\"分组视图\">\n                <em class=\"u-icon-list2-normal\"></em>\n                <em class=\"u-icon-list2-pressed\"></em>\n            </div>\n        </div>\n        <!--只在分组视图才显示-->\n        <div r-class={{\"group-select\":true,\"f-dn\":listViewMode!=='group'}}>\n            <span class=\"group-select-label\">分组依据:</span>\n        </div>\n        {/if}\n        {#if hasSearchBox}\n        <input class=\"search-inp\" placeholder=\"搜索\" on-input={this.search($event)} type=\"search\" />\n        {/if}\n    </div>\n    {/if}\n    <div class=\"list-wrap\">\n        {#if showHeader}\n        <div r-class={{\"list-row\":true,\"list-hd\":true,\"no-list-item\":!xlist.length,\"js-selected\":selectedAll,\"show-batch-action\":selectedNum>0||selectedAll,\"js-sortable\":sortable}} ref=\"header\">\n            {#if batchAction}\n            <div class=\"list-checkbox\" on-click={this.toggleAll()}>\n                <i class=\"u-icon-checkbox-normal u-icon\"></i>\n                <i class=\"u-icon-checkbox-pressed u-icon\"></i>\n            </div>\n            <div class=\"batch-action\">\n                <span class=\"sel-num\">(已选 <em>{selectedNum}</em> 项)</span>\n                <span r-html={batchAction}></span>\n                <a class=\"quick-action\" href=\"#\" on-click={this.clearSelected($event)}>取消选择</a>\n                <a class=\"quick-action\" href=\"#\" on-click={this.reverseSelected($event)}>反向选择</a>\n            </div>\n            {/if}\n            {#if hasHeaderFilter}\n            <div class=\"header-filter\">\n                <em class=\"u-icon-arrow-filter-normal filter-list-trigger\" on-click={this.toggleHeaderFilter($event)}></em>\n                <ul r-class={{\"filter-list\":true,\"open\":headerFilterOpen}}>\n                    {#list headers as header by header.id}\n                    {#if header.name && header.hiddenByGroup !== true}\n                    <li title={header.name} r-class={{\"filter-item-selected-false\":!header.selected}} on-click={this.toggleHeaderFilterItem($event,header)}>\n                        <em class=\"u-icon-right-normal\"></em>\n                        <em>{header.name}</em>\n                    </li>\n                    {/if}\n                    {/list}\n                </ul>\n            </div>\n            {/if}\n            {#list headers as header by header.id}\n            {#if header.selected !== false && header.hiddenByGroup !== true}\n            <div class=\"list-col{header.class}{header.sortClass}{header.filterClass}\" title={header.name} {#if sortable&&header.sortable!==false} on-click={this.sort(header)}{/if}>\n                {#if sortable && header.sortable !== false}\n                <div class=\"sort-icon u-icon-arrow-down-normal\"></div>\n                <div class=\"sort-icon u-icon-arrow-up-normal\"></div>\n                {/if}\n                <em class=\"col-name-s\">{header.name}</em>\n                {#if header.filter}\n                <sup class=\"filter-num\"></sup>\n                <em class=\"u-icon-arrow-filter-normal filter-list-trigger\" on-click={this.toggleFilterList($event,header)}></em>\n                <ul r-class={{\"filter-list\":true,\"open\":header.filterListOpen}}>\n                    {#list header.filterList as item by item.id}\n                    <li title={item.name} r-class={{\"filter-item-selected-false\":!item.selected}} on-click={this.toggleFilterItem($event,item,header)}>\n                        <em class=\"u-icon-right-normal\"></em>\n                        <em>{item.name}</em>\n                    </li>\n                    {/list}\n                </ul>\n                {/if}\n            </div>\n            {/if}\n            {/list}\n        </div>\n        {/if}\n        <div\n            class=\"list-bd\"\n            {#if !xlistGroups &&itemDraggable}\n             on-dragstart={dragstartHandler($event)}\n             on-dragover={dragoverHandler($event)}\n             on-drop={dropHandler($event)}\n            {/if}\n            >\n            <!--加载数据中-->\n            {#if isLoadingData}\n            <div class=\"u-loading\"><i></i></div>\n            {#else}\n            <!--加载数据完成-->\n            <!-- 分组模式 -->\n            {#if xlistGroups}\n            <!-- 判断有没有数据, 以及总共显示的个数是否大于 0, 搜索时会用到这个值 -->\n            {#if xlistGroups.length && xlistGroupsTotalShownNum}\n            {#list xlistGroups as group by group.id}\n            {#if group.shownNum}\n            <div class=\"list-group-title\" on-click={this.toggleGroup($event, group)} on-dblclick={this.toggleGroupHeight($event, group)}>\n                <div r-class={{\"toggle-icon\":true,\"toggle-collapse\":group.__expand===false}} on-click={this.toggleGroupHeight($event, group)}>\n                    <i class=\"u-icon-arrow-down-normal\"></i>\n                </div>\n                <span class=\"group-name\" title={group.title}>{group.name} ({group.shownNum})</span>\n                <b class=\"sep-line\"></b>\n            </div>\n            <div class=\"list-group-wrap\" r-style={{height:(group.__expand!==false?group.shownNum*40:0)+'px'}}>\n                {#list group.xlist as item by item.id}\n                <!-- __invisible 是匿名数据模型, 列表中不用展示 -->\n                {#if !xlistStates[item.id].__hidden && xlistStates[item.id].__search_hit !== false && !xlistStates[item.id].__invisible}\n                <div\n                        r-html={this.getRowHTML(item)}\n                        class={this.getRowClass(item)}\n                        data-id={item.id} {#if batchAction && !xlistStates[item.id].__disabled}\n                        on-click={this.toggleRow($event, xlistStates[item.id], xlistStates[item.id].__indexInGroup)}{/if}>\n                </div>\n                {/if}\n                {/list}\n            </div>\n            {/if}\n            {/list}\n            {#else}\n            <div r-class={{\"no-item-tip\":true,\"no-item-tip-icon\":hasNoItemTipIcon}}>\n                <i class=\"u-icon-no-found-data\"></i>\n                <p>{noItemTip}</p>\n            </div>\n            {/if}\n            {/if}\n            <!--列表模式, 清晰起见分开写, 不使用 if else-->\n            {#if !xlistGroups}\n            {#if xlist.length && hiddenXList.length !== xlist.length}\n            {#list xlist as item by item.id}\n            <!-- __invisible 是匿名数据模型, 列表中不用展示 -->\n            {#if !xlistStates[item.id].__hidden && xlistStates[item.id].__search_hit !== false && !xlistStates[item.id].__invisible}\n            <div\n                    r-html={this.getRowHTML(item)}\n                    class={this.getRowClass(item)}\n                    data-id={item.id}\n                    {#if itemDraggable} draggable=\"true\"{/if}\n                    {#if batchAction && !xlistStates[item.id].__disabled} on-click={this.toggleRow($event,xlistStates[item.id],item_index)}{/if}>\n            </div>\n            {/if}\n            {/list}\n            {#else}\n            <div r-class={{\"no-item-tip\":true,\"no-item-tip-icon\":hasNoItemTipIcon}}>\n                <i class=\"u-icon-no-found-data\"></i>\n                <p>{noItemTip}</p>\n            </div>\n            {/if}\n            {/if}\n            {/if}\n        </div>\n    </div>\n    {#if addRow}\n    <div class=\"add-row\">\n        <span title=\"添加\" on-click={this.addRow($event)}>\n            <i class=\"u-icon u-icon-add-editor-normal\"></i>\n            <i class=\"u-icon u-icon-add-editor-hover\"></i>\n            <i class=\"u-icon u-icon-add-editor-pressed\"></i>\n        </span>\n    </div>\n    {/if}\n</div>");
I$('3703c5e75095c57a35cd18e060ca7002',".m-stripedlist .list-hd{background-color:#f5f5f5 !important;font-size:12px;}.m-stripedlist .list-hd.list-row{height:40px;line-height:40px;}.m-stripedlist .list-hd.list-row.js-selected,.m-stripedlist .list-hd.list-row:hover{background-color:#f5f5f5;}.m-stripedlist .list-hd.list-row .list-col{overflow:visible;}.m-stripedlist .list-hd.js-sortable .list-col:hover{background-color:#e6e6e6;}.m-stripedlist .list-hd.js-sortable .list-col.col-is-share:hover,.m-stripedlist .list-hd.js-sortable .list-col.col-nei-actions:hover{background-color:#f5f5f5;cursor:default;opacity:0;}.m-stripedlist .list-hd .batch-action{position:absolute;top:0;right:0;bottom:0;left:41px;background:#f5f5f5;z-index:1;display:none;}.m-stripedlist .list-hd .batch-action .pass{display:inline-block;margin-right:20px;}.m-stripedlist .list-hd.show-batch-action .batch-action{display:block;}.m-stripedlist .list-hd.js-sortable{cursor:pointer;}.m-stripedlist .list-hd:hover .filter-list-trigger{visibility:visible;}.m-stripedlist .list-bd .u-loading{width:auto;}.m-stripedlist .list-bd .u-loading i{left:50%;top:100px;margin-left:-17px;}.m-stripedlist .list-checkbox{width:40px;height:40px;cursor:pointer;text-align:center;margin-left:-12px;}.m-stripedlist .sort-icon{position:absolute;left:50%;margin-left:-6px;display:none;top:0;}.m-stripedlist .col-name-s{position:absolute;left:10px;}.m-stripedlist .list-sort-down .u-icon-arrow-down-normal{display:block;}.m-stripedlist .list-sort-down .u-icon-arrow-up-normal{display:none;}.m-stripedlist .list-sort-up .u-icon-arrow-down-normal{display:none;}.m-stripedlist .list-sort-up .u-icon-arrow-up-normal{display:block;}.m-stripedlist .list-row{display:flex;flex-wrap:wrap;height:40px;line-height:40px;transition:all ease 0.3s;cursor:default;position:relative;padding-left:12px;}.m-stripedlist .list-row .list-row-content{width:100%;padding-left:30px;display:none;word-wrap:break-word;white-space:pre;background-color:#f2f9fe;}.m-stripedlist .list-row .list-row-content a:link,.m-stripedlist .list-row .list-row-content a:visited{color:#30a1f2;}.m-stripedlist .list-row .list-col{flex:1;position:relative;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin:0 10px 0 0;padding-left:10px;transition:all ease 0.3s;}.m-stripedlist .list-row .list-col:last-child{margin-right:0;}.m-stripedlist .list-row:nth-of-type(even){background-color:#fafafa;}.m-stripedlist .list-row .col-nei-actions{visibility:hidden;transition:visibility ease 0.3s;text-align:center;}.m-stripedlist .list-row .col-nei-actions a{margin-right:5px;}.m-stripedlist .list-row .col-nei-actions:nth-last-child(a){margin-right:0;}.m-stripedlist .list-row:hover{background-color:#f2f9fe;}.m-stripedlist .list-row:hover .col-nei-actions{visibility:visible;}.m-stripedlist .list-row .u-icon-checkbox-pressed{display:none;}.m-stripedlist .list-row.js-selected{background-color:#f2f9fe;}.m-stripedlist .list-row.js-selected .u-icon-checkbox-pressed{display:inline-block;}.m-stripedlist .list-row.js-selected .u-icon-checkbox-normal{display:none;}.m-stripedlist .list-row.js-disabled .list-checkbox{visibility:hidden;}.m-stripedlist .list-row.show-content{height:auto;background-color:#f2f9fe;}.m-stripedlist .list-row.show-content .list-row-content{display:block;}.m-stripedlist .list-row .col-respo-realname,.m-stripedlist .list-row .col-creator-realname,.m-stripedlist .list-row .col-create-time,.m-stripedlist .list-row .col-nei-actions,.m-stripedlist .list-row .col-favourite-count,.m-stripedlist .list-row .col-is-share,.m-stripedlist .list-row .col-method{flex:initial;width:60px;}.m-stripedlist .list-row .col-is-lock{flex:initial;width:20px;margin-right:-5px;padding-left:0px;}.m-stripedlist .list-row .col-create-time{width:68px;}.m-stripedlist .list-row .col-nei-actions{width:115px;}.m-stripedlist .list-row .col-is-share{width:16px;margin:0 -10px 0 0;padding:0;}.m-stripedlist .list-row.js-shared .col-is-share{margin-left:-9px;width:25px;}.m-stripedlist .no-item-tip{color:#999;margin:20px 20px 20px 12px;}.m-stripedlist .no-item-tip .u-icon-no-found-data{display:none;}.m-stripedlist .no-item-tip.no-item-tip-icon{height:240px;margin:50px auto 0;text-align:center;}.m-stripedlist .no-item-tip.no-item-tip-icon .u-icon-no-found-data{display:inline-block;}.m-stripedlist .add-row{display:inline-block;position:relative;margin-right:10px;vertical-align:bottom;z-index:10;width:20px;height:20px;line-height:20px;cursor:pointer;}.m-stripedlist .add-row .u-icon{position:absolute;left:0;top:0;}.m-stripedlist .add-row .u-icon-add-editor-hover,.m-stripedlist .add-row .u-icon-add-editor-pressed{display:none;}.m-stripedlist .add-row:hover .u-icon-add-editor-hover{display:block;}.m-stripedlist .add-row:hover .u-icon-add-editor-normal,.m-stripedlist .add-row:hover .u-icon-add-editor-pressed{display:none;}.m-stripedlist .add-row:active .u-icon-add-editor-pressed{display:block;}.m-stripedlist .add-row:active .u-icon-add-editor-normal,.m-stripedlist .add-row:active .u-icon-add-editor-hover{display:none;}.m-stripedlist:hover .add-row{opacity:1;}.m-stripedlist .tag-item{display:inline-block;padding:0 6px;height:24px;line-height:24px;background-color:#a9b2bd;text-align:center;color:#fff;cursor:default;margin:0 4px 0 0;vertical-align:middle;max-width:50%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-indent:0;font-size:12px;}.m-stripedlist .filter-list-trigger{position:absolute;top:13px;left:41px;visibility:hidden;transition:visibility ease 0.3s;}.m-stripedlist .filter-num{position:absolute;top:9px;left:34px;visibility:hidden;background:#f04c62;border-radius:50%;width:6px;height:6px;}.m-stripedlist .col-respo-realname .filter-num{left:46px;}.m-stripedlist .col-respo-realname .filter-list-trigger{left:52px;}.m-stripedlist .some-filter-items-selected .filter-num{visibility:visible;}.m-stripedlist .filter-list{background-color:#fff;line-height:30px;z-index:9;position:absolute;top:38px;max-width:180px;max-height:400px;overflow-y:auto;box-shadow:0 4px 8px rgba(0,0,0,0.05);display:none;}.m-stripedlist .filter-list.open{display:block;}.m-stripedlist .filter-list li{height:30px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;padding:0 16px 0 10px;}.m-stripedlist .filter-list li .u-icon-right-normal{margin-top:2px;}.m-stripedlist .filter-list li.filter-item-selected-false .u-icon-right-normal{visibility:hidden;}.m-stripedlist .filter-list li:hover{background-color:#eee;}.m-stripedlist .list-option-action{margin:0 0 12px;}.m-stripedlist .list-option-action .search-inp{border:1px solid #ccc;outline:none;height:34px;line-height:34px;padding:0 4px;width:180px;display:inline-block;vertical-align:middle;margin-left:8px;float:right;}.m-stripedlist .list-option-action .view-mode{float:right;margin-left:8px;}.m-stripedlist .list-option-action .view-mode .view-mode-icon{width:30px;cursor:pointer;text-align:center;border:1px solid #ccc;height:32px;line-height:30px;float:left;}.m-stripedlist .list-option-action .view-mode .u-icon-list-normal,.m-stripedlist .list-option-action .view-mode .u-icon-list2-normal,.m-stripedlist .list-option-action .view-mode .u-icon-list-pressed,.m-stripedlist .list-option-action .view-mode .u-icon-list2-pressed{margin:8px 0 0 8px;display:block;}.m-stripedlist .list-option-action .view-mode .u-icon-list-pressed,.m-stripedlist .list-option-action .view-mode .u-icon-list2-pressed{display:none;}.m-stripedlist .list-option-action .view-mode .js-selected{background-color:#ccc;}.m-stripedlist .list-option-action .view-mode .js-selected .u-icon-list-normal,.m-stripedlist .list-option-action .view-mode .js-selected .u-icon-list2-normal{display:none;}.m-stripedlist .list-option-action .view-mode .js-selected .u-icon-list-pressed,.m-stripedlist .list-option-action .view-mode .js-selected .u-icon-list2-pressed{display:block;}.m-stripedlist .header-filter{position:absolute;right:6px;z-index:9;}.m-stripedlist .header-filter .filter-list-trigger{left:auto;right:6px;}.m-stripedlist .header-filter .filter-list{right:-6px;}.m-stripedlist .hl{background-color:#fd9c41;color:#333;}.m-stripedlist .group-select{float:left;height:30px;line-height:30px;}.m-stripedlist .group-select .u-dropdown .dropdown_hd{height:34px;line-height:32px;}.m-stripedlist .group-select .u-dropdown .dropdown_hd .dis-name{height:28px;line-height:28px;}.m-stripedlist .group-select .u-dropdown .listview>li{line-height:28px;}.m-stripedlist .group-select .u-dropdown .dropdown_hd .u-trigon-down{top:14px;}.m-stripedlist .group-select .group-select-label{display:inline-block;vertical-align:middle;margin-top:3px;}.m-stripedlist .batch-action-item{height:28px;line-height:28px;padding:0 10px;background-color:#fff;text-align:center;display:inline-block;color:#222;border:1px #ccc solid;outline:none;font-size:12px;transition:all ease 0.3s;margin-right:4px;}.m-stripedlist .batch-action-item:hover{background-color:#eee;}.m-stripedlist .batch-action .quick-action{display:inline-block;vertical-align:middle;}.list-group-mode .list-wrap{border-color:#fff;}.list-group-mode .list-group-title{margin:12px 0 0;position:relative;cursor:default;height:40px;background-color:#fff;}.list-group-mode .list-group-title .toggle-icon,.list-group-mode .list-group-title .group-name,.list-group-mode .list-group-title .sep-line{position:absolute;top:10px;background-color:#fff;z-index:2;transition:all ease 0.3s;}.list-group-mode .list-group-title:hover .toggle-icon,.list-group-mode .list-group-title:hover .group-name,.list-group-mode .list-group-title:hover .sep-line{color:#30a1f2;border-color:#30a1f2;}.list-group-mode .list-group-title .toggle-icon{transition:transform ease 0.3s;cursor:pointer;}.list-group-mode .list-group-title .toggle-icon.toggle-collapse{transform:rotate(-90deg);}.list-group-mode .list-group-title .group-name{left:12px;padding:0 8px;}.list-group-mode .list-group-title .sep-line{height:21px;border-top:1px solid #ccc;left:0;right:0;top:19px;z-index:1;}.list-group-mode .list-group-wrap{transition:height ease 0.3s;overflow:hidden;}.list-group-mode .list-hd{margin:0 0 -18px;}.list-group-mode .sel-num{color:#999;margin-right:6px;}.nei-scrolled .list-hd{box-shadow:0 1px 2px 0px rgba(0,0,0,0.15);}");
I$('645b07d1227cb7ffbb51604bdde81b34',function (k, u, e, v, pager, $, jst, Select2, m, jstex, rb, util, caches, html, css, p, pro) {

    p._$$ModuleStripedList = k._$klass();
    pro = p._$$ModuleStripedList._$extend(m._$$Module);
    e._$addStyle(css);

    // 常量
    var LIST_VIEW_MODE_LS_KEY = '__$list_view_mode';
    var LIST_VIEW_MODE_LIST = 'list';
    var LIST_VIEW_MODE_GROUP = 'group';
    var SELECTED_GROUP_LS_KEY = '__$selected_group';
    var EXCLUDED_HEADERS_LS_KEY = '__$excluded_headers';
    var EXCLUDED_TAGS_LS_KEY = '__$excluded_tags';
    var EXCLUDED_STATUS_LS_KEY = '__$excluded_status';
    var EXCLUDED_GROUPS_LS_KEY = '__$excluded_groups';
    var EXCLUDED_RESPOS_LS_KEY = '__$excluded_respos';

    // 默认参数配置选项
    var defaultOptions = {
        // 父容器
        parent: document.body,
        // 是否显示表头
        showHeader: true,
        // 批量操作元素的字符串表示:
        batchAction: '',
        // 列表过滤函数
        filter: function (xlist) {
            return xlist;
        },
        // 列表也可以通过 cache 由组件来加载, 默认通过参数传递列表数据, 即 xlist
        listCache: null,
        // 列表 cache key, 可以不传, 默认等同于 listCache
        listCacheKey: null,
        // 请求参数
        queryData: {},
        // 请求额外参数
        queryExtData: null,
        // 列表数据
        xlist: [],
        // 排序字段排序, 如果是多级的, 使用点号, 比如按 creator 的 name 排序, 则是 "creator.name"
        // 不设置 defaultSortKey 的默认值, 因为没有什么值可以用来当默认值
        defaultSortKey: null,
        // 是否升序, 默认为 true
        isDefaultSortUp: true,
        // 是否点击表头排序
        sortable: false,
        // 本在存储中的 key 值, 用于存放列表排序等信息
        lsListKey: '', // 必需, 否则抛异常
        // 要显示的字段, 元素项格式为:
        // {
        //    name: '', // 显示名
        //    key: '', // 对应列表 xlist 中的 key 值, 如果是多级的, 使用点号, 比如 "creator.name"
        //    valueType: '', // 值类型: 暂时支持 deepKey, httpMethod, tag, time, __nei-actions, 具体含义见 jstex 的实现
        //    sortable: true, // 是否可点击此表头排序, 默认为 true,
        //    searchable: true, // 是否可按此列搜索, 默认为 true,
        //    filter: undefined, // 是否有筛选器, 目前支持 tag, group, respo
        // }
        headers: [],
        // 没有数据时的提示文案
        noItemTip: '暂无数据',
        // 没有数据时的提示文案, 是否要显示icon
        hasNoItemTipIcon: true,
        // 点击添加行图标的回调, 类型须为函数
        addRow: null,
        // 是否有分页器
        hasPager: false,
        // 是否有搜索框
        hasSearchBox: false,
        // 是否可以自定义显示哪些列
        hasHeaderFilter: false,
        // 列表分组, 元素项格式为:
        // {
        //    group: '', // 分组依据中的显示名称
        //    key: '' // 列表项中的字段名
        // }
        listGroups: null,
        // 渲染后的事件回调
        afterRender: function () {
        },
        // 自定义分组, 优先级高于 listGroups, 格式为:
        // {
        //    key: '', // 字段名称
        //    types: [
        //      {
        //          value: [value], // 字段的值
        //          name: [name] // 显示名称
        //      }
        //    ]
        // }
        customGroups: null
    };

    // 获取本地存储
    pro._getLSConfig = function () {
        return JSON.parse(localStorage.STRIPED_LIST_LOCAL_CONFIG || '{}')[this._options.lsListKey] || {};
    };

    // 设置本地存储
    pro._setLSConfig = function (config) {
        var lsConfig = JSON.parse(localStorage.STRIPED_LIST_LOCAL_CONFIG || '{}');
        lsConfig[this._options.lsListKey] = config;
        localStorage.STRIPED_LIST_LOCAL_CONFIG = JSON.stringify(lsConfig);
    };

    // 初始化开始
    pro.__reset = function (options) {
        // 以下情况需要用到 localStorage, 此时需要指定 lsListKey
        if ((options.sortable || options.listGroups || options.hasHeaderFilter) && !options.lsListKey) {
            return console.error('请为当前的列表指定应用的唯一的lsListKey, 用来作为本地存储中的键');
        }
        this.__super(options);
        this._originalOptions = options;
        this._options = u._$merge({}, defaultOptions, options);
        this._options.listCacheKey = this._options.listCacheKey || this._options.listCache;
        if (this._options.listCache && caches[this._options.listCache]) {
            // 通过 cache 加载列表
            this._listCache = caches[this._options.listCache]._$allocate({
                onlistload: function (evt) {
                    this._options.xlist = this._listCache._$getListInCache(this._options.listCacheKey);
                    // 初始化保存数据项状态的对象
                    this._initXlistStates();
                    // header 字段中的筛选器
                    this._initHeaderFilters();
                    // 设置不需要显示的列
                    this._updateHiddenHeaders();
                    // 是否有分页器, 获取当前页的列表数据
                    if (this._options.hasPager) {
                        this._sliceXlist();
                    }
                    // 隐藏 loading 动画
                    this._options.isLoadingData = false;
                    this._render();
                }.bind(this)
            });
            this._itemsDeletedHandler = function () {
                // 删除的时候在 cache 层已经将该元素从 list 中删除
                this._groupList(); // 有可能删除的是分组的项, 要更新分组中的数量
                this.stripedList.updateSelectedNum(); // 删除的项有可能是选中状态, 需要更新选中的数量信息
                this.stripedList.$update();
            }.bind(this);
            // 监听批量删除事件
            v._$addEvent(caches[this._options.listCache], 'itemsdeleted', this._itemsDeletedHandler);
            // 显示 loading 动画
            this._options.isLoadingData = true;
            this._initXlistStates();
            this._render();
            this._getListData();
        } else {
            // 初始化保存数据项状态的对象
            this._initXlistStates();
            // header 字段中的筛选器
            this._initHeaderFilters();
            this._render();
        }
        if (this._options.hasPager) {
            // 有分页器时, 监听删除列表项事件
            this.__doInitDomEvent([[
                caches[this._options.listCache], 'itemsdeleted',
                function (evt) {
                    // 当前分页索引
                    this._pagerIndex = this._pager._$getIndex();
                    // 重新获取总数信息
                    this._options.queryData.total = true;
                    // 销毁分页器
                    this._pager = this._pager._$recycle();
                    // 重新获取数据
                    this._getListData();
                }.bind(this)
            ]]);
        }
    };

    // xlistStates 对象保存数据的状态, 比如 __hidden、__search_hit、__disabled、__selected、__indexInGroup、__invisible
    pro._initXlistStates = function () {
        this._options.xlistStates = {};
        this._options.xlist.forEach(function (item) {
            // 默认设置好 id, 方便某些情况下取元素 id
            this._options.xlistStates[item.id] = {
                id: item.id
            };
        }, this);
    };

    // header 字段中的筛选器
    pro._initHeaderFilters = function () {
        this._options.headers.forEach(function (header) {
            switch (header.filter) {
                case 'tag':
                    header.excludedFilterLSKey = EXCLUDED_TAGS_LS_KEY;
                    this._initFilterHandler(header, '_$getTagList');
                    break;

                case 'group':
                    header.excludedFilterLSKey = EXCLUDED_GROUPS_LS_KEY;
                    this._initFilterHandler(header, '_$getGroupList');
                    break;

                case 'respo':
                    header.excludedFilterLSKey = EXCLUDED_RESPOS_LS_KEY;
                    this._initFilterHandler(header, '_$getRespoList');
                    break;

                case 'status':
                    header.excludedFilterLSKey = EXCLUDED_STATUS_LS_KEY;
                    this._initFilterHandler(header, '_$getStatusList');
                    break;

                default:
                    break;
            }
        }, this);
        this._options.hiddenXList = this._getHiddenList();
    };

    // 初始化筛选器
    pro._initFilterHandler = function (header, listCacheFuncName) {
        var excludedFilterItems = this._getLSConfig()[header.excludedFilterLSKey] || [];
        var filterList;
        if (this._listCache) {
            filterList = this._listCache[listCacheFuncName](this._options.listCacheKey);
        }
        else {
            filterList = this._options[listCacheFuncName];
        }
        header.filterList = filterList.map(function (item) {
            return {
                value: item.value || item.id || item,
                name: item.name || item,
                selected: excludedFilterItems.indexOf(item.value || item) === -1
            }
        });
        // 空标签
        if (header.key === 'tag') {
            header.filterList.unshift({
                value: '',
                name: '<无标签>',
                selected: excludedFilterItems.indexOf('') === -1
            });
        }
        // 无状态
        if (header.key === 'status') {
            header.filterList.unshift({
                value: '',
                name: '<无状态>',
                selected: excludedFilterItems.indexOf('') === -1
            });
        }
        header.filterList.unshift({
            value: null,
            name: '全部',
            selected: excludedFilterItems.length === 0
        });
        header.excludedFilterItems = excludedFilterItems;
        this._updateHeaderClass(null, null, header, excludedFilterItems);
    };

    //// 获取和分页器索引对应的列表数据
    pro._sliceXlist = function () {
        var options = this._options;
        var xlist = options.xlist;
        var qd = options.queryData;
        options.xlist = xlist.slice(qd.offset, qd.offset + qd.limit);
        this._xlistLen = xlist.length;
    };

    // 分页器切换处理程序
    pro._changePageNum = function (evt) {
        var last = evt.last;
        var index = evt.index;
        if (!evt.last) {
            return;
        }
        var qd = this._options.queryData;
        if (index > last) {
            qd.offset += (index - last) * qd.limit;
        } else {
            qd.offset -= (last - index) * qd.limit;
        }
        this._getListData();
    };

    // 加载数据
    pro._getListData = function () {
        var data = {
            key: this._options.listCacheKey,
            data: this._options.queryData,
            ext: this._options.queryExtData,
            offset: this._options.queryData.offset,
            limit: this._options.queryData.limit
        };
        this._listCache._$getList(data);
        if (this._options.hasPager) {
            // 仅第一次返回 total, 删除元素项后需要重新获取总数信息
            this._options.queryData.total = false;
        }
    };

    // 计算header的class类名
    pro._updateHeaderClass = function (sortKey, isSortUp, header, excludedFilterItems) {
        this._options.headers.forEach(function (item) {
            // 只计算一次
            item.class = item.class || ' col-' + item.key.replace(/[A-Z._]/g, function ($0) {
                    if ($0 === '_') {
                        return '';
                    }
                    return '-' + ($0 === '.' ? '' : $0.toLowerCase());
                });
            // 显示排序方式的图标
            if (sortKey) {
                if (item.key === sortKey) {
                    item.sortClass = ' list-sort-' + (isSortUp ? 'up' : 'down');
                } else {
                    item.sortClass = '';
                }
            } else if (header && item.key === header.key && item.filter && excludedFilterItems) {
                // 过滤筛选器的样式
                if (excludedFilterItems.length !== 0) {
                    item.filterClass = ' some-filter-items-selected';
                } else {
                    item.filterClass = '';
                }
            }
        }, this);
    };

    // 获取不用显示的列表数据, 同时更改列表项的 __hidden 属性
    // 目前支持4种形式的筛选: tag, group, respo, status
    pro._getHiddenList = function () {
        var hiddenXList = [];
        this._options.xlist.forEach(function (item) {
            // 本地存储中的数据
            // 被排除的筛选项
            var excludedFilterItems = [];
            var includedFilterItems = [];
            // 默认都匹配
            var tagHit = true;
            var statusHit = true;
            var groupHit = true;
            var respoHit = true;
            var tagHandler = function () {
                if (excludedFilterItems.length === 0 && !item.tag) {
                    // 如果没有筛选条件, 则没有标签的数据为选中状态
                    return tagHit = true;
                }
                var tags = item.tag.split(',');
                tags.some(function (tag) {
                    tagHit = !!includedFilterItems.find(function (itm) {
                        return itm.value === tag;
                    });
                    return tagHit; // break if true
                });
            };
            var statusHandler = function () {
                if (excludedFilterItems.length === 0 && !item.status) {
                    // 如果没有筛选条件, 则没有状态的数据为选中状态
                    return statusHit = true;
                }
                statusHit = !!includedFilterItems.find(function (itm) {
                    return itm.value === item.status;
                });
            };
            var groupHandler = function () {
                groupHit = !!includedFilterItems.find(function (itm) {
                    return itm.value === item.group.id;
                });
            };
            var respoHandler = function () {
                respoHit = !!includedFilterItems.find(function (itm) {
                    return itm.value === item.respo.id;
                });
            };

            this._options.headers.forEach(function (header) {
                if (!header.filter) return;
                excludedFilterItems = this._getLSConfig()[header.excludedFilterLSKey] || [];
                includedFilterItems = [];
                header.filterList.forEach(function (filterItem) {
                    if (excludedFilterItems.indexOf(filterItem.value) === -1) {
                        includedFilterItems.push(filterItem);
                    }
                });
                switch (header.filter) {
                    case 'tag':
                        tagHandler();
                        break;

                    case 'status':
                        statusHandler();
                        break;

                    case 'group':
                        // tag 匹配了才进行业务分组的匹配
                        tagHit && groupHandler();
                        break;

                    case 'respo':
                        // group 匹配了才进行负责人的匹配
                        groupHit && respoHandler();
                        break;

                    default:
                        break;
                }
            }, this);
            var itemState = this._options.xlistStates[item.id];
            // 取交集, 即只有四者全部匹配才显示
            if (tagHit && statusHit && groupHit && respoHit) {
                itemState.__hidden = false;
            } else {
                itemState.__hidden = true;
                hiddenXList.push(item);
            }
        }, this);
        // 返回不需要显示的列表
        return hiddenXList;
    };

    // 更改 header 列的 selected 属性
    pro._updateHiddenHeaders = function () {
        var excludedFilterItems = this._getLSConfig()[EXCLUDED_HEADERS_LS_KEY] || [];
        this._options.headers.forEach(function (header) {
            if (excludedFilterItems.indexOf(header.key) > -1) {
                header.selected = false;
            } else {
                header.selected = true;
            }
        });
    };

    // 列表排序
    pro._sortList = function () {
        // 列表排序
        var sortKey = null;
        var isSortUp = true;
        if (this._options.sortable) {
            // 获取本地存储中的排序信息
            var lsConfig = this._getLSConfig();
            sortKey = lsConfig.__$sort_by || this._options.defaultSortKey;
            isSortUp = lsConfig[sortKey];
            if (isSortUp === undefined) {
                var sortHeader = this._options.headers.find(function (header) {
                    return header.key === sortKey;
                });
                if (sortHeader.isDefaultSortUp === undefined) {
                    isSortUp = this._options.isDefaultSortUp;
                } else {
                    isSortUp = sortHeader.isDefaultSortUp;
                }
            }
        } else {
            sortKey = this._options.defaultSortKey;
            isSortUp = this._options.isDefaultSortUp;
        }
        sortKey && this._options.xlist.sort(function (itemA, itemB) {
            // 值有可能是数值, 转成字符串来比较
            var valueA = String(jstex.getDeepValue(sortKey, itemA));
            var valueB = String(jstex.getDeepValue(sortKey, itemB));
            return isSortUp ? valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
        });
        this._updateHeaderClass(sortKey, isSortUp);
    };

    // 判断是否在列表中可见
    pro._canShown = function (itemState) {
        return !itemState.__hidden && itemState.__search_hit !== false && !itemState.__invisible;
    };

    // 如果是分组模式, 则给列表分组
    pro._groupList = function () {
        // 如果是自定义分组
        if (this._options.customGroups) {
            return this._groupByCustomGroups();
        }
        // 没有视图切换功能, 简单返回
        if (!this._options.listGroups) return;
        // 清除隐藏的业务分组状态
        this._options.headers.forEach(function (header) {
            delete header.hiddenByGroup;
        });
        this._selectedGroup = this._getLSConfig()[SELECTED_GROUP_LS_KEY];
        this._groupSelectSource = this._options.listGroups.map(function (group) {
            return {
                name: group.group,
                id: group.key
            };
        }, this);
        this._selectedGroup = this._groupSelectSource.find(function (select) {
            return select.name === this._selectedGroup;
        }, this);
        // 如果本地存储中没有分组信息, 则选中第一个
        if (!this._selectedGroup) {
            this._selectedGroup = this._groupSelectSource[0];
        }
        this._options.listViewMode = this._getLSConfig()[LIST_VIEW_MODE_LS_KEY] || LIST_VIEW_MODE_LIST;
        if (this._options.listViewMode === LIST_VIEW_MODE_GROUP) {
            // 分组模式, 则给列表分组, 该数组用于 html 模板
            this._options.xlistGroups = [];
            this._options.xlistGroupsTotalShownNum = 0;
            switch (this._selectedGroup.id) {
                case 'group':
                    // 先查该列表中所有的 group 信息
                    // 然后将列表分组, 下同
                    var list = this._listCache._$getGroupList(this._options.listCacheKey);
                    list.forEach(function (listItem) {
                        var shownNum = 0;
                        this._options.xlistGroups.push({
                            name: listItem.name,
                            title: listItem.title,
                            xlist: this._options.xlist.filter(function (item) {
                                if (item.group.id === listItem.value) {
                                    var itemState = this._options.xlistStates[item.id];
                                    if (this._canShown(itemState)) {
                                        shownNum++;
                                        return true;
                                    }
                                }
                            }, this),
                            shownNum: shownNum
                        });
                        this._options.xlistGroupsTotalShownNum += shownNum;
                    }, this);
                    // 此时头部中的"业务分组"列不用显示, 其他还原
                    this._options.headers.forEach(function (header) {
                        header.hiddenByGroup = header.key === 'group.name';
                    });
                    break;

                case 'respo':
                    var list = this._listCache._$getRespoList(this._options.listCacheKey);
                    list.forEach(function (listItem) {
                        var shownNum = 0;
                        this._options.xlistGroups.push({
                            name: listItem.name,
                            title: listItem.title,
                            xlist: this._options.xlist.filter(function (item) {
                                if (item.respo.id === listItem.value) {
                                    var itemState = this._options.xlistStates[item.id];
                                    if (this._canShown(itemState)) {
                                        shownNum++;
                                        return true;
                                    }
                                }
                            }, this),
                            shownNum: shownNum
                        });
                        this._options.xlistGroupsTotalShownNum += shownNum;
                    }, this);
                    // 此时头部中的"负责人"列不用显示
                    this._options.headers.forEach(function (header) {
                        header.hiddenByGroup = header.key === 'respo.realname';
                    });
                    break;

                case 'creator':
                    var list = this._listCache._$getCreatorList(this._options.listCacheKey);
                    list.forEach(function (listItem) {
                        var shownNum = 0;
                        this._options.xlistGroups.push({
                            name: listItem.name,
                            title: listItem.title,
                            xlist: this._options.xlist.filter(function (item) {
                                if (item.creator.id === listItem.value) {
                                    var itemState = this._options.xlistStates[item.id];
                                    if (this._canShown(itemState)) {
                                        shownNum++;
                                        return true;
                                    }
                                }
                            }, this),
                            shownNum: shownNum
                        });
                        this._options.xlistGroupsTotalShownNum += shownNum;
                    }, this);
                    // 此时头部中的"创建者"列不用显示
                    this._options.headers.forEach(function (header) {
                        header.hiddenByGroup = header.key === 'creator.realname';
                    });
                    break;

                default:
                    break;
            }
            this._setXlistGroupOrder();
        } else {
            delete this._options.xlistGroups;
            delete this._options.xlistByGroupOrder;
            // 此时不清除 __indexInGroup 也没关系, 因为每次都会重新计算
        }
    };

    // 这个数组是分组模式下的数据列表, 是有序的, 在"分组模式"视图时, Ctrl, Shift 键的选择会用到这个数组
    pro._setXlistGroupOrder = function () {
        this._options.xlistByGroupOrder = [];
        var indexInGroup = 0;
        this._options.xlistGroups.forEach(function (group) {
            this._options.xlistByGroupOrder = this._options.xlistByGroupOrder.concat(group.xlist);
            // 设置数据项在整个 group 中的索引, 在点击行的时候会用到这个值
            group.xlist.forEach(function (item) {
                this._options.xlistStates[item.id].__indexInGroup = indexInGroup++;
            }, this);
        }, this);
    };

    // 按指定的字段分组
    pro._groupByCustomGroups = function () {
        this._options.xlistGroups = [];
        this._options.xlistGroupsTotalShownNum = 0;
        this._options.customGroups.forEach(function (group) {
            var shownNum = 0;
            this._options.xlistGroups.push({
                name: group.name,
                title: group.name,
                xlist: group.xlist.filter(function (item) {
                    var itemState = this._options.xlistStates[item.id];
                    // 记录分组类型
                    itemState.__type = group.type;
                    if (this._canShown(itemState)) {
                        shownNum++;
                        this._options.xlistGroupsTotalShownNum++;
                        return true;
                    }
                }, this),
                shownNum: shownNum
            });
        }, this);
        this._setXlistGroupOrder();
    };

    // 实例化"分组依据"下拉框
    pro._initGroupSelect = function () {
        if (this._groupSelect) {
            // 已经存在就销毁
            this._groupSelect.destroy();
        }
        if (this._options.listGroups && this._options.listViewMode === LIST_VIEW_MODE_GROUP) {
            var select2Options = {
                source: this._groupSelectSource,
                selected: this._selectedGroup,
                preview: true
            };
            this._groupSelect = new Select2({
                data: select2Options
            }).$inject($(this._options.parent)._$getByClassName('group-select')[0]);
            // 监听change事件, 将分组信息存到本地存储中, 然后刷新列表
            this._groupSelect.$on('change', function (evt) {
                var config = this._getLSConfig();
                config[SELECTED_GROUP_LS_KEY] = evt.selected.name;
                this._setLSConfig(config);
                // 列表分组
                this._groupList();
                this.stripedList.$update();
            }.bind(this));
        }
    };

    // 是否有分页器, 获取当前页的列表数据
    pro._initPager = function () {
        if (this._options.hasPager && !this._pager) {
            this._pager = pager._$$Pager._$allocate({
                parent: this._options.parent,
                clazz: 'm-stripedlist-pager m-pager',
                index: this._pagerIndex || 1,
                total: Math.ceil(this._xlistLen / this._options.queryData.limit),
                label: {
                    prev: '<span>上一页</span><i class="zprv-icon u-icon-arrow-left-normal normal">' +
                    '</i><i class="zprv-icon u-icon-arrow-left-hover hover"></i>' +
                    '<i class="zprv-icon u-icon-arrow-left-unable unable"></i>',
                    next: '<span>下一页</span><i class="znxt-icon u-icon-arrow-right-normal normal"></i>' +
                    '<i class="znxt-icon u-icon-arrow-right-hover hover"></i>' +
                    '<i class="znxt-icon u-icon-arrow-right-unable unable"></i>'
                },
                onchange: function (evt) {
                    this._changePageNum(evt);
                }.bind(this)
            });
        }
    };

    pro._render = function () {
        // var time = Date.now()
        this._options.xlist = this._options.filter(this._options.xlist, this._options.xlistStates);
        this._sortList();
        this._groupList();
        // 外部 filter 可能会操作 __hidden 属性, 这里需要重新计算 hiddenXList
        Object.keys(this._options.xlistStates).forEach(function (id) {
            if (this._options.xlistStates[id].__hidden) {
                var found = this._options.hiddenXList.find(function (item) {
                    return item.id == id;
                });
                if (!found) {
                    found = this._options.xlist.find(function (item) {
                        return item.id == id;
                    });
                    this._options.hiddenXList.push(found);
                }
            }
        }, this);
        // 头部字段类名
        this._updateHeaderClass();
        var List = this._getList();
        // 如果已存在列表实例, 则先销毁, 比如分页的时候
        if (this.stripedList) {
            this.stripedList.destroy();
        }
        this.stripedList = new List({
            data: this._options
        }).$inject(this._options.parent, 'top');
        // console.log(Date.now() - time)
        // console.log(this._options.xlist.length)
        if (this._options.isLoadingData) {
            // 还在加载数据
            return;
        }
        this._initPager();
        this._initGroupSelect();
        // 渲染完后的回调事件
        this._options.afterRender(this._options);
        // 滚动事件监听
        var listContainer = $(this._options.parent)._$delClassName('nei-scrolled');
        var listBd = listContainer._$getByClassName('list-bd')[0];
        v._$addEvent(listBd, 'scroll', function () {
            if (listBd.scrollTop === 0) {
                listContainer._$delClassName('nei-scrolled');
            } else {
                listContainer._$addClassName('nei-scrolled');
            }
        }.bind(this));
    };

    // regular 组件
    pro._getList = function () {
        var that = this;
        return rb.extend({
            template: html,

            config: function () {
                this.data.selectedAll = false;
                this.data.selectedNum = 0;
                // 自定义头部列的下拉列表的显示状态
                this.data.headerFilterOpen = false;
                // 上一次点击选中的行, 在选择列表行的操作中需要用到
                this.prevClickIndex = null;
            },

            // 全选的复选框
            toggleAll: function () {
                this.data.selectedAll = !this.data.selectedAll;
                this.data.xlist.forEach(function (item) {
                    var itemState = this.data.xlistStates[item.id];
                    if (!itemState.__disabled && !itemState.__hidden) {
                        itemState.__selected = this.data.selectedAll;
                    }
                }, this);
                this.updateSelectedNum();
            },

            // 切换行的选中状态
            toggleRow: function (evt, itemState, index) {
                // 先判断是否点击了有操作的元素
                var clickActionIcon = v._$getElement(evt, 'd:action');
                if (clickActionIcon) {
                    // 点击了有操作的图标, 不处理
                    return;
                }
                // 点击行上的复选框
                var clickCheckbox = v._$getElement(evt, 'c:list-checkbox');
                var clickContentTitle = v._$getElement(evt, 'c:content-title');
                // 分组模式视图下, 操作的是 this._options.xlistByGroupOrder, 否则是 this.data.xlist
                var xlistToHandle = this.data.xlistByGroupOrder || this.data.xlist;
                // 实现的效果和操作系统选择文件保持一致, 包括按住 shift, ctrl 键的选择
                var shiftKey = evt.event.shiftKey;
                var ctrlKey = evt.event.ctrlKey || evt.event.metaKey;
                if (shiftKey) {
                    // 按住 shift 键点击
                    // 按住 shift 键选择时会选中文字, 删除 selection range
                    document.getSelection().removeAllRanges();
                    if (this.prevClickIndex > index) {
                        xlistToHandle.forEach(function (itm, idx) {
                            this.data.xlistStates[itm.id].__selected = idx >= index && idx <= this.prevClickIndex;
                        }, this);
                    } else {
                        xlistToHandle.forEach(function (itm, idx) {
                            this.data.xlistStates[itm.id].__selected = idx <= index && idx >= this.prevClickIndex;
                        }, this);
                    }
                    this.updateSelectedNum();
                } else if (ctrlKey || clickCheckbox) {
                    // 按住 ctrl 键点击
                    // 只切换自身的选中状态
                    itemState.__selected = !itemState.__selected;
                    this.updateSelectedNum();
                    this.prevClickIndex = index;
                } else if (clickContentTitle) {
                    itemState.__showContent = !itemState.__showContent;
                } else {
                    // 点击
                    if (this.data.selectedNum > 1) {
                        // 如果点击的时候有其他选中的项, 则选中点击的项
                        itemState.__selected = true;
                    } else {
                        // 否则切换自身的选中状态
                        itemState.__selected = !itemState.__selected;
                    }
                    // 将其他项取消选中
                    xlistToHandle.forEach(function (itm) {
                        if (itm.id !== itemState.id) {
                            this.data.xlistStates[itm.id].__selected = false;
                        }
                    }, this);
                    this.updateSelectedNum();
                    this.prevClickIndex = index;
                }
            },

            // 更新选中的数量
            updateSelectedNum: function () {
                this.data.selectedNum = 0;
                var disabledNum = 0;
                var selectedIds = [];
                this.data.xlist.forEach(function (itm) {
                    // 不可用项, 隐藏项, 搜索没匹配上的项, 删除的项, 在计算选中项的数量时都要排除
                    var itemState = this.data.xlistStates[itm.id];
                    if (itemState.__disabled || itemState.__hidden || itemState.__search_hit === false || itemState.__invisible) {
                        disabledNum++;
                    } else if (itemState.__selected) {
                        this.data.selectedNum++;
                        selectedIds.push(itm.id);
                    }
                }, this);
                this.data.selectedAll = this.data.selectedNum !== 0 && this.data.selectedNum === this.data.xlist.length - disabledNum;
                that._setBatchActionData(this.$refs.header, selectedIds);
            },

            // 排序功能
            sort: function (header) {
                var lsConfig = that._getLSConfig();
                lsConfig.__$sort_by = header.key;
                if (lsConfig[header.key] === undefined) {
                    if (header.isDefaultSortUp === undefined) {
                        lsConfig[header.key] = that._options.isDefaultSortUp ? 1 : 0;
                    } else {
                        lsConfig[header.key] = header.isDefaultSortUp ? 0 : 1;
                    }
                } else {
                    lsConfig[header.key] = lsConfig[header.key] ? 0 : 1;
                }
                that._setLSConfig(lsConfig);
                that._sortList();
                // 列表分组也需要重新排序
                that._groupList();
            },

            // 点击 header 字段中的筛选器, tag, group ,respo, 切换下拉列表的打开还是关闭状态
            toggleFilterList: function (evt, header) {
                evt.event.stopPropagation();
                var open = header.filterListOpen;
                // 关闭其他过滤器下拉列表
                this.data.headers.forEach(function (item) {
                    item.filterListOpen = false;
                });
                // 关闭列筛选器下拉列表
                this.data.headerFilterOpen = false;
                // 切换自身状态
                header.filterListOpen = !open;
                if (header.filterListOpen) {
                    var handler = function () {
                        header.filterListOpen = false;
                        Regular.dom.off(document, 'click', handler);
                        this.$update();
                    }.bind(this);
                    Regular.dom.on(document, 'click', handler);
                }
            },

            // 点击 header 字段中的筛选器中的项
            toggleFilterItem: function (evt, filterItem, header) {
                evt.event.stopPropagation();
                var excludedFilterItems = [];
                filterItem.selected = !filterItem.selected;
                var isAllFilterItem = filterItem.value === null;// 点击全部
                // 选中全部, 则将所有项选中
                header.filterList.forEach(function (t) {
                    isAllFilterItem && (t.selected = filterItem.selected);
                    if (!t.selected && t.value !== null) {
                        excludedFilterItems.push(t.value);
                    }
                });
                // 更新本地存储
                var lsConfig = that._getLSConfig();
                lsConfig[header.excludedFilterLSKey] = excludedFilterItems;
                that._setLSConfig(lsConfig);
                // 没有选中全部时提示选中的数量及高亮列文字
                header.excludedFilterItems = excludedFilterItems;
                if (!isAllFilterItem) {
                    // 选中"全部"
                    var allFilterItem = header.filterList.find(function (item) {
                        return item.value === null;
                    });
                    allFilterItem.selected = excludedFilterItems.length === 0;
                }
                that._updateHeaderClass(null, null, header, excludedFilterItems);
                this.data.hiddenXList = that._getHiddenList();
                // 更新列表分组
                that._groupList();
            },

            // 搜索功能, 对其他地方没有依赖
            search: function (evt) {
                // 搜索并高亮搜索关键词
                var value = evt.event.target.value.trim();
                var headers = this.data.headers;
                var isEmpty = value === '';
                var hiddenXList = [];
                var hit = false;
                var headerHit = false;
                var headerHitName = '';
                this.data.xlist.forEach(function (item) {
                    hit = false;
                    var itemState = this.data.xlistStates[item.id];
                    headers.forEach(function (header) {
                        headerHit = false;
                        if (!header.name) return;
                        headerHitName = '__ui_' + header.key + '_hit';
                        if (isEmpty) {
                            delete itemState[headerHitName];
                            hit = true;
                            return;
                        }
                        var itemV;
                        var hitIndex;
                        if (header.valueType === 'tag') {
                            var itemVs = item.tag.split(',');
                            var itemVsResult = [];
                            itemVs.forEach(function (iv, index) {
                                hitIndex = iv.toString().toLowerCase().indexOf(value.toLowerCase());
                                if (hitIndex > -1) {
                                    headerHit = true;
                                    hit = true;
                                    var tag = {
                                        title: iv,
                                        name: iv.substr(0, hitIndex) + '<b class="hl">' + iv.substr(hitIndex, value.length) + '</b>' + iv.substr(hitIndex + value.length, iv.length - 1)
                                    }
                                    itemVsResult.push(tag);
                                } else {
                                    // tag pinyin
                                    var itemVPinyin = item.tagPinyin.split(',')[index];
                                    var matchPinyinResult = util.highlightPinyin(iv, itemVPinyin, value);
                                    if (matchPinyinResult) {
                                        var uiName = matchPinyinResult;
                                        var tag = {
                                            title: iv,
                                            name: uiName
                                        }
                                        itemVsResult.push(tag);
                                        headerHit = true;
                                        hit = true;
                                    } else {
                                        itemVsResult.push(iv);
                                    }
                                }
                            });
                            if (headerHit) {
                                itemState[headerHitName] = jstex.getTag2(itemVsResult);
                            }
                        } else {
                            itemV = jstex.getColValue(Object.assign({}, header, {valueType: 'noescape'}), item, itemState);
                            hitIndex = itemV.toString().toLowerCase().indexOf(value.toLowerCase());
                            if (hitIndex > -1) {
                                // 此处拼接不能直接使用 value 值, 因为有大小写的问题
                                itemState[headerHitName] = util._$renderByJst('${a}<b class="hl">${b|escape}</b>${c}', {
                                    a: itemV.substr(0, hitIndex),
                                    b: itemV.substr(hitIndex, value.length),
                                    c: itemV.substr(hitIndex + value.length, itemV.length - 1)
                                });
                                headerHit = true;
                                hit = true;
                            } else {
                                // 拼音字段中的分隔符"单引号", 不能转义
                                var itemVPinyin = jstex.getColValue(Object.assign({}, header, {valueType: 'noescape'}), item, itemState, true);
                                var matchPinyinResult = util.highlightPinyin(itemV, itemVPinyin, value);
                                if (matchPinyinResult) {
                                    var uiName = matchPinyinResult;
                                    itemState[headerHitName] = uiName;
                                    headerHit = true;
                                    hit = true;
                                }
                            }
                        }
                        if (!headerHit) {
                            delete itemState[headerHitName];
                        }
                    }, this);
                    itemState.__search_hit = hit;
                    if (!hit) {
                        hiddenXList.push(item);
                    }
                }, this);
                this.data.hiddenXList = hiddenXList;
                // 列表分组, 这里是为了更新匹配的数据条数, 简便起见, 直接调用 _groupList 方法
                that._groupList();
            },

            // 头部自定义列, 下拉列表的打开还是关闭状态
            toggleHeaderFilter: function (evt) {
                evt.event.stopPropagation();
                // 关闭其他过滤器下拉列表
                this.data.headers.forEach(function (item) {
                    item.filterListOpen = false;
                });
                // 切换自身状态
                this.data.headerFilterOpen = !this.data.headerFilterOpen;
                if (this.data.headerFilterOpen) {
                    var handler = function () {
                        this.data.headerFilterOpen = false;
                        Regular.dom.off(document, 'click', handler);
                        this.$update();
                    }.bind(this);
                    Regular.dom.on(document, 'click', handler);
                }
            },

            // 切换具体的头部列的显示状态
            toggleHeaderFilterItem: function (evt, header) {
                evt.event.stopPropagation();
                var excludedFilterItems = [];
                header.selected = !header.selected;
                // 有效的 header
                var validHeaders = [];
                this.data.headers.forEach(function (t, index) {
                    if (t.name && !t.hiddenByGroup) {
                        validHeaders.push(index);
                        if (t.selected === false) {
                            excludedFilterItems.push(t.key);
                        }
                    }
                });
                // 如果全部都取消勾选了, 则最后一个点击的仍旧选中
                if (excludedFilterItems.length === validHeaders.length) {
                    header.selected = true;
                    var clickedIndex = excludedFilterItems.indexOf(header.key);
                    excludedFilterItems.splice(clickedIndex, 1);
                }
                // 更新本地存储
                var lsConfig = that._getLSConfig();
                lsConfig[EXCLUDED_HEADERS_LS_KEY] = excludedFilterItems;
                that._setLSConfig(lsConfig);
                // æ›´æ–°headeråˆ—
                that._updateHiddenHeaders();
            },

            // æ›´æ”¹åˆ—è¡¨çš„è§†å›¾æ¨¡å¼
            changeListViewMode: function (mode) {
                this.data.listViewMode = mode;
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                var lsConfig = that._getLSConfig();
                lsConfig[LIST_VIEW_MODE_LS_KEY] = mode;
                that._setLSConfig(lsConfig);
                // æ›´æ–°åˆ—è¡¨åˆ†ç»„
                that._groupList();
                // åˆ†ç»„ä¾èµ–ä¸‹æ‹‰æ¡†
                that._initGroupSelect();
            },

            // åˆ†ç»„è§†å›¾ä¸‹, å•å‡»æ ‡é¢˜, é€‰ä¸­è¯¥ç»„ä¸‹æ‰€æœ‰é¡¹
            toggleGroup: function (evt, group) {
                // æ²¡æœ‰æ‰¹é‡æ“ä½œ, ä¸å¤„ç†
                if (!this.data.batchAction) return;
                var handler = function () {
                    // å…¶ä»–åˆ†ç»„ä¸‹çš„æ¸…é™¤é€‰æ‹©
                    this.data.xlistByGroupOrder.forEach(function (item) {
                        this.data.xlistStates[item.id].__selected = false;
                    }, this);
                    group.__selected = !group.__selected;
                    // åˆ‡æ¢å½“å‰ç‚¹å‡»çš„åˆ†ç»„ä¸‹çš„çŠ¶æ€
                    group.xlist.forEach(function (item) {
                        var itemState = this.data.xlistStates[item.id];
                        if (itemState.__disabled) return;
                        itemState.__selected = group.__selected;
                    }, this);
                    // æ›´æ–°å¤´éƒ¨é€‰ä¸­çš„æ•°é‡
                    this.updateSelectedNum();
                    // è¿™é‡Œéœ€è¦å¼ºåˆ¶è§¦å‘æ›´æ–°è§†å›¾
                    this.$update();
                }.bind(this);
                // è¿™é‡Œè¦åŒºåˆ†åŒå‡»å’Œå•å‡», å•å‡»åŠ è®¡æ—¶å™¨, å»¶è¿Ÿæ‰§è¡Œ
                // __dblClicked çš„å€¼åœ¨åŒå‡»äº‹ä»¶ä¸­è®¾ç½®
                group.__clickTimer = setTimeout(function () {
                    if (group.__dblClicked) {
                        clearTimeout(group.__clickTimer);
                        delete group.__dblClicked;
                        delete group.__clickTimer;
                        return;
                    }
                    handler();
                }, 200);
            },

            // åˆ†ç»„è§†å›¾ä¸‹, åŒå‡»æ ‡é¢˜æˆ–è€…ç‚¹å‡»å›¾æ ‡, åˆ‡æ¢è¯¥åˆ†ç»„ä¸‹é¡¹çš„æ˜¾ç¤ºä¸Žéšè—, è¿™é‡Œä½¿ç”¨ css3 åŠ¨ç”»
            toggleGroupHeight: function (evt, group) {
                group.__dblClicked = true;
                // å±•å¼€è¿˜æ˜¯æ”¶èµ·, åˆå§‹ä¸º undefined, é¦–æ¬¡ç‚¹å‡»æ˜¯å€¼å˜ä¸º false
                group.__expand = group.__expand === undefined ? false : !group.__expand;
            },

            // æ·»åŠ è¡Œ
            addRow: function (evt) {
                if (u._$isFunction(this.data.addRow)) {
                    this.data.addRow(evt);
                }
            },

            // ä»¥ html å­—ç¬¦ä¸²çš„å½¢å¼èŽ·å–è¡Œçš„å†…è¡Œ, æå‡æ€§èƒ½
            getRowHTML: function (item) {
                // ä½¿ç”¨ html å­—ç¬¦ä¸²çš„æ–¹å¼, æ˜¾è‘—æå‡æ€§èƒ½
                var html = '';
                if (this.data.batchAction) {
                    html += '<div class="list-checkbox"><i class="u-icon-checkbox-normal u-icon"></i><i class="u-icon-checkbox-pressed u-icon"></i></div>';
                }
                this.data.headers.forEach(function (header) {
                    if (header.selected !== false && header.hiddenByGroup !== true) {
                        html += '<div class="list-col' + header.class + '" title="' + jstex.getColTitle(header, item) + '">';
                        var itemState = this.data.xlistStates[item.id];
                        // ä¼˜å…ˆæ˜¾ç¤ºæœç´¢åŒ¹é…ç»“æžœ
                        if (itemState['__ui_' + header.key + '_hit']) {
                            html += itemState['__ui_' + header.key + '_hit'];
                        } else if (itemState['__ui_' + header.key]) {
                            // å†åˆ¤æ–­åŽŸå§‹çš„æœ‰è½¬ä¹‰çš„ç»“æžœ, è¿™ä¸ªæ˜¯åœ¨æ¨¡åž‹ä¸­æ·»åŠ çš„
                            html += itemState['__ui_' + header.key];
                        } else {
                            // æ­£å¸¸å­—æ®µ
                            html += jstex.getColValue(header, item, itemState);
                        }
                        html += '</div>';
                    }
                }, this);
                if (item.content) {
                    html += '<div class="list-row-content">' + item.content + '</div>';
                }
                return html;
            },

            // è®¡ç®— row çš„ class
            getRowClass: function (item) {
                var state = this.data.xlistStates[item.id];
                var config = {
                    'list-row': true,
                    'row-item': true,
                    'js-selected': !state.__disabled && state.__selected,
                    'js-disabled': state.__disabled,
                    'js-shared': item.__isShare,
                    'show-content': state.__showContent
                };
                // è‡ªå®šä¹‰ class
                if (state.__class) {
                    config[state.__class] = true
                }
                return util.classNames(config);
            },

            // å¿«æ·æ“ä½œ, æ¸…é™¤é€‰æ‹©
            clearSelected: function (evt) {
                evt.event.preventDefault();
                Object.keys(this.data.xlistStates).forEach(function (id) {
                    delete this.data.xlistStates[id].__selected;
                }, this);
                this.updateSelectedNum();
            },

            // å¿«æ·æ“ä½œ, åå‘é€‰æ‹©
            reverseSelected: function (evt) {
                evt.event.preventDefault();
                Object.keys(this.data.xlistStates).forEach(function (id) {
                    this.data.xlistStates[id].__selected = !this.data.xlistStates[id].__selected;
                }, this);
                this.updateSelectedNum();
            }
        });
    };

    // è®¾ç½®ç”¨äºŽ action manager çš„é…ç½®, æ‰¹é‡æ“ä½œ
    pro._setBatchActionData = function (header, checkedIds) {
        if (this._options.showHeader === false) {
            // æ²¡æœ‰æ‰¹é‡æ“ä½œ
            return;
        }
        if (checkedIds.length > 1) {
            e._$addClassName(header, 'batch-action-multi-sel');
        }
        else {
            e._$delClassName(header, 'batch-action-multi-sel');
        }
        var index;
        var batchActions = $(header)._$getByClassName('batch-action-item');
        for (index = 0; index < batchActions.length; index++) {
            var actionData = {};
            try {
                actionData = JSON.parse(e._$dataset(batchActions[index], 'action'));
            } catch (err) {
                console.error(err);
                continue;
            }
            if (actionData.type === 'link') {
                // è®¾ç½® link
                var href = e._$attr(batchActions[index], 'href');
                e._$attr(batchActions[index], 'href', actionData.link + checkedIds.join(','));
            } else {
                actionData.ids = checkedIds;
                actionData.key = this._options.listCacheKey;
                e._$dataset(batchActions[index], 'action', JSON.stringify(actionData));
            }
        }
    };

    /* å…¬å¼€æ–¹æ³• */
    /**
     * åˆ·æ–°åˆ—è¡¨
     */
    pro._$update = function () {
        this.stripedList.$update();
    };

    /**
     * é‡æ–°æ¸²æŸ“åˆ—è¡¨
     * @param  {Array} list - æ–°çš„åˆ—è¡¨æ•°æ®
     */
    pro._$updateList = function (list) {
        this._options.xlist = list;
        this._initXlistStates();
        // header å­—æ®µä¸­çš„ç­›é€‰å™¨
        this._initHeaderFilters();
        // è®¾ç½®ä¸éœ€è¦æ˜¾ç¤ºçš„åˆ—
        this._updateHiddenHeaders();
        this._render();
    };

    /**
     * å›žæ”¶ç»„ä»¶
     * @param  {Object} options - é…ç½®å‚æ•°
     */
    pro._$recycle = function (options) {
        this.__super(options);
        // 模块快速切换的时候, 有可能该组件还没实例化完成, 此时模块回收会调用该方法, 需要加个判断 this.stripedList 存在不存在
        this.stripedList && this.stripedList.destroy();
        delete this.stripedList;
        this._pager && this._pager._$recycle();
        this._pager = null;
        this._groupSelect && this._groupSelect.destroy();
        this._groupSelect = null;
        if (this._listCache) {
            this._listCache._$recycle();
            delete this._listCache;
            v._$delEvent(caches[this._options.listCache], 'itemsdeleted', this._itemsDeletedHandler);
            delete this._itemsDeletedHandler;
        }

        var listBd = e._$getByClassName(this._options.parent, 'list-bd')[0];
        v._$delEvent(listBd, 'scroll');
    };

    /**
     * 刷新列表
     */
    pro._$refresh = function (options) {
        this._$recycle();
        this._$clearListCache();
        this.__reset(u._$merge({}, this._originalOptions, options));
    };

    /**
     * 隐藏项
     * @param  {Object|Array|String} items - 需要隐藏的项
     * 格式: 1. xxxx(id)
     *      2. {id: xxxx}
     *      3. 以上两种的数组格式
     */
    pro._$hideItems = function (items) {
        if (!u._$isArray(items)) {
            items = [items];
        }
        items.forEach(function (item) {
            this.stripedList.data.xlistStates[item.id || item].__hidden = true;
        }, this);
        this.stripedList.$update();
    };

    /**
     * 显示项
     * @param  {Object|Array|String} items - 需要显示的项
     * 格式: 1. xxxx(id)
     *      2. {id: xxxx}
     *      3. 以上两种的数组格式
     */
    pro._$showItems = function (items) {
        if (!u._$isArray(items)) {
            items = [items];
        }
        items.forEach(function (item) {
            this.stripedList.data.xlistStates[item.id || item].__hidden = false;
        }, this);
        this.stripedList.$update();
    };

    /**
     * 设置某项数据的状态
     * @param  {Object|String} item - 需要设置的项
     * @param  {Object} state - 需要设置的状态数据
     */
    pro._$setItemState = function (item, state) {
        var itemState = this.stripedList.data.xlistStates[item.id || item];
        u._$merge(itemState, state);
        this.stripedList.$update();
    };

    /**
     * 获取列表的状态对象
     */
    pro._$getListStates = function () {
        return this.stripedList.data.xlistStates;
    };

    /**
     * 清除 list 缓存数据
     */
    pro._$clearListCache = function () {
        if (this._listCache) {
            this._listCache._$clearListInCache(this._options.listCacheKey);
        }
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','e61cba3c1c523802688888e6fbd0ccb7','ac1e584495dcf57f8a3472dfeddbf19b','1b12378d868a5877d4dba65367942b75','e26ac58445dd3bc2b730e5275fb45f6f','c946055836c26441b9d60b589f2e1581','4f974133cc48417770aab7278404f301','ffa820b4cb293ae990489967d5c4a899','8cbc286a7834dfcf29c8f7a018e77c02','18fdbc27498bb1c4312201f146717dc0','7738e0f450927f99410932edaaf8f468','3703c5e75095c57a35cd18e060ca7002');
I$('976cba6afc91e77a5cc259ac24918ed5',".m-tab{font-size:16px;position:relative;border-bottom:1px solid #ccc;height:46px;line-height:46px;padding-top:14px;background-color:#fff;}.m-tab .tab{display:block;float:left;padding-right:30px;color:#666;}.m-tab .tab.js-selected{color:#30a1f2;}.m-tab .tab.js-hovered{color:#30a1f2;}.m-tab .hl{position:absolute;height:2px;background-color:#30a1f2;bottom:-1px;left:0;transition:left ease 0.1s;}");
I$('e0086650b44f7f035fb68e830af91a61',function (k, u, e, v, t, css, p, pro) {

    p._$$ModuleTab = k._$klass();
    pro = p._$$ModuleTab._$extend(t._$$EventTarget);

    e._$addStyle(css);

    // 默认配置参数
    var defaultOptions = {
        // 列表容器
        tab: null,
        // 选中的样式类名
        selectedClass: 'js-selected',
        // 选中的样式类名
        hoveredClass: 'js-hovered',
        // dataset 的 key
        datasetKey: 'id'
    };
    pro.__init = function(_options){
        this.__super(_options);
        // TODO
    };
    pro.__reset = function (options) {
        this.__super(options);
        this._options = u._$merge({}, defaultOptions, options);
        if (!this._options.tab) {
            return;
        }
        this._tabs = e._$getChildren(this._options.tab, 'tab');
        this._hlEl = e._$create('div', 'hl', this._options.tab);
        this._addEvent();
    };

    /**
     * 高亮指定索引的选项卡
     * @param  {Number} index - 要高亮的选项卡索引
     * @param  {Boolean} [init=false] - 是否是初始匹配, 默认为 false, 初始匹配不需要动画效果
     * @param  {Boolean} [isHover=false] - 是否是hover
     * @return {Node} - 高亮的选项卡节点
     */
    pro._highlight = function (index, init, isHover) {
        var selectedTab = null;
        if (init) {
            e._$setStyle(this._hlEl, 'opacity', 0);
        }
        u._$forEach(this._tabs, function (tab, idx) {
            if (idx === index) {
                e._$addClassName(tab, isHover ? this._options.hoveredClass : this._options.selectedClass);
                e._$setStyle(this._hlEl, 'width', e._$getStyle(tab, 'width'));
                e._$setStyle(this._hlEl, 'left', tab.offsetLeft + 'px');
                selectedTab = tab;
            } else {
                e._$delClassName(tab, isHover ? this._options.hoveredClass : this._options.selectedClass);
            }
        }, this);
        if (init) {
            setTimeout(function () {
                e._$setStyle(this._hlEl, 'opacity', 1);
            }.bind(this), 100)
        }
        return selectedTab;
    };

    pro._addEvent = function () {
        u._$forEach(this._tabs, function (tab, idx) {
            v._$addEvent(tab, 'mouseover', function (evt) {
                this._highlight(idx, false, true);
            }.bind(this), false);
            v._$addEvent(tab, 'mouseout', function (evt) {
                this._highlight(this._highlightIndex, false, true);
            }.bind(this), false);
        }, this);


    };

    /**
     * 验证匹配情况
     * @param  {String} value - 待匹配值
     * @return {Node} - 匹配的节点
     */
    pro._$match = function (value) {
        var event = {target: value};
        u._$forEach(this._tabs, function (tab, idx) {
            delete event.matched;
            event.source = e._$dataset(tab, this._options.datasetKey);
            this._$dispatchEvent('oncheck', event);
            if (event.matched) {
                this._highlightIndex = idx;
            } else {
                e._$delClassName(tab, this._options.hoveredClass + ' ' + this._options.selectedClass);
            }
        }, this);
        return this._highlight(this._highlightIndex, true);
    };
    // 控件回收销毁过程
    pro.__destroy = function(){
        this.__super();
        // TODO
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','b3c0f3ceba0c279f7e6de06836b8d2f0','976cba6afc91e77a5cc259ac24918ed5');
I$('fc53a6cf2155b0647b92626f5a19ecd8',function (NEJ,_k,_i,_p,_o,_f,_r){
    var _pro;
    /**
     * 列表项控件基类
     *
     * 页面结构举例
     *
     * ```html
     * <div id='item-box'></div>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'ui/item/item'
     * ],function(_k,_i0,_p,_o,_f,_r){
     *     var _  = NEJ.P,
     *         _p = _('nej.ut'),
     *         _e = _('nej.e');
     *     // 第一步：新建一个类，继承自此基类
     *     var _html_key = _e._$addNodeTemplate('<div>123</div>');
     *
     *     _p._$$MyItem = _k._$klass();
     *     _proMyItem = _p._$$MyItem._$extend(_i0._$$Item);
     *     _proMyItem.__reset = function(_options){
     *         this.__data = _options.data;
     *         this.__super(_options);
     *     }
     *
     *     _proMyItem.__doRefresh = function(){
     *         // 刷新一项，设置数据{name:'sean'}
     *         this.__body.innerText = this.__data.name;
     *     };
     *
     *     _proMyItem.__initXGui = function(){
     *         this.__seed_html = _html_key;
     *     };
     * });
     * // 第二步：生成item列表
     * // 可以自己循环list，生成item
     * NEJ.define([
     *     'base/event',
     *     'path/to/custom/myitem.js'
     * ],function(_e,_i0,_p,_o,_f,_r){
     *     var _item = _i0._$$MyItem._$allocate({
     *         parent:'item-box',
     *         data:list[i]
     *     });
     *     // 可以利用_e._$getItemTemplate接口，返回item列表
     *     _e._$getItemTemplate(
     *         [{name:'jack'},{name:'sean'}],
     *         _i0._$$MyItem,
     *         {parent:'item-box'}
     *     );
     * });
     * ```
     *
     * @class     module:ui/item/item._$$Item
     * @extends   module:ui/base._$$Abstract
     * @param     {Object} arg0  - 可选配置参数
     * @property  {Object} data  - 当前项绑定的数据
     * @property  {Number} index - 当前项的索引
     * @property  {Number} total - 总列表长度
     * @property  {Array}  range - 当前项所在的列表片段方位(begin,end)
     */
    _p._$$Item = _k._$klass();
    _pro = _p._$$Item._$extend(_i._$$Abstract);
    /**
     * 控件初始化
     *
     * @protected
     * @method module:ui/item/item._$$Item#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__id = this.__genId();
        this.__super();
    };
    /**
     * 控件重置
     *
     * @protected
     * @method module:ui/item/item._$$Item#__reset
     * @param  {Object} arg0 - 可选配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__index = _options.index;
        this.__total = _options.total;
        this.__range = _options.range;
        this._$refresh(_options.data);
    };
    /**
     * 控件销毁
     *
     * @protected
     * @method module:ui/item/item._$$Item#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        delete this.__data;
        delete this.__index;
        delete this.__total;
        delete this.__range;
    };
    /**
     * 刷新项,子类实现具体逻辑
     *
     * @abstract
     * @method module:ui/item/item._$$Item#__doRefresh
     * @return {Void}
     */
    _pro.__doRefresh = _f;
    /**
     * 生成ID
     *
     * @protected
     * @method module:ui/item/item._$$Item#__genId
     * @return {String} ID
     */
    _pro.__genId = (function(){
        var _seed = +new Date;
        return function(){
            return 'itm-'+(++_seed);
        };
    })();
    /**
     * 取项标识
     *
     * 脚本举例
     * ```javascript
     * // 获取当前item的id标识
     * _item._$getId();
     * ```
     *
     * @method module:ui/item/item._$$Item#_$getId
     * @return {String} 项标识
     */
    _pro._$getId = function(){
        return this.__id;
    };
    /**
     * 取项绑定数据
     *
     * 脚本举例：
     * ```javascript
     * // 获取当前item的数据信息
     * _item._$getData();
     * ```
     *
     * @method module:ui/item/item._$$Item#_$getData
     * @return {Object} 数据信息
     */
    _pro._$getData = function(){
        return this.__data;
    };
    /**
     * 刷新项绑定的数据
     *
     * 脚本举例：
     * ```javascript
     * // 获取当前item的数据信息
     * _item._$refresh({
     *     a:'aaaaa',
     *     b:'bbbbb'
     * });
     * ```
     *
     * @method module:ui/item/item._$$Item#_$refresh
     * @param  {Object} arg0 - é¡¹ç»‘å®šçš„æ•°æ®
     * @return {Void}
     */
    _pro._$refresh = function(_data){
        this.__data  = _data||{};
        this.__doRefresh(this.__data);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ui'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','d81f928b2e8dc2e94031eba0a018b644');
I$('84e330b188e3f4b4bbdf864593ac2892',function (NEJ,_k,_i0,_p,_o,_f,_r){
    var _pro;
    /**
     * åˆ—è¡¨é¡¹åŸºç±»å¯¹è±¡
     *
     * @class     module:ui/item/list._$$ListItem
     * @extends   module:ui/item/item._$$Item
     * @param     {Object} arg0 - é…ç½®å‚æ•°
     * @property  {String} pkey - ä¸»é”®å­—æ®µåç§°ï¼Œé»˜è®¤ä¸ºid
     */
    /**
     * åˆ é™¤åˆ—è¡¨é¡¹è§¦å‘äº‹ä»¶
     *
     * @event    module:ui/item/list._$$ListItem#ondelete
     * @param    {Object} arg0 - äº‹ä»¶ä¿¡æ¯
     * @property {String} id   - é¡¹æ ‡è¯†
     * @property {Object} data - é¡¹ç»‘å®šçš„æ•°æ®
     *
     */
    _p._$$ListItem = _k._$klass();
    _pro = _p._$$ListItem._$extend(_i0._$$Item);
    /**
     * æŽ§ä»¶é‡ç½®
     *
     * @protected
     * @method module:ui/item/list._$$ListItem#__reset
     * @param  {Object} arg0 - é…ç½®ä¿¡æ¯
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__pkey = _options.pkey||'id';
        this.__prefix = _options.prefix||'';
        this.__super(_options);
    };
    /**
     * åˆ é™¤åˆ—è¡¨é¡¹è§¦å‘äº‹ä»¶
     *
     * @protected
     * @method module:ui/item/list._$$ListItem#__onDelete
     * @return {Void}
     */
    _pro.__onDelete = function(_data){
        this._$dispatchEvent('ondelete',{
            ext:_data,
            id:this._$getId(),
            data:this._$getData(),
            body:this._$getBody()
        });
    };
    /**
     * åˆ é™¤åˆ—è¡¨é¡¹è§¦å‘äº‹ä»¶
     *
     * @protected
     * @method module:ui/item/list._$$ListItem#__onUpdate
     * @return {Void}
     */
    _pro.__onUpdate = function(_data){
        this._$dispatchEvent('onupdate',{
            ext:_data,
            id:this._$getId(),
            data:this._$getData(),
            body:this._$getBody()
        });
    };
    /**
     * åˆ·æ–°é¡¹ç»‘å®šçš„æ•°æ®<br/>
     *
     * è„šæœ¬ä¸¾ä¾‹ï¼š
     * ```javascript
     * // èŽ·å–å½“å‰itemçš„æ•°æ®ä¿¡æ¯
     * _item._$refresh({
     *     a:'aaaaa',
     *     b:'bbbbb'
     * });
     * ```
     *
     * @method module:ui/item/list._$$ListItem#_$refresh
     * @param  {Object} arg0 - é¡¹ç»‘å®šçš„æ•°æ®
     * @return {Void}
     */
    _pro._$refresh = function(_data){
        this.__super(_data);
        var _id = this.__data[this.__pkey];
        this.__id = (this.__prefix+_id)||this.__genId();
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ui'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','fc53a6cf2155b0647b92626f5a19ecd8');
I$('bbd2b03b4721a770fd4204d16daa8889',function (NEJ,_k,_u,_v,_e,_i0,_i1,_t0,_t1,_t2,_t3,_p,_o,_f,_r){
    var _pro;
    /**
     * åˆ—è¡¨æ¨¡å—åŸºç±»
     *
     * @class    module:util/list/module._$$ListModule
     * @extends  module:util/event._$$EventTarget
     *
     * @param    {Object}        config - å¯é€‰é…ç½®å‚æ•°
     * @property {String|Node}   parent - åˆ—è¡¨å®¹å™¨èŠ‚ç‚¹
     * @property {Number}        limit  - æ¯é¡µæ˜¾ç¤ºæ•°é‡ï¼Œé»˜è®¤10é¡¹
     * @property {Number}        first  - é¦–é¡µæ˜¾ç¤ºæ•°é‡ï¼Œé»˜è®¤ä¸ºlimitçš„å€¼
     * @property {String|Object} item   - åˆ—è¡¨JSTæ¨¡ç‰ˆæ ‡è¯†æˆ–è€…Itemé…ç½®ï¼Œ{clazz:'xxx',klass:_$$Item||'jst key',prefix:'xxx'}
     * @property {Object}        cache  - ç¼“å­˜é…ç½®ä¿¡æ¯ï¼Œ{key:'primary key',lkey:'list key',data:{},ext:{},klass:_$$CacheList,list:[],clear:true,total:200}
     * @property {Object}        pager  - åˆ†é¡µå™¨é…ç½®ä¿¡æ¯ï¼Œ{parent:'xxx',klass:_$$Pager,index:2,fixed:true}
     */
    /**
     * ä¸‹æ‹‰åˆ·æ–°åˆ—è¡¨ä¹‹å‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¯ç”¨äºŽå¤„ç†loadingçŠ¶æ€çš„æ˜¾ç¤º
     * 
     * @event    module:util/list/module._$$ListModule#onbeforepullrefresh
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Node}    parent  - å®¹å™¨èŠ‚ç‚¹
     * @property {String}  value   - è®¾ç½®æ­¤å‚æ•°è¿”å›žç”¨ä»¥æ˜¾ç¤ºloadingçš„htmlä»£ç æˆ–è€…èŠ‚ç‚¹
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žloadingå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥å¤„ç†loadingçŠ¶æ€
     */
    /**
     * ä¸‹æ‹‰åˆ·æ–°åˆ—è¡¨è½½å…¥ä¹‹åŽå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¯ç”¨äºŽå¤„ç†loadingçŠ¶æ€çš„éšè—
     * 
     * @event    module:util/list/module._$$ListModule#onafterpullrefresh
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Node}    parent  - å®¹å™¨èŠ‚ç‚¹
     * @property {String}  value   - è®¾ç½®æ­¤å‚æ•°è¿”å›žç”¨ä»¥æ˜¾ç¤ºloadingçš„htmlä»£ç 
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žloadingå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥å¤„ç†loadingçŠ¶æ€
     */
    /**
     * åŠ è½½åˆ—è¡¨ä¹‹å‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¯ç”¨äºŽå¤„ç†loadingçŠ¶æ€çš„æ˜¾ç¤º
     * 
     * @event    module:util/list/module._$$ListModule#onbeforelistload
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Node}    parent  - å®¹å™¨èŠ‚ç‚¹
     * @property {String}  value   - è®¾ç½®æ­¤å‚æ•°è¿”å›žç”¨ä»¥æ˜¾ç¤ºloadingçš„htmlä»£ç æˆ–è€…èŠ‚ç‚¹
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žloadingå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥å¤„ç†loadingçŠ¶æ€
     */
    /**
     * åˆ—è¡¨è½½å…¥ä¹‹åŽå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¯ç”¨äºŽå¤„ç†loadingçŠ¶æ€çš„éšè—
     * 
     * @event    module:util/list/module._$$ListModule#onafterlistload
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Node}    parent  - å®¹å™¨èŠ‚ç‚¹
     * @property {String}  value   - è®¾ç½®æ­¤å‚æ•°è¿”å›žç”¨ä»¥æ˜¾ç¤ºloadingçš„htmlä»£ç 
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žloadingå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥å¤„ç†loadingçŠ¶æ€
     */
    /**
     * ä¸ºç©ºåˆ—è¡¨æ—¶æ˜¾ç¤ºçš„ä¿¡æ¯
     * 
     * @event    module:util/list/module._$$ListModule#onemptylist
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Node}    parent  - å®¹å™¨èŠ‚ç‚¹
     * @property {String}  value   - è®¾ç½®æ­¤å‚æ•°è¿”å›žç”¨ä»¥æ˜¾ç¤ºçš„htmlä»£ç 
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥å¤„ç†çŠ¶æ€
     */
    /**
     * é¡µç å˜åŒ–è§¦å‘äº‹ä»¶
     * 
     * @event    module:util/list/module._$$ListModule#onpagechange
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {Number}  index   - å½“å‰é¡µç 
     * @property {Boolean} stopped - è®¾ç½®æ­¤å‚æ•°ç”¨ä»¥è¡¨æ˜Žå·²å¤„ç†ï¼ŒåŽç»­é€»è¾‘å¿½ç•¥åˆ†é¡µå¤„ç†
     */
    /**
     * åˆ—è¡¨æ˜¾ç¤ºä¹‹å‰å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ­¤äº‹ä»¶ç¡®ä¿åˆ—è¡¨æœ‰æ•°æ®
     * 
     * @event    module:util/list/module._$$ListModule#onbeforelistrender
     * @param    {Object} event  - äº‹ä»¶ä¿¡æ¯
     * @property {Node}   parent - å®¹å™¨èŠ‚ç‚¹
     * @property {Number} offset - å½“å‰ç»˜åˆ¶åˆ—è¡¨åç§»é‡
     * @property {Number} limit  - å½“å‰ç»˜åˆ¶åˆ—è¡¨æ•°é‡
     * @property {Number} total  - å½“å‰åˆ—è¡¨æ€»æ•°
     * @property {Array}  list   - å½“å‰åˆ—è¡¨
     */
    /**
     * åˆ—è¡¨æ˜¾ç¤ºä¹‹åŽå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ­¤äº‹ä»¶ç¡®ä¿åˆ—è¡¨æœ‰æ•°æ®
     * 
     * @event    module:util/list/module._$$ListModule#onafterlistrender
     * @param    {Object} event  - äº‹ä»¶ä¿¡æ¯
     * @property {Node}   parent - å®¹å™¨èŠ‚ç‚¹
     * @property {Number} offset - å½“å‰ç»˜åˆ¶åˆ—è¡¨åç§»é‡
     * @property {Number} limit  - å½“å‰ç»˜åˆ¶åˆ—è¡¨æ•°é‡
     * @property {Number} total  - å½“å‰åˆ—è¡¨æ€»æ•°
     * @property {Array}  list   - å½“å‰åˆ—è¡¨
     */
    /**
     * åˆ—è¡¨æ¸…é™¤ä¹‹å‰å¤„ç†ä¸šåŠ¡é€»è¾‘
     * 
     * @event    module:util/list/module._$$ListModule#onbeforelistclear
     * @param    {Object} event  - äº‹ä»¶ä¿¡æ¯
     * @property {Node}   parent - å®¹å™¨èŠ‚ç‚¹
     */
    /**
     * è¯·æ±‚æ›´æ–°åˆ—è¡¨é¡¹æ•°æ®ï¼Œä¸»è¦ç”¨äºŽå¤„ç†åˆ é™¤ä¹‹å‰çš„ç¡®è®¤ï¼Œ
     * ç¡®è®¤å®ŒæˆåŽå¯è°ƒç”¨æ¨¡å—çš„_$deleteæŽ¥å£å°†æ•°æ®ä»ŽæœåŠ¡å™¨ä¸Šåˆ é™¤
     * 
     * @event  module:util/list/module._$$ListModule#ondelete
     * @param  {Object} event - åˆ—è¡¨é¡¹æ•°æ®
     */
    /**
     * åˆ é™¤åˆ—è¡¨é¡¹ä¹‹å‰å›žè°ƒï¼Œä¸»è¦ç”¨æ¥é¢„å¤„ç†è°ƒç”¨Cacheä¸­çš„åˆ é™¤æŽ¥å£æ—¶çš„ä¿¡æ¯
     * 
     * @event    module:util/list/module._$$ListModule#onbeforedelete
     * @param    {Object} event - äº‹ä»¶ä¿¡æ¯
     * @property {String} id    - åˆ—è¡¨é¡¹æ ‡è¯†
     * @property {String} key   - åˆ—è¡¨æ ‡è¯†
     * @property {Object} data  - åˆ—è¡¨é¡¹æ•°æ®
     */
    /**
     * åˆ é™¤åˆ—è¡¨é¡¹ä¹‹åŽå›žè°ƒï¼Œä¸»è¦ç”¨æ¥é¢å¤–å¤„ç†åˆ—è¡¨å‘ˆçŽ°çš„ä¸šåŠ¡é€»è¾‘
     * 
     * @event    module:util/list/module._$$ListModule#onafterdelete
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {String}  key     - åˆ—è¡¨æ ‡è¯†
     * @property {Object}  data    - åˆ é™¤çš„åˆ—è¡¨é¡¹æ•°æ®
     * @property {Boolean} stopped - æ˜¯å¦é˜»æ­¢åˆ—è¡¨åˆ·æ–°é€»è¾‘
     */
    /**
     * è¯·æ±‚æ›´æ–°åˆ—è¡¨é¡¹æ•°æ®ï¼Œé’ˆå¯¹JSTæ¨¡ç‰ˆçš„ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºï¼Œ
     * ä¸»è¦ç”¨äºŽå¤„ç†æ”¶é›†æ›´æ–°æ•°æ®ï¼Œæ›´æ–°æ•°æ®æ”¶é›†å®ŒæˆåŽå¯è°ƒç”¨æ¨¡å—çš„_$updateæŽ¥å£å°†æ•°æ®æ›´æ–°åˆ°æœåŠ¡å™¨
     * 
     * @event  module:util/list/module._$$ListModule#onupdate
     * @param  {Object} event - åˆ—è¡¨é¡¹æ•°æ®
     */
    /**
     * æ›´æ–°åˆ—è¡¨é¡¹ä¹‹å‰å›žè°ƒï¼Œä¸»è¦ç”¨æ¥é¢„å¤„ç†è°ƒç”¨Cacheä¸­çš„æ›´æ–°æŽ¥å£æ—¶çš„ä¿¡æ¯
     * 
     * @event    module:util/list/module._$$ListModule#onbeforeupdate
     * @param    {Object} event - äº‹ä»¶ä¿¡æ¯
     * @property {String} id    - åˆ—è¡¨é¡¹æ ‡è¯†
     * @property {String} key   - åˆ—è¡¨æ ‡è¯†
     * @property {Object} data  - åˆ—è¡¨é¡¹æ•°æ®
     */
    /**
     * æ›´æ–°åˆ—è¡¨é¡¹ä¹‹åŽå›žè°ƒï¼Œä¸»è¦ç”¨æ¥é¢å¤–å¤„ç†åˆ—è¡¨å‘ˆçŽ°çš„ä¸šåŠ¡é€»è¾‘
     * 
     * @event    module:util/list/module._$$ListModule#onafterupdate
     * @param    {Object}  event   - äº‹ä»¶ä¿¡æ¯
     * @property {String}  key     - åˆ—è¡¨æ ‡è¯†
     * @property {Object}  data    - åˆ é™¤çš„åˆ—è¡¨é¡¹æ•°æ®
     * @property {Boolean} stopped - æ˜¯å¦é˜»æ­¢åˆ—è¡¨åˆ·æ–°é€»è¾‘
     */
    /**
     * é”™è¯¯å¤„ç†å›žè°ƒ
     * 
     * @event  module:util/list/module._$$ListModule#onerror
     */
    _p._$$ListModule = _k._$klass();
    _pro = _p._$$ListModule._$extend(_t0._$$EventTarget);
    /**
     * æŽ§ä»¶é‡ç½®
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__reset
     * @param  {Object} arg0 - é…ç½®å‚æ•°
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__ropt = {};
        this.__super(_options);
        this.__lbox = _e._$get(_options.parent);
        this.__iopt = {parent:this.__lbox};
        this.__limit = parseInt(_options.limit)||10;
        this.__first = parseInt(_options.first)||this.__limit;
        this.__doResetTemplate(_options.item);
        this.__doResetCache(_options.cache||_o);
        this.__doResetPager(_options.pager||_o);
        this._$refresh();
    };
    /**
     * æŽ§ä»¶é”€æ¯
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this._$dispatchEvent('onbeforerecycle');
        this.__doClearListBox();
        this.__super();
        if (this.__ropt.clear){
            this.__cache._$clearListInCache(this.__ropt.key);
        }
        this.__cache._$recycle();
        if (!!this.__pager){
            this.__pager._$recycle();
            delete this.__pager;
        }
        delete this.__pkls;
        delete this.__popt;
        delete this.__pulling;
        delete this.__cache;
        delete this.__lbox;
        delete this.__ikls;
        delete this.__iopt;
        delete this.__iext;
        delete this.__ropt;
    };
    /**
     * æ ¹æ®æ•°æ®IDå–é¡¹èŠ‚ç‚¹ID
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__getItemBodyId
     * @param  {String} 数据ID
     * @return {String} 节点ID
     */
    _pro.__getItemBodyId = function(_id){
        return this.__getItemId(_id)+
               _t1._$seed();
    };
    /**
     * 取项标识
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__getItemId
     * @param  {String} arg0 - 数据标识
     * @return {String}        项标识
     */
    _pro.__getItemId = function(_id){
        var _prefix = (this.__iopt||_o).prefix||'';
        return _prefix+_id;
    };
    /**
     * 取当前偏移量的分页信息
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__getPageInfo
     * @param  {Number} arg0 - 偏移位置
     * @param  {Number} arg1 - 长度
     * @return {Object}        分页信息，如：{index:1,total:4}
     */
    _pro.__getPageInfo = function(_point,_offset,_limit,_length){
        var _result = {
            index:1,
            total:1
        };
        if (_offset>=_point){
            _result.index = Math.floor((_offset-_point)/_limit)+2;
        }
        if (_length>_point){
            _result.total = Math.ceil((_length-_point)/_limit)+1;
        }
        return _result;
    };
    /**
     * 重置JST模版
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doResetJSTTemplate
     * @param  {String} arg0 - JST标识
     * @return {Void}
     */
    _pro.__doResetJSTTemplate = function(_key){
        delete this.__ikls;
        this.__ikey = _key;
        this.__doInitDomEvent([[
            this.__lbox,'click',
            this.__onCheckAction._$bind(this)
        ]]);
    };
    /**
     * 重置列表项模版配置
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doResetTemplate
     * @param  {String|Object} arg0 - 列表项模版配置
     * @return {Void}
     */
    _pro.__doResetTemplate = function(_item){
        // if item is jst-key
        if (_u._$isString(_item)){
            this.__doResetJSTTemplate(_item);
            return;
        }
        // if item is jst with options
        _u._$merge(this.__iopt,_item);
        // filter jst extend function
        this.__iext = _u._$merge(
            {},_item,function(_it){
                return !_u._$isFunction(_it);
            }
        );
        var _klass = this.__iopt.klass;
        delete this.__iopt.klass;
        if (_u._$isString(_klass)){
            this.__doResetJSTTemplate(_klass);
            return;
        }
        // if item is Item template
        delete this.__ikey;
        this.__ikls = _klass;
        this.__iopt.ondelete = this
            ._$dispatchEvent._$bind(this,'ondelete');
        this.__iopt.onupdate = this
            ._$dispatchEvent._$bind(this,'onupdate');
    };
    /**
     * 重置缓存信息配置
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doResetCache
     * @param  {Object} arg0 - 缓存配置
     * @return {Void}
     */
    _pro.__doResetCache = function(_cache){
        var _klass = _cache.klass,
            _copt  = _u._$merge({},_cache);
        this.__ropt.key = _copt.lkey;
        this.__ropt.ext = _copt.ext;
        this.__ropt.data = _copt.data||{};
        this.__ropt.clear = !!_copt.clear;
        this.__iopt.pkey = _copt.key||'id';
        _copt.onerror = 
            this._$dispatchEvent._$bind(this,'onerror');
        _copt.onlistload =
            this.__cbListLoad._$bind(this);
        _copt.onpullrefresh =
            this.__cbPullRefresh._$bind(this);
        if (!!_klass&&('onlistchange' in _klass)){
            this.__doInitDomEvent([[
                _klass,'listchange',
                this.__cbListChange._$bind(this)
            ]]);
        }else{
            _copt.onitemadd = this.
                __cbItemAdd._$bind(this);
            _copt.onitemdelete = this.
                __cbItemDelete._$bind(this);
            _copt.onitemupdate = this.
                __cbItemUpdate._$bind(this);
        }
        this.__cache = (_klass||_t3._$$CacheList)._$allocate(_copt);
        // set total
        if (_cache.total!=null){
            this.__cache._$setTotal(
                this.__ropt.key,
                _cache.total
            );
        }
        // set list
        if (!!_cache.list){
            this.__cache._$setListInCache(
                this.__ropt.key,
                _cache.list
            );
        }
    };
    /**
     * é‡ç½®åˆ†é¡µå™¨é…ç½®
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doResetPager
     * @param  {Object} åˆ†é¡µå™¨é…ç½®
     * @return {Void}
     */
    _pro.__doResetPager = function(_pager){
        this.__pkls = _pager.klass||_i1._$$Pager;
        this.__popt = _u._$merge({},_pager);
        // parse bind pager
        if (_u._$isArray(_pager.parent)){
            this.__popt.parent = _pager.parent[0];
            this.__pbid = _pager.parent.slice(1);
            if (!this.__pbid||!this.__pbid.length){
                delete this.__pbid;
            }
        }
        delete this.__popt.klass;
    };
    /**
     * æ¸…ç†åˆ—è¡¨å®¹å™¨
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doClearListBox
     * @return {Void}
     */
    _pro.__doClearListBox = (function(){
        var _reg0 = /^(?:table|tr|tbody|ul|ol|select)$/i;
        return function(){
            this._$dispatchEvent('onbeforelistclear',{
                parent:this.__lbox
            });
            if (!!this.__items&&this.__items.length>0){
                this.__items = this.__ikls
                    ._$recycle(this.__items);
                delete this.__items;
            }
            if (_reg0.test(this.__lbox.tagName)){
                _e._$clearChildren(this.__lbox);
            }else{
                this.__lbox.innerHTML = '';
            }
        };
    })();
    /**
     * åˆ‡æ¢åˆ†é¡µå™¨çš„æ˜¾ç¤ºçŠ¶æ€
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doSwitchPagerShow
     * @return {Void}
     */
    _pro.__doSwitchPagerShow = function(_display){
        if (!!this.__popt.fixed) return;
        _e._$setStyle(this.__popt.parent,'display',_display);
        _u._$forEach(
            this.__pbid,function(_parent){
                _e._$setStyle(_parent,'display',_display);
            },this
        );
    };
    /**
     * é€šè¿‡åˆ†é¡µå™¨åˆ·æ–°å½“å‰é¡µ
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doRefreshByPager
     * @return {Void}
     */
    _pro.__doRefreshByPager = function(){
        var _index = this.__popt.index||1;
        delete this.__popt.index;
        if (!!this.__pager){
            _index = this.__pager._$getIndex();
        }
        this.__doChangePage({
            last:_index,
            index:_index
        });
    };
    /**
     * é¡µç å˜åŒ–å¤„ç†é€»è¾‘
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doChangePage
     * @param  {Object} arg0 - é¡µç ä¿¡æ¯
     * @return {Void}
     */
    _pro.__doChangePage = function(_event){
        this._$dispatchEvent('onpagechange',_event);
    };
    /**
     * åç§»é‡å˜åŒ–å¤„ç†é€»è¾‘
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doChangeOffset
     * @param  {Number} arg0 - åç§»é‡
     * @return {Void}
     */
    _pro.__doChangeOffset = function(_offset){
        this.__ropt.offset = _offset;
        this.__doBeforeListLoad();
        this.__doLoadList();
    };
    /**
     * ç”Ÿæˆè¯·æ±‚å¯¹è±¡ä¿¡æ¯
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doGenRequestOpt
     * @param  {Object} arg0 - é¢„å¤„ç†è¯·æ±‚ä¿¡æ¯
     * @return {Object}        å¤„ç†åŽè¯·æ±‚ä¿¡æ¯
     */
    _pro.__doGenRequestOpt = function(_options){
        return _options;
    };
    /**
     * åŠ è½½æ•°æ®åˆ—è¡¨
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doLoadList
     * @return {Void}
     */
    _pro.__doLoadList = function(){
        // load data from cache
        var _data = this.__ropt.data;
        _data.offset = this.__ropt.offset;
        var _first = _data.offset==0;
        _data.total  = _first;
        this.__ropt.limit =
              _first?this.__first:this.__limit;
        _data.limit  = this.__ropt.limit;
        this.__cache._$getList(
            this.__doGenRequestOpt(
                _u._$merge({},this.__ropt)
            )
        );
    };
    /**
     * æ•°æ®åˆ—è¡¨è½½å…¥å®Œæˆå›žè°ƒ
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__cbListLoad
     * @param  {Object} arg0 - è¯·æ±‚ä¿¡æ¯
     * @return {Void}
     */
    _pro.__cbListLoad = function(_options){
        if (_options.key!=this.__ropt.key||
            _options.offset!=this.__ropt.offset) return;
        //console.log('list load -> '+_options.key);
        this.__doBeforeListShow();
        // check list
        var _list = this.__cache.
            _$getListInCache(_options.key);
        if (!_list||!_list.length){
            // check load error
            if (!this._$cache()._$isLoaded(_options.key)){
                this.__doShowMessage('onlistloaderror','åˆ—è¡¨åŠ è½½å¤±è´¥');
                //this._$dispatchEvent('onlistloaderror',{
                //    parent:this.__lbox
                //});
            }else{
                this.__doShowEmpty();
            }
            return !0;
        }
        // render list
        var _limit = _options.limit,
            _offset = _options.offset;
        if (!this.__cache._$isFragmentFilled(_options.key,_offset,_limit)){
            this.__doShowMessage('onlistloaderror','åˆ—è¡¨åŠ è½½å¤±è´¥');
            //this._$dispatchEvent('onlistloaderror',{
            //    parent:this.__lbox
            //});
            return !0;
        }
        if (this.__doBeforeListRender(
                  _list,_offset,_limit))
            return;
        this._$dispatchEvent('onbeforelistrender',{
            list:_list,
            limit:_limit,
            offset:_offset,
            parent:this.__lbox,
            total:this.__cache._$getTotal(_options.key)
        });
        if (!!this.__ikey){
            // render by jst
            this.__iopt.xlist = _list;
            this.__iopt.beg = _offset;
            this.__iopt.end = Math.min(_list.length,_offset+_limit)-1;
            this.__iopt.act = 'list';
            var _html = _t1._$get(
                this.__ikey,
                this.__iopt,
                this.__iext
            );
            this.__doShowListByJST(_html);
        }else{
            // render by item
            this.__iopt.limit = _limit;
            this.__iopt.offset = _offset;
            var _items = _t2._$getItemTemplate(
                         _list,this.__ikls,this.__iopt);
            this.__doShowListByItem(_items);
        }
        this._$dispatchEvent('onafterlistrender',{
            list:_list,
            limit:_limit,
            offset:_offset,
            parent:this.__lbox,
            total:this.__cache._$getTotal(_options.key)
        });
    };
    /**
     * å‰å‘åˆ·æ–°æ•°æ®åˆ—è¡¨è½½å…¥å®Œæˆå›žè°ƒ
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__cbPullRefresh
     * @param  {Object} arg0 - è¯·æ±‚ä¿¡æ¯
     * @return {Void}
     */
    _pro.__cbPullRefresh = function(_options){
        // unlock pulling
        if (!this.__pulling)
            return;
        delete this.__pulling;
        // recycle loading
        this.__doBeforeListShow('onafterpullrefresh');
        this._$refresh();
    };
    /**
     * åŒæ­¥åˆ†é¡µå™¨
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doSyncPager
     * @param  {Number}  arg0 - é¡µç ç´¢å¼•
     * @param  {Number}  arg1 - æ€»é¡µæ•°
     * @return {Boolean}        是否重置页码
     */
    _pro.__doSyncPager = function(_index,_total){
        if (!!this.__pager){
            // limit page total
            if ((this.__popt||_o).limit>0){
                _total = Math.min(
                    _total,this.__popt.limit
                );
            }
            // check pager index and total
            var _index2 = this.__pager._$getIndex(),
                _total2 = this.__pager._$getTotal();
            if (_index2>_total||_total!=_total2){
                this.__pager._$recycle();
                delete this.__pager;
                this.__doChangePage({
                    last:_index2,
                    index:Math.min(_index,_total)
                });
                return !0;
            }
        }else{
            // check pager instance
            this.__popt.index = _index;
            this.__popt.total = _total;
            this.__pager = this.__pkls._$allocate(this.__popt);
            this.__pager._$setEvent('onchange',this.__doChangePage._$bind(this));
            _u._$forEach(
                this.__pbid,function(_parent){
                    this.__pager._$bind(_parent);
                },this
            );
        }
    };
    /**
     * 格式化数据
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doFormatData
     * @param  {Object} arg0 - 数据信息
     * @return {Void}
     */
    _pro.__doFormatData = (function(){
        var _seed = +new Date;
        return function(_data){
            var _id = _data[this.__iopt.pkey];
            if (!_id){
                _data['dirty-data'] = !0;
                _data[this.__iopt.pkey] = 'dirty-'+_seed++;
            }
            return _data;
        };
    })();
    /**
     * 分离脏数据
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doSplitDirty
     * @param  {Object} arg0 - 数据信息
     * @return {String}        数据标识
     */
    _pro.__doSplitDirty = function(_data){
        var _id = _data[this.__iopt.pkey];
        if (!!_data['dirty-data']){
            delete _data['dirty-data'];
            delete _data[this.__iopt.pkey];
        }
        return _id;
    };
    /**
     * 插入单项
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__doInsertOneItem
     * @param  {String} arg0 - 插入位置
     * @param  {Object} arg1 - 数据对象
     * @return {Void}
     */
    _pro.__doInsertOneItem = (function(){
        var _doInsert = function(_pos,_body){
            this.__lbox.insertAdjacentElement(_pos,_body);
        };
        return function(_pos,_data){
            var _xlist = [_data];
            if (!!this.__ikey){
                // render by jst
                var _xlist = this.__cache._$getListInCache(
                        this.__ropt.key
                    ),
                    _index = _u._$indexOf(_xlist,_data);
                if (_index<0){
                    _index = 0;
                    _xlist = [_data];
                }
                this.__iopt.xlist = _xlist;
                this.__iopt.beg = _index;
                this.__iopt.end = _index;
                this.__iopt.act = 'add';
                this.__doShowListByJST(
                    _t1._$get(
                        this.__ikey,
                        this.__iopt,
                        this.__iext
                    ),_pos
                );
            }else{
                // render by item
                this.__iopt.limit = 1;
                this.__iopt.offset = 0;
                this.__iopt.parent =
                      _doInsert._$bind(this,_pos);
                var _items = _t2._$getItemTemplate(
                             _xlist,this.__ikls,this.__iopt);
                this.__iopt.parent = this.__lbox;
                this.__doShowListByItem(_items);
            }
            this._$dispatchEvent('onafterinsert');
        };
    })();
    /**
     * 加载数据之前处理逻辑，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doBeforeListLoad
     * @return {Void}
     */
    _pro.__doBeforeListLoad = _f;
    /**
     * 数据载入之后处理逻辑，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doBeforeListShow
     * @return {Void}
     */
    _pro.__doBeforeListShow = function(_name){
        var _event = {
            parent:this.__lbox
        };
        this._$dispatchEvent(_name||'onafterlistload',_event);
        if (!_event.stopped){
            _e._$removeByEC(this.__ntip);
        }
    };
    /**
     * 列表绘制之前处理逻辑，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doBeforeListRender
     * @return {Void}
     */
    _pro.__doBeforeListRender = _f;
    /**
     * 呈现提示信息
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doRenderMessage
     * @param  {String} arg0 - 消息内容
     * @param  {String} arg1 - 位置信息
     * @return {Void}
     */
    _pro.__doRenderMessage = function(_message,_pos){
        if (_u._$isString(_message)){
            if (!this.__ntip)
                 this.__ntip = _e._$create('div');
            this.__ntip.innerHTML = _message;
        }else{
            this.__ntip = _message;
        }
        this.__lbox.insertAdjacentElement(
            _pos||'beforeEnd',this.__ntip
        );
    };
    /**
     * 通过事件回调检测显示信息
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doShowMessage
     * @param  {String} arg0 - 事件名称
     * @param  {String} arg1 - 默认显示内容
     * @return {Void}
     */
    _pro.__doShowMessage = function(_name,_default,_pos){
        var _event = {
            parent:this.__lbox
        };
        if (!!_name){
            this._$dispatchEvent(_name,_event);
        }
        if (!_event.stopped){
            this.__doRenderMessage(
                _event.value||_default,_pos
            );
        }
    };
    /**
     * 列表为空时处理逻辑，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doShowEmpty
     * @return {Void}
     */
    _pro.__doShowEmpty = _f;
    /**
     * 以jst模版方式绘制列表，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doShowListByJST
     * @return {Void}
     */
    _pro.__doShowListByJST = _f;
    /**
     * 以item模版方式绘制列表，子类实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__doShowListByItem
     * @return {Void}
     */
    _pro.__doShowListByItem = _f;
    /**
     * 检查列表行为
     *
     * @protected
     * @method module:util/list/module._$$ListModule#__onCheckAction
     * @param  {Event} arg0 - 事件对象
     * @return {Void}
     */
    _pro.__onCheckAction = (function(){
        var _reg0 = /^(?:delete|update)$/;
        return function(_event){
            var _node = _v._$getElement(_event,'d:action');
            if (!_node) return;
            var _action = _e._$dataset(_node,'action');
            if (!_reg0.test(_action)) return;
            var _id = _e._$dataset(_node,'id');
            if (!_id) return;
            var _item = this.__cache._$getItemInCache(_id);
            if (!_item) return;
            _v._$stop(_event);
            this._$dispatchEvent('on'+_action,{
                data:_item,
                id:_item[this.__iopt.pkey],
                body:_e._$get(this.__getItemBodyId(_id))
            });
        };
    })();
    /**
     * 添加列表项回调，子类按需实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__cbItemAdd
     * @return {Void}
     */
    _pro.__cbItemAdd = _f;
    /**
     * 删除列表项
     * 
     * @protected
     * @method   module:util/list/module._$$ListModule#__doDeleteItem
     * @param    {Object} arg0 - 列表项信息
     * @property {String} id   - 项标识
     * @property {Object} data - 项绑定的数据信息
     * @return   {Void}
     */
    _pro.__doDeleteItem = function(_event){
        var _data = _event.data||{},
            _options = {
                data:_data,
                key:this.__ropt.key,
                id:_data[this.__iopt.pkey]
            };
        this._$dispatchEvent('onbeforedelete',_options);
        this.__cache._$deleteItem(_options);
    };
    /**
     * 删除列表项回调，子类按需实现具体业务逻辑
     * 
     * @abstract
     * @method module:util/list/module._$$ListModule#__cbItemDelete
     * @return {Void}
     */
    _pro.__cbItemDelete = _f;
    /**
     * 更新列表项
     * 
     * @protected
     * @method   module:util/list/module._$$ListModule#__doUpdateItem
     * @param    {Object} arg0 - 列表项信息
     * @property {String} id   - 项标识
     * @property {Object} data - 项绑定的数据信息
     * @return   {Void}
     */
    _pro.__doUpdateItem = function(_event){
        var _data = _event.data||{},
            _options = {
                data:_data,
                key:this.__ropt.key
            };
        this._$dispatchEvent('onbeforeupdate',_options);
        this.__cache._$updateItem(_options);
    };
    /**
     * 更新列表项回调，子类可按需重写具体业务逻辑
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__cbItemUpdate
     * @return {Void}
     */
    _pro.__cbItemUpdate = function(_event){
        this.__doCheckResult(_event,'onafterupdate');
        if (_event.stopped) return;
        var _id = _event.data[this.__iopt.pkey];
        if (!!this.__items){
            var _item = _t2._$getItemById(
                this.__getItemId(_id)
            );
            if (!!_item) _item._$refresh(_event.data);
        }else{
            var _node = this._$getItemBody(_id);
            if (!_node) return;
            var _list = this.__cache._$getListInCache(this.__ropt.key),
                _index = _u._$indexOf(_list,_event.data);
            if (_index<0) return;
            this.__iopt.xlist = _list;
            this.__iopt.beg  = _index;
            this.__iopt.end  = _index;
            this.__iopt.act  = 'update';
            var _html = _t1._$get(
                this.__ikey,
                this.__iopt,
                this.__iext
            );
            _node.insertAdjacentHTML('afterEnd',_html);
            _e._$remove(_node);
        }
        this._$dispatchEvent('onafterupdaterender',{
            data:_event.data,
            parent:this.__lbox
        });
    };
    /**
     * 验证操作结果
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__doCheckResult
     * @param  {Object} arg0 - 事件信息
     * @return {Void}
     */
    _pro.__doCheckResult = function(_event,_name){
        var _item = _event.data;
        if (!_item||_item[this.__iopt.pkey]==null){
            this._$dispatchEvent('onerror',_event);
            _event.stopped = !0;
        }
        if (!_event.stopped){
            this._$dispatchEvent(_name,_event);
        }
    };
    /**
     * 追加数据片段回调
     *
     * @abstract
     * @method module:util/list/module._$$ListModule#__cbAppendList
     * @param  {Number} arg0 - 偏移量
     * @param  {Number} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbAppendList = _f;
    /**
     * 前向追加数据片段回调
     *
     * @abstract
     * @method module:util/list/module._$$ListModule#__cbUnshiftList
     * @param  {Number} arg0 - 偏移量
     * @param  {Number} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbUnshiftList = _f;
    /**
     * 列表变化回调（删除/添加），子类按需实现具体业务逻辑
     * 
     * @protected
     * @method module:util/list/module._$$ListModule#__cbListChange
     * @return {Void}
     */
    _pro.__cbListChange = function(_event){
        if (!!_event.key&&
            _event.key!=this.__ropt.key){
            return;
        }
        switch(_event.action){
            case 'add':
                this.__cbItemAdd(_event);
            break;
            case 'delete':
                this.__cbItemDelete(_event);
            break;
            case 'update':
                this.__cbItemUpdate(_event);
            break;
            case 'refresh':
                this._$refresh();
            break;
            case 'unshift':
                this.__cbUnshiftList(
                    _event.offset,
                    _event.limit
                );
            break;
            case 'append':
                this.__cbAppendList(
                    _event.offset,
                    _event.limit
                );
            break;
        }
    };
    /**
     * 更新某一项数据
     * 
     * @method module:util/list/module._$$ListModule#_$update
     * @param  {Object} arg0 - 需要更新的数据
     * @return {Void}
     */
    _pro._$update = function(_item){
        this.__doUpdateItem({data:_item});
    };
    /**
     * 删除某一项数据
     * 
     * @method module:util/list/module._$$ListModule#_$delete
     * @param  {Object} arg0 - 需要删除的数据
     * @return {Void}
     */
    _pro._$delete = function(_item){
        this.__doDeleteItem({data:_item});
    };
    /**
     * 添加一项数据
     * 
     * @method module:util/list/module._$$ListModule#_$add
     * @param  {Object} arg0 - 需要添加的数据
     * @return {Void}
     */
    _pro._$add = function(_item){
        this.__cache._$addItem({
            data:_item,
            key:this.__ropt.key
        });
    };
    /**
     * 取缓存实例
     * 
     * @method module:util/list/module._$$ListModule#_$cache
     * @return {module:util/cache/list._$$CacheList} 列表缓存实例
     */
    _pro._$cache = function(){
        return this.__cache;
    };
    /**
     * 往前追加列表项
     *
     * @method module:util/list/module._$$ListModule#_$unshift
     * @param  {Object} arg0 - 数据信息
     * @return {Number}        插入项标识
     */
    _pro._$unshift = function(_data){
        this.__doInsertOneItem(
            'afterBegin',
            this.__doFormatData(_data)
        );
        return this.__doSplitDirty(_data);
    };
    /**
     * 往后追加列表项
     *
     * @method module:util/list/module._$$ListModule#_$append
     * @param  {Object} arg0 - 数据信息
     * @return {Number}        插入项标识
     */
    _pro._$append = function(_data){
        this.__doInsertOneItem(
            'beforeEnd',
            this.__doFormatData(_data)
        );
        return this.__doSplitDirty(_data);
    };
    /**
     * 刷新模块
     * 
     * @method module:util/list/module._$$ListModule#_$refresh
     * @param  {Number} arg0 - 刷新到的页码
     * @return {Void}
     */
    _pro._$refresh = function(){
        this.__doClearListBox();
        this.__doRefreshByPager();
    };
    /**
     * 先清数据再刷新模块
     * 
     * @method module:util/list/module._$$ListModule#_$refreshWithClear
     * @return {Void}
     */
    _pro._$refreshWithClear = function(){
        this.__cache._$clearListInCache(this.__ropt.key);
        this._$refresh();
    };
    /**
     * 重新加载列表
     *
     * @method module:util/list/module._$$ListModule#_$reload
     * @param  {Boolean} arg0 - 是否清除缓存数据
     * @return {Void}
     */
    _pro._$reload = function(noclear){
        if (!noclear){
            this.__cache._$clearListInCache(this.__ropt.key);
        }
        this.__doLoadList();
    };
    /**
     * 前向刷新列表
     * 
     * @method module:util/list/module._$$ListModule#_$pullRefresh
     * @return {Void}
     */
    _pro._$pullRefresh = function(){
        // lock pulling
        if (!!this.__pulling)
            return;
        this.__pulling = !0;
        // show loading
        this.__doShowMessage(
            'onbeforepullrefresh',
            '列表刷新中...','afterBegin'
        );
        // refresh data
        this.__cache._$pullRefresh({
            key:this.__ropt.key,
            data:this.__ropt.data
        });
    };
    /**
     * 取列表总数
     *
     * @method module:util/list/module._$$ListModule#_$getTotal
     * @return {Number} 列表总数
     */
    _pro._$getTotal = function(){
        return this.__cache._$getTotal(this.__ropt.key);
    };
    /**
     * 取分页器实例
     *
     * @method module:util/list/module._$$ListModule#_$getPager
     * @return {Void}
     */
    _pro._$getPager = function(){
        return this.__pager;
    };
    /**
     * 取ITEM列表
     *
     * @method module:util/list/module._$$ListModule#_$items
     * @return {Array} ITEM列表
     */
    _pro._$items = function(){
        return this.__items;
    };
    /**
     * 取列表项节点
     *
     * @method module:util/list/module._$$ListModule#_$getItemBody
     * @param  {String} arg0 - 数据标识
     * @return {Node}          节点
     */
    _pro._$getItemBody = function(_id){
        if (!!this.__ikey){
            // render by jst
            return _e._$get(
                this.__getItemBodyId(_id)
            );
        }else{
            // render by item
            var _item = _t2._$getItemById(
                this.__getItemId(_id)
            );
            if (!!_item){
                return _item._$getBody();
            }
        }
    };
    /**
     * 判断列表是否载入完成
     *
     * @method module:util/list/module._$$ListModule#_$isLoaded
     * @return {Boolean}
     */
    _pro._$isLoaded = function(){
        return this.__cache._$isLoaded(this.__ropt.key);
    };
    /**
     * 显示信息
     *
     * @method module:util/list/module._$$ListModule#_$showMessage
     * @param  {String|Node} arg0 - 消息内容
     * @return {Void}
     */
    _pro._$showMessage = function(_html){
        this.__doClearListBox();
        this.__doShowMessage(null,_html);
    };
    /**
     * 去到下一页列表
     *
     * @method module:util/list/module._$$ListModule#_$nextPage
     * @return {Boolean} 是否还有下一页
     */
    _pro._$nextPage = function(){
        if (!this.__pager){
            return;
        }
        var _index = this.__pager._$getIndex()+1,
            _total = this.__pager._$getTotal();
        _index = Math.max(1,Math.min(_index,_total));
        this._$pageTo(_index);
        return _index<_total;
    };
    /**
     * 去到上一页列表
     *
     * @method module:util/list/module._$$ListModule#_$nextPage
     * @return {Boolean} 是否还有上一页
     */
    _pro._$prevPage = function(){
        if (!this.__pager){
            return;
        }
        var _index = this.__pager._$getIndex()-1,
            _total = this.__pager._$getTotal();
        _index = Math.max(1,Math.min(_index,_total));
        this._$pageTo(_index);
        return _index<=1;
    };
    /**
     * 去到指定页码列表
     *
     * @method module:util/list/module._$$ListModule#_$pageTo
     * @param  {Number} arg0 - 指定页码
     * @return {Void}
     */
    _pro._$pageTo = function(_index){
        if (!this.__pager){
            return;
        }
        var _total = this.__pager._$getTotal();
        _index = Math.max(1,Math.min(_index,_total));
        this.__pager._$setIndex(_index);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','84e330b188e3f4b4bbdf864593ac2892','e61cba3c1c523802688888e6fbd0ccb7','b3c0f3ceba0c279f7e6de06836b8d2f0','1b12378d868a5877d4dba65367942b75','356c13c039fe43b0aa515c031d53f736','7e9128286db9a86efde148ece05b9aa0');
I$('0752ee18a1301c8319fe2e62a2b765ab',function (NEJ,_k,_v,_e,_u,_l,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 瀑布式列表模块
     * 
     * 结构举例
     * ```html
     * <div class="mbox">
     *   <div class="lbox" id="list-box">
     *     <!-- list box -->
     *   </div>
     *   <div class="mbtn" id="more-btn"> load more button </div>
     * </div>
     * 
     * <!-- list jst template -->
     * <textarea name="jst" id="jst-list">
     *   {list beg..end as y}
     *     {var x=xlist[y]}
     *     <div class="item">
               <a data-id="${x.id|x.name}" data-action="delete">删除</a>
     *       <p>姓名：${x.name}</p>
     *       <p>联系方式：${x.mobile}</p>
     *     </div>
     *   {/list}
     * </textarea>
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'base/util',
     *     'util/ajax/xdr',
     *     'util/cache/abstract'
     * ],function(_k,_u,_j,_t,_p){
     *     var _pro;
     *     // 自定义列表缓存
     *     _p._$$CustomListCache = _k._$klass();
     *     _pro = _p._$$CustomListCache._$extend(_t._$$CacheListAbstract);
     * 
     *     // 实现数据载入逻辑
     *     _pro.__doLoadList = function(_options){
     *         var _onload = _options.onload;
     *         // 补全请求数据，也可在模块层通过cache参数传入
     *         var _data = _options.data||{};
     *         _u._$merge(_data,{uid:'ww',sort:'xx',order:1});
     *         switch(_options.key){
     *                case 'user-list':
     *                    // TODO load list from server
     *                    _j._$request('/api/user/list',{
     *                        type:'json',
     *                        data:_u._$object2query(_data),
     *                        onload:function(_json){
     *                            // _json.code
     *                            // _json.result
     *                            _onload(_json.code==1?_json.result:null);
     *                        },
     *                        onerror:_onload._$bind(null);
     *                    });
     *                break;
     *                // TODO other list load
     *         }
     *     };
     * });
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     '/path/to/cache.js',
     *     'util/list/waterfall'
     * ],function(_t,_p){
     *     // 构建列表模块，使用JST模版
     *     _p._$$ListModuleWF._$allocate({
     *         limit:5,
     *         parent:'list-box',
     *         item:'jst-list', // 这里也可以传自己实现的item类型
     *         cache:{
     *             key:'user-list',// 此key必须是唯一的，对应了item中的值,也是删除选项的data-id
     *             data:{uid:'ww',sort:'xx',order:1}, // <--- 列表加载时携带数据信息，此数据也可在cache层补全
     *             klass:_t._$$CustomListCache
     *         },
     *         pager:{parent:'pager-box'}
     *     });
     * });
     * ```
     * 
     * @class   module:util/list/waterfall._$$ListModuleWF
     * @extends module:util/list/module._$$ListModule
     * 
     * @param    {Object}      config - 可选配置参数
     * @property {String|Node} more   - 添加更多列表项按钮节点
     * @property {String|Node} sbody  - 滚动条所在容器，支持onscroll事件
     * @property {Number}      delta  - 触发自动加载更多时距离滚动容器底部的偏移量，单位px，默认30
     * @property {Number}      count  - 指定加载多少次后出现分页器
     * @property {Number}      number - 初始加载次数，小于等于count数有效
     */
    _p._$$ListModuleWF = _k._$klass();
    _pro = _p._$$ListModuleWF._$extend(_t._$$ListModule);
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__reset
     * @param  {Object} arg0 - 配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__doResetMoreBtn(_options.more);
        this.__sbody = _e._$get(_options.sbody);
        this.__doInitDomEvent([[
            this.__sbody,'scroll',
            this.__onCheckScroll._$bind(this)
        ]]);
        var _delta = _options.delta;
        if (_delta==null) _delta = 30;
        this.__delta = Math.max(0,_delta);
        var _count = parseInt(_options.count)||0;
        this.__count = Math.max(0,_count);
        var _number = parseInt(_options.number)||0;
        if (_number>1&&_number<=_count){
            this.__number = _number;
        }
        this.__super(_options);
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        if (this.__stimer){
            window.clearTimeout(this.__stimer);
            delete this.__stimer;
        }
        delete this.__nmore;
        delete this.__sbody;
        delete this.__endskr;
        delete this.__nexting;
    };
    /**
     * 取当前偏移量的分页信息
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__getPageInfo
     * @param  {Number} arg0 - 偏移位置
     * @param  {Number} arg1 - 长度
     * @return {Object}        分页信息，如：{index:1,total:4}
     */
    _pro.__getPageInfo = function(_offset,_length){
        var _point = this.__first+(this.__count-1)*this.__limit,
            _limit = this.__count*this.__limit;
        return this.__super(_point,_offset,_limit,_length);
    };
    /**
     * 重置载入更多按钮
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doResetMoreBtn
     * @param  {String|Node} arg0 - 按钮节点
     * @return {Void}
     */
    _pro.__doResetMoreBtn = function(_more){
        this.__nmore = _e._$get(_more);
        this.__doInitDomEvent([[
            this.__nmore,'click',
            this._$next._$bind(this)
        ]]);
    };
    /**
     * 延时加载下一页数据
     *
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doLoadNextByTimer
     * @return {Void}
     */
    _pro.__doLoadNextByTimer = function(){
        if (!this.__endskr){
            this._$next();
        }
    };
    /**
     * 检查滚动条
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doCheckScroll
     * @return {Void}
     */
    _pro.__doCheckScroll = function(_element){
        if (this.__endskr||!_element||
           !this.__lbox.clientHeight) return;
        if (!_element.scrollHeight)
            _element = _e._$getPageBox();
        var _offset = _e._$offset(this.__lbox,this.__sbody),
            _delta = _offset.y+this.__lbox.offsetHeight-
                     _element.scrollTop-_element.clientHeight,
            _noscroll = _element.scrollHeight<=_element.clientHeight;
        if (_delta<=this.__delta||(_noscroll&&!this.__endskr)){
            // render first
            if (this.__stimer){
                window.clearTimeout(this.__stimer);
            }
            this.__stimer = window.setTimeout(
                this.__doLoadNextByTimer._$bind(this),0
            );
        }
    };
    /**
     * 检查滚动情况
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__onCheckScroll
     * @return {Void}
     */
    _pro.__onCheckScroll = function(_event){
        if (this.__endskr) return;
        var _node = _v._$getElement(_event);
        if (!_node){
            _node = _e._$getPageBox();
        }
        this.__doCheckScroll(_node);
    };
    /**
     * 页码变化处理逻辑
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doChangePage
     * @param  {Object} 页码信息
     * @return {Void}
     */
    _pro.__doChangePage = function(_event){
        this.__super(_event);
        if (!_event.stopped){
            this.__doClearListBox();
            var _offset = 0;
            if (_event.index>1){
                _offset = this.__first+((
                    _event.index-1)*this.__count-1)*this.__limit;
            }
            this.__offset = _offset;
            this._$next();
        }
    };
    /**
     * 生成请求对象信息
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doGenRequestOpt
     * @param  {Object} arg0 - 预处理请求信息
     * @return {Object}        处理后请求信息
     */
    _pro.__doGenRequestOpt = function(_options){
        if (!!this.__number){
            var _delta = _options.offset>0?this.__limit:this.__first,
                _limit = _delta+this.__limit*(this.__number-1);
            this.__offset = _options.offset+_limit;
            _options.data.limit = _limit;
            _options.limit = _limit;
            delete this.__number;
        }
        return _options;
    };
    /**
     * 数据列表载入完成回调
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbListLoad
     * @param  {Object} arg0 - 请求信息
     * @return {Void}
     */
    _pro.__cbListLoad = function(_options){
        delete this.__nexting;
        if (!this.__super(_options)){
            this._$resize();
        }
    };
    /**
     * 列表变化回调（删除/添加）
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbListChange
     * @return {Void}
     */
    _pro.__cbListChange = function(_event){
        if (!!_event.key&&
            _event.key!=this.__ropt.key){
            return;
        }
        switch(_event.action){
            case 'refresh':
            case 'append':
                delete this.__nexting;
            break;
        }
        this.__super(_event);
    };
    /**
     * 加载数据之前处理逻辑，显示数据加载中信息
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doBeforeListLoad
     * @return {Void}
     */
    _pro.__doBeforeListLoad = function(){
        this.__doShowMessage('onbeforelistload','列表加载中...');
        _e._$setStyle(this.__nmore,'display','none');
    };
    /**
     * 列表绘制之前处理逻辑
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doBeforeListRender
     * @return {Void}
     */
    _pro.__doBeforeListRender = function(_list,_offset,_limit){
        var _length = _list.length,
            _ended = _list.loaded
                   ? _offset+_limit>=_length
                   : _offset+_limit>_length;
        this.__offset = Math.min(this.__offset,_length);
        _e._$setStyle(this.__nmore,'display',_ended?'none':'');
        if (_ended) this.__endskr = !0;
        if (this.__count>0){
            // check pager
            var _info = this.__getPageInfo(_offset,_list.length);
            if (this.__doSyncPager(_info.index,_info.total)) return !0;
            // check scroll end
            var _delta = this.__first-this.__limit,
                _number = this.__count*this.__limit;
            this.__endskr = (_offset+_limit-_delta)%_number==0||_ended;
            // sync more button and pager
            _e._$setStyle(
                this.__nmore,'display',
                this.__endskr?'none':''
            );
            this.__doSwitchPagerShow(
                this.__endskr&&_info.total>1?'':'none'
            );
        }
    };
    /**
     * 列表为空时处理逻辑
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doShowEmpty
     * @return {Void}
     */
    _pro.__doShowEmpty = function(){
        this.__offset = 0;
        this.__endskr = !0;
        this.__doShowMessage('onemptylist','没有列表数据！');
    };
    /**
     * 以jst模版方式绘制列表
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doShowListByJST
     * @return {Void}
     */
    _pro.__doShowListByJST = function(_html,_pos){
        this.__lbox.insertAdjacentHTML(_pos||'beforeEnd',_html);
    };
    /**
     * 以item模版方式绘制列表
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__doShowListByItem
     * @return {Void}
     */
    _pro.__doShowListByItem = function(_items){
        this.__items = this.__items||[];
        if (_u._$isArray(_items)){
            _r.push.apply(this.__items,_items);
        }else{
            this.__items.push(_items);
        }
    };
    /**
     * 添加列表项回调
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbItemAdd
     * @return {Void}
     */
    _pro.__cbItemAdd = function(_event){
        _e._$removeByEC(this.__ntip);
        this.__doCheckResult(_event,'onafteradd');
        var _flag = _event.flag;
        if (_event.stopped||!_flag) return;
        // with pager
        if (this.__count>0){
            this.__doRefreshByPager();
            return;
        }
        // without pager
        this.__offset += 1;
        _flag==-1 ? this._$unshift(_event.data)
                  : this._$append(_event.data);
    };
    /**
     * 删除列表项回调
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbItemDelete
     * @return {Void}
     */
    _pro.__cbItemDelete = function(_event){
        this.__doCheckResult(_event,'onafterdelete');
        if (_event.stopped) return;
        // with pager
        if (this.__count>0){
            this.__doRefreshByPager();
            return;
        }
        // without pager
        var _id = _event.data[this.__iopt.pkey];
        if (!!this.__items){
            var _item = _l._$getItemById(
                    this.__getItemId(_id)
                ),
                _index = _u._$indexOf(this.__items,_item);
            if (_index>=0){
                this.__items.splice(_index,1);
                this.__offset -= 1;
            }
            if (!!_item) _item._$recycle();
        }else{
            var _node = this._$getItemBody(_id);
            if (!!_node) this.__offset -= 1;
            _e._$remove(_node);
        }
        if (this.__offset<=0) this._$next();
    };
    /**
     * 批量添加回调
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbAppendList
     * @param  {Object} arg0 - 偏移量
     * @param  {Object} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbAppendList = function(_offset,_limit){
        if (_offset!=this.__offset) return;
        // check list loaded
        if (this._$isLoaded()){
            this.__endskr = !1;
            this._$resize();
        }
    };
    /**
     * 前向追加数据片段回调
     * 
     * @protected
     * @method module:util/list/waterfall._$$ListModuleWF#__cbUnshiftList
     * @param  {Number} arg0 - 偏移量
     * @param  {Number} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbUnshiftList = function(_offset,_limit){
        if (_offset!=0) return;
        var _xlist = this.__cache._$getListInCache(
            this.__ropt.key
        );
        for(var i=_limit-1;i>=0;i--){
            this._$unshift(_xlist[i]);
        }
    };
    /**
     * 重置大小触发滚动条修正
     * 
     * @method module:util/list/waterfall._$$ListModuleWF#_$resize
     * @return {Void}
     */
    _pro._$resize = function(){
        // if not scroll check next
        var _element = this.__sbody;
        if (!_element||this.__endskr) return;
        this.__doCheckScroll(this.__sbody);
    };
    /**
     * 刷新模块
     * 
     * @method module:util/list/waterfall._$$ListModuleWF#_$refresh
     * @param  {Number} 刷新到的页码
     * @return {Void}
     */
    _pro._$refresh = function(){
        delete this.__endskr;
        this.__super();
    };
    /**
     * 载入更多列表
     * 
     * @method module:util/list/waterfall._$$ListModuleWF#_$next
     * @return {Void}
     */
    _pro._$next = function(){
        // lock loading
        if (!!this.__nexting) 
            return;
        this.__nexting = !0;
        // update offset first for
        // offset adjust after list loaded
        var _offset = this.__offset;
        this.__offset += _offset==0?
            this.__first:this.__limit;
        this.__doChangeOffset(_offset);
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','356c13c039fe43b0aa515c031d53f736','bbd2b03b4721a770fd4204d16daa8889');
I$('345b7b306420ccf5a4eca0ed182f897c',"{list beg..end as y}\n{var x=xlist[y]}\n<div class=\"m-act-item\">\n    <div class=\"m-act-circle\"><div class=\"u-circle\"></div></div>\n    <div class=\"u-act-name\" title=\"${x.realname|escape}\">${x.realname|escape}</div>\n    <div class=\"u-act-time\" title='${x.createTime|format:\"yyyy-MM-dd HH:mm:ss\"}'>${x.createTime|format:\"yyyy-MM-dd HH:mm:ss\"}</div>\n    <div class=\"u-act-con\" title=\"${x.opContent|escape}\">${x.opContent|escape}</div>\n    <div class=\"u-line\"></div>\n</div>\n{/list}");
I$('b35785bffb72b2d34ab8e670efe2381e',".m-activitylist{\n\tflex:1;\n\twidth:100%;\n}\n.m-activitylist .m-empty{\n\tmargin:100px auto 0;\n\ttext-align:center;\n}\n.m-activitylist .m-empty .u-empty-tip{\n\tmargin-top:10px;\n\tfont-size:12px;\n\tcolor:#999;\n\tdisplay:block;\n}\n.m-activitylist .m-act-item{\n\tfont-size:12px;\n\tpadding:0 0 20px 10px;\n\tmargin-left:4px;\n\tposition:relative;\n}\n.m-activitylist .u-act-name{\n\tcolor:#222;\n\tfont-weight:bold;\n\tline-height:20px;\n}\n.m-activitylist .u-act-time{\n\tfont-size:12px;\n\tcolor:#999;\n\theight:18px;\n\tmargin-bottom:4px;\n}\n.m-activitylist .u-act-con{\n\tcolor:#666;\n\tline-height:1.5em;\n}\n.m-activitylist .m-act-circle{\n\tposition:absolute;\n\tpadding:5px 0;\n\tleft:-4px;\n\ttop:2px;\n}\n.m-activitylist .m-act-circle .u-circle{\n\tborder:2px solid #b2b2b2;\n\tborder-radius:50%;\n\theight:4px;\n\twidth:4px;\n}\n.m-activitylist .u-line{\n\tposition:absolute;\n\ttop:20px;\n\tbottom:0;\n\tleft:-1px;\n\tborder-left:1px solid #e6e6e6;\n}\n.m-act-pager{\n\tmargin-right:20px !important;\n}");
I$('32da4b2b028c6524dcc4077768b486b2',function (_k, _e, _v, _u, _j, _m, _w, _html, _css, _c, _p, _pro) {
    /**
     * 动态列表模块
     * @class   {wd.m._$$ModuleActivityList}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  可选配置参数，已处理参数列表如下所示
     */
    _p._$$ModuleActivityList = _k._$klass();
    _pro = _p._$$ModuleActivityList._$extend(_m._$$Module);
    /**
     * 构建模块
     * @return {Void}
     */
    _pro.__doBuild = function () {
        _e._$addStyle(_css);
        this.__jstKey = _j._$add(_html);
        this.__emptyHtml = '<div class="m-empty"><i class="u-empty-icon u-icon-no-dynamic-normal"></i>' +
            '<span class="u-empty-tip">无动态数据</span></div>';
    };
    /**
     * 刷新模块
     * @param  {Object} 配置信息
     * @return {Void}
     */
    _pro.__reset = function (_options) {
        _e._$clearChildren(_options.parent);
        var listNode = _e._$create('div', 'm-activitylist', _options.parent);
        this.__super(_options);
        var data = {};
        if (_options.id) {
            data.id = _options.id;
        }
        var hasPager = _options.hasPager == undefined ? true : _options.hasPager; //是否需要分页器，默认有分页器
        this.__mopt = {
            limit: 10,
            sbody: _options.sbody || _options.parent,
            parent: listNode,
            item: this.__jstKey,
            cache: {
                lkey: _options.id ? _options.key + '-' + _options.id : _options.key,
                klass: _c._$$CacheActivity,
                data: data,
                clear: true,
                ext: {
                    key: _options.key //用来判断获取请求url参数
                }
            },

            onemptylist: function (event) { //列表为空时显示内容
                listNode.innerHTML = this.__emptyHtml;
                event.stopped = true;
            }.bind(this)
        };
        if (hasPager) {
            var pagerNode = _e._$create('div', 'm-page-box', _options.parent);
            _u._$merge(this.__mopt, {
                count: _options.count ? _options.count : 3,
                pager: {
                    parent: pagerNode,
                    clazz: 'm-act-pager m-pager',
                    index: 1,
                    label: {
                        prev: '<span>上一页</span><i class="zprv-icon u-icon-arrow-left-normal normal">' +
                        '</i><i class="zprv-icon u-icon-arrow-left-hover hover"></i>' +
                        '<i class="zprv-icon u-icon-arrow-left-unable unable"></i>',
                        next: '<span>下一页</span><i class="znxt-icon u-icon-arrow-right-normal normal"></i>' +
                        '<i class="znxt-icon u-icon-arrow-right-hover hover"></i>' +
                        '<i class="znxt-icon u-icon-arrow-right-unable unable"></i>'
                    }
                }
            });
        }
        this.__list = _w._$$ListModuleWF._$allocate(this.__mopt);
    };
    /**
     * 控件回收
     */
    _pro.__destroy = function () {
        this.__list && this.__list._$recycle();
        this.__list = null;
        this.__super();
    }
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','1b12378d868a5877d4dba65367942b75','c946055836c26441b9d60b589f2e1581','0752ee18a1301c8319fe2e62a2b765ab','345b7b306420ccf5a4eca0ed182f897c','b35785bffb72b2d34ab8e670efe2381e','7de92aae3e26e733b4a3773f1128f398');
I$('dcbf7d53a993157ad92a14baef983434',".upload{\n\tposition:absolute;\n\tz-index:3;\n\tcursor:pointer;\n\topacity:0;\n\ttop:0;\n\tleft:0;\n\twidth:54px;\n\theight:54px;\n}");
I$('93468315cf706676ab01f39f69664fd9',"<input type=\"file\" class=\"upload\" accept=\"image/*\" on-change ={this.uploadFile($event)}>");
I$('3739ca9efa70543a5da79674f1faf888',function (base, v, u, e, _,j,Notify,cache, css, tpl) {
    e._$addStyle(css);
    var Upload = base.extend({
        name:"upload-file",
        template:tpl,
        config:function (data) {
            _._$extend(this.data,{});
            this.supr();
            this.__cache = cache._$$Cache._$allocate({
                ontokensload:function (options) {
                    var tokens = this.__cache._$getDataInCache(options.key);
                    var formData = new FormData();
                    formData.append('x-nos-token', tokens[0].token);
                    formData.append('Object', tokens[0].key);
                    formData.append('file',options.ext.file);
                    var opt = {
                        method:"post",
                        data:formData,
                        headers:{'Content-Type': 'multipart/form-data'},
                        type:"json",
                        onload:function (data) {
                            data.url =  data.url.replace(/^http:\/\/nos\.netease\.com:80/, 'https://nos.netease.com:443');
                            this.$emit("change",{
                                file:data.url
                            })
                        }._$bind(this),
                        onerror:function (data) {
                            Notify.error("上传失败");
                            this.$emit("error");
                        }._$bind(this)
                    }
                    j._$request('https://nos.netease.com/nei',opt);
                }._$bind(this)
            });
        },
        init:function (data) {
            this.supr();
            
        },
        uploadFile:function (event) {
            var file = event.target.files[0];
            if(!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(file.name)){
                Notify.error("请上传图片文件");
                return;
            }
            this.__cache._$getTokens({
                key: "upload-file-image",
                ext:{file:file}
            });
        }
    });
    return Upload;

},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','19b4ef9670142281a6ff17ec75864bee','afb57ef5a0e0ee34baead79fa46d3e43','c6dbf51c390a9de703c7bf6c9b46ff41','dcbf7d53a993157ad92a14baef983434','93468315cf706676ab01f39f69664fd9');
I$('314ce3929c7fdec7cc1e47d9720c3fca',function (_rb, _u, _cu, _dbConst, _proCache, _pgCache,_p){
	_p.Component = _rb.extend({
		config: function(data){
			!this.data.privilege.isOthers && this.resetTop();
		},
		init: function(){
			this.$on('list-change', this.changeData.bind(this));
            this.$on('url-change', this.changeData.bind(this));
            this.$on('update', this.updateData.bind(this));
		},
		resetTop: function(){
			this.__proCache = _proCache._$$CachePro._$allocate({});
			this.__pgCache = _pgCache._$$CacheProGroup._$allocate({});
			this.resetLogo();
			this.data.commonPros = [].concat(this.data.projects);
            this.data.pubPro = {};
			this.data.topPro = [];
			this.data.noTopPro = [];
			//projectTopList字段为置顶id，字符串转数组操作
			if(this.data.progroup.projectTopList.constructor == Array){
				this.data.projectTopList = [].concat(this.data.progroup.projectTopList);
			}else{
				this.data.projectTopList = this.data.progroup.projectTopList;
				//吧projectTopList对象转化为数组
				if(this.data.projectTopList == ''){
					this.data.projectTopList = [];
				}else if(this.data.projectTopList.indexOf(',') == '-1'){
					this.data.projectTopList = [this.data.projectTopList];
				} else{
					this.data.projectTopList =  this.data.projectTopList.split(',');
				}
			}
			//区分置顶非置顶和公共数组
			_u._$forEach(this.data.projects, function(item){
				item.time = item.createTime;
				//匹配头像http请求为https
				if(item.logo){
					item.logo = item.logo.replace(/^http:\/\/nos\.netease\.com:80/, 'https://nos.netease.com:443');
				}
				if(this.data.privilege.isAdminOrCreator){
					item.showDelete = true;
					item.showStick = true;
					item.showUpload = true;
				}else{
					item.showDelete = false;
					item.showStick = false;
					item.showUpload = false;
				}
				if(item.type == 1){
					this.data.pubPro = item;
				}else if(this.data.projectTopList.indexOf(item.id.toString()) != -1){
					item.isTop = 1;
					this.data.topPro.push(item);
				}else{
					this.data.noTopPro.push(item);
				}
			}._$bind(this));
			this.$update();
		},
		resetLogo: function(){
			_cu._$resetLogo(this.data.projects, 'name', 'namePinyin');
		},
		//添加之后重新排序
		sortProAfterAdd: function(){
			var projectOrder = this.data.progroup.projectOrder;
			var sorttype = '';
			//排序取得当前sorttype
			var sorttype = _cu.__initOrder(projectOrder, sorttype);
			this.data.sortType = sorttype;
			if(!sorttype) return;
			if (!this.data.projects) return;
			var tag = sorttype.split('-')[0];
			//进行具体的排序操作
			var _afterSortData =  _cu.__sortByField(tag, this.data.sortType, this.data.topPro, this.data.noTopPro, this.data.pubPro,false);
			this.data.sortType = _afterSortData.sortType;
			//发送请求
			this.__proCache._$sort({
				ids: _afterSortData.pids,
				type: _afterSortData.typeNum,
				pgId: this.data.progroup.id,
				key: this.__proCache._$getListKey(this.data.progroup.id),
				ext:{progroupId:  this.data.progroup.id}
			});
		},
		changeData: function(_data,_progroup,type){
			this.data.projects = _data;
			this.data.progroup = _progroup;
			this.resetTop();
			if(type == 'add'){
				this.sortProAfterAdd();
			}
			this.$update();
		},
		updateData: function(_data){
            if(!_data){
                return;
            }
            _u._$forEach(this.data.projects,function(item){
                if(item.id === _data.id){
                    item.name = _data.name;
                    item.description = _data.description;
	                item.logo = _data.logo;
                }
            });
			this.$update();
		},
	});
	return _p.Component;
},'ffa820b4cb293ae990489967d5c4a899','3ff9c25bd81a3c2a260c28122918263a','8cbc286a7834dfcf29c8f7a018e77c02','993671841dcf289096c7171d53130309','09437bf7199eb808a35a38e5178e5151','e8507450a35f1adad6e9dae810fd545a');
I$('a2f43d780ca342e6aa54bd65b3e6a09a',"<div class=\"cardlist\">\n\t<div class=\"res-head\">\n\t\t{#if title !== ''}\n\t\t\t<div class=\"title\">\n\t\t\t\t{title}\n\t\t\t</div>\n\t\t{/if}\n\t\t{#if sortable}\n\t\t\t<div class=\"res-sort {sortType}\">\n\t\t\t\t{#list sortlist as item}\n\t\t\t\t\t<a onselectstart='return false' class=\"j-sort sort{item.type}\" on-click={this.sort(item.type)}>\n\t\t\t\t\t\t<span>{item.name}</span>\n\t\t\t\t\t\t<div class=\"j-sort-flag u-icon-arrow-up-normal-2\"></div>\n\t\t\t\t\t\t<div class=\"j-sort-flag u-icon-arrow-up-hover\"></div>\n\t\t\t\t\t\t<div class=\"j-sort-flag u-icon-arrow-down-normal-2\"></div>\n\t\t\t\t\t\t<div class=\"j-sort-flag u-icon-arrow-down-hover\"></div>\n\t\t\t\t\t</a>\n\t\t\t\t{/list}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n\t<div class=\"res-ul\">\n\t\t<ul class=\"res-list f-cb\">\n\t\t\t{#if hasStickList}\n\t\t\t\t{#list toplist as tp}\n\t\t\t\t\t<li class=\"res-item item-top drag-li \" data-res-id='{tp.id}' data-res-type={type}>\n\t\t\t\t\t\t<div class=\"item-part\">\n\t\t\t\t\t\t\t<div class=\"item-info item-title\">\n\t\t\t\t\t\t\t\t\t<div class=\"icon-wrap\">\n\t\t\t\t\t\t\t\t\t\t{#if tp.showStick}\n\t\t\t\t\t                        <span class='top-tag' on-click={this.top(tp)}>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"j-tag top-txt-1\">置顶</i>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"j-tag top-txt-2\">取消置顶</i>\n\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t<span class='top-tag'>置顶</span>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t                        <span class=\"j-tag delete-tag u-icon-delete-normal\" r-class={{'f-dn-important':!tp.showDelete}}\n\t\t\t\t                              data-action={tp.actionData}></span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"info-main\">\n\t\t\t\t\t\t\t\t\t{#if tp.showUpload}\n\t\t\t\t\t\t\t\t\t\t{#if tp.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {tp.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, tp)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{tp.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({tp.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, tp)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t{#if tp.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {tp.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{tp.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({tp.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#if !!countable && resType == 3}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/progroup/detail?pgid={tp.id}\" title=\"{tp.name}\">{tp.name}({tp.count})</a>\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/project?pid={tp.id}\" title=\"{tp.name}\">{tp.name}</a>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-info item-desc\">\n\t\t\t\t\t\t\t\t{#if tp.description !== ''}\n\t\t\t\t\t\t\t\t\t{tp.description}\n\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t<p class=\"f-italic\">暂无描述</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{#if hasQuickEntrence}\n\t\t\t\t\t\t\t\t<div class=\"quickentrence\">\n\t\t\t\t\t\t\t\t\t<div class=\"wrapsource\">\n\t\t\t\t\t\t\t\t\t\t{#list entranceList as entrance}\n\t\t\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/{entrance.type}/?pid={tp.id}\">{entrance.name}</a>\n\t\t\t\t\t\t\t\t\t\t{/list}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/list}\n\t\t\t\t{#list noToplist as np}\n\t\t\t\t\t<li class=\"res-item item-normal drag-li \" data-res-id='{np.id}' data-res-type={type}>\n\t\t\t\t\t\t<div class=\"item-part\">\n\t\t\t\t\t\t\t<div class=\"item-info item-title\">\n\t\t\t\t\t\t\t\t<div class=\"icon-wrap\">\n\t\t\t\t\t\t\t\t\t{#if np.showStick}\n\t\t\t\t                        <span class='top-tag' on-click={this.top(np)}>\n\t\t\t\t\t\t\t\t\t\t\t<i class=\"j-tag u-icon-top-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<span class=\"j-tag delete-tag u-icon-delete-normal\" r-class={{'f-dn-important':!np.showDelete}}\n\t\t\t\t                              data-action={np.actionData}></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"info-main\">\n\t\t\t\t\t\t\t\t\t{#if np.showUpload}\n\t\t\t\t\t\t\t\t\t\t{#if np.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {np.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event,np)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{np.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({np.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, np)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t{#if np.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {np.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{np.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({np.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#if countable && resType == 3}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/progroup/detail?pgid={np.id}\" title=\"{np.name}\">{np.name}({np.count})</a>\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/project?pid={np.id}\" title=\"{np.name}\">{np.name}</a>\n\t\t\t\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-info item-desc\">\n\t\t\t\t\t\t\t\t{#if np.description != ''}\n\t\t\t\t\t\t\t\t\t{np.description}\n\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t<p class=\"f-italic\">暂无描述</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{#if hasQuickEntrence}\n\t\t\t\t\t\t\t\t<div class=\"quickentrence\">\n\t\t\t\t\t\t\t\t\t<div class=\"wrapsource\">\n\t\t\t\t\t\t\t\t\t\t{#list entranceList as entrance}\n\t\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/{entrance.type}/?pid={np.id}\">{entrance.name}</a>\n\t\t\t\t\t\t\t\t\t\t{/list}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/list}\n\t\t\t\t{#list publist as pub}\n\t\t\t\t\t<li class=\"res-item item-pub drag-li \" data-res-id='{pub.id}' data-res-type={type}>\n\t\t\t\t\t\t<div class=\"item-part\">\n\t\t\t\t\t\t\t<div class=\"item-info item-title\">\n\t\t\t\t\t\t\t\t<div class=\"icon-wrap\">\n\t\t\t\t\t\t\t\t\t<span class='j-tag top-tag'>公共</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"info-main\">\n\t\t\t\t\t\t\t\t\t{#if pub.showUpload}\n\t\t\t\t\t\t\t\t\t\t{#if pub.logo=== ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {pub.bgClassName}\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, pub)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{pub.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo \" style=\"background-image:url({pub.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, pub)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t{#if pub.logo=== ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {pub.bgClassName}\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{pub.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo \" style=\"background-image:url({pub.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#if countable && resType == 3}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/progroup/detail?pgid={pub.id}\" title=\"{pub.name}\">{pub.name}({pub.count})</a>\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/project?pid={pub.id}\" title=\"{pub.name}\">{pub.name}</a>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-info item-desc\">\n\t\t\t\t\t\t\t\t{#if pub.description !== ''}\n\t\t\t\t\t\t\t\t\t{pub.description}\n\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t<p class=\"f-italic\">暂无描述</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{#if resType != 3}\n\t\t\t\t\t\t\t\t<div class=\"quickentrence\">\n\t\t\t\t\t\t\t\t\t<div class=\"wrapsource\">\n\t\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/interface/?pid={pub.id}\">接口</a>\n\t\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/datatype/?pid={pub.id}\">模型</a>\n\t\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/constraint/?pid={pub.id}\" >规则</a>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/list}\n\t\t\t{#else}\n\t\t\t<!-- 没有置顶非置顶的列表  -->\n\t\t\t\t{#list noSticklist as item}\n\t\t\t\t\t<li class=\"res-item item-normal drag-li \" data-res-id='{item.id}' data-res-type='project'>\n\t\t\t\t\t\t<div class=\"item-part\">\n\t\t\t\t\t\t\t<div class=\"item-info item-title\">\n\t\t\t\t\t\t\t\t<div class=\"info-main\">\n\t\t\t\t\t\t\t\t\t{#if item.showBelong.flag}\n\t\t\t\t\t\t\t\t\t\t<div class=\"belong\">item.showBelong.belong</div>\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#if item.showUpload}\n\t\t\t\t\t\t\t\t\t\t{#if item.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {item.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, item)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{item.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({item.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t\t<upload-file on-change={this._change($event, item)}></upload-file>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"icon\" >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"u-icon-upload-avartar-normal\"></i>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t{#if item.logo === ''}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo {item.bgClassName}\"  >\n\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"txt\">{item.letterText}</span>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"info-logo\" style=\"background-image:url({item.logo})\" >\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<a class=\"item-link stateful\" href=\"/project?pid={item.id}\" title=\"{item.name}\">{item.name}</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"item-info item-desc\">\n\t\t\t\t\t\t\t\t{#if item.description != ''}\n\t\t\t\t\t\t\t\t\t{item.description}\n\t\t\t\t\t\t\t\t{#else}\n\t\t\t\t\t\t\t\t\t<p class=\"f-italic\">暂无描述</p>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"quickentrence\">\n\t\t\t\t\t\t\t\t<div class=\"wrapsource\">\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/page/?pid={item.id}\">页面</a>\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/interface/?pid={item.id}\">接口</a>\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/datatype/?pid={item.id}\">模型</a>\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/template/?pid={item.id}\">模板</a>\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/constraint/?pid={item.id}\" >规则</a>\n\t\t\t\t\t\t\t\t\t<a class=\"resource stateful\" href=\"/group/?pid={item.id}\">分组</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t{/list}\n\t\t\t{/if}\n\t\t\t{#if addable}\n\t\t\t\t<li class=\"res-add res-item\" data-action={addResActionData}>\n\t\t\t\t\t<div class=\"res-add-part\">\n\t\t\t\t\t\t<i class=\"u-icon-add-project\"></i>\n\t\t\t\t\t\t<i class=\"u-icon-add-project-hover\"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t{/if}\n\t\t</ul>\n\t</div>\n</div>");
I$('c545b16590e101fef1bfa51d6d7ca79a',".res-head{width:100%;height:30px;line-height:30px;margin-top:20px;}.res-head .title{font-size:18px;color:#333;float:left;}.res-head .res-sort.name-up .sortname{color:#30a1f2;background-color:#f8f8f8;font-size:0;}.res-head .res-sort.name-up .sortname span{font-size:12px;vertical-align:middle;}.res-head .res-sort.name-up .sortname .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.name-up .sortname .u-icon-arrow-up-normal-2,.res-head .res-sort.name-up .sortname .u-icon-arrow-down-normal-2,.res-head .res-sort.name-up .sortname .u-icon-arrow-down-hover{display:none !important;}.res-head .res-sort.name-up .sortname:hover{color:#30a1f2;}.res-head .res-sort.name-up .sortname:hover .u-icon-arrow-up-normal-2{display:none;}.res-head .res-sort.name-up .sortname:hover .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.name-down .sortname{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.name-down .sortname .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort.name-down .sortname .u-icon-arrow-down-normal-2,.res-head .res-sort.name-down .sortname .u-icon-arrow-up-normal-2,.res-head .res-sort.name-down .sortname .u-icon-arrow-up-hover{display:none !important;}.res-head .res-sort.name-down .sortname:hover{color:#30a1f2;}.res-head .res-sort.name-down .sortname:hover .u-icon-arrow-down-normal-2{display:none;}.res-head .res-sort.name-down .sortname:hover .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort.count-up .sortcount{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.count-up .sortcount .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.count-up .sortcount .u-icon-arrow-up-normal-2,.res-head .res-sort.count-up .sortcount .u-icon-arrow-down-normal-2,.res-head .res-sort.count-up .sortcount .u-icon-arrow-down-hover{display:none !important;}.res-head .res-sort.count-up .sortcount:hover{color:#30a1f2;}.res-head .res-sort.count-up .sortcount:hover .u-icon-arrow-up-normal-2{display:none;}.res-head .res-sort.count-up .sortcount:hover .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.count-down .sortcount{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.count-down .sortcount .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort.count-down .sortcount .u-icon-arrow-down-normal-2,.res-head .res-sort.count-down .sortcount .u-icon-arrow-up-normal-2,.res-head .res-sort.count-down .sortcount .u-icon-arrow-up-hover{display:none !important;}.res-head .res-sort.count-down .sortcount:hover{color:#30a1f2;}.res-head .res-sort.count-down .sortcount:hover .u-icon-arrow-down-normal-2{display:none;}.res-head .res-sort.count-down .sortcount:hover .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort.name-up .sortname{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.name-up .sortname .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.name-up .sortname .u-icon-arrow-up-normal-2,.res-head .res-sort.name-up .sortname .u-icon-arrow-down-normal-2,.res-head .res-sort.name-up .sortname .u-icon-arrow-down-hover{display:none !important;}.res-head .res-sort.name-up .sortname:hover{color:#30a1f2;}.res-head .res-sort.name-up .sortname:hover .u-icon-arrow-up-normal-2{display:none;}.res-head .res-sort.name-up .sortname:hover .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.time-up .sorttime{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.time-up .sorttime .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.time-up .sorttime .u-icon-arrow-down-normal-2,.res-head .res-sort.time-up .sorttime .u-icon-arrow-up-normal-2,.res-head .res-sort.time-up .sorttime .u-icon-arrow-down-hover{display:none !important;}.res-head .res-sort.time-up .sorttime:hover{color:#30a1f2;}.res-head .res-sort.time-up .sorttime:hover .u-icon-arrow-up-normal-2{display:none;}.res-head .res-sort.time-up .sorttime:hover .u-icon-arrow-up-hover{display:inline-block;}.res-head .res-sort.time-down .sorttime{color:#30a1f2;background-color:#f8f8f8;}.res-head .res-sort.time-down .sorttime .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort.time-down .sorttime .u-icon-arrow-down-normal-2,.res-head .res-sort.time-down .sorttime .u-icon-arrow-up-normal-2,.res-head .res-sort.time-down .sorttime .u-icon-arrow-up-hover{display:none !important;}.res-head .res-sort.time-down .sorttime:hover{color:#30a1f2;}.res-head .res-sort.time-down .sorttime:hover .u-icon-arrow-down-normal-2{display:none;}.res-head .res-sort.time-down .sorttime:hover .u-icon-arrow-down-hover{display:inline-block;}.res-head .res-sort{float:right;height:30px;border:1px solid #e6e6e6;background-color:#fff;}.res-head .res-sort .j-sort{float:left;display:block;font-size:0;padding:0 10px;height:30px;color:#666;}.res-head .res-sort .j-sort span{font-size:12px;vertical-align:middle;}.res-head .res-sort .j-sort:last-child{margin-left:-4px;}.res-head .res-sort .j-sort:hover{background-color:#f8f8f8;}.res-head .res-sort .j-sort .j-sort-flag{margin-top:-1px;}.res-head .res-sort .j-sort .u-icon-arrow-up-normal-2{display:inline-block;}.res-head .res-sort .j-sort .u-icon-arrow-down-hover,.res-head .res-sort .j-sort .u-icon-arrow-down-normal-2,.res-head .res-sort .j-sort .u-icon-arrow-up-hover{display:none;}.res-head .res-sort .j-sort .u-icon-arrow-up-normal-2,.res-head .res-sort .j-sort .u-icon-arrow-down-hover,.res-head .res-sort .j-sort .u-icon-arrow-down-normal-2,.res-head .res-sort .j-sort .u-icon-arrow-up-hover{margin-left:3px;}.res-ul{display:flex;width:100%;box-sizing:border-box;}.res-ul .res-list{flex:1;margin-left:-15px;display:flex;flex-flow:row wrap;justify-content:flex-start;}.res-ul .res-item.j-border{border:1px #000 dashed;background:#f5f5f5;}.res-ul .res-item.res-top,.res-ul .res-item.res-pub{cursor:default;}.res-ul .res-item{display:block;flex:0 1 25%;cursor:move;float:left;position:relative;box-sizing:border-box;height:201px;margin-top:15px;padding-left:15px;}.res-ul .res-item:hover .item-part{position:relative;box-shadow:2px 2px 8px 2px #ddd;z-index:2;border:1px solid #30a1f2;}.res-ul .res-item:hover .item-part .item-title .u-icon-top-normal,.res-ul .res-item:hover .item-part .item-title .delete-tag{display:inline-block;float:right;}.res-ul .res-item:hover .item-part .quickentrence{bottom:0px;}.res-ul .res-item .item-part{position:relative;overflow:hidden;box-sizing:border-box;width:100%;height:100%;padding:0 20px;background:#fff;border:1px solid #e6e6e6;transition:transform 0.3s;}.res-ul .res-item .item-part .item-info{width:100%;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-sizing:border-box;}.res-ul .res-item .item-part .item-title{position:relative;padding:20px 0;font-size:16px;border-bottom:1px solid #e6e6e6;color:#333;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.res-ul .res-item .item-part .item-title .item-link{display:inline-block;width:75%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#333;font-size:14px;padding-top:4px;}.res-ul .res-item .item-part .item-title .item-link:hover{color:#30a1f2;}.res-ul .res-item .item-part .item-title .top-tag{display:inline-block;color:#9fa3da;cursor:pointer;font-size:12px;}.res-ul .res-item .item-part .item-title .top-tag .top-txt-2,.res-ul .res-item .item-part .item-title .top-tag .top-txt-1{line-height:22px;}.res-ul .res-item .item-part .item-title .top-tag .top-txt-2{width:53px;display:none;}.res-ul .res-item .item-part .item-title .top-tag:hover .top-txt-2{display:inline-block;}.res-ul .res-item .item-part .item-title .top-tag:hover .top-txt-1{display:none;}.res-ul .res-item .item-part .item-title .u-icon-top-normal{display:none;cursor:pointer;}.res-ul .res-item .item-part .item-title .delete-tag{display:none;cursor:pointer;}.res-ul .res-item .item-part .item-title .icon-wrap{position:absolute;width:120px;top:20px;right:0;text-align:right;}.res-ul .res-item .item-part .item-title .info-main{margin:0 auto;text-align:center;}.res-ul .res-item .item-part .item-title .info-logo{position:relative;overflow:hidden;width:54px;height:54px;border-radius:50%;margin:0 auto;background-size:100%;background-position:50% 50%;background-repeat:no-repeat;}.res-ul .res-item .item-part .item-title .info-logo .logo{width:54px;height:54px;}.res-ul .res-item .item-part .item-title .info-logo .upload{position:absolute;z-index:3;cursor:pointer;opacity:0;top:0;left:0;width:54px;height:54px;}.res-ul .res-item .item-part .item-title .info-logo .txt{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:16px;color:#222;}.res-ul .res-item .item-part .item-title .info-logo .icon{position:absolute;display:none;top:50%;left:50%;margin:-27px 0 0 -27px;width:100%;height:100%;background:rgba(0,0,0,0.5);}.res-ul .res-item .item-part .item-title .info-logo:hover .icon{display:block;cursor:pointer;}.res-ul .res-item .item-part .item-desc{display:-webkit-box;height:40px;font-size:14px;color:#666;margin:18px 0;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}.res-ul .res-item .item-part .quickentrence{position:absolute;width:100%;height:76px;bottom:-76px;left:0px;box-sizing:border-box;background:rgba(0,0,0,0.6);transition:all 0.4s ease;}.res-ul .res-item .item-part .quickentrence .wrapsource{display:flex;height:100%;justify-content:center;align-items:center;}.res-ul .res-item .item-part .quickentrence .resource{border:1px solid #fff;box-sizing:border-box;height:40px;margin:0px 5px;line-height:40px;width:40px;text-align:center;border-radius:40px;color:#fff;font-size:12px;transition:background 0.4s ease;}.res-ul .res-item .item-part .quickentrence .resource:hover{background:#fff;color:#333;}.res-ul .res-item.j-newli{position:absolute;opacity:0.5;width:300px;height:201px;background:#fff;border:1px dashed #333;z-index:1;}.res-ul .res-add{flex:0 1 25%;position:relative;box-sizing:border-box;height:201px;text-align:center;line-height:201px;margin-top:15px;padding-left:15px;cursor:pointer;vertical-align:top;}.res-ul .res-add .res-add-part{background:#eee;vertical-align:baseline;}.res-ul .res-add .u-icon-add-project-hover{display:none;}.res-ul .res-add:hover .res-add-part{box-shadow:2px 2px 8px 2px #ddd;}.res-ul .res-add:hover .u-icon-add-project{display:none;}.res-ul .res-add:hover .u-icon-add-project-hover{display:inline-block;}.j-newli{position:absolute;opacity:0.5;width:300px;height:201px;background:#fff;border:1px dashed #333;z-index:1;}.j-newli .item-part{height:100%;padding:0 20px;box-sizing:border-box;width:100%;overflow:hidden;}.j-newli .item-part .item-info{width:100%;box-sizing:border-box;}.j-newli .item-part .item-title{border-bottom:1px solid #e6e6e6;color:#333;padding:20px 0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.j-newli .item-part .item-title .u-icon-top-normal,.j-newli .item-part .item-title .u-icon-delete-normal{display:none;}.j-newli .item-part .item-title .icon-wrap{position:absolute;width:80px;top:20px;right:0;}.j-newli .item-part .item-title .info-main{margin:0 auto;text-align:center;}.j-newli .item-part .item-title .info-logo{position:relative;overflow:hidden;width:54px;height:54px;border-radius:50%;margin:0 auto;background-size:100%;background-position:50% 50%;background-repeat:no-repeat;}.j-newli .item-part .item-title .info-logo .logo{width:54px;height:54px;}.j-newli .item-part .item-title .info-logo .upload{position:absolute;z-index:3;cursor:pointer;opacity:0;top:0;left:0;width:54px;height:54px;}.j-newli .item-part .item-title .info-logo .txt{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:16px;color:#222;}.j-newli .item-part .item-title .info-logo .icon{position:absolute;display:none;top:50%;left:50%;margin:-27px 0 0 -27px;width:100%;height:100%;background:rgba(0,0,0,0.5);}.j-newli .item-part .item-title .info-logo:hover .icon{display:block;cursor:pointer;}.j-newli .item-part .item-desc{display:-webkit-box;height:40px;font-size:14px;color:#666;margin:18px 0;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}.j-newli .item-part .quickentrence{display:none;}.f-italic{font-style:italic;color:#bbb;}@media (max-width: 1024px){.res-ul .res-item,.res-ul .res-add{min-width:50%;}}@media (min-width: 1024px) and (max-width: 1366px){.res-ul .res-item,.res-ul .res-add{flex:0 1 33.3%;min-width:317px;}}");
I$('e7fb82b94cb7ae3a39edc584f7ef0dd2',function (k, u, e, v, _rb, _upload, _cu, _dbConst, html, css) {
	e._$addStyle(css);
	var defaultOptions = {
		// [å¿…å¡«] è¡¨ç¤ºå®žä¾‹åŒ–æ–¹å¼æ˜¯å¦å®žä¾‹åŒ–ä¸ºæ ‡ç­¾ç»„ä»¶
		isAllocateByTag: true,
		// [å¿…å¡«] è¡¨ç¤ºå“ªç§ç±»åž‹çš„èµ„æº0 projectmanageé¡¹ç›®ç®¡ç†ï¼ˆç®¡ç†å‘˜||åˆ›å»ºè€…ï¼‰ , 1 project é¡¹ç›®ï¼ˆéžç®¡ç†å‘˜||åˆ›å»ºè€…ï¼‰, 2 recentproject æœ€è¿‘ä½¿ç”¨çš„é¡¹ç›®, 3 progroupmanagement é¡¹ç›®ç»„ç®¡ç†
		resType: 0,

		// [å¿…å¡«] è¡¨ç¤ºæ˜¯å¦å¯ä»¥åˆ›å»ºèµ„æº  true è¡¨ç¤ºå¯åˆ›å»º  false ä¸å¯ä»¥åˆ›å»º
		addable: true,
		// [å¿…å¡«] è¡¨ç¤ºæ˜¯å¦æœ‰æŽ’åºåŠŸèƒ½ é»˜è®¤ä¸ºfalse
		sortable: false,
		// [å¯é€‰] è¡¨ç¤ºæ˜¯å¦æœ‰è®¡æ•°åŠŸèƒ½ é»˜è®¤ä¸ºfalse
		countable: false,
		// [å¿…å¡«] è¡¨ç¤ºæ˜¯å¦åŒºåˆ†ç½®é¡¶å’Œéžç½®é¡¶æ•°ç»„ é»˜è®¤ä¸ºtrue
		hasStickList: true,
		filter: function(list){
			//é’ˆå¯¹æ¯ä¸ªèµ„æºï¼Œæ·»åŠ å¢žåˆ æŸ¥æ”¹æŽ’åºçš„æ ‡è®°
			// å¯å¦åˆ é™¤çš„æ ‡è®° showDelete  {boolean}
			// å¯å¦ç½®é¡¶çš„æ ‡è®° showStick   {boolean}
			//å¯å¦ä¸Šä¼ å¤´åƒçš„æ ‡è®° showUpload  {boolean}
			//æ˜¯å¦æœ‰å±žäºŽå“ªä¸ªé¡¹ç›®ç»„çš„title showBelong  {Object} {flag: true, belong: 'xxxx'}
			//æ˜¯å¦ç»Ÿè®¡é¡¹ç›®ç»„æ•° æ˜¯çš„è¯ä¼ é¡¹ç›®ç»„æ•° count
			return list;
		},

		// [å¯é€‰] èµ„æºçš„åˆ›å»ºï¼Œåˆ é™¤ï¼Œç½®é¡¶ç­‰ç¼–è¾‘æ“ä½œæ—¶éœ€è¦æ“ä½œcache ,å¿…é¡»æ˜¯åœ¨ä¸»æ–‡ä»¶ä¸­å®žä¾‹åŒ–è¿‡ å¯å–åˆ°è¯¥èµ„æºçš„å€¼å¾—å®žä¾‹
		//		  æ¯”å¦‚æˆ‘åœ¨ä¸»æ–‡ä»¶ä¸­å®žä¾‹åŒ–è¿‡ é¡¹ç›®çš„cache, é‚£ä¹ˆè¿™é‡Œä¼ çš„å°±æ˜¯ this.__proCache
		cache: null,

		// [å¯é€‰] èµ„æºçš„åˆ›å»ºï¼Œåˆ é™¤ï¼Œç½®é¡¶ç­‰ç¼–è¾‘æ“ä½œæ—¶éœ€è¦æ“ä½œcache,ä¼ é¡¹ç›®ç»„çš„pgid
		pgid: null,
		// [å¯é€‰] ç½®é¡¶æ•°ç»„ æ²¡æœ‰ç½®é¡¶åŠŸèƒ½çš„ä¸ç”¨ä¼ 
		toplist: [],

		// [å¯é€‰] éžç½®é¡¶æ•°ç»„ æ²¡æœ‰ç½®é¡¶åŠŸèƒ½çš„ä¸ç”¨ä¼ 
		noToplist: [],

		// [å¯é€‰] å…¬å…±é¡¹ç›® || é»˜è®¤åˆ†ç»„ æ²¡æœ‰ç½®é¡¶åŠŸèƒ½çš„ä¸ç”¨ä¼ 
		publist: [],

		// [å¯é€‰] æ²¡æœ‰ç½®é¡¶åŠŸèƒ½çš„èµ„æºåˆ—è¡¨
		noSticklist: [],

		// [å¯é€‰] æŽ’åºæ–¹å¼ æ²¡æœ‰æŽ’åºåŠŸèƒ½çš„ä¸ç”¨ä¼ 
		orderType: 0,

		// [å¯é€‰] æŽ’åºæ–¹å¼ï¼ˆæŒ‰å­—æ®µåæ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼‰ æ²¡æœ‰æŽ’åºåŠŸèƒ½çš„ä¸ç”¨ä¼  eg: 'name-up'
		sortType: '',

		// [å¯é€‰] æŽ’åºå­—æ®µï¼ˆæŒ‰å­—æ®µåæ˜¾ç¤ºçš„å­—ç¬¦ä¸²ï¼‰ æ²¡æœ‰æŽ’åºåŠŸèƒ½çš„ä¸ç”¨ä¼  eg:[{ name: 'åç§°' , type: 'name'}]
		sortlist: [],

		// [å¯é€‰] æ ‡é¢˜ ç›®å‰åªæœ‰é¡¹ç›®ç»„ç”¨åˆ°äº†ï¼Œå…¶ä»–çš„ä¸ç”¨ä¼ 
		title: '',
		// [å¯é€‰] æ˜¯å¦æœ‰å¿«é€Ÿå…¥å£ï¼Œé»˜è®¤ä¸ºtrue
		hasQuickEntrence: true,
		// [å¯é€‰] å¿«é€Ÿå…¥å£èµ„æºåˆ—è¡¨ï¼Œ[{name:'é¡µé¢', type:'page'}]
		entranceList: [{name:'é¡µé¢', type:'page'}, {name:'æŽ¥å£', type:'interface'}, {name:'æ¨¡åž‹', type:'datatype'},
			{name:'æ¨¡æ¿', type:'template'}, {name:'è§„åˆ™', type:'constraint'}, {name:'åˆ†ç»„', type:'group'}],

		// [å¯é€‰] å¿«é€Ÿå…¥å£éšè—çš„èµ„æºåˆ—è¡¨ï¼Œ[{name:'é¡µé¢', type:'page'}]
		entranceHiddenlist: [],
	};

	var CardList = _rb.extend({
		name: "cardlist",
		template: html,
		config: function(initData){
			//é’ˆå¯¹ä¸åŒæ¥æºçš„æ•°æ®åšæ•°æ®æ•´åˆ
			if(!!initData.options && !!initData.options.isAllocateByTag){
				var _options = {};
				for(var prop in initData){
					if(prop == 'options'){
						for(var prop2 in initData.options){
							_options[prop2] = initData.options[prop2];
						}
					}else{
						_options[prop] = initData[prop];
					}
				}
				this.data = u._$merge({}, defaultOptions, _options);
			}else{
				this.data = u._$merge({}, defaultOptions, initData);
			}
			this.data.type = this.data.resType == 3 ? 'progroup' : 'project';
			this.data.resId = this.data.resType == 3 ? 'pgid' : 'pid';
			// æœ‰åˆ é™¤æŒ‰é’®çš„ï¼Œæ·»åŠ åˆ é™¤æ‰€éœ€ä¿¡æ¯
			if(this.data.resType == 0 || this.data.resType == 3){
				this.addActionData(this.data.toplist);
				this.addActionData(this.data.noToplist);
			}
            if (this.data.addable) {
                var addResActionData = {
                    event: 'add-' + this.data.type
                };
                if (this.data.pgid) {
                    addResActionData.pgid = this.data.pgid;
                }
                this.data.addResActionData = JSON.stringify(addResActionData);
            }
			//å½“å‰çš„æŽ’åºæ–¹å¼
			if(this.data.sortable){
				this.data.sortType = _cu.__initOrder(this.data.orderType, this.data.sortType);
			}
		},
		init: function(){
			var _this = this;
		},
		sort: function(tag){
			//æŒ‰å¯¹åº”å­—æ®µæŽ’åº
			var _data = _cu.__sortByField(tag, this.data.sortType, this.data.toplist, this.data.noToplist, this.data.publist, true);
			this.data.sortType = _data.sortType;
			if(this.data.resType === 0){
				var _options = {
					ids: _data.pids,
					type: _data.typeNum,
					pgId: this.data.pgid,
					key: this.data.cache._$getListKey(this.data.pgid),
					ext:{progroupId:  this.data.pgid}
				}
			}else{
				var _options = {
					ids: _data.pids,
					type: _data.typeNum,
				}
			}
			this.data.cache._$sort(_options);
		},
		addActionData: function(list){
			//æ·»åŠ åˆ é™¤æ—¶ç”¨åˆ°çš„ action-data éœ€è¦ç”¨åˆ°çš„ä¿¡æ¯
			u._$forEach(list, function(item){
				var obj = {
					event: 'delete-'+ this.data.type,
					id: item.id,
					name: item.name,
					pgid: this.data.pgid
				}
				item.actionData = JSON.stringify(obj);
			}._$bind(this));
		},
		_change: function(event,res){
			this.data.cache._$updateItem({id: res.id, data:{logo:event.file},ext:{progroupId:res.progroupId}});
		},
		top: function (res) {
			var _this = this;
			// var top = this.data.resType == 0 ?  '__isTop' : 'isTop';
			var top = "isTop";
			var flag = !!res[top] ? _dbConst.CMN_BOL_NO : _dbConst.CMN_BOL_YES;
			res[top] = !res[top];
			if(this.data.resType == 0){
				var options ={
					v: flag,
					id: res.id,
					pgId: this.data.pgid,
					key: this.data.cache._$getListKey(this.data.pgid),
					ext:{progroupId:this.data.pgid}
				}
			}else{
				var options ={
					v: flag,
					id: res.id
				}
			}
			this.data.cache._$stick(options);
		}
	});
	return CardList;
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','ffa820b4cb293ae990489967d5c4a899','3739ca9efa70543a5da79674f1faf888','8cbc286a7834dfcf29c8f7a018e77c02','993671841dcf289096c7171d53130309','a2f43d780ca342e6aa54bd65b3e6a09a','c545b16590e101fef1bfa51d6d7ca79a');
I$('4ba37c437329baec98f107c42e3a141d',"<div class=\"m-modal-agree\">\n    <div class=\"wrap-select\">\n        <select2 source={source} selected={selected} sortList={false} choseOnly={true} on-change={this._change($event)}></select2>\n    </div>\n    <div class=\"func\">\n        <a on-click={this.ok()}  class=\"u-btn u-btn-auto\">{bottonText}</a>\n    </div>\n</div>");
I$('ce3893e7fb5b392d4eba4fbe3fe62d40',".m-modal-agree .modal-dialog{\n\twidth:400px;\n}\n.m-modal-agree{\n\tfont-size:14px;\n}\n.m-modal-agree .wrap-select{\n\tmargin-bottom:20px;\n}\n.m-modal-agree .u-select2{\n\twidth:100%;\n}\n.m-modal-agree .func a{\n\tbox-sizing:border-box;\n}");
I$('297e5432df317438e030917817e360e8',function (e, v, u, Modal,select2, _, tpl, css) {
    e._$addStyle(css);
    var modal = Modal.extend({
        config: function () {
            var that = this;
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'closeButton': true,
                "okButton": false,
                "cancelButton": false,
            });
            this.data.bottonText = this.data.bottonText || "通过";
            this.data.class = this.data.class || "m-modal-agree";
            this.data.title = this.data.title || "通过验证";
            this.data.source = this.data.source || [
                {name: '观察者', id: _.db.PRG_ROL_GUEST},
                {name: '管理员', id: _.db.PRG_ROL_ADMIN},
                {name: '开发者', id: _.db.PRG_ROL_DEVELOPER},
                {name: '测试者', id: _.db.PRG_ROL_TESTER}
            ];
            this.data.selected = this.data.selected || this.data.source[0];
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
        },
        ok: function () {
            this.$emit("ok",this.data.selected);
            this.destroy();
        },
        _change:function (option) {
            this.data.selected = option.selected;
        },
        destroy: function () {
            this.supr();
        }
    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','e26ac58445dd3bc2b730e5275fb45f6f','8cbc286a7834dfcf29c8f7a018e77c02','4ba37c437329baec98f107c42e3a141d','ce3893e7fb5b392d4eba4fbe3fe62d40');
I$('45d46435fa43104b7896c286b1cb5931',"<div class=\"m-modal-agree\">\n    <div class=\"reason\">\n        <textarea class=\"u-txt\" r-model={message} placeholder=\"请填写拒绝理由\"></textarea>\n    </div>\n    <div class=\"func\">\n        <a on-click={this.ok()}  class=\"u-btn u-btn-red u-btn-auto\">拒绝</a>\n    </div>\n</div>");
I$('f53baaa700df8a4a17efe6d7ddc71393',".m-modal-reject .modal-dialog{\n\twidth:400px;\n}\n.m-modal-reject{\n\tfont-size:14px;\n}\n.m-modal-reject textarea{\n\tfont-size:14px;\n\twidth:100%;\n\theight:80px;\n\tpadding:14px 10px;\n\tbox-sizing:border-box;\n\tborder:1px solid #e6e6e6;\n}\n.m-modal-reject .func{\n\tmargin-top:10px;\n}\n.m-modal-reject .func a{\n\tbox-sizing:border-box;\n}");
I$('8b76a6e315dec37698e6a9f0cf331d3f',function (e, v, u, Modal,select2, _, tpl, css) {
    e._$addStyle(css);
    var modal = Modal.extend({
        config: function () {
            var that = this;
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-modal-reject',
                'title': '拒绝通过',
                'closeButton': true,
                "okButton": false,
                "cancelButton": false,
                message:""
            });
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
        },
        ok: function () {
            this.$emit("ok",{message:this.data.message});
            this.destroy();
        },
        destroy: function () {
            this.supr();
        }
    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','e26ac58445dd3bc2b730e5275fb45f6f','8cbc286a7834dfcf29c8f7a018e77c02','45d46435fa43104b7896c286b1cb5931','f53baaa700df8a4a17efe6d7ddc71393');
I$('c414372fb2919eb27a7bfb86a7cb03ea',function (NEJ,_k,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 临时内存数据共享管理器
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/cache/share'
     * ],function(_t){
     *     // 重新开辟共享存储空间
     *     var _share = _t._$$CacheShare._$allocate({
     *         oncachechange:function(_event){
     *             // _event.key
     *             // _event.type
     *             // _event.oldValue
     *             // _event.newValue
     *             
     *             // TODO
     *         }
     *     });
     * 
     *     // 写入数据
     *     _share._$set('abc',{a:'aaaaa',b:'bbbbbb'});
     *     // 读取数据
     *     var _data = _share._$get('abc');
     *     // 删除数据
     *     _share._$remove('abc');
     * });
     * ```
     * 
     * @class   module:util/cache/share._$$CacheShare
     * @extends module:util/event._$$EventTarget
     */
    /** 
     * 缓存变化出发事件
     * 
     * @event    module:util/cache/share._$$CacheShare#oncachechange
     * @param    {Object}   event    - 事件信息
     * @property {String}   key      - 缓存标识
     * @property {String}   type     - 操作类型，set/delete
     * @property {Variable} oldValue - 原数据
     * @property {Variable} newValue - 新数据
     */
    _p._$$CacheShare = _k._$klass();
    _pro = _p._$$CacheShare._$extend(_t._$$EventTarget);
    /**
     * 初始化函数
     * 
     * @protected
     * @method module:util/cache/share._$$CacheShare#__init
     * @return {Void}
     */
    _pro.__init = (function(){
        var _seed = +new Date,
            _ckey = 'dat-'+_seed;
        return function(){
            this.__super();
            var _cache = this.constructor[_ckey];
            if (!_cache){
                _cache = {};
                this.constructor[_ckey] = _cache;
            }
            this.__cache = _cache;
        };
    })();
    /**
     * 取缓存数据
     * 
     * @method module:util/cache/share._$$CacheShare#_$get
     * @param  {Object}   arg0 - 缓存标识
     * @return {Variable}        缓存数据
     */
    _pro._$get = function(_key){
        return this.__cache[_key];
    };
    /**
     * 设置缓存数据
     * 
     * @method module:util/cache/share._$$CacheShare#_$set
     * @param  {String}   arg0 - 缓存标识
     * @param  {Variable} arg1 - 缓存数据
     * @return {Void}
     */
    _pro._$set = function(_key,_value){
        var _old = this.__cache[_key];
        this.__cache[_key] = _value;
        this._$dispatchEvent(
            'oncachechange',{
                key:_key,
                type:'set',
                oldValue:_old,
                newValue:_value
            }
        );
    };
    /**
     * 删除缓存项
     *
     * @method module:util/cache/share._$$CacheShare#_$remove
     * @param  {String}   arg0 - 缓存标识
     * @return {Variable}        删除项的值
     */
    _pro._$remove = function(_key){
        var _old = this.__cache[_key];
        _u._$safeDelete(this.__cache,_key);
        this._$dispatchEvent(
            'oncachechange',{
                key:_key,
                type:'delete',
                oldValue:_old,
                newValue:undefined
            }
        );
        return _old;
    };
    /**
     * 查询指定名字空间路径的值
     *
     * @method module:util/cache/share._$$CacheShare#_$query
     * @param  {String}   arg0 - 查询串，如：a.b.c
     * @return {Variable}        结果
     */
    _pro._$query = function(_namespace){
        return _u._$query(this.__cache,_namespace);
    };
    /**
     * 系统统一共享内存存储空间
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/cache/share'
     * ],function(_t){
     *     // 使用系统统一存储空间
     *     var _localCache = _t.localCache;
     *     // 添加缓存变化监测事件
     *     _localCache._$addEvent(
     *         'oncachechange',function(_event){
     *             // _event.key
     *             // _event.type
     *             // _event.oldValue
     *             // _event.newValue
     *
     *             // TODO
     *         }
     *     );
     * 
     *     // 写入数据
     *     _localCache._$set('abc',{a:'aaaaa',b:'bbbbbb'});
     *     // 读取数据
     *     var _data = _localCache._$get('abc');
     *     // 删除数据
     *     _localCache._$remove('abc');
     * });
     * ```
     *
     * @static
     * @member {module:util/cache/share._$$CacheShare} localCache
     */
    _p.localCache = _p._$$CacheShare._$allocate();
    
    if (CMPT){
        this.localCache = _p.localCache;
        NEJ.P('nej.ut')._$$ShareCache = _p._$$CacheShare;
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0');
I$('0f372f8e7ed37c311ba90b271c8eee6c',"<div class=\"u-select2group {class}\" r-class={{'u-select2group-double':!!isArray }} id={id}>\n    {#if isArray}\n    <select2 source={source} selected={{id:\"array\",name:\"Array\"}} ref=\"sel1\" on-change={this._onChange($event,0)} on-create={this._onCreate(\"sel1\")} choseOnly={true} hasCreate={hasCreate} initSilent={true} isDataType={true} isOpen={isOpen} noObject={noObject} on-toggle={this._watchOpen(1)}></select2>\n    <select2 source={source} selected={selected} ref=\"sel2\"  on-change={this._onChange($event,1)} on-create={this._onCreate(\"sel2\")} isolate choseOnly={true} hasCreate={hasCreate} initSilent={true} isDataType={true} isOpen={backOpen} noObject={noObject} noArray={true} on-toggle={this._watchOpen(2)}></select2>\n    {#else}\n    <select2 source={source} selected={selected} ref=\"sel1\" on-change={this._onChange($event,0)} on-create={this._onCreate(\"sel1\")} hasCreate={hasCreate} initSilent={true} choseOnly={true} isDataType={true} isOpen={isOpen} noObject={noObject} noArray={noArray} on-inputclick={this._watchOpen(1)}></select2>\n    {/if}\n</div>");
I$('4a91f5ff4065592bb0c94f6ff89b4a5f',".u-select2group{\n\theight:30px;\n\tdisplay:flex;\n\tflex:1;\n}\n.u-select2group .u-select2{\n\tflex:1;\n}\n.u-select2group .u-select2 .select-hd{\n\tpadding:0px 15px 0px 5px;\n}\n.u-select2group .u-select2 .dis-name{\n\theight:auto;\n\tline-height:normal;\n}\n.u-select2group-double .u-select2:first-child{\n\tmargin-right:5px;\n}");
I$('8a91df09bcc0c19dbe9fe08d3f2b1a25',function (base, v, u, e, _, select2, modal, cache, tpl, css) {
    e._$addStyle(css);
    //数据模型选择器内部的字段的id,name对应外部的是type和typeName
    var DatatypeSelect = base.extend({
        name: "DatatypeSelect",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                source: [],
                selected: undefined,
                hasCreate: true,
                isArray: _.db.CMN_BOL_NO
            });
            if (this.data.type && this.data.typeName) {
                this.data.selected = {
                    id: this.data.type,
                    name: this.data.typeName
                }
            }
            if (this.data.selected && !this.data.source.length) {
                this.data.source.push(this.data.selected);
            }
            this.__pid = this.data.pid || "";
            // //变量映射不存在pid
            // if (!this.__pid) {
            //     this.supr();
            //     return;
            // }

            this.supr();
        },
        init: function () {
            this.supr();
            var listCacheKey = null;
            this.__cache = cache._$$CacheDatatype._$allocate({
                onlistload: function () {
                    var _list = this.__cache._$getListInCache(listCacheKey);
                    //过滤掉匿名类型
                    _list = _list.filter(function (item) {
                        return item.type != 2;
                    });
                    //如果是哈希类型需要过滤掉枚举类型
                    var that = this;
                    if (this.data.format == _.db.MDL_FMT_HASH || this.data.format == _.db.MDL_FMT_ARRAY) {
                        // _list = _list.filter(function (item) {
                        //     return item.format != _.db.MDL_FMT_ENUM;
                        // });
                    } else if (this.data.format == _.db.MDL_FMT_ENUM) {
                        //枚举类型的值可以是自定义的数字或字符,系统类型的字符和数字的format等于0
                        _list = _list.filter(function (item) {
                            return item.format == _.db.MDL_FMT_STRING || item.format == _.db.MDL_FMT_NUMBER || item.id == _.db.MDL_SYS_STRING || item.id == _.db.MDL_SYS_NUMBER;
                        });
                    } else {
                        _list = _list.filter(function (item) {
                            return item.format == that.data.format;
                        });
                    }
                    this.$refs.sel1.$updateSource(_list);
                    if (this.data.isArray) {
                        this.$refs.sel2.$updateSource(_list);
                    }
                }.bind(this)
            });
            listCacheKey = this.__cache._$getListKey(this.__pid);
            this.__cache._$getList({
                key: listCacheKey,
                data: {
                    pid: this.__pid
                }
            });

        },
        select: function (item) {
            this.supr(item);
        },
        _watchOpen: function (index) {
            if (index == 1) {
                if (this.$refs.sel2) {
                    this.$refs.sel2.data.isOpen = false;
                    this.$refs.sel2.$update();
                }
            } else {
                this.$refs.sel1.data.isOpen = false;
            }
        },
        //创建数据模型
        _onCreate: function (ref) {
            this.data.sourceRef = ref;
            var _modal = new modal({
                data: {
                    "content": '',
                    "title": ' ',
                    "class": 'inline-create',
                    "okButton": false,
                    "cancelButton": false,
                    'closeButton': true
                }
            }).$on('close', function () {
                dispatcher._$hide("/?/progroup/p/res/datatype/create/");
                _modal.destroy();
            });
            //弹窗的新建数据模型没有创建数据模型入口则不需要监听事件
            if (this.data.hasCreate) {
                this.__cache.__doInitDomEvent([
                    [cache._$$CacheDatatype, "add", function (result) {
                        this.$refs[this.data.sourceRef].$select(result.data);
                        //及时清除事件
                        this.__cache.__doClearDomEvent();
                    }._$bind(this)]
                ]);
            }
            dispatcher._$redirect("/?/progroup/p/res/datatype/create/?pid=" + this.__pid, {
                input: {
                    // format: this.data.format,
                    parent: _modal.$refs.modalbd,
                    done: function () {
                        dispatcher._$hide("/?/progroup/p/res/datatype/create/");
                        // this.__cache._$clearEvent("add");
                        _modal.destroy();
                    }.bind(this)
                }
            });
        },
        _onChange: function (opt, level) {
            var item = opt.selected;
            if (!item) return;
            if (level == 0 && item.id == "array") {//选择了数组
                this.data.isArray = _.db.CMN_BOL_YES;
                this.data.id = 10001;
                this.data.name = "String";
            } else if (level == 0 && item.id != "array") {
                this.data.isArray = _.db.CMN_BOL_NO;
                this.data.name = item.name;
                this.data.id = item.id;
            } else {
                this.data.name = item.name;
                this.data.id = item.id;
            }

            this.data.isOpen = false;

            this.data.selected = {
                id: this.data.id,
                name: this.data.name
            };
            // this.data.selected = item;
            //id,name对外是需要映射为type,typeName
            this.$emit('change', {
                sender: this,
                isArray: this.data.isArray,
                type: this.data.selected.id,
                typeName: this.data.selected.name
            });
        },
        destroy:function () {
            if(!!this.__cache) {
                this.__cache._$recycle();
            }
            this.supr();
        }
    });
    return DatatypeSelect;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','e26ac58445dd3bc2b730e5275fb45f6f','a17dfb1aca7e5bcf1c99411da2601159','afd9bc71d3ea5904e51ae183b2351b6e','0f372f8e7ed37c311ba90b271c8eee6c','4a91f5ff4065592bb0c94f6ff89b4a5f');
I$('9f296b2894fc6a25e318952c22afc2fe',"<div class=\"explain\">\n    <div class=\"tip\">{tip}</div>\n</div>\n<div class=\"ace\">\n    <pre id=\"editor\"></pre>\n</div>\n<div class=\"explain\">\n    <div class=\"tip2\">说明:\n        <ul>\n            <li>1. 输入字符后, 出现的智能提示列表即为在本项目中定义的规则函数集</li>\n            <li>2. JavaScript 代码应是对规则函数的调用, 函数的具体实现在规则函数中定义</li>\n            <li>3. NEI 对象下的方法为系统预置方法, 详情请查看: <a href=\"https://github.com/NEYouFan/nei-toolkit/blob/master/doc/NEI%E5%B9%B3%E5%8F%B0%E7%B3%BB%E7%BB%9F%E9%A2%84%E7%BD%AE%E7%9A%84%E8%A7%84%E5%88%99%E5%87%BD%E6%95%B0%E9%9B%86.md\" target=\"_blank\">系统预置方法</a></li>\n            <li>4. 系统已经集成了 <a href=\"http://mockjs.com/examples.html\" target=\"_blank\">Mock.js</a>，可直接使用</li>\n        </ul>\n    </div>\n</div>");
I$('3747d1784e50b98f993706e7b63f019d',".m-modal-rule .modal-dialog{\n\twidth:600px;\n}\n.m-modal-rule .explain{\n\ttext-align:left;\n}\n.m-modal-rule .tip{\n\tline-height:20px;\n\tfont-size:12px;\n}\n.m-modal-rule .tip2{\n\tfont-size:12px;\n\tcolor:#999;\n}\n.m-modal-rule .ace{\n\theight:80px;\n\twidth:500px;\n\ttext-align:left;\n\tmargin:12px 0;\n\tborder:1px solid #e6e6e6;\n\toverflow:hidden;\n}");
I$('b149210a882529cffb53afd4c02c71d3',function (e, v, u, Modal, _, cache, tpl, css) {

    var modal = Modal.extend({
        config: function () {
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-modal-rule',
                'title': "生成规则",
                'tip': '请输入调用规则函数的 JavaScript 代码, 例如: NEI.chinese(15)',
                'closeButton': true,
                "okButton": true,
                "cancelButton": true
            });
            this.supr(this.data);
        },
        init: function () {
            e._$addStyle(css);
            this.supr(this.data);
            var that = this;
            this.__functionCollect = [{"meta": "object", "caption": "NEI", "value": "NEI", "score": 1}, {"meta": "object", "caption": "Mock", "value": "Mock", "score": 0.5}];
            ["mock", "Random"].forEach(function (fun) {
              that.__functionCollect.push({
                    meta: "function",
                    caption: fun,
                    value: "Mock." + fun,
                    score: fun == "mock"? 0.8: 0.5
              })
            });
            ["Basic", "Date", "Image", "Color",
              "Text", "Name", "Web", "Address", "Helper",
              "guid", "id", "increment"].forEach(function (fun) {
              that.__functionCollect.push({
                meta: "function",
                caption: fun,
                value: "Mock.Random." + fun,
                score: 0.2
              })
            });
          
            //规则函数cache
            this.__csCache = cache._$$CacheConstraint._$allocate({
                onlistload: function () {
                    var list = this.__csCache._$getListInCache(this.__csListCacheKey);
                    list.forEach(function (item) {
                        this.__functionCollect.push({
                            "meta": "function",
                            "caption": item.name,
                            "value": item.type == 1? "NEI." + item.name : item.name,
                            "score": 1
                        });
                    }.bind(this));
                }.bind(this)
            });
            this.__csListCacheKey = this.__csCache._$getListKey(this.data.pid);
            this.__csCache._$getList({
                key: this.__csListCacheKey,
                data: {
                    pid: this.data.pid
                }
            });
            var langTools = ace.require("ace/ext/language_tools");
            this.editor = ace.edit("editor");
            this.editor.setTheme("ace/theme/tomorrow");
            this.editor.setAutoScrollEditorIntoView(true);
            this.editor.setOption("minLines", 10);
            this.editor.setOption("maxLines", 10);
            this.editor.setValue(this.data.value || "", -1);

            var tangideCompleter = {
                getCompletions: function (editor, session, pos, prefix, callback) {
                    if (prefix.length === 0) {
                        return callback(null, []);
                    } else {
                        return callback(null, that.__functionCollect);
                    }
                }
            }
            this.editor.setOptions({
                // enableBasicAutocompletion: true,
                // enableSnippets: true,
                enableLiveAutocompletion: true
            });
            langTools.addCompleter(tangideCompleter);
        },
        ok: function () {
            this.$emit("ok", this.editor.getValue());
            this.__functionCollect = [];
            this.destroy();
        },
        cancel: function () {
            this.$emit("cancel");
            this.__functionCollect = [];
            this.destroy();
        }
    });
    return modal;

},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','7f69de0f0fa6d9d6f0b6273610f4c7c5','9f296b2894fc6a25e318952c22afc2fe','3747d1784e50b98f993706e7b63f019d');
I$('06caca77b0108dddd978f7bb094c6943',function (base, v, u, e, _, t, DatatypeSelect, GRule) {
    var Origin = base.extend({
        init: function () {

        },
        createExp: function (index, key) {
            var that = this;
            var modal = new GRule({
                data:{
                    pid:this.data.pid,
                    value: that.data.params[index][key]
                }
            }).$on("ok", function (val) {
                that.data.params[index][key] = val;
                that.$update();
            });
        },
        _onSelectChange: function (item, index) {
            if (!item) return;
            this.data.params[index].type = item.type;
            this.data.params[index].typeName = item.typeName;
            this.data.params[index].isArray = item.isArray;
        },
        validate: function () {
            var _params = this.data.params;
            var tmp = [], tmp2 = [], that = this;
            var verifyName = this.data.verifyName;
            var validateItem = function (verifies, item) {
                if (item[verifyName] == "") {
                    return;
                } else if (verifies.indexOf(item[verifyName]) < 0) {
                    verifies.push(item[verifyName]);
                    item['error'] = false;
                } else {
                    that.hasError = true;
                    item['error'] = true;
                }
                if (item.hasOwnProperty('params')) {
                    item.params.forEach(function (item2) {
                        validateItem(tmp2, item2);
                    });
                }
            };
            for (var i = 0, len = _params.length; i < len; i++) {
                validateItem(tmp, _params[i]);
            }
            this.$update();
        },
        /**
         * 参数编辑器校验
         * @returns {*}
         */
        checkValidate: function () {
            this.hasError = false;
            this.validate();
            if (this.hasError) {
                return {
                    msg: "参数名错误或者重名",
                    pass: false
                }
            } else {
                return {
                    msg: "",
                    pass: true
                }
            }
        },
        /**
         * 返回编辑器参数
         * @returns {Object} 包含format和params
         */
        getParams: function () {
            //遍历，将verifyName不为空的内容提取出来
            var that = this, params = [];
            this.data.params.forEach(function (item) {
                if (item[that.data.verifyName] != '') {
                    var obj = u._$merge({}, item);
                    delete obj.error;
                    if (item.hasOwnProperty('params')) { //这里params可能会有嵌套的情况
                        // var list = [];
                        // item.params.forEach(function (item2) {
                        //     if (item2[that.data.verifyName] != "") {
                        //         list.push(u._$merge({}, item2));
                        //     }
                        // });
                        // obj.params = list;
                        var _result = this.assortParamsAndImports(item.params);
                        item.attrs = _result.attrs;
                        item.imports = _result.imports;
                        // delete  item.params;
                    }
                    params.push(obj);
                }
            },this);
            return {format: this.data.format, params: params};
        },
        /**
         * 删除空行
         * @return {Void}
         */
        removeEmpty: function () {
            var that = this, tml = this.data.params.slice(0);
            u._$reverseEach(this.data.params, function (item, index) {
                if (item[that.data.verifyName] == "") {
                    tml.splice(index, 1);
                }
                delete item.error;
                // delete item.typeName;
            });
            this.data.params = tml;
        },
        /**
         * 全屏toggle操作
         */
        doFullScreen:function () {
            var _node = this.parentNode;
            var pnode = _node.parentNode;
            var arrNode = [];
            if(!this.data.isFullScreen){
                while (pnode && pnode.nodeName.toLowerCase() !="html"){
                    var _value = e._$getStyle(pnode,"position");
                    if(_value == "relative" || _value == "absolute") {
                        arrNode.push({
                            node:pnode,
                            prop:_value
                        });
                    }
                    pnode = pnode.parentNode;
                };
            } else {
                while (pnode && pnode.nodeName.toLowerCase() !="html"){
                    if(e._$hasClassName(pnode,"full-screen")){
                        arrNode.push({
                            node:pnode
                        });
                    }
                    pnode = pnode.parentNode;
                };
            }
            var that = this;
            var escHandle = function (event) {
                event.witch = event.keyCode || event.witch;
                if(event.witch == 27) {
                    that.doFullScreen();
                }
            };
            if(!this.data.isFullScreen) {
                e._$style(_node,{
                    "position":"fixed",
                    "width":document.documentElement.clientWidth+"px",
                    "height":document.documentElement.clientHeight+"px",
                    "left":"0px",
                    "padding":"30px",
                    "top":"0px",
                    "background":"#fff",
                    "z-index":"99",
                    "box-sizing":"border-box",
                    "overflow":"scroll"
                });
                arrNode.forEach(function (item) {
                    e._$setStyle(item.node,"position","static");
                    e._$addClassName(item.node,"full-screen");
                });
                this.data.isFullScreen = true;
                v._$addEvent(window,"keyup",escHandle);
            } else {
                _node.style = null;
                arrNode.forEach(function (item) {
                    item.node.style = null;
                    e._$delClassName(item.node,"full-screen");
                });
                this.data.isFullScreen = false;
                v._$delEvent(window,"keyup",escHandle);
            }
        },
        /**
         * 将普通参数和导入的参数分类
         * @param attrs
         * @returns {{attrs: Array, imports: ({}|*)}}
         */
        assortParamsAndImports:function (attrs) {
            _imports = {}, _params = [];
            //将导入的参数放进imports里面去
            u._$forEach(attrs, function (item) {
                if (item.parentId) {
                    if (_imports.hasOwnProperty(item.parentId)) {
                        _imports[item.parentId].push(item);
                    } else {
                        _imports[item.parentId] = [item];
                    }
                    //   _imports.push(item);
                } else {
                    _params.push(item);
                }
            });
            //将导入的参数进行归类
            _imports = this.getImportsParams(_imports);
            return {
                attrs:_params,
                imports:_imports
            }
        },
        /**
         * 返回编辑器的参数
         * @returns {{result: {format: *, imports: {}, params: Array}, msg: string, pass: boolean}}
         */
        $getEditorParams:function () {
            var _format = this.data.format,
                _validateResult = this.checkValidate(),
                _attributes = this.getParams();
            var _obj = this.assortParamsAndImports(_attributes.params);
            var _imports = _obj.imports;
            var _params  = _obj.attrs;
            return {
                result: {
                    format: _format,
                    imports: _imports,
                    params: _params
                },
                msg: _validateResult.msg,
                pass: _validateResult.pass
            }
        },
        /**
         * 添加导入参数的时候进行转换成后端对应的参数格式
         * @param _imports
         * @returns {Array}
         * @private
         */
        getImportsParams : function (_imports) {
            //将导入的参数进行归类
            var _temp = [];
            u._$forIn(_imports, function (value, key) {
                var _obj = {
                    id: key,
                    vars: []
                };
                value.forEach(function (item) {
                    if (item.originals) {
                        var varObj = {}, flag = false;
                        if(item.attrs){
                            varObj.attrs = item.attrs;
                            varObj.imports = item.imports;
                            flag = true;
                        } else {
                            for (var key in item.originals) {
                                if (item.originals[key] != item[key]) {
                                    varObj[key] = item[key];
                                    flag = true
                                }
                            }
                        }

                        if (flag) {
                            varObj.id = item.id;
                            _obj.vars.push(varObj);
                        }

                    }
                });

                _temp.push(_obj);
            });
            return _temp;
        },
        destroy: function () {
            this.supr();
            this.__expr = this.__expr && this.__expr._$recycle();
        }
    });
    return Origin;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','c414372fb2919eb27a7bfb86a7cb03ea','8a91df09bcc0c19dbe9fe08d3f2b1a25','b149210a882529cffb53afd4c02c71d3');
I$('8bd658859de1916fb7ff1a1ffc7d693a',"<div class=\"m-datatype-list\">\n    <div class=\"search\"><input type=\"text\" class=\"u-input\" ref=\"input\" on-input={this._onListenInput($event)} placeholder=\"搜索\"></div>\n    <div class=\"dt-header\">\n        <div class=\"list-row \">\n            <div class=\"list-col list-col-check\" r-class={{\"selected\":selectAll}}><i class=\"u-icon-checkbox-normal\" on-click={this.selectAll(xlist)}></i><i class=\"u-icon-checkbox-pressed\" on-click={this.selectAll(xlist)} ></i></div>\n            <div class=\"list-col list-col-type\">类型</div>\n            <div class=\"list-col list-col-des\">描述</div>\n        </div>\n    </div>\n\n    <div class=\"dt-body\">\n        {#if !xlist.length}\n            <div class=\"list-empty\">\n                没有找到相关的数据模型\n            </div>\n        {/if}\n        {#list xlist as x}\n        <div class=\"list-row\" on-click={this.selectItem(x)}>\n            <div class=\"list-col list-col-check\" r-class={{\"selected\":checkStatus[x.id]}}><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n            <div class=\"list-col list-col-type\"  title={x.name}>{x.name}</div>\n            <div class=\"list-col list-col-des\"  title={x.description}>{x.description}</div>\n        </div>\n        {/list}\n    </div>\n        <div class=\"dt-footer\">\n            {#if checkArray.length}\n            已选中导入类型:{checkArray|formatCheck}\n            {/if}\n        </div>\n</div>\n");
I$('c4a939f284bca364cefd507bace55aaa',".m-datatype-list .search{\n\ttext-align:right;\n}\n.m-datatype-list .search input{\n\tpadding:3px 5px 3px 10px;\n\twidth:160px;\n\tborder-radius:15px;\n\tborder:1px solid #e6e6e6;\n}\n.m-datatype-list .search input:focus{\n\tborder-color:#aaa;\n}\n.m-datatype-list .list-row{\n\tdisplay:flex;\n\tcursor:pointer;\n}\n.m-datatype-list .dt-body{\n\tposition:relative;\n\tcolor:#555;\n\tmax-height:400px;\n\tmin-height:150px;\n\toverflow:auto;\n}\n.m-datatype-list .dt-footer{\n\twidth:100%;\n\theight:45px;\n\tline-height:45px;\n\ttext-align:left;\n\toverflow:hidden;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n}\n.m-datatype-list .list-empty{\n\tpadding:20px;\n}\n.m-datatype-list .list-col{\n\theight:45px;\n\tline-height:45px;\n\tborder-bottom:1px solid #e6e6e6;\n\ttext-align:left;\n\tpadding:0px 5px;\n\toverflow:hidden;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n}\n.m-datatype-list .list-col-check{\n\twidth:40px;\n}\n.m-datatype-list .list-col-check .u-icon-checkbox-pressed{\n\tdisplay:none;\n}\n.m-datatype-list .list-col-type{\n\twidth:200px;\n}\n.m-datatype-list .list-col-des{\n\tflex:1;\n}\n.m-datatype-list .selected .u-icon-checkbox-normal{\n\tdisplay:none;\n}\n.m-datatype-list .selected .u-icon-checkbox-pressed{\n\tdisplay:inline-block;\n}");
I$('e2ff6690ab8b15389357e398ea59abd9',function (e, v, u, Modal, _, cache, tpl, css) {
    var modal = Modal.extend({
        config: function () {
            var that = this;
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-modal-import',
                'title': '导入数据模型',
                'closeButton': true,
                "okButton": true,
                "cancelButton": true,
                checkStatus: {},
                importedList: [],
                format: 0 //0 哈希 1 枚举
            });
            //this.data.noObject属性如果为true时 说明不能再导入匿名类型了
            this.__pid = this.data.pid;

            this.__listCacheKey = null;
            this.__cache = cache._$$CacheDatatype._$allocate({
                onlistload: function () {
                    var that = this;
                    var _list = that.__cache._$getListInCache(this.__listCacheKey);
                    //取指定数据模型 过滤掉系统类型和匿名类型，同时还要过滤掉没有属性的类型
                    var arr = _list.filter(function (item) {
                        return item.format == that.data.format && item.id > 10003 && !item.__isAnon && !!item.params.length;
                    });
                    //过滤掉已经导入的类型
                    u._$reverseEach(arr, function (item2, index) {
                        u._$reverseEach(that.data.importedList, function (item3) {
                            if (item2.id == item3) {
                                arr.splice(index, 1);
                            }
                        });
                    }._$bind(this));
                    arr.sort(function (a,b) {
                       return a.name.localeCompare(b.name);
                    });
                    that.data.list = this.data.xlist = arr;
                    that.$update();
                }.bind(this)
            });
            this.__listCacheKey = this.__cache._$getListKey(this.__pid);
            this.__cache._$getList({
                key: this.__listCacheKey,
                data: {
                    pid: this.__pid
                }
            });
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
            e._$addStyle(css);
        },
        selectAll: function (xlist) {
            var checked = this.data.selectAll = !this.data.selectAll;
            var that = this;
            if (!xlist) return;
            xlist.forEach(function (item) {
                that.data.checkStatus[item.id] = checked;
            });
            this.data.checkArray = this.data.xlist.filter(function (item) {
                return that.data.checkStatus[item.id];
            });
        },
        selectItem: function (item) {
            var that = this;
            this.data.checkStatus[item.id] = !this.data.checkStatus[item.id];
            this.data.checkArray = this.data.xlist.filter(function (item) {
                return that.data.checkStatus[item.id];
            });
            if (this.data.checkArray.length != this.data.xlist.length) {
                this.data.selectAll = false;
            } else {
                this.data.selectAll = true;
            }
        },
        ok: function () {
            this.$emit("ok", this.data.checkArray);
            this.destroy();
        },
        _onListenInput:function ($event) {
            var value = this.$refs.input.value.trim();
            if(value == "") {
                this.data.xlist = this.data.list;
                return;
            }
            this.data.xlist = this.data.list.filter(function (item) {
               return item.name.toLowerCase().indexOf(value.toLowerCase()) === 0;
            });
        },
        destroy: function () {
            this.supr();
        }

    }).filter({
        "formatCheck": function (arr) {
            var _tmp = [];
            arr.forEach(function (item) {
                _tmp.push(item.name);
            });
            return _tmp.join(',')
        }
    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','afd9bc71d3ea5904e51ae183b2351b6e','8bd658859de1916fb7ff1a1ffc7d693a','c4a939f284bca364cefd507bace55aaa');
I$('d8ad1547f2a42376a26dfb05f33c4bc7',"<div class=\"m-import-json\">\n    <div class=\"oper\" r-class={{\"draging\":isDraging}} on-dragenter={this.ondragenter($event)} on-dragleave={this.ondragleave($event)} on-drop={this.ondrop($event)} on-dragover={this.ondragover($event)}>\n        <span class=\"func\"><input ref=\"upload\" type=\"file\" accept=\".json\" class=\"u-icon-upload-file-normal\" /><i class=\"u-icon-file-pressed\"></i></span>\n        文件拖入此区域可导入\n    </div>\n    <div class=\"edit\">\n        <pre id=\"editor_ace\"></pre>\n    </div>\n</div>");
I$('db31612a16d26ccbad51a4efd8770ccc',".m-modal-import .modal-dialog{\n\twidth:500px;\n}\n.m-import-json{\n\tmargin-bottom:30px;\n\tborder:1px solid #d2d6de;\n}\n.m-import-json .oper{\n\tpadding:0px 10px;\n\tfont-size:14px;\n\theight:40px;\n\tline-height:40px;\n\ttext-align:right;\n\tborder-bottom:1px solid #d2d6de;\n\tcolor:#999;\n}\n.m-import-json .oper .func{\n\tfloat:left;\n}\n.m-import-json .draging{\n\tbackground:#f1f1c0;\n}\n.m-import-json .edit{\n\ttext-align:left;\n}");
I$('16afe76b284216512cb18db2caca44c6',function (e,v,u,Modal,Notify,_,tpl,css){
    var modal =  Modal.extend({
        config:function(){
            var that= this;
            _._$extend(this.data,{
                "contentTemplate": tpl,
                'class':'m-modal-import',
                'title':'导入JSON',
                'closeButton':true,
                "okButton": true,
                "cancelButton": true
            });
            this.supr(this.data);
        },
        init:function(){
            this.supr(this.data);
            e._$addStyle(css);
            this.editor = ace.edit("editor_ace");
            this.editor.setTheme("ace/theme/tomorrow");
            this.editor.setAutoScrollEditorIntoView(true);
            this.editor.setOption("maxLines", 30);
            this.editor.setOption("minLines", 10);
            var fileInput = this.$refs.upload;
            v._$addEvent(fileInput,'change',this.onSelectFile._$bind(this));
        },
        ok:function(){
            var value = _._$getValidJSON(this.editor.getValue());
            var json = value ? value : null;
            this.$emit("ok",json);
            this.destroy();
        },
        onSelectFile:function(event){
            var _file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function(ev){
                var _json = _._$getValidJSON(ev.target.result);
                if(_json){
                    this.editor.setValue(JSON.stringify(_json));
                } else {
                    Notify.error('文件内容不是有效的JSON，请重新选择!');
                }
            }._$bind(this);
            if(_file && _file.size > 0) {
                reader.readAsText(_file,'UTF-8');
            }
        },
        ondragenter:function(event){
            this.data.isDraging = true;
        },
        ondragleave:function(event){
            this.data.isDraging = false;
        },
        ondrop:function(event){
            event.preventDefault();
            this.data.isDraging = false;
            var files = event.event.dataTransfer.files;
            var _file = files[0];
            var reader = new FileReader();
            reader.onload = function(ev){
                var _json = _._$getValidJSON(ev.target.result);
                if(_json){
                    this.editor.setValue(JSON.stringify(_json));
                } else {
                    Notify.error('文件内容不是有效的JSON，请重新选择!');
                }
            }._$bind(this);
            if(_file && _file.size > 0) {
                reader.readAsText(_file,'UTF-8');
            }
        },
        ondragover:function(event) {
            event.preventDefault();
        }

    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','afb57ef5a0e0ee34baead79fa46d3e43','8cbc286a7834dfcf29c8f7a018e77c02','d8ad1547f2a42376a26dfb05f33c4bc7','db31612a16d26ccbad51a4efd8770ccc');
I$('273bddacbf463ff24f05d250fbefc8a8',"<div class=\"m-import-interface\">\n    <div class=\"item\">\n        <label class=\"lab\">请求地址：</label>\n        <div class=\"ipt\">\n            <select2 source={source} on-change={this._onChange($event.selected)}></select2>\n            <input type=\"text\" r-class={{\"u-input-error\":isError}} r-model={url} class=\"u-input\" on-focus={isError = false}  placeholder=\"http://\"/>\n        </div>\n    </div>\n    <div class=\"item\">\n        <label class=\"lab\">请求头信息：</label>\n        <div class=\"ipt ipt-edit\" style=\"height: 140px;width: 400px\"><pre id=\"editor1\"></pre></div>\n    </div>\n    <div class=\"item\">\n        <label class=\"lab\">请求参数：</label>\n        <div class=\"ipt ipt-edit\" style=\"height:140px;width: 400px;\"><pre id=\"editor2\"></pre></div>\n    </div>\n</div>");
I$('82393852694403470c721516b2ba0cc7',".m-modal .modal-dialog{\n\twidth:600px;\n}\n.m-import-interface{\n\tmargin-bottom:30px;\n}\n.m-import-interface .item{\n\tmargin-bottom:10px;\n\tzoom:1;\n}\n.m-import-interface .item:after{\n\tdisplay:block;\n\tclear:both;\n\tvisibility:hidden;\n\theight:0;\n\toverflow:hidden;\n\tcontent:\".\";\n}\n.m-import-interface .item .u-dropdown{\n\tfloat:left;\n\twidth:100px;\n}\n.m-import-interface .item .u-input{\n\tfloat:left;\n\tmargin-left:-1px;\n\twidth:302px;\n}\n.m-import-interface .item .lab{\n\tfloat:left;\n\theight:30px;\n\tline-height:30px;\n\twidth:80px;\n\ttext-align:right;\n}\n.m-import-interface .item .ipt{\n\tfloat:left;\n\tmargin-left:10px;\n}\n.m-import-interface .item .u-select2{\n\twidth:100px;\n\tfloat:left;\n}\n.m-import-interface .item .u-select2 .select-hd{\n\tborder-right:0px;\n}\n.m-import-interface .item .ipt-edit{\n\tborder:1px solid #d2d6de;\n\ttext-align:left;\n\toverflow:hidden;\n}");
I$('2596f2d6d1b058745ae490f532ef918b',function (e, v, u, j, Modal, Notify, _, Select2, tpl, css) {
    var modal = Modal.extend({
        config: function () {
            var that = this;
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-modal-import',
                'title': '从接口导入类型',
                'closeButton': true,
                "okButton": true,
                "cancelButton": true
            });
            this.data.method = '';
            this.data.url = '';
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
            e._$addStyle(css);
            this.editor1 = ace.edit("editor1");
            this.editor2 = ace.edit("editor2");
            this.editor1.setTheme("ace/theme/tomorrow");
            this.editor1.setAutoScrollEditorIntoView(true);
            this.editor1.setOption("minLines", 10);
            this.editor1.setOption("maxLines", 10);
            this.editor2.setTheme("ace/theme/tomorrow");
            this.editor2.setAutoScrollEditorIntoView(true);
            this.editor2.setOption("minLines", 10);
            this.editor2.setOption("maxLines", 10);
            this.checkres();
        },
        ok: function () {
            if (this.data.url == "") {
                this.data.isError = true;
                return;
            }
            var v1 = _._$getValidJSON(this.editor1.getValue());
            var v2 = _._$getValidJSON(this.editor2.getValue());
            var _head = v1 || "";
            var _params = v2 || "";
            var that = this;
            if (that.__xhrProxyToolIsInstalled) {
                that.__sendId = Date.now();
                document.dispatchEvent(new CustomEvent('sendto-xhrpt-ext', {
                    detail: {
                        url: that.data.url,
                        method: that.data.method,
                        data: _params || {},
                        headers: _head || {
                            'Content-Type': 'application/json'
                        },
                        sendId: that.__sendId
                    }
                }));
            } else {
                var _opt = {
                    data: _params,
                    method: that.data.method,
                    onload: function (data) {
                        this.$emit("ok", data);
                        this.destroy();
                    }._$bind(this),
                    onerror: function (data) {
                        Notify.error("获取数据失败");
                    }
                }
                j._$request(this.data.url, _opt);
            }
        },
        checkres: function () {
            if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0)  return;
            var sendId = Date.now();
            var that = this;
            document.addEventListener('check-xhrpt-ext-res', function (_evt) {
                if (!_evt.detail || !_evt.detail.reqData || _evt.detail.reqData.sendId !== sendId) return;
                that.__xhrProxyToolIsInstalled = true;
                document.addEventListener('sendto-xhrpt-ext-res', function (_evt) {
                    if (!_evt.detail || !_evt.detail.reqData || _evt.detail.reqData.sendId !== that.__sendId) return;
                    //that.__displayAPIData(_evt.detail.resData);
                    var res = typeof _evt.detail.resData == "string" ? JSON.parse(_evt.detail.resData || "null") : _evt.detail.resData;
                    //document.removeEventListener(arguments.callee.caller);
                    that.$emit("ok", res);
                    that.destroy();
                }, false);
            }, false);
            document.dispatchEvent(new CustomEvent('check-xhrpt-ext', {
                detail: {
                    sendId: sendId
                }
            }));
        },
        _onChange: function (item) {
            this.data.method = item.id;
        }

    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','ec521e4e62dbac49438faa1e9a253744','a17dfb1aca7e5bcf1c99411da2601159','afb57ef5a0e0ee34baead79fa46d3e43','8cbc286a7834dfcf29c8f7a018e77c02','e26ac58445dd3bc2b730e5275fb45f6f','273bddacbf463ff24f05d250fbefc8a8','82393852694403470c721516b2ba0cc7');
I$('6188f00165529e25019bc5e90d672569',"<div class=\"m-javabean-import f-dn\">\n    <input type=\"file\" accept=\".java\" on-change=\"{this.select()}\"  ref=\"javabean\"/>\n</div>");
I$('be65ad51cf1a5b0cc99dc59ae0a5d4cc',function (_u, Base, Notify, _datatypeCache, jsonbean, db, html) {
    var datatypeCache = _datatypeCache._$$CacheDatatype._$allocate();
    var JavabeanImport = Base.extend({
        template: html,
        config: function () {
            this.data = _u._$merge({
                pid: undefined
            }, this.data);
        },
        init: function () {
            this.$refs.javabean.click();
        },
        select: function () {
            var files = this.$refs.javabean.files;
            if (files.length > 0) {
                var file = files[0];
                if (file.name.match(/.+\.java$/)) {
                    var reader = new FileReader();
                    reader.readAsText(file);
                    var that = this;
                    reader.onload = function (e) {
                        var data = jsonbean.parse(this.result);
                        var items = [];
                        if (data.attributes) {
                            data.attributes.forEach(function (item) {
                                var obj = datatypeCache._$getByJavaDataType(item.type, that.data.pid);
                                item = _u._$merge(item, {
                                    isImport: db.CMN_BOL_NO,
                                    type: obj.id,
                                    isArray:db.CMN_BOL_NO,
                                    typeName: obj.name,
                                    genExpression: '',
                                    valExpression: ''
                                });
                                items.push(item);
                            });
                        }
                        that.$emit('ok', items);
                    };
                } else {
                    Notify.show('请选择适合的javabean文件', 'error', 2000);
                }
            }
            this.$refs.javabean.value = '';
        }
    });
    return JavabeanImport;
},'3ff9c25bd81a3c2a260c28122918263a','ffa820b4cb293ae990489967d5c4a899','afb57ef5a0e0ee34baead79fa46d3e43','afd9bc71d3ea5904e51ae183b2351b6e','27d8cb4fa0c9c5a46d8b26265d908569','993671841dcf289096c7171d53130309','6188f00165529e25019bc5e90d672569');
I$('d8ce7ebe46aadb44eb26b75795b9c6ed',"<div class=\"wrap-editor\">\n    <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n    <table class=\"m-tb-editor m-tb-editor-haxi\">\n        <thead>\n            <tr>\n                <th>名称</th>\n                <th class=\"sel\">类型</th>\n                <th>默认值</th>\n                <th>生成规则</th>\n                <!--<th>验证规则</th>-->\n                <th>描述</th>\n                <th class=\"opt\"></th>\n            </tr>\n        </thead>\n        <tbody>\n            {#list params as p}\n                {#if p.isImport}\n                    <tr class=\"{p_index%2==0?'odd':''}\">\n                        <td><span title={p.name}>{p.name}</span></td>\n                        {#if p.originalType == 10000}\n                        <td><DatatypeSelect pid={pid} type={p.type} typeName={p.typeName} isArray={p.isArray} format={format} hasCreate={hasCreate}  isolate on-change={this._onSelectChange($event,p_index)} noArray={noArray} noObject={noObject}></DatatypeSelect></td>\n                        {#else}\n                            {#if p.isArray == 1}\n                            <td><span title={p.typeName}>Array {p.typeName || \"Object\"}</span></td>\n                            {#else}\n                            <td><span title={p.typeName}>{p.typeName || \"Object\"}</span></td>\n                            {/if}\n                        {/if}\n                        <td><input type=\"text\" class=\"u-input\" r-model={p.defaultValue}/></td>\n                        <td><input type=\"text\" class=\"u-input\"  r-model={p.genExpression} on-click={this.createExp(p_index,'genExpression')} /></td>\n                        <!--<td><input type=\"text\" class=\"u-input\" r-model={p.valExpression} on-click={this.createExp(p_index,'valExpression')} /></td>-->\n                        <td><input type=\"text\" class=\"u-input\" r-model={p.description}/></td>\n                        <td class=\"opt\">\n                            {#if params.length > 1}\n                            <a  title=\"删除\" on-click={this.remove(p_index)}><i title=\"删除\" class=\"u-icon u-icon-no-normal\" ></i><i class=\"u-icon u-icon-no-hover\" ></i></a>\n                            {/if}\n                        </td>\n                    </tr>\n                {#else}\n                    <tr class=\"{p_index%2==0?'odd':''}\">\n                        <td>\n                            <input title={p.name} type=\"text\" class=\"u-input\" {#if p_index===0&&hasTip} on-focus={this.showTip()} on-blur={this.showTip()}{/if} r-class={{\"u-input-error\":p.error}} r-model={p.name}  on-input={this.parseJson($event,p_index)} />\n                        </td>\n                        <td><DatatypeSelect pid={pid} type={p.type} typeName={p.typeName} isArray={p.isArray} format={format} hasCreate={hasCreate}  isolate on-change={this._onSelectChange($event,p_index)} noArray={noArray} noObject={noObject}></DatatypeSelect></td>\n                        <td><input title={p.defaultValue} type=\"text\" class=\"u-input\" r-model={p.defaultValue}/></td>\n                        <td><input title={p.genExpression} type=\"text\" class=\"u-input u-input-exp\" readonly r-model={p.genExpression} on-click={this.createExp(p_index,'genExpression')} /></td>\n                        <!--<td><input title={p.valExpression} type=\"text\" class=\"u-input u-input-exp\" readonly r-model={p.valExpression} on-click={this.createExp(p_index,'valExpression')} /></td>-->\n                        <td><input title={p.description} type=\"text\" class=\"u-input\" r-model={p.description}/></td>\n                        <td class=\"opt opt-2\">\n                            {#if params.length > 1}\n                            <a  title=\"删除\" on-click={this.remove(p_index)}><i title=\"删除\" class=\"u-icon u-icon-no-normal\" ></i><i class=\"u-icon u-icon-no-hover\" ></i></a>\n                            {/if}\n                        </td>\n                    </tr>\n                {/if}\n                {#if p.isObject}\n                    <tr>\n                        <td colspan=\"6\">\n                            <div class=\"no-name-datatype\"><div class=\"arrow\"></div><haxiEditor  params={p.params} noObject={true} isHideFullButton={true} hasCreate={false} pid={pid} format={0} hasTip={false} btns={btns2} ></haxiEditor></div>\n                        </td>\n                    </tr>\n                {/if}\n            {/list}\n        </tbody>\n    </table>\n    <span class=\"u-tip\" r-class={{\"f-dn\":hideTip}} ref=\"tip\">可粘贴JSON字符串</span>\n    <div class=\"operation\">\n        {#list btns as bt}\n            {#if bt==\"add\"}\n                <a class=\"u-btn u-btn-add\" on-click={this.add()}>添加</a>\n            {#elseif bt==\"datatype\"}\n                <a class=\"u-btn u-btn-import\" on-click={this.import('type')}>从数据模型导入</a>\n            {#elseif bt=='datatype2'}\n                <a class=\"u-btn u-btn-import\" on-click={this.import('type2')}>导入类型属性</a>\n            {#elseif bt==\"json\"}\n                <a class=\"u-btn u-btn-import\" on-click={this.import('json')}>从JSON导入</a>\n            {#elseif bt==\"interface\"}\n                <a class=\"u-btn u-btn-import\" on-click={this.import('interface')}>从接口导入</a>\n            {#elseif bt==\"javabean\"}\n                <a class=\"u-btn u-btn-import\" on-click={this.import('javabean')}>从JavaBean导入</a>\n            {/if}\n        {/list}\n    </div>\n</div>");
I$('63ca1c64711b465c55491de71911bb7b',function (v, u, e, _, _notify, Origin, DTImport, JSImport, INTImport, JBImport, tpl) {
    var Haxi = Origin.extend({
        name: 'haxiEditor',
        template: tpl,
        config: function () {
            this.defaultParam = {
                isImport: _.db.CMN_BOL_NO,
                name: '',
                type: _.db.MDL_SYS_STRING,
                typeName: 'String',
                isArray: _.db.CMN_BOL_NO,
                description: '',
                defaultValue: '',
                genExpression: '',
                valExpression: ''
            };
            this.data.btns2 = ['add', 'datatype', 'json', 'interface', 'javabean']; //匿名类型btn
            if (this.data.params && this.data.params.length === 0) {
                this.data.params = null;
            }
            _._$extend(this.data, {
                params: [u._$merge({}, this.defaultParam)],
                hideTip: true,
                hasTip: true,
                isArray: 0,
                noArray: false,
                noObject: false,
                //校验的项
                verifyName: 'name',
                btns: ['add', 'datatype', 'json', 'interface', 'javabean'] //add 添加按钮暂时注释
            });
        },
        init: function () {
            this.supr();
            this.$on('changeObjectType', function (index, result) {
                this.data.params[index].type = result.id;
            });
        },
        add: function (items, position) { //position是添加位置，默认添加到最后
            items = items || [u._$merge({}, this.defaultParam)];
            items.forEach(function (item) {
                if (position != undefined) {
                    this.data.params.splice(position++, 0, item);
                } else {
                    this.data.params.push(item);
                }
            }.bind(this));
            this.$update();
        },
        import: function (type) {
            var modal = null;
            var that = this;
            switch (type) {
                case 'type':
                    var getImportTypeList = function () {
                        //只需要把哈希的类型显示出来就行,同时把已经导入的过滤掉(含嵌套导入)
                        var arr = [];
                        //把已经导入的过滤掉
                        this.data.params.forEach(function (item) {
                            if (item.parentId) {
                                if(arr.indexOf(item.parentId) == -1){
                                    arr.push(item.parentId);
                                }
                            }
                        }.bind(this));
                        return arr;
                    };
                    var datatypeIdList = getImportTypeList.call(this);
                    modal = new DTImport({
                        data: {
                            format: 0,
                            pid: this.data.pid,
                            noObject:this.data.noObject,
                            hasImportList: datatypeIdList
                        }
                    });
                    modal.$on('ok', function (list) {
                        if (!list) return;
                        that.removeEmpty();
                        list.forEach(function (item) {
                            var arr = _._$clone(item.params);
                            //标记是否是导入类型 并且记录原始数据，可能有被复写的字段
                            arr.map(function (item2) {
                                item2.isImport = _.db.CMN_BOL_YES;
                                item2.originals = {
                                    type: item2.type,
                                    defaultValue: item2.defaultValue,
                                    genExpression: item2.genExpression,
                                    valExpression: item2.valExpression,
                                    description: item2.description
                                };
                                if (item2.type == _.db.MDL_SYS_VARIABLE) {
                                    item2.originalType = item2.type;
                                }
                            });
                            that.data.params = that.data.params.concat(arr);
                        });
                        that.add();
                    });
                    break;
                case 'json':
                    modal = new JSImport({});
                    modal.$on('ok', function (json) {
                        that.removeEmpty();
                        that.addJSONData(json);
                        that.add();
                    });
                    break;
                case 'interface':
                    modal = new INTImport({
                        data: {
                            source: [{
                                name: 'GET', id: 'get'
                            }, {
                                name: 'POST', id: 'post'
                            }]
                        }
                    });
                    modal.$on('ok', function (json) {
                        that.removeEmpty();
                        that.addJSONData(json);
                        that.add();
                    });
                    break;
                case 'javabean':
                    modal = new JBImport({
                        data: {
                            pid: that.data.pid
                        }
                    });
                    modal.$on('ok', function (javabean) {
                        that.removeEmpty();
                        that.add(javabean);
                        that.add();
                    });
                    break;
                case 'type2': //匿名类型中，导入类型数据
                    modal = new DTImport({
                        data: {
                            format: 0,
                            pid: this.data.pid
                        }
                    });
                    modal.$on('ok', function (list) {
                        if (!list) return;
                        var addList = [];
                        that.removeEmpty();
                        list.forEach(function (item) {
                            item.params.forEach(function (param) {
                                addList.push({
                                    isImport: _.db.CMN_BOL_NO,
                                    name: param.name,
                                    type: param.type,
                                    typeName: param.typeName,
                                    isArray: _.db.CMN_BOL_NO,
                                    description: param.description,
                                    defaultValue: param.defaultValue,
                                    genExpression: param.genExpression,
                                    valExpression: param.valExpression
                                });
                            });
                        });
                        that.data.params = that.data.params.concat(addList);
                        that.add();
                    });
                    break;

                default:
                    break;
            }
        },
        remove: function (index) {
            var item = this.data.params[index];
            var that = this;
            if (item.isImport) {
                u._$reverseEach(that.data.params, function (item2, i) {
                    //添加状态
                    if(item.originals) {
                        if (item2.parentId == item.parentId) {
                            that.data.params.splice(i, 1);
                        }
                    } else {//修改状态
                        if (item2.datatypeId == item.datatypeId) {
                            that.data.params.splice(i, 1);
                        }
                    }

                });
            } else {
                that.data.params.splice(index, 1);
            }
            if (that.data.params.length == 0) {
                that.add();
            }
        },
        addJSONData: function (_json, position) {
            if (!_json) return;
            if (_json && _json instanceof Array) {
                _json = _json[0];
            }
            var _conf = {
                string: _.db.MDL_SYS_STRING,
                boolean: _.db.MDL_SYS_BOOLEAN,
                number: _.db.MDL_SYS_NUMBER
            };
            var items = [];
            for (var _p in _json) {
                var _type = typeof _json[_p];
                var _v, _t;
                if (_conf[_type]) {
                    _v = _json[_p];
                    _t = _type;
                } else {
                    _v = _json[_p] === null ? "" : JSON.stringify(_json[_p]);
                    _t = 'string';
                }
                _v = (_v.toString() || "").slice(0, 500);//如果默认值过长则直接截断
                items.push({
                    name: _p,
                    isImport: _.db.CMN_BOL_NO,
                    typeName: _p,
                    type: _conf[_t],
                    isArray: _.db.CMN_BOL_NO,
                    defaultValue: _v,
                    description: '',
                    genExpression: '',
                    valExpression: ''
                });
            }
            this.add(items, position);
        },
        parseJson: function (event, index) { //name中输入json,直接解析json添加
            var value = event.target.value;
            try {
                var json = JSON.parse(value);
                if (typeof json === 'object') {
                    this.remove(index);
                    this.addJSONData(json, index);
                }
            } catch (er) {
            }
        },
        _onSelectChange: function (event, index) {
            this.supr(event, index);
            if (event.typeName == 'Object') { //进入匿名类型创建流程
                this.data.params[index].isObject = true;
                this.data.params[index].type = 0;//匿名类型的type设置为0
                this.data.params[index].params = [u._$merge({}, this.defaultParam)];
            } else {
                this.data.params[index].isObject = false;
                delete this.data.params[index].params;
            }
        },
        showTip: function () {
            this.data.hideTip = !this.data.hideTip;
        },
        destroy: function () {
            this.supr();
        }
    });
    return Haxi;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','afb57ef5a0e0ee34baead79fa46d3e43','06caca77b0108dddd978f7bb094c6943','e2ff6690ab8b15389357e398ea59abd9','16afe76b284216512cb18db2caca44c6','2596f2d6d1b058745ae490f532ef918b','be65ad51cf1a5b0cc99dc59ae0a5d4cc','d8ce7ebe46aadb44eb26b75795b9c6ed');
I$('4c51c3c9fcc8e37540b37265fb595e5b',"<div class=\"m-editor m-editor-edit \">\n    <div class=\"j-editor\" ref=\"editor\"></div>\n</div>\n");
I$('57e3b9df7718b85d95f4d0c27c001706',".m-modal-create .modal-dialog{\n\twidth:80%;\n}\n.m-modal-create .u-input{\n\twidth:100%;\n\theight:30px;\n}\n.m-modal-create .m-tb-editor{\n\twidth:100%;\n\tborder:solid 1px #e6e6e6;\n}\n.m-modal-create .m-tb-editor td,.m-modal-create .m-tb-editor th{\n\tpadding:0px 4px;\n\theight:40px;\n}\n.m-modal-create .m-tb-editor thead tr{\n\theight:40px;\n}\n.m-modal-create .m-tb-editor thead th{\n\tborder-bottom:1px solid #efefef;\n\tbackground:#f5f5f5;\n}\n.m-modal-create .m-tb-editor tbody tr{\n\tbackground:#fff;\n}\n.m-modal-create .m-tb-editor .opt{\n\ttext-align:center;\n}\n.m-modal-create .m-tb-editor .opt a .u-icon-no-hover{\n\tdisplay:none;\n}\n.m-modal-create .m-tb-editor .opt a:hover .u-icon-no-hover{\n\tdisplay:inline-block;\n}\n.m-modal-create .m-tb-editor .opt a:hover .u-icon-no-normal{\n\tdisplay:none;\n}\n.m-modal-create .m-tb-editor-haxi .sel{\n\tmin-width:200px;\n}\n.m-modal-create .m-editor .u-btn{\n\theight:30px;\n\tline-height:30px;\n\tbackground:#fff;\n\tcolor:#555;\n\tpadding:0 15px;\n\tborder:1px solid #efefef;\n}\n.m-modal-create .m-editor .operation{\n\tpadding-top:10px;\n\ttext-align:left;\n}\n.j-editor{\n\tposition:relative;\n}\n.j-editor .u-tip{\n\tposition:absolute;\n\ttop:5px;\n\tleft:70px;\n\tpadding:2px 3px 2px 3px;\n\tborder-radius:3px;\n\tcolor:#fff;\n\tbackground-color:#424a54;\n\toverflow:visible;\n}\n.j-editor .u-tip:before{\n\tposition:absolute;\n\tcontent:\"\";\n\tleft:10%;\n\ttop:22px;\n\tborder:6px solid transparent;\n\tborder-top:6px solid #424a54;\n}");
I$('45874765e6e05636b88db04079ba223a',function (e, v, u, Modal, _,cache, parameterCache, HXEditor, tpl, css) {
    var modal = Modal.extend({
        config: function () {
            var _title = "";
            if (this.data && this.data.action == "modify") {
                _title = "修改数据模型";
                this.data.originalData = _._$clone(this.data.params.slice(0));
            } else {
                _title = "创建数据模型";
            }
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-modal-create',
                'title': _title,
                'closeButton': true,
                "okButton": true,
                "cancelButton": true,
                format: 0 //0 哈希
            });
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
            e._$addStyle(css);
            this.__cache = cache._$$CacheDatatype._$allocate({
                onitemadd: function (option) {
                    this.$emit("ok", option.data);
                    this.destroy();
                }._$bind(this)
            });
            this.initEditor();
        },
        initEditor: function () {
            var node = this.$refs.editor;
            this.editor = new HXEditor({
                data: {
                    format: this.data.format,
                    params: this.data.params,
                    hasCreate: false,
                    noArray: this.data.noArray || true,
                    noObject: this.data.noObject || true,
                    pid: this.data.pid,
                    btns:['add', 'datatype2', 'json', 'interface', 'javabean']
                }
            }).$inject(node);
        },
        ok: function () {
            if (this.data.action == "modify") {
                this.__paramcache = parameterCache._$$CacheParameter._$allocate({});
                this.__paramcache._$updateAnonymousDatatype({
                    key: "anonymous-datatype-modify",
                    data: {
                        datatypeId: this.data.datatypeId,
                        projectId: this.data.pid,
                        type: 2,
                        params: this.formatParams()
                    },
                    ext: {
                        uuid: this.data.uuid
                    }
                });
                this.destroy();
            } else {
                //type:2 匿名数据模型
                this.__cache._$addItem({
                    key:this.__cache._$getListKey(this.data.pid),
                    data: {
                        projectId: this.data.pid,
                        type: 2,
                        params: this.removeEmpty()
                    }
                });
            }
        },
        removeEmpty: function () {
            var tml = this.editor.data.params.slice(0);
            var verifyName = this.editor.data.verifyName;
            u._$reverseEach(this.editor.data.params, function (item, index) {
                if (item[verifyName] == "") {
                    tml.splice(index, 1);
                }
                delete item.error;
               // delete item.typeName;
            });
            return tml;
        },
        formatParams: function () {
            var params = this.removeEmpty();
            var newparams = [];
            var delPool = [];//删除的参数列表
            var addPool = []; //增加的参数列表
            var updatePool = [];//修改的参数列表
            var isSame = function (obj1, obj2) {
                var bl = true;
                for (var key in obj1) {
                    if (obj1[key] !== obj2[key]) {
                        bl = false;
                    }
                }
                return bl;
            };
            this.data.originalData.forEach(function (item1) {
                var isExist = false;
                params.forEach(function (item2) {
                    if (item1.id == item2.id) {
                        isExist = true;
                        if (!isSame(item1, item2)) {
                            item2.action = "update";
                            updatePool.push(item2);
                        }
                    }
                });
                if (!isExist) {
                    delPool.push({id: item1.id, action: "delete"});
                }
            });
            params.forEach(function (item) {
                if (!item.id) {
                    item.action = "add";
                    addPool.push(item);
                }
            });
            newparams = newparams.concat(addPool).concat(delPool).concat(updatePool);
            return newparams;
        },
        _onclickBody: function ($event) {
            $event.stopPropagation();
        }
    });
    return modal;

},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','afd9bc71d3ea5904e51ae183b2351b6e','35e8999e6afda708a192e93b3e184448','63ca1c64711b465c55491de71911bb7b','4c51c3c9fcc8e37540b37265fb595e5b','57e3b9df7718b85d95f4d0c27c001706');
I$('df403282cd069723202157e2f382c325',"<textarea name=\"ntp\" id=\"#<cnt>\">\n    <div style=\"width: 100%\">\n        <div class=\"j-dataselect\"></div>\n    </div>\n</textarea>");
I$('63b8d54a51dec3a9c34562475cdbde2f',function (k, v, e, u, c, ui, tpl, _, DatatypeSelect, html, p, pro) {

    p._$$DataTypeSelect = k._$klass();
    pro = p._$$DataTypeSelect._$extend(ui._$$Abstract);

    pro.__init = function (options) {
        this.__super(options);
        this.__pid = options.pid;
    }

    pro.__reset = function (options) {
        this.__super(options);
        //backOpen为true则默认打开后面数据类型下拉框
        this.__datatypeSelect = new DatatypeSelect({
            data: {
                pid: this.__pid,
                isArray:options.isArray,
                noArray:options.noArray,
                noObject:options.noObject,
                noCreate:options.noCreate,
                selected: options.selected,
                choseOnly: options.choseOnly,
                format:options.format,
                backOpen:options.backOpen,
                isOpen:options.backOpen? false : true
            }
        }).$inject(this.__box).$on("change", function (options) {
            that._$dispatchEvent("ondatatypechange", options);
        });
        var that = this;
        var _handle = function () {
            v._$delEvent(document, "click", _handle);
            that._$dispatchEvent("onclickout");
           // that.__destroy();
        }

        v._$addEvent(document, "click", _handle);
        v._$addEvent(this.__box, "click", function (event) {
            v._$stop(event);
        })
    }

    pro.__initXGui = (function () {
        var seed = tpl._$parseUITemplate(html);
        return function () {
            this.__seed_html = seed.cnt;
        };
    })();

    pro.__initNode = function () {
        this.__super();
        this.__box = e._$getByClassName(this.__body, 'j-dataselect')[0];
    };

    pro.__destroy = function () {
        this.__super();
         if(this.__datatypeSelect) this.__datatypeSelect.destroy();
    }
    return p;
},'5e5afc6c5ab9a60e963a7e2e41706b91','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','8717e18cf0d38e654531116f64f5593d','d81f928b2e8dc2e94031eba0a018b644','356c13c039fe43b0aa515c031d53f736','8cbc286a7834dfcf29c8f7a018e77c02','8a91df09bcc0c19dbe9fe08d3f2b1a25','df403282cd069723202157e2f382c325');
I$('0b3121b7f174647bbf13907302d09704',
{
    "0":[
        {"action":"type","name":"从数据模型导入","format":0},
        {"action":"json","name":"从JSON导入"},
        {"action":"interface","name":"从接口导入"},
        {"action":"JavaBean","name":"从JavaBean导入"},
        {"action":"modify","name":"修改类型","sub":[{"format":1,"name":"枚举"},{"format":2,"name":"数组"},{"format":3,"name":"字符"},{"format":4,"name":"数值"},{"format":5,"name":"布尔"},{"format":6,"name":"文件"}]}
    ],
    "1":[
        {"action":"type","name":"从数据模型导入","format":1},
        {"action":"json","name":"从JSON导入"},
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":2,"name":"数组"},{"format":3,"name":"字符"},{"format":4,"name":"数值"},{"format":5,"name":"布尔"},{"format":6,"name":"文件"}]}
    ],
    "2":[
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":1,"name":"枚举"},{"format":3,"name":"字符"},{"format":4,"name":"数值"},{"format":5,"name":"布尔"},{"format":6,"name":"文件"}]}
    ],
    "3":[
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":1,"name":"枚举"},{"format":2,"name":"数组"},{"format":4,"name":"数值"},{"format":5,"name":"布尔"},{"format":6,"name":"文件"}]}
    ],
    "4":[
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":1,"name":"枚举"},{"format":2,"name":"数组"},{"format":3,"name":"字符"},{"format":5,"name":"布尔"},{"format":6,"name":"文件"}]}
    ],
    "5":[
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":1,"name":"枚举"},{"format":2,"name":"数组"},{"format":3,"name":"字符"},{"format":4,"name":"数值"},{"format":6,"name":"文件"}]}
    ],
    "6":[
        {"action":"modify","name":"修改类型","sub":[{"format":0,"name":"哈希"},{"format":1,"name":"枚举"},{"format":2,"name":"数组"},{"format":3,"name":"字符"},{"format":4,"name":"数值"},{"format":5,"name":"布尔"}]}
    ],
    "7":[{"action":"add","name":"添加"}],
    "8":[{"action":"add","name":"添加"}],
    "9":[{"action":"add","name":"添加"}],
    "header":[
        {"action":"type","name":"从数据模型导入"},
        {"action":"json","name":"从JSON导入"},
        {"action":"interface","name":"从接口导入"}
    ]
}
);
I$('21e60f10d379f72bec8b55df7f7ea110',"<div class=\"list-row list-empty\">\n    {#if level==0}\n    <div>没有{emptyTip}</div>\n    {#else}\n        {#if xlist.length}\n        <div>1、没有{emptyTip}，你可以\n            {#list xlist as p}\n            <a data-active={p.action} on-click={this._onAction(p.action)}>{p.name}</a>\n            {#if p_index !=xlist.length-1}\n            <span>/</span>\n            {/if}\n            {/list}\n            来添加{emptyTip}\n        </div>\n        {/if}\n        {#if mlist.length}\n            <div>2、通过\n                <select2 source={source} selected={selected}  on-change={this._onChange($event)}  hasCreate={false} initSilent={true} format={format} sortList={false} choseOnly={true} isDataType={false} isArray={false} noArray={true} noObject={true}></select2>\n                来调整类型\n            </div>\n        {/if}\n    {/if}\n</div>");
I$('5041be82421d0a0447f1be899be3d266',function (b, v,u, e,_,config,tpl){
   var ParamsEmpty = b.extend({
       name:"params-empty",
       template:tpl,
       config:function () {
           _._$extend(this.data,{
                source:[{id:0,name:"哈希"},{id:1,name:"枚举"},{id:2,name:"数组"},{id:3,name:"字符"},{id:4,name:"数值"},{id:5,name:"布尔"},{id:6,name:"文件"}]
           });
           this.data.selected = this.data.source[this.data.format];
           this.data.xlist = config[this.data.format].filter(function (item) {
               return item.action != "modify";
           });
           this.data.mlist = config[this.data.format].filter(function (item) {
               return item.action == "modify";
           });
           if(this.data.parentType == 0 || this.data.parentType == 1) {
               this.data.mlist = [];
           }
           if(this.data.format == 7) {
               this.data.emptyTip = "变量映射规则";
           } else {
               this.data.emptyTip = "参数信息";
           }
           this.supr(this.data);
       },
       init:function () {
           this.supr();
       },
       _onChange:function ($event) {
           this.$parent._onMenuCheck({
               format:$event.selected.id,
               action:"modify"
           }); 
       },
       _onAction:function (type) {
           if(type == "add") {
               this.$parent.add();
           } else {
               this.$emit("import",type);
           }
       }
       
   });
    return ParamsEmpty;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','0b3121b7f174647bbf13907302d09704','21e60f10d379f72bec8b55df7f7ea110');
I$('d5335917210a28263bbdba7d958fb304',"<div class=\"u-edit-menu\">\n    <ul class=\"parent\">\n        {#list list as item}\n            {#if item.sub}\n                <li>\n                    {item.name}\n                    <ul class=\"sub\">\n                        {#list item.sub as p}\n                            <li on-click = {this.select(item.action,p.format)}>{p.name}</li>\n                        {/list}\n                    </ul>\n                </li>\n            {#else}\n                <li on-click = {this.select(item.action,item.format)}>{item.name}</li>\n            {/if}\n        {/list}\n    </ul>\n</div>");
I$('0cbedaafaaef362bb96cfc018c2427b4',function ( v,u, e,_,cache,Base,config,tpl){

    var Menu = Base.extend({
        name:"param-menu",
        template:tpl,
        config:function (data) {
            _._$extend(this.data,{
                format:"haxi"
            });
            this.data.list = config[this.data.format];
            if(this.data.parentType == 0 || this.data.parentType == 1) {
                this.data.list = this.data.list.filter(function (item) {
                    return item.action !="modify";
                })
            }
            this.supr(this.data);
        },
        init:function () {
            this.supr();
        },
        select:function (action,format) {
            this.$emit("check",{
                action:action,
                format:format
            })
        }

    });
    return Menu;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','35e8999e6afda708a192e93b3e184448','ffa820b4cb293ae990489967d5c4a899','0b3121b7f174647bbf13907302d09704','d5335917210a28263bbdba7d958fb304');
I$('9f2ac4093164ae1f0ba25e9a5aa10cda',"<div class=\"u-prolist j-flag\">\n    <div class=\"plist\">\n        <div class=\"link\" r-hide={type === 2}>\n            <a href=\"/datatype/detail/?pid={pid}&id={id}\" on-click={this._goto($event,pid,id)} class=\"stateful\">查看详情</a> <i class=\"u-icon-arrow-right-normal\"></i>\n        </div>\n        <dl>\n            {#if formatType == 0}\n            <dt><span>名称</span><span>类型</span><span>描述</span></dt>\n            {#list plist as p}\n            <dd r-hide={p.ignored}><span title={p.name}>{p.name}</span><span title={p.typeName}>{#if p.isArray == 1}Array{/if} {p.typeName}</span><span title={p.description}>{p.description}</span></dd>\n            {/list}\n            {#elseif formatType ==1}\n            <dt><span>值</span><span>描述</span></dt>\n            {#list plist as p}\n            <dd r-hide={p.ignored}><span title={p.defaultValue}>{p.defaultValue}</span><span title={p.description}>{p.description}</span></dd>\n            {/list}\n            {#else}\n            <dt><span>默认值</span><span>描述</span></dt>\n            {#list plist as p}\n            <dd r-hide={p.ignored}><span title={p.defaultValue}>{p.defaultValue}</span><span title={p.description}>{p.description}</span></dd>\n            {/list}\n            {/if}\n        </dl>\n    </div>\n</div>\n\n");
I$('c556614d06521a7c00a2c6195d98e78a',function (v, u, e, _, cache, Base, tpl) {

    var Menu = Base.extend({
        name: "type-property",
        template: tpl,
        config: function (data) {
            _._$extend(this.data, {
                plist: []
            });
            this.initDom();
            this.supr(data);
        },
        _goto: function ($event,pid, id) {
            $event.stopPropagation();
            $event.preventDefault();
            dispatcher._$redirect('/datatype/detail/?pid=' + pid + '&id=' + id);
        },
        init: function () {
            this.supr();
            var that = this;
            this.$watch(id, function () {
                that.initDom();
            });
            Regular.dom.on(Regular.dom.element(this), 'click', function (event) {
                v._$stopBubble(event)
            });
        },
        initDom: function () {
            this.__dttypecache = cache._$$CacheDatatype._$allocate({
                onlistload: function (options) {
                    var _opt = this.__dttypecache._$getItemInCache(this.data.id) || [];
                    this.data.type = _opt.type;
                    this.data.formatType = _opt.format;
                    this.data.plist = _opt.params;
                    this.$update();
                }.bind(this)
            });
            this.__dttypecache._$getList({
                key: this.__dttypecache._$getListKey(this.data.pid),
                data: {
                    pid: this.data.pid
                }
            });
        }
    }).filter({
        "ctrShow":function (format) {
            if(format === 3 || format === 4 || format === 5) {
                return false;
            }
            return true;
        }
    });
    return Menu;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','afd9bc71d3ea5904e51ae183b2351b6e','ffa820b4cb293ae990489967d5c4a899','9f2ac4093164ae1f0ba25e9a5aa10cda');
I$('b31c404fb56f8a2ff6a6612a1c293cd9',"<div class=\"list-row list-header\">\n    {#if level !=0}\n    <div class=\"list-col list-col-check\" r-class={{\"selected\":allChecked}} on-click={this.selectAll()}><i class=\"u-icon-checkbox-normal\"></i><i class=\"u-icon-checkbox-pressed\"  ></i></div>\n    {/if}\n    {#if hasChecked}\n    <div class=\"batch-action\">\n        <span class=\"sel-num\">(已选 <em>{checkNum}</em> 项)</span>\n        <span><a  class=\"batch-action-item\" on-click={this.doAppendModel()}>生成模型</a><a  class=\"batch-action-item\" on-click={this.batRemove()}>删除</a></span>\n        <a class=\"quick-action\" href=\"#\" on-click={this.clearSelected($event)}>取消选择</a>\n        <a class=\"quick-action\" href=\"#\" on-click={this.reverseSelected($event)}>反向选择</a>\n    </div>\n    {#else}\n        {#if format == 0}\n        <div class=\"list-col list-col-name\"><em>名称</em></div>\n        <div class=\"list-col list-col-type\"><em>类型</em></div>\n        <div class=\"list-col\"><em>默认值</em></div>\n        <div class=\"list-col\"><em>生成规则</em></div>\n        <div class=\"list-col\"><em>描述</em></div>\n        <div class=\"list-col list-col-require\" r-hide={!isRequire}><em>必需</em></div>\n        <div class=\"list-col list-col-do\"></div>\n        {#elseif format == 1}\n        <div class=\"list-col list-col-name\"><em>值</em></div>\n        <div class=\"list-col list-col-type\"><em>类型</em></div>\n        <div class=\"list-col\"><em>键（可选）</em></div>\n        <div class=\"list-col\"><em>描述</em></div>\n        <div class=\"list-col list-col-do\"></div>\n        {#elseif format == \"header\"}\n            <div class=\"list-col\"><em>名称</em></div>\n            <div class=\"list-col\"><em>值</em></div>\n            <div class=\"list-col\"><em>描述</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        {#else}\n        {/if}\n    {/if}\n\n</div>\n\n");
I$('0b097d3f3dbc567e9afd06238599e353',function (v, u, e, _, cache, Base, tpl) {

    var ListHead = Base.extend({
        name: "list-head",
        template: tpl,
        config: function (data) {
            _._$extend(this.data, {
                checked:false,
                allChecked:false,
                hasChecked:false
            });

            this.supr(data);
        },
        selectAll:function () {
            this.data.allChecked = this.data.hasChecked = !this.data.allChecked;
            this.$emit("headstatuschange", this.data.allChecked);
        },
        init: function () {
            this.supr();
        },
        listCheckChanged:function (listStatus) {
            this.data.allChecked = true;
            var checkNum = 0;
            for(var key in listStatus){
                if(!listStatus[key]){
                    this.data.allChecked = listStatus[key];
                } else {
                    this.data.hasChecked = listStatus[key];
                    checkNum ++;
                }
            }
            this.data.checkNum = checkNum;
            if(checkNum === 0) {
                this.data.allChecked = this.data.hasChecked = false;
            }
        },
        clearSelected:function () {
            this.data.hasChecked = false;
            this.data.allChecked = false;
            this.$emit("headstatuschange", false);
        },
        reverseSelected:function () {
            if(this.data.allChecked) {
                this.data.hasChecked = this.data.allChecked = !this.data.allChecked;
            }
            this.$emit("reverseSelected");
        },
        resetSelected:function () {
            this.data.hasChecked = false;
            this.data.allChecked = false;
            this.data.checkNum = 0;
            this.$update();
        },
        batRemove:function () {
            this.$emit("batRemove");
        },
        doAppendModel:function () {
            this.$emit("appendModel");
        },
        reset:function () {
            this.data.hasChecked = false;
            this.data.allChecked = false;
        }
    });
    return ListHead;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','afd9bc71d3ea5904e51ae183b2351b6e','ffa820b4cb293ae990489967d5c4a899','b31c404fb56f8a2ff6a6612a1c293cd9');
I$('b9bf71df2275ed934dc9e7d2d360c5ce',function (base, v, u, e, _, Notify, Modal, DTModel, DatatypeSelect2, DTImport, JSImport, INTImport, JBImport, ParamsEmpty, GRule, Menu, params_property,list_head, cofcache) {
    var Origin = base.extend({
        config: function () {
    
        },
        init: function () {
            //获取rugular组件本身的dom节点：Regular.dom.element(this);
            this._onClickAction = this._onClickAction || function (event) {
                    var isClickType = e._$hasClassName(event.target,"backtype");
                    var target = v._$getElement(event, "d:active");
                    if (!target) return;
                    var actionData;
                    try {
                        actionData = u._$query2object(e._$dataset(target, 'active'));
                    } catch (err) {
                        return console.error(err);
                    }
                    switch (actionData.actionType) {
                        case 'input':
                            // v._$stopBubble(event);
                            this._modifyInputValue(target, actionData);
                            break;
                        case 'select':
                            v._$stopBubble(event);
                            this._modifySelectValue(target, actionData,isClickType);
                            break;
                        case "expression":
                            v._$stopBubble(event);
                            this._modifyExpressionValue(target, actionData);
                            break;
                        default:
                            break;
                    }
                }.bind(this);
            this._onKeyupAction = this._onKeyupAction || function (event) {
                    var node = v._$getElement(event, "d:enter");
                    if (!node || event.which != 13) return;
                    var index = e._$dataset(node, "enter");
                    this.update(index);
                }.bind(this);
            Regular.dom.on(Regular.dom.element(this), 'click', this._onClickAction);
            Regular.dom.on(Regular.dom.element(this), 'keyup', this._onKeyupAction);
        },
        /**
         * 获取缓存实体
         * @param type
         * @returns {*}
         * @private
         */
        _getCacheInstance:function (type) {
            if(this["__"+type+"cache"]) return this["__"+type+"cache"];
            var cache =  this["__"+type+"cache"] =  cofcache[type]._$allocate({
                onitemsadd:function (option) {
                    this.data.isSending = false;
                    if(option.ext && option.ext.cache == "iHeader"){
                        if(option.ext.action == "importAdd"){
                            this.data.params = this.data.params.concat(this.formatParamsSource(option.data.params));
                        } else {
                            var item = this.data.params[option.ext.index];
                            u._$merge(item,option.data.params[0]);
                            this.data.params[option.ext.index].isAdding = false;
                            item.nameSelected = {
                                id:item.name,
                                name:item.name
                            };
                            item.defaultValueSelected = {
                                id:item.defaultValue,
                                name:item.defaultValue
                            };
                        }
                        this.$update();
                    } else if(option.ext && option.ext.action == "importAdd"){//通过导入json、数据模型、在线接口、javabean等添加参数
                        this.data.params = this.data.params.concat(this.formatParamsSource(option.data.params));
                        this.$update();
                    } else {
                        u._$merge(this.data.params[option.ext.index],option.data.params[0]);
                        this.data.params[option.ext.index].isAdding = false;
                        this.$update();
                    }
                }._$bind(this),
                onitemsdelete:function (option) {
                    //批量删除
                    var _this = this;
                    if(typeof option.ext.index === "object"){
                        var obj = option.ext.index;
                        u._$reverseEach(obj.imports,function (_id) {
                           _this.data.params.forEach(function (item,i) {
                                if(item.datatypeId == _id){
                                    _this.data.params.splice(i,1);
                                }
                           });
                        });
                        u._$reverseEach(obj.params,function (_id) {
                           _this.data.params.forEach(function (item,i) {
                               if(item.id == _id) {
                                   _this.data.params.splice(i,1);
                               }
                           });
                        });
                        this.resetHeadStatusCom();
                    } else {
                        this.data.params.splice(option.ext.index,1);
                    }
                    this.$update();
                }._$bind(this),
                onitemupdate:function (option) {
                    //如果是切换编辑器的类型，则不需要做其它处理
                    if(option.ext.action == "menuchange") {
                        return;
                    }
                    //如果有回调则先处理回调
                    if(typeof option.ext.callback == "function"){
                        option.ext.callback();
                    }
                    //索引是二维的说明是导入类型
                    var x = (option.ext.index + "").split("-")[0];
                    var y= (option.ext.index + "").split("-")[1];
                    if(y !== undefined) {
                        delete this.data.params[x].imports[y].isObjectType;
                        delete this.data.params[x].imports[y].isEditObjectType;
                        u._$merge(this.data.params[x].imports[y],option.data.params[0]);
                    }else {
                        delete this.data.params[option.ext.index].isObjectType;
                        delete this.data.params[option.ext.index].isEditObjectType;
                        u._$merge(this.data.params[option.ext.index],option.data.params[0]);
                    }
                    this.$update();
                }._$bind(this),
                onerror:function (option) {
                    var options = option.options;
                    //添加失败的时候要把正在添加参数的状态置为false;
                    if(options.ext && (options.ext.action || "").toLowerCase().indexOf("add") !== -1) {
                        this.data.isSending = false;
                    }
                }._$bind(this)
            });
            return cache;
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         */
        update: function (index) {
            // if (this.data.sending) return;
            var _imports = [];
            var _params = [this.data.params[index]];
            var _ext = {
                action: "add",
                index: index
            };
            if (!this.validate(this.data.params[index])) return;
            this._doUpdateParams(_params,_imports,_ext);
        },
        /**
         * 发送添加参数的ajax请求
         * @param _params
         * @param _imports
         * @param _ext
         * @private
         */
        _doUpdateParams:function (_params,_imports,_ext) {
            if(this.data.isSending) return;
            _ext.uuid = this.data.uuid;
            var $cache = null;
            if (this._isIHeader()) {
                $cache = this._getCacheInstance("iHeader");
                _ext.cache = "iHeader";
            } else {
                $cache = this._getCacheInstance("parameter");
                _ext.cache = "parameter";
                _ext.pid = this.data.pid
            }
            this.data.isSending = true;
            $cache._$addItems({
                data: {
                    params: _params,
                    imports: _imports,
                    parentType: this.data.parentType,
                    parentId: this.data.parentId
                },
                onerror: function (option) {
                    console.log("error");
                }._$bind(this),
                ext: _ext
            });
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            var item = null, _params = [], _imports = [], $cache = null;
            if(typeof index === "number") {//单条数据删除
                item = this.data.params[index];
                if (item.isAdding) {
                    this.data.params.splice(index, 1);
                    return;
                }
                if (item.isImport) {
                    _imports.push(item.datatypeId);
                } else {
                    _params.push(item.id);
                }
            } else {//批量删除
                _imports = index.imports;
                _params = index.params;
            }

            var _data = {};
            if (this.data.format == 7) {//如果是变量映射
                _data = {
                    ids: _params.join(",")
                }
                $cache = this._getCacheInstance("varmap");
            } else if (this.data.format == 8) {
                _data = {
                    ids: _params.join(",")
                };
                $cache = this._getCacheInstance("cliArg");
            } else if (this.data.format == 9) {
                _data = {
                    ids: _params.join(",")
                };
                $cache = this._getCacheInstance("jarmap");
            } else {
                _data = {
                    parentId: this.data.parentId,
                    parentType: this.data.parentType,
                    params: _params.join(","),
                    imports: _imports.join(",")
                };
                if (this._isIHeader()) {
                    $cache = this._getCacheInstance("iHeader");
                } else {
                    $cache = this._getCacheInstance("parameter");
                }
            }
            var options = {
                key: this.data.listKey,
                data: _data,
                ext: {
                    uuid: this.data.uuid,
                    index:index
                }
            };
            if (this.data.format == 7 || this.data.format == 8 || this.data.foramt == 9) {
                options["key"] = this.data.listKey;
            }
            $cache._$deleteItems(options);
        },
        /***
         * 参数的导入操作 (导入类型、导入json、在线接口、javabean)
         * @param type
         */
        import: function (type) {
            var modal = null;
            var that = this;
            var _imports = [], _params = [], _ext = null;
            var doUpdate = function (list,importType) {
                if (importType == "type") {
                    u._$forEach(list, function (item) {
                        _imports.push({id: item.id, vars: []});
                    });
                    _params = [];
                } else {
                    // //用来区分导入json或者在线接口的回调也走正常添加的流程
                    // this.data.isAdding = true;
                    _params = list;
                    _imports = [];
                }
                //从参数列表后面追加
                var index = this.data.params.length + 1;
                _ext = {
                    action: "importAdd",
                    index:index
                }
                this._doUpdateParams(_params,_imports,_ext);
            }._$bind(this);
            if (type == "type") {
                var getImportTypeList = function () {
                    //只需要把哈希的类型显示出来就行,同时把已经导入的过滤掉(含嵌套导入)
                    var arr = [];
                    //如果是数据模型的话还要把自己给过滤掉
                    if (this.data.parentType == 4) {
                        arr.push(this.data.resourceId);
                    }
                    //把已经导入的过滤掉
                    this.data.params.forEach(function (item) {
                        if (item.datatypeId) {
                            arr.push(item.datatypeId);
                           //  item.imports.forEach(function (item2) {
                           //      if (arr.indexOf(item2.originalDatatypeId) == -1 && item2.originalDatatypeId) {
                           //          arr.push(item2.originalDatatypeId);
                           //      }
                           //  });
                        }
                    }.bind(this));
                    return arr;
                };
                var datatypeIdList = getImportTypeList.call(this);
                modal = new DTImport({
                    data: {
                        format: this.data.format,
                        pid: this.data.pid,
                        hasImportList: datatypeIdList
                    }
                });
                modal.$on("ok", function (list) {
                    if (!list) return;
                    doUpdate(list, type);
                })
            } else if (type == 'json') {
                modal = new JSImport({});
                modal.$on('ok', function (json) {
                    var list = that.formatJSONData(json);
                    if(!list.length) return;
                    doUpdate(list, type);
                })
            } else if (type == "JavaBean") {
                modal = new JBImport({
                    data: {
                        pid: this.data.pid
                    }
                });
                modal.$on('ok', function (javabean) {
                    //  var list = that.formatJSONData(json);
                    doUpdate(javabean, type);
                });
            } else {
                modal = new INTImport({
                    data: {
                        source: [{
                            name: "GET", id: 'get'
                        }, {
                            name: "POST", id: 'post'
                        }]
                    }
                });
                modal.$on('ok', function (json) {
                    var list = that.formatJSONData(json);
                    if(!list.length) return;
                    doUpdate(list, type);
                });
            }

        },
        /***
         * 校验当前添加项的值
         * @param item
         * @returns {boolean}
         */
        validate: function (item) {
            var _params = this.data.params;
            var verifyName = this.data.verifyName;
            if (item[verifyName] == "") {
                item['error'] = true;
                return false;
            }
            for (var i = 0, len = _params.length; i < len; i++) {
                if (_params.indexOf(item) != -1) continue;
                if (item[verifyName] == _params[i][verifyName]) {
                    item['error'] = true;
                    return false;
                }
            }
            //去掉多余的参数
            // delete item.isAdding;
            delete item.isImport;
            delete item.datatypeId;
            return true;
        },
        _isIHeader: function () {
            return this.data.format == 0 && this.data.shape == "header";
        },
        /**
         * 创建规则函数表达式
         * @param index
         */
        createExp: function (index, key, callback) {
            var that = this;
            //说明是导入类型，二维数组,用-分开
            if (index.toString().indexOf("-") > 0) {
                var index1 = index.split("-")[0];
                var index2 = index.split("-")[1];
                var modal = new GRule({
                    data:{
                        pid:this.data.pid,
                        value: that.data.params[index1].imports[index2][key]
                    }
                }).$on("ok",function (val) {
                    if (callback) {
                        callback(val);
                    } else {
                        that.data.params[index][key] = val;
                    }
                    that.$update();
                });
            } else {
                var modal = new GRule({
                    data:{
                        pid:this.data.pid,
                        value: that.data.params[index][key]
                    }
                }).$on("ok",function (val) {
                    if (callback) {
                        callback(val);
                    } else {
                        that.data.params[index][key] = val;
                    }
                    that.$update();
                });
            }
        },
        /**
         * 监听数据模型选择器change事件 创建状态的数据模型选择器
         * @param item
         * @param index
         * @private
         */
        _onSelectChange: function (item, index) {
            if (!item) return;
            if (item.typeName == 'Object') { //进入匿名类型创建流程
                this.data.params[index].isObjectType = true;
            } else {
                if(this.data.params[index].isObjectType) {//从匿名类型切换非匿名类型
                    this.data.params[index].isObjectType = false;
                    delete this.data.params[index].attrs ;
                } else {//从非匿名类型切换非匿名类型
                    this.data.params[index].type = item.type;
                    this.data.params[index].typeName = item.typeName;
                    this.data.params[index].isArray = item.isArray;
                }
            }
        },
        formatJSONData: function (_json) {
            if (!_json) return [];
            if (_json && _json instanceof Array) {
                _json = _json[0];
            }
            var _conf = {
                string: '10001',
                number: '10002',
                boolean: '10003'
            }
            var arr = [];
            for (var _p in _json) {
                var _type = typeof _json[_p];
                var _v, _t;
                if (_conf[_type]) {
                    _v = _json[_p];
                    _t = _type;
                } else {
                    _v = _json[_p] === null ? "":  JSON.stringify(_json[_p]);
                    _t = 'string';
                }
                _v = (_v.toString() || "").slice(0,500);//如果默认值过长则直接截断
                arr.push({
                    isImport: false,
                    name: _p,
                    type: _conf[_t],
                    isArray: _.db.CMN_BOL_NO,
                    defaultValue: _v,
                    expression: ""
                });
            }
            return arr;
        },
        formatParamsSource: function (params) {
            if (!u._$isArray(params) || params.length == 0) return [];
            var _params = [];
            var _temp = {};
            for(var i = 0,len = params.length;i<len;i++){
                if(!params[i].datatypeId) {//非导入类型
                    _params.push(params[i]);
                } else {//导入类型
                    if(_temp[params[i].datatypeId]) {
                        _temp[params[i].datatypeId].imports = _temp[params[i].datatypeId].imports.concat(params[i]);
                    } else {
                        _temp[params[i].datatypeId] = {
                            datatypeId:params[i].datatypeId,
                            id:params[i].datatypeId,
                            imports:[params[i]],
                            isImport:true,
                            datatypeName:params[i].datatypeName
                        };
                    }
                }
            }
            for(key in _temp){
                _params = _params.concat(_temp[key]);
            }
            return _params;
        },
        /**
         * 可编辑输入框元素上 data-active 的含义:
         * cache: 所使用的缓存
         * name: 所更新的字段名称
         * id: 要更新的对象的id
         *
         * data-active 的示例值: {"cache":"user","name":"name","id":"1465726373492"}
         */
        _modifyInputValue: function (input, actionData) {
            var that = this;
            if (!input.readOnly) {
                // 已经是编辑状态
                return;
            }
            input.readOnly = false;
            e._$addClassName(input, "u-input-editting");
            input.select();
            var oldValue = input.value;
            var index = actionData.index;
            var handler = function () {
                input.readOnly = true;
                e._$delClassName(input, "u-input-editting");
                var newValue = input.value;
                if (actionData.required == "true" && newValue.trim() === '') {
                    input.value = oldValue;
                } else if (newValue !== oldValue) {
                    // 发送更新请求
                    var _data = {};
                    if (!actionData.cache) {
                        return console.error('cache "' + actionData.cache + '" not found');
                    }
                    if (that.data.format == 7 || that.data.format == 8) {
                        _data = {
                            type: actionData.specType
                        };
                    } else if(that.data.format == 9){
                        _data = {};
                    } else {
                        _data = {
                            parentId: that.data.parentId,
                            parentType: that.data.parentType
                        };
                    }
                    //datatypeIdå­˜åœ¨è¯´æ˜Žæ˜¯ä¿®æ”¹å¯¼å…¥çš„å‚æ•°
                    if (actionData.datatypeId != undefined) {
                        _data["datatypeId"] = actionData.datatypeId;
                    }

                    _data[actionData.name] = newValue;

                    that._updateField(actionData.id, _data, {
                        index: index,
                        field: actionData.name,
                        cache: actionData.cache,
                        datatypeId: actionData.datatypeId,
                        uuid: that.data.uuid
                    });

                }
                v._$delEvent(input, 'blur', handler);
                v._$delEvent(input, 'keydown', keydownHandler);
            }
            var keydownHandler = function (evt) {
                if (evt.keyCode === 13) {
                    evt.target.blur();
                    // handler();
                }
            }
            v._$addEvent(input, 'blur', handler);
            v._$addEvent(input, 'keydown', keydownHandler);
        },
        //ä¿®æ”¹æ•°æ®æ¨¡åž‹çš„å€¼
        _modifySelectValue: function (target, actionData,isClickType) {
            if (this.__datatypeSelect) {
                this.__datatypeSelect._$dispatchEvent("onclickout");
                this.__datatypeSelect = this.__datatypeSelect._$recycle();
                return;
            }
            var element = target,that = this;
            //ä¿®æ”¹çš„å‚æ•°ç´¢å¼•
            var index = actionData.index;
            //å­˜æ”¾ä¸´æ—¶selectçš„å€¼ï¼Œåœ¨å¤±ç„¦çš„æ—¶å€™æäº¤æ•°æ®
            var temp = null;
            //æ˜¯å¦æ˜¯ç‚¹å‡»æ•°æ®ç±»åž‹ArrayåŽé¢çš„ç±»åž‹
            var isClickArrayType = function () {
                if(isClickType && actionData.isArray == _.db.CMN_BOL_YES) {
                    return true;
                } else {
                    return false;
                }
            };
            e._$addClassName(element, "f-dn");
            this.__datatypeSelect = DatatypeSelect2._$$DataTypeSelect._$getInstance({
                parent: element.parentNode,
                pid: this.data.pid,
                selected: {
                    id: (actionData.typeName == "" || actionData.typeName == "Object") ? "object" : Number(actionData.type),
                    name: actionData.typeName || "Object"
                },
                format: this.data.format,
                backOpen:isClickArrayType(),
                noArray: actionData.noArray === "true" ? true : false,
                noObject: actionData.noObject === "true" ? true : false,
                isArray: Number(actionData.isArray),
                choseOnly: actionData.choseOnly === "false" ? false : true,
                ondatatypechange: function (options) {
                    //ä¿®æ”¹çš„å‚æ•°ç´¢å¼•
                    var index = actionData.index;

                    if (options.typeName == 'Object') { //è¿›å…¥åŒ¿åç±»åž‹åˆ›å»ºæµç¨‹
                        if (index.toString().indexOf("-") > 0) {
                            var index1 = index.split("-")[0];
                            var index2 = index.split("-")[1];
                            this.data.params[index1].imports[index2].isEditObjectType = true;
                            this.data.params[index1].imports[index2].typeName = "";
                            //è®°ä½åŽŸå§‹çŠ¶æ€ï¼Œå–æ¶ˆçš„æ—¶å€™è¦è¿˜åŽŸ
                            this.data.params[index1].imports[index2].originArrayStatus = this.data.params[index1].imports[index2].isArray;
                            this.data.params[index1].imports[index2].isArray = options.isArray;

                        } else {
                            this.data.params[index].isEditObjectType = true;
                            this.data.params[index].typeName = "";
                            //è®°ä½åŽŸå§‹çŠ¶æ€ï¼Œå–æ¶ˆçš„æ—¶å€™è¦è¿˜åŽŸ
                            this.data.params[index].originArrayStatus = this.data.params[index].isArray;
                            this.data.params[index].isArray = options.isArray;
                        }
                        e._$delClassName(element, "f-dn");
                        this.__datatypeSelect._$recycle();
                        this.$update();
                    } else {
                        var isAnonymousType =  function(){
                            var tag = false;
                            if (index.toString().indexOf("-") > 0) {
                                var index1 = index.split("-")[0];
                                var index2 = index.split("-")[1];
                                tag = this.data.params[index1].imports[index2].typeName == "" ? true : false;
                            } else {
                                tag = this.data.params[index].typeName == "" ? true : false;
                            }
                            return tag;
                        }.bind(this);
                        if(isAnonymousType()){
                            var modal = Modal.confirm({content:"ä¿®æ”¹ç±»åž‹åŽï¼ŒObjectç±»åž‹çš„å±žæ€§å°†ä¼šä¸¢å¤±ï¼Œç¡®å®šä¿®æ”¹ï¼Ÿ"});
                            modal.$on("ok",function () {
                                temp = options;
                            });
                            modal.$on("cancel",function () {
                                e._$delClassName(element, "f-dn");
                                that.__datatypeSelect = that.__datatypeSelect._$recycle();
                            });
                        } else {
                            temp = options;
                        }
                    }
                }.bind(this),
                onclickout: function () {
                    if (!temp) {
                        e._$delClassName(element, "f-dn");
                        this.__datatypeSelect = this.__datatypeSelect._$recycle();
                        return;
                    }
                    var _data = {
                        type: temp.type,
                        isArray: temp.isArray,
                        typeName:temp.typeName,
                        parentId: this.data.parentId,
                        parentType: this.data.parentType
                    };

                    //datatypeIdå­˜åœ¨è¯´æ˜Žæ˜¯ä¿®æ”¹å¯¼å…¥çš„å‚æ•°
                    if (actionData.datatypeId != undefined) {
                        _data["datatypeId"] = actionData.datatypeId;
                    }
                    if (actionData.datatypeId) {
                        var index1 = index.split("-")[0];
                        var index2 = index.split("-")[1];
                        if (this.data.params[index1].imports[index2]["isArray"] == _data.isArray && this.data.params[index1].imports[index2]["type"] == _data.type) {
                            e._$delClassName(element, "f-dn");
                            this.__datatypeSelect = this.__datatypeSelect._$recycle();
                            return;
                        }
                        this.data.params[index1].imports[index2]["isArray"] = _data.isArray;
                        this.data.params[index1].imports[index2]["type"] = _data.type;
                        this.data.params[index1].imports[index2]["typeName"] = temp.typeName;
                    } else {
                        //å¦‚æžœæ²¡æœ‰å‘ç”Ÿä¿®æ”¹åˆ™ä¸å‘é€è¯·æ±‚
                        if (this.data.params[index]["isArray"] == _data.isArray && this.data.params[index]["type"] == _data.type) {
                            e._$delClassName(element, "f-dn");
                            this.__datatypeSelect._$recycle();
                            return;
                        }
                        this.data.params[index]["isArray"] = _data.isArray;
                        this.data.params[index]["type"] = _data.type;
                        this.data.params[index]["typeName"] = temp.typeName;
                    }
                    this.$update();
                    this._updateField(actionData.id, _data, {
                        index: index,
                        field: "typeName",
                        typeName: temp.typeName,
                        cache: actionData.cache,
                        datatypeId: actionData.datatypeId,
                        uuid: this.data.uuid,
                        callback:function () {
                            e._$delClassName(element, "f-dn");
                            this.__datatypeSelect = this.__datatypeSelect && this.__datatypeSelect._$recycle();
                        }._$bind(this)
                    })
                }.bind(this)
            });

        },
        //修改表达式的值
        _modifyExpressionValue: function (input, actionData) {
            var oldValue = input.value;
            var that = this;
            this.createExp(actionData.index, actionData.name, function (val) {
                if (oldValue == val) return;
                var _data = {
                    parentId: that.data.parentId,
                    parentType: that.data.parentType
                };
                if (actionData.datatypeId) {
                    _data["datatypeId"] = actionData.datatypeId;
                }
                _data[actionData.name] = val;
                that._updateField(actionData.id, _data, {
                    index: actionData.index,
                    field: actionData.name,
                    cache: actionData.cache,
                    datatypeId: actionData.datatypeId,
                    uuid: that.data.uuid
                });
            });
        },
        _updateField: function (id, data, ext) {
            var $cache = this._getCacheInstance(ext.cache);
            ext.pid = this.data.pid;
            $cache._$updateItem({
                id: id,
                data: data,
                ext: ext
            });
        },
        /**
         * 删除无效的数据
         * @param params
         * @returns {*}
         */
        removeEmpty: function (params) {
            var verifyName = this.data.verifyName;
            var tml = params.slice(0);
            u._$reverseEach(params, function (item, index) {
                if (item[verifyName] == "") {
                    tml.splice(index, 1);
                }
                delete item.error;
            });
            return tml;
        },
        /**
         * 监听数据模型修改菜单的check事件
         * @param data
         * @property format {number}
         * @property action {string}
         * @private
         */
        _onMenuCheck: function (data) {
            if (data.action == "modify") {
                var modal = Modal.confirm({content: "切换类型将会导致现有数据丢失，确认切换么？"});
                var _changeHandler = function () {
                    //数据模型的切换
                    if (this.data.parentType == 4) {
                        this._getCacheInstance("datatype")._$updateItem({
                            key: this._getCacheInstance("datatype")._$getListKey(this.data.pid),
                            id: this.data.parentId,
                            data: {
                                format: data.format
                            },
                            ext: {action: "menuchange", format: data.format, uuid: this.data.uuid}
                        });
                        return;
                    }
                    var _data = {}, _type = this.data.parentType;
                    if (_type == 2) {
                        _data["reqFormat"] = data.format;
                    } else {
                        _data["resFormat"] = data.format;
                    }
                    var infCache = this._getCacheInstance("interface")
                    infCache._$updateItem({
                        key: infCache._$getListKey(this.data.pid),
                        id: this.data.parentId,
                        data: _data,
                        ext: {action: "menuchange", format: data.format, resType: _type, uuid: this.data.uuid}
                    })
                }
                modal.$on("ok", _changeHandler.bind(this));
            } else {
                this.import(data.action);
            }
        },
        selectItem: function (id) {
            this.data.checkStatus[id] = !this.data.checkStatus[id];
            this.$refs["LH"].listCheckChanged(this.data.checkStatus);
        },
        listenHeadStatusChange: function (status) {
            this.data.params.forEach(function (item) {
                if(!item.id){
                    //新添加的什么也不做
                } else if (item.datatypeId) {
                    this.data.checkStatus["dr" + item.datatypeId] = status;
                } else {
                    this.data.checkStatus[item.id] = status;
                }
            }.bind(this));
            this.$refs["LH"].listCheckChanged(this.data.checkStatus);
        },
        reverseSelect: function () {
            for (var key in this.data.checkStatus) {
                this.data.checkStatus[key] = !this.data.checkStatus[key];
            }
        },
        resetHeadStatusCom:function () {
            if(this.$refs["LH"]){
                this.$refs["LH"].resetSelected();
            }
        },
        appendModel: function () {
            var _tmp = this.data.checkStatus;
            var item = null;
            var params = [];
            //key的字符串以dr开头的说明是导入的
            for (var key in _tmp) {
                if(_tmp[key]){
                    if (key.indexOf("dr") === 0) {
                        item = this.data.params.find(function (itm) {
                            return itm.datatypeId == key.slice(2);
                        });
                        params = params.concat(item.imports);
                    } else {
                        item = this.data.params.find(function (itm) {
                            return itm.id == key;
                        });
                        params.push(item);
                    }
                }
            }
            params = _._$clone(params);
            //如果是请求头或者响应头的话，则需要format下数据格式
            if(this.data.format == 0 && this.data.shape == "header") {
                params.forEach(function (item) {
                    item.name = item.name.id;
                    item.defaultValue = item.defaultValue.id;
                });
            }
            var _tempParams = [];
            //接口里面参数的parantId指接口的ID,而数据类型里面的属性的parantId指的是导入的数据类型的ID
            params.forEach(function (itm) {
                //如果参数的类型是匿名类型则转换为字符串
                if(!itm.typeName) {
                    itm.type = 10001;
                    itm.typeName = "String";
                }
                _tempParams.push({
                    name:itm.name,
                    defaultValue:itm.defaultValue,
                    description:itm.description,
                    genExpression:itm.genExpression,
                    valExpression:itm.valExpression || "",
                    type:itm.type,
                    typeName:itm.typeName,
                    isArray:itm.isArray
                })
            }.bind(this));

            var modal = new Modal({
                data: {
                    content: "",
                    noTitle: true,
                    "class": "inline-create",
                    okButton: false,
                    cancelButton: false,
                    closeButton: true
                }
            }).$on("close", function () {
                dispatcher._$hide("/?/progroup/p/res/datatype/create/");
                this.destroy();
            });
            dispatcher._$redirect("/?/progroup/p/res/datatype/create/?pid=" + this.data.pid, {
                input: {
                    format:this.data.format,
                    params:_tempParams,
                    parent: modal.$refs.modalbd,
                    done: function () {
                        dispatcher._$hide("/?/progroup/p/res/datatype/create/");
                        modal.destroy();
                    }.bind(this)
                }
            });
        },
        modifyAnonymousType:function (event,id,index) {
            event.stopPropagation();
            var item = this._getCacheInstance("datatype")._$getItemInCache(id);
            var params = _._$clone(item.params);

            //导入类型的属性datatypeId不为0
            params.forEach(function (item) {
                //导入类型加个标示
                if(item.datatypeId) {
                    item.isImport = _.db.CMN_BOL_YES;
                }
            });
            //索引是二维的说明是导入类型
            var x = (index||"").split("-")[0];
            var y= (index||"").split("-")[1];
            if(y !== undefined) {
                this.data.params[x].imports[y].isEditObjectType = true;
                this.data.params[x].imports[y].attrs = params;
                this.data.params[x].imports[y].originArrayStatus = this.data.params[x].imports[y].isArray;
            } else {
                this.data.params[index].isEditObjectType = true;
                this.data.params[index].attrs = params;
                this.data.params[index].originArrayStatus = this.data.params[index].isArray;
            }
            this.data.originalData = _._$clone(params.slice(0));//备份数据
        },
        /**
         * 保存修改匿名模型
         * @param $event
         * @param index
         * @param action
         */
        submitModify:function (event,index) {
            event.stopPropagation();
            var item = null;
            var isChangeArray = "";
            //索引是二维的说明是导入类型
            var x = (index||"").split("-")[0];
            var y= (index||"").split("-")[1];
            if(y !== undefined) {
                item = this._getCacheInstance("datatype")._$getItemInCache(this.data.params[x].imports[y].type);
                isChangeArray = this.data.params[x].imports[y].isArray == this.data.params[x].imports[y].originArrayStatus ? false :true;
            } else {
                item = this._getCacheInstance("datatype")._$getItemInCache(this.data.params[index].type);
                isChangeArray = this.data.params[index].isArray == this.data.params[index].originArrayStatus ? false :true;
            }
            //编辑匿名类型
            //item.type == 2 说明本身就是匿名类型，这时候做的操作就是修改匿名类型了，否则就是添加匿名类型了
            // _datatypeId是修改的匿名类型的数据类型
            if (item.type == 2 && !isChangeArray) {
                if(y !== undefined){
                    var result = this.formatAnonymousTypeParams(this.data.params[x].imports[y].attrs);
                    var _params = result.params;
                    var _imports = result.imports;
                    var _datatypeId = this.data.params[x].imports[y].type;
                    var _isArray = this.data.params[x].imports[y].isArray;
                } else {
                    var result = this.formatAnonymousTypeParams(this.data.params[index].attrs);
                    var _params = result.params;
                    var _imports = result.imports;
                    var _datatypeId = this.data.params[index].type;
                    var _isArray = this.data.params[index].isArray;
                }
                if(_params.length == 0 && _imports.length == 0) {
                    this.cancelModify(event,index);
                    return;
                }
                this._getCacheInstance("parameter")._$updateAnonymousDatatype({
                    key: "anonymous-datatype-modify",
                    data: {
                        datatypeId: _datatypeId,
                        projectId: this.data.pid,
                        type: 2,
                        params: _params,
                        imports:_imports
                    },
                    ext: {
                        uuid: this.data.uuid,
                        index:index,
                        pid:this.data.pid,
                        callback:function () {
                            if(y !== undefined){
                                this.$refs["tp"+(x+"-"+y)].initDom();
                            } else {
                                this.$refs["tp"+index].initDom();
                            }
                        }._$bind(this)
                    }
                });
            } else {
                //修改为匿名类型
                //type:2 匿名数据模型
                if(y !== undefined){
                    var result = this.formatAnonymousTypeParams(this.data.params[x].imports[y].attrs);
                    var _params = result.params;
                    var _imports = result.imports;
                    var _id = this.data.params[x].imports[y].id;
                    var _datatypeId = this.data.params[x].imports[y].datatypeId;
                    var _isArray = this.data.params[x].imports[y].isArray;
                } else {
                    var result = this.formatAnonymousTypeParams(this.data.params[index].attrs);
                    var _params = result.params;
                    var _imports = result.imports;
                    var _id = this.data.params[index].id;
                    var _datatypeId = this.data.params[index].datatypeId;
                    var _isArray = this.data.params[index].isArray;
                }
                var _data = {
                    type: 0,
                    isArray:_isArray,
                    typeName:"",
                    attrs: _params,
                    imports:_imports,
                    datatypeId:_datatypeId,
                    parentId: this.data.parentId,
                    parentType: this.data.parentType
                };

                this._updateField(_id,_data,{
                    index: index,
                    field: "typeName",
                    typeName: "String",
                    cache: "parameter",
                    datatypeId: _datatypeId,
                    uuid: this.data.uuid,
                    callback:function () {
                        //...
                    }._$bind(this)
                });
            }
        },
        /**
         * 取消修改匿名模型
         * @param $event
         * @param index
         */
        cancelModify:function (event,index) {
            event.stopPropagation();
            //索引是二维的说明是导入类型
            var x = (index||"").split("-")[0];
            var y= (index||"").split("-")[1];
            if(y !== undefined) {
                this.data.params[x].imports[y].isEditObjectType = false;
                //还原之前切换选择匿名类型时候给替换成的"";
                var item = this._getCacheInstance("datatype")._$getItemInCache(this.data.params[x].imports[y].type);
                this.data.params[x].imports[y].typeName = item.name;
                this.data.params[x].imports[y].isArray = this.data.params[x].imports[y].originArrayStatus;
                delete this.data.params[x].imports[y].originArrayStatus;
                delete this.data.params[x].imports[y].attrs;
            } else {
                this.data.params[index].isEditObjectType = false;
                //还原之前切换选择匿名类型时候给替换成的"";
                var item = this._getCacheInstance("datatype")._$getItemInCache(this.data.params[index].type);
                this.data.params[index].typeName = item.name;
                this.data.params[index].isArray = this.data.params[index].originArrayStatus;
                delete this.data.params[index].originArrayStatus;
                delete this.data.params[index].attrs;
            }
        },
        formatAnonymousTypeParams: function (params) {
            var that = this;
            var params = this.removeEmpty(params);
            var newparams = [];
            var delPool = [];//删除的参数列表
            var addPool = []; //增加的参数列表
            var updatePool = [];//修改的参数列表
            var newImports = [];

            var delImportPool = [];//删除的参数列表
            var addImportPool = []; //增加的参数列表
            var updateImportPool = [];//修改的参数列表
            var isSame = function (obj1, obj2) {
                var bl = true;
                for (var key in obj1) {
                    if (obj1[key] !== undefined && obj2[key] !== undefined && obj1[key] !== obj2[key]) {
                        bl = false;
                    }
                }
                return bl;
            };
            //该id是否存在于数组里面，不存在说明是添加的
            var isExistArrayById = function (arr,id) {
                var tag = false;
                if(!arr.length) return tag;
                arr.forEach(function (item) {
                    if(item.id  == id) {
                        tag = true;
                    }
                });
                return tag;
            };
            //数组对象里面是否已经有了以该ID创建的对象
            var hasIdInArray = function (arr,field,id) {
                var tag = false;
                if(arr.length ===0 ) return tag;
                arr.forEach(function (item) {
                    if(item[field] == id) {
                        tag = true;
                    }
                });
                return tag;
            };
            this.data.originalData = this.data.originalData || [];
            //把删除的找出来
            this.data.originalData.forEach(function (item) {
                if(!isExistArrayById(params,item.id)) {
                    if(item.isImport){
                        //是否已经存放了导入类型的id
                        if(!hasIdInArray(delImportPool,"id",item.datatypeId)) {
                            delImportPool.push({id: item.datatypeId, action: "delete"});
                        }
                    } else {
                        delPool.push({id: item.id, action: "delete"});
                    }
                }
            });
            //把新增的找出来
            u._$reverseEach(params,function (item,i) {
                if(!item.id) {//新添加的非导入参数
                    item.action = "add";
                    addPool.push(item);
                    params.splice(i,1);
                } else {
                    //在原始数据里查找不存在说明是添加的
                    //新增导入类型parentId即为导入类型的Id
                   if(!isExistArrayById(that.data.originalData,item.id)){
                       var tag = true;
                       //判断新增的属性是否有复写
                       var _obj = that._getCacheInstance("datatype")._$getItemInCache(item.parentId);
                       var _attrs = _obj.params;
                       _attrs.forEach(function (itm) {
                          if(isSame(itm,item)) {
                              tag = false;
                          }
                       });
                       if(hasIdInArray(addImportPool,"id",item.parentId)) {
                           addImportPool.forEach(function (itm) {
                               if(itm.id == item.parentId) {
                                   delete item.originals;
                                   if(tag) {//有被复写才加进去
                                       itm.vars.push(item);
                                   }
                               }
                           });
                       }else {
                           delete item.originals;
                           if(tag) {
                               addImportPool.push({
                                   id:item.parentId,
                                   action:"add",
                                   vars :[item]
                               })
                           } else {
                               addImportPool.push({
                                   id:item.parentId,
                                   action:"add",
                                   vars :[]
                               })
                           }

                       };
                       params.splice(i,1);
                   }
                }
            });
            //把修改的找出来
            //修改导入类型的时候dataypeId为导入类型的id
            this.data.originalData.forEach(function (item1) {
                params.forEach(function (item2,i) {
                    if (item1.id == item2.id) {
                        if (!isSame(item1, item2)) {
                            item2.action = "update";
                            if(item2.isImport) {
                                if(hasIdInArray(updateImportPool,"id",item2.datatypeId)) {
                                    updateImportPool.forEach(function (itm) {
                                        if(itm.id == item2.datatypeId) {
                                            itm.vars.push(item2);
                                            params.splice(i,1);
                                        }
                                    });
                                } else {
                                    updateImportPool.push({
                                        id:item2.datatypeId,
                                        action:"update",
                                        vars :[item2]
                                    });
                                }
                            } else {
                                updatePool.push(item2);
                            }
                        }
                    }
                });

            });
            newparams = newparams.concat(addPool).concat(delPool).concat(updatePool);
            newImports = newImports.concat(addImportPool).concat(delImportPool).concat(updateImportPool);
            return {
                params:newparams,
                imports:newImports
            };
        },
        /**
         * 全屏toggle操作
         */
        doFullScreen:function () {
            var _node = this.parentNode;
            var pnode = _node.parentNode;
            var arrNode = [];
            if(!this.data.isFullScreen){
                while (pnode && pnode.nodeName.toLowerCase() !="html"){
                    var _value = e._$getStyle(pnode,"position");
                    if(_value == "relative" || _value == "absolute") {
                        arrNode.push({
                            node:pnode,
                            prop:_value
                        });
                    }
                    pnode = pnode.parentNode;
                };
            } else {
                while (pnode && pnode.nodeName.toLowerCase() !="html"){
                    if(e._$hasClassName(pnode,"full-screen")){
                        arrNode.push({
                            node:pnode
                        });
                    }
                    pnode = pnode.parentNode;
                };
            }
            var that = this;
            var escHandle = function (event) {
                event.witch = event.keyCode || event.witch;
                if(event.witch == 27) {
                    that.doFullScreen();
                }
            };
            if(!this.data.isFullScreen) {
                e._$style(_node,{
                    "position":"fixed",
                    "width":document.documentElement.clientWidth+"px",
                    "height":document.documentElement.clientHeight+"px",
                    "left":"0px",
                    "padding":"30px",
                    "top":"0px",
                    "background":"#fff",
                    "z-index":"99",
                    "box-sizing":"border-box",
                    "overflow":"scroll"
                });
                arrNode.forEach(function (item) {
                    e._$setStyle(item.node,"position","static");
                    e._$addClassName(item.node,"full-screen");
                });
                e._$addClassName(_node.firstElementChild,"fullScreening");
                this.data.isFullScreen = true;
                v._$addEvent(window,"keyup",escHandle);
            } else {
                _node.style = null;
                arrNode.forEach(function (item) {
                    item.node.style = null;
                    e._$delClassName(item.node,"full-screen");
                });
                e._$delClassName(_node.firstElementChild,"fullScreening");
                this.data.isFullScreen = false;
                v._$clearEvent(window,"keyup",escHandle);
            }
        },
        doIgnoreProperty:function (index) {
            //索引是二维的说明是导入类型
            var x = (index||"").split("-")[0];
            var y = (index||"").split("-")[1];
            var item = this.data.params[x].imports[y];
            var _data ={
                parentId: this.data.parentId,
                parentType: this.data.parentType,
                datatypeId: item.datatypeId,
                ignored:1 - item.ignored
            };
            this._updateField(item.id, _data, {
                datatypeId:item.datatypeId,
                uuid: this.data.uuid,
                cache:"parameter",
                index:index
            });
        },
        doShowAllProperty:function (index) {
            this.data.params[index].allProperty = 1 - (this.data.params[index].allProperty ? 1 : 0);
        },
        destroy: function () {
            this.supr();
            var list = ["interface","datatype","parameter","page","iHeader","jarmap","varmap","cliArg"];
            list.forEach(function (type) {
               if(this["__"+type+"cache"]) {
                   this["__"+type+"cache"]._$recycle();
               }
            },this);
            this.__datatypeSelect = this.__datatypeSelect && this.__datatypeSelect._$recycle();
        }
    });
    return Origin;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','afb57ef5a0e0ee34baead79fa46d3e43','a17dfb1aca7e5bcf1c99411da2601159','45874765e6e05636b88db04079ba223a','63b8d54a51dec3a9c34562475cdbde2f','e2ff6690ab8b15389357e398ea59abd9','16afe76b284216512cb18db2caca44c6','2596f2d6d1b058745ae490f532ef918b','be65ad51cf1a5b0cc99dc59ae0a5d4cc','5041be82421d0a0447f1be899be3d266','b149210a882529cffb53afd4c02c71d3','0cbedaafaaef362bb96cfc018c2427b4','c556614d06521a7c00a2c6195d98e78a','0b097d3f3dbc567e9afd06238599e353','18fdbc27498bb1c4312201f146717dc0');
I$('2d471a9281d3bca5817571b55c060815',"{#if level == 0}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" level={level} isRequire={isRequire} format={format} on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n                {#if  p.datatypeId}\n                <div class=\"list-row list-row-hl\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                    {#list p.imports  as item}\n                    <div class=\"list-row-sub\">\n                        <div class=\"list-col list-col-name\"><em title={item.name}>{item.name}</em></div>\n                        {#if item.type == 10000 || item.originalType == 10000}\n                        <div  class=\"list-col list-col-type\"><div class=\"arraytype\">{#if item.isArray == 1}<span class=\"array\">Array</span>{/if}<span title={item.typeName} class=\"type\" r-class={{\"u-link\":item.type>10003}}>{item.typeName}</span>{#if item.type>10003}<type-property isolate pid={pid} id={item.type}></type-property>{/if}</div></div>\n                        {#else}\n                        <div class=\"list-col list-col-type\">{#if item.isArray == 1}<em class=\"array\">Array</em>{/if}<em title={item.typeName} class=\"type\" r-class={{\"u-link\":item.type>10003}}>{item.typeName || \"Object\"}</em>{#if item.type>10003}<type-property format={format} pid={pid} id={item.type}></type-property>{/if}</div>\n                        {/if}\n                        <div class=\"list-col\"><em title={item.defaultValue}>{item.defaultValue}</em></div>\n                        <div class=\"list-col\"><em title={item.genExpression}>{item.genExpression}</em></div>\n                        <div class=\"list-col\"><em title={item.description}>{item.description}</em></div>\n                        <div class=\"list-col list-col-require\" r-hide={!isRequire}><em title={item.required}>{item.required}</em></div>\n                        <div class=\"list-col list-col-do\"></div>\n                    </div>\n                    {/list}\n                    <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\" title={p.datatypeName}>{p.datatypeName}</a></span></div>\n                </div>\n            {#else}\n                <div class=\"list-row \">\n                <div class=\"list-col list-col-name\"><em title={p.name}>{p.name}</em></div>\n                <div class=\"list-col list-col-type\" ><div class=\"arraytype\">{#if p.isArray == 1}<em class=\"array\">Array</em>{/if}<em title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}>{p.typeName || \"Object\"}</em>{#if p.type>10003}<type-property isolate pid={pid} id={p.type}></type-property>{/if}</div></div>\n                <div class=\"list-col\"><em title={p.defaultValue}>{p.defaultValue}</em></div>\n                <div class=\"list-col\"><em title={p.genExpression}>{p.genExpression}</em></div>\n                <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n                <div class=\"list-col list-col-require\" r-hide={!isRequire}><em title={p.required}>{p.required}</em></div>\n                <div class=\"list-col list-col-do\"></div>\n            </div>\n            {/if}\n        {/list}\n    {#else}\n    <params-empty format={format} level={level} pid={pid} parentType={parentType} on-import={this.import($event)}></params-empty>\n    {/if}\n    </div>\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton}  class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" format={format} isRequire={isRequire} on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n                {#if  p.datatypeId}\n                    <div class=\"list-row list-row-hl\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                        {#list p.imports  as item}\n                        <div class=\"list-row-sub\" r-class={{\"list-row-ignored\":item.ignored == 1}} r-hide={!p.allProperty && item.ignored}>\n                            <div class=\"list-col list-col-check\" r-class={{\"selected\":checkStatus[\"dr\"+p.datatypeId]}} on-click={this.selectItem(\"dr\"+p.datatypeId)} ><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                            <div class=\"list-col list-col-name\"><em>{item.name}</em></div>\n                            {#if item.type == 10000 || item.originalType == 10000}\n                            <div originalType={originalType} class=\"list-col list-col-type\" r-class={{\"list-col-edit\":item.isEditObjectType}}>\n                                <div class=\"wrap-arraytype\" data-active='required=false&id={item.id}&index={p_index}-{item_index}&actionType=select&isArray={item.isArray}&datatypeId={p.datatypeId}&name=typeName&type={item.type}&typeName={item.typeName}&cache=parameter'>\n                                    <div class=\"arraytype\">\n                                        {#if item.isArray == 1}<span class=\"array\" >Array</span>{/if}\n                                        <span title={item.typeName} class=\"type\" r-class={{\"u-link\":item.type>10003}}><span class=\"backtype\">{item.typeName || \"Object\"}</span></span>\n                                        {#if !item.typeName}<i title=\"修改\" on-click={this.modifyAnonymousType($event,item.type,p_index+\"-\"+item_index)} class=\"u-icon-edit-normal\"></i>{/if}\n                                        <a class=\"update\" on-click={this.submitModify($event,p_index+\"-\"+item_index)}>保存</a><a class=\"cancel\" on-click={this.cancelModify($event,p_index+\"-\"+item_index)}>取消</a>\n                                        {#if item.type>10003}<type-property ref=\"tp{p_index}-{item_index}\" isolate pid={pid} id={item.type}></type-property>{/if}\n                                    </div>\n                                </div>\n                            </div>\n                            {#else}\n                            <div class=\"list-col list-col-type\">{#if item.isArray == 1}<em class=\"array\">Array</em>{/if}<em title={item.typeName} class=\"type\" r-class={{\"u-link\":item.type>10003}}>{item.typeName || \"Object\"}</em>{#if item.type>10003}<type-property ref=\"tp{p_index}-{item_index}\" format={format} pid={pid} id={item.type}></type-property>{/if}</div>\n                            {/if}\n                            <div class=\"list-col\"><input type=\"text\" title={item.defaultValue} readonly r-model={item.defaultValue} class=\"u-input\" placeholder=\"添加默认值\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=input&name=defaultValue&cache=parameter' /></div>\n                            <div class=\"list-col\"><input type=\"text\" title={item.genExpression} readonly r-model={item.genExpression} class=\"u-input\" placeholder=\"添加生成规则\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=expression&name=genExpression&cache=parameter' /></div>\n                            <!--<div class=\"list-col\"><input type=\"text\" title={item.valExpression} readonly r-model={item.valExpression} class=\"u-input\" placeholder=\"添加验证规则\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=expression&name=valExpression&cache=parameter' /></div>-->\n                            <div class=\"list-col\"><input type=\"text\" title={item.description} readonly r-model={item.description} class=\"u-input\" placeholder=\"添加描述\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=input&name=description&cache=parameter' /></div>\n                            <div class=\"list-col list-col-require\" r-hide={!isRequire}><select2 source={valueSource} selected={item.required}  choseOnly={true} selectFirst={true} preview={true} sortList={false} initSilent={true}  on-change={this._onRequireSelectChange($event,p_index+\"-\"+item_index,\"required\",\"modify\")}></select2></div>\n                            <div class=\"list-col list-col-do list-col-ignore\"><span on-click={this.doIgnoreProperty(p_index+\"-\"+item_index)}>{item|ignoreTextStatus:p_index}</span>{#if item.ignored}<span class=\"ignored\">已忽略</span>{/if}</div>\n                        </div>\n                        {#if item.isEditObjectType}\n                        <div class=\"list-row-sub list-row-haxieditor\">\n                            <div class=\"haxieditor\"><div class=\"arrow\"></div><haxiEditor  params={item.attrs} isHideFullButton={true} noObject={true}  hasCreate={false} pid={pid} format={0}  btns={['add','datatype2','json','interface','javabean']} ></haxiEditor></div>\n                        </div>\n                        {/if}\n                        {/list}\n                        <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\" title={p.datatypeName}>{p.datatypeName}</a><span title=\"全部属性\" class=\"toggle-showIgnore glyphicon glyphicon-eye-open\" r-class={{\"glyphicon-eye-close\":!p.allProperty}} on-click={this.doShowAllProperty(p_index)}></span><span title=\"删除\" class=\"delete\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}><i  class=\"u-icon-delete-normal\" ></i><i  class=\"u-icon-delete-hover-2\" ></i></span></span></div>\n                    </div>\n                {#else}\n                    {#if p.isAdding}\n                        <div class=\"list-row list-row-adding\">\n                            <div class=\"list-col list-col-check\" ></div>\n                            <div class=\"list-col list-col-name\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-autofocus r-class={{\"u-input-error\":p.error}} r-model={p.name}></div>\n                            <div class=\"list-col list-col-type\"><DatatypeSelect pid={pid} type={p.type} typeName={p.typeName} isArray={p.isArray} format={format} hasCreate={hasCreate}  isolate on-change={this._onSelectChange($event,p_index+\"\")} noArray={noArray} noObject={noObject}></DatatypeSelect></div>\n                            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.defaultValue}></div>\n                            <div class=\"list-col\"><input type=\"text\"  class=\"u-input\" readonly r-model={p.genExpression} on-click={this.createExp(p_index,'genExpression')} ></div>\n                            <!--<div class=\"list-col\"><input type=\"text\" class=\"u-input\" readonly r-model={p.valExpression} on-click={this.createExp(p_index,'valExpression')} ></div>-->\n                            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.description}></div>\n                            <div class=\"list-col list-col-require\" r-hide={!isRequire}><select2 source={valueSource} ref=\"rele\" choseOnly={true} sortList={false} selectFirst={true} initSilent={true} on-change={this._onRequireSelectChange($event,p_index+\"\",\"required\")}></select2></div>\n                            <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n                        </div>\n                        {#if p.isObjectType}\n                        <div class=\"list-row list-row-haxieditor\">\n                            <div class=\"haxieditor\"><div class=\"arrow\"></div><haxiEditor ref=\"editor\" params={p.attrs} isHideFullButton={true} noObject={true} hasCreate={false} pid={pid} format={0} hasTip={false} btns={['add','datatype','json','interface','javabean']} ></haxiEditor></div>\n                        </div>\n                        {/if}\n                    {#else}\n                        <div class=\"list-row \" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                            <div class=\"list-col list-col-check\" on-click={this.selectItem(p.id)} r-class={{\"selected\":checkStatus[p.id]}}><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                            <div class=\"list-col list-col-name\"><input type=\"text\" title={p.name} readonly r-model={p.name} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=name&cache=parameter' /></div>\n                            <div class=\"list-col list-col-type\" r-class={{\"list-col-edit\":p.isEditObjectType}}>\n                                <div class=\"wrap-arraytype\" data-active='required=false&id={p.id}&index={p_index}&actionType=select&isArray={p.isArray}&name=typeName&type={p.type}&typeName={p.typeName}&cache=parameter'>\n                                    <div class=\"arraytype\">\n                                        {#if p.isArray == 1}<span class=\"array\">Array</span>{/if}\n                                        <span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}><span class=\"backtype\">{p.typeName || \"Object\"}</span></span>\n                                        {#if !p.typeName}<i title=\"修改\" on-click={this.modifyAnonymousType($event,p.type,p_index+\"\")} class=\"u-icon-edit-normal\"></i>{/if}\n                                        <a class=\"update\" on-click={this.submitModify($event,p_index+\"\")}>保存</a><a class=\"cancel\" on-click={this.cancelModify($event,p_index+\"\")}>取消</a>\n                                        {#if p.type>10003}<type-property ref=\"tp{p_index}\" isolate pid={pid} id={p.type}></type-property>{/if}\n                                    </div>\n                                </div>\n                            </div>\n                            <div class=\"list-col\"><input type=\"text\" title={p.defaultValue} readonly r-model={p.defaultValue} class=\"u-input\" placeholder=\"添加默认值\" r-class={{\"u-link\":p.isHerit}} data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=defaultValue&cache=parameter' /></div>\n                            <div class=\"list-col\"><input type=\"text\" title={p.genExpression} readonly=\"readonly\" r-model={p.genExpression} class=\"u-input\" placeholder=\"添加生成规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=genExpression&cache=parameter' /></div>\n                            <!--<div class=\"list-col\"><input type=\"text\" title={p.valExpression} readonly=\"readonly\" r-model={p.valExpression} class=\"u-input\" placeholder=\"添加验证规则\"  data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=valExpression&cache=parameter' /></div>-->\n                            <div class=\"list-col\"><input type=\"text\" title={p.description} readonly r-model={p.description} class=\"u-input \" placeholder=\"添加描述\"  data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=description&cache=parameter' /></div>\n                            <div class=\"list-col list-col-require\" r-hide={!isRequire}><select2 source={valueSource} selected={p.required}  choseOnly={true} selectFirst={true} preview={true} sortList={false}  initSilent={true}  on-change={this._onRequireSelectChange($event,p_index+\"\",\"required\",\"modify\")}></select2></div>\n                            <div class=\"list-col list-col-do\"><i title=\"删除\" class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n                        </div>\n                        {#if p.isEditObjectType}\n                        <div class=\"list-row list-row-haxieditor\">\n                            <div class=\"haxieditor\"><div class=\"arrow\"></div><haxiEditor ref=\"editor\" params={p.attrs} isHideFullButton={true} noObject={true} hasCreate={false} pid={pid} format={0}  btns={['add','datatype','json','interface','javabean']} ></haxiEditor></div>\n                        </div>\n                        {/if}\n                    {/if}\n                {/if}\n            {/list}\n        {#else}\n        <params-empty format={format} pid={pid} parentType={parentType} on-import={this.import($event)}></params-empty>\n        {/if}\n    </div>\n    <div class=\"action-row\">\n        <span title=\"添加\" class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n        <div title=\"更多\" class=\"more \">\n            <i class=\"u-icon u-icon-more-editor-normal\"></i><i class=\"u-icon u-icon-more-editor-hover\"></i><i class=\"u-icon u-icon-more-editor-pressed\"></i>\n            <div class=\"wrap-menu\"><param-menu on-check={this._onMenuCheck($event)} parentType={parentType} format={format}></param-menu></div>\n        </div>\n        <!--<div class=\"submit\" r-hide={!isAdding}>-->\n            <!--<a class=\"u-btn\" on-click={this._allSubmit($event)}>全部保存</a>-->\n        <!--</div>-->\n    </div>\n</div>\n{/if}\n");
I$('00be034558e5576d964fba8986044987',function (v, u, e, _, c,Origin, cache, tpl, Modal,HXEditor) {
    var Haxi = Origin.extend({
        name: "haxipreview",
        template: tpl,
        config: function () {
            this.supr();
            _._$extend(this.data, {
                verifyName: "name",
                checkStatus: {},
                isRequire:false,//用来标记是否需要显示是否必须列，接口的请求参数里面是需要显示的，默认不显示
                valueSource:[{id:1,name:"是"},{id:0,name:"否"}]
            });
            if (this.data.action == "modify") {
                this.data.params = [];
                this.add();
                return;
            }
            //参数没有默认值带上自定义类型的默认值
            this.addDefulatValue();
            this.data.params = this.formatParamsSource(_._$clone(this.data.params));
        },
        init: function () {
            this.supr();
            this.listenHeadStatusChange(false);
        },
        add: function () {
            this.data.params.push({
                isImport: _.db.CMN_BOL_NO,
                isAdding: true,
                name: "",
                type: 10001,
                typeName: "String",
                isArray: _.db.CMN_BOL_NO,
                defaultValue: "",
                genExpression: "",
                valExpression: "",
                required:_.db.CMN_BOL_YES
            });
            this.data.isAdding = true;
        },
        import: function (type) {
            this.supr(type);
        },
        /**
         *
         * @param item 参数项
         * @param index 参数所在的索引
         * @param field 参数的字段
         * @param type 当前操作的类型，如果是修改则是"modify"
         * @param isImport 当前操作是否是导入的类型
         * @private
         */
        _onRequireSelectChange: function ($event, index, field,type) {
            //索引是二维的说明是导入类型
            var x = (index||"").split("-")[0];
            var y = (index||"").split("-")[1];
            if(type == "modify") {//修改参数
                if(y !== undefined) {
                    var item = this.data.params[x].imports[y];
                } else {
                    var item = this.data.params[index];
                }
                 var _data ={
                     parentId: this.data.parentId,
                     parentType: this.data.parentType
                };
                _data[field] = $event.selected.id || 0;
                //datatypeId存在说明是修改导入的参数
                if (item.datatypeId != undefined) {
                    _data["datatypeId"] = item.datatypeId;
                }
                this._updateField(item.id, _data, {
                    datatypeId:item.datatypeId,
                    uuid: this.data.uuid,
                    cache:"parameter",
                    index:index
                });
            } else {
                if(y !== undefined) {
                    this.data.params[x].imports[y][field] = $event.selected.id;
                } else {
                    this.data.params[index][field] = $event.selected.id;
                }
            }

        },

        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         */
        update: function (index) {
            //添加的参数包含有匿名类型
            if((typeof index == "number") && this.data.params[index].isObjectType) {
                if (!this.validate(this.data.params[index])) return;
                var _data = this.$refs["editor"].$getEditorParams();
                var _ext = {
                    index:index,
                    action:"add"
                };
                this.data.params[index].attrs = _data.result.params;
                this.data.params[index].imports = _data.result.imports;
                this._doUpdateParams([this.data.params[index]],[],_ext);
            } else  {
                this.supr(index);
             }
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            if (typeof index !== "number") {//批量删除
                index = {};
                var imports = [], params = [];
                for (var key in this.data.checkStatus) {
                    if (this.data.checkStatus[key]) {
                        if (key.indexOf("dr") === 0) {
                            imports.push(key.slice(2));
                        } else {
                            params.push(key);
                        }
                    }
                }
                index.params = params;
                index.imports = imports;
            }
            this.supr(index);
        },
        addDefulatValue:function () {
            //为了实现参数没有默认值带上自定义类型的默认值，好坑
            u._$forEach(this.data.params, function (item) {
                var _dfvalue = this._getCacheInstance("datatype")._$getDefaultValue(item.type);
                if (!item.defaultValue && _dfvalue && !item.isArray && item.type > 10003) {
                    item.defaultValue = _dfvalue;
                    item.isHerit = true;
                }
            }._$bind(this));
            this.$update();
        },
        /**
         * 转换json
         * @param _json
         * @returns {Array}
         */
        formatJSONData: function (_json) {
            return this.supr(_json);
        },
        /**
         * 修改匿名类型
         * @param event
         * @param id
         * @param index
         */
        modifyAnonymousType:function (event,id,index){
            this.supr(event,id,index);
        },
        destroy: function () {
            this.supr();
        }
    });
    return Haxi;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','8717e18cf0d38e654531116f64f5593d','b9bf71df2275ed934dc9e7d2d360c5ce','afd9bc71d3ea5904e51ae183b2351b6e','2d471a9281d3bca5817571b55c060815','a17dfb1aca7e5bcf1c99411da2601159','63ca1c64711b465c55491de71911bb7b');
I$('5b00aa7c2f17b83f0e323979c764f4d7',"{#if level == 0}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" level={level} format={format} on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n                {#if p.datatypeId}\n                    <div class=\"list-row list-row-hl\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                        {#list p.imports  as item}\n                        <div class=\"list-row-sub\">\n                            <div class=\"list-col list-col-name\"><em>{item.defaultValue}</em></div>\n                            {#if item.type == 10000 || item.originalType == 10000}\n                            <div class=\"list-col list-col-type\"><div class=\"arraytype\"><span title={item.typeName} class=\"type\">{item.typeName}</span></div></div>\n                            {#else}\n                            <div class=\"list-col list-col-type\"><em title={item.typeName} r-class={{\"u-link\":item.type>10003}}>{item.typeName || \"Object\"}</em>{#if p.type>10003}<type-property pid={pid} id={p.type}></type-property>{/if}</div>\n                            {/if}\n                            <div class=\"list-col\"><em title={p.name}>{p.name}</em></div>\n                            <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n                            <div class=\"list-col list-col-do\"></div>\n                        </div>\n                        {/list}\n                        <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\" title={p.datatypeName}>{p.datatypeName}</a></span></div>\n                    </div>\n                {#else}\n                    <div class=\"list-row\">\n                        <div class=\"list-col list-col-name\"><em title={p.defaultValue}>{p.defaultValue}</em></div>\n                        <div class=\"list-col list-col-type\"><div class=\"arraytype\">{#if p.isArray == 1}<span class=\"array\">Array</span>{/if}<span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}>{p.typeName || \"Object\"}</span>{#if p.type>10003}<type-property pid={pid} id={p.type}></type-property>{/if}</div></div>\n                        <div class=\"list-col\"><em title={p.name}>{p.name}</em></div>\n                        <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n                        <div class=\"list-col list-col-do\"></div>\n                    </div>\n                {/if}\n            {/list}\n        {#else}\n            <params-empty level={level} format={format} on-import={this.import($event)}></params-empty>\n        {/if}\n    </div>\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" format={format} on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n                {#if p.datatypeId}\n                    <div class=\"list-row list-row-hl\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                        {#list p.imports  as item}\n                        <div class=\"list-row-sub\" r-class={{\"list-row-ignored\":item.ignored == 1}} r-hide={!p.allProperty && item.ignored}>\n                            <div class=\"list-col list-col-check\" r-class={{\"selected\":checkStatus[\"dr\"+p.datatypeId]}} on-click={this.selectItem(\"dr\"+p.datatypeId)} ><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                            <div class=\"list-col list-col-name\"><em>{item.defaultValue}</em></div>\n                            {#if item.type == 10000 || item.originalType == 10000}\n                            <div class=\"list-col list-col-type\"><div class=\"wrap-arraytype\" data-active='required=false&id={item.id}&index={p_index}-{item_index}&actionType=select&isArray={item.isArray}&name=typeName&datatypeId={p.datatypeId}&type={item.type}&typeName={item.typeName}&cache=parameter'><div class=\"arraytype\"><span title={item.typeName} class=\"type\"><span class=\"backtype\">{item.typeName}</span></span></div></div></div>\n                            {#else}\n                            <div class=\"list-col list-col-type\"><em title={item.typeName} r-class={{\"u-link\":item.type>10003}}>{item.typeName || \"Object\"}</em>{#if p.type>10003}<type-property ref=\"tp{p_index}-{item_index}\" pid={pid} id={p.type}></type-property>{/if}</div>\n                            {/if}\n                            <div class=\"list-col\"><input type=\"text\" title={item.name} readonly r-model={item.name} class=\"u-input \" placeholder=\"添加键\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=input&name=name&cache=parameter' /></div>\n                            <div class=\"list-col\"><input type=\"text\" title={item.description} readonly r-model={item.description} class=\"u-input \" placeholder=\"添加默认值\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=input&name=description&cache=parameter' /></div>\n                            <div class=\"list-col list-col-do list-col-ignore\"><span on-click={this.doIgnoreProperty(p_index+\"-\"+item_index)}>{item|ignoreTextStatus:p_index,item_index}</span>{#if item.ignored}<span class=\"ignored\">已忽略</span>{/if}</div>\n                        </div>\n                        {/list}\n                        <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\" title={p.datatypeName}>{p.datatypeName}</a><span title=\"全部属性\" class=\"toggle-showIgnore glyphicon glyphicon-eye-open\" r-class={{\"glyphicon-eye-close\":!p.allProperty}} on-click={this.doShowAllProperty(p_index)}></span><span title=\"删除\" class=\"delete\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}><i  class=\"u-icon-delete-normal\" ></i><i  class=\"u-icon-delete-hover-2\" ></i></span></span></div>\n                    </div>\n                {#else}\n                    {#if p.isAdding}\n                        <div class=\"list-row list-row-adding\">\n                            <div class=\"list-col list-col-name\"><input type=\"text\" data-enter={p_index} r-autofocus class=\"u-input\" r-class={{\"u-input-error\":p.error}} r-model={p.defaultValue}></div>\n                            <div class=\"list-col list-col-type\"><DatatypeSelect pid={pid}  type={p.type} typeName={p.typeName} isArray={p.isArray} format={format} hasCreate={hasCreate}  isolate on-change={this._onSelectChange($event,p_index)} noArray={noArray} noObject={noObject}></DatatypeSelect></div>\n                            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.name}></div>\n                            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.description}></div>\n                            <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n                        </div>\n                    {#else}\n                        <div class=\"list-row\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                            <div class=\"list-col list-col-check\" on-click={this.selectItem(p.id)} r-class={{\"selected\":checkStatus[p.id]}}><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                            <div class=\"list-col list-col-name\"><input type=\"text\" title={p.defaultValue} readonly r-model={p.defaultValue} class=\"u-input \" placeholder=\"添加默认值\" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=defaultValue&cache=parameter' /></div>\n                            <div class=\"list-col list-col-type\"><div class=\"wrap-arraytype\" data-active='required=false&id={p.id}&index={p_index}&actionType=select&isArray={p.isArray}&name=typeName&type={p.type}&typeName={p.typeName}&noArray={true}&noObject={true}&cache=parameter'><div class=\"arraytype\">{#if p.isArray == 1}<span class=\"array\">Array</span>{/if}<span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}><span class=\"backtype\">{p.typeName || \"Object\"}</span></span>{#if p.type>10003}<type-property ref=\"tp{p_index}\" pid={pid} id={p.type}></type-property>{/if}</div></div></div>\n                            <div class=\"list-col\"><input type=\"text\" readonly title={p.name} r-model={p.name} class=\"u-input \" placeholder=\"添加键\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=name&cache=parameter' /></div>\n                            <div class=\"list-col\"><input type=\"text\" readonly title={p.description} r-model={p.description} class=\"u-input \" placeholder=\"添加描述\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=description&cache=parameter' /></div>\n                            <div class=\"list-col list-col-do\"><i class=\"u-icon-delete-normal\" title=\"删除\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n                        </div>\n                    {/if}\n                {/if}\n            {/list}\n        {#else}\n        <params-empty format={format} on-import={this.import($event)}></params-empty>\n        {/if}\n    </div>\n    <div class=\"action-row\">\n        <span title=\"添加\" class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n        <div title=\"更多\" class=\"more \">\n            <i class=\"u-icon u-icon-more-editor-normal\"></i><i class=\"u-icon u-icon-more-editor-hover\"></i><i class=\"u-icon u-icon-more-editor-pressed\"></i>\n            <div class=\"wrap-menu\"><param-menu on-check={this._onMenuCheck($event)} format={format}></param-menu></div>\n        </div>\n    </div>\n</div>\n{/if}");
I$('a7a799d742a6cce9ea168666b84ea5c5',function (v, u, e, _, Origin, tpl,Modal) {
    var Haxi = Origin.extend({
        name: "enumPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                source: [
                    {name: "String", id: "10001"},
                    {name: "Number", id: "10002"}
                ],
                noArray:true,
                noObject:true,
                verifyName:"defaultValue",
                checkStatus: {}
            });
            if (this.data.action == "modify") {
                this.data.params= [];
                this.add();
            } else {
                this.data.params = this.formatParamsSource(_._$clone(this.data.params));
                // this.$update();
            }
            this.supr();
        },
        init: function () {
            this.supr();
            this.listenHeadStatusChange(false);
        },
        add: function () {
            this.data.params.push({
                    isImport: _.db.CMN_BOL_NO,
                    isAdding: true,
                    name: "",
                    type:10001,
                    typeName:"String",
                    isArray: _.db.CMN_BOL_NO,
                    defaultValue: ""
                });
            this.data.isAdding = true;
            this.$update();
        },
        import: function (type) {
            this.supr(type);
           
        },
        /**
         *保存参数数据 数据来源为直接添加或导入
         * @param index
         * @param importType importType = 'type' 是导入数据模型 ，否则是导入json 或在线接口
         */
        update: function (index, importType) {
            this.supr(index,importType)
          
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            if (typeof index !== "number") {//批量删除
                index = {};
                var imports = [], params = [];
                for (var key in this.data.checkStatus) {
                    if (this.data.checkStatus[key]) {
                        if (key.indexOf("dr") === 0) {
                            imports.push(key.slice(2));
                        } else {
                            params.push(key);
                        }
                    }
                }
                index.params = params;
                index.imports = imports;
            }
            this.supr(index);
        },
        /**
         * 转换json
         * @param _json
         * @returns {Array}
         */
        formatJSONData: function (_json) {
            return this.supr(_json);
        }
    });
    return Haxi;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','b9bf71df2275ed934dc9e7d2d360c5ce','5b00aa7c2f17b83f0e323979c764f4d7','a17dfb1aca7e5bcf1c99411da2601159');
I$('6d21c1aa303dedd3e71566eac3e7e5dd',"{#if level == 0}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <div class=\"list-row list-header\">\n            <div class=\"list-col \"><em>类别</em></div>\n            <div class=\"list-col list-col-type\"><em>类型</em></div>\n            <div class=\"list-col\"><em>默认值</em></div>\n            <div class=\"list-col\"><em>生成规则</em></div>\n            <!--<div class=\"list-col\"><em>验证规则</em></div>-->\n            <div class=\"list-col\"><em>描述</em></div>\n        </div>\n        <div class=\"list-row\">\n            {#list params as p}\n            <div class=\"list-col\">数组</div>\n            <div class=\"list-col list-col-type\"><div class=\"arraytype\">{#if p.isArray == 1}<span class=\"array\">Array</span>{/if}<span  title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}>{p.typeName || \"Object\"}</span>{#if p.type>10003}<type-property pid={pid} id={p.type}></type-property>{/if}</div></div>\n            <div class=\"list-col\"><em title={p.defaultValue}>{p.defaultValue}</em></div>\n            <div class=\"list-col\"><em title={p.genExpression}>{p.genExpression}</em></div>\n            <!--<div class=\"list-col\"><input title={p.valExpression} type=\"text\" readonly r-model={p.valExpression} class=\"u-input \" placeholder=\"添加验证规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=valExpression&cache=parameter' /></div>-->\n            <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n            {/list}\n        </div>\n    </div>\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <div class=\"list-row list-header\">\n        <div class=\"list-col \"><em>类别</em></div>\n        <div class=\"list-col list-col-type\"><em>类型</em></div>\n        <div class=\"list-col\"><em>默认值</em></div>\n        <div class=\"list-col\"><em>生成规则</em></div>\n        <!--<div class=\"list-col\"><em>验证规则</em></div>-->\n        <div class=\"list-col\"><em>描述</em></div>\n    </div>\n        {#list params as p}\n        <div class=\"list-row\">\n            <div class=\"list-col\">数组</div>\n            <div class=\"list-col list-col-type\" r-class={{\"list-col-edit\":p.isEditObjectType}}>\n                <div class=\"wrap-arraytype\" data-active='required=false&id={p.id}&index={p_index}&actionType=select&isArray={p.isArray}&name=typeName&type={p.type}&typeName={p.typeName}&cache=parameter'>\n                    <div class=\"arraytype\">\n                        {#if p.isArray == 1}<span class=\"array\">Array</span>{/if}\n                        <span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}><span class=\"backtype\">{p.typeName || \"Object\"}</span></span>\n                        {#if !p.typeName}<i title=\"修改\" on-click={this.modifyAnonymousType($event,p.type,p_index)} class=\"u-icon-edit-normal\"></i>{/if}\n                        <a class=\"update\" on-click={this.submitModify($event,p_index)}>保存</a><a class=\"cancel\" on-click={this.cancelModify($event,p_index)}>取消</a>\n                        {#if p.type>10003}<type-property ref=\"tp{p_index}\" isolate pid={pid} id={p.type}></type-property>{/if}\n                    </div>\n                </div>\n            </div>\n            <div class=\"list-col\"><input title={p.defaultValue} type=\"text\" readonly r-model={p.defaultValue} class=\"u-input \" placeholder=\"添加默认值\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=defaultValue&cache=parameter' /></div>\n            <div class=\"list-col\"><input title={p.genExpression} type=\"text\" readonly r-model={p.genExpression} class=\"u-input \" placeholder=\"添加生成规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=genExpression&cache=parameter' /></div>\n            <!--<div class=\"list-col\"><input title={p.valExpression} type=\"text\" readonly r-model={p.valExpression} class=\"u-input \" placeholder=\"添加验证规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=valExpression&cache=parameter' /></div>-->\n            <div class=\"list-col\"><input title={p.description} type=\"text\" readonly r-model={p.description} class=\"u-input \" placeholder=\"添加描述\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=description&cache=parameter' /></div>\n        </div>\n        {#if p.isEditObjectType}\n        <div class=\"list-row list-row-haxieditor\">\n            <div class=\"haxieditor\"><div class=\"arrow\"></div><haxiEditor ref=\"editor\" params={p.attrs} isHideFullButton={true} noObject={true} hasCreate={false} pid={pid} format={0}  btns={['add','datatype','json','interface','javabean']} ></haxiEditor></div>\n        </div>\n        {/if}\n        {/list}\n    </div>\n    <div class=\"action-row\">\n        <div title=\"更多\" class=\"more \">\n            <i class=\"u-icon u-icon-more-editor-normal\"></i><i class=\"u-icon u-icon-more-editor-hover\"></i><i class=\"u-icon u-icon-more-editor-pressed\"></i>\n            <div class=\"wrap-menu\"><param-menu on-check={this._onMenuCheck($event)} format={format}></param-menu></div>\n        </div>\n    </div>\n</div>\n{/if}");
I$('969489c92bd059bed841af4caf0ef26e',function (v, u, e, _, Origin, datatypecache, tpl) {
    var Array2 = Origin.extend({
        name: "arrayPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
            });
            this.supr();
            this.data.params = this.formatParamsSource(_._$clone(this.data.params));
        },
        init: function () {
            this.supr();
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         */
        update: function (index) {
            //添加的参数包含有匿名类型
            if((typeof index == "number") && this.data.params[index].isObjectType) {
                if (!this.validate(this.data.params[index])) return;
                var _data = this.$refs["editor"].$getEditorParams();
                var _ext = {
                    index:index,
                    action:"add"
                };
                this.data.params[index].attrs = _data.result.params;
                this.data.params[index].imports = _data.result.imports;
                this._doUpdateParams([this.data.params[index]],[],_ext);
            } else  {
                this.supr(index);
            }
        }
        // doUpdateParams:function (options) {
        //     var index = options.ext.index;
        //     this.data.params[index].type = options.data.id;
        //     this.data.params[index].typeName = "";
        //     this.update(index);
        // }

    });
    return Array2;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','b9bf71df2275ed934dc9e7d2d360c5ce','afd9bc71d3ea5904e51ae183b2351b6e','6d21c1aa303dedd3e71566eac3e7e5dd');
I$('b17fe1312bee2a2e1d3c88a73476e2fa',"{#if level == 0}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <div class=\"list-row list-header\">\n            <div class=\"list-col\"><em>类别</em></div>\n            {#if parentType != 4}\n            <div class=\"list-col\"><em>类型</em></div>\n            {/if}\n            {#if format!=6}\n            <div class=\"list-col\"><em>默认值</em></div>\n            <div class=\"list-col\"><em>生成规则</em></div>\n            <!--<div class=\"list-col\"><em>验证规则</em></div>-->\n            {/if}\n            <div class=\"list-col\"><em>描述</em></div>\n        </div>\n        <div class=\"list-row\" >\n            {#list params as p}\n            <div class=\"list-col\"><em title={origin.name}>{origin.name}</em></div>\n            {#if parentType != 4}\n            <div class=\"list-col list-col-type\" style=\"flex: 1\"><div class=\"arraytype\"><span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}>{p.typeName || \"Object\"}</span>{#if p.type>10003}<type-property parentType={p.parentType} pid={pid} id={p.type}></type-property>{/if}</div></div>\n            {/if}\n            {#if format !=6}\n            <div class=\"list-col\"><em title={p.defaultValue}>{p.defaultValue}</em></div>\n            <div class=\"list-col\"><em title={p.genExpression}>{p.genExpression}</em></div>\n            {/if}\n            <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n            {/list}\n        </div>\n    </div>\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <div class=\"list-row list-header\">\n            <div class=\"list-col\"><em>类别</em></div>\n            {#if parentType != 4}\n            <div class=\"list-col\"><em>类型</em></div>\n            {/if}\n            {#if format!=6}\n            <div class=\"list-col\"><em>默认值</em></div>\n            <div class=\"list-col\"><em>生成规则</em></div>\n            <!--<div class=\"list-col\"><em>验证规则</em></div>-->\n            {/if}\n            <div class=\"list-col\"><em>描述</em></div>\n        </div>\n            <div class=\"list-row\" >\n                {#list params as p}\n                <div class=\"list-col\"><em title={origin.name}>{origin.name}</em></div>\n                {#if parentType != 4}\n                <div class=\"list-col list-col-type\" style=\"flex: 1\"><div class=\"wrap-arraytype\" data-active='required=false&id={p.id}&index={p_index}&actionType=select&isArray={0}&noArray={true}&noObject={true}&type={p.type}&typeName={p.typeName}&cache=parameter'><div class=\"arraytype\"><span title={p.typeName} class=\"type\" r-class={{\"u-link\":p.type>10003}}><span class=\"backtype\">{p.typeName || \"Object\"}</span></span>{#if p.type>10003}<type-property parentType={p.parentType} pid={pid} id={p.type}></type-property>{/if}</div></div></div>\n                {/if}\n                {#if format !=6}\n                <div class=\"list-col\"><input type=\"text\" title={p.defaultValue} readonly r-model={p.defaultValue} class=\"u-input\" placeholder=\"添加默认值\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=defaultValue&cache=parameter' /></div>\n                <div class=\"list-col\"><input type=\"text\" title={p.genExpression} readonly r-model={p.genExpression} class=\"u-input\" placeholder=\"添加生成规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=genExpression&cache=parameter' /></div>\n                <!--<div class=\"list-col\"><input type=\"text\" title={p.valExpression} readonly r-model={p.valExpression} class=\"u-input\" placeholder=\"添加验证规则\" data-active='required=false&id={p.id}&index={p_index}&actionType=expression&name=valExpression&cache=parameter' /></div>-->\n                {/if}\n                <div class=\"list-col\"><input type=\"text\" title={p.description} readonly r-model={p.description} class=\"u-input\" placeholder=\"添加描述\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=description&cache=parameter' /></div>\n                {/list}\n            </div>\n    </div>\n    <div class=\"action-row\">\n        <div title=\"更多\" class=\"more \">\n            <i class=\"u-icon u-icon-more-editor-normal\"></i><i class=\"u-icon u-icon-more-editor-hover\"></i><i class=\"u-icon u-icon-more-editor-pressed\"></i>\n            <div class=\"wrap-menu\"><param-menu on-check={this._onMenuCheck($event)} format={format}></param-menu></div>\n        </div>\n    </div>\n</div>\n{/if}");
I$('1b95f086f603ddbc861eb4b645bd16f0',function (v, u, e, _, cache, Origin, tpl) {
    var String2 = Origin.extend({
        name: "stringPreview",
        template: tpl,
        config: function () {
            this.supr();
            _._$extend(this.data, {
                noArray:true,
                noObject:true
            });

            var baseType = [
                {id: _.db.MDL_FMT_STRING, typeName: 'String', type: _.db.MDL_SYS_STRING,name:"字符"},
                {id: _.db.MDL_FMT_NUMBER, typeName: 'Number', type: _.db.MDL_SYS_NUMBER,name:"数值"},
                {id: _.db.MDL_FMT_BOOLEAN, typeName: 'Boolean', type: _.db.MDL_SYS_BOOLEAN,name:"布尔"},
                {id: _.db.MDL_FMT_FILE, typeName: 'File', type: _.db.MDL_SYS_FILE,name:"文件"}
            ];

            this.data.origin= baseType.find(function (item) {
                return item.id === this.data.format;
            }._$bind(this));

        },
        init: function () {
            this.supr();
        }
    });
    return String2;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','35e8999e6afda708a192e93b3e184448','b9bf71df2275ed934dc9e7d2d360c5ce','b17fe1312bee2a2e1d3c88a73476e2fa');
I$('ab7787deeaa0238968ed8cb57a486a23',"{#if shape == \"standard\"}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <div class=\"list-row list-header\">\n            <div class=\"list-col\"><em>数据模型</em></div>\n            <div class=\"list-col \"><em>变量名称</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {#if !!params.length}\n        {#if level == 0}\n        {#list params as p}\n        <div class=\"list-row\">\n            <div class=\"list-col \"><em>{p.orgName}</em></div>\n            <div class=\"list-col\"><em>{p.varName}</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {/list}\n        {#else}\n        {#list params as p}\n        {#if p.isAdding}\n        <div class=\"list-row list-row-adding\">\n            <div class=\"list-col\"><input data-enter={p_index} type=\"text\" r-autofocus class=\"u-input\" r-class={{\"u-input-error\":p.error}} r-model={p.orgName}></div>\n            <div class=\"list-col\"><input data-enter={p_index} type=\"text\" class=\"u-input\" r-model={p.varName}></div>\n            <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n        </div>\n        {#else}\n        <div class=\"list-row\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n        <div class=\"list-col \"><input title={p.orgName} type=\"text\" readonly r-model={p.orgName} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=orgName&cache=varmap&choseOnly=false' /></div>\n        <div class=\"list-col\"><input title={p.valName} type=\"text\" readonly r-model={p.varName} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=varName&cache=varmap' /></div>\n        <div class=\"list-col list-col-do\"><i class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n    </div>\n    {/if}\n    {/list}\n    {/if}\n    {#else}\n    <params-empty level={level} format={format} on-import={this.import($event)}></params-empty>\n    {/if}\n</div>\n<div class=\"action-row\" r-hide={level == 0}>\n<span class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n</div>\n\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div class=\"list-row list-header\">\n            <div class=\"list-col list-col-ktitle\"></div>\n            <div class=\"list-col\"><em>数据模型</em></div>\n            <div class=\"list-col \"><em>变量名称</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {#if !!entre.length}\n        <div class=\"klass\">\n            <div class=\"ktitle\">{tname[entre[0].parentType]}</div>\n            <div class=\"klist\">\n            {#list entre as p}\n                <div class=\"list-row\">\n                    <div class=\"list-col \"><em>{p.orgName}</em></div>\n                    <div class=\"list-col\"><em>{p.varName}</em></div>\n                    <div class=\"list-col list-col-do\"></div>\n                </div>\n            {/list}\n            </div>\n        </div>\n        {/if}\n        {#if shape == \"project\" && !!pgroup.length}\n        <div class=\"klass\">\n            <div class=\"ktitle\">{tname[pgroup[0].parentType]}</div>\n            <div class=\"klist\">\n                {#list pgroup as p}\n                <div class=\"list-row\">\n                    <div class=\"list-col \"><em>{p.orgName}</em></div>\n                    <div class=\"list-col\"><em>{p.varName}</em></div>\n                    <div class=\"list-col list-col-do\"></div>\n                </div>\n                {/list}\n            </div>\n        </div>\n        {/if}\n        {#if !!params.length}\n            {#if level == 0}\n                <div class=\"klass\">\n                    <div class=\"ktitle\">{shape|setTitle}</div>\n                    <div class=\"klist\">\n                        {#list params as p}\n                        <div class=\"list-row\">\n                            <div class=\"list-col \"><em>{p.orgName}</em></div>\n                            <div class=\"list-col\"><em>{p.varName}</em></div>\n                            <div class=\"list-col list-col-do\"></div>\n                        </div>\n                        {/list}\n                    </div>\n                </div>\n            {#else}\n                <div class=\"klass\">\n                    <div class=\"ktitle\">{shape|setTitle}</div>\n                    <div class=\"klist\">\n                        {#list params as p}\n                            {#if p.isAdding}\n                            <div class=\"list-row list-row-adding\">\n                                <div class=\"list-col\"><input type=\"text\" data-enter={p_index} r-autofocus class=\"u-input\" r-class={{\"u-input-error\":p.error}} r-model={p.orgName}></div>\n                                <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.varName}></div>\n                                <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n                            </div>\n                            {#else}\n                                {#if p.level == 0}\n                                <div class=\"list-row\">\n                                    <div class=\"list-col \"><em>{p.orgName}</em></div>\n                                    <div class=\"list-col\"><em>{p.varName}</em></div>\n                                    <div class=\"list-col list-col-do\"></div>\n                                </div>\n                                {#else}\n                                    <div class=\"list-row\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                                        <div class=\"list-col \"><input title={p.orgName} type=\"text\" readonly r-model={p.orgName} class=\"u-input \" data-active='required=true&specType={p.specType}&parentType={p.parentType}&id={p.id}&index={p_index}&actionType=input&name=orgName&cache=varmap&choseOnly=false' /></div>\n                                        <div class=\"list-col\"><input title={p.valName} type=\"text\" readonly r-model={p.varName} class=\"u-input \" data-active='required=true&specType={p.specType}&parentType={p.parentType}&id={p.id}&index={p_index}&actionType=input&name=varName&cache=varmap' /></div>\n                                        <div class=\"list-col list-col-do\"><i class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n                                    </div>\n                                {/if}\n                            {/if}\n                        {/list}\n                    </div>\n                </div>\n            {/if}\n        {#else}\n        <div class=\"klass\">\n            <div class=\"ktitle\">{shape|setTitle}</div>\n            <div class=\"klist\">\n                <params-empty level={level} format={format} on-import={this.import($event)}></params-empty>\n            </div>\n        </div>\n\n        {/if}\n    </div>\n    <div class=\"action-row\" r-hide={level == 0}>\n        <span title=\"添加\" class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n    </div>\n</div>\n{/if}");
I$('efb4761bd937e6c0121246347af97c2c',function (v, u, e, _, cache, datatypeCache, Origin, Select2, tpl) {
    var Map = Origin.extend({
        name: "mapPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                verifyName: "orgName",
                entre: [],
                pgroup: [],
                tname: ["工程", "项目组", "项目"],
                isHideFullButton:true
            });
            this.data.params = this.data.params.slice(0);
            if (this.data.shape !== "standard") {

                u._$reverseEach(this.data.params, function (item, i) {
                    if (item.parentType == 0) {
                        this.data.entre.push(this.data.params.splice(i, 1)[0]);
                    }
                }._$bind(this));
            }
            if (this.data.shape == "project") {
                u._$reverseEach(this.data.params, function (item, i) {
                    if (item.parentType == 1) {
                        this.data.pgroup.push(this.data.params.splice(i, 1)[0]);
                    }
                }._$bind(this));
            }
            this.supr(this.data);
        },
        add: function (option) {
            this.data.params.push(option || {
                    isAdding: true,
                    orgName: "",
                    varName: ""
                });
            this.data.isAdding = true;
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         * @param
         */
        update: function (index) {
            if(this.data.isSending) return;
            var item = this.data.params[index];
            var $cache = this._getCacheInstance("varmap");
            var _ext = {
                cache:"varmap",
                uuid:this.data.uuid,
                index:index
            };
            this.data.isSending = true;
            $cache._$addItems({
                key: this.data.listKey,
                data: {
                    orgName: item.orgName || "",
                    varName: item.varName,
                    parentType: this.data.parentType,
                    parentId: this.data.parentId,
                    type: this.data.specType
                },
                ext: _ext
            })
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            this.supr(index);
        },

        validate: function (item) {
            return this.supr(item);
        }
    }).filter({
        setTitle: function (shape) {
            return shape == "project" ? "项目" : "项目组";
        }
    });
    return Map;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','81a3fb8e9bc8b7b175292bc37f0793dd','afd9bc71d3ea5904e51ae183b2351b6e','b9bf71df2275ed934dc9e7d2d360c5ce','e26ac58445dd3bc2b730e5275fb45f6f','ab7787deeaa0238968ed8cb57a486a23');
I$('3f8a52720dd1460323682078be1e5a70',"{#if level == 0}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" level={level} format= \"header\" on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n                {#if p.datatypeId}\n                        <div class=\"list-row list-row-hl\" on-mouseenter={p.hover= true} on-mouseleave={p.hover = false}>\n                        {#list p.imports as item}\n                        <div class=\"list-row-sub\">\n                            <div class=\"list-col\"><em title={item.name}>{item.name}</em></div>\n                            <div class=\"list-col\"><em title={item.defaultName}>{item.defaultName}</em></div>\n                            <div class=\"list-col\"><em title={item.description}>{item.description}</em></div>\n                            <div class=\"list-col list-col-do\"></div>\n                        </div>\n                        {/list}\n                        <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a title={p.datatypeName} href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\">{p.datatypeName}</a></span></div>\n                    </div>\n                    {#else}\n                    <div class=\"list-row \">\n                        <div class=\"list-col\"><em title={p.name}>{p.name}</em></div>\n                        <div class=\"list-col\"><em title={p.defaultName}>{item.defaultName}</em></div>\n                        <div class=\"list-col\"><em title={p.description}>{p.description}</em></div>\n                        <div class=\"list-col list-col-do\"></div>\n                    </div>\n                {/if}\n            {/list}\n        {#else}\n        <params-empty level={level} format=\"header\" on-import={this.import($event)}></params-empty>\n        {/if}\n    </div>\n</div>\n{#else}\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div r-hide={isHideFullButton} class=\"fullScreen\" title=\"全屏\" on-click={this.doFullScreen($event)}><i class=\"u-icon-spread-normal\"></i></div>\n        <list-head ref=\"LH\" format= \"header\" on-appendModel={this.appendModel()} on-batRemove={this.remove()} on-reverseSelected={this.reverseSelect($event)} on-headstatuschange={this.listenHeadStatusChange($event)}></list-head>\n        {#if !!params.length}\n            {#list params as p}\n            {#if p.datatypeId}\n                <div class=\"list-row list-row-hl\" on-mouseenter={p.hover= true} on-mouseleave={p.hover = false}>\n                    {#list p.imports as item}\n                    <div class=\"list-row-sub\">\n                        <div class=\"list-col list-col-check\" r-class={{\"selected\":checkStatus[\"dr\"+p.datatypeId]}} on-click={this.selectItem(\"dr\"+p.datatypeId)} ><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                        <div class=\"list-col\"><em title={item.name}>{item.name}</em></div>\n                        <div class=\"list-col\"><select2 source={valueSource} on-focus={this.listenFocus($event,p_index)} selected={item.defaultValue}  choseOnly={false} preview={true} sortList={false} initSilent={true} on-change={this._onSelectChange($event,{x:p_index,y:item_index},\"defaultValue\",\"modify\")}></select2></div>\n                        <div class=\"list-col\"><input title={item.description} type=\"text\" readonly r-model={item.description} class=\"u-input \" placeholder=\"添加描述\" data-active='required=false&id={item.id}&datatypeId={p.datatypeId}&index={p_index}-{item_index}&actionType=input&name=description&cache=iHeader'/></div>\n                        <div class=\"list-col list-col-do\"></div>\n                    </div>\n                    {/list}\n                    <div class=\"list-row-des\"><span class=\"wrap-due\"><i class=\"u-icon-arrow-collected-normal\"></i><a title={p.datatypeName} href=\"/datatype/detail/?pid={pid}&id={p.datatypeId}\" class=\"due stateful\">{p.datatypeName}</a><span title=\"删除\" class=\"delete\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}><i  class=\"u-icon-delete-normal\" ></i><i  class=\"u-icon-delete-hover-2\" ></i></span></span></div>\n                    </div>\n            {#else}\n                {#if p.isAdding}\n                <div class=\"list-row list-row-adding\">\n                    <div class=\"list-col list-col-check\"></div>\n                    <div class=\"list-col\" r-class={{\"list-col-error\":p.error}}><select2 source={nameSource} ref=\"nele\" choseOnly={false} on-change={this._onSelectChange($event,p_index,\"name\")}></select2></div>\n                    <div class=\"list-col\"><select2 source={valueSource} ref=\"vele\" choseOnly={false} on-change={this._onSelectChange($event,p_index,\"defaultValue\")}></select2></div>\n                    <div class=\"list-col\"><input type=\"text\" class=\"u-input\" data-enter={p_index} r-model={p.description}></div>\n                    <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n                </div>\n                {#else}\n                <div class=\"list-row \" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n                    <div class=\"list-col list-col-check\" on-click={this.selectItem(p.id)} r-class={{\"selected\":checkStatus[p.id]}}><i class=\"u-icon-checkbox-normal\" ></i><i class=\"u-icon-checkbox-pressed\" ></i></div>\n                    <div class=\"list-col\"><select2 source={nameSource} selected={p.name}  choseOnly={false} preview={true} sortList={false} initSilent={true} on-change={this._onSelectChange($event,p_index,\"name\",\"modify\")}></select2></div>\n                    <div class=\"list-col\"><select2 source={valueSource} on-focus={this.listenFocus($event,p_index)} selected={p.defaultValue}  choseOnly={false} preview={true} sortList={false} initSilent={true} on-change={this._onSelectChange($event,p_index,\"defaultValue\",\"modify\")}></select2></div>\n                    <div class=\"list-col\"><input title={p.description} type=\"text\" readonly r-model={p.description} class=\"u-input \" placeholder=\"添加描述\" data-active='required=false&id={p.id}&index={p_index}&actionType=input&name=description&cache=iHeader' /></div>\n                    <div class=\"list-col list-col-do\"><i title=\"删除\" class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n                </div>\n                {/if}\n            {/if}\n            {/list}\n        {#else}\n        <params-empty format=\"header\" on-import={this.import($event)}></params-empty>\n        {/if}\n    </div>\n    <div class=\"action-row\">\n        <span title=\"添加\" class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n        <div class=\"more \" title=\"更多\">\n            <i class=\"u-icon u-icon-more-editor-normal\"></i><i class=\"u-icon u-icon-more-editor-hover\"></i><i class=\"u-icon u-icon-more-editor-pressed\"></i>\n            <div class=\"wrap-menu\"><param-menu on-check={this._onMenuCheck($event)} format=\"header\"></param-menu></div>\n        </div>\n    </div>\n</div>\n{/if}");
I$('f0f6da3416f708b96693c8393b74f477',function (v, u, e, _, Origin, tpl) {
    var Header = Origin.extend({
        name: "headerPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                verifyName: "name",
                checkStatus: {}
            });
            this.data.nameSource = this.convertSource(_.headname);
            this.data.valueSource = [];
            this.data.valueTempSource = this.convertSource(_.headvalue);
            this.data.params = this.formatParamsSource(_._$clone(this.data.params));
            // this.data.params.forEach(function (item) {
            //     if(item.datatypeId) {//是导入类型
            //         item.imports.forEach(function (itm) {
            //             itm.nameSelected = {
            //                 id:itm.name,
            //                 name:itm.name
            //             }
            //             itm.defaultValueSelected = {
            //                 id:itm.defaultValue,
            //                 name:itm.defaultValue
            //             }
            //         });
            //     } else {
            //         item.nameSelected = {
            //             id:item.name,
            //             name:item.name
            //         };
            //         item.defaultValueSelected = {
            //             id:item.defaultValue,
            //             name:item.defaultValue
            //         }
            //     }
            //
            // });
            this.supr();
        },
        init: function () {
            this.supr();
            this.listenHeadStatusChange(false);
        },
        add: function (option) {
            if (this.data.isAdding) return;
            this.data.params.push(option || {
                    isImport: _.db.CMN_BOL_NO,
                    isAdding: true,
                    name: "",
                    defaultValue: "",
                    description: ""
                });
            // this.data.isAdding = true;
        },
        import: function (type) {
            this.supr(type);
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         */
        update: function (index) {
            if(this.data.params[index] && this.data.params[index].isAdding) {
                this.data.params[index]["defaultValue"] = this.$refs.vele.data.inputValue;
                this.data.params[index]["name"] = this.$refs.nele.data.inputValue;
            }
            this.supr(index);
        },
        listenFocus:function (item,index) {
            //在修改参数属性之后，这里的属性变成了字符类型而不是一个object
            var pname = (this.data.params[index].name && typeof this.data.params[index].name === "object") ? this.data.params[index].name.id : this.data.params[index].name;
            if((pname||"").toLowerCase() == "content-type") {
                this.data.valueSource = this.data.valueTempSource;
            } else {
                this.data.valueSource = [];
            }
        },
        //select2组件的change事件
        /**
         *
         * @param item 参数项
         * @param index 参数所在的索引
         * @param field 参数的字段
         * @param type 当前操作的类型，如果是修改则是"modify"
         * @param isImport 当前操作是否是导入的类型
         * @private
         */
        _onSelectChange: function ($event, index, field,type) {
            if(type == "modify") {//修改参数
                if(typeof  index == "object") {
                    var index1 = index.x;
                    var index2 = index.y;
                    var item = this.data.params[index1].imports[index2];
                } else {
                    var item = this.data.params[index];
                }
                this._modifyRequestHead({
                    datatypeId:item.datatypeId,
                    id:item.id,
                    name:field,
                    value:$event.selected.name || "",
                    index:index
                });
            }else {
                if($event.selected && $event.selected.name.toLowerCase() == "content-type") {
                    this.data.valueSource = this.data.valueTempSource;
                } else {
                    this.data.valueSource = [];
                }
            }
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            if (typeof index !== "number") {//批量删除
                index = {};
                var imports = [], params = [];
                for (var key in this.data.checkStatus) {
                    if (this.data.checkStatus[key]) {
                        if (key.indexOf("dr") === 0) {
                            imports.push(key.slice(2));
                        } else {
                            params.push(key);
                        }
                    }
                }
                index.params = params;
                index.imports = imports;
            }
            this.supr(index);
        },
        /**
         * 转换json
         * @param _json
         * @returns {Array}
         */
        formatJSONData: function (_json) {
            return this.supr(_json);
        },
        convertSource: function (source) {
            var _source = [];
            source.forEach(function (item) {
                _source.push({
                    id: item,
                    name: item
                })
            });
            return _source;
        },
        /**
         *修改请求头的值
         * */
        _modifyRequestHead:function (actionData) {
            var  _data = {
                parentId: this.data.parentId,
                parentType: this.data.parentType
            };
            //datatypeId存在说明是修改导入的参数
            if (actionData.datatypeId) {
                _data["datatypeId"] = actionData.datatypeId;
            }
            _data[actionData.name] = actionData.value;
            this._updateField(actionData.id, _data, {
                uuid: this.data.uuid,
                cache:"iHeader",
                index:actionData.index
            });
        },
        destroy: function () {
            this.supr();
        }
    });
    return Header;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','b9bf71df2275ed934dc9e7d2d360c5ce','3f8a52720dd1460323682078be1e5a70');
I$('38bcda0c54b502f19358913874bffe4e',"\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div class=\"list-row list-header\">\n            <div class=\"list-col\"><em>键</em></div>\n            <div class=\"list-col \"><em>值</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {#if !!params.length}\n        {#if level == 0}\n        {#list params as p}\n        <div class=\"list-row\">\n            <div class=\"list-col \"><em>{p.key}</em></div>\n            <div class=\"list-col\"><em>{p.value}</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {/list}\n        {#else}\n        {#list params as p}\n        {#if p.isAdding}\n        <div class=\"list-row list-row-adding\">\n            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} r-autofocus class=\"u-input\" r-class={{\"u-input-error\":p.error}} r-model={p.key}></div>\n            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.value}></div>\n            <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n        </div>\n        {#else}\n        <div class=\"list-row\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n        <div class=\"list-col \"><input title={p.key} type=\"text\" readonly r-model={p.key} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=key&cache=cliArg&choseOnly=false' /></div>\n        <div class=\"list-col\"><input title={p.value} type=\"text\" readonly r-model={p.value} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=value&cache=cliArg' /></div>\n        <div class=\"list-col list-col-do\"><i class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n    </div>\n    {/if}\n    {/list}\n    {/if}\n    {#else}\n    <params-empty level={level} format={format} on-import={this.import($event)}></params-empty>\n    {/if}\n</div>\n<div class=\"action-row\" r-hide={level == 0}>\n<span class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n</div>\n\n</div>\n");
I$('3c16303653176b886dfbc83519eb6ba5',function (v, u, e, _, cache, Origin, Select2, tpl) {
    var Cli = Origin.extend({
        name: "cliPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                verifyName: "key"
            });
            this.data.params = this.data.params.slice(0);
            this.supr(this.data);
        },
        add: function (option) {
            this.data.params.push(option || {
                    isAdding: true,
                    key: "",
                    value: ""
                });
            this.data.isAdding = true;
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         * @param
         */
        update: function (index) {
            if(this.data.isSending) return;
            var item = this.data.params[index];
            var $cache = this._getCacheInstance("cliArg");
            var _ext = {
                cache:"cliArg",
                uuid:this.data.uuid,
                index:index
            };
            this.data.isSending = true;
            $cache._$addItems({
                key: this.data.listKey,
                data: {
                    key: item.key || "",
                    value: item.value,
                    projectId: this.data.pid,
                    type: this.data.specType
                },
                ext: _ext
            })
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            this.supr(index);
        },

        validate: function (item) {
            return this.supr(item);
        }
    });
    return Cli;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','88b09690bf9da6d44c6964c8030be9da','b9bf71df2275ed934dc9e7d2d360c5ce','e26ac58445dd3bc2b730e5275fb45f6f','38bcda0c54b502f19358913874bffe4e');
I$('0233329e8ba16c1fa8e20c8252fc6b8e',"\n<div class=\"m-paramslist\">\n    <div class=\"list-body\">\n        <div class=\"list-row list-header\">\n            <div class=\"list-col\"><em>实例名</em></div>\n            <div class=\"list-col \"><em>类名</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {#if !!params.length}\n        {#if level == 0}\n        {#list params as p}\n        <div class=\"list-row\">\n            <div class=\"list-col \"><em>{p.instanceName}</em></div>\n            <div class=\"list-col\"><em>{p.klassName}</em></div>\n            <div class=\"list-col list-col-do\"></div>\n        </div>\n        {/list}\n        {#else}\n        {#list params as p}\n        {#if p.isAdding}\n        <div class=\"list-row list-row-adding\">\n            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} r-autofocus class=\"u-input\" r-class={{\"u-input-error\":p.error}} r-model={p.instanceName}></div>\n            <div class=\"list-col\"><input type=\"text\" data-enter={p_index} class=\"u-input\" r-model={p.klassName}></div>\n            <div class=\"list-col list-col-do\"><a title=\"保存\" on-click={this.update(p_index)}><i class=\"u-icon-yes-normal\" ></i><i class=\"u-icon-yes-hover\"></i></a><a title=\"删除\" on-click={this.remove(p_index)}><i class=\"u-icon-no-normal\"></i><i class=\"u-icon-no-hover\"></i></a></div>\n        </div>\n        {#else}\n        <div class=\"list-row\" on-mouseenter={p.hover = true} on-mouseleave={p.hover = false}>\n        <div class=\"list-col \"><input title={p.instanceName} type=\"text\" readonly r-model={p.instanceName} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=instanceName&cache=jarmap&choseOnly=false' /></div>\n        <div class=\"list-col\"><input title={p.klassName} type=\"text\" readonly r-model={p.klassName} class=\"u-input \" data-active='required=true&id={p.id}&index={p_index}&actionType=input&name=klassName&cache=jarmap' /></div>\n        <div class=\"list-col list-col-do\"><i class=\"u-icon-delete-normal\" r-class={{\"f-dn-important\":!p.hover}} on-click={this.remove(p_index)}></i></div>\n    </div>\n    {/if}\n    {/list}\n    {/if}\n    {#else}\n    <params-empty level={level} format={format} on-import={this.import($event)}></params-empty>\n    {/if}\n</div>\n<div class=\"action-row\" r-hide={level == 0}>\n<span class=\"add\" on-click={this.add()}><i class=\"u-icon u-icon-add-editor-normal\"></i><i class=\"u-icon u-icon-add-editor-hover\"></i><i class=\"u-icon u-icon-add-editor-pressed\"></i></span>\n</div>\n\n</div>\n");
I$('bb816ef34e3970cb48ab82ceb222867a',function (v, u, e, _, cache, Origin, Select2, tpl) {
    var Cli = Origin.extend({
        name: "jarPreview",
        template: tpl,
        config: function () {
            _._$extend(this.data, {
                verifyName: "instanceName"
            });
            this.data.params = this.data.params.slice(0);
            this.supr(this.data);
        },
        add: function (option) {
            this.data.params.push(option || {
                    isAdding: true,
                    instanceName: "",
                    klassName: ""
                });
            this.data.isAdding = true;
        },
        /**
         *保存参数数据 数据来源为直接添加
         * @param index
         * @param
         */
        update: function (index) {
            if(this.data.isSending) return;
            var item = this.data.params[index];
            var $cache = this._getCacheInstance("jarmap");
            var _ext = {
                cache:"jarmap",
                uuid:this.data.uuid,
                index:index
            };
            this.data.isSending = true;
            $cache._$addItems({
                key: this.data.listKey,
                data: {
                    instanceName: item.instanceName || "",
                    klassName: item.klassName,
                    specId: this.data.parentId
                },
                ext: _ext
            });
        },
        /**
         *
         * @param index 删除的项索引
         */
        remove: function (index) {
            this.supr(index);
        },

        validate: function (item) {
            return this.supr(item);
        }
    });
    return Cli;
},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','466ba5cf27f05a9d8f067d83a0b3604b','b9bf71df2275ed934dc9e7d2d360c5ce','e26ac58445dd3bc2b730e5275fb45f6f','0233329e8ba16c1fa8e20c8252fc6b8e');
I$('8804cc26c38f0c29487993801cf932cd',"<textarea name=\"ntp\" id=\"#<cnt>\">\n    <div class=\"m-editor m-editor-preview\">\n        <div class=\"j-editor\"></div>\n    </div>\n</textarea>");
I$('a9d9b2ad471c62386b26f8e7879c8b4a',".m-paramslist{\n\tfont-size:12px;\n}\n.m-paramslist .action-row{\n\tpadding-top:10px;\n\tposition:relative;\n\twidth:85%;\n\tfont-size:0px;\n\tz-index:10;\n}\n.m-paramslist .action-row .submit{\n\tposition:absolute;\n\ttop:5px;\n\tright:0px;\n}\n.m-paramslist .action-row .submit .u-btn{\n\theight:30px;\n\tline-height:30px;\n\tpadding:0px 20px;\n}\n.m-paramslist .action-row .add,.m-paramslist .action-row .more{\n\tdisplay:inline-block;\n\tposition:relative;\n\tmargin-right:10px;\n\tvertical-align:bottom;\n\tz-index:10;\n\twidth:20px;\n\theight:20px;\n\tline-height:20px;\n\tcursor:pointer;\n}\n.m-paramslist .action-row .add .u-icon-add-editor-hover,.m-paramslist .action-row .add .u-icon-more-editor-hover,.m-paramslist .action-row .add .u-icon-add-editor-pressed,.m-paramslist .action-row .add .u-icon-more-editor-pressed,.m-paramslist .action-row .more .u-icon-add-editor-hover,.m-paramslist .action-row .more .u-icon-more-editor-hover,.m-paramslist .action-row .more .u-icon-add-editor-pressed,.m-paramslist .action-row .more .u-icon-more-editor-pressed{\n\tdisplay:none;\n}\n.m-paramslist .action-row .add:hover .u-icon-add-editor-normal,.m-paramslist .action-row .add:hover .u-icon-more-editor-normal,.m-paramslist .action-row .add:hover .u-icon-add-editor-pressed,.m-paramslist .action-row .add:hover .u-icon-more-editor-pressed,.m-paramslist .action-row .more:hover .u-icon-add-editor-normal,.m-paramslist .action-row .more:hover .u-icon-more-editor-normal,.m-paramslist .action-row .more:hover .u-icon-add-editor-pressed,.m-paramslist .action-row .more:hover .u-icon-more-editor-pressed{\n\tdisplay:none;\n}\n.m-paramslist .action-row .add:hover .u-icon-add-editor-hover,.m-paramslist .action-row .add:hover .u-icon-more-editor-hover,.m-paramslist .action-row .more:hover .u-icon-add-editor-hover,.m-paramslist .action-row .more:hover .u-icon-more-editor-hover{\n\tdisplay:inline-block;\n}\n.m-paramslist .more{\n\theight:36px;\n}\n.m-paramslist .more:hover .u-edit-menu{\n\tdisplay:inline-block;\n}\n.m-paramslist .list-body{\n\tborder:1px solid #e6e6e6;\n\twidth:85%;\n\tbackground:#fff;\n\tposition:relative;\n}\n.m-paramslist .list-body:hover .fullScreen{\n\tdisplay:block;\n}\n.m-paramslist.fullScreening .fullScreen{\n\tdisplay:block;\n}\n.m-paramslist .fullScreen{\n\tdisplay:none;\n\tposition:absolute;\n\tright:5px;\n\ttop:5px;\n\ttext-align:center;\n\twidth:30px;\n\theight:30px;\n\tline-height:30px;\n\tz-index:9;\n\tborder:1px solid #e6e6e6;\n\tcursor:pointer;\n\ttransition:all 0.5s ease;\n}\n.m-paramslist .fullScreen:hover{\n\tborder-color:#dccc6c;\n}\n.m-paramslist .list-row{\n\tposition:relative;\n\tdisplay:flex;\n\tcolor:#222;\n\tborder-bottom:1px solid #e6e6e6;\n}\n.m-paramslist .list-row.list-header{\n\tbackground:#f5f5f5;\n\tcolor:#222;\n}\n.m-paramslist .list-row:last-child{\n\tborder-bottom:none;\n}\n.m-paramslist .list-header .batch-action{\n\tline-height:40px;\n}\n.m-paramslist .list-header .batch-action-item{\n\theight:28px;\n\tline-height:28px;\n\tpadding:0 10px;\n\tbackground-color:#fff;\n\ttext-align:center;\n\tdisplay:inline-block;\n\tcolor:#222;\n\tborder:1px #ccc solid;\n\toutline:none;\n\tfont-size:12px;\n\ttransition:all ease 0.3s;\n\tmargin-right:4px;\n}\n.m-paramslist .list-row-hl{\n\tdisplay:block;\n\tbackground:#f1f6fb;\n}\n.m-paramslist .list-row-hl .u-select .select-hd{\n\tbackground:#f1f6fb;\n}\n.m-paramslist .list-row-hl .u-select .empty-tip{\n\tbackground:#f1f6fb;\n}\n.m-paramslist .list-row-hl .m-tb-editor .select-hd{\n\tbackground:#fff;\n}\n.m-paramslist .list-row-sub .list-col-ignore{\n\tz-index:9999;\n}\n.m-paramslist .list-row-sub .list-col-ignore span{\n\tcolor:#56c969;\n\tcursor:pointer;\n\tdisplay:none;\n}\n.m-paramslist .list-row-sub .list-col-ignore .ignored{\n\tdisplay:inherit;\n\tcolor:#999;\n\topacity:0.5;\n}\n.m-paramslist .list-row-sub:hover .list-col-ignore span{\n\tdisplay:inherit;\n}\n.m-paramslist .list-row-sub:hover:hover .ignored{\n\tdisplay:none;\n}\n.m-paramslist .list-row-ignored{\n\tposition:relative;\n}\n.m-paramslist .list-row-ignored:before{\n\tcontent:\"\";\n\tposition:absolute;\n\tz-index:9;\n\theight:40px;\n\twidth:calc(100%);\n\tbackground:#fff;\n\topacity:0.6;\n}\n.m-paramslist .list-row-sub{\n\tdisplay:flex;\n\twidth:100%;\n}\n.m-paramslist .list-row-haxieditor{\n\tmargin-top:-1px;\n\twidth:100%;\n\tbackground:#fff;\n\tpadding:5px 65px 10px 45px;\n\tbox-sizing:border-box;\n}\n.m-paramslist .list-row-haxieditor .haxieditor{\n\twidth:100%;\n\tposition:relative;\n\tbackground-color:#f5f5f5;\n}\n.m-paramslist .list-row-haxieditor .arrow{\n\tborder:8px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#e6e6e6;\n\ttop:-15px;\n\tleft:40%;\n}\n.m-paramslist .list-row-haxieditor .arrow::after{\n\tcontent:\"\";\n\tborder:6px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#f5f5f5;\n\ttop:-4px;\n\tleft:-6px;\n}\n.m-paramslist .list-row-haxieditor .u-input{\n\tborder-color:#d2d6de;\n\tbackground:#fff;\n}\n.m-paramslist .list-row-haxieditor .u-input:focus{\n\tbackground:#fff;\n\tborder:1px solid #aaa;\n}\n.m-paramslist .list-row-haxieditor .u-tip{\n\tdisplay:none;\n}\n.m-paramslist .list-row-haxieditor .u-btn{\n\theight:30px;\n\tline-height:30px;\n\tbackground:#fff;\n\tcolor:#555;\n\tpadding:0 10px;\n\tborder:solid 1px #e6e6e6;\n\ttransition:all ease 0.3s;\n}\n.m-paramslist .list-row-haxieditor .u-btn:hover{\n\tbackground:#f7f7f7;\n}\n.m-paramslist .list-row-haxieditor tbody{\n\tbackground-color:inherit;\n}\n.m-paramslist .list-row-haxieditor tbody td,.m-paramslist .list-row-haxieditor tbody th{\n\tpadding:5px;\n}\n.m-paramslist .list-row-haxieditor .u-select2group{\n\tbackground:#fff;\n}\n.m-paramslist .list-row-haxieditor .operation{\n\tpadding:5px 10px;\n\tborder:solid 1px #e6e6e6;\n\tborder-top:none;\n}\n.m-paramslist .list-row-haxieditor .operation a{\n\tfont-size:12px;\n}\n.m-paramslist .list-empty{\n\tdisplay:block;\n\tline-height:30px;\n\tpadding:5px 20px;\n\tcolor:#555;\n}\n.m-paramslist .list-empty a{\n\tcolor:#30a1f2;\n\tfont-weight:bold;\n}\n.m-paramslist .list-empty .u-select2group{\n\twidth:160px;\n\tdisplay:inline-block;\n\tvertical-align:middle;\n}\n.m-paramslist .list-empty .u-select2{\n\twidth:80px;\n\tvertical-align:middle;\n}\n.m-paramslist .list-col{\n\tposition:relative;\n\tflex:1;\n\theight:40px;\n\tline-height:40px;\n\tpadding:0px 5px;\n\talign-items:center;\n\twhite-space:nowrap;\n\tmin-width:0px;\n}\n.m-paramslist .list-col em{\n\tdisplay:block;\n\toverflow:hidden;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\tpadding-left:5px;\n}\n.m-paramslist .list-col .arraytype{\n\tdisplay:flex;\n}\n.m-paramslist .list-col .type{\n\tflex:1;\n}\n.m-paramslist .list-col .u-link{\n\tcolor:#30a1f2;\n}\n.m-paramslist .list-col .u-select2{\n\twidth:auto;\n\tvertical-align:baseline;\n}\n.m-paramslist .list-col .u-select .select-hd{\n\tpadding:0px 5px;\n}\n.m-paramslist .list-col-error .u-select .select-hd{\n\tborder-color:#f00;\n}\n.m-paramslist .list-col-require{\n\twidth:40px;\n\tflex:initial;\n}\n.m-paramslist .list-col-check{\n\twidth:30px;\n\tflex:none !important;\n\ttext-align:left;\n\ttext-indent:5px;\n\tcursor:pointer;\n}\n.m-paramslist .list-col-check .u-icon-checkbox-pressed{\n\tdisplay:none;\n}\n.m-paramslist .list-col-check .u-icon-checkbox-normal{\n\tdisplay:inline-block;\n\tvertical-align:-4px;\n}\n.m-paramslist .list-col-check.selected .u-icon-checkbox-pressed{\n\tdisplay:inline-block;\n}\n.m-paramslist .list-col-check.selected .u-icon-checkbox-normal{\n\tdisplay:none;\n}\n.m-paramslist .list-col-do{\n\twidth:60px;\n\tpadding:0px !important;\n\tflex:none !important;\n\ttext-align:center;\n}\n.m-paramslist .list-col-do i{\n\tcursor:pointer;\n}\n.m-paramslist .list-col-do a{\n\tdisplay:inline-block;\n\theight:24px;\n\twidth:24px;\n\tcursor:pointer;\n}\n.m-paramslist .list-col-do a .u-icon-yes-hover,.m-paramslist .list-col-do a .u-icon-no-hover{\n\tdisplay:none;\n}\n.m-paramslist .list-col-do a:hover .u-icon-yes-hover,.m-paramslist .list-col-do a:hover .u-icon-no-hover{\n\tdisplay:inline-block;\n}\n.m-paramslist .list-col-do a:hover .u-icon-yes-normal,.m-paramslist .list-col-do a:hover .u-icon-no-normal{\n\tdisplay:none;\n}\n.m-paramslist .list-col-name{\n\tflex:2;\n}\n.m-paramslist .list-col-type{\n\tflex:3;\n\tdisplay:flex;\n\talign-items:center;\n}\n.m-paramslist .list-col-type:hover .u-prolist{\n\tdisplay:flex;\n}\n.m-paramslist .list-col-ktitle{\n\twidth:60px;\n\tflex:inherit;\n\tpadding:0px;\n}\n.m-paramslist .list-row-des{\n\tposition:absolute;\n\tleft:100%;\n\ttop:0px;\n\theight:100%;\n\tmargin-left:-3px;\n\tpadding-right:40px;\n\tborder-left:4px solid #30a1f2;\n\twhite-space:nowrap;\n\tdisplay:flex;\n\talign-items:center;\n\tmax-width:15%;\n}\n.m-paramslist .klass{\n\tdisplay:flex;\n\tborder-bottom:1px solid #e6e6e6;\n}\n.m-paramslist .klass:last-child{\n\tborder-bottom:0px none;\n}\n.m-paramslist .klass .ktitle{\n\twidth:60px;\n\tpadding-top:12px;\n\tfont-size:12px;\n\ttext-align:center;\n\tborder-right:1px solid #e6e6e6;\n}\n.m-paramslist .klass .klist{\n\tflex:1;\n}\n.m-paramslist .wrap-due{\n\tpadding-left:5px;\n\tdisplay:flex;\n\twidth:100%;\n\talign-items:center;\n}\n.m-paramslist .wrap-due i{\n\tmargin-right:5px;\n\tcursor:pointer;\n}\n.m-paramslist .wrap-due .due{\n\tflex:1;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n\tborder-radius:3px;\n\tpadding:3px 10px;\n\tline-height:20px;\n\tbackground-color:#666;\n\tcolor:#fff;\n}\n.m-paramslist .wrap-due .toggle-showIgnore{\n\tmargin-left:10px;\n\tdisplay:inline-block;\n\twidth:20px;\n\theight:14px;\n\tcolor:#555;\n\tfont-size:14px;\n\tcursor:pointer;\n}\n.m-paramslist .wrap-due .toggle-showIgnore .u-icon-information-hover{\n\tdisplay:none;\n}\n.m-paramslist .wrap-due .toggle-showIgnore:hover{\n\tcolor:#30a1f2;\n}\n.m-paramslist .wrap-due .toggle-showIgnore:hover .u-icon-information-normal{\n\tdisplay:none;\n}\n.m-paramslist .wrap-due .toggle-showIgnore:hover .u-icon-information-hover{\n\tdisplay:inline-block;\n}\n.m-paramslist .wrap-due .delete .u-icon-delete-hover-2{\n\tdisplay:none;\n}\n.m-paramslist .wrap-due .delete:hover .u-icon-delete-normal{\n\tdisplay:none;\n}\n.m-paramslist .wrap-due .delete:hover .u-icon-delete-hover-2{\n\tdisplay:inline-block;\n}\n.m-paramslist .wrap-arraytype{\n\twidth:100%;\n\tdisplay:inline-block;\n\tvertical-align:middle;\n}\n.m-paramslist .wrap-arraytype .arraytype{\n\tdisplay:flex;\n\tpadding:0px 5px;\n\theight:30px;\n\tline-height:30px;\n\tborder:1px solid transparent;\n\tbox-sizing:border-box;\n\talign-items:center;\n}\n.m-paramslist .wrap-arraytype .arraytype .u-icon-edit-normal{\n\tvisibility:hidden;\n\tcursor:pointer;\n}\n.m-paramslist .wrap-arraytype .arraytype .update,.m-paramslist .wrap-arraytype .arraytype .cancel{\n\tdisplay:none;\n}\n.m-paramslist .wrap-arraytype .arraytype:hover{\n\tborder-color:#d2d6de;\n}\n.m-paramslist .wrap-arraytype .arraytype:hover .u-icon-edit-normal{\n\tvisibility:visible;\n}\n.m-paramslist .wrap-arraytype .arraytype:hover .u-prolist{\n\tdisplay:flex;\n}\n.m-paramslist .wrap-arraytype .array{\n\twidth:auto;\n\tpadding-right:5px;\n}\n.m-paramslist .wrap-arraytype .type{\n\tflex:1;\n\ttext-align:left;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n}\n.m-paramslist .u-input{\n\twidth:100%;\n\tmin-width:auto;\n\tborder:1px solid transparent;\n\theight:30px;\n\tbackground:inherit;\n\ttext-overflow:ellipsis;\n}\n.m-paramslist .u-input:hover{\n\tborder-color:#d2d6de;\n}\n.m-paramslist .u-input:focus{\n\tbackground:#f9f9f9;\n}\n.m-paramslist .u-input-editting{\n\tborder-color:#d2d6de;\n}\n.m-paramslist .list-row-adding .u-input{\n\tborder-color:#d2d6de;\n\tbackground:#fff;\n}\n.m-paramslist .list-row-adding .u-select2{\n\tbackground:#fff;\n\twidth:100%;\n}\n.m-paramslist .list-row-adding .wrap-arraytype .arraytype{\n\tborder-color:transparent;\n}\n.m-paramslist .list-row-adding .wrap-arraytype .arraytype:hover{\n\tborder-color:transparent;\n}\n.m-paramslist .list-col-edit .arraytype{\n\tborder-color:#d2d6de;\n}\n.m-paramslist .list-col-edit .arraytype .u-icon-edit-normal{\n\tvisibility:hidden;\n}\n.m-paramslist .list-col-edit .arraytype .update,.m-paramslist .list-col-edit .arraytype .cancel{\n\tdisplay:inline-block;\n\tmargin:0px 3px;\n\tcolor:inherit;\n}\n.m-paramslist .list-col-edit .arraytype .update{\n\tcolor:#56c969;\n}\n.m-paramslist .list-col-edit:hover .arraytype{\n\tborder-color:#d2d6de;\n}\n.m-paramslist .list-col-edit:hover .arraytype .u-icon-edit-normal{\n\tvisibility:hidden;\n}\n.m-paramslist .list-col-edit:hover .arraytype .u-prolist{\n\tdisplay:none;\n}\n.m-paramslist .list-col-array .arraytype{\n\tborder:0px none;\n}\n.m-paramslist .list-col-array .type{\n\tborder:1px solid #fff;\n\tpadding:0px 8px;\n\tborder-color:transparent;\n}\n.m-paramslist .list-col-array .type:hover{\n\tborder-color:#d2d6de;\n}\n.wrap-menu{\n\tposition:absolute;\n\tbackground:transparent;\n\ttransition:all ease 0.5s;\n\tz-index:9;\n\tpadding-bottom:20px;\n\tpadding-left:20px;\n\tleft:0px;\n\tbottom:-2px;\n}\n.u-edit-menu{\n\tdisplay:none;\n\twidth:135px;\n\tbox-sizing:border-box;\n\tborder:1px solid #efefef;\n\ttext-indent:0px;\n\tcolor:#222;\n\tfont-size:12px;\n\tfont-weight:normal;\n\tbackground:#fff;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n}\n.u-edit-menu li{\n\theight:30px;\n\tline-height:30px;\n\twhite-space:nowrap;\n\ttext-align:left;\n\tpadding-left:20px;\n}\n.u-edit-menu li:hover{\n\tcursor:pointer;\n\tbackground:#f1f1f1;\n}\n.u-edit-menu .parent>li{\n\tposition:relative;\n}\n.u-edit-menu .parent>li .sub{\n\tdisplay:none;\n\tposition:absolute;\n\twidth:76px;\n\ttop:0px;\n\tleft:134px;\n\tborder:1px solid #efefef;\n\tbackground:#fff;\n\tz-index:999;\n\tcolor:#000;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n}\n.u-edit-menu .parent>li:hover .sub{\n\tdisplay:block;\n}\n.u-prolist{\n\tposition:absolute;\n\tleft:5px;\n\tpadding:0px 0px 10px 0px;\n\tdisplay:none;\n\tz-index:999;\n\tborder:1px solid #e6e6e6;\n\tbackground:#fff;\n\tcolor:#222;\n\tfont-size:12px;\n\tfont-weight:normal;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n\ttop:36px;\n}\n.u-prolist .link{\n\theight:30px;\n\tposition:relative;\n}\n.u-prolist .link:hover{\n\tbackground:#f5f5f5;\n}\n.u-prolist .link:hover a{\n\tborder-color:#f5f5f5;\n}\n.u-prolist .link i{\n\tposition:absolute;\n\tright:20px;\n\ttop:12px;\n}\n.u-prolist a{\n\tdisplay:block;\n\tmargin:0px 20px;\n\tcolor:#222;\n\tline-height:30px;\n\ttext-align:left;\n\tborder-bottom:1px solid #eee;\n}\n.u-prolist dl{\n\tpadding:0px 20px;\n\tmax-height:170px;\n\toverflow:scroll;\n}\n.u-prolist dl dt,.u-prolist dl dd{\n\tdisplay:flex;\n\theight:24px;\n\tline-height:24px;\n\tpadding:0px 5px;\n}\n.u-prolist dl dt{\n\tcolor:#999;\n}\n.u-prolist dl dd{\n\tcolor:#222;\n}\n.u-prolist dl span{\n\tflex:1;\n\tmargin-right:20px;\n\twidth:5em;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n\twhite-space:nowrap;\n}\n.u-prolist dl span:last-child{\n\tmargin-right:0px;\n}\n.m-tb-editor{\n\twidth:100%;\n\tborder:solid 1px #e6e6e6;\n}\n.m-tb-editor td,.m-tb-editor th{\n\tpadding:5px 10px;\n}\n.m-tb-editor thead tr{\n\theight:30px;\n\tbackground:#f5f5f5;\n}\n.m-tb-editor thead th{\n\tborder-bottom:1px solid #efefef;\n}\n.m-tb-editor tbody{\n\tbackground:#fff;\n}\n.m-tb-editor .no-name-datatype{\n\tbackground-color:#f5f5f5;\n\tmargin:5px 50px 10px;\n\tposition:relative;\n}\n.m-tb-editor .no-name-datatype .arrow{\n\tborder:8px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#e6e6e6;\n\ttop:-15px;\n\tleft:20%;\n}\n.m-tb-editor .no-name-datatype .arrow::after{\n\tcontent:\"\";\n\tborder:6px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#f5f5f5;\n\ttop:-4px;\n\tleft:-6px;\n}\n.m-tb-editor .no-name-datatype tbody{\n\tbackground-color:inherit;\n}\n.m-tb-editor .no-name-datatype th{\n\tborder:none;\n}\n.m-tb-editor .no-name-datatype .operation{\n\tpadding:5px;\n\tborder:solid 1px #e6e6e6;\n\tborder-top:none;\n}\n.m-tb-editor .no-name-datatype .operation .u-btn{\n\tborder:solid 1px #e6e6e6;\n}\n.m-tb-editor .opt{\n\ttext-align:center;\n}\n.m-tb-editor .opt a .u-icon-no-hover{\n\tdisplay:none;\n}\n.m-tb-editor .opt a:hover .u-icon-no-hover{\n\tdisplay:inline-block;\n}\n.m-tb-editor .opt a:hover .u-icon-no-normal{\n\tdisplay:none;\n}");
I$('87bdbdb587e68c3a05e3d4a043d2d146',function (k, v, e, u, c, tpl, ui, _, cache, Notify, Haxi, Enum, Array2, Base2, Map2, Header2, Cli2, Jar2, DTModel, cofcache, html, css, p, pro) {

    p._$$Editor = k._$klass();
    pro = p._$$Editor._$extend(ui._$$Abstract);

//编辑器使用的时候一些字段说明
//     1.parentId
//     参数所在的资源的id
//     2.datatypeId
//     用于标记当前参数是否为导入参数，0：自身参数；非0：导入参数，当前值即为导入的数据模型的id
//     3.originalDatatypeId
//     用于标记当前参数是否为多重导入的参数，当前值即为参数所在的最原始的数据模型id。
//      4.type
//     参数的类型，系统数据模型或自定义数据模型的id
//     5.originalType
//     用于标记当前参数的最原始类型，0：没有被覆写过；非0：被覆写，当前值即为参数原始的类型，（一般是可变类型
// ）
//      6、使用环境下还要区分
//     如果是新增导入类型 则导入属性的parentId为导入类型的id，如果是修改导入类型的属性，则datatypeId
//     为导入类型的id。
    pro.__init = function (options) {
        this.__super(options);
    }

    pro.__reset = function (options) {
        this.__super(options);
        /**
         * params 参数对象
         * format 参数对象所属类型
         * shape 编辑器的形状,目前哈希和映射的时候有用到 ，哈希里header 标示是请求头，映射里standard标示的是规范,project是项目，projectgroup是项目组
         * level 编辑器的编辑权限 0代表是没有编辑权限
         * action [""| "mofify"]参数编辑器行为 modify为修改 默认是预览
         * parentId 参数归属资源标识
         * parentType 参数归属资源类型 0页面请求参数 1模板预填参数 2接口输入参数 3接口输出参数 4数据模型属性
         * resourceId 资源id
         * level level=0 说明只有查看权限
         * paramType 参数类型 接口详情的编辑器类型"reqHeaders","inputs"等
         * specType 变量映射type
         * listKey 列表的key 用于标识列表片段
         * isHideFullButton 是否显示全屏按钮
         * isRequire 是否要显示是否必须列
         * uuid 控件唯一标示
         */
        this.__lopt = {
            parentId: options.parentId,
            parentType: options.parentType,
            params: options.params || [],
            format: options.format || 0,
            pid: options.pid,
            shape: options.shape || "",
            level: options.level,
            resourceId: options.resourceId,
            paramType: options.paramType,
            specType: options.specType,
            action: "",
            listKey: options.listKey,
            isHideFullButton: false || options.isHideFullButton,
            isRequire: options.isRequire || 0,
            uuid: "uuid" + new Date().getTime()
        }
        this.__initComponent(this.__lopt);
        this.__infcache = cofcache.interface._$allocate({
            onitemload: function () {
                var item = this.__infcache._$getItemInCache(this.__lopt.resourceId);
                var params = item.params[this.__lopt.paramType];
                this.__initComponent({
                    format: this.__lopt.format,
                    action: "",
                    params: params
                })
            }.bind(this)
        });

        this.__doInitDomEvent([
            [this.__infcache.constructor, "update", this.__changeEditorByFormat.bind(this)]
        ]);

    };

    pro.__initXGui = (function () {
        var seed_css = e._$pushCSSText(css);
        var seed = tpl._$parseUITemplate(html);
        return function () {
            this.__seed_css = seed_css;
            this.__seed_html = seed.cnt;
        };
    })();

    pro.__initNode = function () {
        this.__super();
        this.__editorBox = e._$getByClassName(this.__body, 'j-editor')[0];
    };

    /**
     *
     * @param options
     * @property format 0 哈希 1枚举 2 数组 3字符 4 数值 5 布尔 6 文件 7映射
     * @param _params 初始化的数据
     * @private
     */
    pro.__initComponent = function (options) {
        //Base2 集成了3字符 4 数值 5 布尔 6 文件
        var _klassArr = [Haxi, Enum, Array2, Base2, Base2, Base2, Base2, Map2, Cli2, Jar2];
        var Klass = _klassArr[options.format];

        //如果是请求头类型
        if (this.__lopt.format == 0 && this.__lopt.shape == "header") {
            Klass = Header2;
        }
        if (this.__editorCom) {
            this.__editorCom.destroy();
        }
        var _data = u._$merge({}, this.__lopt, {
            params: options.params,
            format: options.format,
            action: options.action
        });
        this.__editorCom = new Klass({
            data: _data
        }).$inject(this.__editorBox);
    };
    /**
     * 监听编辑器的事件句柄
     * @param option {object}
     * @property format 0 哈希 1枚举 2 数组 3字符 4 数值 5 布尔 6 文件
     * @property action "modify"为修改类型
     */
    //修改编辑器的类型
    pro.__changeEditorByFormat = function (options) {
        if (!options.ext) return;
        if (this.__lopt.uuid !== options.ext.uuid) return;
        if (options.ext && options.ext.action == "menuchange") {
            var _params = (function () {
                if (options.ext.resType == 2) {//请求数据
                    return options.data.params.inputs;
                } else if (options.ext.resType == 3) {//返回数据
                    return options.data.params.outputs;
                } else {//正常参数数据
                    return options.data.params;
                }
            })();
            this.__lopt.format = options.ext.format;
            this.__initComponent({
                format: options.ext.format,
                action: "modify",
                params: _params
            });
        }
    };


    pro.__destroy = function () {
        this.__super();
        if (this.__editorCom) this.__editorCom.destroy();
        delete this.__editorCom
    };
    return p;
},'5e5afc6c5ab9a60e963a7e2e41706b91','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','8717e18cf0d38e654531116f64f5593d','356c13c039fe43b0aa515c031d53f736','d81f928b2e8dc2e94031eba0a018b644','8cbc286a7834dfcf29c8f7a018e77c02','7385ee68edde0ba303fb20b28ecfb227','afb57ef5a0e0ee34baead79fa46d3e43','00be034558e5576d964fba8986044987','a7a799d742a6cce9ea168666b84ea5c5','969489c92bd059bed841af4caf0ef26e','1b95f086f603ddbc861eb4b645bd16f0','efb4761bd937e6c0121246347af97c2c','f0f6da3416f708b96693c8393b74f477','3c16303653176b886dfbc83519eb6ba5','bb816ef34e3970cb48ab82ceb222867a','45874765e6e05636b88db04079ba223a','18fdbc27498bb1c4312201f146717dc0','8804cc26c38f0c29487993801cf932cd','a9d9b2ad471c62386b26f8e7879c8b4a');
I$('767ce224279d9855bf0b37a9d6952f17',"<div r-class={{\"m-tagme\":true,\"tagme-preview\":preview,\"tagme-readonly\":!editable,\"list-open\":!hideDropdown}}>\n    <div class=\"f-cb tagme-con\" on-click={this.focus($event)} ref=\"tagmecon\">\n        {#list xlist as item by item_index}\n        <span class=\"t-item\" title=\"{item.name}\">\n            <em>{item.name}</em>\n            <i on-click={this.remove(item_index, $event)}>×</i>\n        </span>\n        {/list}\n        <!-- 没有标签时的提示 -->\n        <span r-class={{\"no-tag-tip\":true,\"f-dn\":!(!xlist.length&&hideDropdown&&preview)}} on-click={this.focus($event)} ref=\"notagtip\" r-html={noTagTip}></span>\n        {#if editable}\n        <input ref=\"input\" {#if !preview}placeholder={placeholder}{/if} class=\"tag-input\" type=\"text\" r-model={inputValue} on-input={this.input($event)} on-keydown={this.keydown($event)} />\n        {/if}\n    </div>\n    <ul r-class={{\"tag-list\":true,\"f-dn\":hideDropdown}} ref=\"listcon\">\n        {#if !hideDropdown}\n        {#list ylist as item by item_index}\n        {#if item_index < maxNum}\n        <li r-class={{\"list-item\":true,\"js-selected\":sIndex===item_index,\"not-selectable\":item.id===-1}} title=\"{item.title||item.name}\" on-click={this.add($event,item)}>\n            {#if item.__uiName}\n            <span r-html={item.__uiName}></span>\n            {#else}\n            <span>{item.name}</span>\n            {/if}\n            <!--搜索匹配的时候 __uiName 会算上 nameDesc, 此时就不用显示默认的 nameDesc-->\n            {#if !item.__uiName && item.nameDesc}\n            <span>{item.nameDesc}</span>\n            {/if}\n            {#list item.tags as tag}\n            <em class=\"tip-tag\" title={tag}>{tag}</em>\n            {/list}\n        </li>\n        {/if}\n        {/list}\n        {/if}\n    </ul>\n</div>\n");
I$('d76c97ecc2f46a33cc9bdf9f744a1cae',".m-tagme{\n\tposition:relative;\n}\n.m-tagme .tagme-con{\n\tborder:1px solid #e6e6e6;\n\tline-height:24px;\n\tpadding:2px;\n\tcursor:text;\n\ttransition:all ease 0.3s;\n}\n.m-tagme.list-open .tagme-con{\n\tborder-bottom-color:#fff;\n\tbackground:#fff;\n}\n.m-tagme .t-item{\n\tfloat:left;\n\tmargin:2px;\n\tcolor:#fff;\n\tbackground-color:#aaa;\n\tpadding:1px 10px;\n\tborder-radius:15px;\n\ttext-align:center;\n\tposition:relative;\n\tcursor:default;\n\tfont-size:12px;\n\tline-height:20px;\n\theight:20px;\n}\n.m-tagme .t-item em{\n\tmax-width:100px;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n}\n.m-tagme .t-item i{\n\tfont-size:14px;\n\tfont-weight:700;\n\tcolor:#fff;\n\topacity:0.5;\n\tcursor:pointer;\n\tborder:none;\n\tbackground:0 0;\n\tmargin:0;\n\tpadding:0;\n\ttransition:all ease 0.1s;\n\tposition:absolute;\n\tright:4px;\n\ttop:-2px;\n}\n.m-tagme .t-item i:hover{\n\topacity:1;\n}\n.m-tagme .tag-input{\n\tborder:0 none;\n\tpadding:0 5px;\n\tline-height:24px;\n\toutline:0;\n\twidth:200px;\n}\n.m-tagme .tag-list{\n\tborder:1px solid #e6e6e6;\n\tborder-top:0 none;\n\tmax-height:280px;\n\toverflow-y:auto;\n\tline-height:20px;\n\toutline:0;\n\tposition:absolute;\n\tleft:0;\n\tright:0;\n\tz-index:9;\n\tbackground-color:#fff;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n\tfont-size:12px;\n}\n.m-tagme .tag-list li{\n\ttransition:all ease 0.3s;\n\tpadding:5px;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n\tcursor:default;\n}\n.m-tagme .tag-list li.js-selected,.m-tagme .tag-list li:hover{\n\tbackground-color:#eee;\n}\n.m-tagme .tag-list li.not-selectable{\n\tbackground-color:#fff !important;\n\tcursor:not-allowed;\n\tcolor:#bbb;\n}\n.m-tagme .tag-list li .tip-tag{\n\tborder-radius:3px;\n\tbackground-color:#29addd;\n\theight:22px;\n\tline-height:22px;\n\twidth:54px;\n\tmargin:0 5px 0 0;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n\tcolor:#fff;\n\ttext-align:center;\n\tfont-size:12px;\n\tfloat:right;\n\twhite-space:nowrap;\n\tpadding:0 4px;\n}\n.m-tagme.tagme-preview .tagme-con,.m-tagme.tagme-readonly .tagme-con{\n\tborder-color:transparent;\n}\n.m-tagme.tagme-preview .t-item i,.m-tagme.tagme-readonly .t-item i{\n\tvisibility:hidden;\n}\n.m-tagme.tagme-preview:hover .tagme-con,.m-tagme.tagme-readonly:hover .tagme-con{\n\tborder-color:#e6e6e6;\n}\n.m-tagme.tagme-preview.tagme-edit .tagme-con,.m-tagme.tagme-readonly.tagme-edit .tagme-con{\n\tborder-color:#e6e6e6;\n}\n.m-tagme.tagme-preview.tagme-edit .t-item i,.m-tagme.tagme-readonly.tagme-edit .t-item i{\n\tvisibility:visible;\n}\n.m-tagme.tagme-readonly .tagme-con{\n\tcursor:default;\n}\n.m-tagme.tagme-readonly:hover .tagme-con{\n\tborder-color:transparent;\n}\n.m-tagme .hl{\n\tbackground-color:#fd9c41;\n\tcolor:#333;\n}\n.m-tagme .no-tag-tip{\n\tcolor:#bbb;\n\tfont-style:italic;\n\tfont-size:12px;\n\tmargin-left:4px;\n\tpointer-events:none;\n}");
I$('ac756f830dd7d5bd7642918e731ed189',function (k, u, e, v, jst, m, jstex, rb, util, html, css, p, pro) {

    p._$$ModuleTagme = k._$klass();
    pro = p._$$ModuleTagme._$extend(m._$$Module);

    var BACK_SPACE = 8;
    var ARROW_UP_KEY = 38;
    var ARROW_DOWN_KEY = 40;
    var ENTER_KEY = 13;
    e._$addStyle(css);

    // 默认配置参数
    var defaultOptions = {
        // 父容器
        parent: document.body,
        // 自动提示的搜索缓存
        searchCache: null,
        // 自动提示的搜索缓存 key
        searchCacheKey: null,
        // 搜索结果列表数据处理函数
        searchResultFilter: function (result) {
            return result;
        },
        // 已有标签列表, 支持两种格式, 一种是字符串, 一种是对象, 对象的时候必须要有 id 字段
        // 格式一, 每项都是字符串:
        // ['A', 'B', 'C']
        // 格式二, 每项是个完整的对象, name 是显示的名称, title 是鼠标 hover 的提示, 如果不传则等同于 name
        //        namePinyin 是 name 的拼音, 以便输入时支持拼音联想
        // [{id: 1, name: 'A', namePinyin: 'A', title: 'A', tags: ['xxx', 'yyy']}, {id: 2, name: 'B'}, {id: 3, name: 'C'}]
        tags: [],
        // 自动提示中的标签列表, 包括已有的标签列表, 格式同 tags
        list: [],
        // 是否为预览模式
        preview: true,
        // 是否可以编辑
        editable: true,
        // 是否只能选择自动提示中的选项
        choseOnly: true,
        // 是否根据输入框的值进行搜索
        isSearchByValue: false,
        // 是否只搜索一次
        isSearchOnce: null,
        // 输入框的 placeholder
        placeholder: '',
        // 搜索时需要发送的查询参数
        queryData: null,
        // 失去焦点后的回调, 包含两个字段:
        // data.tags 当前标签列表
        // data.change 标签列表是否发生变化
        done: function (data) {
            //console.log(data)
        },
        // 没有标签时的提示文案
        noTagTip: '暂无标签',
        // 下拉列表最多渲染的个数
        maxNum: Infinity
    };

    pro.__reset = function (options) {
        this.__super(options);
        this._options = u._$merge({}, defaultOptions, options);
        if (!this._options.placeholder) {
            this._options.placeholder = this._options.choseOnly ? '请选择标签' : '请输入标签';
        }
        if (this._options.searchCache) {
            // 如果是通过缓存加载的自动提示列表, 强制将其转为空数组, 防止误传参数
            this._options.list = [];
        }
        // 将字符串格式的tag转为对象格式的tag
        if (typeof (this._options.list[0] || this._options.tags[0]) === 'string') {
            this._options.list = this._convertStrTagList(this._options.list);
            this._options.tags = this._convertStrTagList(this._options.tags);
        }
        // 去除无效 tag, 即 id 为空字符串的 tag
        this._options.tags = this._options.tags.filter(function (tag) {
            return tag.id !== '';
        });
        this._options.tags = this._options.tags.sort(function (itemA, itemB) {
            return itemA.name.localeCompare(itemB.name);
        });
        var tagList = this._getList();
        this.tagList = new tagList({
            data: {
                xlist: this._options.tags,
                alist: this._options.list,
                preview: this._options.preview,
                choseOnly: this._options.choseOnly,
                editable: this._options.editable !== false,
                isSearchByValue: this._options.isSearchByValue,
                done: this._options.done,
                placeholder: this._options.placeholder,
                noTagTip: this._options.noTagTip,
                maxNum: this._options.maxNum
            }
        }).$inject(this._options.parent);
    };

    pro._convertStrTagList = function (list) {
        return list.map(function (item) {
            return {
                name: item,
                id: item,
                title: item
            }
        }, this);
    };

    pro._getList = function () {
        var that = this;
        return rb.extend({
            template: html,
            config: function () {
                // 是否在加载数据
                this._isRequesting = false;
                // 备份用, 回调时需要有没有变化的信息
                this.data.oxlist = this.data.xlist.map(function (item) {
                    return {
                        id: item.id,
                        name: item.name
                    };
                });
                this.data.opreview = this.data.preview;
                this.data.sIndex = null;
                this.data.hideDropdown = true;
                this.data.editMode = false;
                this.updateYList();
            },

            updateYList: function () {
                this.data.ylist = this.data.alist.filter(function (item) {
                    delete item.__uiName;
                    var found = this.data.xlist.find(function (itm) {
                        return itm.id === item.id;
                    });
                    return !found;
                }, this);
                this.checkYList();
            },

            checkYList: function () {
                if (this.data.ylist.length === 0) {
                    if (this._isRequesting === true) {
                        this.data.ylist.push({
                            id: -1,
                            name: '正在请求列表数据...'
                        });
                    } else {
                        this.data.ylist.push({
                            id: -1,
                            name: '没有可选择的项'
                        });
                    }
                }
            },

            remove: function (tagIndex, evt) {
                evt && evt.event.stopPropagation();
                this.data.xlist.splice(tagIndex, 1);
                this.updateYList();
                setTimeout(function () {
                    this.$refs.input.focus();
                    this.$update();
                }.bind(this), 0);
            },

            input: function (evt) {
                evt.event.preventDefault();
                this.data.hideDropdown = false;
                if (that._options.searchCache && !this.acListLoaded) {
                    // 加载远程的自动提示列表
                    this.getRemoteData();
                }
                var value = evt.target.value.trim();
                this.data.inputValue = value;
                if (!value) {
                    this.data.ylist = this.data.alist.filter(function (item) {
                        delete item.__uiName;
                        return true;
                    });
                    return;
                }
                this.data.ylist = this.data.alist.filter(function (item) {
                    delete item.__uiName;
                    var found = this.data.xlist.find(function (itm) {
                        return itm.name.indexOf(item.name) > -1;
                    });
                    if (found) {
                        return false;
                    }
                    var iv = item.name + (item.nameDesc || '');
                    var hitIndex = iv.toLowerCase().indexOf(value.toLowerCase());
                    if (hitIndex !== -1) {
                        item.__uiName = jstex.escapeHtml(iv.substr(0, hitIndex)) + '<b class="hl">' + jstex.escapeHtml(iv.substr(hitIndex, value.length)) + '</b>' + jstex.escapeHtml(iv.substr(hitIndex + value.length, iv.length - 1));
                        return true;
                    }
                    var ivpy = item.namePinyin;
                    var matchPinyinResult = util.highlightPinyin(iv, ivpy, value);
                    if (matchPinyinResult) {
                        item.__uiName = matchPinyinResult;
                        return true;
                    }
                }, this);
                this.checkYList();
            },

            add: function (evt, item) {
                evt && evt.event.stopPropagation();
                if (item.id === -1) {
                    // 点击了提示信息
                    return;
                }
                if (this.data.choseOnly) {
                    // 只能选择自动提示列表中的项
                    if (this.data.sIndex !== null) {
                        // 方向键选取
                        this.data.xlist.push(this.data.ylist[this.data.sIndex]);
                    } else if (item.hasOwnProperty('id')) {
                        // 点击选择自动提示中的选项
                        this.data.xlist.push(item);
                    } else if (item.name) {
                        // 试着查找匹配, 如果唯一并且不是"没有可选择的项", 就添加
                        if (this.data.ylist.length === 1 && this.data.ylist[0].hasOwnProperty('id') && this.data.ylist[0].id !== -1) {
                            this.data.xlist.push(this.data.ylist[0]);
                        }
                    }
                } else {
                    // 可以添加输入的项
                    var found = this.data.xlist.find(function (itm) {
                        return itm.name === item.name;
                    });
                    if (item.name && !/^(,|，)$/.test(item.name) && !found) {
                        // 添加新项
                        item.id = item.name;
                        this.data.xlist.push(item);
                    }
                }
                // 不论哪种情况都清空内容
                this.data.inputValue = null;
                this.data.sIndex = null;
                this.updateYList();
                this.$refs.input.focus();
            },

            keydown: function (evt) {
                var keyCode = evt.event.keyCode;
                if (keyCode === ENTER_KEY) {
                    evt.event.preventDefault();
                    var value = this.$refs.input.value.trim();
                    this.add(null, {
                        name: value
                    });
                } else if (keyCode === ARROW_UP_KEY) {
                    evt.event.preventDefault();
                    if (this.data.sIndex === null) {
                        this.data.sIndex = this.data.ylist.length - 1;
                    } else {
                        this.data.sIndex -= 1;
                        if (this.data.sIndex < 0) {
                            this.data.sIndex = this.data.ylist.length - 1;
                        }
                    }
                    if (this.data.ylist[this.data.sIndex].id !== -1) {
                        this.data.inputValue = this.data.ylist[this.data.sIndex].name;
                        this._setListScrollTop();
                    } else {
                        // 没有可选择的项
                        this.data.sIndex = null;
                    }
                } else if (keyCode === ARROW_DOWN_KEY) {
                    evt.event.preventDefault();
                    if (this.data.sIndex === null) {
                        this.data.sIndex = 0;
                    } else {
                        this.data.sIndex += 1;
                        if (this.data.sIndex > this.data.ylist.length - 1) {
                            this.data.sIndex = 0;
                        }
                    }
                    if (this.data.ylist[this.data.sIndex].id !== -1) {
                        this.data.inputValue = this.data.ylist[this.data.sIndex].name;
                        this._setListScrollTop();
                    } else {
                        // 没有可选择的项
                        this.data.sIndex = null;
                    }
                } else if (keyCode === BACK_SPACE) {
                    if (!this.$refs.input.value) {
                        // input 没有值的时候删除最后一个tag
                        evt.event.preventDefault();
                        this.remove(this.data.xlist.length - 1);
                    }
                }
            },

            _setListScrollTop: function () {
                if (this.data.sIndex > 6) {
                    this.$refs.listcon.scrollTop = (this.data.sIndex - 6) * 40;
                } else {
                    this.$refs.listcon.scrollTop = 0;
                }
            },

            focus: function (evt) {
                if (!this.data.editable) {
                    // 不可修改
                    return;
                }
                this.data.hideDropdown = !this.data.hideDropdown;
                this.data.preview = false;
                this._addEventOnce();
                if (that._options.searchCache && !this.acListLoaded) {
                    // 加载远程的自动提示列表
                    this.getRemoteData();
                }
            },

            _addEventOnce: function () {
                this._hideHandler = this._hideHandler || function (evt) {
                        if (evt.target === this.$refs.input
                            || evt.target === this.$refs.tagmecon) {
                            this.$refs.input.focus();
                            return;
                        }
                        this.data.hideDropdown = true;
                        // 根据初始状态复位
                        if (this.data.opreview) {
                            this.data.preview = true;
                        }
                        var value = this.$refs.input.value.trim();
                        this.add(null, {
                            name: value
                        });
                        var tagIdsNames = this.getTags();
                        this.data.done({
                            tags: tagIdsNames,
                            oTags: this.data.oxlist,
                            change: tagIdsNames.map(function (item) {
                                return item.id;
                            }).join(',') !== this.data.oxlist.map(function (item) {
                                return item.id;
                            }).join(',')
                        });
                        this.data.oxlist = this.data.xlist.map(function (item) {
                            return {
                                id: item.id,
                                name: item.name
                            }
                        });
                        Regular.dom.off(document, 'click', this._hideHandler);
                        // todo: 有时输入框无法失焦?
                        this.$refs.input.blur();
                        this.$update();
                    }.bind(this);
                // 需要先移除事件, 不然反复点击时会重复触发
                Regular.dom.off(document, 'click', this._hideHandler);
                Regular.dom.on(document, 'click', this._hideHandler);
            },

            getNameAndId: function () {
                return this.data.xlist.map(function (item) {
                    return {id: item.id, name: item.name};
                });
            },

            getTags: function () {
                return this.getNameAndId().sort(function (itemA, itemB) {
                    return itemA.id.toString().localeCompare(itemB.id.toString());
                });
            },

            getRemoteData: function () {
                var searchKey = this.$refs.input.value.trim();
                var handler = function (alist) {
                    alist = that._options.searchResultFilter(alist);
                    if (typeof alist[0] === 'string') {
                        alist = that._convertStrTagList(alist);
                    }
                    // 排序
                    alist.sort(function (itemA, itemB) {
                        return itemA.name.localeCompare(itemB.name);
                    });
                    // 去除搜索提示列表中已经选中的项
                    this.data.alist = alist;
                    this.data.ylist = [];
                    alist.forEach(function (item) {
                        var found = this.data.xlist.find(function (itm) {
                            return itm.id === item.id
                        });
                        if (!found) {
                            this.data.ylist.push(item);
                        }
                    }, this);
                    this.checkYList();
                }.bind(this);
                var cache;
                // 根据用户输入的关键词进行搜索
                if (this.data.isSearchByValue) {
	                cache = that._options.searchCache._$allocate({
                        onlistload: function (evt) {
                            this._isRequesting = false;
                            if (that._options.isSearchOnce) {
                                this.acListLoaded = true;
                            }
                            handler(cache._$getDataInCache(searchKey));
                            this.$update();
                        }.bind(this)
                    });
                    if (this.acListLoaded) {
                        return;
                    }
                    var data = cache._$getDataInCache(searchKey);
                    if (data) {
	                    if (that._options.isSearchOnce){
		                    this.acListLoaded = true;
	                    }
                        return handler(data);
                    }
                    this._isRequesting = true;
					cache._$getList({
						key: searchKey,
						data: {
							v: searchKey
						}
					});

                } else {
                    // 加载资源列表
	                cache = that._options.searchCache._$allocate({
                        onlistload: function (evt) {
                            // 列表加载完成标记, 加载一次即可
                            this.acListLoaded = true;
                            handler(cache._$getListInCache(that._options.searchCacheKey));
                            this.$update();
                        }.bind(this)
                    });
                    if (this.acListLoaded) {
                        return;
                    }
	                cache._$getList({
                        key: that._options.searchCacheKey,
                        data: that._options.queryData
                    });
                }
            }
        });
    };

    /**
     * 获取当前的tag列表
     * @return  {Array} tags - 标签列表
     */
    pro._$getTags = function () {
        return this.tagList.getTags();
    };

    /**
     * 清空
     */
    pro._$empty = function () {
        this.tagList.data.xlist = [];
        this.tagList.$update();
    };

    /**
     * 组件回收
     */
    pro._$recycle = function (options) {
        this.__super(options);
        this.tagList && this.tagList.destroy();
        this.tagList = null;
    };

    /**
     * 添加一个或者一组标签
     * @param  {Object|Array} tags - 要添加的标签列表
     */
    pro._$add = function (tags) {
        if (!u._$isArray(tags)) {
            tags = [tags];
        }
        if (typeof tags[0] === 'string') {
            tags = this._convertStrTagList(tags);
        }
        // 是否加可以添加到选中的以及自动提示的列表中
        tags.forEach(function (tag) {
            var foundTag = this.tagList.data.xlist.find(function (item) {
                return item.id === tag.id;
            });
            // 如果当前的选中列表中不存在, 就添加
            if (!foundTag) {
                this.tagList.data.xlist.push(tag);
            }
            foundTag = this.tagList.data.alist.find(function (item) {
                return item.id === tag.id;
            });
            // 如果当前的自动完成列表不存在, 就添加
            if (!foundTag) {
                this.tagList.data.alist.push(tag);
            }
        }, this);
        // 排序
        this.tagList.data.alist.sort(function (itemA, itemB) {
            return itemA.name.localeCompare(itemB.name);
        });
        this.tagList.$update();
    };

    /**
     * 移除一个或者一组标签
     * @param  {Object|Array} tags - 要删除的标签列表
     */
    pro._$remove = function (tags) {
        if (!u._$isArray(tags)) {
            tags = [tags];
        }
        if (typeof tags[0] === 'string') {
            tags = this._convertStrTagList(tags);
        }
        var existTagRemoved = false
        // 从选中的列表以及自动提示的列表中删除标签
        tags.forEach(function (tag) {
            var foundIndex = null;
            this.tagList.data.xlist.find(function (item, idx) {
                if (item.id === tag.id) {
                    foundIndex = idx;
                    existTagRemoved = true;
                    return true;
                }
            });
            // 如果在当前的选中列表中存在, 就删除
            if (foundIndex !== null) {
                this.tagList.data.xlist.splice(foundIndex, 1);
            }
            foundIndex = null;
            this.tagList.data.alist.find(function (item, idx) {
                if (item.id === tag.id) {
                    foundIndex = idx;
                    return true;
                }
            });
            // 如果当前的自动完成列表存在, 就删除
            if (!foundIndex) {
                this.tagList.data.alist.splice(foundIndex, 1);
            }
        }, this);
        // 不需要重新排序
        this.tagList.$update();
        // 如果有已经存在的标签被移除了, 则触发 change 事件
        if (existTagRemoved) {
            var tagIdsNames = this.tagList.getTags();
            this.tagList.data.done({
                tags: tagIdsNames,
                change: true
            });
        }
    };

    /**
     * 从自动提示的列表中移除一个或者一组标签, 此时不需要修改显示的标签列表
     * 在有多个 tagme 实例并且有相互关系的时候此方法会用到
     * @param  {Object|Array} tags - 要删除的标签列表
     */
    pro._$removeFromList = function (tags) {
        if (!u._$isArray(tags)) {
            tags = [tags];
        }
        if (typeof tags[0] === 'string') {
            tags = this._convertStrTagList(tags);
        }
        // 从自动提示的列表中删除标签
        tags.forEach(function (tag) {
            var foundIndex = null;
            this.tagList.data.alist.find(function (item, idx) {
                if (item.id === tag.id) {
                    foundIndex = idx;
                    return true;
                }
            });
            // 如果当前的自动完成列表存在, 就删除
            if (!foundIndex) {
                this.tagList.data.alist.splice(foundIndex, 1);
            }
        }, this);
        // 不需要重新排序
        this.tagList.$update();
    };

    /**
     * 从自动提示的列表中添加一个或者一组标签, 此时不需要修改显示的标签列表
     * 在有多个 tagme 实例并且有相互关系的时候此方法会用到
     * @param  {Object|Array} tags - 要添加的标签列表
     */
    pro._$addToList = function (tags) {
        if (!u._$isArray(tags)) {
            tags = [tags];
        }
        if (typeof tags[0] === 'string') {
            tags = this._convertStrTagList(tags);
        }
        // 从自动提示的列表中删除标签
        tags.forEach(function (tag) {
            var found = this.tagList.data.alist.find(function (item) {
                return item.id === tag.id;
            });
            // 如果当前的自动完成列表不存在, 就添加
            if (!found) {
                this.tagList.data.alist.push(tag);
            }
        }, this);
        // 排序
        this.tagList.data.alist.sort(function (itemA, itemB) {
            return itemA.name.localeCompare(itemB.name);
        });
        this.tagList.$update();
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','1b12378d868a5877d4dba65367942b75','c946055836c26441b9d60b589f2e1581','4f974133cc48417770aab7278404f301','ffa820b4cb293ae990489967d5c4a899','8cbc286a7834dfcf29c8f7a018e77c02','767ce224279d9855bf0b37a9d6952f17','d76c97ecc2f46a33cc9bdf9f744a1cae');
I$('3f7c620de8e4be39cd0f136f1f176823',function (_rb, _u, _cu, pgCache, userCache, _proCache, _dbConst, _p) {
    _p.Component = _rb.extend({
        config: function (data) {
            this.__pgCache = pgCache._$$CacheProGroup._$allocate();
            this.resetProjects();
            this.resetTop();
            this.chooseDefault();
        },
        init: function () {
            // 项目组的增删操作触发
            this.$on('list-change', this.changeData.bind(this));
            //项目组的修改操作触发
            this.$on('update', this.updateData.bind(this));
	        //项目的增删操作触发
            this.$on('pro-change', this.changePro.bind(this));
	        //项目的修改操作触发
            this.$on('pro-update', this.updatePro.bind(this));
        },
        //选出默认分组
        chooseDefault: function () {
	        this.data.defaultPG = [];
            _u._$forEach(this.data.progroups, function (item) {
                if (item.type == 1) {
                    this.data.defaultPG.push(item);
                }
            }._$bind(this));
        },
        //区分置顶和非置顶项目组,显示删除，计算项目数，计算创建时间戳
        resetTop: function () {
	        this.resetLogo();
            this.data.topProgroup = [];
            this.data.noTopProgroup = [];
            var topList = userCache._$$CacheUser._$allocate()._$getUserInCache().progroupTopList;
            if (topList != "") {
                topList = topList.split(',');
            }else if(topList.indexOf(',') == '-1'){
                topList = [topList];
            } else {
                topList = [];
            }
            _u._$forEach(this.data.progroups, function (item) {
                //添加项目数字段和创建时间字段
                item.count = item.projects.length;
                item.time = new Date(item.createTime).valueOf();
	            //匹配头像http请求为https
	            if(item.logo){
		            item.logo = item.logo.replace(/^http:\/\/nos\.netease\.com:80/, 'https://nos.netease.com:443');
	            }
                //是否显示删除icon
               var role = this.__pgCache._$getPrivilege(item.id).isAdminOrCreator;
                if (role) {
                    item.showDelete = true;
	                item.showUpload = true;
	                item.showStick = true;
                } else {
	                item.showDelete = false;
	                item.showUpload = false;
	                item.showStick = true;
                }
                //置顶项目组筛选
                var flag = false; //判断当前项目组是否为置顶
                _u._$forEach(topList, function (item2) {
                    if (item.id == item2) {
                        item.isTop = 1;
                        this.data.topProgroup.push(item);
                        flag = true;
                    }
                }.bind(this));
                if (!flag && item.type != 1) {
                    item.isTop = 0;
                    this.data.noTopProgroup.push(item);
                }
            }.bind(this));
        },
        //项目区分公共资源库,区分置顶非置顶
        resetProjects: function () {
            var that = this;
            _u._$forEach(this.data.progroups, function (item) {
                item.topPro = [];
                item.noTopPro = [];
                item.commonPros = [].concat(item.projects);
                item.topPro = [];
                item.noTopPro = [];
                item.pubPro = [];
	            if(item.projectTopList.constructor == Array){
		            item.projectTopList = [].concat(item.projectTopList);
	            }else{
		            if(item.projectTopList == ''){
			            item.projectTopList = [];
		            }else if(item.projectTopList.indexOf(',') == '-1'){
			            item.projectTopList = [item.projectTopList];
		            } else{
			            item.projectTopList =  item.projectTopList.split(',');
		            }
	            }
	            _u._$forEach(item.projects, function (item2){
                    var role = that.__pgCache._$getRole(item.id);
                    if (role == 'creator' || role == 'administrator') {
                        item2.role = role;
                    } else {
                        item2.role = "normal";
                    }
		            item2.time =  item2.createTime;
		            if(item2.type == 1){
			            item.pubPro = item2;
		            }else if(item.projectTopList.indexOf(item2.id.toString()) != -1){
			            item2.isTop = 1;
			            item.topPro.push(item2);
		            }else{
			            item.noTopPro.push(item2);
		            }
	            }._$bind(this))
            });
        },
	    //添加之后重新排序
	    sortPgAfterAdd: function(){
		    var orderType = parseInt(userCache._$$CacheUser._$allocate()._$getUserInCache().progroupOrder);
		    //取得当前排序字段
		    var sorttype = _cu.__initOrder(orderType, '');
		    this.data.sortType = sorttype;
		    if(!sorttype) return;
		    if (!this.data.progroups) return;
		    var tag = sorttype.split('-')[0];
		    //按字段排序，并返回所需参数
			var _sortAfterData = _cu.__sortByField(tag, this.data.sortType, this.data.topProgroup, this.data.noTopProgroup, this.data.defaultPG,false);
			//发送请求进行排序
		    this.__pgCache._$sort({ids: _sortAfterData.pids, type: _sortAfterData.typeNum});
	    },
	    //添加之后重新排序
	    sortProAfterAdd: function(progroup){
		    var projectOrder = progroup.projectOrder;
		    var sorttype = _cu.__initOrder(projectOrder, '');
		    progroup.sortype = sorttype;
		    if(!sorttype) return;
		    if (!progroup.projects) return;
		    var tag = sorttype.split('-')[0];
		    var _sortAfterData = _cu.__sortByField(tag, progroup.sortype, progroup.topPro, progroup.noTopPro, progroup.pubPro, false);
		    this.__proCache = _proCache._$$CachePro._$allocate();
		    this.__proCache._$sort({
			    ids: _sortAfterData.pids,
			    type: _sortAfterData.typeNum,
			    pgId: progroup.id,
			    key: this.__proCache._$getListKey(progroup.id),
			    ext:{progroupId:  progroup.id}
		    });
	    },
        resetLogo: function(){
	        _cu._$resetLogo(this.data.progroups, 'name', 'namePinyin');
        },
        //项目组变化
        changeData: function (_data,type) {
            this.data.progroups = _data;
	        this.resetProjects();
	        this.resetTop();
	        if(!!type && type == 'add'){
		        this.sortPgAfterAdd();
	        }
            //如果退出了别人的默认分组则需要重新组装默认分组 modified by lihl 2017.1.4
            this.chooseDefault();
	        this.$update();
        },
        //项目组修改
        updateData: function (_data) {
            if (!_data) {
                return;
            }
            _u._$forEach(this.data.progroups, function (item) {
                if (item.id == _data.id) {
                    item.name = _data.name;
                    item.description = _data.description;
	                item.logo = _data.logo;
                    item.isLock = _data.isLock;
                }
            });
            this.$update();
        },
        //项目变化
        changePro: function (_data,type) {
	        if(type== 'add'){
		        this.data.proList = {};
	        }
	        _u._$forEach(this.data.progroups, function (item) {
                _u._$forEach(_data, function (item2) {
                    if (item.id == item2.progroupId) {
                        item.projects = _data;
	                    if(type== 'add'){
		                    this.data.proList = item;
	                    }
                    }
                }._$bind(this));
            }._$bind(this));
            this.resetProjects();
	        if(type== 'add'){
		        this.sortProAfterAdd(this.data.proList);
	        }
            this.$update();
        },
        //项目修改
        updatePro: function (_data) {
            _u._$forEach(this.data.progroups, function (item) {
                if (_data.progroupId == item.id) {
                    _u._$forEach(item.projects, function (item2) {
                        if (_data.id == item2.id) {
                            item2.name = _data.name;
                            item2.description = _data.description;
	                        item2.logo = _data.logo;
                        }
                    });
                }
            }._$bind(this));
            this.resetProjects();
            this.$update();
        }
    });
    return _p.Component;
},'ffa820b4cb293ae990489967d5c4a899','3ff9c25bd81a3c2a260c28122918263a','8cbc286a7834dfcf29c8f7a018e77c02','e8507450a35f1adad6e9dae810fd545a','29f4b2dc96ca931edfeb9264ffe3e954','09437bf7199eb808a35a38e5178e5151','993671841dcf289096c7171d53130309');
I$('c8aeefced65e657f120896bd26d4b520',function (_k, _e, _v, _u, _m, _p, _pro) {

    _p._$$DraggerSort = _k._$klass();
    _pro = _p._$$DraggerSort._$extend(_m._$$Module);

    /**
     * 控件初始化
     * @return {void}
     */
    _pro.__init = function (options) {
        this.__super(options);
    }

    /**
     * 控件重置
     * @param  {object} options - 配置信息
     * @return {void}
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.mainDiv = options.parent;
        this.sortList = options.list;
        this.type = options.type;
        this.__doInitDomEvent([[
            this.sortList, 'mouseDown',
            this.__dragStart.bind(this)
        ]]);
    }

    /**
     * 控件销毁
     * @return {void}
     */
    _pro.__destroy = function () {
        this.__super();
        this.__doClearDomEvent();
    }

    /**
     * 拖拽开始
     * @return {void}
     */
    _pro.__dragStart = function (event) {
        if (event.button == 2 || _e._$hasClassName(event.target, 'j-tag')) {
            return;
        }
        var oLi = _v._$getElement(event, 'c:drag-li');
        var logo = _v._$getElement(event, 'c:info-logo');
        var reslink = _v._$getElement(event, 'c:resource');
	    var itemlink = _v._$getElement(event, 'c:item-link');
        if (_e._$hasClassName(oLi, 'item-top') || _e._$hasClassName(oLi, 'item-pub') ||logo ||reslink ||itemlink) return;
        if (oLi == null || _e._$hasClassName(oLi, 'res-add')) {
            return;
        }
        //取得排序前的顺序id数组
        this._oldIds = [];
        var pgLis = _e._$getChildren(this.sortList, 'drag-li');
        _u._$forEach(pgLis, function (item) {
            this._oldIds.push(_e._$dataset(item, 'resId'));
        }.bind(this));

        var oCopyLi = oLi.cloneNode(true);
        var oNewLi = document.createElement('li');
            _e._$addClassName(oNewLi, 'res-item');
        _e._$addClassName(oNewLi, 'drag-li');
        var offL = _e._$offset(oLi, document.body).x + 'px';
        var offT = _e._$offset(oLi, document.body).y + 'px';
	    var width = _e._$getStyle(oLi,'width');
	    //_e._$setStyle(oNewLi,'width',width);
        //复制节点和新节点的样式调整
        _e._$addClassName(oCopyLi, 'j-newli');
        document.body.appendChild(oCopyLi);
        _e._$style(oCopyLi, {left: offL, top: offT, width:width});

        //替换节点,增加类
        oLi.parentNode.replaceChild(oNewLi, oLi);
        _e._$addClassName(oNewLi, 'j-border');

        var _downX = _v._$clientX(event);
        var _downY = _v._$clientY(event);
        var _offsetLeft = oCopyLi.offsetLeft;
        var _offsetTop = oCopyLi.offsetTop;

        _v._$addEvent(document, 'mouseMove', this.__dragging.bind(this, oNewLi, oCopyLi, _downX, _downY, _offsetLeft, _offsetTop));
        _v._$addEvent(document, 'mouseUp', this.__dragEnd.bind(this, oNewLi, oCopyLi, oLi));
    }

    /**
     * 拖拽中
     * @return {void}
     */
    _pro.__dragging = function (oNewLi, oCopyLi, dX, dY, oL, oT, event) {
        var aLiList = _e._$getChildren(this.sortList, 'drag-li');
        var _aLiList = [];
        var _X = _v._$clientX(event);
        var _Y = _v._$clientY(event);
        var _mLeft = oL + _X - dX;
        var _mTop = oT + _Y - dY; //当前oCopyLi的offset
        var oSize = this.__overBorder(_mLeft, _mTop); //边界检测
        _mLeft = oSize.left || _mLeft;
        _mTop = oSize.top || _mTop;
        console.log(_mLeft)
        console.log(_mTop)
        _e._$style(oCopyLi, {left: _mLeft + 'px', top: _mTop + 'px'});
        var index = this.__getDragLocation(_mLeft, _mTop);
        console.log(index)
        if (index === null) return;
        _u._$forEach(aLiList, function (item) {
            if (!_e._$hasClassName(item, 'j-border')) {
                _aLiList.push(item);
            }
        }.bind(this));
        this.__insertDiv(_Y, _aLiList[index], oNewLi, this.sortList);
    }

    /**
     * 拖拽完成
     * @return {void}
     */
    _pro.__dragEnd = function (oNewLi, oCopyLi, oLi, event) {
        var ids = [];
        var left = _e._$offset(oNewLi, document.body).x;
        var top = _e._$offset(oNewLi, document.body).y;
        this.__animate(oCopyLi, {left: left, top: top}, 100, function () {
            _e._$remove(oCopyLi, false);
            oNewLi.parentNode.replaceChild(oLi, oNewLi);
            _e._$delClassName(oNewLi, 'j-border');
            _v._$clearEvent(document, 'mouseMove mouseUp');

            var pgLis = _e._$getChildren(this.sortList, 'drag-li');
            _u._$forEach(pgLis, function (item) {
                ids.push(_e._$dataset(item, 'resId'));
            });
            if (ids.toString() != this._oldIds.toString()) {
                this._$dispatchEvent('dragEnd', ids);
            }
        }.bind(this));
    }

    /**
     * 获取元素位置
     * @param  {Number} oLeft
     * @param  {Number} oTop
     * @return {Number} this._index
     */
    _pro.__getDragLocation = function (oLeft, oTop) {
        var aLiList = _e._$getChildren(this.sortList, 'drag-li');
        var index = null;
        var liW = aLiList[0].offsetWidth;
        var liH = aLiList[0].offsetHeight;
        for (var i = 0; i < aLiList.length; i++) {
            var left = _e._$offset(aLiList[i], document.body).x;
            var top = _e._$offset(aLiList[i], document.body).y;
            if (oLeft > left - liW + 50 && oLeft < left + liW - 50 && oTop > top - liH + 50 && oTop < top + liH - 50) {
                index = i;
                break;
            }
        }
        return index;
    }

    /**
     * 鼠标移动变换效果
     * @param  {Number}        y            - 偏移
     * @param  {Object}        oldElem        - 旧节点
     * @param  {Object}        newElem        - 新节点
     * @param  {Object}        parent        - 父节点
     */
    _pro.__insertDiv = function (y, oldElem, newElem, parent) {
        var top = _e._$offset(parent, document.body).y;
        var left = _e._$offset(parent, document.body).x;
        var list = _e._$getChildren(parent, 'item-normal');
        if (!oldElem) {
            if (!!_e._$getByClassName(this.mainDiv, 'item-pub')[0]) {
                oldElem = _e._$getByClassName(this.mainDiv, 'item-pub')[0];
            } else {
                oldElem = _e._$getByClassName(this.mainDiv, 'res-add')[0];
            }    
        } else {
            if (_e._$hasClassName(oldElem, 'item-top')) {
	            //如果非置顶数组为空，则插入到公共默认之前
	            if(list.length){
		            oldElem = list[0];
	            }else{
		            oldElem = _e._$getByClassName(this.mainDiv, 'item-pub')[0];
	            }
            }
        }
        if (y > top && y < top + parent.offsetHeight) {
            try {
                parent.insertBefore(newElem, oldElem);
            } catch (e) {
	            var pubElem = _e._$getByClassName(this.mainDiv, 'item-pub')[0];
                parent.appendChild(newElem, pubElem);
            }
        }
    }

    /**
     * 边界检查
     * @param  {Number} left
     * @param  {Number} top
     * @return {object}
     */
    _pro.__overBorder = function (left, top) {
        var x = 0;
        var y = 0;
        var mainDiv = this.mainDiv;
        var oSize = {};
        var mainOffset = _e._$offset(mainDiv, document.body);
        if (left < mainOffset.x) {
            x = mainOffset.x;
        }
        if (left > mainDiv.offsetLeft + mainDiv.offsetWidth) {
            x = mainDiv.offsetLeft + mainDiv.offsetWidth;
        }
        if (top < mainOffset.y) {
            y = mainOffset.y;
        }
        if (top > mainOffset.y + mainDiv.offsetHeight) {
            y = mainOffset.y + mainDiv.offsetHeight;
        }
        oSize.left = x;
        oSize.top = y;
        return oSize;
    }

    /**
     * 自定义简单动画函数
     * @param  {object} node   - 动画节点
     * @param  {object} params - 动画信息
     * @param  {number} time   - 持续时间
     * @param  {Function} callback
     * @return {void}
     */
    _pro.__animate = function (node, params, time, callback) {
        var _style = node.currentStyle ? node.currentStyle : window.getComputedStyle(node, null);
        time = document.all ? time * 0.6 : time * 0.9;
        for (var p in params) {
            (function (n) {
                n = p;
                if (n == "left" || n == "top") {
                    var _old = parseInt(_style[n]);
                    var _new = parseInt(params[n]);
                    var _tt = 10;
                    if (!isNaN(_old)) {
                        var count = _old;
                        var length = _old <= _new ? (_new - _old) : (_old - _new);
                        var speed = length / time * _tt;
                        var flag = 0;
                        var anim = setInterval(function () {
                            node.style[n] = count + "px";
                            count = _old <= _new ? count + speed : count - speed;
                            flag += _tt;
                            if (flag >= time) {
                                node.style[n] = _new + "px";
                                clearInterval(anim);
                            }
                        }, _tt);
                    }
                }
            })(p);
        }
        var timeHandler = setTimeout(function () {
            if (callback && typeof callback == "function") {
                callback();
                clearTimeout(timeHandler);
            }
        }, time + 100);
    }

    return _p;
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','c946055836c26441b9d60b589f2e1581');
I$('05a5699521f49387a513b4fbbfe550b9',"<div class=\"apply-part\">\n\t<div class=\"pg-title\">\n\t\t项目组：{this.data.progroupName}\n\t</div>\n\t<div class=\"apply-desc\">\n\t\t<span class='js-ipt-parent'>\n\t\t\t<textarea class=\"u-txt\" placeholder='申请理由' r-model={description} r-class={{'j-err-txt': !!textareaeError}} on-input ={this.checkVal()}></textarea>\n\t\t</span>\n\t</div>\n</div>");
I$('20ea553411b5253574c169cb58fb4294',".apply-part .pg-title{margin-bottom:20px;text-align:left;}.apply-part .u-txt{font-size:14px;width:100%;height:80px;padding:14px 10px;box-sizing:border-box;border:1px solid #e6e6e6;}.apply-part .u-txt.j-err-txt{border-color:#c71515;}.m-p-apply .u-btn{width:100%;box-sizing:border-box;color:#fff;}");
I$('bdba2ef3d2b4a8daf19096d94d7e03a5',function (Modal, _, _e, _html, _css) {
	_e._$addStyle(_css);
	var applyLayer = Modal.extend({
		config: function () {
			this.data.description = '';
			this.data.textareaeError = false;
			_._$extend(this.data, {
				"contentTemplate": _html,
				'class': 'm-p-apply',
				'title': '申请项目组权限',
				'closeButton': true,
				"okButton": '申请',
				"cancelButton": false
			});
			this.supr(this.data);
		},
		ok: function () {
			if (!!this.data.description.trim()) {
				this.$emit('apply',this.data.description,this.data.resId);
			} else {
				this.data.textareaeError = true;
				this.$update();
			}
		},
		checkVal: function(){
			if (!!this.data.description.trim()){
				this.data.textareaeError = false;
			}
			this.$update();
		}
	});
	return applyLayer;
},'a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','555a9eecaf26c5c01fe9db8d965bc30f','05a5699521f49387a513b4fbbfe550b9','20ea553411b5253574c169cb58fb4294');
I$('422387098dc8843f61fd6105d0b10787',function (util, p) {

    // 默认参数配置选项
    p.options = {
        // 类别
        formats: [
            {format: util.db.MDL_FMT_HASH, name: '哈希'},
            {format: util.db.MDL_FMT_ENUM, name: '枚举'},
            {format: util.db.MDL_FMT_ARRAY, name: '数组'},
            {format: util.db.MDL_FMT_STRING, name: '字符'},
            {format: util.db.MDL_FMT_NUMBER, name: '数值'},
            {format: util.db.MDL_FMT_BOOLEAN, name: '布尔'},
            {format: util.db.MDL_FMT_FILE, name: '文件'}
        ],
        // 预置参数
        params: [],
        // 选中的类别
        format: util.db.MDL_FMT_HASH,
        // 类别是否可以修改
        formatChangeable: true,
        // 表头
        headers: {},
        // 参数发生变化
        onChange: function () {

        }
    };

    // 参数所属资源类型
    p.options.paramTypes = {
        datatype: 4,
        'interface': 3
    };

    // 导入类别
    p.importTypes = {
        DATATYPE: 0,
        JSON: 1,
        INTERFACE: 2,
        JAVABEAN: 3
    };

    // 两个自定义类型: object 和 array，后端需要一个合法的整数id
    p.customDatatypes = {
        OBJECT_ID: 8999,
        ARRAY_ID: 9000
    };

    // 哈希表头
    // skipInSelectDetail: true 表示在 select 中的详情中不显示
    p.options.headers[util.db.MDL_FMT_HASH] = [
        {name: '名称', key: 'name', clazz: 'x-name'},
        {name: '类型', key: 'typeName', select: true, clazz: 'x-type'},
        {name: '描述', key: 'description', clazz: 'x-desc'},
        {name: '必需', key: 'required', select: true, clazz: 'x-req', skipInSelectDetail: true},
        {name: '默认值', key: 'defaultValue', clazz: 'x-dv', skipInSelectDetail: true},
        {name: '生成规则', key: 'genExpression', clazz: 'x-gexp', rule: true, skipInSelectDetail: true}
    ];

    // 枚举表头
    p.options.headers[util.db.MDL_FMT_ENUM] = [
        {name: '值', key: 'defaultValue', clazz: 'x-dv'},
        {name: '类型', key: 'typeName', select: true, clazz: 'x-type'},
        {name: '键（可选）', key: 'name', clazz: 'x-name'},
        {name: '描述', key: 'description', clazz: 'x-desc'}
    ];

    // 数组表头
    p.options.headers[util.db.MDL_FMT_ARRAY] = [
        {name: '数组元素类型', key: 'typeName', select: true, clazz: 'x-type'},
        {name: '描述', key: 'description', clazz: 'x-desc'},
        {name: '生成规则', key: 'genExpression', clazz: 'x-gexp', rule: true, skipInSelectDetail: true}
    ];

    // 字符、数值、布尔表头
    p.options.headers[util.db.MDL_FMT_STRING]
        = p.options.headers[util.db.MDL_FMT_NUMBER]
        = p.options.headers[util.db.MDL_FMT_BOOLEAN] = [
        {name: '默认值', key: 'defaultValue', clazz: 'x-dv'},
        {name: '描述', key: 'description', clazz: 'x-desc'},
        {name: '生成规则', key: 'genExpression', clazz: 'x-gexp', rule: true, skipInSelectDetail: true}
    ];

    // 文件表头
    p.options.headers[util.db.MDL_FMT_FILE] = [
        {name: '描述', key: 'description', clazz: 'x-desc'}
    ];

    // 异步接口请求头
    p.options.headers.iheader = [
        {name: '名称', key: 'name', clazz: 'x-name', select: true},
        {name: '值', key: 'defaultValue', clazz: 'x-dv', select: true},
        {name: '描述', key: 'description', clazz: 'x-desc'},
    ];
},'8cbc286a7834dfcf29c8f7a018e77c02');
I$('37e6d824192d54af199f417a7f982700',"<div r-class={{\"p-select\":true,\"list-open\":isOpen,\"is-required-sel\":isRequiredField}} ref=\"element\">\n    <div r-class={{\"select-hd\":true,\"js-preview\":preview&&!isOpen,\"js-disabled\":!editable,\"complex-type\":this.isComplexType()}}\n         title={selected?selected.name:placeholder}\n         on-mouseenter={this.showDatatypeDetail($event,true)}\n         on-mouseleave={this.showDatatypeDetail($event,false)}\n         on-click={this.toggle($event)}>\n        <input ref=\"input\" class=\"dis-name\" type=\"text\" r-model={inputValue}\n               title={inputValue} on-input={this.input($event)}\n               on-focus={this.focusInput($event)}\n               placeholder=\"{placeholder}\"\n               on-keydown={this.keydown($event)} readonly={!editable}/>\n        <i class=\"u-trigon-down\" ref=\"trigon\"></i>\n        <!-- 没有选中项并且preview为true时的提示 -->\n        {#if !inputValue&&preview&&!isOpen&&!isNormalParam}\n        <span class=\"empty-tip\" on-click={this.toggle($event)}>{emptyTip}</span>\n        {/if}\n    </div>\n    {#if editable&&isOpen&&xlist.length}\n    <div class=\"select-bd\" r-show={isOpen} on-mousewheel=\"{this.mouseWheel($event)}\">\n        <ul class=\"list-view\" ref=\"listcon\">\n            {#list xlist as item by item.id}\n            <li r-class={{\"js-disabled\":item.id===undefined,\"z-sel\":sIndex===item_index,\"is-array\":item.id===9000}}\n                title={item.title||item.name}\n                on-click={this.select($event,item,item_index)}>\n                {#if item.__uiName}\n                <span r-html={item.__uiName}></span>\n                {#else}\n                <span>{item.name}</span>\n                {/if}\n            </li>\n            {/list}\n        </ul>\n        {#if isNormalParam!==true&&isRequiredField!=true}\n        <div class=\"create-dt\" title=\"新建数据模型\" on-click={this.create($event)}>\n            <span><strong>+</strong>新建数据模型</span>\n        </div>\n        {/if}\n    </div>\n    {/if}\n    <!--普通参数没有详情，比如异步接口的请求头、响应头等-->\n    {#if !isOpen&&showDetail&&!isNormalParam}\n    <div class=\"select-detail\"\n         on-mouseenter={this.showDatatypeDetail($event,true)}\n         on-mouseleave={this.showDatatypeDetail($event,false)}>\n        <a href=\"/datatype/detail/?pid={selected.projectId}&id={selected.id}\" class=\"stateful title\"\n           title=\"{selected.name}\">\n            <span class=\"format-name\">{this.getFormatName()}</span>\n            <span>\n                <em>查看详情</em>\n                <i class=\"glyphicon glyphicon-chevron-right\"></i>\n            </span>\n        </a>\n        <div class=\"s-row-wrap\">\n            <div class=\"s-row-hd\">\n                {#list xheaders as header}\n                {#if header.skipInSelectDetail!==true}\n                <span>{header.name}</span>\n                {/if}\n                {/list}\n            </div>\n            <div class=\"s-row-bd\">\n            {#list params as param}\n                <div class=\"s-row\">\n                {#list xheaders as header}\n                {#if header.skipInSelectDetail!==true}\n                <span r-html=\"{this.getFieldName(param, header.key)}\" title=\"{this.getFieldName(param, header.key)}\"></span>\n                {/if}\n                {/list}\n                </div>\n            {/list}\n            </div>\n        </div>\n    </div>\n    {/if}\n</div>");
I$('f828fa0429280c170abbba0738265935',".u-trigon-down{\n\tdisplay:inline-block;\n\tborder-width:5px;\n\tborder-style:solid dashed dashed dashed;\n\tborder-color:#777 transparent transparent transparent;\n}\n.p-select{\n\tposition:relative;\n\tfont-size:12px;\n\ttext-align:left;\n}\n.p-select .select-hd{\n\tbox-sizing:border-box;\n\tborder:1px solid #d2d6de;\n\tposition:relative;\n\theight:30px;\n\tline-height:30px;\n\ttransition:all ease 0.3s;\n\twidth:100%;\n\toverflow:hidden;\n\tbackground-color:#fff;\n\tmargin-left:-5px;\n}\n.p-select .select-hd.js-preview{\n\tborder-color:transparent;\n}\n.p-select .select-hd.js-preview .u-trigon-down{\n\topacity:0;\n}\n.p-select .select-hd.js-preview:hover{\n\tborder-color:#e6e6e6;\n}\n.p-select .select-hd.js-preview:hover .u-trigon-down{\n\topacity:1;\n}\n.p-select .select-hd.js-disabled{\n\tborder-color:#fff;\n\tpadding:0;\n}\n.p-select .select-hd.js-disabled .u-trigon-down{\n\topacity:0;\n}\n.p-select .select-hd.js-disabled:hover{\n\tborder-color:#fff;\n}\n.p-select .select-hd.js-disabled:hover .u-trigon-down{\n\topacity:0;\n}\n.p-select .select-hd.js-disabled .dis-name{\n\tcursor:default;\n}\n.p-select .select-hd .dis-name{\n\twidth:100%;\n\tdisplay:inline-block;\n\tbox-sizing:border-box;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n\tborder:0 none;\n\tbackground-color:transparent;\n\tfont-size:12px;\n\tmargin-left:0;\n\tcursor:pointer;\n}\n.p-select .select-hd.complex-type .dis-name{\n\tcolor:#30a1f2;\n}\n.p-select .select-hd .btn{\n\tpadding:0 12px;\n\tdisplay:inline-block;\n\twidth:100%;\n\theight:30px;\n\tbox-sizing:border-box;\n\tline-height:30px;\n\tcolor:#999;\n\tborder:1px solid #ddd;\n}\n.p-select .select-hd .btn-error{\n\tborder-color:#f00;\n}\n.p-select .select-hd .u-trigon-down{\n\tposition:absolute;\n\ttop:12px;\n\tright:5px;\n\topacity:1;\n\ttransition:opacity ease 0.3s;\n\tz-index:1;\n}\n.p-select .select-bd,.p-select .select-detail{\n\tposition:absolute;\n\tz-index:99;\n\twidth:400px;\n\ttop:100%;\n\tdisplay:none;\n\tbackground-color:#fff;\n\tbox-shadow:0 4px 8px rgba(0,0,0,0.05);\n\tfont-size:12px;\n\tborder:1px solid #e6e6e6;\n\tmargin-top:-1px;\n\tmargin-left:-5px;\n}\n.p-select .select-bd .u-input,.p-select .select-detail .u-input{\n\tdisplay:block;\n\theight:30px;\n\tline-height:30px;\n}\n.p-select.is-required-sel .select-bd{\n\twidth:72px;\n}\n.p-select .list-view{\n\tbox-sizing:border-box;\n\tbackground:#fff;\n\tcolor:#555;\n\tmax-height:210px;\n\toverflow-y:auto;\n}\n.p-select .list-view>li{\n\tpadding:0 8px;\n\tline-height:30px;\n\tcolor:#222;\n\tcursor:pointer;\n\tposition:relative;\n\toverflow:hidden;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\ttransition:all ease 0.3s;\n}\n.p-select .list-view>li:hover{\n\tbackground:#eee;\n\topacity:0.8;\n}\n.p-select .list-view>li.js-disabled:hover{\n\tbackground:#fff;\n\topacity:1;\n\tcursor:not-allowed;\n}\n.p-select .list-view>li.z-sel{\n\tbackground:#eee;\n}\n.p-select .hl{\n\tbackground-color:#fd9c41;\n\tcolor:#333;\n}\n.p-select .empty-tip{\n\tposition:absolute;\n\ttop:0;\n\tright:0;\n\tbottom:0;\n\tleft:4px;\n\tbackground-color:#fff;\n\tcolor:#bbb;\n\tpointer-events:none;\n}\n.p-select .empty-tip.f-dn{\n\tdisplay:none !important;\n}\n.p-select .create-dt{\n\tbackground:#fff;\n\ttext-align:center;\n\theight:30px;\n\tline-height:30px;\n\tborder-top:1px solid #f5f5f5;\n\tcolor:#30a1f2;\n}\n.p-select .list-view{\n\tborder-bottom:0 none;\n}\n.p-select .select-detail{\n\tdisplay:block;\n\tcursor:default;\n}\n.p-select .select-detail .title{\n\tdisplay:flex;\n\tpadding:6px;\n}\n.p-select .select-detail .title .format-name{\n\tflex:1;\n}\n.p-select .select-detail .title:hover .glyphicon{\n\tcolor:#30a1f2;\n}\n.p-select .select-detail .s-row-hd{\n\tborder-top:1px solid #e6e6e6;\n\tpadding:4px 8px;\n\tdisplay:flex;\n}\n.p-select .select-detail .s-row-bd{\n\tmax-height:150px;\n\toverflow:auto;\n}\n.p-select .select-detail .s-row{\n\tdisplay:flex;\n\tpadding:4px 8px;\n}\n.p-select .select-detail .s-row a:link,.p-select .select-detail .s-row a:visited{\n\tcolor:#30a1f2;\n}\n.p-select .select-detail .s-row-hd>span,.p-select .select-detail .s-row>span{\n\tflex:1;\n\twhite-space:nowrap;\n\ttext-overflow:ellipsis;\n\toverflow:hidden;\n}\n.inline-create .create-dt{\n\tdisplay:none !important;\n}");
I$('4fac58fc50ffe9ae3011aeb6c1ba9553',function (rb, v, u, e, util, jstex, editorConfig, html, css) {
    // 加载一次
    e._$addStyle(css);
    // 常量
    var ARROW_UP_KEY = 38;
    var ARROW_DOWN_KEY = 40;
    var ENTER_KEY = 13;
    // 字符类型的id
    var STRING_TYPE_ID = 10001;

    // 默认选项
    var defaultOptions = {
        // 自动提示的数据源
        source: [],
        // 初始化时选中的项
        selected: null,
        // 是否打开列表, 如果没有这个值, 则初始时, config 中的 this.$watch('isOpen',...) 不会触发
        isOpen: false,
        // 是否为预览模式
        preview: false,
        // 是否可以编辑
        editable: true,
        // 输入框最大长度
        maxLen: null,
        emptyTip: '没有匹配的数据模型',
        // 是否是普通参数，比如异步接口的请求头和响应头，不会有自定义类型
        isNormalParam: false,
        // 是否接口请求参数中的必需字段
        isRequiredField: false,
        // 字段的名称，再设置 source 时会用到
        key: false,
        // 字段所属的参数，再设置 source 时会用到
        param: {},
        // 是否是被导入的数据模型中的匿名类型
        readonlyNestEditor: false,
        placeholder: '未设置'
    };

    // 支持事件:
    // 1. change: 选项有变化时触发
    //    select.$on('change', function(evt) {
    //      evt.sender
    //      evt.selected
    //    })

    var ParamSelect = rb.extend({
        name: 'param-select',

        template: html,

        config: function () {
            this.data = u._$merge({}, defaultOptions, this.data);
            Object.assign(this.data, {
                showDetail: false,
                headers: editorConfig.options.headers,
                formats: editorConfig.options.formats,
                iHeaderNames: util.headname.map(function (name) {
                    return {id: name, name: name}
                }),
                iHeaderValues: util.headvalue.map(function (name) {
                    return {id: name, name: name}
                }),
                requiredFieldSource: [
                    {name: '否', id: 0},
                    {name: '是', id: 1}
                ],
                isRequiredField: this.data.key === 'required'
            });
            this._source = this.data.source;
            this.data.selected = {};
            this.setDefaultSelected();
            this._resetXlist();
            this.$watch('isOpen', function (isOpen) {
                if (isOpen) {
                    this._handleData();
                    if (this.data.selected) {
                        this.data.__oSelected = this.data.selected;
                    }
                    this._resetXlist();
                    this._setListScrollTop();
                    this._addEventOnce();
                    this.$refs.input.select();
                    return;
                } else {
                    if (!this.data.selected) {
                        if (this.data.isNormalParam) {
                            // 普通参数，都是可以任意输入的
                            this.data.selected = {
                                name: this.data.inputValue,
                                id: this.data.inputValue
                            }
                        } else {
                            // 如果没有匹配项，则选择之前的值
                            this.data.selected = this.data.__oSelected || {};
                            this.data.inputValue = this.data.selected.name;
                        }
                    }
                }
                var emitChange = function () {
                    this.$emit('change', {
                        sender: this,
                        selected: this.data.selected || {},
                        oSelected: this.data.__oSelected || {},
                        key: this.data.key,
                        param: this.data.param,
                        isNormalParam: this.data.isNormalParam,
                        isRequiredField: this.data.isRequiredField
                    });
                }.bind(this);
                if (this.data.__oSelected) {
                    if (this.data.__oSelected.id !== this.data.selected.id) {
                        // 打开前和关闭后都有选中项, 比较两者的 id, 如果不相等, 抛事件
                        emitChange();
                    }
                }
                // 关闭时清除高亮选中状态
                this.data.sIndex = null;
            }.bind(this));
        },

        setDefaultSelected: function () {
            if (this.data.isRequiredField) {
                var fieldIndex = this.data.param.required === 0 ? 0 : 1;
                // 是和否下拉框都是可以修改的
                this.data.editable = !this.data.readonlyNestEditor;
                this.data.selected = this.data.requiredFieldSource[fieldIndex];
                this.data.inputValue = this.data.selected.name;
                return;
            }
            if (this.data.isNormalParam) {
                // 普通参数没有默认选项，比如异步接口的请求头名称
                Object.assign(this.data.selected, this.data.param);
                this.data.inputValue = this.data.param[this.data.key];
                if (this.data.key !== 'name') {
                    this.data.editable = true;
                }
                return;
            }
            // selectedId 是传入的需要选中的类型，默认是 String
            this.data.selected.id = this.data.selectedId || STRING_TYPE_ID;
            var selectedDatatype = this._source.find(function (dt) {
                return dt.id === this.data.selected.id;
            }, this);
            Object.assign(this.data.selected, this._getFields(selectedDatatype));
        },

        _getFields: function (item) {
            return {
                id: item.id,
                name: item.name,
                title: item.title || (item.description ? (item.name + '(' + item.description + ')') : item.name),
                projectId: item.projectId,
                format: item.format,
                params: item.params
            }
        },

        _handleData: function () {
            var source = [];
            if (this.data.isRequiredField) {
                source = this.data.requiredFieldSource
            } else if (this.data.isNormalParam) {
                // 异步接口的请求头及响应头名称
                if (this.data.key === 'name') {
                    source = this.data.iHeaderNames;
                } else if (this.data.key === 'defaultValue'
                    && this.data.param.name
                    && this.data.param.name.toLowerCase() === 'content-type'
                ) {
                    source = this.data.iHeaderValues;
                }
            } else {
                // 过滤掉匿名类型
                source = this._source.filter(function (dt) {
                    return !dt.__isAnon;
                }).map(this._getFields);
            }
            this.data.source = source;
        },

        _resetXlist: function () {
            this.data.xlist = this.data.source.map(function (item, index) {
                if (this.data.selected && this.data.selected.id === item.id) {
                    this.data.sIndex = index;
                    this.data.inputValue = this.data.selected.name;
                }
                return this._getFields(item);
            }, this);
        },

        toggle: function (evt) {
            this.data.showDetail = false;
            this.$emit("toggle");
            if (!this.data.editable) {
                // 不可编辑模式
                return;
            }
            this.data.isOpen = !this.data.isOpen;
            this.$refs.input.focus();
        },

        focusInput: function (evt) {
            // 记住打开前的选中项, 关闭时做对比, 如果有变化就发出 change 事件
            this.data.__oSelected = this.data.selected;
            this.$emit("focus");
        },

        _addEventOnce: function () {
            this._hideHandler = this._hideHandler || function (evt) {
                    if (evt && this.$refs && evt.target === this.$refs.input
                        || evt && this.$refs && evt.target === this.$refs.trigon
                    ) {
                        return;
                    }
                    this.data.isOpen = false;
                    Regular.dom.off(document, 'click', this._hideHandler);
                    this.$update();
                }.bind(this);
            // 需要先移除事件, 不然反复点击时会重复触发
            Regular.dom.off(document, 'click', this._hideHandler);
            Regular.dom.on(document, 'click', this._hideHandler);
        },

        select: function (evt, item, index) {
            if (item.disabled) {
                return evt.event.stopPropagation();
            }
            this.data.isOpen = false;
            this.data.selected = item;
            this.data.sIndex = index;
            this.data.inputValue = item.name;
        },

        input: function (evt) {
            evt.event.preventDefault();
            // 只要有输入动作, 就需要打开下拉框
            this.data.isOpen = true;
            this.data.sIndex = null;
            this.data.selected = null;
            this.matchXlist();
            this.data.inputValue = this.$refs.input.value.trim();
        },

        matchXlist: function () {
            var value = this.$refs.input.value.trim();
            this.data.xlist = this.data.source.filter(function (item) {
                delete item.__uiName;
                if (!value) {
                    return true;
                }
                var iv = item.name;
                var hitIndex = iv.toLowerCase().indexOf(value.toLowerCase());
                if (hitIndex !== -1) {
                    item.__uiName = jstex.escapeHtml(iv.substr(0, hitIndex)) + '<b class="hl">' + jstex.escapeHtml(iv.substr(hitIndex, value.length)) + '</b>' + jstex.escapeHtml(iv.substr(hitIndex + value.length, iv.length - 1));
                    return true;
                }
                var ivpy = item.namePinyin;
                var matchPinyinResult = util.highlightPinyin(iv, ivpy, value);
                if (matchPinyinResult) {
                    item.__uiName = matchPinyinResult;
                    return true;
                }
            }, this);
            this.checkXList();
        },

        keydown: function (evt) {
            var keyCode = evt.event.keyCode;
            if (keyCode === ENTER_KEY) {
                evt.event.preventDefault();
                this.data.isOpen = !this.data.isOpen;
                if (!this.data.isOpen) {
                    if (this.data.sIndex) {
                        this.data.selected = this.data.xlist[this.data.sIndex];
                    } else {
                        var firstItem = this.data.xlist[0];
                        if (firstItem.id) {
                            this.data.selected = firstItem;
                        } else {
                            // 没有可选项的时候, 选择 source 里面的第一个
                            this.data.selected = this.data.source[0];
                            // 更新自动提示列表, 以便再次打开时的状态保持一致
                            this.data.xlist = [this.data.selected];
                        }
                        this.data.inputValue = this.data.selected.name;
                    }
                    this._hideHandler();
                }
            } else if (keyCode === ARROW_UP_KEY) {
                evt.event.preventDefault();
                if (!this.data.isOpen) {
                    this.data.isOpen = true;
                }
                if (this.data.sIndex === null) {
                    this.data.sIndex = this.data.xlist.length - 1;
                } else {
                    this.data.sIndex -= 1;
                    if (this.data.sIndex < 0) {
                        this.data.sIndex = this.data.xlist.length - 1;
                    }
                }
                if (this.data.xlist[this.data.sIndex].id) {
                    this.data.selected = this.data.xlist[this.data.sIndex];
                    this.data.inputValue = this.data.selected.name;
                    this._setListScrollTop();
                } else {
                    // 没有可选择的项
                    this.data.sIndex = null;
                }
            } else if (keyCode === ARROW_DOWN_KEY) {
                evt.event.preventDefault();
                if (!this.data.isOpen) {
                    this.data.isOpen = true;
                }
                if (this.data.sIndex === null) {
                    this.data.sIndex = 0;
                } else {
                    this.data.sIndex += 1;
                    if (this.data.sIndex > this.data.xlist.length - 1) {
                        this.data.sIndex = 0;
                    }
                }
                if (this.data.xlist[this.data.sIndex].id) {
                    this.data.selected = this.data.xlist[this.data.sIndex];
                    this.data.inputValue = this.data.selected.name;
                    this._setListScrollTop();
                } else {
                    // 没有可选择的项
                    this.data.sIndex = null;
                }
            }
        },

        checkXList: function () {
            if (this.data.xlist.length === 0) {
                this.data.xlist.push({
                    name: '没有可选择的项',
                    disabled: true
                });
            }
        },

        _setListScrollTop: function () {
            setTimeout(function () {
                if (this.$refs && this.$refs.listcon) {
                    if (this.data.sIndex > 5) {
                        this.$refs.listcon.scrollTop = (this.data.sIndex - 5) * 36;
                    } else {
                        this.$refs.listcon.scrollTop = 0;
                    }
                }
            }.bind(this), 0);
        },

        create: function (evt) {
            this.$emit('create', this);
        },

        /**
         * 选择某一项, 如果该项不在 source 中, 就将它添加到 source 中
         * @param {Object} item -  需要选中的项
         **/
        $select: function (item) {
            var index = null;
            var found = this.data.source.find(function (it, idx) {
                if (it.id === item.id) {
                    index = idx;
                    return true;
                }
            });
            // 判断该项是否和已经选中的相同
            if (found && this.data.selected && this.data.selected.id === found.id) {
                // 如果相同就返回, 不处理
                // console.log('没变化')
                return;
            }
            if (!found) {
                // 如果列表中不存在, 就将它添加到列表中
                this._source.push(item);
                this._handleData();
                this.data.selected = this.data.source.find(function (it, idx) {
                    if (it.id === item.id) {
                        index = idx;
                        return true;
                    }
                });
            } else {
                this.data.selected = found;
            }
            this.data.sIndex = index;
            this.data.inputValue = this.data.selected.name;
            this.$update();
            // 触发 change 事件
            this.$emit('change', {
                sender: this,
                selected: this.data.selected
            });
        },

        mouseWheel: function (e) {
            // 滚动到底后，不让滚动页面
            var delta = e.event.wheelDelta || -e.event.detail;
            // 默认显示 7 项
            var minusNum = 7;
            if (this.data.isArrayElement) {
                // 如果是数组元素的类型，因为 array 是用 css 隐藏的，这里再减去 1
                minusNum = 8;
            }
            if (delta < 0 && this.$refs.listcon.scrollTop >= (this.data.source.length - minusNum) * 30
                || delta > 0 && this.$refs.listcon.scrollTop <= 0
            ) {
                e.preventDefault();
            }
        },

        isComplexType: function () {
            if (this.data.isNormalParam) {
                return false;
            }
            var selected = this.data.selected;
            if (selected && (selected.id > 10003)) {
                // 数据模型是自定义类型
                return true;
            }
        },

        showDatatypeDetail: function (evt, show) {
            if (this.data.isNormalParam || !this.data.selected || this.data.selected.id <= 10003) {
                // 基本类型无需显示详情
                return;
            }
            clearTimeout(this.mouseleaveTime);
            var handler = function () {
                this.data.showDetail = show;
                var selected = this.data.selected;
                this.data.xheaders = this.data.headers[selected.format];
                this.data.params = selected.params;
                this.$update();
            }.bind(this);
            if (evt.type === 'mouseleave') {
                this.mouseleaveTime = setTimeout(handler, 100);
            } else {
                handler();
            }
        },

        getFormatName: function () {
            var format = this.data.selected.format;
            return this.data.formats.find(function (f) {
                return f.format === format;
            }).name;
        },

        getFieldName: function (param, key) {
            var selected = this.data.selected;
            var result = '';
            if (param.isArray && key === 'typeName') {
                result += 'Array '
            }
            if (param.type <= 10003 || key !== 'typeName') {
                result += param[key];
            } else {
                // 自定义类型，如果没有 typeName，则是匿名类型，显示为 Object
                result += '<a href="/datatype/detail/?pid=' + selected.projectId + '&id=' + param.type + '" class="stateful" title="' + param[key] + '">' + (param[key] || 'Object') + '</a>';
            }
            return result;
        }
    });

    return ParamSelect;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','4f974133cc48417770aab7278404f301','422387098dc8843f61fd6105d0b10787','37e6d824192d54af199f417a7f982700','f828fa0429280c170abbba0738265935');
I$('d319c8e6e7d53164ce86d7bf4b393ea1',function (v, e, util, caches, editorConfig, pro) {

    // 全屏切换
    pro.toggleFullScreen = function (switchToFullScreen, node, exitFullScreenCallback) {
        var parentNode = node.parentNode;
        var arrNode = [];
        if (switchToFullScreen) {
            while (parentNode && parentNode.nodeName.toLowerCase() != "html") {
                var _value = e._$getStyle(parentNode, "position");
                if (_value == "relative" || _value == "absolute") {
                    arrNode.push({
                        node: parentNode,
                        prop: _value
                    });
                }
                parentNode = parentNode.parentNode;
            }
        } else {
            while (parentNode && parentNode.nodeName.toLowerCase() != "html") {
                if (e._$hasClassName(parentNode, "editor-full-screen")) {
                    arrNode.push({
                        node: parentNode
                    });
                }
                parentNode = parentNode.parentNode;
            }
        }
        if (!this.escHandle) {
            this.escHandle = function (event) {
                event.witch = event.keyCode || event.witch;
                if (event.witch == 27) {
                    this.toggleFullScreen(false, node);
                    exitFullScreenCallback();
                }
            }.bind(this);
        }
        if (switchToFullScreen) {
            e._$style(node, {
                "position": "fixed",
                "width": document.documentElement.clientWidth + "px",
                "height": document.documentElement.clientHeight + "px",
                "left": "0px",
                "padding": "30px",
                "top": "0px",
                "background": "#fff",
                "z-index": "99",
                "box-sizing": "border-box",
                "overflow": "scroll"
            });
            e._$addClassName(node, "editor-full-screen");
            arrNode.forEach(function (item) {
                e._$setStyle(item.node, "position", "static");
                e._$addClassName(item.node, "editor-full-screen");
            });
            v._$addEvent(window, "keyup", this.escHandle);
        } else {
            node.style = null;
            arrNode.forEach(function (item) {
                item.node.style = null;
                e._$delClassName(item.node, "editor-full-screen");
            });
            e._$delClassName(node, "editor-full-screen");
            v._$delEvent(window, "keyup", this.escHandle);
        }
    }

    // 设置参数的 originals 属性
    pro.setParamsOriginals = function (params) {
        if (!Array.isArray(params)) {
            params = [params];
        }
        params.forEach(function (param) {
            param.originals = {
                name: param.name,
                type: param.type,
                isArray: param.isArray,
                defaultValue: param.defaultValue,
                genExpression: param.genExpression,
                description: param.description,
                ignored: param.ignored,
                position: param.position
            };
        });
    };

    // 格式化单个参数
    pro.formatParam = function (param, datatypeList, options) {
        // 保留初始值，更新的时候会先和初始值比较
        this.setParamsOriginals(param);
        if (param.type === util.db.MDL_SYS_VARIABLE) {
            param.originalType = param.type;
        }
        // 异步接口中的请求头及响应头参数，不可能是 Object 匿名类型
        if (options.parentType === util.db.API_HED_REQUEST && options.isHeader
            || options.parentType === util.db.API_HED_RESPONSE && options.isHeader
            || param.typeName !== '' || param.circular) {
            // 不是匿名类型，返回参数本身
            return param;
        } else {
            // 匿名类型
            var result = Object.assign({}, param, {
                isObject: 1,
                objectId: param.type,
                type: editorConfig.customDatatypes.OBJECT_ID
            });
            result.originals.type = result.type;
            var anonymousDatatype = datatypeList.find(function (dt) {
                return dt.id === param.type;
            });
            // 检查匿名类型中是否导入了自身，防止出现循环引用
            var params = anonymousDatatype.params.map(function (p) {
                if (p.type === anonymousDatatype.id) {
                    return Object.assign(p, {
                        circular: true,
                        circularTip: '循环引用: ' + p.datatypeName
                    });
                }
                return p;
            });
            result.params = this.formatParams(params, datatypeList, options);
            return result;
        }
    };

    // 格式化参数列表，使之符合组件要求的格式
    pro.formatParams = function (params, datatypeList, options) {
        var result = [];
        var importedDatatypeIds = {};
        params.forEach(function (param) {
            // circular 表示是循环引用时的提示（也算作一个参数来统一处理，显示为参数行）
            if (param.datatypeId && !param.circular) {
                if (!importedDatatypeIds[param.datatypeId]) {
                    var importedPosition = param.position;
                    importedDatatypeIds[param.datatypeId] = 1;
                    var importedDatatypeParams = params.filter(function (p) {
                        return p.datatypeId === param.datatypeId;
                    });

                    // 去数据模型里面拿导入数据模型的参数的原始 position
                    // 因为导入的数据模型本身也有个位置信息（相对于和它同级的参数），导入的数据模型的参数也有位置
                    var dt = datatypeList.find(function (dt) {
                        return dt.id === param.datatypeId;
                    });
                    // 获取 params 的真实顺序
                    var datatypeCache = caches.datatype._$allocate();
                    var paramsWithRealPosition = datatypeCache._$getParamsByPosition(options.pid, dt.id);
                    importedDatatypeParams.forEach(function (param) {
                        param.position = paramsWithRealPosition.find(function (p) {
                            return p.id === param.id;
                        }).position;
                    });
                    datatypeCache._$recycle();

                    // 导入的数据模型
                    result.push({
                        imported: 1,
                        position: importedPosition,
                        id: param.datatypeId,
                        name: param.datatypeName,
                        params: importedDatatypeParams.map(function (param) {
                            return this.formatParam(param, datatypeList, options);
                        }, this)
                    });
                }
            } else {
                result.push(this.formatParam(param, datatypeList, options));
            }
        }, this);
        var sort = function (params) {
            // 按 position 排序
            params.sort(function (a, b) {
                return a.position - b.position;
            });
            params.forEach(function (param) {
                if (param.params) {
                    sort(param.params);
                }
            });
        };
        sort(result);
        return result;
    };

    // 获取编辑器参数
    pro.getParams = function (params, format) {
        var paramRequiredKey = this.getParamRequiredKeyName(format);
        var isOverWritten = function (param) {
            // 只要有一个字段被覆写就需要添加这个参数
            return param.defaultValue && (param.defaultValue !== param.originals.defaultValue)
                || param.genExpression && (param.genExpression !== param.originals.genExpression)
                || param.description && (param.description !== param.originals.description);
        }
        var getImportedParams = function (params) {
            var result = [];
            params.forEach(function (param) {
                var item = {
                    id: param.id,
                    name: param.name,
                    isArray: Number(param.isArray) || 0
                };
                var addItem = false;
                if (param.originalType === util.db.MDL_SYS_VARIABLE) {
                    // 可变类型
                    if (param.isObject) {
                        // 匿名类型
                        addItem = true;
                        Object.assign(item, getParams(param.params));
                    } else {
                        addItem = isOverWritten(param);
                        if (addItem) {
                            Object.assign(item, {
                                type: param.type,
                                // 以下是可能被覆写的字段
                                defaultValue: param.defaultValue || '',
                                genExpression: param.genExpression || '',
                                description: param.description || '',
                                ignored: param.ignored
                            });
                        }
                    }
                } else {
                    addItem = isOverWritten(param);
                    if (addItem) {
                        Object.assign(item, {
                            // 以下是可能被覆写的字段
                            defaultValue: param.defaultValue || '',
                            genExpression: param.genExpression || '',
                            description: param.description || '',
                            ignored: param.ignored
                        });
                    }
                }
                if (addItem) {
                    result.push(item);
                }
            });
            return result;
        }
        var getParams = function (params) {
            var normalParams = [];
            var rawImports = [];
            // 2 的 14 次方
            var position = 16384;
            params.forEach(function (param) {
                // 位置字段
                param.position = position;
                position = position + 1024;
                if (param.imported) {
                    rawImports.push(param);
                } else {
                    if (Array.isArray(param.params)) {
                        param = Object.assign({}, param, getParams(param.params));
                    }
                    if (!paramRequiredKey || (param[paramRequiredKey] && param[paramRequiredKey].trim())) {
                        normalParams.push(param);
                    }
                }
            });
            var importedParams = rawImports.map(function (item) {
                return {
                    id: item.id,
                    position: item.position,
                    vars: getImportedParams(item.params)
                }
            });
            return {
                params: normalParams,
                imports: importedParams
            }
        };

        return getParams(params);
    };

    // 从 json 中提取参数
    pro.getParamsFromJSONData = function (json, pid, isHeader) {
        if (!json) {
            return null;
        }
        // 如果是数组，则取第一项
        if (json && Array.isArray(json)) {
            json = json[0];
        }
        var datatypeCache = caches.datatype._$allocate();
        var getDefaultValue = function (value) {
            // 如果默认值长度超过500，则直接截断
            if (typeof(value) === 'object') {
                // 数组或者对象
                return JSON.stringify(value).slice(0, 500);
            } else {
                return (value ? value.toString() : '').slice(0, 500);
            }
        };
        var getParams = function (json) {
            var params = [];
            for (var item in json) {
                var param = {
                    name: item,
                    adding: true
                };
                var value = json[item];
                // 请求头参数都是字符串
                if (isHeader) {
                    param.type = util.db.MDL_SYS_STRING;
                    param.defaultValue = getDefaultValue(value);
                } else {
                    var type = datatypeCache._$getTypeByJson(value, pid);
                    if (type) {
                        param.type = type;
                        param.isArray = 0;
                        param.defaultValue = getDefaultValue(value);
                    } else {
                        if (Array.isArray(value)) {
                            param.isArray = 1;
                            type = datatypeCache._$getTypeByJson(value[0], pid);
                            if (type) {
                                param.type = type;
                            } else {
                                if (Array.isArray(value[0])) {
                                    // 多维数组，但在系统中又没找到相应的数据模型，类型设置为 String
                                    param.type = util.db.MDL_SYS_STRING;
                                } else {
                                    // 肯定是 Object 类型了
                                    param.isObject = 1;
                                    param.type = editorConfig.customDatatypes.OBJECT_ID;
                                    param.params = getParams(value[0]);
                                }
                            }
                        } else {
                            // 肯定是 Object 类型了
                            param.isObject = 1;
                            param.isArray = 0;
                            param.type = editorConfig.customDatatypes.OBJECT_ID;
                            param.params = getParams(value);
                        }
                    }
                }
                params.push(param);
            }
            return params;
        }
        return getParams(json);
    };

    pro.getParamRequiredKeyName = function (format) {
        if (format === util.db.MDL_FMT_HASH) {
            return 'name'
        }
        // 枚举类型的 name 是选填，defaultValue 是必填
        if (format === util.db.MDL_FMT_ENUM) {
            return 'defaultValue'
        }
        // 其他类型没有必填字段
        return '';
    };

    // 检查编辑器是否有重复参数
    pro.checkDuplicate = function (params, format) {
        var key = this.getParamRequiredKeyName(format);
        var result = {};
        // 检查是否存在重复的 name 值
        var hasDuplicate = false;
        var checkDuplicate = function (params) {
            var names = [];
            params.forEach(function (param) {
                // 忽略的字段不算
                if (param.ignored) {
                    return;
                }
                // 同级的导入参数
                if (param.imported) {
                    param.params.forEach(function (p) {
                        if (p.ignored) {
                            return;
                        }
                        names.push(p[key]);
                    });
                } else {
                    names.push(param[key]);
                }
            });
            var nameCounts = names
                .map(function (name) {
                    return {count: 1, name: name};
                })
                .reduce(function (a, b) {
                    a[b.name] = (a[b.name] || 0) + b.count;
                    return a;
                }, {});
            var duplicateNames = Object.keys(nameCounts).filter(function (a) {
                return nameCounts[a] > 1;
            });
            var checkParam = function (param) {
                delete param.inputError;
                // 忽略的字段不算
                if (!param.ignored && duplicateNames.indexOf(param[key]) > -1) {
                    param.inputError = true;
                    hasDuplicate = true;
                }
            }
            params.forEach(function (param) {
                checkParam(param);
                // 同级的导入参数
                if (param.imported) {
                    param.params.forEach(checkParam);
                } else if (param.hasOwnProperty('params')) {
                    checkDuplicate(param.params);
                }
            });
        }
        // `key` 字段 为空的不检查
        checkDuplicate(params.filter(function (p) {
            return p[key] && p[key].trim();
        }));
        result.pass = !hasDuplicate;
        if (hasDuplicate) {
            result.msg = '存在相同名称的属性';
        }
        return result;
    };

},'b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','18fdbc27498bb1c4312201f146717dc0','422387098dc8843f61fd6105d0b10787');
I$('65a550fc9126044c69db2ae94934b6f7',"<!--嵌套时没有类别切换选项-->\n<!--异步接口的请求头和响应头也没有类别切换选项,isNormalParam为true-->\n{#if !isNest && isNormalParam!==true&&formatChangeable!==false}\n<div r-class=\"{{'format-group':true,'format-group-preview':preview,'modifying-format':modifyingFormat}}\">\n    {#list formats as item}\n    <label title={item.name} on-click={this.changeFormat($event,item)} r-class=\"{{checked:item.format===format}}\">\n        <input type=\"radio\" name=\"format\" {#if item.format===format}checked{/if}>\n        <em>{item.name}</em>\n    </label>\n    {/list}\n    {#if preview}\n    <a href=\"#\" on-click=\"{this.modifyFormat($event,true)}\" class=\"modify-format-btn\">修改</a>\n    <button on-click=\"{this.modifyFormat($event,false)}\" class=\"u-btn\" type=\"button\">取消修改</button>\n    {/if}\n</div>\n{/if}");
I$('51808f26690e419febda9e2c3253421b',"<!--普通字段的主体内容-->\n<div r-class=\"{{'x-row':true,'x-row-adding':param.adding}}\"\n     id=\"param-editor-x-row-{param.id}\"\n     {#if !readonlyNestEditor&&draggableRow}\n     on-dragstart=\"{this.dragStart($event, param_index)}\"\n     on-dragend=\"{this.dragEnd($event, param_index)}\"\n     on-dragover=\"{this.dragOver($event)}\"\n     on-dragenter=\"{this.dragEnter($event)}\"\n     draggable=\"true\"\n     {/if}>\n<!--循环引用的显示-->\n{#if param.circular}\n<span class=\"empty-param-tip\">{param.circularTip}</span>\n{/if}\n\n{#if !param.circular}\n{#list xheaders as item}\n<span class=\"{item.clazz}\">\n\n        {#if item.select}\n        {#if param.isArray&&item.key!=='required'}\n        <param-select editable=\"{!readonlyNestEditor}\"\n                      source=\"{this.getSelectSource()}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      selectedId=\"{customDatatypes.ARRAY_ID}\"\n                      preview=\"{preview&&!param.adding}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index)}\"></param-select>\n        <param-select editable=\"{!readonlyNestEditor}\"\n                      source=\"{this.getSelectSource()}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      preview=\"{preview&&!param.adding}\"\n                      selectedId=\"{param.type}\" isArrayElement=\"{true}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index,true)}\"></param-select>\n        {#else}\n        <param-select editable=\"{!readonlyNestEditor}\"\n                      readonlyNestEditor=\"{readonlyNestEditor}\"\n                      source=\"{this.getSelectSource()}\"\n                      key=\"{item.key}\"\n                      param=\"{param}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      isRequiredField=\"{item.key=='required'}\"\n                      selectedId=\"{param.type}\"\n                      preview=\"{preview&&!param.adding}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index)}\"></param-select>\n        {/if}\n        {#else}\n        <input r-model={param[item.key]} title=\"{param[item.key]}\" placeholder=\"{item.name}\"\n               on-blur=\"{this.onBlurInput($event,item.key,param_index)}\"\n               on-keydown=\"{this.onKeydownInput($event,item.key,param_index)}\"\n               {#if param.inputError&&(item.key==(format===1?'defaultValue':'name'))}\n               class=\"u-input-error\"\n               {/if}\n               {#if item.rule}\n               on-click=\"{this.createExp('genExpression',param_index)}\"\n               class=\"exp-input\"\n               {#else}\n               on-focus=\"{this.onFocusInput($event,param_index,item_index,isNest)}\"\n               {/if}\n               on-paste=\"{this.onPasteInput($event,param_index,item_index)}\"\n               {#if readonlyNestEditor}readonly{/if}>\n        {/if}\n    </span>\n{/list}\n{/if}\n<span class=\"x-act\">\n        <!--导入的数据模型的字段，有忽略和恢复的操作-->\n    <!--普通字段，可以排序和删除-->\n        <i class=\"glyphicon glyphicon-sort\" title=\"拖动调整顺序\"></i>\n        <i class=\"glyphicon glyphicon-remove\" on-click=\"{this.removeParam(param_index)}\" title=\"删除\"></i>\n    </span>\n<!--拖动显示的遮罩层-->\n{#if param.dragging}\n<span class=\"dragging-mask\"></span>\n{/if}\n</div>\n\n{#if param.isObject}\n<!--odd 控制嵌套中奇偶编辑器的背景色-->\n<div r-class=\"{{'nest-editor':true,odd:odd==undefined?true:odd}}\">\n    <em class=\"arrow\"></em>\n    <!--isNest 标识嵌套，嵌套时没有“类别”选项，如果是导入的类型，则不可编辑-->\n    <param-editor-core\n            params=\"{param.params}\"\n            source=\"{source}\"\n            isNest=\"{true}\"\n            readonlyNestEditor=\"{param.imported}\"\n            preview=\"{preview}\"\n            parentId=\"{param.objectId}\"\n            parentType=\"{paramTypes.datatype}\"\n            parentParam=\"{param}\"\n            odd=\"{odd==undefined?false:!odd}\"\n            pid=\"{pid}\"\n    ></param-editor-core>\n</div>\n{/if}\n");
I$('3882f04dde75f079785f56d3b7266682',"<!--导入字段的主体内容-->\n{#if !importedParam.ignored||param.editingIgnored}\n<div r-class=\"{{'x-row':true,ignored:!!importedParam.ignored}}\">\n    <!--循环引用的显示-->\n    {#if param.circular}\n    <span class=\"empty-param-tip\">{param.circularTip}</span>\n    {/if}\n\n    {#if !importedParam.circular}\n    {#list xheaders as item}\n    <span class=\"{item.clazz}\">\n        {#if item.select}\n        {#if importedParam.isArray&&item.key!=='required'}\n        <param-select editable=\"{importedParam.originalType===dbConst.MDL_SYS_VARIABLE}\"\n                      source=\"{this.getSelectSource()}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      selectedId=\"{customDatatypes.ARRAY_ID}\"\n                      preview=\"{preview&&!importedParam.adding}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index,false,importedParam_index)}\">\n        </param-select>\n        <param-select editable=\"{importedParam.originalType===dbConst.MDL_SYS_VARIABLE}\"\n                      source=\"{this.getSelectSource()}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      selectedId=\"{importedParam.type}\" isArrayElement=\"{true}\"\n                      preview=\"{preview&&!importedParam.adding}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index,true,importedParam_index)}\">\n        </param-select>\n        {#else}\n        <param-select editable=\"{importedParam.originalType===dbConst.MDL_SYS_VARIABLE}\"\n                      source=\"{this.getSelectSource()}\"\n                      key=\"{item.key}\"\n                      param=\"{importedParam}\"\n                      isNormalParam=\"{isNormalParam}\"\n                      selectedId=\"{importedParam.type}\"\n                      preview=\"{preview&&!importedParam.adding}\"\n                      on-create=\"{this.createDatatype($event)}\"\n                      on-change=\"{this.changeDatatype($event,param_index,false,importedParam_index)}\">\n        </param-select>\n        {/if}\n        {#else}\n        <input r-model=\"{importedParam[item.key]}\" title=\"{importedParam[item.key]}\" placeholder=\"{item.name}\"\n               on-paste=\"{this.onPasteInput($event,importedParam_index)}\"\n               on-blur=\"{this.onBlurInput($event,item.key,param_index,importedParam_index)}\"\n               on-keydown=\"{this.onKeydownInput($event,item.key,param_index,importedParam_index)}\"\n               {#if importedParam.inputError&&(item.key==(format===1?'defaultValue':'name'))}\n               class=\"u-input-error\"\n               {/if}\n               {#if item.rule}\n               on-click=\"{this.createExp('genExpression',param_index,importedParam_index)}\"\n               class=\"exp-input\"\n               {#else}\n               on-focus=\"{this.onFocusInput($event,param_index,item_index,isNest)}\"\n               {/if}\n               {#if item.key=='name'||readonlyNestEditor}readonly{/if}>\n        {/if}\n    </span>\n    {/list}\n    {/if}\n    <span class=\"x-act\">\n        <!--导入的数据模型的字段，有忽略和恢复的操作-->\n        <i on-click=\"{this.toggleParamIgnored(importedParam,1)}\" class=\"glyphicon glyphicon-ban-circle\"\n           title=\"忽略\"></i>\n        <i on-click=\"{this.toggleParamIgnored(importedParam,0)}\" class=\"glyphicon glyphicon-ok-circle\"\n           title=\"恢复\"></i>\n    </span>\n    <!--忽略字段的遮罩样式-->\n    {#if importedParam.ignored}\n    <span class=\"ignored-mask\"></span>\n    {/if}\n</div>\n\n{#if importedParam.isObject}\n<!--odd 控制嵌套中奇偶编辑器的背景色-->\n<div r-class=\"{{'nest-editor':true,'nest-editor-readonly':importedParam.originalType!==dbConst.MDL_SYS_VARIABLE,odd:odd==undefined?true:odd}}\">\n    <em class=\"arrow\"></em>\n    <!--isNest 标识嵌套，嵌套时没有“类别”选项-->\n    <param-editor-core\n            params=\"{importedParam.params}\"\n            source=\"{source}\"\n            isNest=\"{true}\"\n            readonlyNestEditor=\"{importedParam.originalType!==dbConst.MDL_SYS_VARIABLE}\"\n            preview=\"{preview}\"\n            parentId=\"{importedParam.objectId}\"\n            parentType=\"{paramTypes.datatype}\"\n            parentParam=\"{importedParam}\"\n            odd=\"{odd==undefined?false:!odd}\"\n            pid=\"{pid}\"\n    ></param-editor-core>\n</div>\n{/if}\n\n{/if}\n");
I$('8852acb91894d130ce3086bf49288ae5',"<!--可以粘贴 json 字符串的提示-->\n{#if !isNest}\n<span class=\"u-tip\" r-class={{\"f-dn\":hideTip}}>可粘贴JSON字符串</span>\n{/if}\n\n{#if preview&&params.length==0}\n<div class=\"empty-param-tip\">没有参数信息</div>\n{/if}\n");
I$('e18163ff87a3f271364ae240620b59a7',"<div r-class=\"{{'m-param-editor-core':true,'param-editor-preview':preview,'param-editor-normal':isNormalParam}}\">\n    <!--类别选择模板-->\n    {#include formatTpl}\n    <!--has-array, only-one-row, 都用来控制样式-->\n    <!--has-array表示字段中有数组类型，此时下拉框的宽度会变宽-->\n    <!--only-one-row表示只有一个字段，此时不显示删除按钮-->\n    <div r-class=\"{{'editor-core':true,'has-array':hasArray,'x-row-not-editable':this.isNotEditableRow(),'x-row-not-sortable':this.isNotSortableRow()}}\">\n        <div class=\"editor-hd\">\n            {#list xheaders as item}\n            <span class=\"{item.clazz}\">{item.name}</span>\n            {/list}\n            <span class=\"x-act\">&nbsp;</span>\n            {#if !isNest}\n            <i class=\"glyphicon glyphicon-resize-full\" title=\"切换到全屏模式\" on-click=\"{this.$root.$emit('toggle-fullscreen',true)}\"></i>\n            <i class=\"glyphicon glyphicon-resize-small\" title=\"切换到普通模式\" on-click=\"{this.$root.$emit('toggle-fullscreen',false)}\"></i>\n            {/if}\n        </div>\n        <div class=\"editor-bd\">\n            {#list params as param}\n\n            {#if param.imported}\n            <div r-class=\"{{'x-row-imported':true,'editing-ignored':!!param.editingIgnored}}\"\n                 {#if draggableRow}\n                 on-dragstart=\"{this.dragStart($event, param_index)}\"\n                 on-dragend=\"{this.dragEnd($event, param_index)}\"\n                 on-dragover=\"{this.dragOver($event)}\"\n                 on-dragenter=\"{this.dragEnter($event)}\"\n                 draggable=\"true\"\n                 {/if}>\n                <!--导入数据模型的名称及其他操作-->\n                <div class=\"imported-datatype\">\n                    <span class=\"dt-wrap\">\n                        <i class=\"glyphicon glyphicon-triangle-right\"></i>\n                        <a href=\"/datatype/detail/?pid={pid}&id={param.id}\" class=\"stateful\"\n                           title=\"{param.name}\">{param.name}</a>\n                        <i on-click=\"{this.toggleIgnoredEditing(param.id,true)}\" title=\"显示全部属性\"\n                           class=\"toggle-ignore glyphicon glyphicon-eye-close\"></i>\n                        <i on-click=\"{this.toggleIgnoredEditing(param.id,false)}\" title=\"隐藏忽略属性\"\n                           class=\"toggle-ignore glyphicon glyphicon-eye-open\"></i>\n                        <i on-click=\"{this.removeParam(param_index,parentParam)}\" title=\"删除\"\n                           class=\"glyphicon glyphicon-remove\"></i>\n                    </span>\n                </div>\n                <!--导入数据模型的字段-->\n                {#list param.params as importedParam}\n                {#include importedParamRowTpl}\n                {/list}\n            </div>\n            {#else}\n\n            <!--普通参数-->\n            {#include paramRowTpl}\n\n            {/if}\n\n            {/list}\n\n            <!--一些提示信息-->\n            {#include paramTipTpl}\n        </div>\n    </div>\n    {#if format===dbConst.MDL_FMT_HASH||format===dbConst.MDL_FMT_ENUM||format===dbConst.MDL_FMT_ARRAY}\n    <div r-class=\"{{'editor-action':true,'editor-action-adding':this.hasAddingParam()}}\">\n        {#if format!==dbConst.MDL_FMT_ARRAY}\n        <button on-click=\"{this.addParam()}\" class=\"u-btn\" type=\"button\">添加</button>\n        <button on-click=\"{this.import(importTypes.DATATYPE,parentParam)}\" class=\"u-btn\" type=\"button\">从数据模型导入</button>\n        {/if}\n        <button on-click=\"{this.import(importTypes.JSON)}\" class=\"u-btn\" type=\"button\">从JSON导入</button>\n        {#if format!==dbConst.MDL_FMT_ENUM && isNormalParam!==true}\n        <button on-click=\"{this.import(importTypes.INTERFACE)}\" class=\"u-btn\" type=\"button\">从在线接口导入</button>\n        {#if format!==dbConst.MDL_FMT_ARRAY}\n        <button on-click=\"{this.import(importTypes.JAVABEAN)}\" class=\"u-btn\" type=\"button\">从JavaBean导入</button>\n        {/if}\n        {/if}\n        {#if preview&&!isNest&&this.hasAddingParam()}\n        <button on-click=\"{this.saveAllParams()}\" class=\"u-btn save-btn\" type=\"button\">保存</button>\n        <button on-click=\"{this.cancelAddingParams()}\" class=\"u-btn cancel-btn\" type=\"button\">取消</button>\n        {/if}\n    </div>\n    {/if}\n</div>");
I$('2426e84c01fb3909b06a392af607b50b',".m-param-editor-core >.editor-core{\n\tborder:solid 1px #e6e6e6;\n\tbackground-color:#fff;\n}\n.m-param-editor-core >.editor-core.has-array >.editor-hd>.x-type,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row>.x-type,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row-imported>.x-row>.x-type{\n\tdisplay:flex;\n\tflex:3 !important;\n}\n.m-param-editor-core >.editor-core.has-array >.editor-hd>.x-type .p-select,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row>.x-type .p-select,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row-imported>.x-row>.x-type .p-select{\n\tflex:2;\n}\n.m-param-editor-core >.editor-core.has-array >.editor-hd>.x-type .p-select:nth-child(2):last-child,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row>.x-type .p-select:nth-child(2):last-child,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row-imported>.x-row>.x-type .p-select:nth-child(2):last-child{\n\tmargin-left:6px;\n\tflex:4;\n}\n.m-param-editor-core >.editor-core.has-array >.editor-hd>.x-type .p-select:nth-child(2):last-child .is-array,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row>.x-type .p-select:nth-child(2):last-child .is-array,.m-param-editor-core >.editor-core.has-array >.editor-bd>.x-row-imported>.x-row>.x-type .p-select:nth-child(2):last-child .is-array{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-hd{\n\tdisplay:flex;\n\tline-height:30px;\n\tbackground:#f5f5f5;\n\tborder-bottom:1px solid #efefef;\n\tpadding:0 10px;\n\tposition:relative;\n}\n.m-param-editor-core .editor-hd >span{\n\tflex:2;\n}\n.m-param-editor-core .editor-hd >span:not(:first-child){\n\tmargin-left:6px;\n}\n.m-param-editor-core .editor-hd >span.x-dv,.m-param-editor-core .editor-hd >span.x-gexp{\n\tflex:1;\n}\n.m-param-editor-core .editor-hd >span.x-act{\n\tmargin-left:0 !important;\n}\n.m-param-editor-core .editor-bd{\n\tpadding:4px 10px 0 10px;\n\tposition:relative;\n}\n.m-param-editor-core .editor-bd input{\n\tbox-sizing:border-box;\n\theight:30px;\n\tmargin:0;\n\toutline:none 0;\n\tpadding:0 5px;\n\tborder:1px solid #d2d6de;\n\tcolor:#555;\n\tfont-size:12px;\n\tbackground:#fff;\n\ttransition:all ease 0.3s;\n\twidth:100%;\n\tmargin-left:-5px;\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n\twhite-space:nowrap;\n}\n.m-param-editor-core .editor-bd input:focus{\n\tborder-color:#aaa;\n}\n.m-param-editor-core .editor-bd .x-row{\n\tdisplay:flex;\n\tmargin-bottom:4px;\n\tposition:relative;\n\tcursor:move;\n}\n.m-param-editor-core .editor-bd .x-row >span{\n\tflex:2;\n}\n.m-param-editor-core .editor-bd .x-row >span:not(:first-child){\n\tmargin-left:6px;\n}\n.m-param-editor-core .editor-bd .x-row >span.x-dv,.m-param-editor-core .editor-bd .x-row >span.x-gexp{\n\tflex:1;\n}\n.m-param-editor-core .editor-bd .x-row >.x-act{\n\tz-index:3;\n\tposition:relative;\n\tmargin-left:0 !important;\n}\n.m-param-editor-core .editor-bd .x-row .ignored-mask,.m-param-editor-core .editor-bd .x-row .dragging-mask{\n\tposition:absolute;\n\tleft:-17px;\n\ttop:0;\n\tright:-7px;\n\tbottom:0;\n\tbackground-color:rgba(204,204,204,0.6);\n\tz-index:2;\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row .dragging-mask{\n\tdisplay:block;\n\tbackground-color:rgba(204,204,204,0.8);\n\tright:-10px;\n}\n.m-param-editor-core .editor-bd .x-row-imported{\n\tposition:relative;\n\tbackground:#f1f6fb;\n\tmargin:0 -10px;\n\tpadding:0 10px;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row >.x-act .glyphicon{\n\ttop:8px;\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row input{\n\tbackground-color:#f1f6fb;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row .p-select >.js-disabled{\n\tborder-color:#f1f6fb;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row .p-select >.js-disabled.select-hd{\n\tbackground-color:#f1f6fb;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row .p-select >.js-disabled input{\n\tbackground-color:#f1f6fb;\n}\n.m-param-editor-core .editor-bd .x-row-imported >.x-row .p-select input{\n\tbackground-color:transparent;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row .x-act{\n\topacity:1;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row .x-act .glyphicon-ban-circle{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row .x-act .glyphicon-ok-circle{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row.ignored >.x-act{\n\topacity:1;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row.ignored >.x-act .glyphicon-ban-circle{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row.ignored >.x-act .glyphicon-ok-circle{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row:hover >.x-act .glyphicon-ban-circle{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row:hover >.x-act .glyphicon-ok-circle{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row:hover.ignored >.x-act .glyphicon-ban-circle{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.x-row:hover.ignored >.x-act .glyphicon-ok-circle{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.imported-datatype .glyphicon-eye-close{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored >.imported-datatype .glyphicon-eye-open{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported.editing-ignored .ignored-mask{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype{\n\tposition:absolute;\n\tborder-left:3px solid #30a1f2;\n\tleft:100%;\n\tmin-width:160px;\n\tfont-size:16px;\n\tdisplay:flex;\n\talign-items:center;\n\tmargin-left:-2px !important;\n\tbottom:0;\n\ttop:0;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .dt-wrap{\n\tdisplay:flex;\n\talign-items:center;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .dt-wrap >i,.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .dt-wrap >a{\n\tmargin:0 4px 0 0;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .dt-wrap a:link,.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .dt-wrap a:visited{\n\toverflow:hidden;\n\ttext-overflow:ellipsis;\n\twhite-space:nowrap;\n\tborder-radius:3px;\n\tpadding:1px 3px;\n\tline-height:20px;\n\tbackground-color:#666;\n\tcolor:#fff;\n\tfont-size:12px;\n\tmax-width:90px;\n\tmargin-left:-4px;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .glyphicon-eye-close{\n\tdisplay:block;\n}\n.m-param-editor-core .editor-bd .x-row-imported>.imported-datatype .glyphicon-eye-open{\n\tdisplay:none;\n}\n.m-param-editor-core .editor-hd .x-act,.m-param-editor-core .editor-bd .x-act{\n\tflex:inherit !important;\n\twidth:40px;\n\tline-height:30px;\n\tmargin-right:-10px;\n}\n.m-param-editor-core .editor-hd .x-act .glyphicon,.m-param-editor-core .editor-bd .x-act .glyphicon{\n\tfont-size:16px;\n\ttop:4px;\n}\n.m-param-editor-core .editor-hd .x-req,.m-param-editor-core .editor-bd .x-req{\n\tflex:inherit !important;\n\twidth:42px;\n}\n.m-param-editor-core .x-row-not-editable>.editor-bd>.x-row{\n\tcursor:default;\n}\n.m-param-editor-core .x-row-not-editable>.editor-bd>.x-row >.x-act .glyphicon{\n\tvisibility:hidden;\n}\n.m-param-editor-core .x-row-not-sortable>.editor-bd>.x-row{\n\tcursor:default;\n}\n.m-param-editor-core .x-row-not-sortable>.editor-bd>.x-row >.x-act .glyphicon-sort{\n\tvisibility:hidden;\n}\n.m-param-editor-core .editor-action{\n\tpadding-top:12px;\n}\n.m-param-editor-core .editor-action .save-btn{\n\tfloat:right;\n\topacity:1 !important;\n\tbackground-color:#30a1f2;\n\tcolor:#fff;\n\twidth:80px;\n}\n.m-param-editor-core .editor-action .cancel-btn{\n\tfloat:right;\n\topacity:1 !important;\n\tbackground:#fff;\n\tcolor:#555;\n\tmargin-right:3px !important;\n}\n.m-param-editor-core .nest-editor{\n\tposition:relative;\n}\n.m-param-editor-core .nest-editor .m-param-editor-core{\n\tmargin-bottom:10px;\n\tbackground-color:#fff;\n}\n.m-param-editor-core .nest-editor .m-param-editor-core >.editor-core >.editor-hd{\n\tbackground-color:#fff;\n}\n.m-param-editor-core .nest-editor .m-param-editor-core .p-select{\n\tbackground-color:transparent;\n}\n.m-param-editor-core .nest-editor.odd >.m-param-editor-core{\n\tbackground-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd >.m-param-editor-core >.editor-core{\n\tbackground-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd >.m-param-editor-core >.editor-core >.editor-hd{\n\tbackground-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd >.arrow:after{\n\tborder-bottom-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd .p-select >.js-disabled{\n\tborder-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd .p-select >.js-disabled.select-hd{\n\tbackground-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor.odd .p-select >.js-disabled input{\n\tbackground-color:#f5f5f5;\n}\n.m-param-editor-core .nest-editor .arrow{\n\tborder:8px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#efefef;\n\ttop:-14px;\n\tleft:24%;\n}\n.m-param-editor-core .nest-editor .arrow:after{\n\tcontent:\"\";\n\tborder:6px solid transparent;\n\tposition:absolute;\n\twidth:0;\n\theight:0;\n\tborder-bottom-color:#fff;\n\ttop:-4px;\n\tleft:-6px;\n}\n.m-param-editor-core .nest-editor .editor-action{\n\tborder:1px solid #e6e6e6;\n\tborder-top:none;\n\tpadding:5px;\n}\n.m-param-editor-core .nest-editor .editor-action .u-btn{\n\tpadding:0 4px;\n\tline-height:24px;\n\theight:24px;\n\tmargin-right:0;\n}\n.m-param-editor-core .glyphicon-sort{\n\tcursor:move;\n}\n.m-param-editor-core input[readonly]:not(.exp-input),.m-param-editor-core input[readonly]:not(.exp-input):focus{\n\tborder-color:transparent;\n\tbackground:transparent;\n}\n.m-param-editor-core .editor-bd .u-tip{\n\tposition:absolute;\n\ttop:-20px;\n\tleft:50px;\n\tpadding:2px 3px 2px 3px;\n\tborder-radius:3px;\n\tcolor:#fff;\n\tbackground-color:#424a54;\n}\n.m-param-editor-core .editor-bd .u-tip:before{\n\tposition:absolute;\n\tcontent:\"\";\n\tleft:10%;\n\ttop:22px;\n\tborder:6px solid transparent;\n\tborder-top:6px solid #424a54;\n}\n.m-param-editor-core .nest-editor-readonly .select-hd{\n\tbackground-color:#fff !important;\n\tborder-color:#fff !important;\n}\n.m-param-editor-core .nest-editor-readonly.odd .select-hd{\n\tbackground-color:#f5f5f5 !important;\n\tborder-color:#f5f5f5 !important;\n}\n.m-param-editor-core .nest-editor-readonly input.exp-input,.m-param-editor-core .nest-editor-readonly input.exp-input:focus{\n\tborder-color:transparent;\n\tpadding:0;\n\tbackground:transparent;\n}\n.m-param-editor-core .nest-editor-readonly .glyphicon,.m-param-editor-core .nest-editor-readonly .editor-action{\n\tdisplay:none;\n}\n.m-param-editor-core .nest-editor-readonly .x-row{\n\tcursor:default;\n}\n.param-editor-preview .editor-bd input{\n\tborder-color:transparent;\n\tbackground-color:transparent;\n}\n.param-editor-preview .editor-bd input:hover{\n\tborder-color:#d2d6de;\n\tbackground-color:#fff;\n}\n.param-editor-preview .editor-bd input:hover[readonly]{\n\tborder-color:transparent;\n\tbackground-color:transparent;\n}\n.param-editor-preview .p-select .select-hd.js-preview{\n\tbackground-color:transparent;\n}\n.param-editor-preview .nest-editor .editor-action .u-btn{\n\topacity:0;\n}\n.param-editor-preview .editor-action:hover .u-btn{\n\topacity:1;\n}\n.param-editor-preview .x-act,.param-editor-preview .imported-datatype .glyphicon-remove{\n\topacity:0;\n\ttransition:all ease 0.3s;\n}\n.param-editor-preview .x-row:hover >.x-act{\n\topacity:1;\n}\n.param-editor-preview .x-row-imported:hover >.imported-datatype .glyphicon-remove{\n\topacity:1;\n}\n.param-editor-preview .x-row-adding input{\n\tborder-color:#d2d6de;\n\tbackground-color:#fff;\n}\n.param-editor-preview .x-row-adding .p-select .select-hd.js-preview{\n\tbackground-color:#fff;\n}\n.param-editor-preview .x-row-adding .x-act,.param-editor-preview .x-row-adding .imported-datatype .glyphicon-remove{\n\topacity:1;\n}\n.param-editor-preview .nest-editor .editor-action-adding .u-btn{\n\topacity:1;\n}\n.param-editor-preview .empty-param-tip{\n\tpadding:0 0 4px 0;\n\tcolor:#bbb;\n\tfont-style:italic;\n\tline-height:30px;\n}\n.param-editor-preview .modify-format-btn{\n\tvisibility:hidden;\n}\n.param-editor-preview:hover .modify-format-btn{\n\tvisibility:visible;\n}\n.param-editor-full-screen >.param-editor-preview{\n\twidth:calc(100% - 170px);\n}\n.param-editor-normal .editor-core .editor-hd >span,.param-editor-normal .editor-core .editor-bd .x-row >span{\n\tflex:1;\n}");
I$('93e5d2ec2d2dd85f2d9a13263eb84b0e',function (rb, v, u, e, util, jstex, notify, DTImport, JSImport, INTImport, JBImport, GRule, editorUtil, editorConfig, formatTpl, paramRowTpl, importedParamRowTpl, paramTipTpl, html, css) {
    e._$addStyle(css);

    var options = {
        name: 'param-editor-core',

        template: html,

        config: function () {
            this.data = Object.assign({
                importTypes: editorConfig.importTypes,
                customDatatypes: editorConfig.customDatatypes,
                dbConst: util.db,
                hideTip: true,
                readonlyNestEditor: false,
                // 默认可以拖动
                draggableRow: true,
                // 类别模板
                formatTpl: formatTpl,
                // 普通字段的模板
                paramRowTpl: paramRowTpl,
                // 导入数据模型的字段的模板
                importedParamRowTpl: importedParamRowTpl,
                // 一些提示信息
                paramTipTpl: paramTipTpl,
            }, editorConfig.options, this.data);
            this.data.params = this.data.params || [];
            // 保存完整的 source 列表
            this._source = this.data.source;
            this.setXheaders();
            // 拖动的字段行元素
            this.draggingRow = null;
            this.setSource();
            this.checkParams();
            this.handleHasArray();
        },
        getSelectSource: function () {
            return this._source;
        },
        setXheaders: function () {
            if (this.data.isNormalParam) {
                // 异步接口
                this.data.xheaders = this.data.headers.iheader;
            } else {
                // 根据 format 值设置表头
                this.data.xheaders = this.data.headers[this.data.format];
                if (this.$root.data.parentType !== util.db.PAM_TYP_INPUT) {
                    // 非异步接口请求参数，去掉“必需”选项
                    this.data.xheaders = this.data.xheaders.filter(function (header) {
                        return header.key !== 'required';
                    });
                }
            }
        },
        getDefaultParam: function () {
            var field = {
                isArray: util.db.CMN_BOL_NO,
                // 无论哪个类别，后端都需要 type 值
                type: util.db.MDL_SYS_VARIABLE
            };
            var format = this.data.format;
            // 哈希、枚举、数组的默认类型为 string
            if (format === util.db.MDL_FMT_HASH || format === util.db.MDL_FMT_ENUM || format === util.db.MDL_FMT_ARRAY) {
                field.type = util.db.MDL_SYS_STRING;
            }
            return field;
        },
        // 检查 params，保证至少会有一个参数
        checkParams: function () {
            if (!this.data.preview && !(this.data.params && this.data.params.length)) {
                this.resetParams();
            }
        },
        // 重置 params
        resetParams: function () {
            // 删除所有
            this.data.params.splice(0);
            this.data.params.push(this.getDefaultParam())
            this.handleHasArray();
        },
        // 换成其他 params
        swapParams: function (params) {
            // 删除所有
            this.data.params.splice(0)
            params.unshift(0, 0);
            this.data.params.splice.apply(this.data.params, params);
            this.handleHasArray();
        },
        // 根据 format 值不同，设置不同的 source
        setSource: function () {
            if (this.data.format === util.db.MDL_FMT_ENUM) {
                // 枚举的类型只可以是字符、数值或者布尔
                this.data.source = this._source.filter(function (dt) {
                    return dt.format === util.db.MDL_FMT_STRING
                        || dt.format === util.db.MDL_FMT_NUMBER
                        || dt.format === util.db.MDL_FMT_BOOLEAN;
                });
            } else {
                this.data.source = this._source;
            }
        },
        // 添加一个字段
        addParam: function () {
            var newParam = this.getDefaultParam();
            // 控制样式
            newParam.adding = true;
            // 加一个临时id
            var tempId = Date.now();
            newParam.id = tempId;
            this.addParams([newParam]);
            // 使第一个input获取焦点
            setTimeout(function () {
                var row = this.$root.parentNode.querySelector('#param-editor-x-row-' + tempId);
                row && row.querySelectorAll('input')[0].focus();
            }.bind(this), 100);
        },
        changeNormalParam: function (evt) {
            evt.param[evt.key] = evt.selected.id;
            // 更新参数
            this.updateParam([evt.key], evt.param);
        },
        // 修改字段的类型
        changeDatatype: function (evt, paramIndex, isArrayElement, importedParamIndex) {
            // 在修改普通参数
            if (evt.isNormalParam || evt.isRequiredField) {
                return this.changeNormalParam(evt);
            }
            var selected = evt.selected;
            var selectedIsArray = function () {
                return Number(selected.id === editorConfig.customDatatypes.ARRAY_ID);
            };
            var selectedIsObject = function () {
                return Number(selected.id === editorConfig.customDatatypes.OBJECT_ID);
            };
            var _change = function () {
                // 选择的是数组元素
                if (isArrayElement) {
                    param.type = selected.id;
                    param.isObject = selectedIsObject();
                } else {
                    param.isArray = selectedIsArray();
                    param.isObject = selectedIsObject();
                    if (param.isArray) {
                        // 如果选择了数组，数组元素的类型默认为 String
                        param.type = util.db.MDL_SYS_STRING;
                    } else {
                        // 字段类型
                        param.type = selected.id;
                    }
                    this.handleHasArray();
                }
                if (param.isObject) {
                    if (this.data.preview) {
                        // 从非 object 类型修改成 object 类型
                        if (param.adding) {
                            var defaultParam = this.getDefaultParam();
                            defaultParam.adding = true;
                            param.params = [defaultParam];
                        } else if (param.originals.type !== editorConfig.customDatatypes.OBJECT_ID) {
                            // 有 params 就可以表示匿名类型
                            param.params = [];
                            this.updateParam(['params'], param);
                        }
                    }
                } else {
                    // 更新参数
                    this.updateParam(['isArray', 'type'], param);
                }
            }.bind(this);
            var param = this.getParamByIndex(paramIndex, importedParamIndex);
            if (this.data.preview) {
                if (!param.adding && (param.originals.type === editorConfig.customDatatypes.OBJECT_ID) && !selectedIsObject()) {
                    // 从匿名类型切换成其他类型，需要提示用户
                    return this.$root.$emit('change-from-object-confirm', {
                        ok: function () {
                            _change();
                        },
                        cancel: function () {
                            // 还原为旧类型
                            evt.sender.$select(evt.oSelected);
                        },
                        formatName: evt.selected.name
                    })
                }
            }
            _change();
        },
        // 批量添加字段
        addParams: function (params, position) {
            // 先设置 position
            params.forEach(function (param) {
                param.position = this.getNewPosition();
                // 如果是匿名类型的参数，则是在为该匿名类型添加属性，有可能是在数据模型页面，也有可能是在接口页面
                // 这里的 parentType 已经在 html 模板中处理好了
                param.parentType = this.data.parentType;
                // parentId 不一定有值，比如匿名类型还未保存
                if (this.data.parentId) {
                    param.parentId = this.data.parentId;
                }
            }, this);
            if (position !== undefined) {
                // 在指定位置插入一组参数
                params.unshift(position, 0);
                this.data.params.splice.apply(this.data.params, params);
            } else {
                this.data.params = this.data.params.concat(params);
            }
            this.handleHasArray();
            // 程序添加的参数需要手动 update，比如导入
            this.$update();
        },
        // 判断参数中是否有数组类型的字段，包括导入的数据模型中的字段
        handleHasArray: function () {
            // hasArray 表示字段中有数组类型，用来控制样式
            this.data.hasArray = !!this.data.params.find(function (item) {
                if (item.isArray) {
                    return true;
                } else if (item.imported) {
                    return !!item.params.find(function (p) {
                        return p.isArray;
                    });
                }
            });
        },
        // 删除字段
        removeParam: function (index, parentParam) {
            var param = this.data.params[index];
            var remove = function () {
                this.data.params.splice(index, 1);
                this.checkParams();
            }.bind(this);
            // 预览状态下的 parentParam 也可以是 adding 状态
            // 第一层的参数没有 parentParam，需要加判断
            if (param.adding || parentParam && parentParam.adding || !this.data.preview) {
                return remove();
            }
            var sendData = {
                parentId: this.data.parentId,
                parentType: this.data.parentType
            };
            if (param.imported) {
                sendData.imports = param.id;
            } else {
                sendData.params = param.id;
            }
            // 删除参数
            this.$root.$emit('delete-params', {
                data: sendData,
                callback: function () {
                    remove();
                    this.$update();
                }.bind(this)
            });
        },
        // 删除空的字段，在导入的时候，做此操作较为合理
        removeEmptyParams: function () {
            var key = editorUtil.getParamRequiredKeyName(this.data.format);
            this.data.params = this.data.params.filter(function (param) {
                return param[key] && param[key].trim();
            });
        },
        // 是否有正在添加的参数
        hasAddingParam: function () {
            var hasAdding = false;
            var findAddingParam = function (params) {
                params.forEach(function (param) {
                    if (param.adding) {
                        hasAdding = true;
                    } else if (param.params) {
                        findAddingParam(param.params);
                    }
                });
            }
            findAddingParam(this.data.params);
            return hasAdding;
        },
        // 保存所有正在添加的参数
        saveAllParams: function () {
            var data = this.$root.data;
            var key = editorUtil.getParamRequiredKeyName(data.format);
            if (this.checkValid().pass) {
                var result = editorUtil.getParams(data.params, data.format);
                var addingParams = [];
                // 需要保存的数据可能不在同一层，需要递归查找
                var findAddingParams = function (params) {
                    var addingParam = {
                        params: []
                    };
                    params.forEach(function (param) {
                        if (param.hasOwnProperty('vars')) {
                            // 导入类型
                            param.vars.forEach(function (vr) {
                                findAddingParams(vr.params);
                                findAddingParams(vr.imports);
                            });
                        } else if (param.adding) {
                            if (param[key] && param[key].trim()) {
                                addingParam.params.push(param);
                            }
                        } else {
                            // 查找下一层的数据
                            if (param.params) {
                                findAddingParams(param.params);
                                findAddingParams(param.imports);
                            }
                        }
                    });
                    if (addingParam.params.length) {
                        addingParam.parentType = addingParam.params[0].parentType;
                        if (addingParam.params[0].parentId) {
                            addingParam.parentId = addingParam.params[0].parentId;
                        }
                        addingParams.push(addingParam);
                    }
                };
                findAddingParams(result.params);
                // 导入类型中可以有可变类型，也可以修改，比如修改成匿名类型
                findAddingParams(result.imports);
                this.createParams(addingParams);
            }
        },
        // 保存所有正在添加的参数
        cancelAddingParams: function () {
            this.data.params = this.data.params.filter(function (param) {
                return !param.adding;
            });
            // 可能会有名称重复的提示红框，还原一下
            this.checkValid();
        },
        // 在输入框中粘贴 json 字符串的检测
        onPasteInput: function (evt, paramIndex, itemIndex) {
            if (this.data.readonlyNestEditor || itemIndex !== 0) {
                return;
            }
            setTimeout(function () {
                var value = evt.target.value;
                var json;
                try {
                    json = JSON.parse(value);
                } catch (err) {
                    console.log('使用 JSON.parse 方法 解析失败：' + err);
                    try {
                        json = eval('(' + value + ')');
                    } catch (err) {
                        console.log('使用 eval 方法解析失败：' + err);
                    }
                }
                if (typeof json === 'object') {
                    this.addJSONData(json, paramIndex + 1);
                    this.removeParam(paramIndex);
                    this.$update();
                }
            }.bind(this), 0);
        },
        // 输入框获取焦点
        onFocusInput: function (evt, paramIndex, itemIndex, isInNestEditor) {
            // 聚焦输入框时，禁止拖动，以便可以选择元素
            this.data.draggableRow = false;
            // 嵌套中的编辑器、只读输入框以及异步接口中的请求头，不需要显示"可以粘贴JSON"的tip
            if (this.data.readonlyNestEditor || evt.target.readonly || this.data.isNormalParam) {
                return;
            }
            evt.target.select();
            if (!isInNestEditor
                && paramIndex === 0
                && itemIndex === 0
                && (this.data.format == util.db.MDL_FMT_HASH || this.data.format == util.db.MDL_FMT_ENUM)) {
                // 第一个输入框（非嵌套编辑器中）获取焦点时，显示可粘贴json字符串的提示
                this.data.hideTip = false;
            }
        },
        // 失去焦点
        onBlurInput: function (evt, paramKey, paramIndex, importedParamIndex) {
            // 失焦时仍旧可以拖动排序
            this.data.draggableRow = true;
            if (evt.target.readOnly) {
                return;
            }
            this.data.hideTip = true;
            var param = this.getParamByIndex(paramIndex, importedParamIndex);
            if (param.adding) {
                // 正在添加中的参数，无需更新处理
                return;
            }
            // 检查名称是否有重复
            var checkResult = this.checkValid();
            if (checkResult.pass) {
                this.updateParam(paramKey, param);
            } else {
                notify.show(checkResult.msg, 'info', 2000);
                setTimeout(function () {
                    param[paramKey] = param.originals[paramKey];
                    // 还原状态
                    this.checkValid();
                    this.$update();
                }.bind(this), 3000);
            }
        },
        // 输入框回车，预览模式下就新增这条参数
        onKeydownInput: function (evt, paramKey, paramIndex, importedParamIndex) {
            if (!this.data.preview || evt.event.keyCode !== 13) {
                return;
            }
            evt.target.blur();
            this.saveAllParams();
        },
        createParams: function (params) {
            if (!Array.isArray(params) || params.length === 0) {
                return;
            }
            var sendData = {};
            // todo: 创建请求头传递的数据格式，后端还没和创建参数的统一，仍旧使用原来的格式
            if (this.$root.data.isHeader) {
                sendData = {
                    params: params[0].params,
                    parentId: this.data.parentId,
                    parentType: this.data.parentType
                };
            } else {
                sendData.items = params;
            }
            // 值有变化，更新参数
            this.$root.$emit('create-params', {
                data: sendData,
                callback: function (evt, params) {
                    // 新增的情况太过复杂，直接按初始化逻辑重新赋值参数
                    this.$root.data.params = params;
                    this.$root.$update();
                }.bind(this)
            });
        },
        updateParam: function (paramKeys, param) {
            if (this.data.preview && !param.adding) {
                // 预览模式下，判断是否需要更新参数
                var sendData = {
                    parentId: this.data.parentId,
                    parentType: this.data.parentType
                }
                if (param.datatypeId !== 0) {
                    sendData.datatypeId = param.datatypeId
                }
                var valueChanged = false;
                if (!Array.isArray(paramKeys)) {
                    paramKeys = [paramKeys];
                }
                var requiredKeyName = editorUtil.getParamRequiredKeyName(this.data.format);
                paramKeys.forEach(function (key) {
                    // 必填字段不能为空
                    if (key === requiredKeyName && !param[key]) {
                        param[key] = param.originals[key];
                        return;
                    }
                    if (param[key] !== param.originals[key]) {
                        sendData[key] = param[key];
                        valueChanged = true;
                    }
                });
                if (valueChanged) {
                    // 值有变化，更新参数
                    this.$root.$emit('update-param', {
                        data: sendData,
                        param: param,
                        callback: function () {
                            this.$update();
                        }.bind(this)
                    });
                }
            }
        },
        // 显示或者隐藏导入数据模型的所有字段，可以对字段进行忽略or恢复的操作
        toggleIgnoredEditing: function (importedDatatypeId, editing) {
            // 显示和隐藏的时候需要重新计算样式
            this.data.params.forEach(function (param) {
                if (param.id === importedDatatypeId) {
                    param.editingIgnored = editing;
                }
            });
        },
        // 显示或者隐藏导入数据模型的某个字段
        toggleParamIgnored: function (param, ignored) {
            param.ignored = ignored;
            this.updateParam('ignored', param);
        },
        createExp: function (paramKey, paramIndex, importedParamIndex) {
            if (this.data.readonlyNestEditor) {
                return;
            }
            var param = this.data.params[paramIndex];
            if (importedParamIndex !== undefined) {
                param = param.params[importedParamIndex];
            }
            new GRule({
                data: {
                    pid: this.data.pid,
                    value: param[paramKey]
                }
            }).$on('ok', function (val) {
                param[paramKey] = val;
                this.$update();
                this.updateParam(paramKey, this.getParamByIndex(paramIndex, importedParamIndex));
            }.bind(this));
        },
        // 创建数据模型
        createDatatype: function (evt) {
            this.$root.$emit('create-datatype', evt);
        },
        // 检查参数输入是否正确，目前只检是否有重复的名称
        checkValid: function () {
            // 该检查会产生副作用，即有重复时会在参数上添加 inputError 信息
            var checkDuplicateResult = editorUtil.checkDuplicate(this.data.params, this.data.format);
            this.$update();
            return checkDuplicateResult;
        },
        // 获取编辑器的参数及类别信息
        getData: function () {
            var checkResult = this.checkValid();
            return Object.assign(checkResult, {
                format: this.data.format,
                params: this.data.params
            });
        },
        getParamByIndex: function (paramIndex, importedParamIndex) {
            var param = this.data.params[paramIndex];
            if (importedParamIndex !== undefined) {
                param = param.params[importedParamIndex];
            }
            return param;
        },
        getNewPosition: function () {
            var lastParam = this.data.params[this.data.params.length - 1];
            return lastParam ? lastParam.position + 1024 : 16384;
        },
        isNotEditableRow: function () {
            var format = this.data.format;
            if (format !== util.db.MDL_FMT_HASH && format !== util.db.MDL_FMT_ENUM) {
                return true;
            }
            if (!this.data.preview) {
                return this.data.params.length == 1;
            }
        },
        isNotSortableRow: function () {
            var format = this.data.format;
            if (format !== util.db.MDL_FMT_HASH && format !== util.db.MDL_FMT_ENUM) {
                return true;
            }
            return this.data.params.length == 1;
        }
    };

    // 类别 format 相关操作
    var formatAction = {
        // 点击单选按钮修改数据模型的类别
        changeFormat: function (evt, item) {
            var _changeFormat = function () {
                this.data.format = item.format;
                // 根据 format 值设置表头
                this.data.xheaders = this.data.headers[this.data.format];
                this.setSource();
            }.bind(this);
            if (this.data.preview) {
                evt.event.preventDefault();
                this.$root.$emit('change-format', {
                    data: {
                        format: item.format
                    },
                    formatName: item.name,
                    id: this.data.parentId,
                    callback: function (evt, params) {
                        _changeFormat();
                        this.swapParams(params);
                        this.data.modifyingFormat = false;
                        this.$update();
                    }.bind(this)
                });
            } else {
                _changeFormat();
                this.resetParams();
            }
        },
        modifyFormat: function (evt, modify) {
            evt.preventDefault();
            this.data.modifyingFormat = modify;
        }
    }

    // 导入相关的操作
    var importOptions = {
        // 导入数据模型
        import: function (type, parentParam) {
            var modal = null;
            var self = this;
            switch (type) {
                case editorConfig.importTypes.DATATYPE:
                    var getImportTypeList = function () {
                        //只需要把哈希的类型显示出来就行,同时把已经导入的过滤掉(含嵌套导入)
                        var arr = [];
                        // 把已经导入的过滤掉
                        self.data.params.forEach(function (item) {
                            if (item.imported && arr.indexOf(item.id) == -1) {
                                arr.push(item.id);
                            }
                        });
                        return arr;
                    };
                    var importedList = getImportTypeList();
                    // 如果是数据模型，也要把自己过滤掉
                    if (self.data.parentType === util.db.PAM_TYP_ATTRIBUTE) {
                        importedList.push(self.data.parentId);
                    }
                    modal = new DTImport({
                        data: {
                            format: util.db.MDL_FMT_HASH,
                            pid: this.data.pid,
                            importedList: importedList
                        }
                    });
                    modal.$on('ok', function (list) {
                        if (!list) return;
                        var addParams = function () {
                            var params = [];
                            list.forEach(function (item) {
                                params.push({
                                    imported: true,
                                    id: item.id,
                                    datatypeId: item.id,
                                    params: editorUtil.formatParams(item.params, self._source, self.data),
                                    name: item.name
                                });
                            });
                            self.removeEmptyParams();
                            self.addParams(params);
                        }
                        if (self.data.preview && !(parentParam && parentParam.adding)) {
                            // 先发请求
                            var param = {
                                parentId: self.data.parentId,
                                parentType: self.data.parentType,
                                imports: list.map(function (item) {
                                    return {
                                        id: item.id,
                                        position: self.getNewPosition()
                                    }
                                })
                            };
                            var sendData = {};
                            if (self.$root.data.isHeader) {
                                sendData = param;
                            } else {
                                sendData.items = [param];
                            }
                            self.$root.$emit('import-datatypes', {
                                data: sendData,
                                callback: function (evt, params) {
                                    // 按初始化逻辑重新赋值参数
                                    self.$root.data.params = params;
                                    self.$root.$update();
                                    // 导入的数据模型中可能有数组字段，更新当前编辑器
                                    self.handleHasArray();
                                    self.$update();
                                }
                            });
                        } else {
                            addParams();
                        }
                    });
                    break;
                case editorConfig.importTypes.JSON:
                    modal = new JSImport({});
                    modal.$on('ok', function (json) {
                        self.removeEmptyParams();
                        self.addJSONData(json);
                    });
                    break;
                case editorConfig.importTypes.INTERFACE:
                    modal = new INTImport({
                        data: {
                            source: [
                                {name: 'GET', id: 'get'},
                                {name: 'POST', id: 'post'}
                            ]
                        }
                    });
                    modal.$on('ok', function (json) {
                        self.removeEmptyParams();
                        self.addJSONData(json);
                    });
                    break;
                case editorConfig.importTypes.JAVABEAN:
                    modal = new JBImport({
                        data: {
                            pid: self.data.pid
                        }
                    });
                    modal.$on('ok', function (javabeans) {
                        self.removeEmptyParams();
                        javabeans.forEach(function (param) {
                            param.adding = true;
                        });
                        self.addParams(javabeans);
                    });
                    break;

                default:
                    break;
            }
        },
        addJSONData: function (json, position) {
            var params = editorUtil.getParamsFromJSONData(json, this.data.pid, this.$root.data.isHeader);
            this.addParams(params, position);
        }
    };

    // 拖动相关的操作
    var dragOptions = {
        // 移动操作相关
        dragStart: function (evt, paramIndex) {
            evt.event.dataTransfer.effectAllowed = "copyMove";
            this.draggingRow = evt.origin;
            this.data.params[paramIndex].dragging = true;
        },
        dragEnd: function (evt, paramIndex) {
            this.data.params[paramIndex].dragging = false;
            // 计算被移到哪去了
            // 这里不直接取 children 属性，因为会有嵌套的匿名数据模型
            var rows = this.draggingRow.parentNode.querySelectorAll(':scope >.x-row, :scope >.x-row-imported');
            var movedIndex = paramIndex;
            for (var i = 0; i < rows.length; i++) {
                if (rows[i] === this.draggingRow) {
                    movedIndex = i;
                    break;
                }
            }
            if (movedIndex !== paramIndex) {
                var movedParam = this.data.params.splice(paramIndex, 1)[0];
                this.data.params.splice(movedIndex, 0, movedParam);
                this.updatePosition(paramIndex, movedIndex);
            }
            this.draggingRow = null;
        },
        dragOver: function (evt) {
            evt.preventDefault();
        },
        dragEnter: function (evt) {
            evt.preventDefault();
            var overingNode = evt.origin;
            if (!this.draggingRow
                || overingNode === this.draggingRow
                || this.draggingRow.parentNode !== overingNode.parentNode
            ) {
                return;
            }
            this.moveNode(this.draggingRow, overingNode);
        },
        moveNode: function (draggingNode, overingNode) {
            var parentNode = overingNode.parentNode;
            var overTop = overingNode.getBoundingClientRect().top;
            var draggedTop = draggingNode.getBoundingClientRect().top;
            if (draggedTop > overTop) {
                parentNode.insertBefore(draggingNode, overingNode);
            } else {
                parentNode.insertBefore(overingNode, draggingNode);
            }
        },
        updatePosition: function (oldParamIndex, newParamIndex) {
            // 因为老数据没有 position 字段，它的值默认为 0
            // 新创建的数据，都会带上 position 信息，所以理论上是不存在某几个参数的position为0的情况，即要么有值，要么都为0
            var movedParam = this.data.params[newParamIndex];
            var getSortParamIno = function (param) {
                var key = editorUtil.getParamRequiredKeyName(this.data.format);
                var obj = {
                    position: param.position
                }
                obj[key] = param[key];
                if (param.imported) {
                    obj.datatypeId = param.id;
                } else {
                    obj.id = param.id;
                }
                return obj;
            }.bind(this);
            var sortAll = function () {
                var position = 16384;
                return this.data.params.map(function (param) {
                    param.position = position;
                    position += 1024;
                    return getSortParamIno(param);
                });
            }.bind(this);
            var sortedParams;
            var hasNullPosition = this.data.params.find(function (p) {
                return p.position === 0;
            });
            if (hasNullPosition) {
                // 第一次调整顺序的老数据，更新所有参数的position
                sortedParams = sortAll();
            } else {
                var prevParam = this.data.params[newParamIndex - 1];
                var nextParam = this.data.params[newParamIndex + 1];
                var newPosition;
                if (prevParam && nextParam) {
                    newPosition = (prevParam.position + nextParam.position) / 2;
                } else {
                    if (!prevParam) {
                        // 移到了第一个
                        newPosition = nextParam.position / 2;
                    } else if (!nextParam) {
                        // 移到了最后一个
                        newPosition = prevParam.position * 2;
                    }
                }
                // position 须为整数，防止小数出现以免精度导致的可能不准确问题
                newPosition = parseInt(newPosition);
                var existParamWithSamePosition = this.data.params.find(function (p) {
                    return p.position === newPosition;
                })
                if (existParamWithSamePosition) {
                    // 有重复出现就重排
                    sortedParams = sortAll();
                } else {
                    movedParam.position = newPosition;
                    sortedParams = [getSortParamIno(movedParam)];
                }
            }
            if (!this.data.preview || movedParam.adding) return;
            this.$root.$emit('update-params-position', {
                data: {
                    params: sortedParams,
                    parentId: this.data.parentId,
                    parentType: this.data.parentType
                }
            });
        }
    };

    var ParamEditorCore = rb.extend(Object.assign(options, formatAction, importOptions, dragOptions));

    return ParamEditorCore;

},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','4f974133cc48417770aab7278404f301','afb57ef5a0e0ee34baead79fa46d3e43','e2ff6690ab8b15389357e398ea59abd9','16afe76b284216512cb18db2caca44c6','2596f2d6d1b058745ae490f532ef918b','be65ad51cf1a5b0cc99dc59ae0a5d4cc','b149210a882529cffb53afd4c02c71d3','d319c8e6e7d53164ce86d7bf4b393ea1','422387098dc8843f61fd6105d0b10787','65a550fc9126044c69db2ae94934b6f7','51808f26690e419febda9e2c3253421b','3882f04dde75f079785f56d3b7266682','8852acb91894d130ce3086bf49288ae5','e18163ff87a3f271364ae240620b59a7','2426e84c01fb3909b06a392af607b50b');
I$('2275703a6b140db1083144910c5b6149',"<div r-class=\"{{'m-param-editor':true,'param-editor-full-screen':fullScreen}}\">\n    <param-editor-core\n            format=\"{format}\"\n            formatChangeable=\"{formatChangeable}\"\n            isNormalParam=\"{isNormalParam}\"\n            params=\"{params}\"\n            source=\"{datatypes}\"\n            ref=\"editorCore\"\n            pid=\"{pid}\"\n            preview=\"{preview}\"\n            parentId=\"{parentId}\"\n            parentType=\"{parentType}\"\n    ></param-editor-core>\n</div>");
I$('0ccd82833b1a85bca3216310da1642f2',".m-param-editor{\n\tposition:relative;\n}\n.m-param-editor .format-group{\n\tdisplay:flex;\n\talign-items:baseline;\n\theight:24px;\n\tline-height:24px;\n\tmargin-bottom:12px;\n}\n.m-param-editor .format-group label{\n\tmargin-right:10px;\n\tcursor:pointer;\n}\n.m-param-editor .format-group.format-group-preview >label{\n\tdisplay:none;\n}\n.m-param-editor .format-group.format-group-preview >label.checked{\n\tdisplay:block;\n}\n.m-param-editor .format-group.format-group-preview a:link,.m-param-editor .format-group.format-group-preview a:visited{\n\tcolor:#30a1f2;\n}\n.m-param-editor .format-group.format-group-preview .u-btn{\n\tpadding:0 4px;\n\tline-height:24px;\n\theight:24px;\n\tmargin-right:0;\n\tvisibility:hidden;\n\ttransition:none;\n}\n.m-param-editor .format-group.modifying-format >label{\n\tdisplay:block;\n}\n.m-param-editor .format-group.modifying-format a{\n\tdisplay:none;\n}\n.m-param-editor .format-group.modifying-format .u-btn{\n\tvisibility:visible;\n}\n.m-param-editor .glyphicon{\n\tcursor:pointer;\n\tcolor:#79797a;\n}\n.m-param-editor .glyphicon-resize-full,.m-param-editor .glyphicon-resize-small{\n\tposition:absolute;\n\tright:9px;\n\ttop:9px;\n\tfont-weight:bold;\n\tvisibility:hidden;\n}\n.m-param-editor:hover .glyphicon-resize-full,.m-param-editor:hover .glyphicon-resize-small{\n\tvisibility:visible;\n}\n.m-param-editor .glyphicon-resize-small{\n\tdisplay:none;\n}\n.m-param-editor.param-editor-full-screen .glyphicon-resize-full{\n\tdisplay:none;\n}\n.m-param-editor.param-editor-full-screen .glyphicon-resize-small{\n\tdisplay:block;\n\tvisibility:visible;\n}\n.m-param-editor .u-btn{\n\theight:30px;\n\tline-height:30px;\n\tbackground:#fff;\n\tcolor:#555;\n\tpadding:0 10px;\n\tborder:1px solid #efefef;\n\tfont-size:12px;\n\ttransition:none;\n}");
I$('d0e27957f98e24d97a84b7cbff10ba84',function (k, u, e, v, ui, $, jst, jstex, rb, util, Modal, caches, ParamSelect, editorUtil, editorConfig, ParamEditorCore, html, css, p, pro) {

    p._$$ParamEditor = k._$klass();
    pro = p._$$ParamEditor._$extend(ui._$$Abstract);
    e._$addStyle(css);

    // 初始化开始
    pro.__reset = function (options) {
        this.options = u._$merge({}, editorConfig.options, options);
        this.listKey = null;
        this.datatypeCache = caches.datatype._$allocate({
            onlistload: function (evt) {
                this.initDatatypeList();
                if (this.options.preview) {
                    // 获取初始化时的参数列表，用在预览页面
                    this.options.params = this.getInitParams();
                }
                this.render();
            }.bind(this)
        });
        this.listKey = this.datatypeCache._$getListKey(this.options.pid);
        this.datatypeCache._$getList({
            key: this.listKey,
            data: {pid: this.options.pid}
        });
    };

    // 更新数据模型列表
    pro.initDatatypeList = function () {
        this.options.datatypes = JSON.parse(JSON.stringify(this.datatypeCache._$getListInCache(this.listKey)));
        // 增加自定义类型 Array 和 Object
        // 数组
        var foundArray = this.options.datatypes.find(function (item) {
            return item.id === editorConfig.customDatatypes.ARRAY_ID;
        });
        if (!foundArray) {
            this.options.datatypes.push({id: editorConfig.customDatatypes.ARRAY_ID, name: 'Array', description: '数组'});
        }
        var foundObject = this.options.datatypes.find(function (item) {
            return item.id === editorConfig.customDatatypes.OBJECT_ID;
        });
        // 对象
        if (!foundObject) {
            this.options.datatypes.push({
                id: editorConfig.customDatatypes.OBJECT_ID,
                name: 'Object',
                description: '对象'
            });
        }
        // 排序
        var systemDataTypes = [];
        var normalDataTypes = [];
        this.options.datatypes.forEach(function (dt) {
            if (dt.id <= 10003) {
                systemDataTypes.push(dt);
            } else {
                normalDataTypes.push(dt);
            }
        });

        var sortFunc = function (itemA, itemB) {
            return itemA.name.toLowerCase().localeCompare(itemB.name.toLowerCase());
        }
        systemDataTypes.sort(sortFunc);
        normalDataTypes.sort(sortFunc);
        this.options.datatypes = systemDataTypes.concat(normalDataTypes);
    };

    // 渲染组件
    pro.render = function () {
        var Editor = this.getEditor();
        this.edtior = new Editor({
            data: this.options
        }).$inject(this.options.parent, 'top');
    };

    // 获取 regular 组件实例
    pro.getEditor = function () {
        var self = this;
        return rb.extend({
            template: html,
            config: function () {
                this.data.fullScreen = false;
                // 事件监听
                this.$on('toggle-fullscreen', this.toggleFullScreen);
                this.$on('create-datatype', this.createDatatype);
                this.$on('change-from-object-confirm', this.changeFromObject);
                this.$on('update-param', this.updateParam);
                this.$on('update-params-position', this.updateParamsPosition);
                this.$on('create-params', this.createParams);
                this.$on('delete-params', this.deleteParams);
                this.$on('import-datatypes', this.importDatatypes);
                this.$on('change-format', this.changeFormat);
            },
            toggleFullScreen: function (fullScreen) {
                this.data.fullScreen = fullScreen;
                editorUtil.toggleFullScreen(fullScreen, this.parentNode, function () {
                    this.data.fullScreen = false;
                    this.$update();
                }.bind(this));
            },
            createDatatype: function (paramSelectInstance) {
                var datatypeCreateUMI = '/?/progroup/p/res/datatype/create/';
                var _modal = new Modal({
                    data: {
                        content: '',
                        title: ' ',
                        class: 'inline-create',
                        okButton: false,
                        cancelButton: false,
                        closeButton: true
                    }
                }).$on('close', function () {
                    dispatcher._$hide(datatypeCreateUMI);
                    _modal.destroy();
                });
                self.datatypeCache.__doInitDomEvent([
                    [caches.datatype, 'add', function (result) {
                        paramSelectInstance.$select(result.data);
                        //及时清除事件
                        self.datatypeCache.__doClearDomEvent();
                        self.options.onChange();
                    }.bind(this)]
                ]);
                dispatcher._$redirect(datatypeCreateUMI + '?pid=' + self.options.pid, {
                    input: {
                        parent: _modal.$refs.modalbd,
                        done: function () {
                            dispatcher._$hide(datatypeCreateUMI);
                            _modal.destroy();
                        }
                    }
                });
            },
            getCache: function () {
                if (this.data.isHeader
                    && (this.data.parentType == util.db.API_HED_REQUEST || this.data.parentType == util.db.API_HED_RESPONSE)) {
                    return caches.iHeader;
                }
                return caches.parameter;
            },
            changeFromObject: function (options) {
                var modal = Modal.confirm({content: '把 Object 切换成其他类型会清除 Object 参数，确定切换成 “' + options.formatName + '” 类型吗？'});
                modal.$on('ok', options.ok);
                modal.$on('cancel', options.cancel);
                modal.$on('close', options.cancel);
            },
            updateParam: function (options) {
                var cache = this.getCache();
                var cacheInstance = cache._$allocate({
                    onitemupdate: function (evt) {
                        // 只可能更新单个参数
                        // 如果更新参数的类型为Object后，会导致数据模型的列表发生变化，多了一个匿名类型
                        self.initDatatypeList();
                        var newParam = editorUtil.formatParam(evt.data.params[0], self.options.datatypes, self.options);
                        Object.assign(options.param, newParam);
                        cacheInstance._$recycle();
                        options.callback && options.callback(evt);
                        self.options.onChange();
                    }.bind(this)
                });
                cacheInstance._$updateItem({
                    data: options.data,
                    id: options.param.id
                });
            },
            updateParamsPosition: function (options) {
                var cache = this.getCache();
                var cacheInstance = cache._$allocate({
                    onupdatepositions: function (evt) {
                        cacheInstance._$recycle();
                        options.callback && options.callback(evt);
                        self.options.onChange();
                    }.bind(this)
                });
                cacheInstance._$updatePositions(options.data);
            },
            createParams: function (options) {
                var cache = this.getCache();
                var cacheInstance = cache._$allocate({
                    onitemsadd: function (evt) {
                        self.initDatatypeList();
                        var params = self.getInitParams();
                        cacheInstance._$recycle();
                        options.callback && options.callback(evt, params);
                        self.options.onChange();
                    }.bind(this)
                });
                cacheInstance._$addItems({
                    data: options.data
                });
            },
            deleteParams: function (options) {
                var cache = this.getCache();
                var cacheInstance = cache._$allocate({
                    onitemsdelete: function (evt) {
                        cacheInstance._$recycle();
                        options.callback && options.callback(evt);
                        self.options.onChange();
                    }.bind(this)
                });
                cacheInstance._$deleteItems({
                    data: options.data
                });
            },
            importDatatypes: function (options) {
                var cache = this.getCache();
                var cacheInstance = cache._$allocate({
                    onitemsadd: function (evt) {
                        self.initDatatypeList();
                        var params = self.getInitParams();
                        cacheInstance._$recycle();
                        options.callback && options.callback(evt, params);
                        self.options.onChange();
                    }.bind(this)
                });
                // è¿™é‡Œé¢éœ€è¦è°ƒç”¨ _$addItems æ–¹æ³•ï¼Œå®ƒä¼šå¤„ç†(æ›´æ–°)åŽç«¯è¿”å›žçš„ datatypes
                cacheInstance._$addItems({
                    data: options.data
                });
            },
            changeFormat: function (options) {
                var updateFormat = function () {
                    switch (this.data.parentType) {
                        case util.db.PAM_TYP_ATTRIBUTE:
                            return this.changeDatatypeFormat(options);
                        case util.db.PAM_TYP_INPUT:
                            options.data.reqFormat = options.data.format;
                            delete options.data.format;
                            return this.changeInterfaceFormat(options);
                        case util.db.PAM_TYP_OUTPUT:
                            options.data.resFormat = options.data.format;
                            delete options.data.format;
                            return this.changeInterfaceFormat(options);
                    }
                }.bind(this);
                var modal = Modal.confirm({content: 'åˆ‡æ¢ç±»åž‹å°†ä¼šå¯¼è‡´çŽ°æœ‰æ•°æ®ä¸¢å¤±ï¼Œç¡®å®šåˆ‡æ¢æˆ â€œ' + options.formatName + 'â€ ç±»åž‹å—ï¼Ÿ'});
                modal.$on('ok', updateFormat);
            },
            changeDatatypeFormat: function (options) {
                var datatypeCache = caches.datatype._$allocate({
                    onitemupdate: function (evt) {
                        datatypeCache._$recycle();
                        self.initDatatypeList();
                        var params = self.getInitParams();
                        options.callback && options.callback(evt, params);
                        self.options.onChange();
                    }.bind(this)
                });
                datatypeCache._$updateItem({
                    data: options.data,
                    id: options.id
                });
            },
            changeInterfaceFormat: function (options) {
                var interfaceCache = caches.interface._$allocate({
                    onitemupdate: function (evt) {
                        interfaceCache._$recycle();
                        self.initDatatypeList();
                        var params = self.getInitParams();
                        options.callback && options.callback(evt, params);
                        self.options.onChange();
                    }.bind(this)
                });
                interfaceCache._$updateItem({
                    data: options.data,
                    id: options.id
                });
            }
        });
    };

    // èŽ·å–åˆå§‹åŒ–æ—¶çš„å‚æ•°åˆ—è¡¨
    pro.getInitParams = function () {
        switch (this.options.parentType) {
            case util.db.PAM_TYP_ATTRIBUTE:
                // æ•°æ®æ¨¡åž‹çš„é¢„è§ˆé¡µé¢
                var dt = this.options.datatypes.find(function (dt) {
                    return dt.id === this.options.parentId;
                }, this);
                if (dt) {
                    this.options.format = dt.format;
                    var params = JSON.parse(JSON.stringify(dt.params));
                    return editorUtil.formatParams(params, this.options.datatypes, this.options);
                }
                return [];
            case util.db.PAM_TYP_INPUT:
                // æŽ¥å£è¯·æ±‚å‚æ•°çš„è¯¦æƒ…é¡µé¢
                var interfaceCache = caches.interface._$allocate();
                var interfaceData = interfaceCache._$getItemInCache(this.options.parentId);
                this.options.format = interfaceData.reqFormat;
                var params = JSON.parse(JSON.stringify(interfaceData.params.inputs));
                return editorUtil.formatParams(params, this.options.datatypes, this.options);
            case util.db.PAM_TYP_OUTPUT:
                // æŽ¥å£å“åº”å‚æ•°çš„è¯¦æƒ…é¡µé¢
                var interfaceCache = caches.interface._$allocate();
                var interfaceData = interfaceCache._$getItemInCache(this.options.parentId);
                this.options.format = interfaceData.resFormat;
                var params = JSON.parse(JSON.stringify(interfaceData.params.outputs));
                return editorUtil.formatParams(params, this.options.datatypes, this.options);
            case 0:
                // æŽ¥å£çš„è¯·æ±‚å‚æ•°ã€é¡µé¢çš„æŸ¥è¯¢å‚æ•°çš„ parentType éƒ½æ˜¯ 0
                if (this.options.isHeader) {
                    // æŽ¥å£è¯·æ±‚å¤´
                    var interfaceCache = caches.interface._$allocate();
                    var interfaceData = interfaceCache._$getItemInCache(this.options.parentId);
                    // è‚¯å®šæ˜¯å“ˆå¸Œç±»åž‹
                    this.options.format = util.db.MDL_FMT_HASH;
                    this.options.isNormalParam = true;
                    var params = JSON.parse(JSON.stringify(interfaceData.params.reqHeaders));
                    return editorUtil.formatParams(params, this.options.datatypes, this.options);
                } else {
                    // é¡µé¢æŸ¥è¯¢å‚æ•°
                    var pageCache = caches.page._$allocate();
                    var pageData = pageCache._$getItemInCache(this.options.parentId);
                    // 肯定是哈希类型
                    this.options.format = util.db.MDL_FMT_HASH;
                    var params = JSON.parse(JSON.stringify(pageData.params));
                    return editorUtil.formatParams(params, this.options.datatypes, this.options);
                }
            case 1:
                // 接口的响应参数、页面模板的预填参数的 parentType 都是 1
                if (this.options.isHeader) {
                    // 接口响应头
                    var interfaceCache = caches.interface._$allocate();
                    var interfaceData = interfaceCache._$getItemInCache(this.options.parentId);
                    // 肯定是哈希类型
                    this.options.format = util.db.MDL_FMT_HASH;
                    this.options.isNormalParam = true;
                    var params = JSON.parse(JSON.stringify(interfaceData.params.resHeaders));
                    return editorUtil.formatParams(params, this.options.datatypes, this.options);
                } else {
                    // 页面模板的预填参数
                    var templateCache = caches.template._$allocate();
                    var templateData = templateCache._$getItemInCache(this.options.parentId);
                    // 肯定是哈希类型
                    this.options.format = util.db.MDL_FMT_HASH;
                    var params = JSON.parse(JSON.stringify(templateData.params));
                    return editorUtil.formatParams(params, this.options.datatypes, this.options);
                }
            default:
                break;
        }
    };

    // 获取组件的数据，公开方法
    pro._$getData = function () {
        // 防止外部程序在没有初始化完成时就会调用
        if (this.edtior) {
            var data = this.edtior.$refs.editorCore.getData();
            var result = editorUtil.getParams(data.params, data.format);
            delete data.params;
            return Object.assign(data, result);
        }
    };

    // 重置，公开方法
    pro._$reset = function () {
        this.edtior.destroy();
    }

},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','d81f928b2e8dc2e94031eba0a018b644','ac1e584495dcf57f8a3472dfeddbf19b','1b12378d868a5877d4dba65367942b75','4f974133cc48417770aab7278404f301','ffa820b4cb293ae990489967d5c4a899','8cbc286a7834dfcf29c8f7a018e77c02','a17dfb1aca7e5bcf1c99411da2601159','18fdbc27498bb1c4312201f146717dc0','4fac58fc50ffe9ae3011aeb6c1ba9553','d319c8e6e7d53164ce86d7bf4b393ea1','422387098dc8843f61fd6105d0b10787','93e5d2ec2d2dd85f2d9a13263eb84b0e','2275703a6b140db1083144910c5b6149','0ccd82833b1a85bca3216310da1642f2');
I$('db6155f7c853d65e248e1426bee7fe54',"{#if method == \"create\" || method == \"modify\"}\n<div class=\"create-part\">\n    <div class=\"p-title\">\n\t\t<div class='js-ipt-parent'>\n\t\t\t<input class=\"u-ipt\"  maxlength= \"50\" type=\"text\" r-class={{'j-err-ipt': !!inputError}} placeholder=\"{this.data.typeName}名称\" r-model={inputName} on-input ={this.checkVal()}>\n\t\t</div>\n    </div>\n    <div class=\"p-desc\">\n\t\t<div class='js-ipt-parent'>\n\t\t\t<textarea class=\"u-txt\" placeholder=\"{this.data.typeName}描述\" r-model={description}></textarea>\n\t\t</div>\n    </div>\n</div>\n{#elseif method == \"transfer\"}\n<div class=\"pg-transfer\">\n\t{#if !xlist.length}\n\t\t<div class=\"pg-transfer-empty\">\n\t\t\t<i class=\"u-icon-alert-normal-2\"></i><span>项目组没有成员，不能转交给别人了</span>\n\t\t</div>\n\t{#else}\n\t<div class=\"pg-transfer-tip\" >\n\t\t<span r-hide={!inputError}>请选择需要转交的项目组成员</span>\n\t</div>\n\t<div class=\"transfer\">\n\t\t<div class=\"label\">移交给：</div>\n\t\t<div class=\"field\"><select2 source={xlist} on-change={this.transfer($event)}></select2></div>\n\t</div>\n\t{/if}\n</div>\n{#else}\n<div class=\"pg-delete\">\n\t<div class=\"warn-part\">\n\t\t<div class=\"warn-icon u-icon-alert-normal-2\"></div>\n\t\t<div class=\"pg-delete-text\">\n\t\t\t将删除项目组以下所有内容且不可恢复：<br>\n\t\t\t1. 该组下所有项目<br>\n\t\t\t2. 该组下所有资源\n\t\t</div>\n\t</div>\n\t<div class=\"pg-delete-name\">\n\t\t<div class=\"pg-delete-name-hint\">\n\t\t\t请在输入框中输入项目组的名称：（<strong>{name}</strong>）\n\t\t</div>\n\t\t<input type=\"text\" class=\"u-input\" r-class={{'j-err-ipt': !!inputError}} r-model={inputName} placeholder=\"项目组名称\" on-input={this.checkVal()}>\n\t</div>\n</div>\n{/if}");
I$('328fb32f2954e79c27f6fd4e5f5bd0d7',".create-part .u-ipt{\n\tfont-size:14px;\n\twidth:100%;\n\theight:40px;\n\tpadding:14px 10px;\n\tmargin-bottom:10px;\n\tbox-sizing:border-box;\n\tborder:1px solid #e6e6e6;\n}\n.create-part .u-ipt.j-err-ipt{\n\tborder-color:#c71515;\n}\n.create-part .u-txt{\n\tfont-size:14px;\n\twidth:100%;\n\theight:80px;\n\tpadding:14px 10px;\n\tmargin-bottom:20px;\n\tbox-sizing:border-box;\n\tborder:1px solid #e6e6e6;\n}\n.create-part .u-btn{\n\twidth:100%;\n\tbox-sizing:border-box;\n\tcolor:#fff;\n}\n.modal-bd .pg-delete{\n\tpadding:0 50px;\n\ttext-align:left;\n}\n.modal-bd .pg-delete .warn-part{\n\tmargin-bottom:20px;\n}\n.modal-bd .pg-delete .warn-part .warn-icon{\n\tdisplay:inline-block;\n\tvertical-align:top;\n}\n.modal-bd .pg-delete .warn-part .pg-delete-text{\n\tdisplay:inline-block;\n\tcolor:#f04c62;\n}\n.modal-bd .pg-delete .pg-delete-name .pg-delete-name-hint{\n\tcolor:#666;\n\tmargin-bottom:10px;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input{\n\twidth:100%;\n\theight:40px;\n\tborder:1px solid #e6e6e6;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input:hover{\n\tborder:1px solid #e6e6e6;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input.j-err-ipt{\n\tborder-color:#c71515;\n}\n.modal-bd .pg-delete{\n\tpadding:0 50px;\n\ttext-align:left;\n}\n.modal-bd .pg-delete .warn-part{\n\tmargin-bottom:20px;\n}\n.modal-bd .pg-delete .warn-part .warn-icon{\n\tdisplay:inline-block;\n\tvertical-align:top;\n}\n.modal-bd .pg-delete .warn-part .pro-delete-text{\n\tdisplay:inline-block;\n\tcolor:#f04c62;\n}\n.modal-bd .pg-delete .pg-delete-name .pg-delete-name-hint{\n\tcolor:#666;\n\tmargin-bottom:10px;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input{\n\twidth:100%;\n\theight:40px;\n\tborder:1px solid #e6e6e6;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input:hover{\n\tborder:1px solid #e6e6e6;\n}\n.modal-bd .pg-delete .pg-delete-name .u-input.j-err-ipt{\n\tborder-color:#c71515;\n}\n.m-pg-delete .modal-ft{\n\tpadding:0px 50px;\n}\n.m-pg-delete .modal-ft .u-btn{\n\tmargin:0px;\n\twidth:100%;\n\tbackground-color:#f04c62;\n}\n.m-pg-transfer .modal-dialog{\n\toverflow:initial;\n}\n.m-pg-transfer .pg-transfer .pg-transfer-tip{\n\theight:20px;\n\tcolor:#f04c62;\n\ttext-align:left;\n}\n.m-pg-transfer .pg-transfer .pg-transfer-empty{\n\ttext-align:center;\n\tpadding:20px 0px;\n}\n.m-pg-transfer .pg-transfer .pg-transfer-empty span{\n\tline-height:22px;\n\tdisplay:inline-block;\n\tpadding-left:10px;\n\tvertical-align:middle;\n}\n.m-pg-transfer .pg-transfer .transfer{\n\tdisplay:flex;\n\tpadding:0px 0px 20px 0px;\n}\n.m-pg-transfer .pg-transfer .label{\n\tline-height:30px;\n\ttext-align:right;\n}\n.m-pg-transfer .pg-transfer .field{\n\tflex:1;\n\ttext-align:left;\n}\n.m-pg-transfer .pg-transfer .u-select2{\n\twidth:100%;\n}\n.m-pg-create .modal-ft .u-btn,.m-pg-modify .modal-ft .u-btn,.m-pg-transfer .modal-ft .u-btn{\n\twidth:100%;\n\tmargin:0px;\n}");
I$('1d3974a582ae5c031e3df2b107542020',function (e, v, u, Modal, _, cache,select2,tpl, css) {
    e._$addStyle(css);
    var modal = Modal.extend({
        config: function () {
            var _title = {
                "modify":"修改",
                "create":"创建",
                "delete":"删除",
                "transfer":"移交"
            }
            var _t = _title[this.data.method];
            _._$extend(this.data, {
                "contentTemplate": tpl,
                'class': 'm-pg-'+this.data.method,
                'title': _t+'项目组',
                'closeButton': true,
                "okButton": _t,
                "cancelButton": false,
                inputError:false,
                inputName : '',
                description:'',
                xlist:[]
            });
            if (this.data.method === 'modify') {
                this._oriName = this.data.inputName;
                this._oriDescription = this.data.description;
            }
            this.supr(this.data);
        },
        init: function () {
            this.supr(this.data);
            var that = this;
            this.__cache =  cache._$$CacheProGroup._$allocate({
                onitemadd:function () {
                    that.destroy();
                },
                onitemupdate:function () {
                    that.destroy();
                },
                onitemdelete:function () {
                    that.destroy();
                },
                onchangecreator:function () {
                    that.destroy();
                    dispatcher._$redirect("/progroup/home/management/");
                }
            });
            if(this.data.method == "transfer"){
                var pgitem = this.__cache._$getItemInCache(this.data.id);
                var list = [].concat(pgitem.admins,pgitem.developers,pgitem.testers,pgitem.observers);
                this.data.xlist = list.map(function (item) {
                    return {
                        id:item.id,
                        name:item.realname
                    }
                });
                if(!this.data.xlist.length){
                    this.data.okButton = false;
                }
                this.$update();
            }
        },
        ok:function () {
            var option = {
                data: {
                    name: this.data.inputName.trim(),
                    description: this.data.description.trim()
                }
            };

            if(this.data.method == "modify") {
                this.checkVal();
                if (!this.data.inputError) {
                    var isModified = false;
                    ['name', 'description'].forEach(function (key) {
                        var oriKey = '_ori' + key.charAt(0).toUpperCase() + key.substr(1);
                        if (option.data[key] === this[oriKey]) {
                            delete option.data[key];
                        }
                        else {
                            isModified = true;
                        }
                    }, this);
                    if (isModified) {
                        var sendData = {
                            id: this.data.id,
                            data: option.data
                        };
                        this.__cache._$updateItem(sendData);
                    }
                    else {
                        this.destroy();
                    }
                }
            } else if(this.data.method == "create") {
                this.checkVal();
                if(this.data.inputName.trim() == "") return;
                this.__cache._$addItem(option);
            } else if(this.data.method == "transfer"){
                if(!this.data.toId){
                    this.data.inputError = true;
                    return;
                }
                var sendData = {
                    id:this.data.id,
                    data:{
                        toId: this.data.toId
                    }
                };
                this.__cache._$changeCreator(sendData);
            } else{
                if(this.data.inputName.trim() && this.data.name == this.data.inputName.trim() ) {//需要修改
                    var _options = {
                        id: this.data.id
                    };
                    this.__cache._$deleteItem(_options);
                } else {
                    this.data.inputError = true;
                    this.$update();
                }

            }
        },
        checkVal: function(){
            if (!!this.data.inputName.trim()){
                this.data.inputError = false;
            } else {
                this.data.inputError = true;
            }
            this.$update();
        },
        transfer:function (options) {
            this.data.toId = options.selected.id;
            this.data.inputError = false;
        },
        destroy: function () {
            if(!!this.__cache){
                this.__cache._$recycle();
            }
            this.supr();
        }
    });
    return modal;
},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','e8507450a35f1adad6e9dae810fd545a','e26ac58445dd3bc2b730e5275fb45f6f','db6155f7c853d65e248e1426bee7fe54','328fb32f2954e79c27f6fd4e5f5bd0d7');
I$('2bcd8b6dc2d0dad3bd8f6ff8c8efd746',function (rb, u) {
    // 默认选项
    var defaultOptions = {
        // 自定义类名
        className: '',
        // 可设置默认值
        defaultValue: '',
        // 为空时展示的文字
        empty: '',
        // 需要高亮行的关键字，1~2个，以空格隔开
        highlight: [],
        // 显示行数侧栏
        showGutter: false,
        // 高亮选中行
        highlightActiveLine: false,
        // 高亮行使用的类名
        highlightClazz: "marker-err",
        // 是否只读
        readOnly: false,
        // 最大行数
        maxLines: 20,
        // 当前编辑器中的内容
        value: ''
    };
    // 支持的事件：input,blur,focus

    var AceEditor = rb.extend({
        name: "aceEditor",

        template: '{#if !value && !!empty}{empty}{/if}<div ref="con" r-hide={!value&&!!empty} class={className} on-blur={this._emitChange()}></div>',

        config: function () {
            this.data = u._$merge({}, defaultOptions, this.data);
        },

        init: function () {
            this.supr();
            // 初始化代码编辑器
            this.editor = ace.edit(this.$refs.con);
            this.editor.setTheme("ace/theme/eclipse");
            this.editor.getSession().setMode("ace/mode/json");
            this.editor.renderer.setShowGutter(this.data.showGutter);
            this.editor.setHighlightActiveLine(this.data.highlightActiveLine);
            this.editor.$blockScrolling = Infinity;
            this.editor.setOption("maxLines", this.data.maxLines);
            this.editor.setOption("showPrintMargin", false);
            this.editor.setReadOnly(this.data.readOnly);
            // 设置默认值
            this.data.value = this.data.defaultValue;
            this.$show(this.data.defaultValue);
            if (this.data.readOnly) {
                this.$watch('defaultValue', function (newValue, oldValue) {
                    oldValue = oldValue || '';
                    if (newValue !== oldValue) {
                        this.$show(newValue);
                    }
                }.bind(this));
            }

            this.editor.on('change', function () {
                this.data.value = this.editor.getValue();
                // 模拟input事件
                this.$emit('input', {
                    data: this.data.value
                });
            }.bind(this));
            this.editor.on('blur', function () {
                // 触发blur事件
                this.$emit('blur', {
                    data: this.data.value
                });
            }.bind(this));
            this.editor.on('focus', function () {
                // 触发focus事件
                this.$emit('focus', {
                    data: this.data.value
                });
                if (!this.data.readOnly) {
                    this._removeHighlight();
                }
            }.bind(this));
            // 处理高亮
            this.$watch('highlight', function (highlight) {
                this.$highlight(highlight);
            }.bind(this));
        },

        _highlight: function (errstr, key) {
            var Search = ace.require('ace/search').Search;
            var search = new Search();
            var editSession = ace.createEditSession(this.editor.getValue());
            var keylist, errslist, row;
            search.set({needle: '' + errstr});
            errslist = search.findAll(editSession);
            if (key) {
                search.set({needle: new RegExp('\\"' + key + '\\"\\s*\\:\\s*'), regExp: true});
                keylist = search.findAll(editSession);
            }
            if (errslist.length > 0 && keylist && keylist.length > 0) {
                errslist.forEach(function (err) {
                    keylist.forEach(function (key) {
                        if (key.start.row === err.start.row) {
                            this.editor.session.addMarker(err, this.data.highlightClazz, "fullLine");
                            row = 1 + err.start.row;
                        }
                    }.bind(this))
                }.bind(this))
            } else if (errslist.length === 1 || keylist && keylist.length === 1) {
                this.editor.session.addMarker(errslist[0] || keylist[0], this.data.highlightClazz, "fullLine");
                row = 1 + (errslist[0] ? errslist[0].start.row : keylist[0].start.row);
            }
            return row;
        },

        _removeHighlight: function () {
            var markers = this.editor.session.getMarkers(false);
            for (key in markers) {
                if (markers[key].clazz === this.data.highlightClazz) {
                    this.editor.session.removeMarker(markers[key].id);
                }
            }
        },

        $highlight: function (highlight) {
            if (highlight && highlight.length > 0) {
                highlight.forEach(function (item) {
                    item.row = this._highlight(item.data, item.keys && item.keys.slice(-1)[0]);
                }.bind(this))
            }
            return highlight;
        },

        $show: function (value) {
            this.data.value = value;
            if (value) {
                this.$update();
                if (typeof value !== 'string') {
                    value = JSON.stringify(this.data.defaultValue, null, '\t');
                }
                this.editor.setValue(value, -1);
            }
        },

        destroy: function () {
            this.supr();
        }
    });
    return AceEditor;
},'ffa820b4cb293ae990489967d5c4a899','3ff9c25bd81a3c2a260c28122918263a');
I$('e637ef3939f63daa2c9fbffa04c0d470',"<div class=\"res-group\">\n    <label class=\"label\">分组：</label>\n    <select2 source={groups} selected={group} initSilent={true} on-change={this.setGroup($event)} ref=\"group\"></select2>\n    <a class=\"btn\" on-click={this.showCreate()}>新建</a>\n</div>");
I$('c655d64e55a6edfe72f6c43543e40059',".m-modal-res-group .modal-dialog{\n\twidth:50%;\n}\n.m-modal-res-group .res-group{\n\ttext-align:left;\n\tpadding:0 30px;\n}\n.m-modal-res-group .res-group .label{\n\tvertical-align:middle;\n\tcolor:#999;\n}\n.m-modal-res-group .res-group .btn{\n\tcolor:#56c969;\n\tmargin-left:5px;\n\tline-height:30px;\n\tvertical-align:middle;\n}\n.m-modal-res-group .res-group .list-view{\n\tmax-height:90px !important;\n}\n.m-modal-group-inline{\n\tbackground-color:transparent;\n}");
I$('325457688c36389606a273f129ce1aaa',function (_e, _u, modal, select2, groupCache, html, css) {
    _e._$addStyle(css);
    var resGroup = modal.extend({
        name: 'resGroup',
        config: function (data) {
            this.data = _u._$merge({
                "contentTemplate": html,
                'class': 'm-modal-res-group',
                'closeButton': true,
                "okButton": '确定',
                "cancelButton": '取消',
                title: '设置分组',
                hasCreate: false,
                groups: [],
                ids: [],
                group: undefined
            }, data);
            this.listCacheKey = this.data.cache._$getListKey(this.data.pid);
            this.supr(data);
        },
        destroy: function () { //销毁时隐藏新建业务分组模块
            if (this.data.hasCreate) {
                this.hideCreate();
            }
            this.supr();
        },
        hideCreate: function () { //隐藏新建业务分组模块
            dispatcher._$hide("/?/progroup/p/res/group/create/");
            _e._$delClassName(this.$refs.modalbd.parentElement, 'f-dn-important');
            this._modal.destroy();
        },
        ok: function () { //确定
            this.$emit('ok', {
                ids: this.data.ids,
                groupId: this.data.group.id
            });
            this.destroy();
        },
        setGroup: function (event) { //选择分组
            this.data.group = event.selected.id;
        },
        showCreate: function () { //显示新建业务分组私有模块
            _e._$addClassName(this.$refs.modalbd.parentElement, 'f-dn-important');
            this._modal = new modal({
                data: {
                    "content": '',
                    "title": ' ',
                    "class": 'm-modal-group-inline inline-create',
                    "okButton": false,
                    "cancelButton": false,
                    'closeButton': true
                }
            }).$on('close', function () {
                this.hideCreate();
            }.bind(this));
            dispatcher._$redirect("/?/progroup/p/res/group/create/?pid=" + this.data.pid, {
                input: {
                    parent: this._modal.$refs.modalbd,
                    listKey:this.listCacheKey,
                    done: function () {
                        //新建成功后，刷新select的source，并选中新建项(这里由于cache中的add是列表前项追加的，因此选中第一个即可)
                        var groups = this.data.cache._$getListInCache(this.listCacheKey);
                        this.$refs.group.$updateSource(groups, groups[0]);
                        this.hideCreate();
                    }.bind(this)
                }
            });
        }
    });
    return resGroup;

},'555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','e26ac58445dd3bc2b730e5275fb45f6f','7c1169d958213d2faeb6056f33ac4ad6','e637ef3939f63daa2c9fbffa04c0d470','c655d64e55a6edfe72f6c43543e40059');
I$('a76fe161ab00086cb0bc0d1c90c27a28',"<div class=\"resource-share\">\n    <div class=\"warn-part\">\n\t\t<div class=\"warn-icon u-icon-alert-normal-2\"></div>\n\t\t<div class=\"resource-share-text\">\n\t\t分享的资源将会被他人使用，导致无法取消分享，你确定要分享该资源吗？\n\t\t</div>\n    </div>\n</div>");
I$('056985abc012c9c71c05f5e27c5850a2',"<div class=\"cascade-select\">\n    <label class=\"label\">{label}</label>\n    {#if progroupEditable}\n    <select2 ref=\"select1\" source={progroups} selected={progroupSelected} on-change={this.select($event,0)} sortList={false} initSilent={true}></select2>\n    {#else}\n    <span class=\"label name\">{progroupSelected.name}</span>\n    {/if}\n    <select2 ref=\"select2\" source={projects} selected={projectSelected} on-change={this.select($event,1)} sortList={false} initSilent={true}></select2>\n</div>");
I$('93a63543da979477563b8ba5ece82d8f',".cascade-select .label{\n\tvertical-align:middle;\n}\n.cascade-select .name{\n\tmargin-right:40px;\n\tcolor:#222 !important;\n\tmargin-left:3px;\n}");
I$('c2f168ba1a44d75f3babf176415c9248',function (_u, _e, _re, select2, html, css) {
    _e._$addStyle(css);
    var cascadeSelect = _re.extend({
        name: 'cascadeSelect',
        template: html,
        config: function (data) {
            this.data = _u._$merge({
                progroupError: false,
                projectError: false,
                progroups: [],
                projects: []
            }, data);
            if (this.data.progroupEditable) { //项目组可选的情况下
                this.data.progroups = [].concat(this.data.progroups);
            }
            this.sort(this.data.progroups);
            this.data.progroupSelected = this.data.progroupSelected ? _u._$merge({}, this.data.progroupSelected) : this.data.progroups[0];
            this.data.projects = this.data.projects ? this.data.projects : this.data.progroupSelected.projects;
            this.sort(this.data.projects);
            this.data.projectSelected = this.data.projectSelected ? this.data.projectSelected : this.data.progroupSelected.projects[0];
            this.$emit('initData', { //初始化数据
                progroup: this.data.progroupSelected,
                project: this.data.projectSelected
            });
            this.supr(this.data);
        },
        changeProject: function () { //切换项目列表
            this.data.projects = [].concat(this.data.progroupSelected.projects);
            this.sort(this.data.projects);
            this.data.projectSelected = this.data.projects[0];
        },
        findProgroupById: function (id) { //根据id查找progroup
            return this.data.progroups.find(function (item) {
                return item.id === id;
            });
        },
        select: function (event, key) { //select2的change事件处理（key=0:项目组选择框,key=1:项目选择框）
            switch (key) {
                case 0 :
                    if (this.data.progroupError && event.selected.id) {
                        this.data.progroupError = false;
                    }
                    this.data.progroupSelected = this.findProgroupById(event.selected.id);
                    this.changeProject();
                    this.$refs.select2.$updateSource(this.data.projects, this.data.projectSelected);
                    this.$emit('changeProject', { //更改项目
                        project: this.data.projectSelected
                    });
                    break;
                case 1:
                    if (this.data.projectError && event.selected.id) {
                        this.data.projectError = false;
                    }
                    this.data.projectSelected = event.selected;
                    this.$emit('changeProject', {//更改项目
                        project: this.data.projectSelected
                    });
                    break;
                default:
                    break;
            }
        },
        sort: function (list) {
            list.sort(function (a, b) {
                return a.type !== b.type ? a.type - b.type : a.name.localeCompare(b.name);
            });
        }
    });
    return cascadeSelect;

},'3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','ffa820b4cb293ae990489967d5c4a899','e26ac58445dd3bc2b730e5275fb45f6f','056985abc012c9c71c05f5e27c5850a2','93a63543da979477563b8ba5ece82d8f');
I$('0d062dc9840621d909f69f24d5bf35ec',"<div class=\"res-copy-move\">\n    <div class=\"res-target\">\n        <cascadeSelect ref=\"target\" progroups={progroups} progroupSelected={progroup} projects={projects} projectSelected={project}\n                       progroupEditable={type=='copy'} label={label} on-changeProject={this.changeProject($event)}\n                       on-initData={this.initData($event)} on-select={this.submit($event)}></cascadeSelect>\n    </div>\n    <ul class=\"res-list\">\n        {#list xlist as item}\n        <li class=\"res-item\">\n            <div class=\"res-checkbox\" on-click={this.select(item_index)}>\n                <i class=\"u-checkbox u-icon-checkbox-normal\" r-class={{\"f-dn-important\":item.selected}}></i>\n                <i class=\"u-checkbox u-icon-checkbox-pressed\" r-class={{\"f-dn-important\":!item.selected}}></i>\n            </div>\n            <div class=\"res-name\">\n                <input r-model={item.name} r-class={{\"js-disedit\":type!=\"copy\",\"js-error\":item.error}} {#if type!=\"copy\" }readonly{/if} on-input={this.checkInput($event,item_index)} />\n            </div>\n        </li>\n        {/list}\n    </ul>\n    <div class=\"res-group\">\n        <label class=\"label\">分组：</label>\n        <select2 ref=\"group\" source={[]} on-change={this.setGroup($event)} choseOnly={true}></select2>\n    </div>\n    <div class=\"res-tag\">\n        <label class=\"label\">标签：</label>\n        <div class=\"tags\" ref=\"tag\"></div>\n    </div>\n</div>");
I$('d7e6e3c7b42fcce4bba84ad740728211',".m-modal-res-cm .modal-dialog{\n\twidth:50%;\n\toverflow:initial;\n}\n.m-modal-res-cm .res-copy-move{\n\ttext-align:left;\n\tpadding:0 30px;\n}\n.m-modal-res-cm .res-copy-move .label{\n\twidth:48px;\n\tdisplay:inline-block;\n\tcolor:#999;\n}\n.m-modal-res-cm .res-copy-move .res-list{\n\tborder-top:1px dashed #e6e6e6;\n\tborder-bottom:1px dashed #e6e6e6;\n\tmargin:20px 0;\n}\n.m-modal-res-cm .res-copy-move .res-item{\n\tmargin:10px 0 10px 16px;\n}\n.m-modal-res-cm .res-copy-move .res-item .res-checkbox{\n\tfloat:left;\n\tfont-size:0;\n\tcursor:pointer;\n\tmargin-top:7px;\n}\n.m-modal-res-cm .res-copy-move .res-item .res-name{\n\tmargin-left:38px;\n}\n.m-modal-res-cm .res-copy-move .res-item .res-name input{\n\twidth:40%;\n\tmin-width:200px;\n\tpadding-left:5px;\n\tline-height:30px;\n\theight:30px;\n\tborder:1px solid #e6e6e6;\n}\n.m-modal-res-cm .res-copy-move .res-item .res-name .js-disedit{\n\tborder:none;\n}\n.m-modal-res-cm .res-copy-move .res-item .res-name .js-error{\n\tborder-color:#ed5565;\n}\n.m-modal-res-cm .res-copy-move .res-group{\n\theight:30px;\n\tline-height:30px;\n}\n.m-modal-res-cm .res-copy-move .res-group .u-select{\n\tmargin-left:3px;\n}\n.m-modal-res-cm .res-copy-move .res-tag{\n\tmargin-top:10px;\n\theight:30px;\n\tline-height:30px;\n\tposition:relative;\n}\n.m-modal-res-cm .res-copy-move .res-tag .tags{\n\tposition:absolute;\n\ttop:0;\n\tleft:54px;\n\tright:0;\n}");
I$('22bdce9bbbda52ec2805b739f82a74d3',function (_e, _u, modal, cascadeSelect, select2, tagme, groupCache, html, css) {
    _e._$addStyle(css);
    var resCopyMove = modal.extend({
        name: 'resCopyMove',
        config: function (data) {
            this.data = _u._$merge({
                "contentTemplate": html,
                'class': 'm-modal-res-cm',
                'closeButton': true,
                "okButton": '确定',
                "cancelButton": '取消',
                type: 'move',
                xlist: [],
                tags: [],
                project: {},
                errorList: []
            }, data);
            this.data.label = this.data.type == 'copy' ? '复制到：' : '移动到：';
            this.data.title = this.data.type == 'copy' ? '复制资源' : '移动资源';
            this.groupCache = groupCache._$$CacheGroup._$allocate({
                onlistload: function () {
                    //获取当前项目的分组信息
                    var groups = this.groupCache._$getGroupSelectSource(this.data.project.id);
                    this.$refs.group.$updateSource(groups, groups[0]);
                    this.data.gid = groups[0].id;
                }.bind(this)
            });

            this.supr(this.data);
        },
        destroy: function () { //销毁时回收tagme组件
            this.tag && this.tag._$recycle();
            this.tag = null;
            this.supr();
        },
        init: function () {
            this.changeProject(this.data.initData);
            this.supr();
        },
        changeProject: function (event) { //切换项目，需要更新标签和分组的数据
            this.data.project = event.project;
            //资源和分组的listCacheKey
            this.resListCacheKey = this.data.cache._$getListKey(this.data.project.id);
            this.groupListCacheKey = this.groupCache._$getListKey(this.data.project.id);
            //加载业务分组列表
            this.groupCache._$getList({
                key: this.groupListCacheKey,
                data: {
                    pid: this.data.project.id
                }
            });
            //重新初始化tagme组件
            this.tag && this.tag._$recycle();
            this.tag = tagme._$$ModuleTagme._$allocate({
                parent: this.$refs.tag,
                searchCache: this.data.searchCache,
                searchCacheKey: this.data.cache.__cacheKey,
                searchResultFilter: function () {
                    return this.data.cache._$getTagList(this.data.cache.__cacheKey);
                }.bind(this),
                preview: false,
                choseOnly: false,
                editable: true,
                tags: [],
                done: function (data) {
                    if (!!data.change) {
                        this.data.tags = data.tags;
                    }
                }.bind(this),
                queryData: {
                    pid: this.data.project.id
                }
            });
        },
        checkInput: function (event, index) { //检查input是否为空
            if (/^\s*$/.test(event.target.value)) {
                this.data.xlist[index].error = true;
                this.data.errorList.push(index);
            } else {
                this.data.xlist[index].error = false;
                var errIndex = this.data.errorList.indexOf(index);
                errIndex != -1 && this.data.errorList.splice(errIndex, 1);
            }
        },
        initData: function (event) {//初始化时级联组件选中数据
            this.data.initData = event;
        },
        ok: function () {
            if (!this.data.errorList.length) {
                var arr = [], data = {
                    pid: this.data.project.id,
                    gid: this.data.gid
                };
                if (this.data.type == 'copy') { //复制资源，
                    this.data.xlist.forEach(function (item) {
                        if (item.selected) {
                            arr.push({
                                id: item.id,
                                name: item.name
                            });
                        }
                    });
                    data.copys = arr;
                } else { //移动资源
                    this.data.xlist.forEach(function (item) {
                        if (item.selected) {
                            arr.push(item.id);
                        }
                    });
                    data.moves = arr;
                }
                if (arr.length) { //有选中，才触发submit
                    var tags = this.data.tags.map(function (item) {
                        return item.name;
                    });
                    data.tag = tags.join(',');
                    this.$emit('ok', {
                        type: this.data.type,
                        data: data
                    });
                }
                this.destroy();
            }
        },
        cancel:function () {
            this.tag && this.tag._$recycle();
            this.supr();
        },
        select: function (index) { //checkbox选中状态切换
            var item = this.data.xlist[index];
            item.selected = !item.selected;
        },
        setGroup: function (event) { //选择分组
            this.data.gid = event.selected.id;
        }
    });
    return resCopyMove;

},'555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','c2f168ba1a44d75f3babf176415c9248','e26ac58445dd3bc2b730e5275fb45f6f','ac756f830dd7d5bd7642918e731ed189','7c1169d958213d2faeb6056f33ac4ad6','0d062dc9840621d909f69f24d5bf35ec','d7e6e3c7b42fcce4bba84ad740728211');
I$('c6f70c5e7a6d6f576c7ba6101fdfe887',function (_k, _e, _u, _c, _m, modal, _pgCache, _proCache, _groupCache, stripedList, caches, _notify, resCopyMove, resGroup, _modal, _html, _p, _pro) {

    /**
     * 资源模块
     * @class   {wd.m._$$ModuleResList}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  可选配置参数，已处理参数列表如下所示
     */
    _p._$$ModuleResList = _k._$klass();
    _pro = _p._$$ModuleResList._$extend(_m._$$Module);

    /**
     * 模块构建
     * @param  {Object} _options 子类传给父类的配置信息
     * 下面为ext的属性信息
     * resType {String} 子类资源类型
     * listCache {String}  子类cacheKey
     * cacheName {String} 子类cache名称
     * callBackList {Array} cache监听的回调事件
     * eventList {Array} 需注册的自定义事件
     */
    _pro.__doBuild = function (_options) {
        var _defaultOptions = {
            //子类资源类型
            resType: '',
            //子类cacheKey
            listCache: null,
            //实例化cache实例名称
            cacheName: '',
            //cache监听的回调事件，有两种方式定义子类的自定义回调（或者重写父类已定义的方法）：
            // 1.传对象进来 {name:'onxxx', func: fucntion(result){ xxxx}.bind(this)} eg:   callBackList: ['onsetgroup', {name: 'onbatch', func: function (result) {
            //				var list = this.__dtCache._$getListInCache(this._listCacheKey);
            //			this.stripedList._$updateList(list);
            //		}.bind(this)}],
            // 2. 在 cacheOption 对象定义自定义回调，如：
            // cacheOption :{
            //	onbatch: function (result) {
            //				var list = this.__dtCache._$getListInCache(this._listCacheKey);
            //			this.stripedList._$updateList(list);
            //	}.bind(this)
            // }

            callBackList: [],
            //需注册的自定义事件
            eventList: [],
            //传进doinitDomEvent 的需初始化事件的数组，传子类特有的方法，或者重写父类已定义的方法
            // 两种方式可定义子类的方法或重写父类的方法
            // 1. customEventFunc 传入 eg： customEventFunc[[
            //window, 'res-crud', this.__showResCrud.bind(this)
            //]]
            // 2. 子类的doinitDomEvent中自己定义
            customEventFunc: [],
            //子类cache 参数
            cacheOption: {},
            //striplist
            stripedListOption: {},
            canShare: false
        }
        this._subOpt = _u._$merge(_defaultOptions, _options);
        this.__super();
        this.__proCacheOptions = {
            onitemload: function () {
                this.__project = this.__proCache._$getItemInCache(this.__pid);
                this.__pgid = this.__project.progroupId;
                this.__pgCache = _pgCache._$$CacheProGroup._$allocate({
                    onitemload: function () {
                        //获取用户权限，并根据权限修改striplist参数
                        var progroup = this.__pgCache._$getItemInCache(this.__project.progroupId);
                        this.__role = this.__pgCache._$getRole(this.__project.progroupId);
                        if (!!this._options.batActionFlag) {
                            this.stripedListOptions.batchAction = this.__getBatchAction();
                        }
                        //如果是观察者没有批量操作权限
                        if (this.__role == 'observer') {
                            this.stripedListOptions.batchAction = '';
                        }
                        //如果是接口，刷新的时候 回收一下 striplist组件（避免多次点击资源管理和接口按钮实例化多个）
                        if (this._subOpt.resType == 'interface') {
                            if (this.stripedList) {
                                this.stripedList = this.stripedList._$recycle();
                            }
                        }
                        this.stripedList = stripedList._$$ModuleStripedList._$allocate(this.stripedListOptions);
                    }.bind(this)
                });
                //发送请求
                this.__pgCache._$getItem({
                    id: this.__project.progroupId
                });

            }.bind(this)
        };
        //子类cache实例参数
        this.__initCacheOption();
        //注册自定义事件
        this.__registEvent();

        //striplist参数
        this.__initStripListOptions();
    };


    /**
     *  子类cache实例参数
     * @return {Void}
     */
    _pro.__initCacheOption = function () {
        this[this._subOpt.cacheName + 'Options'] = {};
        _u._$forEach(this._subOpt.callBackList, function (item) {
            switch (item) {
                case 'onshare':
                    this[this._subOpt.cacheName + 'Options'].onshare = function (result) {
                        //分享完成后回调
                        var list = this[this._subOpt.cacheName]._$getListInCache(this._listCacheKey);
                        this.stripedList._$updateList(list);
                        _notify.show("分享成功", 'success', 2000);
                    }._$bind(this)
                    break;
                case 'onclone':
                    this[this._subOpt.cacheName + 'Options'].onclone = function (result) {
                        if (result.pid == this.__pid || result.ext.isPublic) {
                            this.stripedList._$refresh();
                        }
                    }.bind(this)
                    break;
                case 'onmove':
                    this[this._subOpt.cacheName + 'Options'].onmove = function (result) {
                        // 移动的时候，情况较复杂，移动后直接刷新列表
                        this.stripedList._$refresh();
                        // if (!!result.ext && result.ext.isPublic) {
                        //     this.stripedList._$refresh();
                        // } else {
                        //     var list = this[this._subOpt.cacheName]._$getListInCache(this._listCacheKey);
                        //     this.stripedList._$updateList(list);
                        // }
                    }.bind(this)
                    break;
                case 'onsetgroup':
                    this[this._subOpt.cacheName + 'Options'].onsetgroup = function () { //设置分组成功后，刷新列表
                        var list = this[this._subOpt.cacheName]._$getListInCache(this._listCacheKey);
                        this.stripedList._$updateList(list);
                    }.bind(this)
                    break;
                default:
                    if (typeof(item) == 'object') {
                        this[this._subOpt.cacheName + 'Options'][item.name] = item.func;
                    }
                    ;
                    break;
            }
        }.bind(this));
        //子类cache实例
        this[this._subOpt.cacheName + 'Options'] = _u._$merge(this[this._subOpt.cacheName + 'Options'], this._subOpt.cacheOption);

    };
    /**
     *  注册自定义事件
     * @return {Void}
     */
    _pro.__registEvent = function () {
        //注册自定义事件
        _c._$$CustomEvent._$allocate({
            element: window,
            event: this._subOpt.eventList
        });
    };

    /**
     *  初始化s
     * @return {Void}
     */
    _pro.__initStripListOptions = function () {
        var defaultOptions = {
            parent: _e._$getByClassName(this.__body, 'list-content')[0],
            listCache: this._subOpt.listCache,
            lsListKey: 'nei-' + this._subOpt.resType + 's-list',
            hasTagFilter: true,
            headers: [],
            defaultSortKey: 'createTime',
            sortable: true,
            hasSearchBox: true,
            hasHeaderFilter: true,
            listGroups: [
                {
                    group: '业务分组',
                    key: 'group'
                },
                {
                    group: '负责人',
                    key: 'respo'
                },
                {
                    group: '创建者',
                    key: 'creator'
                }
            ],
            afterRender: function () {
                var addBtn = _e._$getByClassName(this.__body, 'resource-add')[0];
                _e._$delClassName(addBtn.parentNode, 'f-dn');
                _e._$attr(addBtn, 'href', '/' + this._subOpt.resType + '/create/?pid=' + this.__pid);
            }.bind(this)
        };
        this.stripedListOptions = _u._$merge(defaultOptions, this._subOpt.stripedListOption);
    };
    /**
     * 显示模块
     * @param  {Object} _options 配置信息
     * @return {Void}
     */
    _pro.__onShow = function (_options) {
        this.stripedList = null;
        this.__groupCache = _groupCache._$$CacheGroup._$allocate();
        //子类cache实例化
        this[this._subOpt.cacheName] = caches[this._subOpt.listCache]._$allocate(this[this._subOpt.cacheName + 'Options']);
        if (this._subOpt.resType !== 'gorup') {
            this.__proCache = _proCache._$$CachePro._$allocate(this.__proCacheOptions);
        }
        this.__super(_options);
        this.__addEvent();
    };

    _pro.__onRefresh = function (_options) {
        this.__pid = parseInt(_options.param.pid.replace('/', ''));
        this._options = _options;
        this.__super(_options);
        this.__groupCache._$getList({
            key: this.__groupCache._$getListKey(this.__pid),
            data: {
                pid: this.__pid
            }
        });
        this._listCacheKey = this[this._subOpt.cacheName]._$getListKey(this.__pid);
        this.stripedListOptions.queryData = {
            pid: this.__pid
        };
        this.stripedListOptions.listCacheKey = this._listCacheKey;
        //发送请求
        this.__proCache._$getItem({
            id: this.__pid
        });
    };

    /**
     * 隐藏模块
     * @return {Void}
     */
    _pro.__onHide = function () {
        this.__super();
        this.__doClearDomEvent();
        if (this.stripedList) {
            this.stripedList = this.stripedList._$recycle();
        }
        this[this._subOpt.cacheName] = this[this._subOpt.cacheName]._$recycle();
        this.__resCopyMove && this.__resCopyMove.destroy();
        this.__resCopyMove = null;
        this.__shareLayer && this.__shareLayer.destroy();
        this.__shareLayer = null;
    };


    _pro.__addEvent = function () {
        var domEventList = [];
        if (this._subOpt.canShare) {
            domEventList.push([
                window, this._subOpt.resType + '-share',
                function (evt) {
                    this.__share(evt.id);
                }._$bind(this)
            ]);
        }
        _u._$forEach(this._subOpt.eventList, function (item) {
            switch (item) {
                case 'res-copy':
                    domEventList.push([
                        window, 'res-copy', this.__showResCopyMove.bind(this)
                    ]);
                    break;
                case 'res-move':
                    domEventList.push([
                        window, 'res-move', this.__showResCopyMove.bind(this)
                    ]);
                    break;
                case 'res-group':
                    domEventList.push([
                        window, 'res-group', this.__showResGroup.bind(this)
                    ]);
                    break;
                default:
                    break;
            }
            ;
        }.bind(this));
        if (this._subOpt.customEventFunc.length) {
            _u._$forEach(this._subOpt.customEventFunc, function (item2) {
                domEventList.push(item2);
            }.bind(this))
        }
        if (!domEventList.length) {
            return;
        }
        ;
        this.__doInitDomEvent(domEventList);

    };

    /**
     * 分享资源逻辑
     * @param  {Number} tid 模版id
     * @return {Void}
     */
    _pro.__share = function (tid) {
        if (!!this.__shareLayer) {
            this.__shareLayer.destroy();
        }
        this.__shareLayer = new _modal({
            data: {
                "contentTemplate": _html,
                "okButton": "分享",
                "title": "分享确认",
                "class": "m-resource-share"
            }
        }).$on('ok', function () {
            this[this._subOpt.cacheName]._$share({
                id: tid,
                ext: {
                    cacheKey: this._listCacheKey,
                    pid: this.__pid
                }
            });
        }._$bind(this));
    };

    /**
     * 显示资源复制或移动弹框
     * @param {Event} 事件对象
     */
    _pro.__showResCopyMove = function (event) {
        var type = event.type == 'res-move' ? 'move' : 'copy';
        if (event.ids.length > 10) {
            _notify.warning('最多选择10个资源复制');
        } else {
            var xlist = [], progroups = [], progroup, project, list = this[this._subOpt.cacheName]._$getResListByIds(event.ids);
            if (type == 'move') {
                // if (!!this[this._subOpt.cacheName].__hasSharedRes(list)) {
                // 	_notify.warning('共享资源不能移动');
                // 	return;
                // }
                progroup = this.__proCache._$getProgroupByProId2(this.__pid, false, true);
                if (!progroup) {
                    _notify.warning('没有可移动的目标项目');
                    return;
                }
                progroups = [progroup];
            } else {
                progroups = this.__pgCache._$getListInCache(_pgCache._$cacheKey);
                progroup = this.__proCache._$getProgroupByProId(this.__pid);
                project = progroup.projects.find(function (item) {
                    return item.id === this.__pid;
                }.bind(this));
            }
            list.forEach(function (item) {
                xlist.push({
                    id: item.id,
                    name: item.name,
                    selected: true
                });
            });
            this.__resCopyMove = new resCopyMove({
                data: {
                    cache: this[this._subOpt.cacheName],
                    searchCache: caches[this._subOpt.resType],
                    type: type,
                    xlist: xlist,
                    progroups: progroups,
                    progroup: progroup,
                    project: project
                }
            }).$on('ok', function (event) {
                switch (event.type) {
                    case 'copy':
                        var pid = event.data.pid;
                        if (this.__proCache._$isPublic(pid)) {
                            this.__confirm = _modal.confirm({
                                content: '复制到【公共资源库】将导致资源共享，项目中的项目都可以查看到这些资源',
                                title: '复制确认'
                            }).$on('ok', function () {
                                this.__clone(event, true);
                            }.bind(this));
                        } else {
                            this.__clone(event, false);
                        }
                        break;
                    case 'move':
                        if (this.__pid !== event.data.pid) {
                            if (this.__proCache._$isPublic(event.data.pid)) {
                                this.__confirm = _modal.confirm({
                                    content: '移动到【公共资源库】将导致资源共享，项目中的项目都可以查看到这些资源',
                                    title: '移动确认'
                                }).$on('ok', function () {
                                    this.__move(event, true);
                                }.bind(this));
                            } else {
                                this.__move(event, false);
                            }
                        } else {
                            _notify.show("不能移动到当前项目", 'error', 2000);
                        }
                        break;
                    default:
                        break;
                }
            }.bind(this));
        }
    };
    /**
     * 移动资源
     * @param {Object} options - 配置参数
     * @param {Boolean} isPublic - 目标项目是否是公共资源库
     */
    _pro.__move = function (options, isPublic) {
        this[this._subOpt.cacheName]._$move({
            data: options.data,
            actionMsg: '移动成功',
            key: this[this._subOpt.cacheName]._$getListKey(options.data.pid),
            ext: {
                originPid: this.__pid,
                isPublic: isPublic
            }
        });
    };
    /**
     * 复制资源
     * @param {Object} options - 配置参数
     * @param {Boolean} isPublic - 目标项目是否是公共资源库
     */
    _pro.__clone = function (options, isPublic) {
        this[this._subOpt.cacheName]._$clone({
            data: options.data,
            actionMsg: '复制成功',
            key: this[this._subOpt.cacheName]._$getListKey(options.data.pid),
            ext: {
                isPublic: isPublic
            }
        });
    };

    /**
     * 显示批量设置分组弹框
     */
    _pro.__showResGroup = function (event) {
        var list = this[this._subOpt.cacheName]._$getResListByIds(event.ids);
        if (!!this[this._subOpt.cacheName].__hasSharedRes(list)) {
            _notify.warning('共享资源不能修改分组');
        } else {
            this.__resGroup = new resGroup({
                data: {
                    ids: event.ids,
                    cache: this.__groupCache,
                    groups: this.__groupCache._$getGroupSelectSource(this.__pid),
                    pid: this.__pid
                }
            }).$on('ok', function (data) {
                this[this._subOpt.cacheName]._$setGroup({
                    actionMsg: '设置成功',
                    data: data
                });
            }.bind(this));
        }
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','8717e18cf0d38e654531116f64f5593d','c946055836c26441b9d60b589f2e1581','a17dfb1aca7e5bcf1c99411da2601159','e8507450a35f1adad6e9dae810fd545a','09437bf7199eb808a35a38e5178e5151','7c1169d958213d2faeb6056f33ac4ad6','645b07d1227cb7ffbb51604bdde81b34','18fdbc27498bb1c4312201f146717dc0','afb57ef5a0e0ee34baead79fa46d3e43','22bdce9bbbda52ec2805b739f82a74d3','325457688c36389606a273f129ce1aaa','a17dfb1aca7e5bcf1c99411da2601159','a76fe161ab00086cb0bc0d1c90c27a28');
I$('39e2dd8a159cfa7ad0cd3c41ec392809',function (_v,_e,_p,_o,_f,_r){
    /**
     * 节点focus行为
     * @param  {String|Node} 节点
     * @param  {Number}      模式
     * @param  {String}      样式
     * @return {Void}
     */
    _p.__focusElement = (function(){
        // do blur check
        var _onBlur = function(_clazz,_event){
            var _element = _v._$getElement(_event);
            if (!_element.value)
                _e._$delClassName(_element,_clazz);
        };
        // do focus
        var _onFocus = function(_clazz,_event){
            _e._$addClassName(
                _v._$getElement(_event),_clazz);
        };
        return function(_element,_mode,_clazz){
            if (_mode==1){
                _v._$addEvent(
                    _element,'blur',
                    _onBlur._$bind(null,_clazz)
                );
            }
            if (_mode==1||_mode==-1){
                _v._$addEvent(
                    _element,'focus',
                    _onFocus._$bind(null,_clazz)
                );
            }
            // other do nothing, use css :focus
        };
    })();
    
    return _p;
},'b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f');
I$('ac715596a4fe913a8279af4efe2366bf',function(b1490930301986,_h,_v,_e,_p,_o,_f,_r){if (b1490930301986._$KERNEL.engine==='trident'&&b1490930301986._$KERNEL.release<='3.0'){I$(17,function (){
        /**
         * 节点focus行为
         * @param  {String|Node} 节点
         * @param  {Number}      模式
         * @param  {String}      样式
         * @return {Void}
         */
        _h.__focusElement = (function(){
            // remove classname onblur
            var _onBlur = function(_clazz,_event){
                _e._$delClassName(
                    _v._$getElement(_event),_clazz
                );
            };
            return _h.__focusElement._$aop(
                function(_event){
                    // patch ie6-7 :focus
                    var _args = _event.args;
                    if (_args[1]!=1){
                        _v._$addEvent(
                            _args[0],'blur',
                            _onBlur._$bind(null,_args[2])
                        );
                        _args[1] = -1;
                    }
                }
            );
        })();
    });}return _h;},'345f1460138e362bb33cc48ffc7cd12b','39e2dd8a159cfa7ad0cd3c41ec392809','b9845e13e284410cb0bb909f737020e4','555a9eecaf26c5c01fe9db8d965bc30f');
I$('fcee066722ba7afb04ca5e5584a6d4fc',function (NEJ,_u,_e,_h,_x,_p,_o,_f,_r){
    /**
     * 节点focus行为，提供两种模式支持
     *
     * * 0 - 聚焦添加效果，失焦去除效果，高版本使用:focus样式处理
     * * 1 - 聚焦添加效果，失焦时只有在当前输入框没有内容时去除效果
     *
     * 样式举例
     * ```css
     *   input:focus,input.js-focus{border:1px solid #f00;}
     *   input{color:#aaa;background:#eee;}
     *   .js-focus-0{color:#000;background-color:#fff;}
     * ```
     *
     * 结构举例
     * ```html
     *   <form>
     *     <!-- 可以使用data-focus指定聚焦时样式名称 -->
     *     <!-- 可以使用data-mode指定聚焦模式 -->
     *     <!-- 通过data-focus/data-mode指定的参数优先级高于接口调用时输入参数 -->
     *     <input id="xxx" type="text" data-focus="js-focus-0" data-mode="1"/>
     *     <!-- 节点没有指定参数 -->
     *     <input id="yyy" type="text"/>
     *   </form>
     * ```
     *
     * 脚本举例
     * ```javascript
     *   NEJ.define([
     *       'util/focus/focus'
     *   ],function(_e){
     *       // 参数已在节点data-属性中指定
     *       _e._$focus('xxx');
     *
     *       // 参数没有指定，通过输入传递，仅指定样式名称
     *       _e._$focus('yyy','js-focus-1');
     *
     *       // 参数没有指定，通过输入传递，仅指定聚焦模式
     *       _e._$focus('yyy',1);
     *
     *       // 参数没有指定，通过输入传递，同时指定样式名称和聚焦模式
     *       _e._$focus('yyy',{clazz:'js-focus-2',mode:1});
     *   });
     * ```
     *
     * @method   module:util/focus/focus._$focus
     * @param    {String|Node} arg0  - 节点
     * @param    {Object}      arg1  - 配置参数
     * @property {Number}      mode  - 模式选择，默认为0
     * @property {String}      clazz - 聚焦样式，默认js-focus
     * @return   {Void}
     */
    /**
     * @method CHAINABLE._$focus
     * @see module:util/focus/focus._$focus
     */
    _p._$focus = function(_element,_options){
        _element = _e._$get(_element);
        if (!!_element){
            var _mode = 0,
                _clazz = 'js-focus';
            // check param
            if (_u._$isNumber(_options)){
                _mode = _options;
            }else if(_u._$isString(_options)){
                _clazz = _options;
            }else if(_u._$isObject(_options)){
                _mode = _options.mode||_mode;
                _clazz = _options.clazz||_clazz;
            }
            // check data- attribute
            var _value = parseInt(
                _e._$dataset(_element,'mode')
            );
            if (!isNaN(_value)){
                _mode = _value;
            }
            _value = _e._$dataset(_element,'focus');
            if (!!_value){
                _clazz = _value;
            }
            // do focus
            _h.__focusElement(_element,_mode,_clazz);
        }
    };
    // for chainable method
    _x._$merge(_p);

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','ac715596a4fe913a8279af4efe2366bf','cefc834b106876d285d05b428248ca57');
I$('45e34bda512baa2f8e0ce8ee421d1547',function (_p){
    /**
     * 取字符串长度
     * @param  {String} 字符串
     * @return {Number} 字符串长度
     */
    _p.__length = (function(){
        var _reg = /(\r\n|\r|\n)/g;
        return function(_content){
            return (_content||'').replace(_reg,'**').length;
        };
    })();
    
    return _p;
},'345f1460138e362bb33cc48ffc7cd12b');
I$('ec5d58d63db793fb279d0232d400ed9f',function(b1490930302141,_h){if (b1490930302141._$KERNEL.engine==='trident'){I$(18,function (){
        /**
         * 取字符串长度
         * @param  {String} 字符串
         * @return {Number} 字符串长度
         */
        _h.__length = function(){
            return (_event.args[0]||'').length;
        };
    });}return _h;},'345f1460138e362bb33cc48ffc7cd12b','45e34bda512baa2f8e0ce8ee421d1547');
I$('0a895f78446ec2b0bf0923a32ce84598',function (NEJ,_e,_v,_u,_x,_h,_p,_o,_f,_r){
    /**
     * 输入框计数器，使用属性设置输入的总长度限制，
     * 以下两个属性只能同时设置一个，maxlength优先级高于data-max-length
     *
     * | 属性名 | 描述 |
     * | :---   | :--- |
     * | data-max-length | 输入长度必须小于此设置，一个中文算两个字符，适用于text/textarea |
     * | maxlength       | 输入长度必须小于此设置，一个中文算一个字符，适用于text/textarea |
     *
     * 结构举例：
     * ```html
     * <input type="text" id="input-id-0" maxlength="100"/>
     * <input type="text" id="input-id-1" data-max-length="100"/>
     * <textarea id="textarea-id-0" maxlength="100"></textarea>
     * <textarea id="textarea-id-1" data-max-length="100"></textarea>
     * ```
     *
     * 脚本举例：
     * ```javascript
     * NEJ.define([
     *     'util/counter/counter'
     * ],function(_e){
     *     // 使用属性
     *     _e._$counter('input-id-0',{
     *         onchange:function(_event){
     *                // 自定义提示内容
     *                _event.value = '还可输入'+_event.delta+'字';
     *         }
     *     });
     * });
     * ```
     *
     * @method   module:util/counter/counter._$counter
     * @param    {String|Node} arg0    - 输入节点
     * @param    {Object}      arg1    - 配置参数
     * @property {String}      nid     - 显示提示信息节点标识
     * @property {Number}      max     - 最大字数限制，优先级大于标签上配置的属性，一个中文算一个字符，默认100个字符
     * @property {String}      clazz   - 计数器显示样式
     * @property {Function}   onchange - 字数变化触发回调，{input:'xx',length:2,delta:98}
     * @return   {Void}
     */
    /**
     * @method CHAINABLE._$counter
     * @see module:util/counter/counter._$counter
     */
    _p._$counter = (function(){
        var _reg0 = /[\r\n]/gi,
            _cache = {}; // {id:{max:123,id:'xxx',onchange:function,onlength:function}}
        // calculate string length
        var _doLength = function(_str){
            return _h.__length(_str);
        };
        // input change
        var _onChange = function(_id){
            var _conf  = _cache[_id],
                _node1 = _e._$get(_id),
                _node2 = _e._$get(_conf.xid);
            if (!_node1||!_conf) return;
            var _event = {
                input:_node1.value
            };
            _event.length = _conf.onlength(_event.input);
            _event.delta = _conf.max-_event.length;
            _conf.onchange(_event);
            _node2.innerHTML = _event.value||('剩余'+Math.max(0,_event.delta)+'个字');
        };
        return function(_element,_options){
            var _id = _e._$id(_element);
            if (!_id||!!_cache[_id]) return;
            // check config
            var _conf = _u._$merge({},_options);
            _conf.onchange = _conf.onchange||_f;
            _conf.onlength = _doLength;
            if (!_conf.max){
                var _max1 = parseInt(_e._$attr(_id,'maxlength')),
                    _max2 = parseInt(_e._$dataset(_id,'maxLength'));
                _conf.max = _max1||_max2||100;
                if (!_max1&&!!_max2) _conf.onlength = _u._$length;
            }
            _cache[_id] = _conf;
            // add listener
            _v._$addEvent(_id,'input',_onChange._$bind(null,_id));
            // init left counter show
            var _node = _e._$wrapInline(_id,{
                nid:_conf.nid||'js-counter',
                clazz:_conf.clazz
            });
            _conf.xid = _e._$id(_node);
            _onChange(_id);
        };
    })();
    // for chainable method
    _x._$merge(_p);

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','cefc834b106876d285d05b428248ca57','ec5d58d63db793fb279d0232d400ed9f');
I$('f4c1e5168a8f0ff578680e2d426d3696',function (_p,_o,_f,_r){
    /**
     * 节点占位符行为，高版本浏览器用样式处理
     * @param  {String|Node} 节点
     * @param  {String}      样式
     * @return {Void}
     */
    _p.__setPlaceholder = function(_element,_clazz){
        // do nothing
    };

    return _p;
});
I$('af95373b1a04c3564c6d087f554eabb8',function(_e,_v,_u,_m,_h,_p,_o,_f,_r){if (_m._$KERNEL.engine==='trident'&&_m._$KERNEL.release<='5.0'){I$(19,function (){
		/**
		 * 节点占位符行为，高版本浏览器用样式处理
		 * @param  {String|Node} _element 节点
		 * @param  {String}      _clazz   样式
		 * @return {Void}
		 */
		_h.__setPlaceholder = (function(){
		    // placeholder flag
		    var _cache = {},
		        _ropt = {
		            nid:'j-holder-'+_u._$uniqueID()
		        };
		    // input foucs hide placeholder
		    var _onFocus = function(_id){
		        var _input = _e._$get(_id);
		        _cache[_id] = 2;
		        if (!!_input.value) return;
		        _e._$setStyle(
		            _e._$wrapInline(_input,_ropt),
		            'display','none'
		        );
		    };
		    // input blur check placeholder show
		    var _onBlur = function(_id){
		        var _input = _e._$get(_id);
		        _cache[_id] = 1;
		        if (!!_input.value) return;
		        _e._$setStyle(
		            _e._$wrapInline(_input,_ropt),
		            'display',''
		        );
		    };
		    // input value change
		    var _onInput = function(_id){
		        var _input = _e._$get(_id);
		        if (_cache[_id]==2) return;
		        _e._$setStyle(
		            _e._$wrapInline(_input,_ropt),
		            'display',!_input.value?'':'none'
		        );
		    };
		    // wrapper input control
		    var _doWrapInput = function(_input,_clazz){
		        var _id = _e._$id(_input),
		            _label = _e._$wrapInline(_input,{
		                tag:'label',
		                clazz:_clazz,
		                nid:_ropt.nid
		            });
		        _label.htmlFor = _id;
		        var _text = _e._$attr(_input,'placeholder')||'';
		        _label.innerText = _text=='null'?'':_text;
		        var _height = _input.offsetHeight+'px';
		        _e._$style(_label,{
		            left:0,
		            // width:_input.offsetWidth+'px',
		            // height:_height,lineHeight:_height,
		            display:!_input.value?'':'none'
		        });
		    };
		    return function(_input,_clazz){
                // has been placeholded
                if (_cache[_input.id]!=null)
                    return;
                _doWrapInput(_input,_clazz);
		        var _id = _input.id;
                _cache[_id] = 1;
                // listen blur and focus event
                _v._$addEvent(_input,'blur',_onBlur._$bind(null,_id));
                _v._$addEvent(_input,'focus',_onFocus._$bind(null,_id));
                _v._$addEvent(_input,'input',_onInput._$bind(null,_id));
                // IE9 set value hack
                if (_m._$KERNEL.engine == 'trident' && _m._$KERNEL.release == '5.0'){
                	_v._$addEvent(_input,'propertychange',_onInput._$bind(null,_id));
                }
        	};
		})();
    });}return _h;},'555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','345f1460138e362bb33cc48ffc7cd12b','f4c1e5168a8f0ff578680e2d426d3696');
I$('2360fd00cf6c2ecb0ebe304f5476e13e',function (NEJ,_e,_x,_h,_p,_o,_f,_r){
    /**
     * 输入框占位行为，高版本用placeholder属性和样式处理
     *
     * 样式设置占位符文字效果
     * ```css
     * input:-moz-placeholder{color:#aaa;font-style:italic;}
     * input::-ms-input-placeholder{color:#aaa;font-style:italic;}
     * input::-webkit-input-placeholder{color:#aaa;font-style:italic;}
     * .js-placeholder{color:#aaa;font-style:italic;}
     * ```
     *
     * 结构举例
     * ```html
     * <!-- 使用data-holder属性指定占位文字效果样式名称 -->
     * <input id="abc" type="text" placeholder="text content" data-holder="js-placeholder"/>
     * <textarea id="abc" placeholder="text content" data-holder="js-placeholder"></textarea>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/placeholder/placeholder'
     * ],function(_e){
     *     // 如果hover效果的样式名已经通过data-holder指定
     *     _e._$placeholder('abc');
     *     // 如果样式名没有通过data-holder指定，则可以通过参数输入
     *     // 当节点有data-holder指定样式名称，同时参数也输入样式名称，则优先使用data-holder指定的样式名
     *     _e._$placeholder('abc','js-placeholder');
     * });
     * ```
     *
     * @method module:util/placeholder/placeholder._$placeholder
     * @param  {String|Node} arg0 - 输入控件，如input、textarea
     * @param  {String}      arg1 - 占位样式名称，默认为js-placeholder
     * @return {Void}
     */
    /**
     * @method CHAINABLE._$placeholder
     * @see module:util/placeholder/placeholder._$placeholder
     */
    _p._$placeholder = function(_element,_clazz){
        _element = _e._$get(_element);
        _h.__setPlaceholder(_element,
            _e._$dataset(_element,'holder')
                ||_clazz||'js-placeholder');
    };
    // for chainable method
    _x._$merge(_p);

    if (CMPT){
        NEJ.copy(NEJ.P('nej.e'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','555a9eecaf26c5c01fe9db8d965bc30f','cefc834b106876d285d05b428248ca57','af95373b1a04c3564c6d087f554eabb8');
I$('01aaaf2eaba9d1f49d7a87d268c6be82',function (NEJ,_k,_e,_v,_u,_t,_t2,_t0,_t1,_p,_o,_f,_r,_pro){
    /**
     * WEB表单验证封装对象，HTML代码中支持以下属性配置：
     * 
     * | 名称 | 类型 | 说明 |
     * | :--- | :--- | :--- |
     * | data-focus-mode | 0/1                   | 聚焦模式，仅在form节点上设置，见_$focus |
     * | data-focus      | true/false            | 聚焦时检测提示信息，对于需验证的表单控件默认已支持此属性 |
     * | data-auto-focus | true/false            | 自动聚焦项，多个表单项设置了该属性仅第一项有效 |
     * | data-counter    | true/false            | 是否需要显示计数信息，必须同时设置data-max-length或者maxlength |
     * | data-ignore     | true/false            | 临时忽略失去焦点验证，可动态控制验证触发时机 |
     * | data-message    | String                | 验证出错提示信息，多个提示信息可以通过配置或者回调事件定制提示内容 |
     * | data-tip        | String                | 默认提示信息，正常输入状态时的提示信息 |
     * | data-required   | true/false            | 必填项，对于checkbox/radio的required表示必须选中 |
     * | data-type       | url/email/date/number | 输入内容预订类型格式匹配 |
     * | data-time       | String                | 格式：HH:mm:ss.ms，对于data-type为date类型的字段，取出日期值时设定时间为此值 |
     * | data-pattern    | RegExp                | 正则匹配表达式，字符串格式 |
     * | data-min        | String/Number         | 输入值必须大于此设置，适用于number/date型 |
     * | data-max        | String/Number         | 输入值必须小于此设置，适用于number/date型 |
     * | data-format     | String                | 规范date类型的格式，用/或者-来连接日期，用：来连接时间，至少应该有MM/dd/yyyy，默认值为yyyy-MM-dd，适用于date型(yyyy:年，MM:月，dd:日，HH:小时，mm:分钟,ss:秒) |
     * | data-max-length | Number                | 输入长度必须小于此设置，一个中文算两个字符，适用于text/textarea |
     * | data-min-length | Number                | 输入长度必须大于此设置，一个中文算两个字符，适用于text/textarea |
     * | maxlength       | Number                | 输入长度必须小于此设置，一个中文算一个字符，适用于text/textarea |
     * | minlength       | Number                | 输入长度必须大于此设置，一个中文算一个字符，适用于text/textarea |
     *
     * 结构举例
     * ```html
     * <!-- form节点添加data-focus-mode属性 -->
     * <form id="webForm" data-focus-mode="1">
     *   <!-- 必须设置值 -->
     *   <input name="n00" type="text" data-auto-focus="true" data-required="true" data-message="必须输入xxx！" data-tip="这是对xxx的说明！"/>
     *   <select name="n01" data-required="true" data-message="必须选择xxx！">
     *     <option>please select city</option>
     *     <option value="0">Hangzhou</option>
     *     <option value="1">Shanghai</option>
     *   </select>
     *   <input type="checkbox" data-required="true" data-message="必须同意xxx！"/>
     *   <input type="radio" data-required="true" data-message="必须选中xxx！"/>
     *   <!-- 输入URL地址、Email地址、日期、数字 -->
     *   <input name="n10" type="text" data-type="url" data-message="URL地址不合法！"/>
     *   <input name="n11" type="text" data-type="email" data-message="Email地址不合法！"/>
     *   <input name="n12" type="text" data-type="date" data-format="yyyy-MM-dd HH:mm:ss" data-message="日期格式不正确！"/>
     *   <input name="n12" type="text" data-type="number" data-message="只能输入数字！"/>
     *   <!-- 正则匹配输入信息，注意pattern值必须符合正则表达式规则 -->
     *   <input name="n20" type="text" data-pattern="^[\\d]+$" data-message="输入内容必须符合xxx！"/>
     *   <!-- 限制输入长度 -->
     *   <input name="n30" type="text" maxlength="100" data-message="长度超过限制！"/>
     *   <textarea name="n31" maxlength="100" data-message="长度超过限制！"></textarea>
     *   <input name="n32" type="text" data-max-length="100" data-message="长度超过限制！"/>
     *   <textarea name="n33" data-max-length="100" data-message="长度超过限制！"></textarea>
     *   <input name="n34" type="text" minlength="100" data-message="长度必须达到xxx！"/>
     *   <textarea name="n35" minlength="100" data-message="长度必须达到xxx！"></textarea>
     *   <input name="n36" type="text" data-min-length="100" data-message="长度必须达到xxx！"/>
     *   <textarea name="n37" data-min-length="100" data-message="长度必须达到xxx！"></textarea>
     *   <!-- 限制最小值/最大值 -->
     *   <input name="n40" type="text" data-type="number" data-min="10"/>
     *   <input name="n41" type="text" data-type="number" data-max="100"/>
     *   <input name="n42" type="text" data-type="number" data-min="10" data-max="100"/>
     *   <input name="n43" type="text" data-type="date" data-min="2010-08-10"/>
     *   <input name="n44" type="text" data-type="date" data-max="now"/>
     *   <input name="n45" type="text" data-type="date" data-min="now" data-max="2050-10-10"/>
     * </form>
     * ```
     *
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'util/form/form'
     * ],function(_t){
     *     // 分配表单验证控件实例
     *     var _form = _t._$$WebForm._$allocate({
     *         form:'webForm',
     *         message:{
     *             'password-1':'必须输入密码！',
     *             'password100':'密码强度不够',
     *             'password101':'两次密码不一致',
     *             'pass':'<span class="pass">ok</span>'
     *         }
     *     });
     *    
     *     // 验证表单后提交
     *     if (_form._$checkValidity()){
     *         _form._$submit();
     *     }
     *    
     *     // 或者在验证完表单的配置项后再做表单的其他项验证
     *     if (_form._$checkValidity()){
     *         // TODO other form check
     *         // 验证过程可以调用一下接口显示错误信息
     *         // _form._$showMsgError('n30','invalid message！');
     *         // 验证过程可以调用一下接口显示通过信息
     *         // _form._$showMsgPass('n31','ok！');
     *         _form._$submit();
     *         // 使用ajax请求的话可以通过_form._$data()获取表单信息
     *         doAjaxRequest('/api/form',_form._$data());
     *     }
     *    
     *     // 通过回调自定义提示信息示例代码：
     *     var _form = _t._$$WebForm._$allocate({
     *         form:'webForm',
     *         oninvalid:function(_event){
     *             // check _event.target and _event.code
     *             if (_event.target.name=='password'&&_event.code==-1){
     *                 // 通过设置_event.value设置提示信息
     *                 _event.value = '必须输入密码！';
     *             }
     *             // TODO other check
     *         },
     *         onvalid:function(_event){
     *             // 自定义验证通过提示信息，对应的节点信息_event.target
     *             _event.value = '<span class="pass">pass</span>'
     *         }
     *     });
     *     
     *     // 通过回调自定义验证规则示例代码：
     *     var _form = _t._$$WebForm._$allocate({
     *         form:'webForm',
     *         oncheck:function(_event){
     *             // check _event.target
     *             if (_event.target.name=='password'){
     *                 // 通过_event.value返回验证结果
     *                 // 验证结果必须大于0的值（保留所有小于0的返回值）
     *                 // 也可以返回对象，_event.value = {a:'aaaa',b:'bbbb'}; 
     *                 // 这里的a，b可以在oninvalid时输入的_event中取到
     *                 _event.value = doCheckPassword(_event.target.value); // 100
     *             }
     *             // TODO other check
     *         },
     *         oninvalid:function(_event){
     *             // check _event.target and _event.code
     *             if (_event.target.name=='password'&&_event.code==100){
     *                 // 通过设置_event.value设置提示信息
     *                 _event.value = '密码强度太弱！';
     *             }
     *             // TODO other check
     *         }
     *     });
     * });
     * ```
     *
     * @class    module:util/form/form._$$WebForm
     * @extends  module:util/event._$$EventTarget
     *
     * @param    {Object}      config  - 配置参数
     * @property {String|Node} form    - 表单节点
     * @property {String}      invalid - 验证未通过时添加在表单元素上的样式名称，默认为js-invalid
     * @property {String}      holder  - 如果有placeholder，则可以指定样式名称，默认为js-placeholder
     * @property {String}      focus   - 如果有聚焦效果，则可以通过指定该样式名称，默认为js-focus
     * @property {String}      tip     - 提示信息效果样式名称，默认为js-tip
     * @property {String}      pass    - 提示信息效果样式名称，默认为js-pass
     * @property {String}      error   - 提示信息效果样式名称，默认为js-error
     * @property {Object}      type    - 类型验证扩展，主要扩展data-type值的验证规则，{type:regexp,type:function}
     * @property {Object}      attr    - 验证属性扩展，主要扩展自定义data-xxx的验证规则，{xxx:function}
     * @property {Object}      message - 提示信息内容，{key:value}，
     *                                   错误信息key规则：节点名称+错误代码，
     *                                   如 'username-1':'必须输入用户名！'
     *                                   表示username输入框没有输入内容时错误提示信息为'必须输入用户名！'，
     *                                   默认错误信息key规则：节点名称+'-error'，如username-error，
     *                                   提示信息key规则：节点名称+'-tip'，如username-tip，
     *                                   成功信息key规则：节点名称+'-pass'，如username-pass，
     *                                   默认成功信息key：pass
     */
    /**
     * 对于无法通过配置验证的控件会回调外界辅助验证
     * 
     * @event    module:util/form/form._$$WebForm#oncheck
     * @param    {Object} event  - 验证基本信息
     * @property {Node}   target - 当前验证节点
     * @property {Node}   form   - 表单对象
     * @property {Number} value  - 验证返回结果
     */
    /**
     * 验证未通过触发事件，错误类型对照表
     * 
     * | 错误码 | 说明 |
     * | :---   | :--- |
     * | -1     | 必填项未填值 |
     * | -2     | 类型不匹配，如email, url类型 |
     * | -3     | 值不符合提供的规则 |
     * | -4     | 超过最大长度限制 |
     * | -5     | 未达到最小长度 |
     * | -6     | 未达到给定范围的最小值 |
     * | -7     | 超出给定范围的最大值 |
     * 
     * @event    module:util/form/form._$$WebForm#oninvalid
     * @param    {Object} event  - 验证基本信息
     * @property {Node}   target - 当前验证节点
     * @property {Number} code   - 错误标识
     */
    /**
     * 通过验证提示信息
     * 
     * @event    module:util/form/form._$$WebForm#onvalid
     * @param    {Object} event  - 验证基本信息
     * @property {Node}   target - 当前验证节点
     */
    /**
     * 回车触发事件
     * 
     * @event   module:util/form/form._$$WebForm#onenter
     * @param   {Event} event 事件信息
     */
    _p._$$WebForm = _k._$klass();
    _pro = _p._$$WebForm._$extend(_t._$$EventTarget);
    /**
     * 控件初始化
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__init
     * @return {Void}
     */
    _pro.__init = function(){
        this.__super();
        this.__wopt = {
            tp:{nid:'js-nej-tp'},
            ok:{nid:'js-nej-ok'},
            er:{nid:'js-nej-er'}
        };
    };
    /**
     * 控件重置
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__reset
     * @param  {Object} arg0 - 配置参数
     * @return {Void}
     */
    _pro.__reset = function(_options){
        this.__super(_options);
        this.__form = document.forms[_options.form]||
                     _e._$get(_options.form);
        this.__doInitDomEvent([[
            this.__form,'enter',
            this._$dispatchEvent._$bind(this,'onenter')
        ]]);
        this.__message = _options.message||{};
        this.__message.pass = this.__message.pass||'&nbsp;';
        // focus options
        var _mode = this.__dataset(
                    this.__form,'focusMode',1);
        if (!isNaN(_mode)){
            this.__fopt = {
                mode:_mode,
                clazz:_options.focus
            };
        }
        // save class name
        this.__holder = _options.holder;
        this.__wopt.tp.clazz = 'js-mhd '+(_options.tip||'js-tip');
        this.__wopt.ok.clazz = 'js-mhd '+(_options.pass||'js-pass');
        this.__wopt.er.clazz = 'js-mhd '+(_options.error||'js-error');
        this.__invalid = _options.invalid||'js-invalid';
        // init valid rule
        this.__doInitValidRule(_options);
        // refresh validate node
        this._$refresh();
        // auto focus node
        if (!!this.__fnode){
            this.__fnode.focus();
        }
    };
    /**
     * 控件销毁
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__destroy
     * @return {Void}
     */
    _pro.__destroy = function(){
        this.__super();
        this._$reset();
        delete this.__message;
        delete this.__fnode;
        delete this.__vinfo;
        delete this.__xattr;
        delete this.__form;
        delete this.__treg;
        delete this.__vfun;
    };
    /**
     * 取节点自定义数据值
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__dataset
     * @param  {String} arg0 - 自定义属性名
     * @param  {Number} arg1 - 类型，0-字符，1-数值，2-布尔，3-日期
     * @return {String}        值
     */
    _pro.__dataset = function(_node,_attr,_type){
        var _value = _e._$dataset(_node,_attr);
        switch(_type){
            case 1: return parseInt(_value,10);
            case 2: return (_value||'').toLowerCase()=='true';
            case 3: return this.__doParseDate(_value);
        }
        return _value;
    };
    /**
     * 根据类型转数值
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__number
     * @param  {String} arg0 - 值
     * @param  {String} arg1 - 类型
     * @return {Number}        数值
     */
    _pro.__number = function(_value,_type,_time){
        if (_type=='date'){
            return this.__doParseDate(_value,_time);
        }
        return parseInt(_value,10);
    };
    /**
     * 判断节点是否需要验证
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__isValidElement
     * @param  {Node}    arg0 - 节点
     * @return {Boolean}        是否需要验证
     */
    _pro.__isValidElement = (function(){
        var _reg1 = /^button|submit|reset|image|hidden|file$/i;
        return function(_node){
            // with name attr
            // not button
            _node = this._$get(_node)||_node;
            var _type = _node.type;
            return !!_node.name&&
                    !_reg1.test(_node.type||'');
        };
    })();
    /**
     * 判断节点是否需要验证
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__isValidElement
     * @param  {Node}    arg0 - 节点
     * @return {Boolean}        是否需要验证
     */
    _pro.__isValueElement = (function(){
        var _reg1 = /^hidden$/i;
        return function(_node){
            if (this.__isValidElement(_node))
                return !0;
            _node = this._$get(_node)||_node;
            var _type = _node.type||'';
            return _reg1.test(_type);
        };
    })();
    /**
     * 解析日期值
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doParseDate
     * @param  {String} arg0 - 日期字符串
     * @return {Number}        日期毫秒数
     */
    _pro.__doParseDate = (function(){
        var _reg0 = /[:\.]/;
        return function(_value,_time){
            if ((_value||'').toLowerCase()=='now')
                return +new Date;
            var _date = _u._$var2date(_value);
            if (!!_date&&!_reg0.test(_value)){
                // HH:mm:ss.ms
                var _arr = (_time||'').split(_reg0);
                _date.setHours(
                    parseInt(_arr[0],10)||0,
                    parseInt(_arr[1],10)||0,
                    parseInt(_arr[2],10)||0,
                    parseInt(_arr[3],10)||0
                );
            }
            return +_date;
        };
    })();
    /**
     * 解析字符类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckString
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckString = function(_id,_name){
        var _rule = this.__vfun[_name],
            _value = this.__dataset(_id,_name);
        if (!_value||!_rule) return;
        this.__doPushValidRule(_id,_rule);
        this.__doSaveValidInfo(_id,_name,_value);
    };
    /**
     * 解析正则类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckPattern
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckPattern = function(_id,_name){
        try{
            var _pattern = this.__dataset(_id,_name);
            if (!_pattern) return;
            var _value = new RegExp(_pattern);
            this.__doSaveValidInfo(_id,_name,_value);
            this.__doPushValidRule(_id,this.__vfun[_name]);
        }catch(e){
            // ignore exception
        }
    };
    /**
     * 解析布尔类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckBoolean
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckBoolean = function(_id,_name){
        var _rule = this.__vfun[_name];
        if (!!_rule&&this.__dataset(_id,_name,2)){
            this.__doPushValidRule(_id,_rule);
        }
    };
    /**
     * 解析数值类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckNumber
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @param  {String} arg2 - 规则值
     * @return {Void}
     */
    _pro.__doCheckNumber = function(_id,_name,_value){
        _value = parseInt(_value,10);
        if (isNaN(_value)) return;
        this.__doSaveValidInfo(_id,_name,_value);
        this.__doPushValidRule(_id,this.__vfun[_name]);
    };
    /**
     * 解析dataset中数值类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckDSNumber
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckDSNumber = function(_id,_name){
        this.__doCheckNumber(_id,_name,this.__dataset(_id,_name));
    };
    /**
     * 解析属性中数值类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckATNumber
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckATNumber = function(_id,_name){
        this.__doCheckNumber(_id,_name,_e._$attr(_id,_name));
    };
    /**
     * 解析dataset中数值类型规则属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckTPNumber
     * @param  {String} arg0 - 规则标识
     * @param  {String} arg1 - 规则属性
     * @return {Void}
     */
    _pro.__doCheckTPNumber = function(_id,_name,_type){
        var _value = this.__number(
                     this.__dataset(_id,_name),
                     this.__dataset(_id,'type'));
        this.__doCheckNumber(_id,_name,_value);
    };
    /**
     * 验证扩展属性
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckCustomAttr
     * @param  {String} arg0 - 规则标识
     * @return {Void}
     */
    _pro.__doCheckCustomAttr = function(_id){
        _u._$loop(
            this.__xattr,function(v,_name){
                var _value = _e._$dataset(_id,_name);
                if (_value!=null){
                    this.__doSaveValidInfo(_id,_name,_value);
                    this.__doPushValidRule(_id,this.__vfun[_name]);
                }
            },this
        );
    };
    /**
     * 准备表单元素验证信息
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doPrepareElement
     * @param  {Node} arg0 - 表单元素节点
     * @return {Void}
     */
    _pro.__doPrepareElement = (function(){
        var _reg0 = /^input|textarea$/i,
            _reg1 = /[:\.]/;
        // onfocus
        var _onFocus = function(_event){
            this._$showTip(_v._$getElement(_event));
        };
        // onblur
        var _onBlur = function(_event){
            var _node = _v._$getElement(_event);
            if (!this.__dataset(_node,'ignore',2)){
                this.__doCheckValidity(_node);
            }
        };
        return function(_node){
            // check auto focus node
            if (this.__dataset(
                      _node,'autoFocus',2))
                this.__fnode = _node;
            // check placeholder
            var _holder = _e._$attr(_node,'placeholder');
            if (!!_holder&&_holder!='null')
                _t1._$placeholder(_node,this.__holder);
            // check focus
            if (!!this.__fopt&&
                _reg0.test(_node.tagName))
                _t2._$focus(_node,this.__fopt);
            // check validate condition
            var _id = _e._$id(_node);
            // type check
            // pattern check
            // required check
            // max length
            // min length
            // cn max length
            // cn min length
            // min value check
            // max value check
            this.__doCheckBoolean(_id,'required');
            this.__doCheckString(_id,'type');
            this.__doCheckPattern(_id,'pattern');
            this.__doCheckATNumber(_id,'maxlength');
            this.__doCheckATNumber(_id,'minlength');
            this.__doCheckDSNumber(_id,'maxLength');
            this.__doCheckDSNumber(_id,'minLength');
            this.__doCheckTPNumber(_id,'min');
            this.__doCheckTPNumber(_id,'max');
            this.__doCheckCustomAttr(_id);
            // check date time
            var _time = _e._$dataset(_id,'time');
            if (!!_time){
                this.__doSaveValidInfo(_id,'time',_time);
            }
            // save message content
            var _name = _node.name;
            this.__message[_name+'-tip'] = this.__dataset(_node,'tip');
            this.__message[_name+'-error'] = this.__dataset(_node,'message');
            this._$showTip(_node);
            // node counter
            var _info = this.__vinfo[_id],
                _data = (_info||_o).data||_o,
                _need = this.__dataset(_node,'counter',2);
            if (_need&&(_data.maxlength||_data.maxLength)){
                _t0._$counter(_id,{nid:this.__wopt.tp.nid,clazz:'js-counter'});
            }
            // node need validate
            if (!!_info&&_reg0.test(_node.tagName)){
                this.__doInitDomEvent([
                    [_node,'focus',_onFocus._$bind(this)],
                    [_node,'blur',_onBlur._$bind(this)]
                ]);
            }else if(this.__dataset(_node,'focus',2)){
                this.__doInitDomEvent([
                    [_node,'focus',_onFocus._$bind(this)],
                ]);
            }
        };
    })();
    /**
     * 初始化验证规则
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doInitValidRule
     * @param  {Object} arg0 - 配置信息
     * @return {Void}
     */
    _pro.__doInitValidRule = (function(){
        // type regexp map
        var _rmap = {
                number:/^[\d]+$/i,
                // xxx://xx.xx.xx/a/b
                url:/^[a-z]+:\/\/(?:[\w-]+\.)+[a-z]{2,6}.*$/i,
                // xxx@xx.xx.xxx
                email:/^[\w-\.]+@(?:[\w-]+\.)+[a-z]{2,6}$/i,
                // xx-x-xx or xxxx-xx-x
                date:function(v,node){
                    var format = this.__dataset(node,'format')||'yyyy-MM-dd';
                    return !v||(!isNaN(this.__doParseDate(v)) && _u._$format(this.__doParseDate(v),format) == v);
                }
            };
        // validate function map
        var _vfun = {
            // value require for text
            // checked require for checkbox or radio
            required:function(_node){
                var _type = _node.type,
                    _novalue = !_node.value,
                    _nocheck = (_type=='checkbox'||
                                _type=='radio')&&!_node.checked;
                if (_nocheck||_novalue) return -1;
            },
            // type supported in _regmap
            type:function(_node,_options){
                var _reg = this.__treg[_options.type],
                    _val = _node.value.trim(),
                    _tested = !!_reg.test&&!_reg.test(_val),
                    _funced = _u._$isFunction(_reg)&&!_reg.call(this,_val,_node);
                if (_tested||_funced) return -2;
            },
            // pattern check
            pattern:function(_node,_options){
                if (!_options.pattern.test(_node.value))
                    return -3;
            },
            // maxlength check
            maxlength:function(_node,_options){
                if (_node.value.length>_options.maxlength)
                    return -4;
            },
            // minlength check
            minlength:function(_node,_options){
                if (_node.value.length<_options.minlength)
                    return -5;
            },
            // data-max-length check
            maxLength:function(_node,_options){
                if (_u._$length(_node.value)>_options.maxLength)
                    return -4;
            },
            // data-min-length check
            minLength:function(_node,_options){
                if (_u._$length(_node.value)<_options.minLength)
                    return -5;
            },
            // min value check
            min:function(_node,_options){
                var _number = this.__number(
                    _node.value,
                    _options.type,
                    _options.time
                );
                if (isNaN(_number)||
                   _number<_options.min)
                    return -6;
            },
            // max value check
            max:function(_node,_options){
                var _number = this.__number(
                    _node.value,
                    _options.type,
                    _options.time
                );
                if (isNaN(_number)||
                   _number>_options.max)
                    return -7;
            }
        };
        // merge extend
        var _doMerge = function(_smap,_new,_key,_dmap){
            var _old = _smap[_key];
            if (_u._$isFunction(_new)&&
                _u._$isFunction(_old)){
                _smap[_key] = _old._$aop(_new);
                return;
            }
            _smap[_key] = _new;
        };
        return function(_options){
            this.__treg = NEJ.X({},_rmap);
            _u._$loop(
                _options.type,
                _doMerge._$bind(null,this.__treg)
            );
            this.__vfun = NEJ.X({},_vfun);
            this.__xattr = _options.attr;
            _u._$loop(
                this.__xattr,
                _doMerge._$bind(null,this.__vfun)
            );
        };
    })();
    /**
     * 添加验证规则
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doPushValidRule
     * @param  {String}   arg0 - 规则标识
     * @param  {Function} arg1 - 验证规则
     * @return {Void}
     */
    _pro.__doPushValidRule = function(_id,_valid){
        if (!_u._$isFunction(_valid)) return;
        var _info = this.__vinfo[_id];
        if (!_info||!_info.func){
            _info = _info||{};
            _info.func = [];
            this.__vinfo[_id] = _info;
        }
        _info.func.push(_valid);
    };
    /**
     * 缓存验证信息
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doSaveValidInfo
     * @param  {String}   arg0 - 验证标识
     * @param  {String}   arg1 - 信息标识
     * @param  {Variable} arg2 - 信息内容
     * @return {Void}
     */
    _pro.__doSaveValidInfo = function(_id,_name,_value){
        if (!_name) return;
        var _info = this.__vinfo[_id];
        if (!_info||!_info.data){
            _info = _info||{};
            _info.data = {};
            this.__vinfo[_id] = _info;
        }
        _info.data[_name] = _value;
    };
    /**
     * 验证节点
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doCheckValidity
     * @param  {String|Node} arg0 - 节点
     * @return {Boolean}            是否通过验证
     */
    _pro.__doCheckValidity = function(_node){
        // check node validate
        _node = this._$get(_node)||_node;
        if (!_node){
            return !0;
        }
        // check validate information
        var _info = this.__vinfo[_e._$id(_node)];
        if (!_info&&this.__isValidElement(_node)){
            this.__doPrepareElement(_node);
            _info = this.__vinfo[_e._$id(_node)];
        }
        if (!_info){
            return !0;
        }
        var _result;
        // check condition
        _u._$forIn(_info.func,
            function(_func){
                _result = _func.call(this,_node,_info.data);
                return _result!=null;
            },this);
        // check custom validate
        if (_result==null){
            var _event = {target:_node,form:this.__form};
            this._$dispatchEvent('oncheck',_event);
            _result = _event.value;
        }
        // dispatch validate event
        var _event = {target:_node,form:this.__form};
        if (_result!=null){
            // merge oncheck result
            if (_u._$isObject(_result)){
                _u._$merge(_event,_result);
            }else{
                _event.code = _result;
            }
            this._$dispatchEvent('oninvalid',_event);
            if (!_event.stopped){
                this._$showMsgError(
                    _node,_event.value||
                    this.__message[_node.name+_result]
                );
            }
        }else{
            this._$dispatchEvent('onvalid',_event);
            if (!_event.stopped){
                this._$showMsgPass(_node,_event.value);
            }
        }
        return _result==null;
    };
    /**
     * 显示信息
     * 
     * @protected
     * @method module:util/form/form._$$WebForm#__doShowMessage
     * @param  {String|Node} arg0 - 表单元素节点
     * @param  {String}      arg1 - 显示信息
     * @param  {String}      arg2 - 信息类型
     * @return {Void}
     */
    _pro.__doShowMessage = (function(){
        var _kmap = {tp:'tip',ok:'pass',er:'error'};
        var _getVisible = function(_type1,_type2){
            return _type1==_type2?'block':'none';
        };
        var _getHolder = function(_node,_type,_message){
            var _holder = _getHolderNode.call(this,_node,_type);
            if (!_holder&&!!_message)
                _holder = _e._$wrapInline(_node,this.__wopt[_type]);
            return _holder;
        };
        var _getHolderNode = function(_node,_type){
            // try get node with id = xxx-tip or xxx-pass or xxx-error
            var _holder = _e._$get(_node.name+'-'+_kmap[_type]);
            if (!_holder)
                _holder = _e._$getByClassName(_node.parentNode,this.__wopt[_type].nid)[0];
            return _holder;
        };
        return function(_node,_message,_type){
            _node = this._$get(_node)||_node;
            if (!_node) return;
            _type=='er' ? _e._$addClassName(_node,this.__invalid)
                        : _e._$delClassName(_node,this.__invalid);
            // set message content
            var _holder = _getHolder.call(this,_node,_type,_message);
            if (!!_holder&&!!_message) _holder.innerHTML = _message;
            // show message node
            _u._$loop(this.__wopt,
                function(_value,_key){
                    _e._$setStyle(
                        _getHolderNode.call(this,_node,_key),
                        'display',_getVisible(_type,_key)
                    );
                },this);
        };
    })();
    /**
     * 显示提示信息
     * 
     * @method module:util/form/form._$$WebForm#_$showTip
     * @param  {String|Node} arg0 - 表单元素节点或者名称
     * @param  {String}      arg1 - 显示信息
     * @return {Void}
     */
    _pro._$showTip = function(_node,_message){
        this.__doShowMessage(
            _node,_message||
            this.__message[_node.name+'-tip'],'tp'
        );
    };
    /**
     * 显示验证通过信息
     * 
     * @method module:util/form/form._$$WebForm#_$showMsgPass
     * @param  {String|Node} arg0 - 表单元素节点或者名称
     * @param  {String}      arg1 - 显示信息
     * @return {Void}
     */
    _pro._$showMsgPass = function(_node,_message){
        this.__doShowMessage(
            _node,_message||
            this.__message[_node.name+'-pass']||
            this.__message.pass,'ok'
        );
    };
    /**
     * 显示错误信息
     * 
     * @method module:util/form/form._$$WebForm#_$showMsgError
     * @param  {String|Node} arg0 - 表单元素节点或者名称
     * @param  {String}      arg1 - 显示信息
     * @return {Void}
     */
    _pro._$showMsgError = function(_node,_message){
        this.__doShowMessage(_node,_message||
            this.__message[_node.name+'-error'],'er');
    };
    /**
     * 设置表单控件值
     * 
     * @method module:util/form/form._$$WebForm#_$setValue
     * @param  {String} arg0 - 表单控件名称
     * @param  {String} arg1 - 值
     * @return {Void}
     */
    _pro._$setValue = (function(){
        var _reg0 = /^(?:radio|checkbox)$/i;
        // get value
        var _getValue = function(_value){
            return _value==null?'':_value;
        };
        // set select value
        var _doSetSelect = function(_value,_node){
            // for multiple select
            if (!!_node.multiple){
                var _map;
                if (!_u._$isArray(_value)){
                    _map[_value] = _value;
                }else{
                    _map = _u._$array2object(_value);
                }
                _u._$forEach(
                    _node.options,function(_option){
                        _option.selected = _map[_option.value]!=null;
                    }
                );
            }else{
                _node.value = _getValue(_value);
            }
        };
        // set node value
        var _doSetValue = function(_value,_node){
            if (_reg0.test(_node.type||'')){
                // radio/checkbox
                _node.checked = _value==_node.value;
            }else if(_node.tagName=='SELECT'){
                // for select node
                _doSetSelect(_value,_node);
            }else{
                // other
                _node.value = _getValue(_value);
            }
        };
        return function(_name,_value){
            var _node = this._$get(_name);
            if (!_node) return;
            if(_node.tagName=='SELECT'||!_node.length){
                // for node
                _doSetValue(_value,_node);
            }else{
                // for node list
                _u._$forEach(
                    _node,
                    _doSetValue._$bind(null,_value)
                );
            }
        };
    })();
    /**
     * 取指定名称的表单控件对象
     * 
     * @method module:util/form/form._$$WebForm#_$get
     * @param  {String} arg0 - 控件名称
     * @return {Node}          表单控件对象
     */
    _pro._$get = function(_name){
        return this.__form.elements[_name];
    };
    /**
     * 取当前表单节点
     * 
     * @method module:util/form/form._$$WebForm#_$form
     * @return {Node} 当前封装的表单节点
     */
    _pro._$form = function(){
        return this.__form;
    };
    /**
     * 取表单数据
     * 
     * @method module:util/form/form._$$WebForm#_$data
     * @return {Object} 数据集合
     */
    _pro._$data = (function(){
        var _reg0 = /^radio|checkbox$/i,
            _reg1 = /^number|date$/;
        var _doDumpValue = function(_node){
            if (_node.tagName=='SELECT'&&!!_node.multiple){
                var _ret = [];
                _u._$forEach(
                    _node.options,function(_option){
                        if (_option.selected){
                            _ret.push(_option.value);
                        }
                    }
                );
                return _ret.length>0?_ret:'';
            }
            return _node.value;
        };
        var _doParseValue = function(_map,_node){
            var _name = _node.name,
                _value = _doDumpValue(_node),
                _info = _map[_name],
                _type = this.__dataset(_node,'type'),
                _time = _e._$dataset(_node,'time');
            // parse value
            if (_reg1.test(_type)){
                if (_u._$isArray(_value)){
                    _u._$forEach(
                        _value,function(v,i,l){
                            l[i] = this.__number(
                                v,_type,_time
                            );
                        },this
                    );
                }else{
                    _value = this.__number(
                        _value,_type,_time
                    );
                }
            }
            // checkbox and radio
            if (_reg0.test(_node.type)&&!_node.checked){
                _value = this.__dataset(_node,'value');
                if (!_value) return;
            }
            // if name exist
            if (!!_info){
                if (!_u._$isArray(_info)){
                    _info = [_info];
                    _map[_name] = _info;
                }
                _info.push(_value);
            }else{
                _map[_name] = _value;
            }
        };
        return function(){
            var _result = {};
            _u._$forEach(
                this.__form.elements,
                function(_node){
                    if (this.__isValueElement(_node)){
                        _doParseValue.call(this,_result,_node);
                    }
                },this);
            return _result;
        };
    })();
    /**
     * é‡ç½®è¡¨å•
     * 
     * @method module:util/form/form._$$WebForm#_$reset
     * @return {Void}
     */
    _pro._$reset = (function(){
        var _doShowTip = function(_node){
            if (this.__isValidElement(_node)){
                this._$showTip(_node);
            }
        };
        return function(){
            this.__form.reset();
            _u._$forEach(
                this.__form.elements,
                _doShowTip,this
            );
        };
    })();
    /**
     * æäº¤è¡¨å•
     * 
     * @method module:util/form/form._$$WebForm#_$submit
     * @return {Void}
     */
    _pro._$submit = function(){
        this.__form.submit();
    };
    /**
     * åˆ·æ–°éªŒè¯ä¿¡æ¯
     * 
     * @method module:util/form/form._$$WebForm#_$refresh
     * @return {Void}
     */
    _pro._$refresh = (function(){
        var _doPrepareElement = function(_node){
            if (this.__isValidElement(_node)){
                this.__doPrepareElement(_node);
            }
        };
        return function(){
            // id:{func:[],data:{}}
            // func  - validate function list
            // data  - validate information
            this.__vinfo = {};
            _u._$forEach(
                this.__form.elements,
                _doPrepareElement,this
            );
        };
    })();
    /**
     * éªŒè¯è¡¨å•æˆ–è€…è¡¨å•æŽ§ä»¶
     * 
     * @method module:util/form/form._$$WebForm#_$checkValidity
     * @param  {String|Node} arg0 - è¡¨å•æŽ§ä»¶ï¼Œæ²¡æœ‰è¾“å…¥è¡¨ç¤ºéªŒè¯æ•´ä¸ªè¡¨å•
     * @return {Boolean}            è¡¨å•æ˜¯å¦é€šè¿‡éªŒè¯
     */
    _pro._$checkValidity = function(_node){
        _node = this._$get(_node)||_node;
        // check single form element
        if (!!_node){
            return this.__doCheckValidity(_node);
        }
        // check all form elements
        var _result = !0;
        _u._$forEach(
            this.__form.elements,
            function(_node){
                var _pass = this._$checkValidity(_node);
                _result = _result&&_pass;
            },this);
        return _result;
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }

    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','b3c0f3ceba0c279f7e6de06836b8d2f0','fcee066722ba7afb04ca5e5584a6d4fc','0a895f78446ec2b0bf0923a32ce84598','2360fd00cf6c2ecb0ebe304f5476e13e');
I$('b47ae7454ac2cf24f0300f9704d9e347',function (_k, e, _m, modal, _p, _pro) {
    /**
     * æ¨¡å—
     * @class   {wd.m._$$ModuleResCreate}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  å¯é€‰é…ç½®å‚æ•°ï¼Œå·²å¤„ç†å‚æ•°åˆ—è¡¨å¦‚ä¸‹æ‰€ç¤º
     */
    _p._$$ModuleResBase = _k._$klass();
    _pro = _p._$$ModuleResBase._$extend(_m._$$Module);

    /**
     * éšè—å‰äº‹ä»¶
     * @param  {Objec} event
     * @return {Void}
     */
    _pro.__onBeforeHide = function (event) {
        if (!this.__submit && !this.__isSubmitting && JSON.stringify(this.__getSubmitOptions()) !== this.__initialData) {
            this.__stop(event);
            this.__leaveLayer = modal.confirm({
                "content": "æ‚¨ç¡®å®šè¦ç¦»å¼€åˆ›å»ºé¡µé¢å—ï¼Ÿæœªä¿å­˜æ•°æ®å°†ä¸ä¼šä¸ºæ‚¨ä¿å­˜ã€‚",
                'title': 'ç¦»å¼€æ­¤é¡µç¡®è®¤',
                'closeButton': true,
                "okButton": 'ç¦»å¼€',
                "cancelButton": true
            }).$on('ok', function () {
                this.__leaveLayer = this.__leaveLayer.destroy();
                this.__leaveLayer = null;
                this.__dispatcher._$redirect(
                    event.target.href, {
                        exitable: !0
                    }
                );
            }.bind(this));
        }
    }

    /**
     * ç¦ç”¨æˆ–æ¢å¤æŒ‰é’®
     * @param  {Node} btn
     * @param  {String} text - è®¾ç½®æŒ‰é’®æ–‡æœ¬
     * @param  {Boolean} disable - æ˜¯å¦ç¦ç”¨æŒ‰é’®
     * @return {Void}
     */
    _pro.__disableBtn = function (btn, text, disable) {
        btn.innerText = text;
        if (disable) {
            e._$addClassName(btn, 'u-btn-disabled');
            e._$attr(btn, 'disabled', 'disabled');
        } else {
            e._$delClassName(btn, 'u-btn-disabled');
            btn.removeAttribute('disabled');
        }
    }
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','c946055836c26441b9d60b589f2e1581','a17dfb1aca7e5bcf1c99411da2601159');
I$('940827d094d0536080d4e6493409c3f7',function (_k, _e, _v, _u, resBase, groupCache, modal, _f, userCache, caches, tagme, proCache, pgCache, select2, _modal, _tlCache, _inCache, _p, _pro) {
    /**
     * æ¨¡å—
     * @class   {wd.m._$$ModuleResCreate}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  å¯é€‰é…ç½®å‚æ•°ï¼Œå·²å¤„ç†å‚æ•°åˆ—è¡¨å¦‚ä¸‹æ‰€ç¤º
     */
    _p._$$ModuleResCreate = _k._$klass();
    _pro = _p._$$ModuleResCreate._$extend(resBase._$$ModuleResBase);

    /**
     * æ¨¡å—æž„å»º
     * @param  {Object} _options å­ç±»ä¼ ç»™çˆ¶ç±»çš„é…ç½®ä¿¡æ¯
     * ä¸‹é¢ä¸º_optionsçš„å±žæ€§ä¿¡æ¯
     * resType {String} å­ç±»èµ„æºç±»åž‹
     * listCache {String}  å­ç±»cacheKey
     * cacheName {String} å­ç±»cacheåç§°
     * callBackList {Array} cacheç›‘å¬çš„å›žè°ƒäº‹ä»¶
     * eventList {Array} éœ€æ³¨å†Œçš„è‡ªå®šä¹‰äº‹ä»¶
     */
    _pro.__doBuild = function (_options) {
        var defaultOptions = {
            resType: '',
            listCache: null,
            //å®žä¾‹åŒ–cacheå®žä¾‹åç§°
            cacheName: '',
            //æ˜¯å¦æœ‰ç§æœ‰æ¨¡å—ï¼ˆæ–°å»ºçš„ç§æœ‰æ¨¡å—å¼¹çª—ï¼‰
            hasPrivateFlag: true,
            //cacheç›‘å¬çš„å›žè°ƒäº‹ä»¶
            callBackList: ['onitemadd', 'onerror'],
            //å­ç±»cache å‚æ•°
            cacheOption: {},
            //æ¨¡å—ä¸­ç”¨åˆ°çš„ç§æœ‰æ¨¡å—
            inlineCreateList: [],
            //ä¼ è¿›doinitDomEvent çš„éœ€åˆå§‹åŒ–äº‹ä»¶çš„æ•°ç»„ï¼Œä¼ å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼Œæˆ–è€…é‡å†™çˆ¶ç±»å·²å®šä¹‰çš„æ–¹æ³•
            // ä¸¤ç§æ–¹å¼å¯å®šä¹‰å­ç±»çš„æ–¹æ³•æˆ–é‡å†™çˆ¶ç±»çš„æ–¹æ³•
            // 1. customEventFunc ä¼ å…¥ egï¼š customEventFunc[[
            //window, 'res-crud', this.__showResCrud.bind(this)
            //]]
            // 2. å­ç±»çš„doinitDomEventä¸­è‡ªå·±å®šä¹‰
            customEventFunc: [],
            //æ¨¡å—ä¸­æ˜¯å¦æœ‰ä¸šåŠ¡åˆ†ç»„
            hasGroup: true,
            //æ¨¡å—ä¸­æ˜¯å¦æœ‰è´Ÿè´£äºº
            hasRespo: true,
            //æ¨¡å—ä¸­æ˜¯å¦æœ‰æ ‡ç­¾
            hasTag: true,
            //æ¨¡å—æ˜¯å¦èƒ½å…±äº«åˆ°å…¬å…±èµ„æºåº“
            hasShare: true,
            //å­æ¨¡å—å¯åˆ›å»ºä¸ºç§æœ‰æ¨¡å—æ—¶ï¼Œdobuildæ—¶æ‰€ä¼ å‚æ•°
            config: null,
            //å®žä¾‹åŒ–å…¶ä»–æ‰€éœ€ç»„ä»¶ï¼ˆå‚æ•°ç¼–è¾‘å™¨ç­‰ç­‰ï¼‰
            allocateComponent: null,

        };
        this._subOpt = _u._$merge(defaultOptions, _options);
        if (this._subOpt.hasPrivateFlag) {
            this.__private = !!this._subOpt.config ? this._subOpt.config.private : false;
        }
        this.__form = _e._$getByClassName(this.__body, 'm-form')[0];
        this.__formGroup = _e._$getByClassName(this.__form, 'form-group');
        this.__submit = false;
        //å­ç±»cache实例参数
        this.__initCacheOption();

        //项目cache实例参数
        this.__initProCacheOption();

        // 用户cache
        this.__userCache = userCache._$$CacheUser._$allocate();
        this.__user = this.__userCache._$getUserInCache();
    };

    _pro.__onShow = function (_options) {
        //实例化子类 cache
        this[this._subOpt.cacheName] = caches[this._subOpt.listCache]._$allocate(this[this._subOpt.cacheName + 'Options']);
        this.__proCache = proCache._$$CachePro._$allocate(this.__proCacheOptions);
        if (this._subOpt.hasGroup) {
            //分组cache
            this.__groupCache = groupCache._$$CacheGroup._$allocate({
                onlistload: this.__renderGroupSelect.bind(this)
            });

        }
        ;
        this.__super(_options);
        // this.__storeInterval = setInterval(this.__setStorage.bind(this), 3000);
        // 返回按钮
        var btngoback = _e._$getByClassName(this.__body, 'goback')[0];
        if (this._subOpt.hasPrivateFlag) {
            //若是私有模块调用创建接口
            if (this.__private) {
                this.__done = _options.input.done;
                this._listCacheKeyPrivate = _options.input.listKey;
                //返回按钮
                _e._$addClassName(btngoback, 'f-dn');
            } else {
                _e._$delClassName(btngoback, 'f-dn');
                _e._$attr(btngoback, 'href', this.__referer || '/' + this._subOpt.resType + '/?pid=' + this.__pid);
            }
        }
        //设置返回按钮url
        var url = _options.referer ? new URL(_options.referer) : '';
        this.__referer = url ? url.pathname + url.search : '';
        _e._$attr(_e._$getByClassName(this.__body, 'goback')[0], 'href', this.__referer || '/' + this._subOpt.resType + '/?pid=' + this.__pid);


        this.__disableBtn(this.__formElem['save'], '保存', false);
        //事件绑定
        this.__addEvent();
    };


    _pro.__onRefresh = function (_options) {
        this.__pid = parseInt(_options.param.pid.replace('/', ''));
        this.__super(_options);
        this.__formElem = this.__form.elements;
        this._listCacheKey = this[this._subOpt.cacheName]._$getListKey(this.__pid);
        //获取保存数据并填入
        this.__dataStorge = window.localStorage.getItem(this._subOpt.resType) || null;
        this.__initDataFromStorge();
        // 表单组件
        this.__formObj = _f._$$WebForm._$allocate({
            form: this.__form
        });

        if (this._subOpt.hasTag) {
            //标签列表组件
            this.__tag = tagme._$$ModuleTagme._$allocate({
                parent: _e._$getByClassName(this.__form, 'tag')[0],
                searchCache: caches[this._subOpt.listCache],
                searchCacheKey: this._subOpt.listCache,
                searchResultFilter: function () {
                    return this[this._subOpt.cacheName]._$getTagList(this._subOpt.listCache);
                }.bind(this),
                preview: false,
                choseOnly: false,
                tags: this.__dataStorge && this.__dataStorge.tags ? this.__dataStorge.tags : [],
                done: function (result) {
                    if (!!result.change) {
                        this.__tags = result.tags;
                    }
                }.bind(this),
                queryData: {
                    pid: this.__pid
                }
            });
        }

        //实例化子类自定义组件
        if (this._subOpt.allocateComponent) {
            this._subOpt.allocateComponent();
        }
        this.__proCache._$getItem({
            id: this.__pid
        });
    };

    _pro.__onHide = function () {
        this.__super();
        this.__resetForm();
        this.__doClearDomEvent();
        this.__formObj._$reset();
        this.__formObj = this.__formObj._$recycle();
        if (!!this.__tag) {
            this.__tag = this.__tag._$recycle();
            this.__tags = [];
        }
        if (this._subOpt.hasGroup) {
            this.__group = null;
            //公共资源库里面是没有分组的
            this.__groupSelect = this.__groupSelect && this.__groupSelect.destroy();
        }
        if (this._subOpt.hasRespo) {
            this.__respo = null;
            this.__respoSelect = this.__respoSelect.destroy();
        }
        this.__referer = null;
        this.__submit = false;
        this.__storeInterval = clearInterval(this.__storeInterval);
        window.localStorage.removeItem(this._subOpt.resType);
    };

    /**
     *  根据storage 初始化数据
     */
    _pro.__initDataFromStorge = function () {
        if (!!this.__dataStorge) {
            this.__dataStorge = JSON.parse(this.__dataStorge);
            if (this._subOpt.hasTag) {
                this.__tags = this.__dataStorge.tags;
            }
            this.__doFillForm(this.__dataStorge);
        }
    };

    /**
     *  子类cache实例参数
     */
    _pro.__initCacheOption = function () {
        this[this._subOpt.cacheName + 'Options'] = {};
        _u._$forEach(this._subOpt.callBackList, function (item) {
            switch (item) {
                case 'onitemadd':
                    this[this._subOpt.cacheName + 'Options'].onitemadd = function (result) {
                        var list = this[this._subOpt.cacheName]._$getListInCache(this._listCacheKey);
                        if (this._subOpt.hasPrivateFlag) {
                            if (!this.__private) {
                                window.localStorage.removeItem(this._subOpt.resType);
                                dispatcher._$redirect('/' + this._subOpt.resType + '/detail/?pid=' + this.__pid + '&id=' + result.data.id);
                                this.__submit = false;
                            } else {
                                this.__done();
                            }
                        } else {
                            window.localStorage.removeItem(this._subOpt.resType);
                            dispatcher._$redirect('/' + this._subOpt.resType + '/detail/?pid=' + this.__pid + '&id=' + result.data.id);
                            this.__submit = false;
                        }
                    }.bind(this)
                    break;
                case 'onerror':
                    this[this._subOpt.cacheName + 'Options'].onerror = function () {
                        this.__submit = false;
                        this.__disableBtn(this.__formElem['save'], '保存', false);
                    }.bind(this)
                    break;
                default:
                    if (typeof(item) == 'object') {
                        this[this._subOpt.cacheName + 'Options'][item.name] = item.func;
                    }
                    break;
            }
        }.bind(this));
        //子类cache实例
        this[this._subOpt.cacheName + 'Options'] = _u._$merge(this[this._subOpt.cacheName + 'Options'], this._subOpt.cacheOption);

    };

    /**
     *  项目cache实例参数
     * @return {Void}
     */
    _pro.__initProCacheOption = function () {
        this.__proCacheOptions = {
            onitemload: function (result) {
                this.__project = this.__proCache._$getItemInCache(this.__pid);
                //新建时有分组
                if (this._subOpt.hasGroup) {
                    if (this._subOpt.hasShare) {
                        // 在公共资源库中不显示分组选项
                        var group = _e._$getByClassName(this.__form, 'form-group-group')[0];
                        if (this.__project.type === 1) {
                            _e._$addClassName(group, 'f-dn');
                        } else {
                            _e._$delClassName(group, 'f-dn');
                            //数据请求发送
                            this.__groupCache._$getList({
                                key: this.__groupCache._$getListKey(this.__pid),
                                data: {pid: this.__pid}
                            });
                        }
                    } else {
                        //数据请求发送
                        this.__groupCache._$getList({
                            key: this.__groupCache._$getListKey(this.__pid),
                            data: {pid: this.__pid}
                        });
                    }
                }
                //模块有负责人
                if (this._subOpt.hasRespo) {
                    //项目组cache
                    this.__pgCache = pgCache._$$CacheProGroup._$allocate({
                        onitemload: this.__renderRespoSelect.bind(this)
                    });
                    //请求项目组信息
                    this.__pgCache._$getItem({
                        id: this.__project.progroupId
                    });
                }
            }.bind(this)
        }
    };

    _pro.__addEvent = function () {
        var domEventList = [];
        //事件绑定
        domEventList.push([
            this.__formElem['save'], 'click', function () {
                // 延迟0秒是为了先拿到tag
                setTimeout(this.__handleSubmit._$bind(this), 0);
            }._$bind(this)
        ]);
        _u._$forEach(this._subOpt.inlineCreateList, function (item) {
            switch (item) {
                case 'group':
                    var group = _e._$getByClassName(this.__form, 'form-group-group')[0];
                    var gcBtn = _e._$getByClassName(group, 'create')[0];
                    domEventList.push([
                        groupCache._$$CacheGroup, 'add',
                        function (result) {
                            this.__groupSelect.$select(result.data);
                        }.bind(this)
                    ]);
                    if (this.__private) {
                        _e._$addClassName(gcBtn, 'f-dn');
                    } else {
                        domEventList.push([gcBtn, 'click', this.__inlineCreate.bind(this, 'group')]);
                    }
                    break;
                case 'template':
                    var template = _e._$getByClassName(this.__form, 'form-template')[0];
                    var tcBtn = _e._$getByClassName(template, 'create')[0]; //新建模版按钮
                    domEventList.push([tcBtn, 'click', this.__inlineCreate.bind(this, 'template')]
                        , [
                            _tlCache._$$CacheTemplate, 'add',
                            function (result) {
                                this.__updateTag('template', result.data);
                            }.bind(this)
                        ]);
                    break;
                case 'interface':
                    var interface = _e._$getByClassName(this.__form, 'form-interface')[0];
                    var icBtn = _e._$getByClassName(interface, 'create')[0]; //新建接口按钮
                    domEventList.push([icBtn, 'click', this.__inlineCreate.bind(this, 'interface')
                    ], [
                        _inCache._$$CacheInterface, 'add',
                        function (result) {
                            this.__updateTag('interface', result.data);
                        }.bind(this)
                    ]);
                    break;
                default:
                    break;
            }
        }.bind(this))
        if (!this.__private) {
            domEventList.push([window, 'beforeunload', this.__doBeforeUnload.bind(this)]);
        }
        //子类自定义事件
        if (this._subOpt.customEventFunc.length) {
            _u._$forEach(this._subOpt.customEventFunc, function (item2) {
                domEventList.push(item2);
            }.bind(this))
        }
        if (!domEventList.length) {
            return;
        }
        ;
        this.__doInitDomEvent(domEventList);

    };
    /**
     * 嵌套创建分组
     * @param {String} type 创建模块类型（不传的时候默认为分组）
     * @return {Void}
     */
    _pro.__inlineCreate = function (type, evt) {
        evt.stopPropagation();
        evt.preventDefault();
        var listKey;
        if (!type) {
            type = 'group';
        }
        switch (type) {
            case 'group':
                listKey = this.__groupCache._$getListKey(this.__pid);
                break;
            case 'template':
                listKey = this.__tlCache._$getListKey(this.__pid);
                break;
            case 'interface':
                listKey = this.__inCache._$getListKey(this.__pid);
                break;
            default:
                break;
        }
        var modal = new _modal({
            data: {
                "content": '',
                "title": ' ',
                "class": 'inline-create',
                "okButton": false,
                "cancelButton": false,
                'closeButton': true
            }
        }).$on('close', function () {
            dispatcher._$hide("/?/progroup/p/res/" + type + "/create/");
            modal.destroy();
        });
        dispatcher._$redirect("/?/progroup/p/res/" + type + "/create/?pid=" + this.__pid, {
            input: {
                listKey: listKey,
                parent: modal.$refs.modalbd,

                done: function () {
                    dispatcher._$hide("/?/progroup/p/res/" + type + "/create/");
                    modal.destroy();
                }.bind(this)
            }
        });
    }

    /**
     * 处理表单提交事件
     * @return {Void}
     */
    _pro.__handleSubmit = function () {
        if (this.__submit) {
            return;
        }
        if (this.__formObj._$checkValidity()) {
            this.__disableBtn(this.__formElem['save'], '提交中...', true);
            this.__submit = true;
            this[this._subOpt.cacheName]._$addItem({
                //如果是私有模块，则使用私有模块传进的listkey
                key: this.__private ? this._listCacheKeyPrivate : this._listCacheKey,
                data: this.__getSubmitOptions(),
                ext: {type: this.__private ? 'private' : 'public'}
            });
            _v._$clearEvent(window, "beforeunload");
        }
    }

    /**
     * 配置负责人选择
     * @return {Void}
     */
    _pro.__renderRespoSelect = function () {
        this.__respoSelect = new select2({
            data: {
                source: this.__pgCache._$getRespoSelectSource(this.__project.progroupId)
            }
        });
        // 设置默认选中项
        if (!!this.__dataStorge && this.__dataStorge.respo) {
            this.__respoSelect.$select(this.__dataStorge.respo);
            this.__respo = this.__dataStorge.respo;
        } else {
            this.__respoSelect.$select(this.__user);
            this.__respo = this.__user;
        }
        // 获取当前选中项
        this.__respoSelect.$inject(_e._$getByClassName(this.__form, 'respo')[0])
            .$on('change', function (result) {
                this.__respo = result.selected;
            }.bind(this));
        // 此时页面加载结束,保存当前表单数据,用来和离开前的数据比较以控制弹框提示。
        this.__initialData = JSON.stringify(this.__getSubmitOptions());
    }

    /**
     * 添加beforeunload执行逻辑
     * @return {Void}
     */
    _pro.__doBeforeUnload = function (evt) {
        evt.preventDefault();
        if (!this.__submit && JSON.stringify(this.__getSubmitOptions()) !== this.__initialData) {
            evt.returnValue = '确认离开吗？';
            this.__storeInterval = clearInterval(this.__storeInterval);
            window.localStorage.removeItem(this._subOpt.resType);
            setTimeout(function () {
                this.__storeInterval = setInterval(this.__setStorage.bind(this), 30000);
            }.bind(this), 0);
        }
    }

    /**
     * 配置业务分组选择
     * @return {Void}
     */
    _pro.__renderGroupSelect = function () {
        var groups = this.__groupCache._$getGroupSelectSource(this.__pid);
        this.__groupSelect = new select2({
            data: {
                source: groups
            }
        });
        this.__group = groups[0];
        if (!!this.__dataStorge && this.__dataStorge.group) {
            this.__groupSelect.$select(this.__dataStorge.group);
            this.__group = this.__dataStorge.group;
        }
        this.__groupSelect.$inject(_e._$getByClassName(this.__form, 'groups')[0])
            .$on('change', function (result) {
                this.__group = result.selected;
            }.bind(this));
    }

    _pro.__formReset = function () {
        this.__formObj && this.__formObj._$reset();
        var ipts = this.__form.getElementsByTagName('input');
        var textareas = this.__form.getElementsByTagName('textarea');
        if (ipts && ipts.length) {
            _u._$forEach(ipts, function (item) {
                item.value = '';
                item.defaultValue = '';
            });
        }
        if (textareas && textareas.length) {
            _u._$forEach(textareas, function (item) {
                item.value = '';
                item.innerHTML = '';
                item.defaultValue = '';
            });
        }
    };

},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','b47ae7454ac2cf24f0300f9704d9e347','7c1169d958213d2faeb6056f33ac4ad6','a17dfb1aca7e5bcf1c99411da2601159','01aaaf2eaba9d1f49d7a87d268c6be82','29f4b2dc96ca931edfeb9264ffe3e954','18fdbc27498bb1c4312201f146717dc0','ac756f830dd7d5bd7642918e731ed189','09437bf7199eb808a35a38e5178e5151','e8507450a35f1adad6e9dae810fd545a','e26ac58445dd3bc2b730e5275fb45f6f','a17dfb1aca7e5bcf1c99411da2601159','cc04b9f6ed49f9ff59e36f80707cf153','7385ee68edde0ba303fb20b28ecfb227');
I$('47b5f05a575f2bc1b896c615501ae1ab',function (k, e, $, l, jst, baseModule, util, dataTypeCache, interfaceCache, pageCache, templateCache, constraintCache, proCache, pgCache, stripedList, p, pro) {

    p._$$ResRefModule = k._$klass();
    pro = p._$$ResRefModule._$extend(baseModule._$$Module);

    pro.__doBuild = function () {
        this.__body = e._$html2node(
            l._$getTextTemplate(this.__bodyTemplateId)
        );
        this._cacheOptions = {
            onitemload: function (evt) {
                // 单个资源的详情, 顶部需要显示名称、描述等信息
                var resData = this._cache._$getItemInCache(this.__id);
                var titleEl = $(this.__body)._$getByClassName('d-title')[0];
                jst._$render(titleEl, this.__detailTemplateId, resData);
            }.bind(this),
            onreflistload: this._renderRefList.bind(this)
        }
        this._listContainer = e._$getByClassName(this.__body, 'list-content')[0];
        this.stripedListHeaders = [
            {
                name: '名称',
                key: 'name',
                keyPinyin: 'namePinyin'
            },
            {
                name: '摘要',
                key: 'description'
            },
            {
                name: '地址',
                key: 'path'
            },
            {
                name: '项目',
                key: 'projectName'
            },
            {
                name: '负责人',
                key: 'respo.realname',
                keyPinyin: 'respo.realnamePinyin',
                valueType: 'deepKey'
            },
            {
                name: '创建者',
                key: 'creator.realname',
                keyPinyin: 'creator.realnamePinyin',
                valueType: 'deepKey'
            },
            {
                name: '',
                key: '__nei-actions',
                valueType: '__nei-actions'
            }
        ];
        this.stripedListOptions = {
            parent: this._listContainer,
            filter: this._$setRefListDetailHref.bind(this),
            headers: null,
            defaultSortKey: 'createTime',
            hasSearchBox: true
        };
        this.stripedList = null;
        this.__super();
    };

    pro.__onRefresh = function (_options) {
        this.__pid = parseInt((_options.param.pid || '').replace('/', ''));
        this.__id = parseInt(_options.param.id.replace('/', ''));
        this.__super(_options);
        // 获取当前资源的详情
        this._cache._$getItem({
            id: this.__id
        });
        // 获取当前资源的引用列表
        this._cache._$getRefList({
            id: this.__id,
            action: 'ref'
        });
    };

    pro.__onHide = function () {
        this.__super();
        this.stripedList = this.stripedList._$recycle();
        this._cache = this._cache._$recycle();
        this._listContainer.innerHTML = '';
    };

    pro.__onShow = function (options) {
        this._cache = this._cacheKlass._$allocate(this._cacheOptions);
        this.__super(options);
    };

    pro._renderRefList = function () {
        // 实例化 cache
        var dc = dataTypeCache._$$CacheDatatype._$allocate();
        var ic = interfaceCache._$$CacheInterface._$allocate();
        var pc = pageCache._$$CachePage._$allocate();
        var tc = templateCache._$$CacheTemplate._$allocate();
        var cc = constraintCache._$$CacheConstraint._$allocate();
        var proc = proCache._$$CachePro._$allocate();
        var progc = pgCache._$$CacheProGroup._$allocate();

        var refListCacheKey = this._cacheModule._$cacheKeyRef + this.__id;
        // 引用当前资源的数据模型引用列表
        var datatypeRefList = dc._$getListInCache(refListCacheKey).filter(function (dt) {
            // 匿名数据模型不展示
            return dt.type !== util.db.MDL_TYP_HIDDEN;
        });
        // 引用当前资源的接口引用列表
        var interfaceRefList = ic._$getListInCache(refListCacheKey);
        // 引用当前资源的页面引用列表
        var pageRefList = pc._$getListInCache(refListCacheKey);
        // 引用当前资源的模板引用列表
        var templateRefList = tc._$getListInCache(refListCacheKey);
        // 引用当前资源的规则函数引用列表
        var constraintRefList = cc._$getListInCache(refListCacheKey);
        // 引用当前资源的项目引用列表
        var proRefList = proc._$getListInCache(refListCacheKey);
        // 引用当前资源的项目组引用列表
        var progRefList = progc._$getListInCache(refListCacheKey);
        this.stripedListOptions.customGroups = [];
        this.stripedListOptions.customGroups.push({
            name: '异步接口',
            xlist: interfaceRefList,
            type: util.db.RES_TYP_INTERFACE
        });
        interfaceRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_INTERFACE;
        });
        this.stripedListOptions.customGroups.push({
            name: '页面',
            xlist: pageRefList,
            type: util.db.RES_TYP_WEBVIEW
        });
        pageRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_WEBVIEW;
        });
        this.stripedListOptions.customGroups.push({
            name: '页面模板',
            xlist: templateRefList,
            type: util.db.RES_TYP_TEMPLATE
        });
        templateRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_TEMPLATE;
        });
        this.stripedListOptions.customGroups.push({
            name: '数据模型',
            xlist: datatypeRefList,
            type: util.db.RES_TYP_DATATYPE
        });
        datatypeRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_DATATYPE;
        });

        this.stripedListOptions.customGroups.push({
            name: '规则函数',
            xlist: constraintRefList,
            type: util.db.RES_TYP_CONSTRAINT
        });
        constraintRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_CONSTRAINT;
        });

        this.stripedListOptions.customGroups.push({
            name: '项目',
            xlist: proRefList,
            type: util.db.RES_TYP_PROJECT
        });
        proRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_PROJECT;
        });
        this.stripedListOptions.customGroups.push({
            name: '项目组',
            xlist: progRefList,
            type: util.db.RES_TYP_PROGROUP
        });
        progRefList.forEach(function (item) {
            item.__resType = util.db.RES_TYP_PROGROUP;
        });

        this._resTypeMap = {};
        this._resTypeMap[util.db.RES_TYP_INTERFACE] = 'interface';
        this._resTypeMap[util.db.RES_TYP_WEBVIEW] = 'page';
        this._resTypeMap[util.db.RES_TYP_TEMPLATE] = 'template';
        this._resTypeMap[util.db.RES_TYP_DATATYPE] = 'datatype';
        this._resTypeMap[util.db.RES_TYP_CONSTRAINT] = 'constraint';
        this._resTypeMap[util.db.RES_TYP_PROJECT] = 'project';
        this._resTypeMap[util.db.RES_TYP_PROGROUP] = 'progroup';

        this.stripedListOptions.xlist = interfaceRefList.concat(
            pageRefList, templateRefList, datatypeRefList,constraintRefList, proRefList, progRefList
        );

        this.stripedListOptions.headers = this.stripedListHeaders.concat();
        if (this._refType === 'spec') {
            // 规范引用列表中没有 地址 和 负责人
            this.stripedListOptions.headers.splice(2, 2);
        };
        //增加项目名称显示字段
        //规范的引用和其它资源的引用数据返回格式不一致，前端做个特殊处理
        this.stripedListOptions.xlist.forEach(function (item) {
            //规范资源是没有项目id的
            if(!item.projectId){
                item.projectName = item.name;
            } else {
                item.projectName = proc._$getItemInCache(item.projectId).name;
            }
        });
        this.stripedList = stripedList._$$ModuleStripedList._$allocate(this.stripedListOptions);
    };

    pro._$setRefListDetailHref = function (list, listStates) {
        list.forEach(function (item) {
            var itemState = listStates[item.id];
            var str = '';
            // 查看详情
            if (this._resTypeMap[item.__resType] === 'project') {
                str += '<a href="/' + this._resTypeMap[item.__resType] + '/detail/?pid=' + item.id + '" title="查看详情" class="stateful"><em class="u-icon-detail-normal"></em></a>';
            } else if (this._resTypeMap[item.__resType] === 'progroup') {
                str += '<a href="/' + this._resTypeMap[item.__resType] + '/detail/?pgid=' + item.id + '" title="查看详情" class="stateful"><em class="u-icon-detail-normal"></em></a>';
            } else {
                str += '<a href="/' + this._resTypeMap[item.__resType] + '/detail/?pid=' + item.projectId + '&id=' + item.id + '" title="查看详情" class="stateful"><em class="u-icon-detail-normal"></em></a>';
            }
            //   delete this._resTypeMap[item.__resType];
            itemState['__nei-actions'] = str;
        }.bind(this));
        return list;
    };

    p._$regist = baseModule._$regist;
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','ac1e584495dcf57f8a3472dfeddbf19b','356c13c039fe43b0aa515c031d53f736','1b12378d868a5877d4dba65367942b75','c946055836c26441b9d60b589f2e1581','8cbc286a7834dfcf29c8f7a018e77c02','afd9bc71d3ea5904e51ae183b2351b6e','7385ee68edde0ba303fb20b28ecfb227','8c66819555c8938ee8838636d552569a','cc04b9f6ed49f9ff59e36f80707cf153','7f69de0f0fa6d9d6f0b6273610f4c7c5','09437bf7199eb808a35a38e5178e5151','e8507450a35f1adad6e9dae810fd545a','645b07d1227cb7ffbb51604bdde81b34');
I$('1e151a44b3e780a3b3e73698282e930d',"<div class=\"p-bind-layer\">\n    <div class=\"p-bind-layer-con\">\n        <div class=\"b-ipt-wrap\">\n            {#if type == \"unbind\"}\n            <div class=\"b-ipt-row\">{message}</div>\n            {#else}\n            <div class=\"b-ipt-row\">\n                <input class=\"u-ipt\" placeholder={placeholder} value={value} r-model={value} r-class={{\"js-error\":valueError}}\n                       on-focus={this.removeError('value')}/>\n            </div>\n            {/if}\n            <div class=\"b-ipt-row\">\n                <input class=\"u-ipt\" placeholder=\"请输入验证码\" value={code} r-model={code}\n                       on-focus={this.removeError('code')} r-class={{\"js-error\":codeError}} />\n                <input type=\"button\" class=\"u-code-btn\" value=\"发送验证码\" r-class={{'js-disabled':sendDisabled}}\n                       on-click={this.sendcode()} ref=\"btn\"/>\n            </div>\n        </div>\n        <div class=\"u-submit\" on-click={this.submit()}>提交</div>\n    </div>\n</div>");
I$('3ee74acb6ee1cbcb6b2ce0484e415391',".p-bind-layer{\n\ttext-align:center;\n\tfont-size:14px;\n}\n.p-bind-layer .p-bind-layer-con{\n\tmargin:0 50px;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row{\n\tdisplay:flex;\n\tmargin-bottom:10px;\n\twhite-space:normal;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row .u-ipt{\n\tbox-sizing:border-box;\n\theight:30px;\n\tline-height:30px;\n\tflex:1;\n\tfont-size:14px;\n\tcolor:#222;\n\tpadding:0 10px;\n\tborder:1px solid #999;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row .u-code-btn{\n\tborder:none;\n\tbox-sizing:border-box;\n\tbackground-color:#30a1f2;\n\tcolor:#fff;\n\twidth:100px;\n\theight:30px;\n\tline-height:30px;\n\tmargin-left:10px;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row .u-code-btn:hover{\n\tcursor:pointer;\n\tbackground-color:#2b91d9;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row .js-error{\n\tborder-color:#f00;\n}\n.p-bind-layer .p-bind-layer-con .b-ipt-row .js-disabled{\n\tbackground-color:#2b91d9;\n}\n.p-bind-layer .p-bind-layer-con .u-submit{\n\tmargin-top:20px;\n\theight:40px;\n\tline-height:40px;\n\tbackground-color:#30a1f2;\n\tcolor:#fff;\n}\n.p-bind-layer .p-bind-layer-con .u-submit:hover{\n\tcursor:pointer;\n\tbackground-color:#2b91d9;\n}\n.p-bind-layer .u-tip-btn{\n\tfont-size:16px;\n\tcolor:#999;\n\tmargin-top:10px;\n}\n.p-bind-layer .u-tip-btn .u-tip-resubmit{\n\tcolor:#30a1f2;\n\tmargin-left:20px;\n}");
I$('c7f5c711995a67b1edd58576a22e35ce',function (_e, _Modal, _, _usrCache, _db, _html, _css) {
    _e._$addStyle(_css);
    var PBindLayer = _Modal.extend({
        config: function () {
            _._$extend(this.data, {
                "contentTemplate": _html,
                'title': (this.data.type == 'bind' ? '绑定' : '解绑') + ( this.data.key == 'email' ? '邮箱' : '手机'),
                'closeButton': true,
                "okButton": false,
                "cancelButton": false,
                timer: 60,
                valueError: false,
                codeError: false,
                code: '',
                message: '验证码将发送到您' + this.data.value + '的' + (this.data.key == 'email' ? '邮箱里' : '手机上'),
                placeholder: '请输入' + (this.data.key == 'email' ? '邮箱地址' : '手机号码'),
                sendDisabled: false
            });
            this.supr(this.data);
            this.$on('close', function () {
                this.cancel();
            });
        },
        sendcode: function () {//发送验证码
            var data = {
                ext: {
                    onerror: this.onerror.bind(this, 'value')
                }
            };
            if (this.data.type == 'bind') {//发送绑定验证码
                if (this.data.key == 'email')
                    data.email = this.data.value;
                else
                    data.phone = this.data.value;
                this.data.cache._$bind(data);
            } else {//发送解绑验证码
                if (this.data.key == 'email')
                    data = {isEmail: _db.CMN_BOL_YES};
                else
                    data = {isPhone: true};
                this.data.cache._$unbind(data);
            }
            this.data.sendDisabled = true;
            // this.$refs.btn.value = this.data.timer + 's后重新发送';
            this.$refs.btn.disabled = true;
            this.data.interval = window.setInterval(this.checkDisable.bind(this), 1000);
        },

        submit: function () { //检查验证码正确性
            this.checkValidate();
            if (!this.data.codeError && !this.data.valueError) {
                this.data.cache._$verify({
                    code: this.data.code,
                    ext: {
                        onerror: this.onerror.bind(this, 'code')
                    }
                });
            }
        },
        checkDisable: function () {
            if (this.data.timer == 0) {
                this.data.sendDisabled = false;
                window.clearInterval(this.data.interval);
                this.data.timer = 60;
                this.$refs.btn.disabled = false;
                this.$refs.btn.value = '发送验证码';
            } else {
                this.$refs.btn.value = --this.data.timer + 's后重新发送';
            }
        },
        cancel: function () {
            if (this.data.interval) {
                window.clearInterval(this.data.interval);
            }
            this.supr();
        },
        onerror: function (type, errType) {
            if (type == 'code') {
                this.data.codeError = true;
            } else {
                if (errType == 1) {
                    this.data.valueError = true;
                }
                this.data.timer = 0;
                this.checkDisable();
            }
            this.$update();
        },
        checkValidate: function () {
            if (this.data.key == 'email') {
                this.data.valueError = !/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(this.data.value);
            } else {
                this.data.valueError = !/^1\d{10}$/.test(this.data.value);
            }
            if (this.data.code == '') {
                this.data.codeError = true;
            }

        },
        removeError: function (type) {
            if (type == 'code') {
                this.data.codeError = false;
            } else {
                this.data.valueError = false;
            }
        }
    });
    return PBindLayer;
},'555a9eecaf26c5c01fe9db8d965bc30f','a17dfb1aca7e5bcf1c99411da2601159','8cbc286a7834dfcf29c8f7a018e77c02','29f4b2dc96ca931edfeb9264ffe3e954','993671841dcf289096c7171d53130309','1e151a44b3e780a3b3e73698282e930d','3ee74acb6ee1cbcb6b2ce0484e415391');
I$('8f5afc88b105382ed0f9d71bbf54195d',"<div class=\"u-lt-select u-lt-select-{type}\" ref=\"element\">\n    {#if type=='see'}\n    <div>\n        <label class=\"label\">实现语言：</label>\n        <span>{language}</span>\n        {#if isWeb}\n        <label class=\"label\">模板引擎：</label>\n        <span>{engine}</span>\n        <label class=\"label\">模板扩展名：</label>\n        <span>{viewExtension}</span>\n        {/if}\n    </div>\n    {#else}\n    <div class=\"item\">\n        <label class=\"label\">实现语言：</label>\n        <select2 source={language} on-change={this.selectChange($event,0)} selected={lselected} sortList={false}\n                 initSilent={initSilent1} preview={preview} editable={editable} ref=\"language\"></select2>\n    </div>\n    {#if isWeb}\n    <div class=\"item\">\n        <label class=\"label\">模板引擎：</label>\n        <select2 source={engine} on-change={this.selectChange($event,1)} selected={eselected} sortList={false}\n                 initSilent={initSilent2} preview={preview} editable={editable} ref=\"engine\"></select2>\n    </div>\n    <div class=\"item\">\n        <label class=\"label\">模板扩展名：</label>\n        <input class=\"u-ext\" on-change={this.inputChange($event)} ref=\"extension\" {#if type==\"see\"}readonly{/if}\n               value={viewExtension}/>\n    </div>\n    {/if}\n    {/if}\n</div>");
I$('3627917a85004371ddfad724484b885c',function (_v, _u, _e, _re, _select2, _, _html, _db) {
    var langOpt = [{
        id: _db.SPC_LNG_JAVA,
        name: 'Java',
        engines: [{
            id: _db.SPC_ENG_FREEMARK,
            name: 'Freemarker',
            viewExtension: 'ftl'
        }, {
            id: _db.SPC_ENG_VELOCITY,
            name: 'Velocity',
            viewExtension: 'vm'
        }, {
            id: _db.SPC_ENG_NONE,
            name: '无',
            viewExtension: ''
        }]
    }, {
        id: _db.SPC_LNG_NODE,
        name: 'Node.js',
        engines: [{
            id: _db.SPC_ENG_EJS,
            name: 'EJS',
            viewExtension: 'ejs'
        }, {
            id: _db.SPC_ENG_SWIG,
            name: 'Swig',
            viewExtension: 'html'
        }, {
            id: _db.SPC_ENG_NONE,
            name: '无',
            viewExtension: ''
        }]
    }, {
        id: _db.SPC_LNG_PHP,
        name: 'PHP',
        engines: [{
            id: _db.SPC_ENG_SMARTY,
            name: 'Smarty',
            viewExtension: 'tpl'
        }, {
            id: _db.SPC_ENG_NONE,
            name: '无',
            viewExtension: ''
        }]
    }, {
        id: _db.SPC_LNG_SWIFT,
        name: 'Swift',
        engines: []
    }, {
        id: _db.SPC_LNG_OC,
        name: 'Objective-C',
        engines: []
    }, {
        id: _db.SPC_LNG_UNKNOWN,
        name: '其他',
        engines: [{
            id: _db.SPC_ENG_NONE,
            name: '无',
            viewExtension: ''
        }]
    }];
    var webLanguages = [_db.SPC_LNG_JAVA, _db.SPC_LNG_NODE, _db.SPC_LNG_PHP, _db.SPC_LNG_UNKNOWN];
    var iosLanguages = [_db.SPC_LNG_SWIFT, _db.SPC_LNG_OC, _db.SPC_LNG_UNKNOWN];
    var aosLanguages = [_db.SPC_LNG_JAVA, _db.SPC_LNG_UNKNOWN];
    var testLanguages = [_db.SPC_LNG_JAVA, _db.SPC_LNG_NODE, _db.SPC_LNG_PHP, _db.SPC_LNG_UNKNOWN];
    var getLanguage = function (type) {
        var obj = [], source = [];
        switch (type) {
            case 'web':
            case _db.CMN_TYP_WEB:
                obj = webLanguages;
                break;
            case 'ios':
            case _db.CMN_TYP_IOS:
                obj = iosLanguages;
                break;
            case 'aos':
            case _db.CMN_TYP_AOS:
                obj = aosLanguages;
                break;
            case 'test':
            case _db.CMN_TYP_TEST:
                obj = testLanguages;
                break;
            default:
                break;
        }
        obj.forEach(function (item) {
            var ob = langOpt.find(function (item2) {
                return item2.id == item;
            });
            if (ob) {
                source.push(ob);
            }
        });
        return source;
    };
    var LESelect = _re.extend({
        name: 'leselect',
        template: _html,
        config: function () {
            var isWeb = this.data.specType == 'web' || this.data.specType == _db.CMN_TYP_WEB;
            //根据语言和模板id设置参数
            if (this.data.type == 'see') {
                var language = this.findById(langOpt, this.data.lid);
                var engine;
                if (isWeb) {
                    engine = this.findById(language.engines, this.data.eid);
                }
                this.data = _u._$merge(this.data, {
                    isWeb: isWeb,
                    language: language.name,
                    engine: engine ? engine.name : '',
                    viewExtension: engine ? engine.viewExtension : ''
                });
            }
            else {
                var language = getLanguage(this.data.specType);
                var lselected, eselected;
                lselected = this.data.lid !== undefined ? this.findById(language, this.data.lid) : language[0];
                if (lselected && isWeb) {
                    eselected = this.data.eid !== undefined ? this.findById(lselected.engines, this.data.eid) : lselected.engines[0];
                }
                this.data = _u._$merge(this.data, {
                    isWeb: isWeb,
                    initSilent1: true,
                    initSilent2: true,
                    language: language,
                    lselected: lselected,
                    eselected: eselected,
                    engine: lselected.engines,
                    viewExtension: this.data.viewExtension != undefined ? this.data.viewExtension : (eselected ? eselected.viewExtension : '')
                });
            }
        },
        //选中变化调用，f=0语言变化，f=1模板引擎变化
        selectChange: function (evt, f) {
            var item = evt.selected;
            if (!item)  return;
            if (this.data.isWeb) {
                if (f == 0) {
                    this.data.lselected = item;
                    var t = [];
                    this.data.language.forEach(function (i) {
                        if (i.name == item.name) {
                            t = i.engines;
                            return;
                        }
                    });
                    this.data.engine = t;
                    this.data.eselected = t[0];
                    this.data.viewExtension = t[0].viewExtension;
                    this.$refs.engine.$updateSource(t, t[0]);
                    this.update(0);
                } else {
                    var e = [];
                    this.data.eselected = item;
                    this.data.engine.forEach(function (i) {
                        if (i.name == item.name) {
                            e = i;
                            return;
                        }
                    });
                    this.data.viewExtension = e.viewExtension;
                    this.update(1);
                }
            } else {
                this.data.lselected = item;
                this.update(0);
            }
        },
        //修改详情时，input变化处理
        inputChange: function (evt) {
            this.data.viewExtension = evt.target.value;
            this.update(2);
        },
        findById: function (data, id) {
            var res;
            data.forEach(function (i) {
                if (i.id == id) {
                    res = i;
                    return;
                }
            });
            return res;
        },
        update: function (key) { //key表示修改字段 0:实现语言,1:模板引擎,2:扩展名 这里判断只返回修改的字段
            var data;
            switch (key) {
                case 0:
                    data = {language: this.data.lselected.id};
                    if (this.data.isWeb) {
                        _u._$merge(data, {
                            engine: this.data.eselected.id,
                            viewExtension: this.data.viewExtension
                        });
                    }
                    break;
                case 1:
                    data = {
                        engine: this.data.eselected.id,
                        viewExtension: this.data.viewExtension
                    };
                    break;
                case 2:
                    data = {
                        viewExtension: this.data.viewExtension
                    };
                    break;
            }
            if (data) {
                this.$emit('updateSelect', data);
            }
        }
    });
    return LESelect;

},'b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','ffa820b4cb293ae990489967d5c4a899','e26ac58445dd3bc2b730e5275fb45f6f','8cbc286a7834dfcf29c8f7a018e77c02','8f5afc88b105382ed0f9d71bbf54195d','993671841dcf289096c7171d53130309');
I$('96274541cf03e1b37c01b84b1aed6a06',function (NEJ,_k,_u,_t,_p,_o,_f,_r){
    var _pro;
    /**
     * 分页式列表模块
     * 
     * 结构举例
     * ```html
     * <div class="mbox">
     *   <div class="lbox" id="list-box">
     *     <!-- list box -->
     *   </div>
     *   <div class="pbox" id="pager-box">
     *     <!-- pager box -->
     *   </div>
     * </div>
     * 
     * <!-- list jst template -->
     * <textarea name="jst" id="jst-list">
     *   {list beg..end as y}
     *     {var x=xlist[y]}
     *     <div class="item">
               <a data-id="${x.id}" data-action="delete">删除</a>
     *       <p>姓名：${x.name}</p>
     *       <p>联系方式：${x.mobile}</p>
     *     </div>
     *   {/list}
     * </textarea>
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     'base/klass',
     *     'base/util',
     *     'util/ajax/xdr',
     *     'util/cache/abstract'
     * ],function(_k,_u,_j,_t,_p){
     *     var _pro;
     *     // 自定义列表缓存
     *     _p._$$CustomListCache = _k._$klass();
     *     _pro = _p._$$CustomListCache._$extend(_t._$$CacheListAbstract);
     * 
     *     // 实现数据载入逻辑
     *     _pro.__doLoadList = function(_options){
     *         var _onload = _options.onload;
     *         // 补全请求数据，也可在模块层通过cache参数传入
     *         var _data = _options.data||{};
     *         _u._$merge(_data,{uid:'ww',sort:'xx',order:1});
     *         switch(_options.key){
     *                case 'user-list':
     *                    // TODO load list from server
     *                    _j._$request('/api/user/list',{
     *                        type:'json',
     *                        data:_u._$object2query(_data),
     *                        onload:function(_json){
     *                            // _json.code
     *                            // _json.result
     *                            _onload(_json.code==1?_json.result:null);
     *                        },
     *                        onerror:_onload._$bind(null);
     *                    });
     *                break;
     *                // TODO other list load
     *         }
     *     };
     * });
     * ```
     * 
     * 脚本举例
     * ```javascript
     * NEJ.define([
     *     '/path/to/cache.js',
     *     'util/list/pager'
     * ],function(_t,_p){
     *     // 构建列表模块，使用JST模版
     *     _p._$$ListModulePG._$allocate({
     *         limit:5,
     *         parent:'list-box',
     *         item:'jst-list', // 这里也可以传自己实现的item类型
     *         cache:{
     *             key:'user-list',// 此key必须是唯一的，对应了item中的值,也是删除选项的data-id
     *             data:{uid:'ww',sort:'xx',order:1}, // <--- 列表加载时携带数据信息，此数据也可在cache层补全
     *             klass:_t._$$CustomListCache
     *         },
     *         pager:{parent:'pager-box'}
     *     });
     * });
     * ```
     * 
     * @class   module:util/list/page._$$ListModulePG
     * @extends module:util/list/module._$$ListModule
     * 
     * @param   {Object} config - 可选配置参数
     */
    _p._$$ListModulePG = _k._$klass();
    _pro = _p._$$ListModulePG._$extend(_t._$$ListModule);
    /**
     * 取当前偏移量的分页信息
     *
     * @protected
     * @method module:util/list/page._$$ListModulePG#__getPageInfo
     * @param  {Number} arg0 - 偏移位置
     * @param  {Number} arg1 - 长度
     * @return {Object}        分页信息，如：{index:1,total:4}
     */
    _pro.__getPageInfo = function(_offset,_length){
        return this.__super(
            this.__first,_offset,
            this.__limit,_length
        );
    };
    /**
     * 根据页码计算偏移量
     *
     * @protected
     * @method module:util/list/page._$$ListModulePG#__getOffsetByIndex
     * @param  {Number} arg0 - 页码
     * @return {Number}        偏移量
     */
    _pro.__getOffsetByIndex = function(_index){
        var _offset = 0;
        if (_index>1)
            _offset = this.__first+(
                _index-2)*this.__limit;
        return _offset;
    };
    /**
     * 页码变化处理逻辑
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doChangePage
     * @param  {Object} arg0 - 页码信息
     * @return {Void}
     */
    _pro.__doChangePage = function(_event){
        this.__super(_event);
        if (!_event.stopped){
            this.__doChangeOffset(
                this.__getOffsetByIndex(_event.index)
            );
        }
    };
    /**
     * 加载数据之前处理逻辑，显示数据加载中信息
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doBeforeListLoad
     * @return {Void}
     */
    _pro.__doBeforeListLoad = function(){
        this.__doClearListBox();
        this.__doShowMessage('onbeforelistload','列表加载中...');
    };
    /**
     * 数据载入之后处理逻辑
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doBeforeListShow
     * @return {Void}
     */
    _pro.__doBeforeListShow = function(){
        this.__super();
        this.__doClearListBox();
    };
    /**
     * 列表绘制之前处理逻辑
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doBeforeListRender
     * @return {Void}
     */
    _pro.__doBeforeListRender = function(_list,_offset,_limit){
        var _info = this.__getPageInfo(_offset,_list.length);
        if (this.__doSyncPager(_info.index,_info.total)) return !0;
        this.__doSwitchPagerShow(_info.total>1?'':'none');
    };
    /**
     * 列表为空时处理逻辑
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doShowEmpty}\
     * @return {Void}
     */
    _pro.__doShowEmpty = function(){
        this.__doShowMessage('onemptylist','没有列表数据！');
    };
    /**
     * 通过事件回调检测显示信息
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doShowMessage
     * @param  {String} arg0 - 事件名称
     * @param  {String} arg1 - 默认显示内容
     * @param  {Object} arg2 - 扩展信息
     * @return {Void} 
     */
    _pro.__doRenderMessage = function(_message,_pos){
        if (!_pos&&_u._$isString(_message)){
            this.__lbox.innerHTML = _message;
            return;
        }
        this.__super(_message,_pos);
    };
    /**
     * 以jst模版方式绘制列表
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doShowListByJST
     * @return {Void}
     */
    _pro.__doShowListByJST = function(_html){
        this.__lbox.innerHTML = _html;
    };
    /**
     * 以item模版方式绘制列表
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__doShowListByItem
     * @return {Void}
     */
    _pro.__doShowListByItem = function(_items){
        this.__items = _items;
    };
    /**
     * 添加列表项回调
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__cbItemAdd
     * @return {Void}
     */
    _pro.__cbItemAdd = function(_event){
        this.__doCheckResult(_event,'onafteradd');
        if (!_event.stopped) this._$refresh();
    };
    /**
     * 删除列表项回调
     * 
     * @protected
     * @method module:util/list/page._$$ListModulePG#__cbItemDelete
     * @return {Void}
     */
    _pro.__cbItemDelete = function(_event){
        this.__doCheckResult(_event,'onafterdelete');
        if (!_event.stopped) this._$refresh();
    };
    /**
     * 批量添加回调
     *
     * @protected
     * @method module:util/list/page._$$ListModulePG#__cbAppendList
     * @param  {Object} arg0 - 偏移量
     * @param  {Object} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbAppendList = function(_offset,_limit){
        var _index = 1;
        if (!!this.__pager){
            _index = this.__pager._$getIndex();
        }
        var _beg = this.__getOffsetByIndex(_index),
            _end = _beg+(_index>1?this.__limit:this.__first);
        if (_offset>=_end&&!!this.__pager){
            var _info = this.__getPageInfo(
                0,this._$getTotal()
            );
            this.__pager._$updateTotal(_info.total);
            this.__doSwitchPagerShow(_info.total>1?'':'none');
        }else{
            this._$refresh();
        }
    };
    /**
     * 前向追加数据片段回调
     *
     * @protected
     * @method module:util/list/page._$$ListModulePG#__cbUnshiftList
     * @param  {Number} arg0 - 偏移量
     * @param  {Number} arg1 - 数量
     * @return {Void}
     */
    _pro.__cbUnshiftList = function(_offset,_limit){
        var _index = 1;
        if (!!this.__pager){
            _index = this.__pager._$getIndex();
        }
        var _beg = this.__getOffsetByIndex(_index),
            _info = this.__getPageInfo(
                _beg,this._$getTotal()
            );
        this.__doChangePage({
            last:_index,
            index:_info.index
        });
    };

    if (CMPT){
        NEJ.copy(NEJ.P('nej.ut'),_p);
    }
    
    return _p;
},'c9db10699c7015cee29fb005f8df82a9','5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','bbd2b03b4721a770fd4204d16daa8889');
I$('d1a53be736829ad7f430ddafc060ee70',"<div class=\"m-name\">\n    <div class=\"m-name-hint\">\n        请输入规范名称\n    </div>\n    <input type=\"text\" class=\"u-input\" r-class={{'j-err-ipt': !!inputError}} r-model={name} />\n</div>");
I$('f689bb7284a9d9c1703f66ed9733f45c',".m-spec-copy .m-name{\n\tmargin:0 50px;\n}\n.m-spec-copy .m-name .m-name-hint{\n\ttext-align:left;\n\tcolor:#999;\n\tmargin-bottom:5px;\n}\n.m-spec-copy .m-name .u-input{\n\twidth:100%;\n}\n.m-spec-copy .m-name .j-err-ipt{\n\tborder-color:#f04c62;\n}\n.m-spec-copy .modal-ft{\n\tmargin:0 50px;\n}\n.m-spec-copy .modal-ft .u-btn{\n\twidth:100%;\n}");
I$('b746f21397a10b51a1182b3657b8794c',function (_e, _u, Modal, html, css) {
    _e._$addStyle(css);
    var copyLayer = Modal.extend({
        config: function () {
            this.data = _u._$merge({
                "contentTemplate": html,
                'class': 'm-spec-copy',
                'title': '复制规范',
                'closeButton': true,
                "okButton": true,
                "cancelButton": false,
                inputError: false,
                name: ''
            }, this.data);
            this.supr(this.data);
        },
        ok: function () {
            if (this.data.name) {
                this.$emit('copy', this.data.name);
            } else {
                this.showError();
            }
        },
        showError: function () {
            this.data.inputError = true;
        }
    });
    return copyLayer;
},'555a9eecaf26c5c01fe9db8d965bc30f','3ff9c25bd81a3c2a260c28122918263a','a17dfb1aca7e5bcf1c99411da2601159','d1a53be736829ad7f430ddafc060ee70','f689bb7284a9d9c1703f66ed9733f45c');
I$('72ffe27a7c87713692c65beb84477092',function (_k, _u, _d, _sc, _collectCache, _infCache, _p, _pro) {
    _p._$resourceInf = 'interface';
    _p._$resourceRecord = 'record';
    _p._$resourceCollect = 'suite';

    _p._$getResourceType = function (path) {
        if (path.indexOf('group/suite') > -1) {
            return _p._$resourceCollect;
        }
        else if (path.indexOf('record') > -1) {
            return _p._$resourceRecord;
        }
        else if (path.indexOf('group') > -1) {
            return _p._$resourceInf;
        }
    };

    _p._$removeResourceData = function (id, type, keys) {
        var cacheObj = _sc.localCache._$get(_p._$cacheKey);
        if (cacheObj) {
            if (id) {
                var resKey = type + '-' + id;
                var resData = cacheObj[resKey];
                if (resData) {
                    if (!keys) {
                        delete cacheObj[resKey];
                    }
                    else {
                        if (!Array.isArray(keys)) {
                            keys = [keys];
                        }
                        keys.forEach(function (key) {
                            delete resData[key];
                        });
                    }
                }
            }
            else {
                _u._$loop(
                    cacheObj,
                    function (_item, _key) {
                        var ids = _key.split('-');
                        this._$removeResourceData(ids[1], ids[0], keys);
                    },
                    this
                );
            }
        }
    };

    _p._$saveResourceData = function (id, type, data) {
        var cacheObj = _sc.localCache._$get(_p._$cacheKey);
        if (!cacheObj) {
            cacheObj = {};
            _sc.localCache._$set(_p._$cacheKey, cacheObj);
        }
        var resKey = type + '-' + id;
        var resData = cacheObj[resKey];
        if (!resData) {
            resData = {};
            cacheObj[resKey] = resData;
        }

        _u._$merge(resData, data);
    };

    _p._$getResourceData = function (id, type, keys) {
        var res;
        var cacheObj = _sc.localCache._$get(_p._$cacheKey);
        if (cacheObj) {
            var resData = cacheObj[type + '-' + id];
            if (resData) {
                if (!keys) {
                    res = resData;
                }
                else {
                    if (!Array.isArray(keys)) {
                        keys = [keys];
                    }
                    res = {};
                    keys.forEach(function (key) {
                        res[key] = resData[key];
                    });
                }
            }
        }
        return res;
    };

    /**
     * 获取用例默认数据是否编辑过
     *
     * @param  {?number} id 接口id
     * @return {boolean}    编辑过返回true
     */
    _p._$getModifiedStatus = function (id) {
        var isModified = false;
        if (id) {
            var resData = this._$getResourceData(id, _p._$resourceInf);
            if (resData && resData.stash && resData.stash !== resData.origin) {
                isModified = true;
            }
        }
        else {
            var cacheObj = _sc.localCache._$get(_p._$cacheKey);
            if (cacheObj) {
                _u._$loop(
                    cacheObj,
                    function (_item) {
                        if (_item.stash && _item.stash !== _item.origin) {
                            isModified = true;
                            return true;
                        }
                    }
                );
            }
        }
        return isModified;
    };

    _p._$getResource = function (type, id) {
        var cacheClass;
        if (type === _p._$resourceCollect) {
            cacheClass = _collectCache._$$CacheTestcollection;
        }
        else if (type === _p._$resourceInf) {
            cacheClass = _infCache._$$CacheInterface;
        }
        var cache = cacheClass._$allocate({});
        var data = cache._$getItemInCache(id);
        cache._$recycle();
        return data;
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','c6dbf51c390a9de703c7bf6c9b46ff41','c414372fb2919eb27a7bfb86a7cb03ea','53ae16a47e896f65063e7d0eb3867c57','7385ee68edde0ba303fb20b28ecfb227');
I$('042a6dc19f6468a7ca6f37ca656a34d7',function (_k, _e, _m, modal, _infCache, _p, _pro) {
    /**
     * 模块
     * @class   {wd.m._$$ModuleResCreate}
     * @extends {nej.ut._$$AbstractModule}
     * @param   {Object}  可选配置参数，已处理参数列表如下所示
     */
    _p._$$ModuleTestTabBase = _k._$klass();
    _pro = _p._$$ModuleTestTabBase._$extend(_m._$$Module);

    /**
     * 禁用或恢复按钮
     * @param  {Node} btn
     * @param  {String} text - 设置按钮文本
     * @param  {Boolean} disable - 是否禁用按钮
     * @return {Void}
     */
    _pro.__disableBtn = function (btn, text, disable) {
        btn.innerText = text;
        if (disable) {
            _e._$addClassName(btn, 'u-btn-disabled');
            _e._$attr(btn, 'disabled', 'disabled');
        }
        else {
            _e._$delClassName(btn, 'u-btn-disabled');
            btn.removeAttribute('disabled');
        }
    };

    /**
     * 隐藏前事件
     * @param  {Object} evt
     * @return {Void}
     */
    _pro.__onBeforeHide = function (evt) {
        var isTestModule = this.__getPathFromUMI({
            basePath: evt.target.path
        }).indexOf('/test/') === 0;
        if (!isTestModule && _infCache._$getModifiedStatus()) {
            this.__stop(evt);
            this.__leaveLayer = modal.confirm({
                "content": "您确定要离开接口测试页面吗？未保存数据将不会为您保存。",
                'title': '离开此页确认',
                'closeButton': true,
                "okButton": '离开',
                "cancelButton": true
            }).$on('ok', function () {
                this.__leaveLayer.destroy();
                delete this.__leaveLayer;
                this.__dispatcher._$redirect(
                    evt.target.href, {
                        exitable: !0
                    }
                );
            }.bind(this));
        }
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','555a9eecaf26c5c01fe9db8d965bc30f','c946055836c26441b9d60b589f2e1581','a17dfb1aca7e5bcf1c99411da2601159','72ffe27a7c87713692c65beb84477092');
I$('db9992d6887f5f44901c212c93dbaec6',"<div class=\"u-interface-test\">\n    <p class=\"js-tip-xhrtp\" r-hide={isxhrptIst}>测试依赖\n        <a href=\"https://chrome.google.com/webstore/detail/xhr-proxy-tool/fbakmpanchidgmjopcmcddoihgjkfcjn\"\n           target=\"xhr-proxy-tool\">XHR Proxy Tool</a>插件,去\n        <a href=\"https://chrome.google.com/webstore/detail/xhr-proxy-tool/fbakmpanchidgmjopcmcddoihgjkfcjn\"\n           target=\"xhr-proxy-tool\">安装</a>,安装后请刷新页面。\n    </p>\n\n    <form>\n        <div class=\"form-group\">\n            <label>\n                <i class=\"signal-required\">*</i>服务器：\n            </label>\n            <input type=\"text\" name=\"host\"\n                   r-class={{\"host\":true,\"form-item\":true,\"js-invalid\":xlist[0].__test.host.error}}\n                   placeholder=\"请输入服务器地址\" r-model={xlist[0].__test.host.value}\n                   on-change={this.checkEmpty(xlist[0].__test.host,true)}>\n            {#if isCreateTest && !hasDefaultHost}\n            <span class=\"js-tip js-tip-host\">您可以<a class=\"j-set-host\" href=\"javascript:void(0)\" on-click={this.manageHosts()}>设置</a>项目默认服务器</span>\n            {/if}\n        </div>\n\n        <div class=\"req-list\">\n            {#list xlist as x}\n            <div class=\"req-item\">\n                {#if xlist.length > 1}\n                <div class=\"req-name\" title={x.name} on-click={this.toggleForm(x)}>\n                    <i r-class={{\"u-trigon-down\":true,\"u-trigon-right\":x.isHide}}></i>{x.name|escape}\n                </div>\n                {/if}\n\n                <div class=\"req-con\" r-hide={x.isHide}>\n                    <div class=\"form-group\">\n                        <label>地址：</label>\n                        <div class=\"item-text\">\n                            <span class=\"method\">{x.method|escape}</span>\n                            <span class=\"path\">{x.path|escape}</span>\n                        </div>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>\n                            <i class=\"signal-required\">*</i>名称：\n                        </label>\n                        <input type=\"text\" name=\"name\"\n                               r-class={{\"name\":true,\"form-item\":true,\"js-invalid\":x.__test.name.error}}\n                               placeholder=\"请输入测试用例名称\" r-model={x.__test.name.value}\n                               on-change={this.checkEmpty(x.__test.name)}>\n                    </div>\n\n                    <div class=\"form-group form-description\">\n                        <label>描述：</label>\n                        <textarea name=\"description\" placeholder=\"请输入测试用例描述信息\" class=\"description form-item\"\n                                  r-model={x.__test.description.value}></textarea>\n                    </div>\n\n                    <div class=\"form-group\" r-hide={!x.params.__urlParams}>\n                        <label>参数：</label>\n                        <ul class=\"req-form form-item\">\n                            <li>\n                                <ul class=\"list-head\">\n                                    <li class=\"item-name\">名称</li>\n                                    <li class=\"item-value\">值</li>\n                                </ul>\n                            </li>\n                            {#list x.params.__urlParams as param}\n                            <li>\n                                <ul>\n                                    <li class=\"item-name\" title=\"{param.name}\">{param.name}</li>\n                                    <li class=\"item-value\">\n                                        <input type=\"text\" name=\"param-{param.name}\" title=\"{param.name}\"\n                                               class=\"req-param\" r-model={param.value}>\n                                    </li>\n                                </ul>\n                            </li>\n                            {/list}\n                        </ul>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>请求头：</label>\n                        {#if x.params.reqHeaders.length > 0}\n                        <ul class=\"req-header req-form form-item\">\n                            <li>\n                                <ul class=\"list-head\">\n                                    <li class=\"item-name\">名称</li>\n                                    <li class=\"item-value\">值</li>\n                                </ul>\n                            </li>\n                            {#list x.params.reqHeaders as reqHeader}\n                            <li>\n                                <ul>\n                                    <li class=\"item-name\" title={reqHeader.description || reqHeader.name|escape}>\n                                        {reqHeader.name|escape}\n                                    </li>\n                                    <li class=\"item-value\">\n                                        <input type=\"text\"\n                                               class=\"rh-ipt\"\n                                               name=\"reqheader-{reqHeader.name|escape}\"\n                                               title=\"{reqHeader.name|escape}\"\n                                               on-change={this.runScript(x)}\n                                               r-model={reqHeader.__value}>\n                                    </li>\n                                </ul>\n                            </li>\n                            {/list}\n                        </ul>\n                        {#else}\n                        <p class=\"item-text\">无</p>\n                        {/if}\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>请求数据：</label>\n                        {#if x.params.inputs.length > 0}\n                        <ul class=\"req-data req-form form-item\">\n                            <li>\n                                <ul class=\"list-head\">\n                                    {#if x.reqFormat == FORMAT.hash}\n                                    <li class=\"item-name\">名称</li>\n                                    {/if}\n                                    <li class=\"item-type\">类型</li>\n                                    <li class=\"item-value\">值</li>\n                                </ul>\n                            </li>\n                            {#list x.params.inputs as input}\n                            {#if input.__datatype.format == FORMAT.file}\n                            <li>\n                                <ul class=\"list-file\">\n                                    {#if x.reqFormat == FORMAT.hash}\n                                    <li class=\"item-name\" title=\"{input.name|escape}\">{input.name|escape}</li>\n                                    {/if}\n                                    <li class=\"item-type\" title=\"{input.typeName|escape}\">\n                                        {#if input.type > 10003}\n                                        <a href=\"/datatype/detail/?pid={pid}&id={input.type}\" class=\"stateful\">{input.typeName|escape}</a>\n                                        {#else}{input.typeName|escape}\n                                        {/if}\n                                    </li>\n                                    <li class=\"item-value\">\n                                        <label class=\"choose-file\"\n                                               for=\"m-res-i-tc-{input.name|escape}\">请选择文件</label>\n                                        <input name=\"reqdata-{input.name|escape}\" class=\"rd-file\"\n                                               id=\"m-res-i-tc-{input.name|escape}\" type=\"file\"\n                                               on-change={this.onFileChoosen($event,input)}>\n                                        <span>{#if input.__value}{input.__value.name}{#else}未选择任何文件{/if}</span>\n                                    </li>\n                                </ul>\n                            </li>\n\n                            {#elseif x.reqFormat != FORMAT.enum || input_index<1}\n                            <li>\n                                <ul>\n                                    {#if x.reqFormat == FORMAT.hash}\n                                    <li class=\"item-name\" title={input.name|escape}>{input.name|escape}</li>\n                                    {/if}\n                                    <li class=\"item-type\">\n                                        {#if input.__datatype.type !== TYPE.system}\n                                        <a {#if input.__datatype.type !=TYPE.hidden}\n                                           href=\"/datatype/detail/?pid={pid}&id={input.type}\" {/if} class=\"stateful\n                                        type-link\">\n                                        {#if input.isArray || x.reqFormat == FORMAT.array}Array&lt;{/if}\n                                        {input.typeName || 'Object'|escape}\n                                        {#if input.isArray || x.reqFormat == FORMAT.array}&gt;{/if}\n                                        </a>\n                                        <ul class=\"parlist\">\n                                            {#if input.__datatype.type != TYPE.hidden}\n                                            <li class=\"link-detail\">\n                                                <a href=\"/datatype/detail/?pid={pid}&id={input.type}\" class=\"stateful\">查看详情</a>\n                                                <i class=\"u-icon-arrow-right-normal\"></i>\n                                            </li>\n                                            {/if}\n                                            <li>\n                                                <ul>\n                                                    {#if input.__datatype.format == FORMAT.enum || x.reqFormat == FORMAT.enum}\n                                                    <li class=\"par-name\">值</li>{#else}\n                                                    <li class=\"par-name\">属性名</li>{/if}\n                                                    <li class=\"par-type\">类型</li>\n                                                    <li class=\"par-description\">描述</li>\n                                                </ul>\n                                            </li>\n                                            {#list input.__datatype.params as param}\n                                            <li>\n                                                <ul>\n                                                    {#if input.__datatype.format == FORMAT.enum || x.reqFormat == FORMAT.enum}\n                                                    <li class=\"par-name\" title={param.defaultValue|escape}>\n                                                        {param.defaultValue|escape}\n                                                    </li>{#else}\n                                                    <li class=\"par-name\" title={param.name|escape}>\n                                                        {param.name|escape}\n                                                    </li>{/if}\n                                                    <li class=\"par-type\" title={param.typeName}>\n                                                        {#if param.isArray}Array {param.typeName|escape}\n                                                        {#else}{param.typeName|escape}{/if}\n                                                    </li>\n                                                    <li class=\"par-description\" title={param.description}>\n                                                        {param.description}\n                                                    </li>\n                                                </ul>\n                                            </li>\n                                            {/list}\n                                        </ul>\n                                        {#elseif input.isArray || x.reqFormat == FORMAT.array}Array&lt;{input.typeName|escape}&gt;\n                                        {#elseif x.reqFormat == FORMAT.enum}枚举\n                                        {#else}{input.typeName|escape}\n                                        {/if}\n                                    </li>\n                                    <li class=\"item-value\">\n\n                                        {#if input.__datatype.format === FORMAT.hash}\n                                        <aceEditor className=\"rd-edt\" defaultValue={input.__value||input.defalutValue}\n                                                   highlight={input.__errState}\n                                                   on-input={this.onEditorChange($event,input)}\n                                                   on-blur={this.checkValidity(input,x.reqFormat,null,x)}\n                                                   on-focus={this.hideErrMsg(input.__errState)}></aceEditor>\n                                        <span class=\"js-tip\" r-hide={!input.description}>\n\t                                        <i class=\"u-icon-notice2-normal\"></i>{input.description|escape}\n                                        </span>\n                                        {#if input.__errState && input.__errState.length>0}\n                                        <span class=\"js-error\"><i class=\"u-icon-alert-normal\"></i>{this.getErrMsg(input.__errState)}</span>\n                                        {/if}\n\n                                        {#else}\n                                        <input type=\"text\"\n                                               class=\"rd-ipt\"\n                                               name=\"reqdata-{input.name|escape}\"\n                                               title={input.name|escape}\n                                               r-model={input.__value}\n                                               on-blur={this.checkValidity(input,x.reqFormat,x.reqFormat ==\n                                        FORMAT.enum&&x.params.inputs,x)}\n                                        on-click={this.hideErrMsg(input.__errState)}>\n                                        {#if input.description}\n                                        <span class=\"js-tip\">\n                                            <i class=\"u-icon-notice2-normal\"></i>{input.description|escape}\n                                        </span>\n                                        {/if}\n                                        {#if input.__errState && input.__errState.length>0}\n                                        <span class=\"js-error\"><i class=\"u-icon-alert-normal\"></i>{this.getErrMsg(input.__errState)}</span>\n                                        {/if}\n                                        {/if}\n                                    </li>\n                                </ul>\n                            </li>\n                            {/if}\n                            {/list}\n                        </ul>\n                        {#else}\n                        <p class=\"item-text\">无</p>\n                        {/if}\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>发送规则：</label>\n                        <p class=\"item-text\">{x.beforeScript||'无'}</p>\n                    </div>\n\n                    <div class=\"form-group form-script-result\" r-hide={!x.beforeScript}>\n                        <label>处理结果：</label>\n                        <aceEditor className=\"script-result form-item\" readOnly={true} defaultValue={x.beforeScriptResult} showGutter={true} highlightActiveLine={true} empty={'无'}></aceEditor>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>响应头：</label>\n                        {#if x.params.resHeaders.length > 0}\n                        <ul class=\"req-header req-form form-item\">\n                            <li>\n                                <ul class=\"list-head\">\n                                    <li class=\"item-name\">名称</li>\n                                    <li class=\"item-value\">预期值</li>\n                                    <li class=\"item-error\">出错提示</li>\n                                </ul>\n                            </li>\n                            {#list x.params.resHeaders as resHeader}\n                            <li>\n                                <ul>\n                                    <li class=\"item-name\" title={resHeader.description||resHeader.name|escape}>\n                                        {resHeader.name|escape}\n                                    </li>\n                                    <li class=\"item-value\">\n                                        <input type=\"text\"\n                                               class=\"rhe-ipt\"\n                                               name=\"resheader-{resHeader.name|escape}\"\n                                               title=\"{resHeader.name|escape}\"\n                                               r-model={resHeader.__value}>\n                                    </li>\n                                    <li class=\"item-error\">\n                                        <input type=\"text\"\n                                               class=\"rhe-err-ipt\"\n                                               name=\"resexpect-{output.name|escape}\"\n                                               title={resHeader.name|escape}\n                                               r-model={resHeader.__error}>\n                                    </li>\n                                </ul>\n                            </li>\n                            {/list}\n                        </ul>\n                        {#else}\n                        <p class=\"item-text\">无</p>\n                        {/if}\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label>响应数据：</label>\n                        {#if x.params.outputs.length > 0}\n                        <ul class=\"req-data req-form form-item resexpect\">\n                            <li>\n                                <ul class=\"list-head\">\n                                    {#if x.resFormat == FORMAT.hash}\n                                    <li class=\"item-name\">名称</li>\n                                    {/if}\n                                    <li class=\"item-type\">类型</li>\n                                    <li class=\"item-value\">预期值</li>\n                                    <li class=\"item-error\">出错提示</li>\n                                </ul>\n                            </li>\n                            {#list x.params.outputs as output}\n                            {#if output.__datatype.format == FORMAT.file}\n                            <li>\n                                <ul class=\"list-file\">\n                                    {#if x.resFormat == FORMAT.hash}\n                                    <li class=\"item-name\" title=\"{output.name|escape}\">{output.name|escape}</li>\n                                    {/if}\n                                    <li class=\"item-type\" title=\"{output.typeName|escape}\">\n                                        {#if output.type > 10003}\n                                        <a href=\"/datatype/detail/?pid={pid}&id={output.type}\" class=\" stateful\">{output.typeName}</a>\n                                        {#else}{output.typeName|escape}\n                                        {/if}\n                                    </li>\n                                    <li class=\"item-value\">\n                                        <label class=\"choose-file\"\n                                               for=\"m-res-i-tc-{output.name|escape}\">请选择文件</label>\n                                        <input name=\"resexpect-{output.name|escape}\"\n                                               class=\"re-file\"\n                                               type=\"file\"\n                                               id=\"m-res-i-tc-{output.name|escape}\"\n                                               on-change={this.onFileChoosen($event,output)}>\n                                        <span>{#if input.__value}{input.__value.name}{#else}未选择任何文件{/if}</span>\n                                    </li>\n                                    <li class=\"item-error\">\n                                        <input type=\"text\"\n                                               class=\"re-err-ipt\"\n                                               name=\"resexpect-{output.name|escape}\"\n                                               title={output.name|escape}\n                                               r-model={output.__error}>\n                                    </li>\n                                </ul>\n                            </li>\n                            {#elseif x.resFormat != FORMAT.enum || output_index<1}\n                            <li>\n                                <ul>\n                                    {#if x.resFormat == FORMAT.hash}\n                                    <li class=\"item-name\" title=\"{output.name|escape}\">{output.name|escape}</li>\n                                    {/if}\n                                    <li class=\"item-type\">\n                                        {#if output.__datatype.type !== TYPE.system}\n                                        <a {#if input.__datatype.type !=type.hidden}\n                                           href=\"/datatype/detail/?pid={pid}&id={output.type}\" {/if} class=\"stateful\n                                        type-link\">\n                                        {#if output.isArray || x.resFormat == FORMAT.array}Array&lt;{/if}\n                                        {output.typeName || 'Object'|escape}\n                                        {#if output.isArray || x.resFormat == FORMAT.array}&gt;{/if}</a>\n                                        <ul class=\"parlist\">\n                                            {#if output.__datatype.type != TYPE.hidden}\n                                            <li class=\"link-detail\">\n                                                <a href=\"/datatype/detail/?pid={pid}&id={output.type}\"\n                                                   class=\"stateful\">查看详情</a>\n                                                <i class=\"u-icon-arrow-right-normal\"></i>\n                                            </li>\n                                            {/if}\n                                            <li>\n                                                <ul>{#if output.__datatype.format == FORMAT.enum || x.resFormat == FORMAT.enum}\n                                                    <li class=\"par-name\">值</li>{#else}\n                                                    <li class=\"par-name\">属性名</li>{/if}\n                                                    <li class=\"par-type\">类型</li>\n                                                    <li class=\"par-description\">描述</li>\n                                                </ul>\n                                            </li>\n                                            {#list output.__datatype.params as param}\n                                            <li>\n                                                <ul>\n                                                    {#if output.__datatype.format == FORMAT.enum || x.resFormat == FORMAT.enum}\n                                                    <li class=\"par-name\" title={param.defaultValue|escape}>\n                                                        {param.defaultValue|escape}\n                                                    </li>{#else}\n                                                    <li class=\"par-name\" title={param.name|escape}>\n                                                        {param.name|escape}\n                                                    </li>{/if}\n                                                    <li class=\"par-type\" title={param.typeName|escape}>\n                                                        {#if param.isArray}Array {param.typeName|escape}\n                                                        {#else}{param.typeName|escape}{/if}\n                                                    </li>\n                                                    <li class=\"par-description\" title={param.description|escape}>\n                                                        {param.description|escape}\n                                                    </li>\n                                                </ul>\n                                            </li>\n                                            {/list}\n                                        </ul>\n                                        {#elseif output.isArray || x.resFormat == FORMAT.array}Array&lt;{output.typeName|escape}&gt;\n                                        {#elseif x.resFormat == FORMAT.enum}枚举\n                                        {#else}{output.typeName|escape}\n                                        {/if}\n                                    </li>\n\n                                    {#if output.__datatype.format == FORMAT.hash}\n                                    <li class=\"item-value\">\n                                        <aceEditor className=\"re-edt\" defaultValue={output.__value||output.defalutValue}\n                                                   highlight={output.__errState}\n                                                   on-input={this.onEditorChange($event,output)}\n                                                   on-blur={this.checkValidity(output,x.resFormat,null,null,true)}\n                                                   on-focus={this.hideErrMsg(output.__errState)}>\n                                        </aceEditor>\n                                        <span class=\"js-tip\" r-hide={!output.description}>\n                                            <i class=\"u-icon-notice2-normal\"></i>{output.description|escape}\n                                        </span>\n                                        {#if output.__errState && output.__errState.length>0}\n                                        <span class=\"js-error\"><i class=\"u-icon-alert-normal\"></i>{this.getErrMsg(output.__errState)}</span>\n                                        {/if}\n                                    </li>\n                                    <li class=\"item-error\">\n                                        <aceEditor className=\"re-err-edt\" defaultValue={output.__error}\n                                                   on-input={this.onEditorChange($event,output,'__error')}></aceEditor>\n                                    </li>\n\n                                    {#else}\n                                    <li class=\"item-value\">\n                                        <input type=\"text\"\n                                               class=\"re-ipt\"\n                                               name=\"resexpect-{output.name|escape}\"\n                                               title={output.name|escape}\n                                               r-model={output.__value}\n                                               on-blur={this.checkValidity(output,x.resFormat,x.resFormat ==\n                                        FORMAT.enum&&x.params.outputs,null,null,true)}\n                                        on-click={this.hideErrMsg(output.__errState)}>\n                                        <span class=\"js-tip\" r-hide={!output.description}>\n                                            <i class=\"u-icon-notice2-normal\"></i>{output.description|escape}\n                                        </span>\n                                        {#if output.__errState && output.__errState.length>0}\n                                        <span class=\"js-error\"><i class=\"u-icon-alert-normal\"></i>{this.getErrMsg(output.__errState)}</span>\n                                        {/if}\n                                    </li>\n                                    <li class=\"item-error\">\n                                        <input type=\"text\"\n                                               class=\"re-err-ipt\"\n                                               name=\"resexpect-{output.name|escape}\"\n                                               title={output.name|escape}\n                                               r-model={output.__error}>\n                                    </li>\n                                    {/if}\n                                </ul>\n                            </li>\n                            {/if}\n                            {/list}\n                        </ul>\n                        {#else}\n                        <p class=\"item-text\">无</p>\n                        {/if}\n                    </div>\n\n                    <!--<div class=\"form-group\" r-hide={!x.afterScript}>-->\n                        <!--<label>接收规则：</label>-->\n                        <!--<p class=\"item-text\">{x.afterScript}</p>-->\n                    <!--</div>-->\n\n                    <!--<div class=\"form-group form-script-result\" r-hide={!x.afterScript}>-->\n                        <!--<label>执行结果：</label>-->\n                        <!--<aceEditor className=\"script-result form-item\" readOnly={true} defaultValue={x.afterScriptResult} showGutter={true} highlightActiveLine={true} empty={'无'}></aceEditor>-->\n                    <!--</div>-->\n                </div>\n            </div>\n            {/list}\n        </div>\n        <div class=\"button-group\">\n            {#if isCreateTest}\n            <button r-class={{\"u-btn\":true,\"starttest\":true,\"u-btn-disabled\":!!errCount}} name=\"starttest\" type=\"button\"\n                    on-click={this.onSubmitClick($event)} {#if errCount>0}disabled{/if}>开始测试\n            </button>\n            {#else}\n            <button r-class={{\"u-btn\":true,\"retest\":true,\"u-btn-disabled\":!!errCount}} name=\"retest\" type=\"button\" on-click={this.onSubmitClick($event)} {#if errCount>0}disabled{/if}>保存并重测\n            </button>\n            <button r-class={{\"u-btn\":true,\"starttest\":true,\"u-btn-disabled\":!!errCount}}  name=\"starttest\" type=\"button\" on-click={this.onSubmitClick($event,true)} {#if errCount>0}disabled{/if}>新建测试\n            </button>\n            {/if}\n        </div>\n\n    </form>\n</div>");
I$('701753c3b4a49f66baca05506a38a2ac',".u-interface-test{position:relative;}.u-interface-test input[name='name'],.u-interface-test textarea[name='description']{width:70% !important;}.u-interface-test input[name='host']{width:50%;}.u-interface-test .form-group li li{display:inline-block;}.u-interface-test .form-group >.js-mhd-parent{width:70%;}.u-interface-test .form-group >.js-mhd-parent input{width:100% !important;}.u-interface-test .js-tip-xhrtp{position:absolute;top:-30px;left:0;width:100%;height:30px;line-height:30px;text-align:center;padding:0 10px;color:#e0c05e;background-color:#fdf7e5;}.u-interface-test .js-tip-xhrtp .u-icon-notice2-normal{margin-right:5px;}.u-interface-test .req-item:not(:last-child) .req-con{padding-bottom:40px;}.u-interface-test .req-item .req-name{cursor:pointer;height:30px;line-height:30px;width:180px;margin-bottom:10px;color:#222;background-color:#f6f6f6;padding:0 10px 0 16px;text-align:center;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;position:relative;}.u-interface-test .req-item .req-name .u-trigon-down{border-color:#a6a6a6 transparent transparent transparent;position:absolute;transition:all ease 0.3s;left:5px;top:50%;margin-top:-3px;}.u-interface-test .req-item .req-name .u-trigon-right{transform:rotate(-90deg);transform-origin:50% 25%;}.u-interface-test .req-item .req-con{transition:all ease 0.3s;}.u-interface-test .req-item .req-con .form-item,.u-interface-test .req-item .req-con .item-text{color:#222;}.u-interface-test .req-item .req-con .form-item{width:70%;}.u-interface-test .req-item .req-con .req-form{padding:0;}.u-interface-test .req-item .req-con .req-form ul{min-height:30px;line-height:30px;padding:0 10px 10px 10px;display:flex;position:relative;}.u-interface-test .req-item .req-con .req-form ul li{text-align:left;}.u-interface-test .req-item .req-con .req-form ul .item-name{width:120px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}.u-interface-test .req-item .req-con .req-form ul .item-type{width:120px;position:relative;}.u-interface-test .req-item .req-con .req-form ul .item-type .type-link{color:#30a1f2;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;min-width:50%;}.u-interface-test .req-item .req-con .req-form ul .item-type .type-link:hover + ul{visibility:visible;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist{display:flex;position:absolute;left:50%;top:0;z-index:20;padding:0;visibility:hidden;flex-direction:column;min-height:100px;background-color:#fff;border:1px solid #e6e6e6;color:#222;font-size:12px;font-weight:normal;box-shadow:0 4px 8px rgba(0,0,0,0.05);}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist:hover{visibility:visible;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist .link-detail{display:block;position:relative;text-align:left;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist .link-detail a{height:30px;border-bottom:1px solid #eee;display:block;color:#222;line-height:30px;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist .link-detail:hover{background:#f5f5f5;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist .link-detail i{position:absolute;right:20px;top:12px;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist .link-detail + li{color:#999;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist >li{padding:0px 20px;height:30px;line-height:30px;}.u-interface-test .req-item .req-con .req-form ul .item-type .parlist >li li{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;width:5em;padding:0 5px;}.u-interface-test .req-item .req-con .req-form ul .item-error{width:200px;padding-left:10px;}.u-interface-test .req-item .req-con .req-form ul .item-error input{width:100%;height:30px;border:solid 1px #e6e6e6;transition:all ease 0.3s;box-sizing:border-box;}.u-interface-test .req-item .req-con .req-form ul .item-error input:focus{border-color:#aaa;}.u-interface-test .req-item .req-con .req-form ul .rd-edt,.u-interface-test .req-item .req-con .req-form ul .re-edt,.u-interface-test .req-item .req-con .req-form ul .re-err-edt{flex:1;min-height:80px;border:solid 1px #e6e6e6;box-sizing:border-box;}.u-interface-test .req-item .req-con .req-form ul .item-value{flex:1;display:flex;align-items:flex-start;}.u-interface-test .req-item .req-con .req-form ul .item-value >span{position:static;}.u-interface-test .req-item .req-con .req-form ul .item-value input{flex:1;width:100%;height:30px;border:solid 1px #e6e6e6;transition:all ease 0.3s;box-sizing:border-box;}.u-interface-test .req-item .req-con .req-form ul .item-value input:focus{border-color:#aaa;}.u-interface-test .req-item .req-con .req-form ul .item-value .js-pass,.u-interface-test .req-item .req-con .req-form ul .item-value .js-tip,.u-interface-test .req-item .req-con .req-form ul .item-value .js-error{top:0;margin-left:10px;position:absolute;left:100%;cursor:text;white-space:nowrap;overflow:hidden;}.u-interface-test .req-item .req-con .req-form ul .item-value .marker-err{background-color:#fdedef;position:absolute;}.u-interface-test .req-item .req-con .req-form ul .item-value .js-mhd-parent{flex:1;}.u-interface-test .req-item .req-con .req-form ul .item-err{width:100px;}.u-interface-test .req-item .req-con .req-form ul .item-description{width:100px;}.u-interface-test .req-item .req-con .req-form .list-head{padding:0 10px;background-color:#f6f6f6;border-bottom:solid 1px #e6e6e6;margin-bottom:10px;}.u-interface-test .req-item .req-con .req-form .list-file{padding:0;margin:0 10px 10px 10px;position:relative;}.u-interface-test .req-item .req-con .req-form .list-file input[type=file]{display:none;}.u-interface-test .req-item .req-con .req-form .list-file input[type=file] + span{margin-left:110px;}.u-interface-test .req-item .req-con .req-form .choose-file{width:100px;height:30px;line-height:30px;text-align:center;color:#30a1f2;background-color:#fff;border:solid #30a1f2 1px;transition:all ease 0.3s;position:absolute;cursor:pointer;}.u-interface-test .req-item .req-con .req-form .choose-file:hover{color:#fff;background-color:#30a1f2;}.u-interface-test .req-item .req-con .method{font-weight:bolder;}.u-interface-test .req-item .req-con .form-script-result{line-height:30px;}.u-interface-test .req-item .req-con .form-script-result .script-result{min-height:auto;margin-top:7px;}");
I$('24e57d041e1b41062db55252fc2d69b3',function (rb, v, u, e, util, notify, modal, aceEditor, db, html, css) {
    // 加载一次
    e._$addStyle(css);

    // 默认选项
    var defaultOptions = {
        // 待测试的接口列表
        xlist: [],
        // 用到的缓存对象
        cache: {},
        // 是否是创建测试,false则显示测试详情
        isCreateTest: true,

        // 详情模式下的需填入的数据
        data: {},

        // 是否只读
        readOnly: false,

        // 代码编辑器对象
        editors: {},
        // 表单是否合法可提交
        errCount: 0,

        // 是否安装了测试所需的插件proxy tool
        isxhrptIst: false,

        defaultHost: '',

        TYPE: {
            system: db.MDL_TYP_SYSTEM,
            normal: db.MDL_TYP_NORMAL,
            hidden: db.MDL_TYP_HIDDEN
        },

        FORMAT: {
            file: db.MDL_FMT_FILE,
            hash: db.MDL_FMT_HASH,
            enum: db.MDL_FMT_ENUM,
            array: db.MDL_FMT_ARRAY,
            string: db.MDL_FMT_STRING,
            number: db.MDL_FMT_NUMBER,
            boolean: db.MDL_FMT_BOOLEAN
        }
    };

    var InterfaceTest = rb.extend({
        name: "interfaceTest",
        template: html,
        config: function () {
            this.data = u._$merge({}, defaultOptions, this.data);
            // 把传过来的数据类型列表转换成需要的样子
            this.datatypeObj = {};
            this.data.datatypes.forEach(function (datatype) {
                this.datatypeObj[datatype.id] = datatype;
            }._$bind(this));

            // 检查XHR proxy tool插件是否安装
            this.data.cache._$checkXhrpt(function () {
                this.data.isxhrptIst = true;
            }.bind(this));
            // 向结构里塞进数据（详情或localhost存储的用户输入）
            this.data.xlist = this._copyXlist(this.data.xlist, this.data.data); // 创建模式下需要预填本地存储的输入值
            // 执行发送规则（如果有）
            this.data.xlist.forEach(function (x) {
                this.runScript(x);
            }.bind(this));
        },

        init: function () {
            this.supr();
        },

        /**
         * 检查某一项输入是否符合定义
         */
        checkValidity: function (item, format, params, x, ignoreMissError) {
            if (!item.__value) {
                item.__transformedValue = '';
                x && this.runScript(x);
                return;
            }
            var value = this.data.cache._$doTransformType(item.__value, item.__datatype.format, params || [item]);
            var checkResult = this.data.cache._$isTypeMatched(value, params ? {
                    format: format,
                    params: params
                } : item.__datatype,
                (format == db.MDL_FMT_ARRAY) + item.isArray);
            if (!checkResult.result) {
                var errors = [].concat(checkResult.errorMessage);
                item.__errState = item.__errState || [];
                // 为了实现检查响应预期时忽略缺少参数的错误
                if (ignoreMissError) {
                    errors = errors.filter(function (err) {
                        return err.type !== 3;
                    })
                }
                // 错误计数器，标记输入和发状态，控制是否可提交
                this.data.errCount += errors.length;
                item.__errState = item.__errState.concat(errors);
            } else item.__transformedValue = checkResult.value;
            x && this.runScript(x);
        },

        onEditorChange: function (event, item, key) {
            key = key || '__value';
            item[key] = event.data;
        },

        onFileChoosen: function (event, item) {
            item.__value = item.__transformedValue = event.target.files[event.target.files.length - 1];
        },

        onSubmitClick: function (event, createTest) {
            if (!this.data.isxhrptIst) {
                var confirmModal = new modal({
                    data: {
                        "content": "测试依赖XHR Proxy Tool插件,请安装:",
                        'title': '请安装插件',
                        'closeButton': true,
                        "okButton": '去安装',
                        "cancelButton": true
                    }
                }).$on('ok', function () {
                    window.open('https://chrome.google.com/webstore/detail/xhr-proxy-tool/fbakmpanchidgmjopcmcddoihgjkfcjn');
                }._$bind(this));
                return;
            }
            // 检查一遍必须值
            if (this.data.errCount < 1) {
                this.data.xlist.forEach(function (x, index) {
                    this.checkEmpty(x.__test.name);
                    index === 0 && (this.checkEmpty(x.__test.host));
                    x.params.inputs.forEach(function (input, index) {
                        if (x.reqFormat != this.data.FORMAT.enum || index < 1) {//留一手枚举，否则重复调用checkValidity引起错误计数混乱
                            this.checkValidity(input, x.reqFormat, x.reqFormat == this.data.FORMAT.enum && x.params.inputs);
                        }
                    }.bind(this));
                    x.params.outputs.forEach(function (output, index) {
                        if (x.resFormat != this.data.FORMAT.enum || index < 1) {
                            this.checkValidity(output, x.resFormat, x.resFormat == this.data.FORMAT.enum && x.params.outputs);
                        }
                    }.bind(this));
                }.bind(this));
            }
            if (this.data.errCount < 1) {
                this.$emit('ready', {
                    data: this.$getData(true),
                    button: event.origin,
                    createTest: createTest,
                    reqData: (function () {
                        var reqData = {};
                        this.data.xlist.forEach(function (x) {
                            reqData[x.id] = this._getReqData(x);
                        }.bind(this));
                        return reqData;
                    }.bind(this))()
                });
            }
        },

        manageHosts: function () {
            this.$emit('show-hosts-dialog');
        },

        /**
         * 检查输入是否为空
         * @param {Object} item
         * @param {Boolean} runScript - 检查合法后是否执行发送规则
         */
        checkEmpty: function (item, runScript) {
            if (!item.value) {
                this.data.errCount++;
                item.error = !0;
            } else {
                item.error && (this.data.errCount--); // 如果刚进入页面输入正确后错误计数机不减一,因为刚进去计数器为零，再减就负了。。。
                item.error = !1;
                if (runScript) {
                    this.data.xlist.forEach(function (x) {
                        this.runScript(x);
                    }.bind(this))
                }
            }
        },

        /**
         * 根据错误信息列表生成错误提示
         * @param {Array} errList - 错误信息列表
         * @return {String} 错误提示
         */
        getErrMsg: function (errList) {
            var errs = [];
            errList.forEach(function (err) {
                switch (err.type) {
                    case 0:
                        errs.push('JSON格式错误!');
                        break;
                    case 1:
                        errs.push(err.data + ' 不是' + err.datatype + '类型');
                        break;
                    case 3:
                        errs.push('缺少字段：' + err.keys.join(" -> "));
                        break;
                }
            });
            return errs.join(',');
        },

        toggleForm: function (x) {
            x.isHide = !x.isHide;
        },

        /**
         * 隐藏输入框旁的错误提示
         * @param {Array} errState - 该项对应的错误信息列表
         */
        hideErrMsg: function (errState) {
            if (!errState) return;
            this.data.errCount -= errState.length;
            errState.length = 0;
        },

        /**
         * 对该用例运行发送规则
         * @param {Object} x
         */
        runScript: function (x) {
            var data = this._getDataFromTest(this._getData(x));
            var items = ['beforeScript', 'inputs', 'reqHeaders', 'beforeScriptResult'];
            if (x[items[0]]) {
                var options = {
                    code: x[items[0]],
                    params: {
                        host: data.host,
                        path: x.path,
                        method: x.method,
                        headers: data[items[2]],
                        data: data[items[1]]
                    },
                    rootPath: window.location.origin,
                    constraints: this.data.constraints,
                    onmessage: function (result) {
                        x[items[3]] = result.data;
                        this.$update();
                    }.bind(this),
                    onerror: function (error) {
                        x[items[3]] = error.message;
                        this.$update();
                    }.bind(this)
                };
                util._$runScript(options);
            }
        },

        /**
         * 更新host
         * @param {string} host 默认服务器
         */
        $updateHost: function (host) {
            if (!this.data.xlist[0].__test.host.value) {
                this.data.xlist[0].__test.host.value = host;
                this.$update();
            }
            this.data.defaultHost = host;
        },

        /**
         * 组织视图数据
         * @param {Array} xlist
         * @param {Array} data
         * @return {Array}
         */
        _copyXlist: function (xlist, data) {
            var dataMap = {};
            if (data && u._$isArray(data)) {
                data.forEach(function (caseData) {
                    dataMap[caseData.interfaceId] = caseData;
                });
            }
            return xlist.map(function (x) {
                data && (data = this._getDataFromTest(dataMap[x.id] || data));
                var basicItems = ['name', 'host', 'description'];
                var interfaceParams = ['reqHeaders', 'resHeaders', 'inputs', 'outputs'];
                x = this.copy(x);
                x.__test = {};

                // 填入数据或初始化为空
                interfaceParams.forEach(function (item) {
                    x.params[item].forEach(function (param) {
                        itemData = data ? data[item] && data[item] : null;
                        if (itemData && u._$isObject(itemData))itemData = itemData[param.name];
                        if (item === 'outputs' || item === 'resHeaders') {
                            param.__value = itemData ? itemData.value : param.defaultValue;
                            param.__error = itemData ? itemData.error : '';
                        } else param.__value = itemData === null ? param.defaultValue : itemData;
                        param.__transformedValue = param.__value;
                        (typeof param.__value !== 'string') && (param.__value = JSON.stringify(param.__value));
                    });
                });
                basicItems.forEach(function (item) {
                    x.__test[item] = {value: data ? data[item] : ''}
                });

                // 从路径中取得冒号后的参数
                var params = x.path.match(/(\/:[^\/:\?]*)+/);
                params = params ? params[0].split('/:').slice(1) : [];
                if (params.length > 0) {
                    x.params.__urlParams = [];
                    params.forEach(function (param) {
                        var paramValue = data ? data.params[param] : '';
                        x.params.__urlParams.push({name: param, value: paramValue});
                    }.bind(this));
                } else x.params.__urlParams = null;

                // 处理重复的属性
                x.params.inputs = this.data.cache._$clearRepeatedParam(x.params.inputs, x.reqFormat);
                x.params.outputs = this.data.cache._$clearRepeatedParam(x.params.outputs, x.resFormat);

                // 为模版提供数据类型信息
                [x.params.inputs, x.params.outputs].forEach(function (params) {
                    u._$forEach(params, function (param) {
                        param && (param.__datatype = this.datatypeObj[param.type]);
                    }.bind(this))
                }.bind(this));

                return x;
            }.bind(this));
        },

        _getDataFromTest: function (test) {
            // 就是一堆JOSN.parse把数据从测试用例详情中解析出来方便整合
            test = this.copy(test);
            var _reqdata = test.reqData ? JSON.parse(test.reqData) : {};
            test.reqHeaders = test.reqHeader ? JSON.parse(test.reqHeader) : {};
            test.resHeaders = test.resExpectHeader ? JSON.parse(test.resExpectHeader) : {};
            test.outputs = test.resExpect ? JSON.parse(test.resExpect).__onlyParam || JSON.parse(test.resExpect) : {};//兼容之前数据格式__onlyParam，之后不再使用,下同
            test.inputs = _reqdata.reqParams && _reqdata.reqParams.__onlyParam || _reqdata.reqParams;
            test.params = _reqdata.__urlParams || {};
            return test;
        },

        /**
         * 获取指定测试用例数据
         * @param {Object} x
         * @param {Boolean} useError - 是否需要取得错误提示（用于执行接收规则时取得没有错误提示的数据，目前只执行发送规则时用不到）
         * @return {Object}
         */
        _getData: function (x, useError) {
            return {
                // 获取基础信息
                host: this.data.xlist[0].__test.host.value,
                interfaceId: x.id,
                name: x.__test.name.value,
                description: x.__test.description.value || '',
                state: db.API_TST_TODO,
                // 获取请求头数据
                reqHeader: (function (items) {
                    var rhObj = {};
                    items.forEach(function (item) {
                        // 填什么存什么
                        rhObj[item.name] = item.__value;
                    });
                    return JSON.stringify(rhObj);
                })(x.params.reqHeaders),

                // 获取响应头预期值
                resExpectHeader: (function (items) {
                    var rehObj = {};
                    items.forEach(function (item) {
                        // 预期值没有填写的不存
                        if (item.__value) {
                            rehObj[item.name] = {
                                value: item.__value,
                                error: item.__error
                            };
                        }
                    });
                    return JSON.stringify(rehObj);
                })(x.params.resHeaders),

                // 获取输入请求数据
                reqData: (function (urlParams) {
                    var rdObj = {};
                    rdObj.reqParams = this._getReqData(x);
                    if (urlParams) {
                        rdObj.__urlParams = {};
                        urlParams.forEach(function (param) {
                            rdObj.__urlParams[param.name] = param.value;
                        });
                    }
                    return JSON.stringify(rdObj);
                }.bind(this))(x.params.__urlParams),

                // 获取响应预期
                resExpect: (function (items) {
                    if (items.length < 1)return '';
                    var repObj = {};
                    if (x.resFormat == db.MDL_FMT_HASH) {
                        items.forEach(function (item) {
                            if (item.__value) {
                                repObj[item.name] = useError ? {
                                    value: item.__transformedValue,
                                    error: item.__error
                                } : item.__transformedValue
                            }
                        });
                    } else {
                        repObj = useError ? {
                            value: items[0].__transformedValue,
                            error: items[0].__error
                        } : items[0].__transformedValue;
                    }
                    return JSON.stringify(repObj);
                }.bind(this))(x.params.outputs)
            }
        },

        /**
         * 获取请求数据
         * @return {Array}
         */
        _getReqData: function (x) {
            var rdObj;
            // 请求数据类型为哈希时
            if (x.reqFormat == db.MDL_FMT_HASH) {
                rdObj = {};
                x.params.inputs.forEach(function (item) {
                    rdObj[item.name] = item.__transformedValue;
                });
            } else rdObj = x.params.inputs[0].__transformedValue; // 请求数据类型不为哈希时直接存储值
            return rdObj;
        },

        /**
         * 获取全部测试用例数据
         * @return {boolean} useCreateTime - 是否包括createTime字段（false时用于localhost的存储，去除createTime，从而避免误判为输入发生变化从而离开时弹框）
         * @return {Array}
         */
        $getData: function (useCreateTime) {
            return this.data.xlist.map(function (x) {
                var submitdata = this._getData(x, true);
                if (useCreateTime) {
                    submitdata.createTime = Date.now();
                }
                else { // 只是保存数据
                    if (submitdata.host === this.data.defaultHost) {
                        submitdata.host = '';
                    }
                }
                return submitdata;
            }.bind(this));
        }
    }).filter("escape", function (data) {
        return data;
    });

    return InterfaceTest;
},'ffa820b4cb293ae990489967d5c4a899','b9845e13e284410cb0bb909f737020e4','3ff9c25bd81a3c2a260c28122918263a','555a9eecaf26c5c01fe9db8d965bc30f','8cbc286a7834dfcf29c8f7a018e77c02','afb57ef5a0e0ee34baead79fa46d3e43','a17dfb1aca7e5bcf1c99411da2601159','2bcd8b6dc2d0dad3bd8f6ff8c8efd746','993671841dcf289096c7171d53130309','db9992d6887f5f44901c212c93dbaec6','701753c3b4a49f66baca05506a38a2ac');
I$('6adc1de08575db11d211d1a8eacae53c',"<div class=\"m-menu {classList}\">\n    <ul class=\"menu\" on-click={this.itemClick($event)}>\n        {#list xlist as item}\n        <li data-action={item.action}\n            {#if item.children && !!item.children.length}\n            class=\"menu-item menu-item-withsub {item.className||''}\"\n            on-mouseenter={this.toggleSubmenu($event,true)} on-mouseleave={this.toggleSubmenu($event,false)}\n            {#else}\n            class=\"menu-item {item.className||''}\"\n            {/if}>\n            {item.name}\n        </li>\n        {/list}\n    </ul>\n    {#if childList && !!childList.length}\n    <ul ref=\"childMenu\" class=\"menu menu-child\" on-click={this.subItemClick($event)}\n        on-mouseenter={this.enterSubmenu($event)}>\n        {#list childList as child}\n            <li data-action={child.action} class=\"menu-item menu-item-sub {child.className||''}\">{child.name}</li>\n        {/list}\n    </ul>\n    {/if}\n</div>\n\n");
I$('8d15f0f5a20d44e7cdea4288c91bbad8',".m-menu{position:absolute;color:#222;font-size:12px;font-weight:normal;z-index:99;}.m-menu .menu{background-color:#fff;border:1px solid #efefef;box-shadow:0 4px 8px rgba(0,0,0,0.05);}.m-menu .menu-item{position:relative;overflow:hidden;height:30px;line-height:30px;width:90px;padding:0 15px;white-space:nowrap;text-overflow:ellipsis;cursor:default;}.m-menu .menu-item:hover{background:#f1f1f1;}.m-menu .menu-item-withsub:after{position:absolute;right:4px;content:\">\";font-size:14px;font-weight:bold;}.m-menu .menu-child{position:absolute;}");
I$('a58013eccc9247851caf3a556a6ec87f',function (base, _e, _v, _cu, tpl, css) {
    // 加载一次即可
    _e._$addStyle(css);
    var Menu = base.extend({
        name: 'menu',
        template: tpl,
        /**
         * @protected
         */
        config: function (data) {
            this.data.triggerTime = data.triggerTime || 150; // 子菜单隐藏或者显示延时
            this.supr(this.data);
        },
        /**
         * @protected
         */
        init: function () {
            this.supr();
            // 证明不是内嵌组件
            if (this.$root === this) {
                this.$inject(document.body);
            }
            function bdClick() {
                this.hide();
            }
            setTimeout(function () {
                this._bdClickHandler = bdClick.bind(this);
                _v._$addEvent(document.body, 'click', this._bdClickHandler);
            }.bind(this), 0);
        },
        itemClick: function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
            var elem = _v._$getElement(evt, "d:action");
            if (elem) {
                var itemAction = _e._$dataset(elem, 'action');
                var menuItem = this.data.xlist.find(function (item) {
                    return item.action === itemAction;
                });
                if (menuItem) {
                    if (!menuItem.children || menuItem.children.length === 0) {
                        this.$emit('click', itemAction);
                    }
                }
            }
        },
        subItemClick: function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
            var elem = _v._$getElement(evt, "d:action");
            if (elem) {
                var itemAction = _e._$dataset(elem, 'action');
                this.$emit('click', this._showAction, itemAction);
            }
        },
        /**
         * 显示子菜单
         *
         * @param  {Element} elem 一级菜单项节点
         * @return {void}
         */
        showSubMenu: function (elem) {
            var itemAction = _e._$dataset(elem, 'action');
            if (this._showAction === itemAction) { // 当前action已经显示了
                return ;
            }
            var menuItem = this.data.xlist.find(function (item) {
                return item.action === itemAction;
            });
            this.data.childList = menuItem.children;
            this._showAction = itemAction;
            this.$update();
            var childMenu = this.$refs.childMenu;
            var elemPos = elem.getBoundingClientRect();
            var menuHight = childMenu.offsetHeight;
            var menuWidth = childMenu.offsetWidth;
            var docHeight = document.body.clientHeight;
            var docWidth = document.body.clientWidth;
            if (elemPos.top + menuHight - 1 > docHeight) {
                _e._$setStyle(childMenu, 'top', elem.offsetTop - (elemPos.top + menuHight - docHeight) + 'px');
            }
            else {
                _e._$setStyle(childMenu, 'top', elem.offsetTop - 1 + 'px');
            }
            if (elemPos.left + elemPos.width + menuWidth - 1 > docWidth) { // 超出右边界
                _e._$setStyle(childMenu, 'left', 2 - menuWidth + 'px');
            }
            else {
                _e._$setStyle(childMenu, 'left', elemPos.width + 'px');
            }
        },
        /**
         * 切换子菜单显示
         *
         * @param  {Event}  evt    事件对象
         * @param  {boolean} isShow 显示还是隐藏
         * @return {void}
         */
        toggleSubmenu: function (evt, isShow) {
            var me = this;
            clearTimeout(this._showTimer);
            clearTimeout(this._hideTimer);
            if (isShow) {
                var elem = _v._$getElement(evt);
                this._showTimer = setTimeout(this.showSubMenu.bind(this, elem), this.data.triggerTime);
            }
            else {
                this._hideTimer = setTimeout(function () {
                    delete me._showAction;
                    delete me.data.childList;
                    me.$update();
                }, this.data.triggerTime);
            }
        },
        /**
         * 进入子菜单事件
         *
         * @param  {Event}  evt    事件对象
         * @return {void}
         */
        enterSubmenu: function (evt) {
            if (this._hideTimer) {
                clearTimeout(this._hideTimer);
            }
        },
        destroy: function () {
            _v._$delEvent(document.body, 'click', this._bdClickHandler);
            delete this._bdClickHandler;
            clearTimeout(this._showTimer);
            clearTimeout(this._hideTimer);
            this.supr();
        },
        hide: function () {
            this.$emit('hide');
            this.destroy();
        }
    });
    return Menu;
},'ffa820b4cb293ae990489967d5c4a899','555a9eecaf26c5c01fe9db8d965bc30f','b9845e13e284410cb0bb909f737020e4','8cbc286a7834dfcf29c8f7a018e77c02','6adc1de08575db11d211d1a8eacae53c','8d15f0f5a20d44e7cdea4288c91bbad8');
I$('0177ada0cc9bcf4cf0e81b382a9eca41',function (_k, _u, _d, _proCache, _p, _pro) {
    _p._$$CacheHost = _k._$klass();
    _pro = _p._$$CacheHost._$extend(_d._$$Cache);
    _p._$cacheKey = 'host';

    /**
     * 初始化
     */
    _pro.__reset = function (options) {
        this.__super(options);
        this.__cacheKey = _p._$cacheKey;
    };

    /**
     * 根据参数, 获取请求 url
     *
     * @param {Object} options - 参数对象
     * @return {string} request url
     */
    _pro.__getUrl = function (options) {
        var url = '/api/hosts/' + (options.id || '');
        if (options.action) {
            url += ('?' + options.action);
        }
        return url;
    };

    /**
     * 删除数据返回后回调
     *
     * @param {Object} options - 参数对象
     * @success dispatch event: onitemdelete, listchange
     */
    _pro.__doDeleteItem = function (options) {
        var onload = options.onload;
        options.onload = function (result) {
            onload(result);
            var key = result[this.__key];
            delete this.__getHash()[key];
            var tmpProjCache = _proCache._$$CachePro._$allocate({});
            var proj = tmpProjCache._$getItemInCache(result.projectId);
            if (proj.hostId === key) {
                proj.hostId = 0;
            }
            tmpProjCache._$recycle();
        }.bind(this);
        this.__super(options);
    };

    /**
     * 批量删除
     *
     * @param {Object} options - 参数对象
     * @property {number} options.ids- 要删除的 id 列表
     * @success dispatch event: onitemsdelete, listchange
     */
    _pro._$deleteItems = function (options) {
        var onload = options.onload;
        options.onload = function (event) {
            onload && onload(event);
            var deletedList = event.data;
            var me = this;
            var hash = me.__getHash();
            var tmpProjCache = _proCache._$$CachePro._$allocate({});
            deletedList.forEach(function (result) {
                var key = result[me.__key];
                delete hash[key];
                var proj = tmpProjCache._$getItemInCache(result.projectId);
                if (proj.hostId === key) {
                    proj.hostId = 0;
                }
            });
            tmpProjCache._$recycle();
        }.bind(this);
        this.__super(options);
    };
},'5e5afc6c5ab9a60e963a7e2e41706b91','3ff9c25bd81a3c2a260c28122918263a','c6dbf51c390a9de703c7bf6c9b46ff41','09437bf7199eb808a35a38e5178e5151');
I$('6a8bb43cd97ae3b0de2a6a3e34992fa5',"/*\n\ngithub.com style (c) Vasily Polovnyov <vast@whiteants.net>\n\n*/\n\n.hljs {\n    display: block;\n    overflow-x: auto;\n    padding: 0.5em;\n    color: #333;\n    background: #f8f8f8;\n}\n\n.hljs-comment,\n.hljs-quote {\n    color: #998;\n    font-style: italic;\n}\n\n.hljs-keyword,\n.hljs-selector-tag,\n.hljs-subst {\n    color: #333;\n    font-weight: bold;\n}\n\n.hljs-number,\n.hljs-literal,\n.hljs-variable,\n.hljs-template-variable,\n.hljs-tag .hljs-attr {\n    color: #008080;\n}\n\n.hljs-string,\n.hljs-doctag {\n    color: #d14;\n}\n\n.hljs-title,\n.hljs-section,\n.hljs-selector-id {\n    color: #900;\n    font-weight: bold;\n}\n\n.hljs-subst {\n    font-weight: normal;\n}\n\n.hljs-type,\n.hljs-class .hljs-title {\n    color: #458;\n    font-weight: bold;\n}\n\n.hljs-tag,\n.hljs-name,\n.hljs-attribute {\n    color: #000080;\n    font-weight: normal;\n}\n\n.hljs-regexp,\n.hljs-link {\n    color: #009926;\n}\n\n.hljs-symbol,\n.hljs-bullet {\n    color: #990073;\n}\n\n.hljs-built_in,\n.hljs-builtin-name {\n    color: #0086b3;\n}\n\n.hljs-meta {\n    color: #999;\n    font-weight: bold;\n}\n\n.hljs-deletion {\n    background: #fdd;\n}\n\n.hljs-addition {\n    background: #dfd;\n}\n\n.hljs-emphasis {\n    font-style: italic;\n}\n\n.hljs-strong {\n    font-weight: bold;\n}\n");