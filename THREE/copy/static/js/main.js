THREE.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec4 rgbA = (1.0/2.0) * (","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));","vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +","texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));","float lumaB = dot(rgbB, vec4(luma, 0.0));","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = rgbA;","} else {","gl_FragColor = rgbB;","}","}"].join("\n")};
THREE.MaskShader={uniforms:{tCurrent:{type:"t",value:null},tCurrentBG:{type:"t",value:null},tNext:{type:"t",value:null},tMask:{type:"t",value:null}},vertexShader:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D tCurrent;","uniform sampler2D tCurrentBG;","uniform sampler2D tNext;","uniform sampler2D tMask;","varying vec2 vUv;","void main() {","vec4 colCurrent = texture2D(tCurrent,vUv);","vec4 colCurrentBG = texture2D(tCurrentBG,vUv);","vec4 colNext = texture2D(tNext,vUv);","float m = texture2D(tMask,vUv).a*(1.-colCurrent.a);","gl_FragColor = mix(mix(colCurrent,colCurrentBG,1.-colCurrent.a),colNext,m);","}"].join("\n")};
ShaderLib={MSKFragment:["precision highp float;","uniform sampler2D tCurrent;","uniform sampler2D tCurrentBG;","uniform sampler2D tNext;","uniform sampler2D tMask;","varying vec2 vUv;","void main() {","vec4 colCurrent = texture2D(tCurrent,vUv);","vec4 colCurrentBG = texture2D(tCurrentBG,vUv);","vec4 colNext = texture2D(tNext,vUv);","float m = texture2D(tMask,vUv).a*(1.-colCurrent.a);","gl_FragColor = mix(mix(colCurrent,colCurrentBG,1.-colCurrent.a),colNext,m);","}"].join("\n"),BTVertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix*modelViewMatrix*vec4(position, 1.0 );","}"].join("\n"),ATVertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute vec3 position;","attribute vec2 uv;","uniform float time;","uniform float totalFrame;","varying vec2 vUv;","void main() {","vUv = (uv+vec2(floor(time),0.))/vec2(totalFrame,1.);","gl_Position = projectionMatrix*modelViewMatrix*vec4(position, 1.0 );","}"].join("\n"),ATVSVertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute vec3 position;","attribute vec2 uv;","uniform float time;","uniform float totalFrame;","uniform float scale;","varying vec2 vUv;","void main(){","vUv = (uv+vec2(floor(time),0.))/vec2(totalFrame,1.);","vec3 alignedPosition = position*scale;","vec4 finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += alignedPosition.xy;","gl_Position =  projectionMatrix * finalPosition;","}"].join("\n"),BTVSVertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","uniform float scale;","attribute vec3 position;","attribute vec2 uv;","varying vec2 vUv;","void main(){","vUv = uv;","vec3 alignedPosition = position*scale;","vec4 finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += alignedPosition.xy;","gl_Position =  projectionMatrix * finalPosition;","}"].join("\n"),ABTFragment:["precision highp float;","varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse,vUv);","}"].join("\n"),BCVertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute vec3 position;","void main() {","gl_Position = projectionMatrix*modelViewMatrix*vec4(position, 1.0 );","}"].join("\n"),M401Vertex:["precision highp float;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","attribute float speed;","attribute vec3 position;","attribute vec3 offset;","attribute vec2 uv;","attribute vec3 rotation;","varying vec2 vUv;","uniform float time;","mat3 SetRot( const in vec3 r ){","float a = sin(r.x); float b = cos(r.x);","float c = sin(r.y); float d = cos(r.y);","float e = sin(r.z); float f = cos(r.z);","float ac = a*c;","float bc = b*c;","return mat3( d*f,d*e,-c,ac*f-b*e,ac*e+b*f,a*d,bc*f+a*e,bc*e-a*f,b*d);","}","void main() {","vUv = uv;","mat3 rot = SetRot(rotation*time);","vec3 newPosition = rot*offset+position;","newPosition.z+=time*speed;","gl_Position = projectionMatrix*modelViewMatrix*vec4(newPosition, 1.0 );","}"].join("\n"),BTDFragment:["precision highp float;","varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","vec4 col = texture2D(tDiffuse,vUv);","if(col.a<.3) discard;","gl_FragColor = vec4(col);","}"].join("\n"),BCFragment:["precision highp float;","uniform vec3 color;","void main() {","gl_FragColor = vec4(color,1.);","}"].join("\n"),INTROFragment:["precision highp float;","uniform sampler2D tDiffuse;","uniform vec2 center;","uniform float radius;","varying vec2 vUv;","void main() {","if(radius<length(gl_FragCoord.xy-center)){","gl_FragColor = vec4(1.);","}else{","gl_FragColor = texture2D(tDiffuse,vUv);","}","}"].join("\n"),GLITCHFragment:["precision highp float;","uniform sampler2D tDiffuse;","uniform sampler2D tDisp;","uniform float amount;","uniform float angle;","uniform float seed;","uniform float seed_x;","uniform float seed_y;","varying vec2 vUv;","float rand(vec2 co){","float a = dot(co.xy ,vec2(12.9898,78.233));","return fract((cos(a)) * 43758.5453);","}","void main() {","vec2 p = vUv;","float xs = floor(gl_FragCoord.x / 0.5);","float ys = floor(gl_FragCoord.y / 0.5);","vec4 normal = texture2D (tDisp, p*seed);","p.x+=normal.x*seed_x*(seed/15.);","p.y+=normal.y*seed_y*(seed/15.);","vec2 offset = amount * vec2( cos(angle), sin(angle));","vec4 cr = texture2D(tDiffuse, p + offset);","vec4 cga = texture2D(tDiffuse, p);","vec4 cb = texture2D(tDiffuse, p - offset);","gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a)+50.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);","}"].join("\n"),KAL0Fragment:["precision highp float;","uniform sampler2D tDiffuse;","uniform vec2 resolution;","uniform float time;","uniform float slices;","vec2 kaleido(vec2 uv){","float th = atan(uv.y, uv.x);","float r = length(uv);","float f = 3.14159 / slices;","th = abs(mod(th+ f/4.0 , f) - f/2.0) / (1. + r);","return vec2(cos(th), sin(th)) * r *.7;","}","vec2 transform(vec2 at){","vec2 v;","float th = time;","v.x = at.x * cos(th) - at.y * sin(th) - .2 * sin(th);","v.y = at.x * sin(th) + at.y * cos(th) + .2 * cos(th);","return v;","}","void main(){","vec2 uv = gl_FragCoord.xy / resolution;","uv.x = mix(-1.0, 1.0, uv.x);","uv.y = mix(1.0, -1.0, uv.y);","uv.y *= resolution.y / resolution.x;","gl_FragColor = texture2D(tDiffuse,transform(kaleido(uv)));","}"].join("\n"),KAL1Fragment:["precision highp float;","precision lowp int;","uniform sampler2D tDiffuse;","uniform float time;","uniform float aspect;","uniform float size;","#define DegreeToRad (3.14159/180.0)","#define Tau (3.14159 * 2.0)","#define cos30 (0.8660254) ","#define TILE_MAX_SIDES 8","struct Tile_t{","vec2  center; ","int   sides;","float len; ","float radius;","float inner;","float angle;","float horzangle; ","int   direction; ","};","Tile_t tile_LocateTriangle(vec2 aCoord,float radius){","Tile_t t;	","float sideLen = radius * 2.0 * cos30;","vec2 boxSize = vec2(sideLen, sideLen * cos30);","float row = floor(aCoord.y/boxSize.y);","bool evenRow = ((row - 2.0*floor(row/2.0)) < 0.01);","vec2 ctrAdjA = vec2(boxSize.x * 0.5, boxSize.y * (evenRow?1.0:2.0)/3.0);","vec2 coordA  = aCoord.xy;","vec2 boxA    = floor(coordA/boxSize);","vec2 ctrA    = boxA * boxSize + ctrAdjA;","float angleA = evenRow ? 90.0 : 270.0;","int   dirA   = 1;","int idx = int(boxA.x - 3.0 * floor(boxA.x/3.0));","dirA = evenRow ? 1 : -1;","angleA = 330.0 - float(idx) * 120.0;","if (!evenRow)	angleA = -angleA;","vec2 shiftB  = vec2(boxSize.x * 0.5, 0.0);","vec2 ctrAdjB = vec2(boxSize.x * 0.5, boxSize.y * (evenRow?2.0:1.0)/3.0);","vec2 coordB  = aCoord.xy + shiftB;","vec2 boxB    = floor((coordB)/boxSize);","vec2 ctrB    = boxB * boxSize - shiftB + ctrAdjB;","float angleB = evenRow ? 270.0 : 90.0;","int   dirB   = 1;","idx = int(boxB.x - 3.0 * floor((boxB.x)/3.0));","dirB = evenRow ? -1 : 1;","angleB = 150.0 + float(idx) * 120.0;","if (!evenRow)	angleB = -angleB;","bool chooseA = (distance(aCoord, ctrA) < distance(aCoord, ctrB));","vec2 ctr     = (chooseA) ? ctrA : ctrB;","float angle  = (chooseA) ? angleA : angleB;","int   dir    = (chooseA) ? dirA : dirB;","t.center    = ctr;","t.len       = sideLen;","t.sides     = 3;","t.radius    = radius;","t.inner     = sideLen/4.0;","t.angle     = angle;","t.horzangle = -90.0;","t.direction = dir;","return t;","}","vec2 tile_CalcVertex(Tile_t tile, int vertexIdx){","vec2 pt;","float angle;","angle = DegreeToRad * (tile.angle + float(vertexIdx) * float(tile.direction) * 360.0 / float(tile.sides));	","pt.x = tile.center.x + tile.radius * cos(angle);","pt.y = tile.center.y + tile.radius * sin(angle);","return pt;","}","float tile_CalcAngle(Tile_t tile, vec2 coord){","float angle = 0.0;","angle = atan(coord.y - tile.center.y, coord.x - tile.center.x) / DegreeToRad;","angle += tile.angle;","angle *= float(tile.direction);","return angle;","}","vec2 tile_CalcEdgeVector(Tile_t tile, int vertexIdx){","vec2 vect;","return vect;","}","vec2 tile_CalcRelPosition(Tile_t tile, vec2 coord, float twist){","vec2 relPos;","float angle = -(tile.angle + tile.horzangle + twist * float(tile.direction)) *  DegreeToRad;","float cA = cos(angle);","float sA = sin(angle);","mat2 rm = mat2(cA, sA, -sA, cA);","relPos = coord - tile.center;","relPos = rm * relPos;","if (tile.direction == -1)	relPos.x = -relPos.x;","return relPos;","}","vec2 tile_CalcRelPositionUV(Tile_t tile, vec2 coord, float twist){","vec2 relPos = tile_CalcRelPosition(tile, coord, twist);","vec2 uv = (relPos + vec2(tile.radius, tile.radius))/(tile.radius * 2.0);","return uv;","}","bool tile_ContainsPoint(Tile_t tile, vec2 coord){","bool contains = true;","return contains;","}","float tile_CalcDistanceToEdge(Tile_t tile, int vertexIdx, vec2 coord){","float d;","vec2 v1 = tile_CalcVertex(tile, vertexIdx);","vec2 v2 = tile_CalcVertex(tile, vertexIdx+1);","vec2 vhat = vec2(v2.y - v1.y, v1.x - v2.x);","vec2 r = v1 - coord;","d = abs(dot(vhat, r))/length(vhat);","return d;","}","float tile_CalcDistanceToClosestEdge(Tile_t tile, vec2 coord){","float closest;","float dist;","closest = tile_CalcDistanceToEdge(tile, 0, coord);","for (int i = 1; i < TILE_MAX_SIDES; i++){","if (i < tile.sides){","dist = tile_CalcDistanceToEdge(tile, i, coord);","if (dist < closest)		closest = dist;","}","}","return closest;","}","float tile_CalcDistanceToVertex(Tile_t tile, int vertexIdx, vec2 coord){","vec2 pt = tile_CalcVertex(tile, vertexIdx);","return distance(coord, pt);","}","float tile_CalcDistanceToClosestVertex(Tile_t tile, vec2 coord){","float closest;","float dist;","closest = tile_CalcDistanceToVertex(tile, 0, coord);","for (int i = 1; i < TILE_MAX_SIDES; i++){","if (i < tile.sides){","dist = tile_CalcDistanceToVertex(tile, i, coord);","if (dist < closest)	closest = dist;","}","}","return closest;","}","void main(){","vec2 cord = gl_FragCoord.xy-vec2(time,-time);","Tile_t tile = tile_LocateTriangle(cord,size);","vec2 uv = tile_CalcRelPositionUV(tile, cord, 0.0)*vec2(1.,aspect);","gl_FragColor = texture2D(tDiffuse, uv);","}"].join("\n")};
THREE.OBJLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(a,b,c,d){var e=this,f=new THREE.XHRLoader(e.manager);f.load(a,function(a){b(e.parse(a),e)},c,d)},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){function f(a){var b=parseInt(a);return 3*(b>=0?b-1:b+m.length/3)}function g(a){var b=parseInt(a);return 3*(b>=0?b-1:b+n.length/3)}function h(a){var b=parseInt(a);return 2*(b>=0?b-1:b+o.length/2)}function i(a,b,c){d.vertices.push(m[a],m[a+1],m[a+2],m[b],m[b+1],m[b+2],m[c],m[c+1],m[c+2])}function j(a,b,c){d.normals.push(n[a],n[a+1],n[a+2],n[b],n[b+1],n[b+2],n[c],n[c+1],n[c+2])}function k(a,b,c){d.uvs.push(o[a],o[a+1],o[b],o[b+1],o[c],o[c+1])}function l(a,b,c,d,e,l,m,n,o,p,q,r){var v,s=f(a),t=f(b),u=f(c);void 0===d?i(s,t,u):(v=f(d),i(s,t,v),i(t,u,v)),void 0!==e&&(s=h(e),t=h(l),u=h(m),void 0===d?k(s,t,u):(v=h(n),k(s,t,v),k(t,u,v))),void 0!==o&&(s=g(o),t=g(p),u=g(q),void 0===d?j(s,t,u):(v=g(r),j(s,t,v),j(t,u,v)))}var b,c,d,e,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(console.time("OBJLoader"),c=[],/^o /gm.test(a)===!1&&(d={vertices:[],normals:[],uvs:[]},e={name:""},b={name:"",geometry:d,material:e},c.push(b)),m=[],n=[],o=[],p=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,q=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,r=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,s=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,t=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,u=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,v=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,w=a.split("\n"),x=0;x<w.length;x++)y=w[x],y=y.trim(),0!==y.length&&"#"!==y.charAt(0)&&(null!==(z=p.exec(y))?m.push(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3])):null!==(z=q.exec(y))?n.push(parseFloat(z[1]),parseFloat(z[2]),parseFloat(z[3])):null!==(z=r.exec(y))?o.push(parseFloat(z[1]),parseFloat(z[2])):null!==(z=s.exec(y))?l(z[1],z[2],z[3],z[4]):null!==(z=t.exec(y))?l(z[2],z[5],z[8],z[11],z[3],z[6],z[9],z[12]):null!==(z=u.exec(y))?l(z[2],z[6],z[10],z[14],z[3],z[7],z[11],z[15],z[4],z[8],z[12],z[16]):null!==(z=v.exec(y))?l(z[2],z[5],z[8],z[11],void 0,void 0,void 0,void 0,z[3],z[6],z[9],z[12]):/^o /.test(y)?(d={vertices:[],normals:[],uvs:[]},e={name:""},b={name:y.substring(2).trim(),geometry:d,material:e},c.push(b)):/^g /.test(y)||(/^usemtl /.test(y)?e.name=y.substring(7).trim():/^mtllib /.test(y)||/^s /.test(y)));for(A=[],x=0,B=c.length;B>x;x++)b=c[x],d=b.geometry,C=new THREE.BufferGeometry,C.addAttribute("position",new THREE.BufferAttribute(new Float32Array(d.vertices),3)),d.normals.length>0&&C.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(d.normals),3)),d.uvs.length>0&&C.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(d.uvs),2)),D=new THREE.Mesh(C),D.name=b.name,A.push(D);return console.timeEnd("OBJLoader"),A}};
THREE.AnimationSheetShader={vertexShader:["varying vec2 vUv;","uniform float time;","uniform float totalFrame;","void main() {","vUv = (uv+vec2(floor(time),0.))/vec2(totalFrame,1.);","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(tDiffuse,vUv);","}"].join("\n")};

//main.js
function enableKal(){$(".kal-wrapper").hide(),kalEffect?(hasKal=1,mixKal0Mat.uniforms.slices.value=2.5+Math.floor(4*Math.random())):(hasKal=2,mixKal1Mat.uniforms.size.value=60*Math.random()+60),kalEffect=!kalEffect,speed3=.15}function disableKal(){$(".kal-wrapper").show(),clearTimeout(kalTimeout),hasKal=0,speed3=1}function onTouchStart(a){ga&&ga("send","event","tips","tips_Press"),a.preventDefault(),mouseX=a.touches[0].pageX,mouseY=a.touches[0].pageY,hasKal||(kalTimeout=setTimeout(enableKal,100)),firstRun&&(firstRun=!1,music.stop(),music=createjs.Sound.play("bgm","none",0,0,999999))}function onTouchMove(a){var b,c,d,e;a.preventDefault(),b=a.touches[0].pageX,c=a.touches[0].pageY,d=Math.abs(c-mouseY),e=Math.abs(b-mouseX),(e>25||d>25)&&disableKal(),speed2=Math.min(2,Math.max(0,d/3)),mouseY=c,mouseX=b}function onTouchEnd(a){a.preventDefault(),disableKal()}function onResize3D(){viewWth=$(window).width(),viewHgh=$(window).height(),renderer.setSize(viewWth,viewHgh),currentRenderTarget.setSize(pixelRatio*viewWth,pixelRatio*viewHgh),currentBGRenderTarget.setSize(pixelRatio*viewWth,pixelRatio*viewHgh),nextRenderTarget.setSize(pixelRatio*viewWth,pixelRatio*viewHgh),maskRenderTarget.setSize(pixelRatio*viewWth,pixelRatio*viewHgh),mixRenderTarget2.setSize(pixelRatio*viewWth,pixelRatio*viewHgh),mixKal0Mat.uniforms.resolution.value.set(pixelRatio*viewWth,pixelRatio*viewHgh),mixIntroMat.uniforms.center.value.set(pixelRatio*viewWth/2,pixelRatio*viewHgh/2),mixKal1Mat.uniforms.aspect.value=cameraBG.aspect=cameraStage.aspect=viewWth/viewHgh,cameraStage.updateProjectionMatrix(),cameraBG.updateProjectionMatrix()}function onLoadComplete(){loaderQueue.removeEventListener("complete",onLoadComplete),feedTextureImage(),stage2Loaded=!0,stage3Loaded=!0,INFINITYSIA.dispatchEvent("loading_complete"),init()}function feedTextureImage(){var a,b;for(a in preloadTable)b=getImageTexture(a),b&&(preloadTable[a].image=b,preloadTable[a].needsUpdate=!0,delete preloadTable[a])}function startMainReplay(){for(var a=0;numScene>a;a++)disposeStage(a);currentSceneIndex=0,initStage(),isEnd=!1}function prepare(){loaderQueue=new createjs.LoadQueue(!1),loaderQueue.loadFile({src:INFINITYSIA.staticPrefix+"assets/parser.obj",id:"MODEL_STAGE"}),loaderQueue.addEventListener("complete",onLoadComplete)}function initScene(){for(var a=0;numScene>a;a++)sceneStage[a]=new THREE.Scene,sceneMask[a]=new THREE.Scene,sceneLogo[a]=new THREE.Scene,sceneBg[a]=new THREE.Scene;currentRenderTarget=new THREE.WebGLRenderTarget(1,1,{format:THREE.RGBAFormat}),currentBGRenderTarget=new THREE.WebGLRenderTarget(1,1,{format:THREE.RGBFormat}),nextRenderTarget=new THREE.WebGLRenderTarget(1,1,{format:THREE.RGBFormat}),maskRenderTarget=new THREE.WebGLRenderTarget(1,1,{format:THREE.RGBAFormat}),mixRenderTarget2=new THREE.WebGLRenderTarget(1,1,{format:THREE.RGBFormat}),cameraStage=new THREE.PerspectiveCamera(80,1,.1,2500),cameraBG=new THREE.PerspectiveCamera(70,1,.1,900),cameraBG.position.set(0,0,100)}function initMixer(){var a,b;sceneMix=new THREE.Scene,cameraMix=new THREE.OrthographicCamera(-1,1,1,-1,0,1),mixRenderTarget=new THREE.WebGLRenderTarget(512,1024,{format:THREE.RGBFormat}),mixRenderTarget.texture.wrapS=mixRenderTarget.texture.wrapT=THREE.MirroredRepeatWrapping,a=new THREE.PlaneBufferGeometry(2,2),b=new THREE.Mesh(a),b.matrixAutoUpdate=!1,b.updateMatrix(),sceneMix.add(b),mixMaskMat=matTable["msk"],mixMaskMat.uniforms={tCurrent:{type:"t",value:currentRenderTarget.texture},tCurrentBG:{type:"t",value:currentBGRenderTarget.texture},tNext:{type:"t",value:nextRenderTarget.texture},tMask:{type:"t",value:maskRenderTarget.texture}},mixSingleMat=matTable["mbt"].clone(),mixSingleMat.depthWrite=!1,mixSingleMat.depthTest=!1,mixSingleMat.uniforms.tDiffuse.value=currentRenderTarget.texture,mixKal0Mat=matTable["mkal0"],mixKal0Mat.uniforms.tDiffuse.value=mixRenderTarget.texture,mixKal1Mat=matTable["mkal1"],mixKal1Mat.uniforms.tDiffuse.value=mixRenderTarget.texture,mixIntroMat=matTable["mintr"],mixIntroMat.uniforms.tDiffuse.value=mixRenderTarget2.texture}function renderMixer(a,b){sceneMix.overrideMaterial=hasMask?mixMaskMat:mixSingleMat,hasIntro?(renderer.render(sceneMix,cameraMix,mixRenderTarget2,!0),sceneMix.overrideMaterial=mixIntroMat):1==hasKal?(renderer.render(sceneMix,cameraMix,mixRenderTarget,!0),sceneMix.overrideMaterial=mixKal0Mat,mixKal0Mat.uniforms.time.value=.5*b):2==hasKal&&(renderer.render(sceneMix,cameraMix,mixRenderTarget,!0),sceneMix.overrideMaterial=mixKal1Mat),renderer.render(sceneMix,cameraMix,null,!0)}function renderStage(a,b){var c,d,e,f,g,h,i,j;13>currentSceneIndex?(c=sceneStage[currentSceneIndex],d=sceneMask[currentSceneIndex],e=sceneBg[currentSceneIndex],f=sceneLogo[currentSceneIndex],g=cameraStage.position.z-d.children[0].position.z,maskNearZ>g?(disposeStage(currentSceneIndex),currentSceneIndex++,renderStage(a,b)):g>maskFarZ?(hasMask=!1,renderScene(e,a,b),renderScene(f,a,b),renderScene(c,a,b),renderer.render(e,cameraBG,currentRenderTarget,!0),renderer.render(f,cameraStage,currentRenderTarget,!1),renderer.render(c,cameraStage,currentRenderTarget,!1)):(h=sceneLogo[currentSceneIndex+1],i=sceneBg[currentSceneIndex+1],j=sceneStage[currentSceneIndex+1],hasMask=!0,renderScene(e,a,b),renderScene(f,a,b),renderScene(c,a,b),renderScene(d,a,b),renderScene(i,a,b),renderScene(h,a,b),renderScene(j,a,b),renderer.render(e,cameraBG,currentBGRenderTarget,!0),renderer.render(f,cameraStage,currentBGRenderTarget,!1),renderer.render(c,cameraStage,currentRenderTarget,!0),renderer.render(i,cameraBG,nextRenderTarget,!0),renderer.render(h,cameraStage,nextRenderTarget,!1),renderer.render(j,cameraStage,nextRenderTarget,!1),renderer.render(d,cameraStage,maskRenderTarget,!0))):(hasMask=!1,renderer.render(sceneBg[13],cameraBG,currentRenderTarget,!0),renderer.render(sceneStage[13],cameraStage,currentRenderTarget,!1))}function disposeStage(a){disposeScene(sceneStage[a]),disposeScene(sceneLogo[a]),disposeScene(sceneBg[a]),disposeScene(sceneMask[a])}function disposeScene(a){for(;a.children.length;){var b=a.children.shift();a.remove(b)}}function renderScene(a,b,c){var d,e,f,g;for(d=0;d<a.children.length;d++)for(e=a.children[d],f=0;f<e.userData.animID.length;f++)g=animTable[e.userData.animID[f]],g&&g.update(e,b,c)}function debugShowScene(a,b,c){currentSceneIndex=a,renderScene(sceneStage[a],b,c),renderScene(sceneLogo[a],b,c),renderScene(sceneBg[a],b,c),renderer.render(sceneBg[a],cameraBG,null,!0),renderer.render(sceneLogo[a],cameraStage,null,!1),renderer.render(sceneStage[a],cameraStage,null,!1)}function addToStage(a,b,c,d,e){switch(b){case"s":sceneStage[c].add(a);break;case"l":sceneLogo[c].add(a);break;case"m":sceneMask[c].add(a);break;case"b":sceneBg[c].add(a)}a.userData.animID=d,a.matrixAutoUpdate=d.length>0,a.updateMatrix();for(var f=0;f<d.length;f++)animTable[d[f]]&&"config"in animTable[d[f]]&&animTable[d[f]].config(a,e)}function getMeshInfo(a){var b,c,d={uuid:"",meshCount:1,animID:[],matID:"mbt"},e=a.substr(0,a.indexOf(".")).split("_");for(b=0;b<e.length;b++)switch(c=e[b],c.charAt(0)){case"s":d.uuid+=c,d.sceneType=c.charAt(1);break;case"l":d.uuid+=c,d.sceneID=parseInt(c.substr(1,c.length));break;case"c":d.colorID=c;break;case"t":d.texID=c,d.uuid+=c;break;case"m":d.matID=c;break;case"r":d.meshCount=parseInt(c.substr(1,c.length));break;case"a":d.uuid+=c,d.animID.push(c);break;case"d":d.animSet=parseInt(c.substr(1,c.length));break;case"g":d.geomID=c,d.geomType=c.charAt(1);break;case"u":d.uuid+=c}return d}function initStage(){var a,b,c,d,e,f,g,h,i,j,k=new THREE.OBJLoader,l=k.parse(loaderQueue.getResult("MODEL_STAGE"));for(a=0;a<l.length;a++){if(b=l[a],d=b.geometry.center(),e=getMeshInfo(b.name),"undefined"!=typeof e.geomID)switch(e.geomType){case"p":c=new THREE.Points(geomTable[e.geomID]);break;case"l":c=new THREE.Line(geomTable[e.geomID]);break;case"m":c=new THREE.Mesh(geomTable[e.geomID])}else"undefined"==typeof geomTable[e.uuid]?geomTable[e.uuid]=b.geometry:(b.geometry.dispose(),b.geometry=geomTable[e.uuid]),c=b;if("undefined"!=typeof e.matID&&(c.material=matTable[e.matID].clone(),c.material.depthWrite="b"!=e.sceneType,c.material.side=THREE.DoubleSide),"undefined"!=typeof e.texID?("undefined"==typeof textureTable[e.texID]&&(f=getImageTexture(e.texID),g=new THREE.Texture(getImageTexture(e.texID)),("mats"==e.matID||"mat"==e.matID)&&(g.wrapT=g.wrapS=THREE.RepeatWrapping),f?g.needsUpdate=!0:preloadTable[e.texID]=g,textureTable[e.texID]=g),c.material.transparent=!0,c.material.uniforms.tDiffuse.value=textureTable[e.texID]):c.material.uniforms.color.value=new THREE.Color(colorTable[e.colorID]),e.meshCount>1)for(h=2*Math.PI/e.meshCount,i=0;i<e.meshCount;i++)j=new THREE.Object3D,j.position.set(0,0,-d.z),j.rotation.z=i*h,c.position.set(-d.x,-d.y,0),c.userData.initPosition=c.position.clone(),j.add(c.clone()),j.userData.initPosition=j.position.clone(),addToStage(j,e.sceneType,e.sceneID,e.animID,e.animSet);else c.position.sub(d),c.userData.initPosition=c.position.clone(),addToStage(c,e.sceneType,e.sceneID,e.animID,e.animSet)}cameraStage.position.z=50}function init(){renderer=new THREE.WebGLRenderer({antialias:!1}),renderer.setClearColor(16777215,0),renderer.setPixelRatio(pixelRatio),renderer.autoClear=!1,D3.appendChild(renderer.domElement),createjs.Ticker.setFPS(40),initScene(),initMixer(),initStage(),onResize3D(),window.addEventListener("resize",onResize3D,!1),clock=new THREE.Clock,render(),INFINITYSIA.addEventListener("main_play",startMainPlay),INFINITYSIA.addEventListener("main_replay",startMainReplay)}function startMainPlay(){window.addEventListener("touchstart",onTouchStart),window.addEventListener("touchmove",onTouchMove),window.addEventListener("touchend",onTouchEnd),INFINITYSIA.removeEventListener("main_play",startMainPlay),animate(),createjs.Tween.get(mixIntroMat.uniforms.radius).to({value:viewHgh*pixelRatio},1e3).call(function(){hasIntro=!1})}function animate(){isEnd||(requestAnimationFrame(animate),render())}function render(){var a,b;isEnd||(a=clock.getDelta(),b=Math.min(3,a/.0167),speed+=cameraStage.position.z<-280&&cameraStage.position.z>-405||cameraStage.position.z<-910&&cameraStage.position.z>-1040||cameraStage.position.z<-1500&&cameraStage.position.z>-1590||cameraStage.position.z<-2e3&&cameraStage.position.z>-2090||cameraStage.position.z<-4460&&cameraStage.position.z>-4575||cameraStage.position.z<-5650&&cameraStage.position.z>-5750||cameraStage.position.z<-6165&&cameraStage.position.z>-6270||cameraStage.position.z<-6480&&cameraStage.position.z>-6590?.1*(.4-speed)*b:cameraStage.position.z<-3501&&cameraStage.position.z>-3609?.1*(.5-speed)*b:cameraStage.position.z<-3801&&cameraStage.position.z>-4023?.2*(.6-speed)*b:cameraStage.position.z<-2770&&cameraStage.position.z>-3100?.03*(3.5-speed)*b:.05*(2.2-speed)*b,cameraStage.position.z>-7200?!stage2Loaded&&cameraStage.position.z<-3050||!stage3Loaded&&cameraStage.position.z<-5400||(cameraStage.position.z-=b*(speed+speed2)*speed3):isEnd||(window.removeEventListener("touchstart",onTouchStart),window.removeEventListener("touchmove",onTouchMove),window.removeEventListener("touchend",onTouchEnd),INFINITYSIA.dispatchEvent("ending_play"),isEnd=!0),speed2+=.03*(0-speed2)*b,a=clock.getElapsedTime(),cameraStage.rotation.z=cameraStage.position.z<-300&&cameraStage.position.z>-1e3?2*Math.PI/-700*cameraStage.position.z-6*Math.PI/7:cameraStage.position.z<-4e3&&cameraStage.position.z>-5100?4*Math.PI/1100*cameraStage.position.z+160*Math.PI/11:cameraStage.position.z<-5600&&cameraStage.position.z>-6600?4*Math.PI/-1e3*cameraStage.position.z-224*Math.PI/10:cameraStage.position.z<-6600&&cameraStage.position.z>-7200?.5*Math.PI/-600*cameraStage.position.z-33*Math.PI/6:0,renderStage(b,a),renderMixer(b,a)),cameraStage.position.z<0&&track("/start"),cameraStage.position.z<-280&&track("/IP1-爸爸去哪儿"),cameraStage.position.z<-910&&track("/IP2-奇星记"),cameraStage.position.z<-1500&&track("/IP3-我们的挑战"),cameraStage.position.z<-2e3&&track("/IP4-三生三世"),cameraStage.position.z<-3501&&track("/IP5-欢乐喜剧人"),cameraStage.position.z<-3801&&track("/IP10-好笑头条君"),cameraStage.position.z<-4460&&track("/IP6-火星情报局"),cameraStage.position.z<-5650&&track("/IP7-热血长安"),cameraStage.position.z<-6165&&track("/IP8-飞刀又见飞刀"),cameraStage.position.z<-6480&&track("/IP9-武动乾坤"),cameraStage.position.z<-7e3&&track("/end")}function track(a){trackObj[a]||(trackObj[a]=a,ga&&ga("send","pageview",a))}function getImageTexture(a){var b,c;return null==b?imageTable[a]?(c=new Image,c.src=imageTable[a],c):imageTable2[a]?(c=new Image,c.src=imageTable2[a],c):(console.log("no image:"+a),null):b}var renderer,clock,cameraStage,cameraMix,cameraBG,orientControl,sceneMix,viewWth,viewHgh,currentRenderTarget,currentBGRenderTarget,nextRenderTarget,maskRenderTarget,mixRenderTarget,mixRenderTarget2,mouseY,mouseX,loaderQueue,mixMaskMat,mixSingleMat,mixKal0Mat,mixIntroMat,stats,textureTable,preloadTable,colorTable,matTable,animTable,geomTable,trackObj={},pixelRatio=1.5,maskNearZ=1,maskFarZ=2e3,numScene=14,currentSceneIndex=0,sceneStage=[],sceneMask=[],sceneBg=[],sceneLogo=[],kalTimeout=-1,kalEffect=!0,kalCount=0,firstRun=!0,stage2Loaded=!1,stage3Loaded=!1,hasMask=!1,hasKal=0,hasIntro=!0,speed=0,speed2=0,speed3=1,isEnd=!1;prepare(),textureTable={},preloadTable={},colorTable={c000:16777215,c0001:3120611,c0002:15851823,c0003:15931737,c0004:12795776,c0100:2841323,c0101:16726196,c0102:2660606,c0103:16698635,c0104:16268400,c0105:2841323,c0106:16726196,c0107:2660606,c0108:16698635,c0109:16268400,c0200:9854,c0201:16646144,c0202:872959,c0203:4048217,c0204:13103616,c0205:9854,c0206:16646144,c0207:872959,c0208:4048217,c0209:13103616,c0300:16771072,c0301:99839,c0302:11484,c0303:8192197,c0304:15933045,c0305:16771072,c0306:99839,c0307:11484,c0308:8192197,c0309:15933045,c0400:16679315,c0401:16654405,c0402:16679315,c0403:4288497,c0404:2158010,c0405:16679315,c0406:16654405,c0407:16679315,c0408:4288497,c0409:2158010,c0500:16721036,c0501:16737380,c0502:16618762,c0503:16774665,c0600:16646144,c0601:14322488,c0602:9961983,c0603:16744158,c0604:16243820,c0605:16646144,c0606:14322488,c0607:9961983,c0608:16744158,c0609:16243820,c0700:11927788,c0701:9961983,c0702:16724272,c0703:571633,c0704:9961983,c0705:16724272,c0706:571633,c0707:9961983,c0708:16724272,c0709:571633,c0710:9961983,c0800:2372804,c0801:1033712,c0802:12451328,c0803:2372804,c0804:1033712,c0805:12451328,c0806:2372804,c0807:1033712,c0808:12451328,c0809:2372804,c0900:14610950,c0901:3264159,c0902:1746796,c0903:2062920,c0904:6318140,c0905:8479801,c0906:5785404,c0907:12139056,c0908:15994894,c0909:14610950,c1000:15204352,c1001:7673087,c1002:90623,c1003:59064,c1004:15204352,c1005:7673087,c1006:90623,c1007:59064,c1008:15204352,c1009:7673087,c1100:82687,c1101:8323327,c1102:16742400,c1103:82687,c1104:8323327,c1105:16742400,c1106:82687,c1107:8323327,c1108:16742400,c1109:82687},matTable={mbt:new THREE.RawShaderMaterial({vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.ABTFragment,uniforms:{tDiffuse:{value:null,type:"t"}}}),mbts:new THREE.RawShaderMaterial({vertexShader:ShaderLib.BTVSVertex,fragmentShader:ShaderLib.ABTFragment,uniforms:{tDiffuse:{value:null,type:"t"},scale:{value:1}}}),mbc:new THREE.RawShaderMaterial({vertexShader:ShaderLib.BCVertex,fragmentShader:ShaderLib.BCFragment,uniforms:{color:{value:null,type:"c"}}}),mat:new THREE.RawShaderMaterial({vertexShader:ShaderLib.ATVertex,fragmentShader:ShaderLib.ABTFragment,uniforms:{totalFrame:{value:1,type:"f"},time:{value:0,type:"f"},tDiffuse:{value:null,type:"t"}}}),mat2:new THREE.RawShaderMaterial({vertexShader:ShaderLib.ATVertex,fragmentShader:ShaderLib.BTDFragment,uniforms:{totalFrame:{value:1,type:"f"},time:{value:0,type:"f"},tDiffuse:{value:null,type:"t"}}}),mbts2:new THREE.RawShaderMaterial({vertexShader:ShaderLib.BTVSVertex,fragmentShader:ShaderLib.BTDFragment,uniforms:{tDiffuse:{value:null,type:"t"},scale:{value:1}}}),mats:new THREE.RawShaderMaterial({vertexShader:ShaderLib.ATSVertex,fragmentShader:ShaderLib.ABTFragment,uniforms:{scale:{value:1},totalFrames:{value:null,type:"f"},time:{value:null,type:"f"},tDiffuse:{value:null,type:"t"}}}),msk:new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.MSKFragment}),mkal0:new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.KAL0Fragment,uniforms:{tDiffuse:{value:null,type:"t"},resolution:{value:new THREE.Vector2(1,1),type:"v2"},time:{value:0,type:"f"},slices:{value:3.5,type:"f"}}}),mkal1:new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:ShaderLib.BCVertex,fragmentShader:ShaderLib.KAL1Fragment,uniforms:{tDiffuse:{value:null,type:"t"},aspect:{value:1,type:"f"},size:{value:30,type:"f"},time:{value:0,type:"f"}}}),mintr:new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.INTROFragment,uniforms:{tDiffuse:{value:null,type:"t"},center:{value:new THREE.Vector2(1,1),type:"v2"},radius:{value:0,type:"f"}}}),mgli:new THREE.RawShaderMaterial({depthWrite:!1,depthTest:!1,vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.GLITCHFragment,uniforms:{tDiffuse:{value:null,type:"t"},tDisp:{value:null,type:"t"},amount:{value:.02,type:"f"},angle:{value:.4,type:"f"},seed:{value:.01,type:"f"},seed_x:{value:.01,type:"f"},seed_y:{value:.01,type:"f"}}}),m401:new THREE.RawShaderMaterial({side:THREE.DoubleSide,transparent:!0,vertexShader:ShaderLib.M401Vertex,fragmentShader:ShaderLib.BTDFragment,uniforms:{tDiffuse:{value:null,type:"t"},time:{value:1,type:"f"}}}),m501:new THREE.RawShaderMaterial({vertexShader:ShaderLib.BTVertex,fragmentShader:ShaderLib.BTDFragment,uniforms:{tDiffuse:{value:null,type:"t"}}})},animTable={a000:{transform:[{x:259,r:-.675,y:-50.8},{x:259,r:-.674,y:-50.6},{x:260,r:-.669,y:-50.7},{x:263,r:-.656,y:-52},{x:266,r:-.639,y:-53.9},{x:272,r:-.613,y:-56.6},{x:280,r:-.577,y:-60.3},{x:294,r:-.508,y:-69.1},{x:314,r:-.403,y:-83.7},{x:334,r:-.289,y:-101},{x:348,r:-.201,y:-116},{x:357,r:-.136,y:-127},{x:362,r:-.101,y:-133},{x:364,r:-.0874,y:-136},{x:365,r:-.0843,y:-138},{x:364,r:-.0837,y:-136},{x:364,r:-.088,y:-136},{x:363,r:-.0968,y:-134},{x:360,r:-.11,y:-132},{x:358,r:-.132,y:-128},{x:353,r:-.162,y:-122},{x:346,r:-.211,y:-114},{x:333,r:-.293,y:-101},{x:314,r:-.402,y:-83.9},{x:294,r:-.503,y:-69.9},{x:279,r:-.577,y:-60.6},{x:268,r:-.63,y:-55.1},{x:261,r:-.66,y:-51.9},{x:259,r:-.67,y:-51.4},{x:259,r:-.675,y:-50.8}],update:function(a,b,c){var d=animTable.a000.transform[Math.floor(20*c-a.userData.initPosition.z/50)%animTable.a000.transform.length];a.position.x=a.userData.initPosition.x+(.06*d.x-12)*a.userData.dir,a.position.y=a.userData.initPosition.y+.06*d.y+4,a.rotation.z=a.userData.dir*d.r},config:function(a,b){a.userData.dir=0==b?1:-1,a.scale.x=a.userData.dir}},a001:{transform:[{x:0,r:.262,y:0},{x:-.35,r:.259,y:1.8},{x:-1.6,r:.258,y:1.85},{x:-4.05,r:.254,y:1.85},{x:-8.1,r:.249,y:1.8},{x:-14.5,r:.24,y:1.6},{x:-24.9,r:.223,y:1.1},{x:-42.7,r:.197,y:-.55},{x:-70.1,r:.157,y:-4.7},{x:-102,r:.109,y:-12.1},{x:-126,r:.0701,y:-20.1},{x:-142,r:.0442,y:-26},{x:-153,r:.0268,y:-30.6},{x:-160,r:.0138,y:-34.1},{x:-166,r:.00508,y:-36.6},{x:-169,r:458e-6,y:-38.3},{x:-170,r:0,y:-38.7},{x:-170,r:214e-6,y:-38.5},{x:-168,r:946e-6,y:-37.5},{x:-164,r:.00902,y:-35.8},{x:-157,r:.0183,y:-32.8},{x:-146,r:.0395,y:-27.5},{x:-122,r:.075,y:-18.5},{x:-85.1,r:.132,y:-7.8},{x:-51,r:.184,y:-1.45},{x:-29.8,r:.215,y:.8},{x:-16.4,r:.236,y:1.65},{x:-7.25,r:.249,y:1.9},{x:-1.85,r:.258,y:1.9},{x:0,r:.262,y:0}],update:function(a,b,c){var d=animTable.a001.transform[Math.floor(20*c-a.userData.initPosition.z/50)%animTable.a001.transform.length];a.position.x=a.userData.initPosition.x+(.06*d.x-5)*a.userData.dir,a.position.y=a.userData.initPosition.y+.06*d.y-8,a.rotation.z=a.userData.dir*(d.r-1.6)},config:function(a,b){a.userData.dir=0==b?1:-1,a.scale.x=a.userData.dir}},a002:{update:function(a,b,c){a.material.uniforms.time.value=15*c+.05*a.position.z},config:function(a){a.material.uniforms.totalFrame.value=15}},a003:{update:function(a,b,c){a.material.uniforms.time.value=5.5*c+.05*a.position.z},config:function(a){a.material.uniforms.totalFrame.value=6}},a004:{update:function(a,b,c){a.material.uniforms.time.value=15*c+.05*a.position.z},config:function(a){a.material.uniforms.totalFrame.value=15,a.scale.x=a.position.x<0?-1:1}},a006:{update:function(a,b,c){a.position.y=a.userData.initPosition.y+10*Math.sin(5*c+.05*a.userData.initPosition.z)},config:function(){}},a007:{update:function(a){a.position.z=a.userData.initPosition.z+Math.max(cameraStage.position.z,a.userData.zlimit)-100},config:function(a,b){a.userData.zlimit=-280+50*(7-b)}},a008:{update:function(a,b,c){a.rotation.z=.1*-c}},a009:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a010:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a011:{update:function(a,b,c){a.material.uniforms.time.value=5.5*c},config:function(a){a.material.uniforms.totalFrame.value=6}},a012:{update:function(a,b,c){a.material.uniforms.time.value=5.5*c},config:function(a){a.material.uniforms.totalFrame.value=1}},a013:{update:function(a,b,c){a.rotation.z=.3*-c}},a101:{update:function(a,b,c){a.rotation.z=.1*-c}},a102:{update:function(a,b,c){var d=.2*Math.sin(2*c)+1;a.position.x=Math.sin(a.userData.angle)*a.userData.radius*d,a.position.y=Math.cos(a.userData.angle)*a.userData.radius*d,a.rotation.z=2*d-2},config:function(a){a.userData.radius=Math.sqrt(a.position.x*a.position.x+a.position.y*a.position.y),a.userData.angle=Math.atan2(a.position.y,a.position.x)}},a103:{update:function(a,b,c){a.rotation.z=.5*c+a.position.z/80}},a104:{update:function(a,b,c){a.rotation.z=-c+a.position.z/180-.2}},a105:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a106:{update:function(a,b,c){a.rotation.z=.3*-c}},a107:{update:function(a,b,c){a.rotation.z=.5*-c}},a108:{update:function(a,b){cameraStage.position.z<-910&&(a.rotation.z-=.02*b)}},a200:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed,cameraStage.position.z<-1020&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},1e3,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=5*(-a.position.z-1100),a.material.uniforms.totalFrame.value=18,a.userData.rotSpeed=a.position.x>0?-3:3}},a202:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a203:{update:function(a,b,c){a.rotation.z=.1*c}},a204:{update:function(a,b,c){a.rotation.z=.5*c}},a205:{update:function(a,b){cameraStage.position.z<-1500&&(a.rotation.z-=.025*b)}},a300:{update:function(a,b,c){a.rotation.z=.1*c}},a301:{update:function(a,b,c){createjs.Tween.hasActiveTweens([a.position])||(a.position.y=a.userData.initPosition.y+5*Math.sin(5*c+.05*a.position.z))}},a302:{update:function(){}},a303:{update:function(){}},a304:{update:function(a,b,c){a.rotation.z=.6*c}},a305:{update:function(a,b,c){a.rotation.z=.6*-c}},a306:{update:function(a,b,c){a.rotation.z=.3*c}},a307:{update:function(a,b,c){a.rotation.z=.25*c}},a308:{update:function(a,b,c){a.rotation.z=.2*c}},a309:{update:function(a,b,c){a.rotation.z=.15*c}},a310:{update:function(a,b,c){a.rotation.z=.3*c,a.scale.x=a.scale.y=.05*Math.sin(4*c)+1}},a311:{update:function(a,b,c){a.rotation.z=.3*-c,a.scale.x=a.scale.y=.05*Math.cos(4*c)+1}},a312:{update:function(a,b,c){a.rotation.z=.4*c}},a400:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b?.4:-.4}},a401:{update:function(a,b){a.material.uniforms.time.value+=b*a.userData.speed*speed3,4==currentSceneIndex&&(a.userData.speed+=.03*(.1-a.userData.speed))},config:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=new Float32Array([-1,0,-1,1,0,-1,-1,0,1,1,0,1]),n=new Float32Array([0,0,1,0,0,1,1,1]),o=350,p=new Float32Array(12*o),q=new Float32Array(12*o),r=new Float32Array(8*o),s=new Float32Array(12*o),t=new Float32Array(4*o),u=new Uint16Array(6*o);for(b=0;o>b;b++){for(c=100*Math.random()-50,d=100*Math.random()-50,e=500*Math.random()-250,f=6*(Math.random()+.1),g=2*Math.random()-1,h=2*Math.random()-1,i=3*Math.random()-1.5,j=20*Math.random(),k=0;4>k;k++)l=4*b+k,t[l]=j,s[3*l]=g,s[3*l+1]=h,s[3*l+1]=i,q[3*l]=c,q[3*l+1]=d,q[3*l+2]=e,p[3*l]=m[3*k]*f,p[3*l+1]=m[3*k+1]*f,p[3*l+2]=m[3*k+2]*f,r[2*l]=n[2*k],r[2*l+1]=n[2*k+1];u[6*b]=4*b,u[6*b+1]=4*b+2,u[6*b+2]=4*b+1,u[6*b+3]=4*b+2,u[6*b+4]=4*b+3,u[6*b+5]=4*b+1}a.geometry.setIndex(new THREE.BufferAttribute(u,1)),a.geometry.addAttribute("speed",new THREE.BufferAttribute(t,1)),a.geometry.addAttribute("rotation",new THREE.BufferAttribute(s,3)),a.geometry.addAttribute("position",new THREE.BufferAttribute(q,3)),a.geometry.addAttribute("offset",new THREE.BufferAttribute(p,3)),a.geometry.addAttribute("uv",new THREE.BufferAttribute(r,2)),a.geometry.computeBoundingSphere(),a.userData.speed=.05}},a402:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b%2?.5:-.5}},a403:{update:function(a,b,c){a.rotation.z=.1*c}},a404:{update:function(a){cameraStage.position.z<-2050&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},1500,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=10*(-a.position.z-2200),a.material.uniforms.totalFrame.value=35,a.position.z+=.5}},a405:{update:function(a){cameraStage.position.z<-2050&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},800,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=5*(-a.position.z-2200),a.material.uniforms.totalFrame.value=18}},a406:{update:function(a,b,c){a.rotation.z=.3*c}},a500:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed},config:function(a){a.userData.rotSpeed=-.2}},a501:{update:function(a){5==currentSceneIndex&&(a.visible=cameraStage.position.z>-3550,a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.position).wait(100).to({z:a.userData.initPosition.z},1300,createjs.Ease.sineInOut).call(function(){cameraStage.position.z-=40})))},config:function(a){a.position.z+=1400,a.userData.played=!1}},a502:{update:function(a,b,c){a.position.y=a.userData.initPosition.y+5*Math.sin(3*c)}},a503:{update:function(a,b,c){a.position.y=a.userData.initPosition.y-2*Math.sin(3*c)}},a504:{update:function(a){cameraStage.position.z<-2750&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},1e3,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=5*(-a.position.z-3e3),a.material.uniforms.totalFrame.value=19}},a505:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b?.5:-.5}},a506:{update:function(a){a.position.z=a.userData.initPosition.z+Math.max(cameraStage.position.z,a.userData.zlimit)+3170},config:function(a,b){a.userData.zlimit=-3400+20*(7-b)}},a507:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a509:{update:function(a,b,c){a.position.y=a.userData.initPosition.y+.3*Math.sin(5*c),a.rotation.z=.1*Math.cos(2*c)},config:function(a){a.material.uniforms.totalFrame.value=1}},a510:{update:function(a,b,c){a.rotation.z=c*-.1}},a511:{update:function(a,b,c){a.rotation.z=c*-.3}},a600:{update:function(a,b,c){a.position.y=a.userData.initPosition.y+Math.sin(4*c+.02*a.userData.initPosition.z)*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b?3:-3}},a601:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b?.05:1==b?.2:2==b?.25:3==b?.3:.35}},a603:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a604:{update:function(a,b,c){a.rotation.z=.15*c}},a605:{update:function(a,b){cameraStage.position.z<-3900&&(a.rotation.z+=.015*b)}},a700:{update:function(a,b,c){a.rotation.z=a.userData.initRotation+c+a.children[0].userData.initPosition.y*(.02+.02*Math.cos(c+.01*a.userData.initPosition.z)),a.children[0].position.y=3*Math.sin(4*c)-3+a.children[0].userData.initPosition.y},config:function(a){a.userData.initRotation=a.rotation.z}},a701:{update:function(a,b,c){a.rotation.z=a.userData.initRotation-.5*c},config:function(a,b){a.userData.initRotation=b*Math.PI/8}},a702:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.userData.initPosition.z+100-cameraStage.position.z)/20))}},a703:{update:function(a,b,c){a.rotation.z=.3*c}},a704:{update:function(a,b,c){a.rotation.z=.4*c}},a800:{update:function(a,b,c){a.rotation.z=c*a.userData.rotSpeed+.05*a.position.z},config:function(a){a.userData.rotSpeed=a.position.y>0?1:-1}},a801:{update:function(a,b,c){a.rotation.z=.5*-c,cameraStage.position.z<-4530&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},800,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=5*(-a.position.z-4600),a.material.uniforms.totalFrame.value=16}},a802:{update:function(a,b,c){a.material.uniforms.time.value=15*c+.05*a.position.z},config:function(a){a.material.uniforms.totalFrame.value=1}},a803:{update:function(a,b,c){a.rotation.z=.3*c}},a804:{update:function(a,b,c){a.rotation.z=.5*c}},a900:{update:function(a,b,c){a.position.y=5*Math.sin(.5*c+.05*a.position.z)+a.userData.initPosition.y},config:function(){}},a901:{update:function(a,b,c){a.rotation.z=Math.sin(2*c+.008*a.userData.initPosition.z)*a.userData.rotSpeed},config:function(a,b){a.userData.rotSpeed=0==b?.5:-.5}},a902:{update:function(a){cameraStage.position.z<-5e3&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.position).to({z:a.userData.initPosition.z},2e3,createjs.Ease.sineOut)))},config:function(a){a.userData.played=!1,a.position.z-=600}},a903:{update:function(a){a.position.z=a.userData.initPosition.z+Math.max(cameraStage.position.z,a.userData.zlimit)+5230},config:function(a,b){a.userData.zlimit=-5600+35*(8-b)}},a904:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},a905:{update:function(a,b,c){a.rotation.z=.1*-c}},a906:{update:function(a,b,c){a.rotation.z=.2*-c}},aa00:{update:function(){}},aa01:{update:function(){}},aa02:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},aa03:{update:function(a){cameraStage.position.z<-5700&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.position).wait(a.userData.delay).to({x:a.userData.initPosition.x,y:a.userData.initPosition.y},1500,createjs.Ease.backOut)))},config:function(a){a.userData.played=!1,a.userData.delay=5*(-a.position.z-5760),a.position.x*=4,a.position.y*=4}},aa04:{update:function(a,b,c){a.rotation.z=.1*-c}},aa05:{update:function(a,b,c){a.rotation.z=.3*-c}},ab00:{update:function(a){a.material.uniforms.scale.value=Math.min(1,Math.max(.001,(a.position.z+150-cameraStage.position.z)/20))}},ab01:{update:function(a,b,c){a.material.uniforms.time.value=5.5*c+.05*a.position.z},config:function(a,b){a.material.uniforms.totalFrame.value=b}},ab02:{update:function(a){cameraStage.position.z<-6230&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},900,createjs.Ease.linear)))},config:function(a){a.userData.played=!1,a.userData.delay=7*(-a.position.z-6330),a.material.uniforms.totalFrame.value=13}},ab03:{update:function(a){cameraStage.position.z<-6230&&(a.userData.played||(a.userData.played=!0,createjs.Tween.get(a.material.uniforms.time).wait(a.userData.delay).to({value:a.material.uniforms.totalFrame.value-1},900,createjs.Ease.linear)))
},config:function(a){a.userData.played=!1,a.userData.delay=7*(-a.position.z-6330),a.material.uniforms.totalFrame.value=13}},ab04:{update:function(a,b,c){a.rotation.z=.1*-c}},ab05:{update:function(a,b,c){a.rotation.z=.3*-c}},ac00:{update:function(a,b,c){a.position.x=a.userData.initPosition.x+Math.sin(c)*a.userData.moveSpeed},config:function(a,b){a.userData.moveSpeed=0==b?3:-3}},ac01:{update:function(a,b,c){a.rotation.z=.1*-c}},ac03:{update:function(a,b,c){a.rotation.z=.3*-c}}},geomTable={gm400:new THREE.BufferGeometry,gl700:(new THREE.BufferGeometry).addAttribute("position",new THREE.BufferAttribute(new Float32Array([19.13,46.19,0,46.19,19.13,0,46.19,-19.13,0,19.13,-46.19,0,-19.13,-46.19,0,-46.19,-19.13,0,-46.19,19.13,0,-19.13,46.19,0,19.13,46.19,0]),3))};